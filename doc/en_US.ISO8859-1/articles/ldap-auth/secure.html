<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>4. Security Considerations</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="LDAP Authentication" /><link rel="up" href="index.html" title="LDAP Authentication" /><link rel="prev" href="client.html" title="3. Client Configuration" /><link rel="next" href="useful.html" title="A. Useful Aids" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. Security Considerations</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="client.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="useful.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="secure"></a>4. Security Considerations</h2></div></div></div><p>Now that your machines (and possibly other services) are
      authenticating against your LDAP server, this server needs to be
      protected at least as well as
      <code class="filename">/etc/master.passwd</code> would be on a regular
      server, and possibly even more so since a broken or cracked LDAP
      server would break every client service.</p><p>Remember, this section is not exhaustive.  You should
      continually review your configuration and procedures for
      improvements.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="secure-readonly"></a>4.1. Setting Attributes Read-only</h3></div></div></div><p>Several attributes in LDAP should be read-only.  If left
	writable by the user, for example, a user could change his
	<code class="literal">uidNumber</code> attribute to <code class="literal">0</code>
	and get <code class="systemitem">root</code>
	access!</p><p>To begin with, the <code class="literal">userPassword</code>
	attribute should not be world-readable.  By default, anyone
	who can connect to the LDAP server can read this attribute.
	To disable this, put the following in
	<code class="filename">slapd.conf</code>:</p><div class="example"><a id="hide-userpass"></a><div class="example-title">Example 8. Hide Passwords</div><div class="example-contents"><pre class="programlisting">access to dn.subtree="ou=people,dc=example,dc=org"
  attrs=userPassword
  by self write
  by anonymous auth
  by * none

access to *
  by self write
  by * read</pre></div></div><br class="example-break" /><p>This will disallow reading of the
	<code class="literal">userPassword</code> attribute, while still
	allowing users to change their own passwords.</p><p>Additionally, you'll want to keep users from changing some
	of their own attributes.  By default, users can change any
	attribute (except for those which the LDAP schemas themselves
	deny changes), such as <code class="literal">uidNumber</code>.  To close
	this hole, modify the above to</p><div class="example"><a id="attrib-readonly"></a><div class="example-title">Example 9. Read-only Attributes</div><div class="example-contents"><pre class="programlisting">access to dn.subtree="ou=people,dc=example,dc=org"
  attrs=userPassword
  by self write
  by anonymous auth
  by * none

access to attrs=homeDirectory,uidNumber,gidNumber
  by * read

access to *
  by self write
  by * read</pre></div></div><br class="example-break" /><p>This will stop users from being able to masquerade as
	other users.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="secure-root"></a>4.2. <code class="systemitem">root</code> Account
	Definition</h3></div></div></div><p>Often the <code class="systemitem">root</code>
	or manager account for the LDAP service will be defined in the
	configuration file.  <span class="application">OpenLDAP</span>
	supports this, for example, and it works, but it can lead to
	trouble if <code class="filename">slapd.conf</code> is compromised.  It
	may be better to use this only to bootstrap yourself into
	LDAP, and then define a <code class="systemitem">root</code> account there.</p><p>Even better is to define accounts that have limited
	permissions, and omit a <code class="systemitem">root</code> account entirely.  For
	example, users that can add or remove user accounts are added
	to one group, but they cannot themselves change the membership
	of this group.  Such a security policy would help mitigate the
	effects of a leaked password.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="manager-acct"></a>4.2.1. Creating a Management Group</h4></div></div></div><p>Say you want your IT department to be able to change
	  home directories for users, but you do not want all of them
	  to be able to add or remove users.  The way to do this is to
	  add a group for these admins:</p><div class="example"><a id="manager-acct-dn"></a><div class="example-title">Example 10. Creating a Management Group</div><div class="example-contents"><pre class="programlisting">dn: cn=homemanagement,dc=example,dc=org
objectClass: top
objectClass: posixGroup
cn: homemanagement
gidNumber: 121 # required for posixGroup
memberUid: uid=tuser,ou=people,dc=example,dc=org
memberUid: uid=user2,ou=people,dc=example,dc=org</pre></div></div><br class="example-break" /><p>And then change the permissions attributes in
	  <code class="filename">slapd.conf</code>:</p><div class="example"><a id="management-acct-acl"></a><div class="example-title">Example 11. ACLs for a Home Directory Management Group</div><div class="example-contents"><pre class="programlisting">access to dn.subtree="ou=people,dc=example,dc=org"
  attr=homeDirectory
  by dn="cn=homemanagement,dc=example,dc=org"
  dnattr=memberUid write</pre></div></div><br class="example-break" /><p>Now <code class="systemitem">tuser</code> and
	  <code class="systemitem">user2</code> can change
	  other users' home directories.</p><p>In this example we have given a subset of administrative
	  power to certain users without giving them power in other
	  domains.  The idea is that soon no single user account has
	  the power of a <code class="systemitem">root</code> account, but every
	  power root had is had by at least one user.  The <code class="systemitem">root</code> account then becomes
	  unnecessary and can be removed.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-passwd"></a>4.3. Password Storage</h3></div></div></div><p>By default <span class="application">OpenLDAP</span> will store
	the value of the <code class="literal">userPassword</code> attribute as
	it stores any other data: in the clear.  Most of the time it
	is base 64 encoded, which provides enough protection to keep
	an honest administrator from knowing your password, but little
	else.</p><p>It is a good idea, then, to store passwords in a more
	secure format, such as SSHA (salted SHA).  This is done by
	whatever program you use to change users' passwords.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="client.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="useful.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3. Client Configuration </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> A. Useful Aids</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>