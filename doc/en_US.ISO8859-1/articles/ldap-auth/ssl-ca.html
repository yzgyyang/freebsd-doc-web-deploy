<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>B. OpenSSL Certificates for LDAP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="LDAP Authentication" /><link rel="up" href="index.html" title="LDAP Authentication" /><link rel="prev" href="useful.html" title="A. Useful Aids" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">B. <span class="application">OpenSSL</span> Certificates for
      LDAP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="useful.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> </td></tr></table><hr /></div><div class="appendix"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ssl-ca"></a>B. <span class="application">OpenSSL</span> Certificates for
      LDAP</h2></div></div></div><p>If you are hosting two or more LDAP servers, you will
      probably not want to use self-signed certificates, since each
      client will have to be configured to work with each certificate.
      While this is possible, it is not nearly as simple as creating
      your own certificate authority, and signing your servers'
      certificates with that.</p><p>The steps here are presented as they are with very little
      attempt at explaining what is going on&#8212;further explanation
      can be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">openssl</span>(1)</span></a> and its friends.</p><p>To create a certificate authority, we simply need a
      self-signed certificate and key.  The steps for this again
      are</p><div class="example"><a id="make-cert"></a><div class="example-title">Example B.1. Creating a Certificate</div><div class="example-contents"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>openssl genrsa -out root.key 1024</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>openssl req -new -key root.key -out root.csr</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>openssl x509 -req -days 1024 -in root.csr -signkey root.key -out root.crt</code></strong></pre></div></div><br class="example-break" /><p>These will be your root CA key and certificate.  You will
      probably want to encrypt the key and store it in a cool, dry
      place; anyone with access to it can masquerade as one of your
      LDAP servers.</p><p>Next, using the first two steps above create a key
      <code class="filename">ldap-server-one.key</code> and certificate signing
      request <code class="filename">ldap-server-one.csr</code>.  Once you sign
      the signing request with <code class="filename">root.key</code>, you will
      be able to use <code class="filename">ldap-server-one.*</code> on your
      LDAP servers.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Do not forget to use the fully qualified domain name for
	the <span class="quote">&#8220;<span class="quote">common name</span>&#8221;</span> attribute when generating the
	certificate signing request; otherwise clients will reject a
	connection with you, and it can be very tricky to
	diagnose.</p></div><p>To sign the key, use <code class="option">-CA</code> and
      <code class="option">-CAkey</code> instead of
      <code class="option">-signkey</code>:</p><div class="example"><a id="ca-sign"></a><div class="example-title">Example B.2. Signing as a Certificate Authority</div><div class="example-contents"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>openssl x509 -req -days 1024 \
-in ldap-server-one.csr -CA root.crt -CAkey root.key \
-out ldap-server-one.crt</code></strong></pre></div></div><br class="example-break" /><p>The resulting file will be the certificate that you can use
      on your LDAP servers.</p><p>Finally, for clients to trust all your servers, distribute
      <code class="filename">root.crt</code> (the
      <span class="emphasis"><em>certificate</em></span>, not the key!) to each client,
      and specify it in the <code class="literal">TLSCACertificateFile</code>
      directive in <code class="filename">ldap.conf</code>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="useful.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> </td></tr><tr><td width="40%" align="left" valign="top">A. Useful Aids </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>