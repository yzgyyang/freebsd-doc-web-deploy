<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>Implementing UFS Journaling on a Desktop PC</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><meta name="description" content="A journaling file system uses a log to record all transactions that take place in the file system, and preserves its integrity in the event of a system crash or power failure. Although it is still possible to lose unsaved changes to files, journaling almost completely eliminates the possibility of file system corruption caused by an unclean shutdown. It also shortens to a minimum the time required for after-failure file system checking. Although the UFS file system employed by FreeBSD does not implement journaling itself, the new journal class of the GEOM framework in FreeBSD 7.X can be used to provide file system independent journaling. This article explains how to implement UFS journaling on a typical desktop PC scenario." /><link rel="home" href="index.html" title="Implementing UFS Journaling on a Desktop PC" /><link rel="next" href="understanding-journaling.html" title="2. Understanding Journaling in FreeBSD" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Implementing UFS Journaling on a Desktop PC</th></tr><tr><td width="20%" align="left"> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="understanding-journaling.html">Next</a></td></tr></table><hr /></div><div xml:lang="en" class="article" lang="en"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp46760824"></a>Implementing UFS Journaling on a Desktop PC</h1></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="author"><h3 class="author"><span class="firstname">Manolis</span> <span class="surname">Kiagias</span></h3><div class="affiliation"><div class="address"><p><code class="email">&lt;<a xmlns="" class="email" href="mailto:manolis@FreeBSD.org">manolis@FreeBSD.org</a>&gt;</code></p></div></div></div></div><div>Revision: <a href="https://svnweb.freebsd.org/changeset/doc/0b702c5af4"><span class="svnref">0b702c5af4</span></a></div><div><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2008 Manolis Kiagias</p></div><div><a xmlns="http://www.w3.org/1999/xhtml" href="trademarks.html">Legal Notice</a></div><div>Last modified on 2017-12-30 22:56:56 +0000 by eadler.</div><div><div xmlns="http://www.w3.org/1999/xhtml" class="abstract"><div class="abstract-title">Abstract</div><p>A journaling file system uses a log to record all transactions
	that take place in the file system, and preserves its integrity in the
	event of a system crash or power failure.  Although it is still
	possible to lose unsaved changes to files, journaling almost
	completely eliminates the possibility of file system corruption caused
	by an unclean shutdown.  It also shortens to a minimum the time
	required for after-failure file system checking.  Although the UFS
	file system employed by FreeBSD does not implement journaling itself,
	the new journal class of the GEOM framework in FreeBSD 7.<em class="replaceable"><code>X</code></em> can be
	used to provide file system independent journaling. This article
	explains how to implement UFS journaling on a typical desktop PC
	scenario.</p></div></div></div><div class="docformatnavi">
      [
      
	  Split HTML
	
      /
      <a href="article.html">Single HTML</a>
      ]
    </div><hr /></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="index.html#introduction">1. Introduction</a></span></dt><dt><span class="sect1"><a href="understanding-journaling.html">2. Understanding Journaling in FreeBSD</a></span></dt><dt><span class="sect1"><a href="reserve-space.html">3. Steps During the Installation of FreeBSD</a></span></dt><dt><span class="sect1"><a href="configure-journal.html">4. Setting Up Journaling</a></span></dt><dt><span class="sect1"><a href="troubleshooting-gjournal.html">5. Troubleshooting Journaling</a></span></dt><dt><span class="sect1"><a href="further-reading.html">6. Further Reading</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="introduction"></a>1. Introduction</h2></div></div></div><p>While  professional servers are usually well protected from
      unforeseen shutdowns, the typical desktop is at the mercy of power
      failures, accidental resets, and other user related incidents that can
      lead to unclean shutdowns.  Soft Updates usually protect the file system
      efficiently in such cases, although most of the times a lengthy
      background check is required.  On rare occasions, file system corruption
      reaches a point where user intervention is required and data may be
      lost.</p><p>The new journaling capability provided by GEOM can greatly assist
      in such scenarios, by virtually eliminating the time required for
      file system checking, and ensuring that the file system is quickly
      restored to a consistent state.</p><p>This article describes a procedure for implementing UFS journaling
      on a typical desktop PC scenario (one hard disk used for both operating
      system and data).  It should be followed during a fresh installation of
      FreeBSD.  The steps are simple enough and do not require overly complex
      interaction with the command line.</p><p>After reading this article, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to reserve space for journaling during a new installation of
	  FreeBSD.</p></li><li class="listitem"><p>How to load and enable the <code class="literal">geom_journal</code>
	  module (or build support for it in your custom kernel).</p></li><li class="listitem"><p>How to convert your existing file systems to utilize journaling,
	  and what options to use in <code class="filename">/etc/fstab</code> to mount
	  them.</p></li><li class="listitem"><p>How to implement journaling in new (empty) partitions.</p></li><li class="listitem"><p>How to troubleshoot common problems associated with
	  journaling.</p></li></ul></div><p>Before reading this article, you should be able to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand basic <span class="trademark">UNIX</span>® and FreeBSD concepts.</p></li><li class="listitem"><p>Be familiar with the installation procedure of FreeBSD and the
	<span class="application">sysinstall</span> utility.</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">The procedure described here is intended for preparing a new
	installation where no actual user data is stored on the disk yet.
	While it is possible to modify and extend this procedure for
	systems already in production, you should <span class="emphasis"><em>backup</em></span>
	all important data before doing so.  Messing around with disks and
	partitions at a low level can lead to fatal mistakes and data
	loss.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="understanding-journaling.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"> </td><td width="40%" align="right" valign="top"> 2. Understanding Journaling in FreeBSD</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>