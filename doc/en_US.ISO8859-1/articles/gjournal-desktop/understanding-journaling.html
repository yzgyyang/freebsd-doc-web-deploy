<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>2. Understanding Journaling in FreeBSD</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Implementing UFS Journaling on a Desktop PC" /><link rel="up" href="index.html" title="Implementing UFS Journaling on a Desktop PC" /><link rel="prev" href="index.html" title="Implementing UFS Journaling on a Desktop PC" /><link rel="next" href="reserve-space.html" title="3. Steps During the Installation of FreeBSD" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. Understanding Journaling in FreeBSD</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="index.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="reserve-space.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="understanding-journaling"></a>2. Understanding Journaling in FreeBSD</h2></div></div></div><p>The journaling provided by GEOM in FreeBSD 7.<em class="replaceable"><code>X</code></em> is not file system
      specific (unlike for example the ext3 file system in <span class="trademark">Linux</span>®) but is
      functioning at the block level.  Though this means it can be applied
      to different file systems, for FreeBSD 7.0-RELEASE, it can only be used
      on UFS2.</p><p>This functionality is provided by loading the
      <code class="filename">geom_journal.ko</code> module into the kernel (or
      building it into a custom kernel) and using the
      <code class="command">gjournal</code> command to configure the file systems.
      In general, you would like to journal large file systems, like
      <code class="filename">/usr</code>.  You will need however (see the following
      section) to reserve some free disk space.</p><p>When a file system is journaled, some disk space is needed to keep
      the journal itself.  The disk space that holds the actual data is
      referred to as the <span class="emphasis"><em>data provider</em></span>, while the one
      that holds the journal is referred to as the
      <span class="emphasis"><em>journal provider</em></span>.  The data and journal providers
      need to be on different partitions when journaling an existing
      (non-empty) partition.  When journaling a new partition, you have the
      option to use a single provider for both data and journal.  In any case,
      the <code class="command">gjournal</code> command combines both providers to
      create the final journaled file system.  For example:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>You wish to journal your <code class="filename">/usr</code> file system,
	  stored in <code class="filename">/dev/ad0s1f</code> (which
	  already contains data).</p></li><li class="listitem"><p>You reserved some free disk space in a partition in
	  <code class="filename">/dev/ad0s1g</code>.</p></li><li class="listitem"><p>Using <code class="command">gjournal</code>, a new <code class="filename">/dev/ad0s1f.journal</code> device is created
	  where <code class="filename">/dev/ad0s1f</code> is the data
	  provider, and <code class="filename">/dev/ad0s1g</code> is
	  the journal provider.  This new device is then used for all
	  subsequent file operations.</p></li></ul></div><p>The amount of disk space you need to reserve for the journal
      provider depends on the usage load of the file system and not on the
      size of the data provider.  For example on a typical office desktop,
      a 1 GB journal provider for the <code class="filename">/usr</code> file system
      will suffice, while a machine that deals with heavy disk I/O (i.e.
      video editing) may need more.  A kernel panic will occur if the
      journal space is exhausted before it has a chance to be
      committed.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The journal sizes suggested here, are highly unlikely to cause
	problems in typical desktop use (such as web browsing, word
	processing and playback of media files).  If your workload
	includes intense disk activity, use the following rule for maximum
	reliability: Your RAM size should fit in 30% of the journal provider's
	space.  For example, if your system has 1 GB RAM, create an
	approximately 3.3 GB journal provider. (Multiply your
	RAM size with 3.3 to obtain the size of the journal).</p></div><p>For more information about journaling, please read the manual
      page of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gjournal&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gjournal</span>(8)</span></a>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="index.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="reserve-space.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Implementing UFS Journaling on a Desktop PC </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 3. Steps During the Installation of FreeBSD</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>