<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>CUPS on FreeBSD</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><meta name="description" content="An article about configuring CUPS on FreeBSD." /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div xml:lang="en" class="article" lang="en"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp44057720"></a>CUPS on FreeBSD</h1></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Chess</span> <span class="surname">Griffin</span></h3><div class="affiliation"><div class="address"><p><br />
	    <code class="email">&lt;<a xmlns="" class="email" href="mailto:chess@chessgriffin.com">chess@chessgriffin.com</a>&gt;</code><br />
	  </p></div></div></div></div></div><div>Revision: <a href="https://svnweb.freebsd.org/changeset/doc/b3af03d690"><span class="svnref">b3af03d690</span></a></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="legalnotice"><a id="trademarks"></a><p>FreeBSD is a registered trademark of
  the FreeBSD Foundation.</p><p>Many of the designations used by
  manufacturers and sellers to distinguish their products are claimed
  as trademarks.  Where those designations appear in this document,
  and the FreeBSD Project was aware of the trademark claim, the
  designations have been followed by the <span class="quote">&#8220;<span class="quote">&#8482;</span>&#8221;</span> or the
  <span class="quote">&#8220;<span class="quote">®</span>&#8221;</span> symbol.</p></div></div><div>Last modified on 2020-02-06 19:30:04 +0000 by carlavilla.</div><div><div xmlns="http://www.w3.org/1999/xhtml" class="abstract"><div class="abstract-title">Abstract</div><p>An article about configuring CUPS on FreeBSD.</p></div></div></div><div class="docformatnavi">
      [
      <a href="index.html">Split HTML</a>
      /
      
	  Single HTML
	
      ]
    </div><hr /></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#printing-cups">1. An Introduction to the Common Unix Printing System
      (CUPS)</a></span></dt><dt><span class="sect1"><a href="#printing-cups-install">2. Installing the CUPS Print Server</a></span></dt><dt><span class="sect1"><a href="#printing-cups-configuring-server">3. Configuring the CUPS Print Server</a></span></dt><dt><span class="sect1"><a href="#printing-cups-configuring-printers">4. Configuring Printers on the CUPS Print Server</a></span></dt><dt><span class="sect1"><a href="#printing-cups-clients">5. Configuring CUPS Clients</a></span></dt><dt><span class="sect1"><a href="#printing-cups-troubleshooting">6. CUPS Troubleshooting</a></span></dt><dt><span class="index"><a href="#idp45262200">Index</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups"></a>1. An Introduction to the Common Unix Printing System
      (CUPS)</h2></div></div></div><a id="idp45016056" class="indexterm"></a><a id="idp45017336" class="indexterm"></a><p><span class="application">CUPS</span>, the Common UNIX Printing
      System, provides a portable printing layer for <span class="trademark">UNIX</span>®-based
      operating systems.  It has been developed by Easy Software
      Products to promote a standard printing solution for all <span class="trademark">UNIX</span>®
      vendors and users.</p><p><span class="application">CUPS</span> uses the Internet Printing
      Protocol (<acronym class="acronym">IPP</acronym>) as the basis for managing
      print jobs and queues.  The Line Printer Daemon
      (<acronym class="acronym">LPD</acronym>), Server Message Block
      (<acronym class="acronym">SMB</acronym>), and AppSocket (aka JetDirect)
      protocols are also supported with reduced functionality.
      <span class="application">CUPS</span> adds network printer browsing
      and PostScript Printer Description (<acronym class="acronym">PPD</acronym>)
      based printing options to support real-world printing under
      <span class="trademark">UNIX</span>®.  As a result, <span class="application">CUPS</span> is
      ideally-suited for sharing and accessing printers in mixed
      environments of FreeBSD, <span class="trademark">Linux</span>®, <span class="trademark">Mac OS</span>® X, or
      <span class="trademark">Windows</span>®.</p><p>The main site for <span class="application">CUPS</span> is <code class="uri"><a class="uri" href="http://www.cups.org/" target="_top">http://www.cups.org/</a></code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups-install"></a>2. Installing the CUPS Print Server</h2></div></div></div><p>To install <span class="application">CUPS</span> using a
      precompiled binary, issue the following command from a root
      terminal:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install cups</code></strong></pre><p>Other optional, but recommended, packages are
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/gutenprint/pkg-descr">print/gutenprint</a> and
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/hplip/pkg-descr">print/hplip</a>, both of which add
      drivers and utilities for a variety of printers.  Once
      installed, the <span class="application">CUPS</span> configuration
      files can be found in the directory
      <code class="filename">/usr/local/etc/cups</code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups-configuring-server"></a>3. Configuring the CUPS Print Server</h2></div></div></div><p>After installation, a few files must be edited in order to
      configure the <span class="application">CUPS</span> server.  First,
      create or modify, as the case may be, the file
      <code class="filename">/etc/devfs.rules</code> and add the following
      information to set the proper permissions on all potential
      printer devices and to associate printers with the <code class="systemitem">cups</code> user group:</p><pre class="programlisting">[system=10]
add path 'unlpt*' mode 0660 group cups
add path 'ulpt*' mode 0660 group cups
add path 'lpt*' mode 0660 group cups
add path 'usb/<em class="replaceable"><code>X</code></em>.<em class="replaceable"><code>Y</code></em>.<em class="replaceable"><code>Z</code></em>' mode 0660 group cups</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Note that <em class="replaceable"><code>X</code></em>,
	<em class="replaceable"><code>Y</code></em>, and <em class="replaceable"><code>Z</code></em>
	should be replaced with the target USB device listed in the
	<code class="filename">/dev/usb</code> directory that
	corresponds to the printer.  To find the correct device,
	examine the output of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>, where
	<code class="filename">ugen<em class="replaceable"><code>X</code></em>.<em class="replaceable"><code>Y</code></em></code>
	lists the printer device, which is a symbolic link to a USB
	device in <code class="filename">/dev/usb</code>.</p></div><p>Next, add two lines to <code class="filename">/etc/rc.conf</code> as
      follows:</p><pre class="programlisting">cupsd_enable="YES"
devfs_system_ruleset="system"</pre><p>These two entries will start the
      <span class="application">CUPS</span> print server on boot and invoke
      the local devfs rule created above, respectively.</p><p>In order to enable <span class="application">CUPS</span> printing
      under certain <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® clients, the line below should
      be uncommented in
      <code class="filename">/usr/local/etc/cups/mime.types</code> and
      <code class="filename">/usr/local/etc/cups/mime.convs</code>:</p><pre class="programlisting">application/octet-stream</pre><p>Once these changes have been made, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> and
      <span class="application">CUPS</span> systems must both be restarted,
      either by rebooting the computer or issuing the following two
      commands in a root terminal:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/devfs restart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/usr/local/etc/rc.d/cupsd restart</code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups-configuring-printers"></a>4. Configuring Printers on the CUPS Print Server</h2></div></div></div><p>After the <span class="application">CUPS</span> system has been
      installed and configured, the administrator can begin
      configuring the local printers attached to the
      <span class="application">CUPS</span> print server.  This part of the
      process is very similar, if not identical, to configuring
      <span class="application">CUPS</span> printers on other <span class="trademark">UNIX</span>®-based
      operating systems, such as a <span class="trademark">Linux</span>® distribution.</p><p>The primary means for managing and administering the
      <span class="application">CUPS</span> server is through the web-based
      interface, which can be found by launching a web browser and
      entering <code class="uri"><a class="uri" href="http://localhost:631" target="_top">http://localhost:631</a></code>
      in the browser's URL bar.  If the
      <span class="application">CUPS</span> server is on another machine on
      the network, substitute the server's local <acronym class="acronym">IP</acronym>
      address for <code class="systemitem">localhost</code>.  The
      <span class="application">CUPS</span> web interface is fairly
      self-explanatory, as there are sections for managing printers
      and print jobs, authorizing users, and more.  Additionally, on
      the right-hand side of the Administration screen
      are several check-boxes allowing easy access to commonly-changed
      settings, such as whether to share published printers connected
      to the system, whether to allow remote administration of the
      <span class="application">CUPS</span> server, and whether to allow
      users additional access and privileges to the printers and print
      jobs.</p><p>Adding a printer is generally as easy as clicking <span class="quote">&#8220;<span class="quote">Add
	Printer</span>&#8221;</span> at the Administration screen of the
      <span class="application">CUPS</span> web interface, or clicking one
      of the <span class="quote">&#8220;<span class="quote">New Printers Found</span>&#8221;</span> buttons also at the
      Administration screen.  When presented with the
      <span class="quote">&#8220;<span class="quote">Device</span>&#8221;</span> drop-down box, simply select the desired
      locally-attached printer, and then continue through the process.
      If one has added the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/gutenprint-cups/pkg-descr">print/gutenprint-cups</a> or
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/hplip/pkg-descr">print/hplip</a> ports or packages as referenced
      above, then additional print drivers will be available in the
      subsequent screens that might provide more stability or
      features.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups-clients"></a>5. Configuring CUPS Clients</h2></div></div></div><p>Once the <span class="application">CUPS</span> server has been
      configured and printers have been added and published to the
      network, the next step is to configure the clients, or the
      machines that are going to access the
      <span class="application">CUPS</span> server.  If one has a single
      desktop machine that is acting as both server and client, then
      much of this information may not be needed.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-cups-clients-unix"></a>5.1. <span class="trademark">UNIX</span>® Clients</h3></div></div></div><p><span class="application">CUPS</span> will also need to be
	installed on your <span class="trademark">UNIX</span>® clients.  Once
	<span class="application">CUPS</span> is installed on the clients,
	then <span class="application">CUPS</span> printers that are shared
	across the network are often automatically discovered by the
	printer managers for various desktop environments such as
	<span class="application">GNOME</span> or
	<span class="application">KDE</span>.  Alternatively, one can access
	the local <span class="application">CUPS</span> interface on the
	client machine at <code class="uri"><a class="uri" href="http://localhost:631" target="_top">http://localhost:631</a></code>
	and click on <span class="quote">&#8220;<span class="quote">Add Printer</span>&#8221;</span> in the Administration
	section.  When presented with the <span class="quote">&#8220;<span class="quote">Device</span>&#8221;</span>
	drop-down box, simply select the networked
	<span class="application">CUPS</span> printer, if it was
	automatically discovered, or select <code class="literal">ipp</code> or
	<code class="literal">http</code> and enter the <acronym class="acronym">IPP</acronym>
	or <acronym class="acronym">HTTP</acronym> <acronym class="acronym">URI</acronym> of the
	networked <span class="application">CUPS</span> printer, usually in
	one of the two following syntaxes:</p><pre class="programlisting">ipp://<em class="replaceable"><code>server-name-or-ip</code></em>/printers/<em class="replaceable"><code>printername</code></em></pre><pre class="programlisting">http://<em class="replaceable"><code>server-name-or-ip</code></em>:631/printers/<em class="replaceable"><code>printername</code></em></pre><p>If the <span class="application">CUPS</span> clients have
	difficulty finding other <span class="application">CUPS</span>
	printers shared across the network, sometimes it is helpful to
	add or create a file
	<code class="filename">/usr/local/etc/cups/client.conf</code> with a
	single entry as follows:</p><pre class="programlisting">ServerName <em class="replaceable"><code>server-ip</code></em></pre><p>In this case, <em class="replaceable"><code>server-ip</code></em> would
	be replaced by the local <acronym class="acronym">IP</acronym> address of the
	<span class="application">CUPS</span> server on the network.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-cups-clients-windows"></a>5.2. <span class="trademark">Windows</span>® Clients</h3></div></div></div><p>Versions of <span class="trademark">Windows</span>® prior to XP did not have the
	capability to natively network with
	<acronym class="acronym">IPP</acronym>-based printers.  However, <span class="trademark">Windows</span>® XP
	and later versions do have this capability.  Therefore, to add
	a <span class="application">CUPS</span> printer in these versions of
	<span class="trademark">Windows</span>® is quite easy.  Generally, the <span class="trademark">Windows</span>®
	administrator will run the <span class="trademark">Windows</span>® <code class="literal">Add
	  Printer</code> wizard, select <code class="literal">Network
	  Printer</code> and then enter the <acronym class="acronym">URI</acronym>
	in the following syntax:</p><pre class="programlisting">http://<em class="replaceable"><code>server-name-or-ip</code></em>:631/printers/<em class="replaceable"><code>printername</code></em></pre><p>If one has an older version of <span class="trademark">Windows</span>® without native
	<acronym class="acronym">IPP</acronym> printing support, then the general
	means of connecting to a <span class="application">CUPS</span>
	printer is to use <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/samba410/pkg-descr">net/samba410</a> and
	<span class="application">CUPS</span> together, which is a topic
	outside the scope of this chapter.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups-troubleshooting"></a>6. CUPS Troubleshooting</h2></div></div></div><p>Difficulties with <span class="application">CUPS</span> often lies
      in permissions.  First, double check the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a>
      permissions as outlined above.  Next, check the actual
      permissions of the devices created in the file system.  It is
      also helpful to make sure your user is a member of the
      <code class="systemitem">cups</code> group.  If the
      permissions check boxes in the Administration section of the
      <span class="application">CUPS</span> web interface do not seem to be
      working, another fix might be to manually backup the main
      <span class="application">CUPS</span> configuration file
      located at <code class="filename">/usr/local/etc/cups/cupsd.conf</code>
      and edit the various configuration options and try different
      combinations of configuration options.  One sample
      <code class="filename">/usr/local/etc/cups/cupsd.conf</code> to test is
      listed below.  Please note that this sample
      <code class="filename">cupsd.conf</code> sacrifices security for
      easier configuration; once the administrator successfully
      connects to the <span class="application">CUPS</span> server and
      configures the clients, it is advisable to revisit this
      configuration file and begin locking down access.</p><pre class="programlisting"># Log general information in error_log - change "info" to "debug" for
# troubleshooting...
LogLevel info

# Administrator user group...
SystemGroup wheel

# Listen for connections on Port 631.
Port 631
#Listen localhost:631
Listen /var/run/cups.sock

# Show shared printers on the local network.
Browsing On
BrowseOrder allow,deny
#BrowseAllow @LOCAL
BrowseAllow 192.168.1.* # change to local LAN settings
BrowseAddress 192.168.1.* # change to local LAN settings

# Default authentication type, when authentication is required...
DefaultAuthType Basic
DefaultEncryption Never # comment this line to allow encryption

# Allow access to the server from any machine on the LAN
&lt;Location /&gt;
  Order allow,deny
  #Allow localhost
  Allow 192.168.1.* # change to local LAN settings
&lt;/Location&gt;

# Allow access to the admin pages from any machine on the LAN
&lt;Location /admin&gt;
  #Encryption Required
  Order allow,deny
  #Allow localhost
  Allow 192.168.1.* # change to local LAN settings
&lt;/Location&gt;

# Allow access to configuration files from any machine on the LAN
&lt;Location /admin/conf&gt;
  AuthType Basic
  Require user @SYSTEM
  Order allow,deny
  #Allow localhost
  Allow 192.168.1.* # change to local LAN settings
&lt;/Location&gt;

# Set the default printer/job policies...
&lt;Policy default&gt;
  # Job-related operations must be done by the owner or an administrator...
  &lt;Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs \
Set-Job-Attributes Create-Job-Subscription Renew-Subscription Cancel-Subscription \
Get-Notifications Reprocess-Job Cancel-Current-Job Suspend-Current-Job Resume-Job \
CUPS-Move-Job&gt;
    Require user @OWNER @SYSTEM
    Order deny,allow
  &lt;/Limit&gt;

  # All administration operations require an administrator to authenticate...
  &lt;Limit Pause-Printer Resume-Printer Set-Printer-Attributes Enable-Printer \
Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs \
Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer \
Promote-Job Schedule-Job-After CUPS-Add-Printer CUPS-Delete-Printer CUPS-Add-Class \
CUPS-Delete-Class CUPS-Accept-Jobs CUPS-Reject-Jobs CUPS-Set-Default&gt;
    AuthType Basic
    Require user @SYSTEM
    Order deny,allow
  &lt;/Limit&gt;

  # Only the owner or an administrator can cancel or authenticate a job...
  &lt;Limit Cancel-Job CUPS-Authenticate-Job&gt;
    Require user @OWNER @SYSTEM
    Order deny,allow
  &lt;/Limit&gt;

  &lt;Limit All&gt;
    Order deny,allow
  &lt;/Limit&gt;
&lt;/Policy&gt;</pre></div><div class="index"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp45262200"></a>Index</h2></div></div></div><div xmlns:xlink="http://www.w3.org/1999/xlink" class="index"><div class="indexdiv"><h3>C</h3><dl><dt id="ientry-idp45017336">CUPS, <a class="indexterm" href="#printing-cups">An Introduction to the Common Unix Printing System
      (CUPS)</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt id="ientry-idp45016056">printing, <a class="indexterm" href="#printing-cups">An Introduction to the Common Unix Printing System
      (CUPS)</a></dt></dl></div></div></div></div></body></html>