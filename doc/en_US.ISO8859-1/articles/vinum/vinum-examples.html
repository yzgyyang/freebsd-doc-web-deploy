<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>5. Some Examples</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="The vinum Volume Manager" /><link rel="up" href="index.html" title="The vinum Volume Manager" /><link rel="prev" href="vinum-objects.html" title="4. vinum Objects" /><link rel="next" href="vinum-object-naming.html" title="6. Object Naming" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Some Examples</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="vinum-objects.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="vinum-object-naming.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="vinum-examples"></a>5. Some Examples</h2></div></div></div><p><code class="filename">vinum</code> maintains a
      <span class="emphasis"><em>configuration database</em></span> which describes the
      objects known to an individual system.  Initially, the user
      creates the configuration database from one or more
      configuration files using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gvinum&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gvinum</span>(8)</span></a>.
      <code class="filename">vinum</code> stores a copy of its
      configuration database on each disk
      <span class="emphasis"><em>device</em></span> under its control.  This database is
      updated on each state change, so that a restart accurately
      restores the state of each
      <code class="filename">vinum</code> object.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp47110264"></a>5.1. The Configuration File</h3></div></div></div><p>The configuration file describes individual
	<code class="filename">vinum</code> objects.  The definition of a
	simple volume might be:</p><pre class="programlisting">    drive a device /dev/da3h
    volume myvol
      plex org concat
        sd length 512m drive a</pre><p>This file describes four <code class="filename">vinum</code>
	objects:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <span class="emphasis"><em>drive</em></span> line describes a disk
	    partition (<span class="emphasis"><em>drive</em></span>) and its location
	    relative to the underlying hardware.  It is given the
	    symbolic name <span class="emphasis"><em>a</em></span>.  This separation of
	    symbolic names from device names allows disks to be moved
	    from one location to another without confusion.</p></li><li class="listitem"><p>The <span class="emphasis"><em>volume</em></span> line describes a
	    volume.  The only required attribute is the name, in this
	    case <span class="emphasis"><em>myvol</em></span>.</p></li><li class="listitem"><p>The <span class="emphasis"><em>plex</em></span> line defines a plex.
	    The only required parameter is the organization, in this
	    case <span class="emphasis"><em>concat</em></span>.  No name is necessary as
	    the system automatically generates a name from the volume
	    name by adding the suffix
	    <span class="emphasis"><em>.p</em></span><span class="emphasis"><em>x</em></span>, where
	    <span class="emphasis"><em>x</em></span> is the number of the plex in the
	    volume.  Thus this plex will be called
	    <span class="emphasis"><em>myvol.p0</em></span>.</p></li><li class="listitem"><p>The <span class="emphasis"><em>sd</em></span> line describes a subdisk.
	    The minimum specifications are the name of a drive on
	    which to store it, and the length of the subdisk.  No name
	    is necessary as the system automatically assigns names
	    derived from the plex name by adding the suffix
	    <span class="emphasis"><em>.s</em></span><span class="emphasis"><em>x</em></span>, where
	    <span class="emphasis"><em>x</em></span> is the number of the subdisk in
	    the plex.  Thus <code class="filename">vinum</code> gives this
	    subdisk the name <span class="emphasis"><em>myvol.p0.s0</em></span>.</p></li></ul></div><p>After processing this file, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gvinum&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gvinum</span>(8)</span></a> produces the
	following output:</p><pre class="programlisting" width="97">
<code class="prompt">#</code> gvinum -&gt; <strong class="userinput"><code>create config1</code></strong>
Configuration summary
Drives:         1 (4 configured)
Volumes:        1 (4 configured)
Plexes:         1 (8 configured)
Subdisks:       1 (16 configured)

  D a                     State: up       Device /dev/da3h      Avail: 2061/2573 MB (80%)

  V myvol                 State: up       Plexes:       1 Size:      512 MB

  P myvol.p0            C State: up       Subdisks:     1 Size:      512 MB

  S myvol.p0.s0           State: up       PO:        0  B Size:      512 MB</pre><p>This output shows the brief listing format of
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gvinum&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gvinum</span>(8)</span></a>.  It is represented graphically in <a class="xref" href="vinum-examples.html#vinum-simple-vol" title="Figure 4. A Simple vinum Volume">Figure 4, &#8220;A Simple <code class="filename">vinum</code>
	    Volume&#8221;</a>.</p><p>
	</p><div class="figure"><a id="vinum-simple-vol"></a><div class="figure-title">Figure 4. A Simple <code class="filename">vinum</code>
	    Volume</div><div class="figure-contents"><div class="mediaobject"><img src="vinum-simple-vol.png" alt="A Simple vinum Volume" /></div></div></div><p><br class="figure-break" /></p><p>This figure, and the ones which follow, represent a
	volume, which contains the plexes, which in turn contains the
	subdisks.  In this example, the volume contains one plex, and
	the plex contains one subdisk.</p><p>This particular volume has no specific advantage over a
	conventional disk partition.  It contains a single plex, so it
	is not redundant.  The plex contains a single subdisk, so
	there is no difference in storage allocation from a
	conventional disk partition.  The following sections
	illustrate various more interesting configuration
	methods.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp47192952"></a>5.2. Increased Resilience: Mirroring</h3></div></div></div><p>The resilience of a volume can be increased by mirroring.
	When laying out a mirrored volume, it is important to ensure
	that the subdisks of each plex are on different drives, so
	that a drive failure will not take down both plexes.  The
	following configuration mirrors a volume:</p><pre class="programlisting">	drive b device /dev/da4h
	volume mirror
      plex org concat
        sd length 512m drive a
	  plex org concat
	    sd length 512m drive b</pre><p>In this example, it was not necessary to specify a
	definition of drive <span class="emphasis"><em>a</em></span> again, since
	<code class="filename">vinum</code> keeps track of all objects in
	its configuration database.  After processing this definition,
	the configuration looks like:</p><pre class="programlisting" width="97">
	Drives:         2 (4 configured)
	Volumes:        2 (4 configured)
	Plexes:         3 (8 configured)
	Subdisks:       3 (16 configured)

	D a                     State: up       Device /dev/da3h       Avail: 1549/2573 MB (60%)
	D b                     State: up       Device /dev/da4h       Avail: 2061/2573 MB (80%)

    V myvol                 State: up       Plexes:       1 Size:        512 MB
    V mirror                State: up       Plexes:       2 Size:        512 MB

    P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p0           C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p1           C State: initializing     Subdisks:     1 Size:        512 MB

    S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB
	S mirror.p0.s0          State: up       PO:        0  B Size:        512 MB
	S mirror.p1.s0          State: empty    PO:        0  B Size:        512 MB</pre><p><a class="xref" href="vinum-examples.html#vinum-mirrored-vol" title="Figure 5. A Mirrored vinum Volume">Figure 5, &#8220;A Mirrored <code class="filename">vinum</code>
	    Volume&#8221;</a> shows the
	structure graphically.</p><p>
	</p><div class="figure"><a id="vinum-mirrored-vol"></a><div class="figure-title">Figure 5. A Mirrored <code class="filename">vinum</code>
	    Volume</div><div class="figure-contents"><div class="mediaobject"><img src="vinum-mirrored-vol.png" alt="A Mirrored vinum Volume" /></div></div></div><p><br class="figure-break" /></p><p>In this example, each plex contains the full 512 MB
	of address space.  As in the previous example, each plex
	contains only a single subdisk.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp47216120"></a>5.3. Optimizing Performance</h3></div></div></div><p>The mirrored volume in the previous example is more
	resistant to failure than an unmirrored volume, but its
	performance is less as each write to the volume requires a
	write to both drives, using up a greater proportion of the
	total disk bandwidth.  Performance considerations demand a
	different approach:  instead of mirroring, the data is striped
	across as many disk drives as possible.  The following
	configuration shows a volume with a plex striped across four
	disk drives:</p><pre class="programlisting">        drive c device /dev/da5h
	drive d device /dev/da6h
	volume stripe
	plex org striped 512k
	  sd length 128m drive a
	  sd length 128m drive b
	  sd length 128m drive c
	  sd length 128m drive d</pre><p>As before, it is not necessary to define the drives which
	are already known to <code class="filename">vinum</code>.  After
	processing this definition, the configuration looks
	like:</p><pre class="programlisting" width="92">
	Drives:         4 (4 configured)
	Volumes:        3 (4 configured)
	Plexes:         4 (8 configured)
	Subdisks:       7 (16 configured)

    D a                     State: up       Device /dev/da3h        Avail: 1421/2573 MB (55%)
    D b                     State: up       Device /dev/da4h        Avail: 1933/2573 MB (75%)
    D c                     State: up       Device /dev/da5h        Avail: 2445/2573 MB (95%)
    D d                     State: up       Device /dev/da6h        Avail: 2445/2573 MB (95%)

    V myvol                 State: up       Plexes:       1 Size:        512 MB
    V mirror                State: up       Plexes:       2 Size:        512 MB
    V striped               State: up       Plexes:       1 Size:        512 MB

    P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p0           C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p1           C State: initializing     Subdisks:     1 Size:        512 MB
    P striped.p1            State: up       Subdisks:     1 Size:        512 MB

    S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB
    S mirror.p0.s0          State: up       PO:        0  B Size:        512 MB
    S mirror.p1.s0          State: empty    PO:        0  B Size:        512 MB
    S striped.p0.s0         State: up       PO:        0  B Size:        128 MB
    S striped.p0.s1         State: up       PO:      512 kB Size:        128 MB
    S striped.p0.s2         State: up       PO:     1024 kB Size:        128 MB
    S striped.p0.s3         State: up       PO:     1536 kB Size:        128 MB</pre><p>
	</p><div class="figure"><a id="vinum-striped-vol"></a><div class="figure-title">Figure 6. A Striped <code class="filename">vinum</code>
	    Volume</div><div class="figure-contents"><div class="mediaobject"><img src="vinum-striped-vol.png" alt="A Striped vinum Volume" /></div></div></div><p><br class="figure-break" /></p><p>This volume is represented in <a class="xref" href="vinum-examples.html#vinum-striped-vol" title="Figure 6. A Striped vinum Volume">Figure 6, &#8220;A Striped <code class="filename">vinum</code>
	    Volume&#8221;</a>.  The darkness of the
	stripes indicates the position within the plex address space,
	where the lightest stripes come first and the darkest
	last.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp47244024"></a>5.4. Resilience and Performance</h3></div></div></div><p><a id="vinum-resilience"></a>With sufficient hardware,
	it is possible to build volumes which show both increased
	resilience and increased performance compared to standard
	<span class="trademark">UNIX</span>® partitions.  A typical configuration file might
	be:</p><pre class="programlisting">	volume raid10
      plex org striped 512k
        sd length 102480k drive a
        sd length 102480k drive b
        sd length 102480k drive c
        sd length 102480k drive d
        sd length 102480k drive e
      plex org striped 512k
        sd length 102480k drive c
        sd length 102480k drive d
        sd length 102480k drive e
        sd length 102480k drive a
        sd length 102480k drive b</pre><p>The subdisks of the second plex are offset by two drives
	from those of the first plex.  This helps to ensure that
	writes do not go to the same subdisks even if a transfer goes
	over two drives.</p><p><a class="xref" href="vinum-examples.html#vinum-raid10-vol" title="Figure 7. A Mirrored, Striped vinum Volume">Figure 7, &#8220;A Mirrored, Striped <code class="filename">vinum</code>
	    Volume&#8221;</a> represents the
	structure of this volume.</p><p>
	</p><div class="figure"><a id="vinum-raid10-vol"></a><div class="figure-title">Figure 7. A Mirrored, Striped <code class="filename">vinum</code>
	    Volume</div><div class="figure-contents"><div class="mediaobject"><img src="vinum-raid10-vol.png" alt="A Mirrored, Striped vinum Volume" /></div></div></div><p><br class="figure-break" /></p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="vinum-objects.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="vinum-object-naming.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4. <code class="filename">vinum</code> Objects </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6. Object Naming</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>