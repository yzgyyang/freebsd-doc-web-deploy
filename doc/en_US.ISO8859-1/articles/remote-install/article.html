<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>Remote Installation of the FreeBSD Operating System Without a Remote Console</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><meta name="description" content="This article documents the remote installation of the FreeBSD operating system when the console of the remote system is unavailable. The main idea behind this article is the result of a collaboration with Martin Matuska mm@FreeBSD.org with valuable input provided by Pawe&#322; Jakub Dawidek pjd@FreeBSD.org." /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div xml:lang="en" class="article" lang="en"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp44029688"></a>Remote Installation of the FreeBSD Operating System Without a
      Remote Console</h1></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="author"><h3 class="author"><span class="firstname">Daniel</span> <span class="surname">Gerzo</span></h3><div class="affiliation"><div class="address"><p><br />
	  <code class="email">&lt;<a xmlns="" class="email" href="mailto:danger@FreeBSD.org">danger@FreeBSD.org</a>&gt;</code><br />
	</p></div></div></div></div><div>Revision: <a href="https://svnweb.freebsd.org/changeset/doc/0b702c5af4"><span class="svnref">0b702c5af4</span></a></div><div><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2008 The FreeBSD Documentation Project</p></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="legalnotice"><a id="trademarks"></a><p>FreeBSD is a registered trademark of
  the FreeBSD Foundation.</p><p>Many of the designations used by
  manufacturers and sellers to distinguish their products are claimed
  as trademarks.  Where those designations appear in this document,
  and the FreeBSD Project was aware of the trademark claim, the
  designations have been followed by the <span class="quote">&#8220;<span class="quote">&#8482;</span>&#8221;</span> or the
  <span class="quote">&#8220;<span class="quote">®</span>&#8221;</span> symbol.</p></div></div><div>Last modified on 2017-12-30 22:56:56 +0000 by eadler.</div><div><div xmlns="http://www.w3.org/1999/xhtml" class="abstract"><div class="abstract-title">Abstract</div><p>This article documents the remote installation of the FreeBSD
	operating system when the console of the remote system is
	unavailable.  The main idea behind this article is the result
	of a collaboration with Martin Matuska <code class="email">&lt;<a xmlns="" class="email" href="mailto:mm@FreeBSD.org">mm@FreeBSD.org</a>&gt;</code> with valuable input
	provided by Pawe&#322; Jakub Dawidek <code class="email">&lt;<a xmlns="" class="email" href="mailto:pjd@FreeBSD.org">pjd@FreeBSD.org</a>&gt;</code>.</p></div></div></div><div class="docformatnavi">
      [
      <a href="index.html">Split HTML</a>
      /
      
	  Single HTML
	
      ]
    </div><hr /></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#background">1. Background</a></span></dt><dt><span class="sect1"><a href="#intro">2. Introduction</a></span></dt><dt><span class="sect1"><a href="#preparation">3. Preparation - <span class="application">mfsBSD</span></a></span></dt><dt><span class="sect1"><a href="#installation">4. Installation of the FreeBSD Operating System</a></span></dt><dt><span class="sect1"><a href="#zfs">5. ZFS</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="background"></a>1. Background</h2></div></div></div><p>There are many server hosting providers in the world, but
      very few of them are officially supporting FreeBSD.  They usually
      provide support for a <span class="trademark">Linux</span>® distribution to be installed on
      the servers they offer.</p><p>In some cases, these companies will install your preferred
      <span class="trademark">Linux</span>® distribution if you request it.  Using this option, we
      will attempt to install FreeBSD.  In other cases, they may offer a
      rescue system which would be used in an emergency.  It is
      possible to use this for our purposes as well.</p><p>This article covers the basic installation and configuration
      steps required to bootstrap a remote installation of FreeBSD with
      RAID-1 and <span class="application">ZFS</span> capabilities.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="intro"></a>2. Introduction</h2></div></div></div><p>This section will summarize the purpose of this article and
      better explain what is covered herein.  The instructions
      included in this article will benefit those using services
      provided by colocation facilities not supporting FreeBSD.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>As we have mentioned in the <a class="link" href="#background" title="1. Background">Background</a> section, many of
	  the reputable server hosting companies provide some kind of
	  rescue system, which is booted from their
	  <acronym class="acronym">LAN</acronym> and accessible over
	  <span class="application">SSH</span>.  They usually provide this
	  support in order to help their customers fix broken
	  operating systems.  As this article will explain, it is
	  possible to install FreeBSD with the help of these rescue
	  systems.</p></li><li class="step"><p>The next section of this article will describe how to
	  configure, and build minimalistic FreeBSD on the local machine.
	  That version will eventually be running on the remote
	  machine from a ramdisk, which will allow us to install a
	  complete FreeBSD operating system from an
	  <acronym class="acronym">FTP</acronym> mirror using the
	  <span class="application">sysinstall</span> utility.</p></li><li class="step"><p>The rest of this article will describe the installation
	  procedure itself, as well as the configuration of the
	  <span class="application">ZFS</span> file system.</p></li></ol></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="requirements"></a>2.1. Requirements</h3></div></div></div><p>To continue successfully, you must:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Have a network accessible operating system with
	    <span class="application">SSH</span> access</p></li><li class="listitem"><p>Understand the FreeBSD installation process</p></li><li class="listitem"><p>Be familiar with the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> utility</p></li><li class="listitem"><p>Have the FreeBSD installation <acronym class="acronym">ISO</acronym>
	    image or <acronym class="acronym">CD</acronym> handy</p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="preparation"></a>3. Preparation - <span class="application">mfsBSD</span></h2></div></div></div><p>Before FreeBSD may be installed on the target system, it is
      necessary to build the minimal FreeBSD operating system image which
      will boot from the hard drive.  This way the new system can be
      accessed from the network, and the rest of the installation can
      be done without remote access to the system console.</p><p>The <span class="application">mfsBSD</span> tool-set can be used
      to build a tiny FreeBSD image.  As the name of
      <span class="application">mfsBSD</span> suggests (<span class="quote">&#8220;<span class="quote">mfs</span>&#8221;</span>
      means <span class="quote">&#8220;<span class="quote">memory file system</span>&#8221;</span>), the resulting image
      runs entirely from a ramdisk.  Thanks to this feature, the
      manipulation of hard drives will not be limited, therefore it
      will be possible to install a complete FreeBSD operating system.
      The <span class="application">mfsBSD</span> <code class="uri"><a class="uri" href="http://mfsbsd.vx.sk/" target="_top">home page</a></code>
      includes pointers to the latest release of the toolset.</p><p>Please note that the internals of
      <span class="application">mfsBSD</span> and how it all fits together
      is beyond the scope of this article.  The interested reader
      should consult the original documentation of
      <span class="application">mfsBSD</span> for more details.</p><p>Download and extract the latest
      <span class="application">mfsBSD</span> release and change your
      working directory to the directory where the
      <span class="application">mfsBSD</span> scripts will reside:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fetch http://mfsbsd.vx.sk/release/mfsbsd-<em class="replaceable"><code>2.1</code></em>.tar.gz</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar xvzf mfsbsd-<em class="replaceable"><code>2.1</code></em>.tar.gz</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd mfsbsd-<em class="replaceable"><code>2.1</code></em>/</code></strong></pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mfsbsd-config"></a>3.1. Configuration of
	<span class="application">mfsBSD</span></h3></div></div></div><p>Before booting <span class="application">mfsBSD</span>, a few
	important configuration options have to be set.  The most
	important that we have to get right is, naturally, the network
	setup.  The most suitable method to configure networking
	options depends on whether we know beforehand the type of the
	network interface we will use, and the network interface
	driver to be loaded for our hardware.  We will see how
	<span class="application">mfsBSD</span> can be configured in either
	case.</p><p>Another important thing to set is the <code class="systemitem">root</code> password.  This can be
	done by editing <code class="filename">conf/loader.conf</code>.  Please
	see the included comments.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp45044344"></a>3.1.1. The <code class="filename">conf/interfaces.conf</code>
	  method</h4></div></div></div><p>When the installed network interface card is unknown, it
	  is possible to use the auto-detection features of
	  <span class="application">mfsBSD</span>.  The startup scripts of
	  <span class="application">mfsBSD</span> can detect the correct
	  driver to use, based on the MAC address of the interface, if
	  we set the following options in
	  <code class="filename">conf/interfaces.conf</code>:</p><pre class="programlisting">mac_interfaces="ext1"
ifconfig_ext1_mac="00:00:00:00:00:00"
ifconfig_ext1="inet 192.168.0.2/24"</pre><p>Do not forget to add the
	  <code class="literal">defaultrouter</code> information to
	  <code class="filename">conf/rc.conf</code>:</p><pre class="programlisting">defaultrouter="192.168.0.1"</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp45056248"></a>3.1.2. The <code class="filename">conf/rc.conf</code> Method</h4></div></div></div><p>When the network interface driver is known, it is more
	  convenient to use <code class="filename">conf/rc.conf</code> for
	  networking options.  The syntax of this file is the same as
	  the one used in the standard <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> file of
	  FreeBSD.</p><p>For example, if you know that a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=re&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">re</span>(4)</span></a> network
	  interface is going to be available, you can set the
	  following options in
	  <code class="filename">conf/rc.conf</code>:</p><pre class="programlisting">defaultrouter="192.168.0.1"
ifconfig_re0="inet 192.168.0.2/24"</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mfsbsd-build"></a>3.2. Building an <span class="application">mfsBSD</span>
	Image</h3></div></div></div><p>The process of building an
	<span class="application">mfsBSD</span> image is pretty
	straightforward.</p><p>The first step is to mount the FreeBSD installation
	<acronym class="acronym">CD</acronym>, or the installation
	<acronym class="acronym">ISO</acronym> image to <code class="filename">/cdrom</code>.
	For the sake of example, in this article we will assume that
	you have downloaded the FreeBSD 10.1-RELEASE
	<acronym class="acronym">ISO</acronym>.  Mounting this ISO image to the
	<code class="filename">/cdrom</code> directory is easy with the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> utility:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -u 10 -f <em class="replaceable"><code>FreeBSD-10.1-RELEASE-amd64-disc1.iso</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount_cd9660 /dev/md10 /cdrom</code></strong></pre><p>Since the recent FreeBSD releases do not contain regular
	distribution sets, it is required to extract the FreeBSD distribution
	files from the distribution archives located on the
	<acronym class="acronym">ISO</acronym> image:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir <em class="replaceable"><code>DIST</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar -xvf /cdrom/usr/freebsd-dist/base.txz -C <em class="replaceable"><code>DIST</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar -xvf /cdrom/usr/freebsd-dist/kernel.txz -C <em class="replaceable"><code>DIST</code></em></code></strong></pre><p>Next, build the bootable <span class="application">mfsBSD</span>
	image:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make BASE=<em class="replaceable"><code>DIST</code></em></code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The above <code class="command">make</code> has to be run from the
	  top level of the <span class="application">mfsBSD</span> directory
	  tree, for example
	  <code class="filename">~/mfsbsd-2.1/</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp45128440"></a>3.3. Booting <span class="application">mfsBSD</span></h3></div></div></div><p>Now that the <span class="application">mfsBSD</span> image is
	ready, it must be uploaded to the remote system running a live
	rescue system or pre-installed <span class="trademark">Linux</span>® distribution.  The most
	suitable tool for this task is
	<span class="application">scp</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>scp disk.img root@192.168.0.2:.</code></strong></pre><p>To boot <span class="application">mfsBSD</span> image properly,
	it must be placed on the first (bootable) device of the given
	machine.  This may be accomplished using this example
	providing that <code class="filename">sda</code> is the first bootable
	disk device:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/root/disk.img of=/dev/sda bs=1m</code></strong></pre><p>If all went well, the image should now be in the
	<acronym class="acronym">MBR</acronym> of the first device and the machine can
	be rebooted.  Watch for the machine to boot up properly with
	the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> tool.  Once it has came back on-line, it
	should be possible to access it over <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> as user
	<code class="systemitem">root</code> with the
	configured password.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="installation"></a>4. Installation of the FreeBSD Operating System</h2></div></div></div><p>The <span class="application">mfsBSD</span> has been successfully
      booted and it should be possible to log in through <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>.
      This section will describe how to create and label slices, set
      up <span class="application">gmirror</span> for RAID-1, and how to use
      <span class="application">sysinstall</span> to install a minimal
      distribution of the FreeBSD operating system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp45185144"></a>4.1. Preparation of Hard Drives</h3></div></div></div><p>The first task is to allocate disk space for FreeBSD, i.e.:
	to create slices and partitions.  Obviously, the currently
	running system is fully loaded in system memory and therefore
	there will be no problems with manipulating hard drives.  To
	complete this task, it is possible to use either
	<span class="application">sysinstall</span> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fdisk</span>(8)</span></a> in
	conjunction to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>.</p><p>At the start, mark all system disks as empty.  Repeat the
	following command for each hard drive:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/<em class="replaceable"><code>ad0</code></em> count=2</code></strong></pre><p>Next, create slices and label them with your preferred
	tool.  While it is considered easier to use
	<span class="application">sysinstall</span>, a powerful and also
	probably less buggy method will be to use standard text-based
	<span class="trademark">UNIX</span>® tools, such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fdisk</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>,
	which will also be covered in this section.  The former option
	is well documented in the <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/install-steps.html" target="_top">Installing
	  FreeBSD</a> chapter of the FreeBSD Handbook.  As it was
	mentioned in the introduction, this article will present how
	to set up a system with RAID-1 and
	<span class="application">ZFS</span> capabilities.  Our set up will
	consist of a small <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> mirrored
	<code class="filename">/</code> (root), <code class="filename">/usr</code> and
	<code class="filename">/var</code> dataset, and the rest of the disk
	space will be allocated for a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> mirrored
	<span class="application">ZFS</span> file system.  Please note, that
	the <span class="application">ZFS</span> file system will be
	configured after the FreeBSD operating system is successfully
	installed and booted.</p><p>The following example will describe how to create slices
	and labels, initialize <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> on each partition and
	how to create a <span class="application">UFS2</span> file system in
	each mirrored partition:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fdisk -BI /dev/ad0</code></strong> <a id="fdisk"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>fdisk -BI /dev/ad1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -wB /dev/ad0s1</code></strong> <a id="bsdlabel-writing"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -wB /dev/ad1s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -e /dev/ad0s1</code></strong> <a id="bsdlabel-editing"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel /dev/ad0s1 &gt; /tmp/bsdlabel.txt &amp;&amp; bsdlabel -R /dev/ad1s1 /tmp/bsdlabel.txt</code></strong> <a id="bsdlabel-restore"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>gmirror label root /dev/ad[01]s1a</code></strong> <a id="gmirror1"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>gmirror label var /dev/ad[01]s1d</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gmirror label usr /dev/ad[01]s1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gmirror label -F swap /dev/ad[01]s1b</code></strong> <a id="gmirror2"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/mirror/root</code></strong> <a id="newfs"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/mirror/var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/mirror/usr</code></strong></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#fdisk"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Create a slice covering the entire disk and initialize
	    the boot code contained in sector 0 of the given disk.
	    Repeat this command for all hard drives in the
	    system.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#bsdlabel-writing"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Write a standard label for each disk including the
	    bootstrap code.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#bsdlabel-editing"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Now, manually edit the label of the given disk.  Refer
	    to the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> manual page in order to find out
	    how to create partitions.  Create partitions
	    <code class="literal">a</code> for <code class="filename">/</code> (root)
	    file system, <code class="literal">b</code> for swap,
	    <code class="literal">d</code> for <code class="filename">/var</code>,
	    <code class="literal">e</code> for <code class="filename">/usr</code> and
	    finally <code class="literal">f</code> which will later be used for
	    <span class="application">ZFS</span>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#bsdlabel-restore"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Import the recently created label for the second hard
	    drive, so both hard drives will be labeled in the same
	    way.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#gmirror1"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Initialize <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> on each partition.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#gmirror2"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Note that <code class="option">-F</code> is used for the swap
	    partition.  This instructs <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> to assume that
	    the device is in the consistent state after the
	    power/system failure.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#newfs"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Create a <span class="application">UFS2</span> file system
	    on each mirrored partition.</p></td></tr></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp45339128"></a>4.2. System Installation</h3></div></div></div><p>This is the most important part.  This section will
	describe how to actually install the minimal distribution of
	FreeBSD on the hard drives that we have prepared in the previous
	section.  To accomplish this goal, all file systems need to be
	mounted so <span class="application">sysinstall</span> may write the
	contents of FreeBSD to the hard drives:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/root /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /mnt/var /mnt/usr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/var /mnt/var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/usr /mnt/usr</code></strong></pre><p>When you are done, start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a>.  Select the
	<span class="guimenuitem">Custom</span> installation from the main
	menu.  Select <span class="guimenuitem">Options</span> and press
	<span class="keycap"><strong>Enter</strong></span>.  With the help of arrow keys, move the
	cursor on the <code class="literal">Install Root</code> item, press
	<span class="keycap"><strong>Space</strong></span> and change it to
	<code class="filename">/mnt</code>.  Press
	<span class="keycap"><strong>Enter</strong></span> to submit your changes and exit the
	<span class="guimenuitem">Options</span> menu by pressing
	<span class="keycap"><strong>q</strong></span>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Note that this step is very important and if skipped,
	  <span class="application">sysinstall</span> will be unable to
	  install FreeBSD.</p></div><p>Go to the <span class="guimenuitem">Distributions</span> menu,
	move the cursor with the arrow keys to
	<code class="option">Minimal</code>, and check it by pressing
	<span class="keycap"><strong>Space</strong></span>.  This article uses the Minimal
	distribution in order to save network traffic, because the
	system itself will be installed over
	<span class="application">ftp</span>.  Exit this menu by choosing
	<code class="option">Exit</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <span class="guimenuitem">Partition</span> and
	  <span class="guimenuitem">Label</span> menus will be skipped, as
	  these are useless now.</p></div><p>In the <span class="guimenuitem">Media</span> menu, select
	<code class="option">FTP</code>.  Select the nearest mirror and let
	<span class="application">sysinstall</span> assume that the network
	is already configured.  You will be returned back to the
	<span class="guimenuitem">Custom</span> menu.</p><p>Finally, perform the system installation by selecting the
	last option, <span class="guimenuitem">Commit</span>.  Exit
	<span class="application">sysinstall</span> when it finishes the
	installation.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp45393272"></a>4.3. Post Installation Steps</h3></div></div></div><p>The FreeBSD operating system should be installed now;
	however, the process is not finished yet.  It is necessary to
	perform some post installation steps in order to allow FreeBSD to
	boot in the future and to be able to log in to the
	system.</p><p>You must now <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(8)</span></a> into the freshly installed
	system in order to finish the installation.  Use the following
	command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chroot /mnt</code></strong></pre><p>To complete our goal, perform these steps:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Copy the <code class="literal">GENERIC</code> kernel to the
	    <code class="filename">/boot/kernel</code>
	    directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp -Rp /boot/GENERIC/* /boot/kernel</code></strong></pre></li><li class="listitem"><p>Create the <code class="filename">/etc/rc.conf</code>,
	    <code class="filename">/etc/resolv.conf</code> and
	    <code class="filename">/etc/fstab</code> files.  Do not forget to
	    properly set the network information and to enable
	    <span class="application">sshd</span> in
	    <code class="filename">/etc/rc.conf</code>.  The contents of
	    <code class="filename">/etc/fstab</code> will be similar to the
	    following:</p><pre class="programlisting"># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/mirror/swap        none            swap    sw              0       0
/dev/mirror/root        /               ufs     rw              1       1
/dev/mirror/usr         /usr            ufs     rw              2       2
/dev/mirror/var         /var            ufs     rw              2       2
/dev/cd0                /cdrom          cd9660  ro,noauto       0       0</pre></li><li class="listitem"><p>Create <code class="filename">/boot/loader.conf</code> with the
	    following contents:</p><pre class="programlisting">geom_mirror_load="YES"
zfs_load="YES"</pre></li><li class="listitem"><p>Perform the following command, which will make
	    <span class="application">ZFS</span> available on the next
	    boot:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'zfs_enable="YES"' &gt;&gt; /etc/rc.conf </code></strong></pre></li><li class="listitem"><p>Add additional users to the system using the
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a> tool.  Do not forget to add a user to the
	    <code class="systemitem">wheel</code> group so
	    you may obtain root access after the reboot.</p></li><li class="listitem"><p>Double-check all your settings.</p></li></ul></div><p>The system should now be ready for the next boot.  Use the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=reboot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">reboot</span>(8)</span></a> command to reboot your system.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs"></a>5. ZFS</h2></div></div></div><p>If your system survived the reboot, it should now be
      possible to log in.  Welcome to the fresh FreeBSD installation,
      performed remotely without the use of a remote console!</p><p>The only remaining step is to configure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> and
      create some <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zfs</span>(8)</span></a> file systems.  Creating and
      administering <span class="application">ZFS</span> is very
      straightforward.  First, create a mirrored pool:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create tank mirror /dev/ad[01]s1f</code></strong></pre><p>Next, create some file systems:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create tank/ports</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs create tank/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip tank/ports</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=on tank/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set mountpoint=/usr/ports tank/ports</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set mountpoint=/usr/src tank/src</code></strong></pre><p>That is all.  If you are interested in more details about
      <span class="application">ZFS</span> on FreeBSD, please refer to the
      <a class="link" href="https://wiki.freebsd.org/ZFS" target="_top">ZFS</a>
      section of the FreeBSD Wiki.</p></div></div></body></html>