<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>3. Final Preparation</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Filtering Bridges" /><link rel="up" href="index.html" title="Filtering Bridges" /><link rel="prev" href="filtering-bridges-how.html" title="2. How to Install" /><link rel="next" href="filtering-bridges-enabling.html" title="4. Enabling the Bridge" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. Final Preparation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="filtering-bridges-how.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="filtering-bridges-enabling.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filtering-bridges-finalprep"></a>3. Final Preparation</h2></div></div></div><p>Before rebooting in order to load the new kernel or the required
      modules (according to the previously chosen installation method), you
      have to make some changes to the <code class="filename">/etc/rc.conf</code>
      configuration file. The default rule of the firewall is to reject all IP
      packets.  Initially we will set up an <code class="option">open</code> firewall, in order to verify
      its operation without any issue related to packet filtering (in case you
      are going to execute this procedure remotely, such configuration will
      avoid you to remain isolated from the network). Put these lines in
      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">firewall_enable="YES"
firewall_type="open"
firewall_quiet="YES"
firewall_logging="YES"</pre><p>The first row will enable the firewall (and will load the module
      <code class="filename">ipfw.ko</code> if it is not compiled in the kernel), the
      second one to set up it in <code class="option">open</code> mode (as explained in
      <code class="filename">/etc/rc.firewall</code>), the third one to not show rules
      loading and the fourth one to enable logging support.</p><p>About the configuration of the network interfaces, the most used way
      is to assign an IP to only one of the network cards, but the bridge will
      work equally even if both interfaces or none has a configured IP. In the
      last case (IP-less) the bridge machine will be still more hidden, as
      inaccessible from the network: to configure it, you have to login from
      console or through a third network interface separated from the bridge.
      Sometimes, during the system startup, some programs require network
      access, say for domain resolution: in this case it is necessary to
      assign an IP to the external interface (the one connected to Internet,
      where <acronym class="acronym">DNS</acronym> server resides), since the bridge will be
      activated at the end of the startup procedure. It means that the
      <code class="filename">fxp0</code> interface (in our case) must be mentioned
      in the ifconfig section of the <code class="filename">/etc/rc.conf</code> file,
      while the <code class="filename">xl0</code> is not. Assigning an IP to both
      the network cards does not make much sense, unless, during the start
      procedure, applications should access to services on both Ethernet
      segments.</p><p>There is another important thing to know. When running IP over
      Ethernet, there are actually two Ethernet protocols in use: one is IP,
      the other is <acronym class="acronym">ARP</acronym>.  <acronym class="acronym">ARP</acronym> does the
      conversion of the IP address of a host into its Ethernet address
      (<acronym class="acronym">MAC</acronym> layer).  In order to allow the communication
      between two hosts separated by the bridge, it is necessary that the
      bridge will forward <acronym class="acronym">ARP</acronym> packets. Such protocol is not
      included in the IP layer, since it exists only with IP over Ethernet.
      The FreeBSD firewall filters exclusively on the IP layer and therefore
      all non-IP packets (<acronym class="acronym">ARP</acronym> included) will be forwarded
      without being filtered, even if the firewall is configured to not permit
      anything.</p><p>Now it is time to reboot the system and use it as before: there will
      be some new messages about the bridge and the firewall, but the bridge
      will not be activated and the firewall, being in <code class="option">open</code> mode, will not
      avoid any operations.</p><p>If there are any problems, you should sort them out now
      before proceeding.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="filtering-bridges-how.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="filtering-bridges-enabling.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2. How to Install </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 4. Enabling the Bridge</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>