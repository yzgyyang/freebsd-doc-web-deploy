<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>3. A dummy script</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Practical rc.d scripting in BSD" /><link rel="up" href="index.html" title="Practical rc.d scripting in BSD" /><link rel="prev" href="rcng-task.html" title="2. Outlining the task" /><link rel="next" href="rcng-confdummy.html" title="4. A configurable dummy script" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. A dummy script</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="rcng-task.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="rcng-confdummy.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="rcng-dummy"></a>3. A dummy script</h2></div></div></div><p>The following script just emits a message each time the
      system boots up:</p><div class="informalexample"><pre class="programlisting">#!/bin/sh<a id="rcng-dummy-shebang"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>

. /etc/rc.subr<a id="rcng-dummy-include"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>

name="dummy"<a id="rcng-dummy-name"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
start_cmd="${name}_start"<a id="rcng-dummy-startcmd"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
stop_cmd=":"<a id="rcng-dummy-stopcmd"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>

dummy_start()<a id="rcng-dummy-startfn"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
{
	echo "Nothing started."
}

load_rc_config $name<a id="rcng-dummy-loadconfig"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
run_rc_command "$1"<a id="rcng-dummy-runcommand"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></pre></div><p>Things to note are:</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#rcng-dummy-shebang"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>An interpreted script should begin with the magic
	  <span class="quote">&#8220;<span class="quote">shebang</span>&#8221;</span> line.  That line specifies the
	  interpreter program for the script.  Due to the shebang
	  line, the script can be invoked exactly like a binary
	  program provided that it has the execute bit set.
	  (See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a>.)
	  For example, a system admin can run our script manually,
	  from the command line:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/dummy start</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In order to be properly managed by the
	    <code class="filename">rc.d</code> framework, its scripts need
	    to be written in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> language.  If you have
	    a service or port that uses a binary control utility
	    or a startup routine written in another language,
	    install that element in <code class="filename">/usr/sbin</code>
	    (for the system) or <code class="filename">/usr/local/sbin</code>
	    (for ports) and call it from a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> script in the
	    appropriate <code class="filename">rc.d</code> directory.</p></div><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">If you would like to learn the details of why
	    <code class="filename">rc.d</code> scripts must be written in
	    the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> language, see how <code class="filename">/etc/rc</code>
	    invokes them by means of <code class="function">run_rc_script</code>,
	    then study the implementation of
	    <code class="function">run_rc_script</code> in
	    <code class="filename">/etc/rc.subr</code>.</p></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#rcng-dummy-include"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>In <code class="filename">/etc/rc.subr</code>, a number of
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> functions are defined for an <code class="filename">rc.d</code>
	  script to use.  The functions are documented in
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>.  While it is theoretically possible to
	  write an <code class="filename">rc.d</code> script without ever
	  using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>, its functions prove extremely handy
	  and make the job an order of magnitude easier.  So it is
	  no surprise that everybody resorts to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> in
	  <code class="filename">rc.d</code> scripts.  We are not going to
	  be an exception.</p><p>An <code class="filename">rc.d</code> script must
	  <span class="quote">&#8220;<span class="quote">source</span>&#8221;</span> <code class="filename">/etc/rc.subr</code>
	  (include it using <span class="quote">&#8220;<span class="quote"><code class="command">.</code></span>&#8221;</span>)
	  <span class="emphasis"><em>before</em></span> it calls <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>
	  functions so that <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> has an opportunity to learn
	  the functions.  The preferred style is to source
	  <code class="filename">/etc/rc.subr</code> first of all.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some useful functions related to networking
	    are provided by another include file,
	    <code class="filename">/etc/network.subr</code>.</p></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#rcng-dummy-name"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p><a id="name-var"></a>The mandatory variable
	  <code class="envar">name</code> specifies the name of our script.  It
	  is required by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>.  That is, each
	  <code class="filename">rc.d</code> script <span class="emphasis"><em>must</em></span>
	  set <code class="envar">name</code> before it calls <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>
	  functions.</p><p>Now it is the right time to choose a unique name for
	  our script once and for all.  We will use it in a number
	  of places while developing the script.  For a start, let
	  us give the same name to the script file, too.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The current style of <code class="filename">rc.d</code>
	    scripting is to enclose values assigned to variables
	    in double quotes.  Keep in mind that it is just a style
	    issue that may not always be applicable.  You can
	    safely omit quotes from around simple words without
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> metacharacters in them, while in certain
	    cases you will need single quotes to prevent any
	    interpretation of the value by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a>.  A programmer
	    should be able to tell the language syntax from style
	    conventions and use both of them wisely.</p></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#rcng-dummy-startcmd"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The main idea behind <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> is that an
	  <code class="filename">rc.d</code> script provides handlers, or
	  methods, for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> to invoke.  In particular,
	  <code class="option">start</code>, <code class="option">stop</code>, and other
	  arguments to an <code class="filename">rc.d</code> script are
	  handled this way.  A method is a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> expression
	  stored in a variable named
	  <code class="envar"><em class="replaceable"><code>argument</code></em>_cmd</code>,
	  where <em class="replaceable"><code>argument</code></em> corresponds to
	  what can be specified on the script's command line.  We
	  will see later how <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> provides default methods
	  for the standard arguments.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">To make the code in <code class="filename">rc.d</code> more
	    uniform, it is common to use <code class="envar">${name}</code>
	    wherever appropriate.  Thus a number of lines can be just
	    copied from one script to another.</p></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#rcng-dummy-stopcmd"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>We should keep in mind that <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> provides
	  default methods for the standard arguments.  Consequently,
	  we must override a standard method with a no-op <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a>
	  expression if we want it to do nothing.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#rcng-dummy-startfn"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The body of a sophisticated method can be implemented
	  as a function.  It is a good idea to make the function
	  name meaningful.</p><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is strongly recommended to add the prefix
	    <code class="envar">${name}</code> to the names of all functions
	    defined in our script so they never clash with the
	    functions from <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> or another common include
	    file.</p></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#rcng-dummy-loadconfig"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This call to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> loads <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
	  variables.  Our script makes no use of them yet, but it
	  still is recommended to load <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> because there
	  can be <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> variables controlling <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>
	  itself.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#rcng-dummy-runcommand"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Usually this is the last command in an
	  <code class="filename">rc.d</code> script.  It invokes the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> machinery to perform the requested action
	  using the variables and methods our script has provided.</p></td></tr></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="rcng-task.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="rcng-confdummy.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2. Outlining the task </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 4. A configurable dummy script</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>