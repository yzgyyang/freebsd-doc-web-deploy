<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>5. Startup and shutdown of a simple daemon</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Practical rc.d scripting in BSD" /><link rel="up" href="index.html" title="Practical rc.d scripting in BSD" /><link rel="prev" href="rcng-confdummy.html" title="4. A configurable dummy script" /><link rel="next" href="rcng-daemon-adv.html" title="6. Startup and shutdown of an advanced daemon" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Startup and shutdown of a simple daemon</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="rcng-confdummy.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="rcng-daemon-adv.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="rcng-daemon"></a>5. Startup and shutdown of a simple daemon</h2></div></div></div><p>We said earlier that <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> could provide default
      methods.  Obviously, such defaults cannot be too general.
      They are suited for the common case of starting and shutting
      down a simple daemon program.  Let us assume now that we need
      to write an <code class="filename">rc.d</code> script for such a daemon
      called <code class="command">mumbled</code>.  Here it is:</p><div class="informalexample"><pre class="programlisting">#!/bin/sh

. /etc/rc.subr

name=mumbled
rcvar=mumbled_enable

command="/usr/sbin/${name}"<a id="rcng-daemon-basic-cmd"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>

load_rc_config $name
run_rc_command "$1"</pre></div><p>Pleasingly simple, isn't it?  Let us examine our little
      script.  The only new thing to note is as follows:</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#rcng-daemon-basic-cmd"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="envar">command</code> variable is meaningful to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>.  If it is set, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> will act
	  according to the scenario of serving a conventional daemon.
	  In particular, the default methods will be provided for
	  such arguments: <code class="option">start</code>, <code class="option">stop</code>,
	  <code class="option">restart</code>, <code class="option">poll</code>, and
	  <code class="option">status</code>.</p><p>The daemon will be started by running
	  <code class="envar">$command</code> with command-line flags specified
	  by <code class="envar">$mumbled_flags</code>.  Thus all the input
	  data for the default <code class="option">start</code> method are
	  available in the variables set by our script.  Unlike
	  <code class="option">start</code>, other methods may require additional
	  information about the process started.  For instance,
	  <code class="option">stop</code> must know the PID of the process
	  to terminate it.  In the present case, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>
	  will scan through the list of all processes, looking for
	  a process with its name equal to <code class="envar">$procname</code>.
	  The latter is another variable of meaning to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>,
	  and its value defaults to that of <code class="envar">command</code>.
	  In other words, when we set <code class="envar">command</code>,
	  <code class="envar">procname</code> is effectively set to the same
	  value.  This enables our script to kill the daemon and
	  to check if it is running in the first place.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some programs are in fact executable scripts.  The
	    system runs such a script by starting its interpreter
	    and passing the name of the script to it as a command-line
	    argument.  This is reflected in the list of processes,
	    which can confuse <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>.  You should additionally
	    set <code class="envar">command_interpreter</code> to let <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>
	    know the actual name of the process if <code class="envar">$command</code>
	    is a script.</p><p xmlns="http://www.w3.org/1999/xhtml">For each <code class="filename">rc.d</code> script, there
	    is an optional <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> variable that takes
	    precedence over <code class="envar">command</code>.  Its name is
	    constructed as follows: <code class="envar">${name}_program</code>,
	    where <code class="envar">name</code> is the mandatory variable we
	    discussed <a class="link" href="rcng-dummy.html#name-var">earlier</a>.
	    E.g., in this case it will be <code class="envar">mumbled_program</code>.
	    It is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> that arranges
	    <code class="envar">${name}_program</code> to override
	    <code class="envar">command</code>.</p><p xmlns="http://www.w3.org/1999/xhtml">Of course, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> will permit you to set
	    <code class="envar">${name}_program</code> from <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> or
	    the script itself even if <code class="envar">command</code> is
	    unset.  In that case, the special properties of
	    <code class="envar">${name}_program</code> are lost, and it becomes
	    an ordinary variable your script can use for its own
	    purposes.  However, the sole use of
	    <code class="envar">${name}_program</code> is discouraged because
	    using it together with <code class="envar">command</code> became
	    an idiom of <code class="filename">rc.d</code> scripting.</p></div><p>For more detailed information on default methods,
	  refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>.</p></td></tr></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="rcng-confdummy.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="rcng-daemon-adv.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4. A configurable dummy script </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6. Startup and shutdown of an advanced daemon</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>