<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>Chapter 13. Security</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Frequently Asked Questions for FreeBSD 11.X and 12.X" /><link rel="up" href="index.html" title="Frequently Asked Questions for FreeBSD 11.X and 12.X" /><link rel="prev" href="networking.html" title="Chapter 12. Networking" /><link rel="next" href="serial.html" title="Chapter 14. Serial Communications" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 13. Security</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="networking.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="serial.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security"></a>Chapter 13. Security</h1></div></div></div><div class="qandaset"><a id="idp52110712"></a><dl><dt>13.1. <a href="security.html#idp52110968">What is a sandbox?</a></dt><dt>13.2. <a href="security.html#idp52114296">What is securelevel?</a></dt><dt>13.3. <a href="security.html#idp52157304">What is this UID 0 toor account?  Have I been
	    compromised?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp52110968"></a><a id="sandbox"></a><p><strong>13.1.</strong></p></td><td align="left" valign="top"><p>What is a sandbox?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><span class="quote">&#8220;<span class="quote">Sandbox</span>&#8221;</span> is a security term.  It can
	    mean two things:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A process which is placed inside a set of virtual
		walls that are designed to prevent someone who breaks
		into the process from being able to break into the
		wider system.</p><p>The process is only able to run inside the walls.
		Since nothing the process does in regards to executing
		code is supposed to be able to breach the walls, a
		detailed audit of its code is not needed in order to
		be able to say certain things about its
		security.</p><p>The walls might be a user ID, for example.
		This is the definition used in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=security&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">security</span>(7)</span></a>
		and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=named&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">named</span>(8)</span></a> man pages.</p><p>Take the <code class="literal">ntalk</code> service, for
		example (see <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>).  This service used to run
		as user ID <code class="systemitem">root</code>.  Now it runs as
		user ID <code class="systemitem">tty</code>.  The <code class="systemitem">tty</code> user is a sandbox
		designed to make it more difficult for someone who has
		successfully hacked into the system via
		<code class="literal">ntalk</code> from being able to hack
		beyond that user ID.</p></li><li class="listitem"><p>A process which is placed inside a simulation of
		the machine.  It means that someone who is able to
		break into the process may believe that he can break
		into the wider machine but is, in fact, only breaking
		into a simulation of that machine and not modifying
		any real data.</p><p>The most common way to accomplish this is to build
		a simulated environment in a subdirectory and then run
		the processes in that directory chrooted so that
		<code class="filename">/</code> for that process is this
		directory, not the real <code class="filename">/</code> of the
		system).</p><p>Another common use is to mount an underlying file
		system read-only and then create a file system layer
		on top of it that gives a process a seemingly
		writeable view into that file system.  The process may
		believe it is able to write to those files, but only
		the process sees the effects &#8212; other processes
		in the system do not, necessarily.</p><p>An attempt is made to make this sort of sandbox so
		transparent that the user (or hacker) does not realize
		that he is sitting in it.</p></li></ul></div><p><span class="trademark">UNIX</span>® implements two core sandboxes.  One is at the
	    process level, and one is at the userid level.</p><p>Every <span class="trademark">UNIX</span>® process is completely firewalled off from
	    every other <span class="trademark">UNIX</span>® process.  One process cannot modify the
	    address space of another.</p><p>A <span class="trademark">UNIX</span>® process is owned by a particular userid.  If
	    the user ID is not the <code class="systemitem">root</code> user, it serves to
	    firewall the process off from processes owned by other
	    users.  The user ID is also used to firewall off
	    on-disk data.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp52114296"></a><a id="securelevel"></a><p><strong>13.2.</strong></p></td><td align="left" valign="top"><p>What is securelevel?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><code class="literal">securelevel</code> is a security
	    mechanism implemented in the kernel.  When the securelevel
	    is positive, the kernel restricts certain tasks; not even
	    the superuser (<code class="systemitem">root</code>) is allowed to do
	    them.  The securelevel mechanism limits the ability
	    to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Unset certain file flags, such as
		<code class="literal">schg</code> (the system immutable
		flag).</p></li><li class="listitem"><p>Write to kernel memory via
		<code class="filename">/dev/mem</code> and
		<code class="filename">/dev/kmem</code>.</p></li><li class="listitem"><p>Load kernel modules.</p></li><li class="listitem"><p>Alter firewall rules.</p></li></ul></div><p>To check the status of the securelevel on a running
	    system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl -n kern.securelevel</code></strong></pre><p>The output contains the current value of the
	    securelevel.  If it is greater than 0, at
	    least some of the securelevel's protections are
	    enabled.</p><p>The securelevel of a running system cannot be lowered
	    as this would defeat its purpose.  If a task requires that
	    the securelevel be non-positive, change the
	    <code class="varname">kern_securelevel</code> and
	    <code class="varname">kern_securelevel_enable</code> variables in
	    <code class="filename">/etc/rc.conf</code> and reboot.</p><p>For more information on securelevel and the specific
	    things all the levels do, consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Securelevel is not a silver bullet; it has many
	      known deficiencies.  More often than not, it provides a
	      false sense of security.</p><p xmlns="http://www.w3.org/1999/xhtml">One of its biggest problems is that in order for it
	      to be at all effective, all files used in the boot
	      process up until the securelevel is set must be
	      protected.  If an attacker can get the system to execute
	      their code prior to the securelevel being set (which
	      happens quite late in the boot process since some things
	      the system must do at start-up cannot be done at an
	      elevated securelevel), its protections are invalidated.
	      While this task of protecting all files used in the boot
	      process is not technically impossible, if it is
	      achieved, system maintenance will become a nightmare
	      since one would have to take the system down, at least
	      to single-user mode, to modify a configuration
	      file.</p><p xmlns="http://www.w3.org/1999/xhtml">This point and others are often discussed on the
	      mailing lists, particularly the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security" target="_top">FreeBSD security mailing list</a>.
	      Search the archives <a class="link" href="../../../../search/index.html" target="_top">here</a>
	      for an extensive discussion.  A more fine-grained
	      mechanism is preferred.</p></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp52157304"></a><a id="toor-account"></a><p><strong>13.3.</strong></p></td><td align="left" valign="top"><p>What is this UID 0 <code class="systemitem">toor</code> account?  Have I been
	    compromised?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Do not worry.  <code class="systemitem">toor</code> is an
	    <span class="quote">&#8220;<span class="quote">alternative</span>&#8221;</span> superuser account, where toor
	    is root spelled backwards.  It is intended to be used with
	    a non-standard shell so the default shell for <code class="systemitem">root</code> does not need to
	    change.  This is important as shells which are not part of
	    the base distribution, but are instead installed from
	    ports or packages, are installed in
	    <code class="filename">/usr/local/bin</code> which, by default,
	    resides on a different file system.  If <code class="systemitem">root</code>'s shell is located in
	    <code class="filename">/usr/local/bin</code> and the
	    file system
	    containing <code class="filename">/usr/local/bin</code>) is not
	    mounted, <code class="systemitem">root</code> will not be able to
	    log in to fix a problem and will have to reboot into
	    single-user mode in order to enter the path to a
	    shell.</p><p>Some people use <code class="systemitem">toor</code> for day-to-day
	    <code class="systemitem">root</code> tasks with
	    a non-standard shell, leaving <code class="systemitem">root</code>, with a standard
	    shell, for single-user mode or emergencies.  By default, a
	    user cannot log in using <code class="systemitem">toor</code> as it does not have a
	    password, so log in as <code class="systemitem">root</code> and set a password
	    for <code class="systemitem">toor</code> before
	    using it to login.</p></td></tr></tbody></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="networking.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="serial.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 12. Networking </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 14. Serial Communications</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>