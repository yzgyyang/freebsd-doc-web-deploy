<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>Chapter 6. Special Considerations</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="prev" href="binary-alias.html" title="5.17. Use BINARY_ALIAS to Rename Commands Instead of Patching the Build" /><link rel="next" href="bundled-libs.html" title="6.2. Bundled Libraries" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 6. Special Considerations</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="binary-alias.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="bundled-libs.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="special"></a>Chapter 6. Special Considerations</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="special.html#staging">6.1. Staging</a></span></dt><dt><span class="sect1"><a href="bundled-libs.html">6.2. Bundled Libraries</a></span></dt><dt><span class="sect1"><a href="porting-shlibs.html">6.3. Shared Libraries</a></span></dt><dt><span class="sect1"><a href="porting-restrictions.html">6.4. Ports with Distribution Restrictions or Legal
      Concerns</a></span></dt><dt><span class="sect1"><a href="building.html">6.5. Building Mechanisms</a></span></dt><dt><span class="sect1"><a href="using-autotools.html">6.6. Using GNU Autotools</a></span></dt><dt><span class="sect1"><a href="using-gettext.html">6.7. Using GNU <code class="literal">gettext</code></a></span></dt><dt><span class="sect1"><a href="using-perl.html">6.8. Using <span class="application">Perl</span></a></span></dt><dt><span class="sect1"><a href="using-x11.html">6.9. Using X11</a></span></dt><dt><span class="sect1"><a href="using-gnome.html">6.10. Using GNOME</a></span></dt><dt><span class="sect1"><a href="gnome-components.html">6.11. GNOME Components</a></span></dt><dt><span class="sect1"><a href="using-qt.html">6.12. Using Qt</a></span></dt><dt><span class="sect1"><a href="using-kde.html">6.13. Using KDE</a></span></dt><dt><span class="sect1"><a href="using-lxqt.html">6.14. Using LXQt</a></span></dt><dt><span class="sect1"><a href="using-java.html">6.15. Using Java</a></span></dt><dt><span class="sect1"><a href="using-php.html">6.16. Web Applications, Apache and PHP</a></span></dt><dt><span class="sect1"><a href="using-python.html">6.17. Using Python</a></span></dt><dt><span class="sect1"><a href="using-tcl.html">6.18. Using <span class="application">Tcl/Tk</span></a></span></dt><dt><span class="sect1"><a href="using-ruby.html">6.19. Using Ruby</a></span></dt><dt><span class="sect1"><a href="using-sdl.html">6.20. Using SDL</a></span></dt><dt><span class="sect1"><a href="using-wx.html">6.21. Using <span class="application">wxWidgets</span></a></span></dt><dt><span class="sect1"><a href="using-lua.html">6.22. Using <span class="application">Lua</span></a></span></dt><dt><span class="sect1"><a href="using-iconv.html">6.23. Using <code class="command">iconv</code></a></span></dt><dt><span class="sect1"><a href="using-xfce.html">6.24. Using Xfce</a></span></dt><dt><span class="sect1"><a href="using-databases.html">6.25. Using Databases</a></span></dt><dt><span class="sect1"><a href="rc-scripts.html">6.26. Starting and Stopping Services (<code class="literal">rc</code>
      Scripts)</a></span></dt><dt><span class="sect1"><a href="users-and-groups.html">6.27. Adding Users and Groups</a></span></dt><dt><span class="sect1"><a href="requiring-kernel-sources.html">6.28. Ports That Rely on Kernel Sources</a></span></dt><dt><span class="sect1"><a href="go-libs.html">6.29. Go Libraries</a></span></dt><dt><span class="sect1"><a href="haskell-libs.html">6.30. Haskell Libraries</a></span></dt><dt><span class="sect1"><a href="shell-completion.html">6.31. Shell Completion Files</a></span></dt></dl></div><p>This section explains the most common things to consider when
    creating a port.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="staging"></a>6.1. Staging</h2></div></div></div><p><code class="filename">bsd.port.mk</code> expects ports to work
      with a <span class="quote">&#8220;<span class="quote">stage directory</span>&#8221;</span>.  This means that a port
      must not install files directly to the regular destination
      directories (that is, under <code class="varname">PREFIX</code>, for
      example) but instead into a separate directory from which the
      package is then built.  In many cases, this does not require
      root privileges, making it possible to build packages as an
      unprivileged user.  With staging, the port is built and
      installed into the stage directory,
      <code class="varname">STAGEDIR</code>.  A package is created from the
      stage directory and then installed on the system.  Automake
      tools refer to this concept as <code class="varname">DESTDIR</code>, but
      in FreeBSD, <code class="varname">DESTDIR</code> has a different meaning
      (see <a class="xref" href="porting-prefix.html" title="10.4. PREFIX and DESTDIR">Section 10.4, &#8220;<code class="varname">PREFIX</code> and
      <code class="varname">DESTDIR</code>&#8221;</a>).</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">No port <span class="emphasis"><em>really</em></span> needs to be root.  It
	can mostly be avoided by using <a class="link" href="uses-uidfix.html" title="17.88. uidfix"><code class="literal">USES=uidfix</code></a>.
	If the port still runs commands like <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chown&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chown</span>(8)</span></a>,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chgrp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chgrp</span>(1)</span></a>, or forces owner or group with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=install&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">install</span>(1)</span></a>
	then use <a class="link" href="uses-fakeroot.html" title="17.20. fakeroot"><code class="literal">USES=fakeroot</code></a>
	to fake those calls.  Some patching of the port's
	<code class="filename">Makefiles</code> will be needed.</p></div><p>Meta ports, or ports that do not install files themselves
      but only depend on other ports, must avoid needlessly
      extracting the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mtree</span>(8)</span></a> to the stage directory.  This is
      the basic directory layout of the package, and these empty
      directories will be seen as orphans.  To prevent
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mtree</span>(8)</span></a> extraction, add this line:</p><pre class="programlisting">NO_MTREE=	yes</pre><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Metaports should use <a class="link" href="uses-metaport.html" title="17.56. metaport"><code class="literal">USES=metaport</code></a>.
	It sets up defaults for ports that do not fetch, build, or
	install anything.</p></div><p>Staging is enabled by prepending
      <code class="varname">STAGEDIR</code> to paths used in the
      <code class="buildtarget">pre-install</code>,
      <code class="buildtarget">do-install</code>, and
      <code class="buildtarget">post-install</code> targets (see the
      examples through the book).  Typically, this includes
      <code class="varname">PREFIX</code>, <code class="varname">ETCDIR</code>,
      <code class="varname">DATADIR</code>, <code class="varname">EXAMPLESDIR</code>,
      <code class="varname">MANPREFIX</code>, <code class="varname">DOCSDIR</code>, and
      so on.  Directories should be created as part of the
      <code class="buildtarget">post-install</code> target.  Avoid using
      absolute paths whenever possible.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ports that install kernel modules must prepend
	<code class="varname">STAGEDIR</code> to their destination, by default
	<code class="filename">/boot/modules</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="staging-symlink"></a>6.1.1. Handling Symbolic Links</h3></div></div></div><p>When creating a symbolic link, relative ones are strongly
	recommended.  Use <code class="command">${RLN}</code> to create relative
	symbolic links.  It uses <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=install&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">install</span>(1)</span></a> under the hood to
	automatically figure out the relative link to create.</p><div class="example"><a id="staging-ex1"></a><div class="example-title">Example 6.1. Create Relative Symbolic Links Automatically</div><div class="example-contents"><p><code class="command">${RLN}</code> uses <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=install&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">install</span>(1)</span></a>'s
	  relative symbolic feature which frees the porter of
	  computing the relative path.</p><pre class="programlisting">${RLN} ${STAGEDIR}${PREFIX}/lib/<em class="replaceable"><code>libfoo.so.42</code></em> ${STAGEDIR}${PREFIX}/lib/<em class="replaceable"><code>libfoo.so</code></em>
${RLN} ${STAGEDIR}${PREFIX}/libexec/foo/<em class="replaceable"><code>bar</code></em> ${STAGEDIR}${PREFIX}/bin/<em class="replaceable"><code>bar</code></em>
${RLN} ${STAGEDIR}<em class="replaceable"><code>/var/cache/foo</code></em> ${STAGEDIR}${PREFIX}/share/<em class="replaceable"><code>foo</code></em></pre><p>Will generate:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ls -lF ${STAGEDIR}${PREFIX}/lib</code></strong>
lrwxr-xr-x  1 nobody  nobody    181 Aug  3 11:27 libfoo.so@ -&gt; libfoo.so.42
-rwxr-xr-x  1 nobody  nobody     15 Aug  3 11:24 libfoo.so.42*
<code class="prompt">%</code> <strong class="userinput"><code>ls -lF ${STAGEDIR}${PREFIX}/bin</code></strong>
lrwxr-xr-x  1 nobody  nobody    181 Aug  3 11:27 bar@ -&gt; ../libexec/foo/bar
<code class="prompt">%</code> <strong class="userinput"><code>ls -lF ${STAGEDIRDIR}${PREFIX}/share</code></strong>
lrwxr-xr-x  1 nobody  nobody    181 Aug  3 11:27 foo@ -&gt; ../../../var/cache/foo</pre></div></div><br class="example-break" /></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="binary-alias.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="bundled-libs.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.17. Use <code class="varname">BINARY_ALIAS</code> to Rename Commands
      Instead of Patching the Build </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6.2. Bundled Libraries</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>