<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>Chapter 8. Advanced pkg-plist Practices</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="prev" href="flavors-auto-lua.html" title="7.5. USES=lua and Flavors" /><link rel="next" href="plist-cleaning.html" title="8.2. Empty Directories" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 8. Advanced <code class="filename">pkg-plist</code> Practices</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="flavors-auto-lua.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="plist-cleaning.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist"></a>Chapter 8. Advanced <code class="filename">pkg-plist</code> Practices</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="plist.html#plist-sub">8.1. Changing <code class="filename">pkg-plist</code> Based on Make
      Variables</a></span></dt><dt><span class="sect1"><a href="plist-cleaning.html">8.2. Empty Directories</a></span></dt><dt><span class="sect1"><a href="plist-config.html">8.3. Configuration Files</a></span></dt><dt><span class="sect1"><a href="plist-dynamic.html">8.4. Dynamic Versus Static Package List</a></span></dt><dt><span class="sect1"><a href="plist-autoplist.html">8.5. Automated Package List Creation</a></span></dt><dt><span class="sect1"><a href="plist-keywords.html">8.6. Expanding Package List with Keywords</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="plist-sub"></a>8.1. Changing <code class="filename">pkg-plist</code> Based on Make
      Variables</h2></div></div></div><p>Some ports, particularly the <code class="literal">p5-</code> ports,
      need to change their <code class="filename">pkg-plist</code> depending on
      what options they are configured with (or version of
      <code class="literal">perl</code>, in the case of <code class="literal">p5-</code>
      ports).  To make this easy, any instances in
      <code class="filename">pkg-plist</code> of <code class="literal">%%OSREL%%</code>,
      <code class="literal">%%PERL_VER%%</code>, and
      <code class="literal">%%PERL_VERSION%%</code> will be substituted
      appropriately.  The value of <code class="literal">%%OSREL%%</code> is the
      numeric revision of the operating system (for example,
      <code class="literal">4.9</code>).  <code class="literal">%%PERL_VERSION%%</code>
      and <code class="literal">%%PERL_VER%%</code> is the full version number
      of <code class="command">perl</code> (for example,
      <code class="literal">5.8.9</code>).  Several other
      <code class="literal">%%<em class="replaceable"><code>VARS</code></em>%%</code> related
      to port's documentation files are described in <a class="link" href="install.html#install-documentation" title="5.16.4. Install Additional Documentation">the relevant
	section</a>.</p><p>To make other substitutions, set
      <code class="varname">PLIST_SUB</code> with a list of
      <code class="literal"><em class="replaceable"><code>VAR</code></em>=<em class="replaceable"><code>VALUE</code></em></code>
      pairs and instances of
      <code class="literal">%%<em class="replaceable"><code>VAR</code></em>%%</code> will be
      substituted with <em class="replaceable"><code>VALUE</code></em> in
      <code class="filename">pkg-plist</code>.</p><p>For instance, if a port installs many files
      in a version-specific subdirectory, use a placeholder for the
      version so that <code class="filename">pkg-plist</code> does not have to
      be regenerated every time the port is updated.  For
      example:</p><pre class="programlisting">OCTAVE_VERSION=	${PORTREVISION}
PLIST_SUB=	OCTAVE_VERSION=${OCTAVE_VERSION}</pre><p>in the <code class="filename">Makefile</code> and use
      <code class="literal">%%OCTAVE_VERSION%%</code> wherever the version shows
      up in <code class="filename">pkg-plist</code>.  When
      the port is upgraded, it will not be necessary to edit dozens
      (or in some cases, hundreds) of lines in
      <code class="filename">pkg-plist</code>.</p><p>If files are installed conditionally on the options
      set in the port, the usual way of handling it is prefixing
      <code class="filename">pkg-plist</code> lines with a
      <code class="literal">%%OPT%%</code> for lines needed when the option is
      enabled, or <code class="literal">%%NO_OPT%%</code> when the option is
      disabled, and adding <code class="literal">OPTIONS_SUB=yes</code> to the
      <code class="filename">Makefile</code>.  See <a class="xref" href="makefile-options.html#options_sub" title="5.13.3.1. OPTIONS_SUB">Section 5.13.3.1, &#8220;<code class="varname">OPTIONS_SUB</code>&#8221;</a> for more information.</p><p>For instance, if there are files that are only installed
      when the <code class="literal">X11</code> option is enabled, and
      <code class="filename">Makefile</code> has:</p><pre class="programlisting">OPTIONS_DEFINE=	X11
OPTIONS_SUB=	yes</pre><p>In <code class="filename">pkg-plist</code>, put
      <code class="literal">%%X11%%</code> in front of the lines only being
      installed when the option is enabled, like this :</p><pre class="programlisting">%%X11%%bin/foo-gui</pre><p>This substitution will be done between the
      <code class="buildtarget">pre-install</code> and
      <code class="buildtarget">do-install</code> targets, by reading from
      <code class="filename">PLIST</code> and writing to
      <code class="filename">TMPPLIST</code> (default:
      <code class="filename">WRKDIR/.PLIST.mktmp</code>).  So if the port
      builds <code class="filename">PLIST</code> on the fly, do so in or before
      <code class="buildtarget">pre-install</code>.  Also, if the port
      needs to edit the resulting file, do so in
      <code class="buildtarget">post-install</code> to a file named
      <code class="filename">TMPPLIST</code>.</p><p>Another way of modifying a port's packing list is based on
      setting the variables <code class="varname">PLIST_FILES</code> and
      <code class="varname">PLIST_DIRS</code>.  The value of each variable is
      regarded as a list of pathnames to write to
      <code class="filename">TMPPLIST</code> along with
      <code class="filename">PLIST</code> contents.  While names listed in
      <code class="varname">PLIST_FILES</code> and
      <code class="varname">PLIST_DIRS</code> are subject to
      <code class="literal">%%<em class="replaceable"><code>VAR</code></em>%%</code>
      substitution as described above, it is better to use the
      <code class="literal">${<em class="replaceable"><code>VAR</code></em>}</code> directly.
      Except for that, names from
      <code class="varname">PLIST_FILES</code> will appear in the final packing
      list unchanged, while <code class="literal">@dir</code>
      will be prepended to names from
      <code class="varname">PLIST_DIRS</code>.  To take effect,
      <code class="varname">PLIST_FILES</code> and
      <code class="varname">PLIST_DIRS</code> must be set before
      <code class="filename">TMPPLIST</code> is written, that is, in
      <code class="buildtarget">pre-install</code> or earlier.</p><p>From time to time, using <code class="varname">OPTIONS_SUB</code>
      is not enough.  In those cases, adding a specific
      <code class="literal"><em class="replaceable"><code>TAG</code></em></code> to
      <code class="varname">PLIST_SUB</code>
      inside the <code class="filename">Makefile</code> with a special
      value of <code class="literal">@comment</code>, makes package tools to
      ignore the line.  For instance, if some files are only installed
      when the <code class="literal">X11</code> option is on and the
      architecture is <code class="literal">i386</code>:</p><pre class="programlisting">.include &lt;bsd.port.pre.mk&gt;

.if ${PORT_OPTIONS:MX11} &amp;&amp; ${ARCH} == "i386"
PLIST_SUB+=	X11I386=""
.else
PLIST_SUB+=	X11I386="@comment "
.endif</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="flavors-auto-lua.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="plist-cleaning.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">7.5. <code class="literal">USES=lua</code> and Flavors </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 8.2. Empty Directories</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>