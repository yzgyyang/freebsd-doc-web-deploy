<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>5.16. Installing Files</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="makefiles.html" title="Chapter 5. Configuring the Makefile" /><link rel="prev" href="conflicts.html" title="5.15. Conflict Handling" /><link rel="next" href="binary-alias.html" title="5.17. Use BINARY_ALIAS to Rename Commands Instead of Patching the Build" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.16. Installing Files</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="conflicts.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Configuring the Makefile</th><td width="20%" align="right"> <a accesskey="n" href="binary-alias.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="install"></a>5.16. Installing Files</h2></div></div></div><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <code class="buildtarget">install</code> phase is very
	important to the end user because it
	adds files to their system.  All the additional commands run
	in the port <code class="filename">Makefile</code>'s
	<code class="buildtarget">*-install</code> targets should be
	echoed to the screen.  <span class="emphasis"><em>Do not</em></span> silence
	these commands with
	<code class="literal">@</code> or <code class="literal">.SILENT</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="install-macros"></a>5.16.1. <code class="varname">INSTALL_<em class="replaceable"><code>*</code></em></code>
	Macros</h3></div></div></div><p>Use the macros provided in
	<code class="filename">bsd.port.mk</code> to ensure correct modes of
	files in the port's <code class="buildtarget">*-install</code>
	targets.  Set ownership directly in
	<code class="filename">pkg-plist</code> with the corresponding entries,
	such as
	<code class="literal">@(<em class="replaceable"><code>owner</code></em>,<em class="replaceable"><code>group</code></em>,)</code>,
	<code class="literal">@owner <em class="replaceable"><code>owner</code></em></code>,
	and <code class="literal">@group
	  <em class="replaceable"><code>group</code></em></code>.
	These operators work until overridden, or until the end
	of <code class="filename">pkg-plist</code>, so remember to reset
	them after they are no longer needed.  The default ownership
	is <code class="literal">root:wheel</code>.  See <a class="xref" href="plist-keywords.html#plist-keywords-base" title="8.6.13. Base Keywords">Section 8.6.13, &#8220;Base Keywords&#8221;</a> for more information.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">INSTALL_PROGRAM</code> is a command to
	    install binary executables.</p></li><li class="listitem"><p><code class="varname">INSTALL_SCRIPT</code> is a command to
	    install executable scripts.</p></li><li class="listitem"><p><code class="varname">INSTALL_LIB</code> is a command to install
	    shared libraries (but not static libraries).</p></li><li class="listitem"><p><code class="varname">INSTALL_KLD</code> is a command to
	    install kernel loadable modules.  Some architectures
	    do not like having the modules stripped, so
	    use this command instead of
	    <code class="varname">INSTALL_PROGRAM</code>.</p></li><li class="listitem"><p><code class="varname">INSTALL_DATA</code> is a command to
	    install sharable data, including static libraries.</p></li><li class="listitem"><p><code class="varname">INSTALL_MAN</code> is a command to
	    install manpages and other documentation (it does not
	    compress anything).</p></li></ul></div><p>These variables are set to the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=install&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">install</span>(1)</span></a> command
	with the appropriate flags for each situation.</p><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">Do not use <code class="varname">INSTALL_LIB</code> to install
	  static libraries, because stripping them renders them
	  useless.  Use <code class="varname">INSTALL_DATA</code>
	  instead.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="install-strip"></a>5.16.2. Stripping Binaries and Shared Libraries</h3></div></div></div><p>Installed binaries should be stripped.  Do not strip
	binaries manually unless absolutely required.  The
	<code class="varname">INSTALL_PROGRAM</code> macro installs and
	strips a binary at the same time.  The
	<code class="varname">INSTALL_LIB</code> macro does the same thing to
	shared libraries.</p><p>When a file must be stripped, but neither
	<code class="varname">INSTALL_PROGRAM</code> nor
	<code class="varname">INSTALL_LIB</code> macros are desirable,
	<code class="literal">${STRIP_CMD}</code> strips the program or
	shared library.  This is typically done within the
	<code class="buildtarget">post-install</code> target.  For
	example:</p><pre class="programlisting">post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/xdl</pre><p>When multiple files need to be stripped:</p><pre class="programlisting">post-install:
.for l in geometry media body track world
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/lib${PORTNAME}-${l}.so.0
.endfor</pre><p>Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=file&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">file</span>(1)</span></a> on a file to determine if it has been
	stripped.  Binaries are reported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=file&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">file</span>(1)</span></a> as
	<code class="literal">stripped</code>, or
	<code class="literal">not stripped</code>.  Additionally, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=strip&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">strip</span>(1)</span></a>
	will detect programs that have already been stripped and exit
	cleanly.</p><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">When <code class="varname">WITH_DEBUG</code> is defined, elf files
	  <span class="emphasis"><em>must not</em></span> be stripped.</p><p xmlns="http://www.w3.org/1999/xhtml">The variables (<code class="varname">STRIP_CMD</code>,
	  <code class="varname">INSTALL_PROGRAM</code>,
	  <code class="varname">INSTALL_LIB</code>, ...) and <a class="link" href="uses.html" title="Chapter 17. Using USES Macros"><code class="varname">USES</code></a> provided by the framework
	  handle this automatically.</p><p xmlns="http://www.w3.org/1999/xhtml">Some software, add <code class="literal">-s</code> to their
	  <code class="varname">LDFLAGS</code>, in this case, either remove
	  <code class="literal">-s</code> if <code class="varname">WITH_DEBUG</code> is
	  set, or remove it unconditionally and use
	  <code class="varname">STRIP_CMD</code> in
	  <code class="buildtarget">post-install</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="install-copytree"></a>5.16.3. Installing a Whole Tree of Files</h3></div></div></div><p>Sometimes, a large number of files must be installed while
	preserving their hierarchical organization.  For example,
	copying over a whole directory tree from
	<code class="varname">WRKSRC</code> to a target directory under
	<code class="varname">PREFIX</code>.  Note that
	<code class="varname">PREFIX</code>, <code class="varname">EXAMPLESDIR</code>,
	<code class="varname">DATADIR</code>, and other path variables must
	always be prepended with <code class="varname">STAGEDIR</code> to
	respect staging (see <a class="xref" href="special.html#staging" title="6.1. Staging">Section 6.1, &#8220;Staging&#8221;</a>).</p><p>Two macros exist for this situation.  The advantage of
	using these macros instead of <code class="command">cp</code> is that
	they guarantee proper file ownership and permissions on target
	files.  The first macro, <code class="varname">COPYTREE_BIN</code>, will
	set all the installed files to be executable, thus being
	suitable for installing into <code class="filename">PREFIX/bin</code>.
	The second macro, <code class="varname">COPYTREE_SHARE</code>, does not
	set executable permissions on files, and is therefore suitable
	for installing files under <code class="filename">PREFIX/share</code>
	target.</p><pre class="programlisting">post-install:
	${MKDIR} ${STAGEDIR}${EXAMPLESDIR}
	(cd ${WRKSRC}/examples &amp;&amp; ${COPYTREE_SHARE} . ${STAGEDIR}${EXAMPLESDIR})</pre><p>This example will install the contents of the
	<code class="filename">examples</code> directory in the vendor distfile
	to the proper examples location of the port.</p><pre class="programlisting">post-install:
	${MKDIR} ${STAGEDIR}${DATADIR}/summer
	(cd ${WRKSRC}/temperatures &amp;&amp; ${COPYTREE_SHARE} "June July August" ${STAGEDIR}${DATADIR}/summer)</pre><p>And this example will install the data of summer months to
	the <code class="filename">summer</code> subdirectory of a
	<code class="filename">DATADIR</code>.</p><p>Additional <code class="command">find</code> arguments can be
	passed via the third argument to
	<code class="varname">COPYTREE_<em class="replaceable"><code>*</code></em></code>
	macros.  For example, to install
	all files from the first example except Makefiles, one can use
	these commands.</p><pre class="programlisting">post-install:
	${MKDIR} ${STAGEDIR}${EXAMPLESDIR}
	(cd ${WRKSRC}/examples &amp;&amp; \
	${COPYTREE_SHARE} . ${STAGEDIR}${EXAMPLESDIR} "! -name Makefile")</pre><p>These macros do not add the installed files to
	<code class="filename">pkg-plist</code>.  They must be added manually.
	For optional documentation (<code class="varname">PORTDOCS</code>, see
	<a class="xref" href="install.html#install-documentation" title="5.16.4. Install Additional Documentation">Section 5.16.4, &#8220;Install Additional Documentation&#8221;</a>) and examples
	(<code class="varname">PORTEXAMPLES</code>), the
	<code class="literal">%%PORTDOCS%%</code> or
	<code class="literal">%%PORTEXAMPLES%%</code> prefixes must be prepended
	in <code class="filename">pkg-plist</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="install-documentation"></a>5.16.4. Install Additional Documentation</h3></div></div></div><p>If the software has some documentation other than the
	standard man and info pages that is useful for the
	user, install it under <code class="varname">DOCSDIR</code>
	This can be done, like the previous item, in the
	<code class="buildtarget">post-install</code> target.</p><p>Create a new directory for the port.  The directory name
	is <code class="varname">DOCSDIR</code>.  This usually equals
	<code class="varname">PORTNAME</code>.  However, if the user
	might want different versions of the port to be installed at
	the same time, the whole
	<code class="varname">PKGNAME</code> can be used.</p><p>Since only the files listed in
	<code class="filename">pkg-plist</code> are installed, it is safe to
	always install documentation to <code class="varname">STAGEDIR</code>
	(see <a class="xref" href="special.html#staging" title="6.1. Staging">Section 6.1, &#8220;Staging&#8221;</a>).  Hence <code class="literal">.if</code>
	blocks are only needed when the installed files are large
	enough to cause significant I/O overhead.</p><pre class="programlisting">post-install:
	${MKDIR} ${STAGEDIR}${DOCSDIR}
	${INSTALL_MAN} ${WRKSRC}/docs/xvdocs.ps ${STAGEDIR}${DOCSDIR}</pre><p>On the other hand, if there is a DOCS option in the port,
	install the documentation in a
	<code class="buildtarget">post-install-DOCS-on</code> target.  These
	targets are described in <a class="xref" href="makefile-options.html#options-targets" title="5.13.3.12. Additional Build Targets, target-OPT-on and target-OPT-off">Section 5.13.3.12, &#8220;Additional Build Targets,
	  <code class="buildtarget"><em class="replaceable"><code>target</code></em>-<em class="replaceable"><code>OPT</code></em>-on</code>
	  and
	  <code class="buildtarget"><em class="replaceable"><code>target</code></em>-<em class="replaceable"><code>OPT</code></em>-off</code>&#8221;</a>.</p><p>Here are some handy variables and how they are expanded by
	default when used in the <code class="filename">Makefile</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">DATADIR</code> gets expanded to
	    <code class="filename">PREFIX/share/PORTNAME</code>.</p></li><li class="listitem"><p><code class="varname">DATADIR_REL</code> gets expanded to
	    <code class="filename">share/PORTNAME</code>.</p></li><li class="listitem"><p><code class="varname">DOCSDIR</code> gets expanded to
	    <code class="filename">PREFIX/share/doc/PORTNAME</code>.</p></li><li class="listitem"><p><code class="varname">DOCSDIR_REL</code> gets expanded to
	    <code class="filename">share/doc/PORTNAME</code>.</p></li><li class="listitem"><p><code class="varname">EXAMPLESDIR</code> gets expanded to
	    <code class="filename">PREFIX/share/examples/PORTNAME</code>.</p></li><li class="listitem"><p><code class="varname">EXAMPLESDIR_REL</code> gets expanded to
	    <code class="filename">share/examples/PORTNAME</code>.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <code class="literal">DOCS</code> option only controls
	  additional documentation installed in
	  <code class="varname">DOCSDIR</code>.  It does not apply to standard
	  man pages and info pages.  Things installed in
	  <code class="varname">EXAMPLESDIR</code> are controlled by
	  the <code class="literal">EXAMPLES</code> option.</p></div><p>These variables are exported to
	<code class="varname">PLIST_SUB</code>.  Their values will appear there
	as pathnames relative to <code class="filename">PREFIX</code> if
	possible.  That is, <code class="filename">share/doc/PORTNAME</code>
	will be substituted for <code class="literal">%%DOCSDIR%%</code> in the
	packing list by default, and so on.  (See more on
	<code class="filename">pkg-plist</code> substitution
	<a class="link" href="plist.html#plist-sub" title="8.1. Changing pkg-plist Based on Make Variables">here</a>.)</p><p>All conditionally installed documentation files and
	directories are included in
	<code class="filename">pkg-plist</code> with the
	<code class="literal">%%PORTDOCS%%</code> prefix, for example:</p><pre class="programlisting">%%PORTDOCS%%%%DOCSDIR%%/AUTHORS
%%PORTDOCS%%%%DOCSDIR%%/CONTACT</pre><p>As an alternative to enumerating the documentation files
	in <code class="filename">pkg-plist</code>, a port can set the variable
	<code class="varname">PORTDOCS</code> to a list of file names and shell
	glob patterns to add to the final packing list.  The names
	will be relative to <code class="varname">DOCSDIR</code>.  Therefore, a
	port that utilizes <code class="varname">PORTDOCS</code>, and uses a
	non-default location for its documentation, must set
	<code class="varname">DOCSDIR</code> accordingly.  If a directory is
	listed in <code class="varname">PORTDOCS</code> or matched by a glob
	pattern from this variable, the entire subtree of contained
	files and directories will be registered in the final packing
	list.  If the <code class="literal">DOCS</code> option has been unset
	then files and directories listed in
	<code class="varname">PORTDOCS</code> would not be installed or added to
	port packing list.  Installing the documentation at
	<code class="varname">PORTDOCS</code> as shown above remains up to the
	port itself.  A typical example of utilizing
	<code class="varname">PORTDOCS</code>:</p><pre class="programlisting">PORTDOCS=	README.* ChangeLog docs/*</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The equivalents of <code class="varname">PORTDOCS</code> for files
	  installed under <code class="varname">DATADIR</code> and
	  <code class="varname">EXAMPLESDIR</code> are
	  <code class="varname">PORTDATA</code> and
	  <code class="varname">PORTEXAMPLES</code>, respectively.</p><p xmlns="http://www.w3.org/1999/xhtml">The contents of <code class="filename">pkg-message</code> are
	  displayed upon installation.  See
	  <a class="link" href="pkg-files.html#porting-message" title="9.1. pkg-message">the section on using
	  <code class="filename">pkg-message</code></a> for details.
	  <code class="filename">pkg-message</code> does not need to be added
	  to <code class="filename">pkg-plist</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="install-subdirs"></a>5.16.5. Subdirectories Under <code class="varname">PREFIX</code></h3></div></div></div><p>Try to let the port put things in the right subdirectories
	of <code class="varname">PREFIX</code>.  Some ports lump everything and
	put it in the subdirectory with the port's name, which is
	incorrect.  Also, many ports put everything except binaries,
	header files and manual pages in a subdirectory of
	<code class="filename">lib</code>, which does not work well with the
	BSD paradigm.  Many of the files must be moved to one of these
	directories: <code class="filename">etc</code> (setup/configuration
	files), <code class="filename">libexec</code> (executables started
	internally), <code class="filename">sbin</code> (executables for
	superusers/managers), <code class="filename">info</code> (documentation
	for info browser) or <code class="filename">share</code> (architecture
	independent files).  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hier&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hier</span>(7)</span></a> for details; the rules
	governing <code class="filename">/usr</code> pretty much apply to
	<code class="filename">/usr/local</code> too.  The exception are ports
	dealing with USENET <span class="quote">&#8220;<span class="quote">news</span>&#8221;</span>.  They may use
	<code class="filename">PREFIX/news</code> as a destination for their
	files.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="conflicts.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="makefiles.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="binary-alias.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.15. Conflict Handling </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 5.17. Use <code class="varname">BINARY_ALIAS</code> to Rename Commands
      Instead of Patching the Build</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>