<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>6.23. Using iconv</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="special.html" title="Chapter 6. Special Considerations" /><link rel="prev" href="using-lua.html" title="6.22. Using Lua" /><link rel="next" href="using-xfce.html" title="6.24. Using Xfce" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.23. Using <code class="command">iconv</code></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using-lua.html">Prev</a> </td><th width="60%" align="center">Chapter 6. Special Considerations</th><td width="20%" align="right"> <a accesskey="n" href="using-xfce.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-iconv"></a>6.23. Using <code class="command">iconv</code></h2></div></div></div><p>After 2013-10-08 (<a xmlns="" href="https://svnweb.freebsd.org/changeset/base/254273"><span class="svnref">254273</span></a>),
      FreeBSD  10-CURRENT and newer versions have a native
      <code class="command">iconv</code> in the operating system.  On earlier
      versions, <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/converters/libiconv/pkg-descr">converters/libiconv</a>
      was used as a dependency.</p><p>For software that needs <code class="command">iconv</code>, define
      <code class="literal">USES=iconv</code>.  FreeBSD versions before
      10-CURRENT on 2013-08-13 (<a xmlns="" href="https://svnweb.freebsd.org/changeset/base/254273"><span class="svnref">254273</span></a>) do
      not have a native <code class="command">iconv</code>.  On these earlier
      versions, a dependency on
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/converters/libiconv/pkg-descr">converters/libiconv</a> will be
      added automatically.</p><p>When a port defines <code class="literal">USES=iconv</code>, these
      variables will be available:</p><div class="informaltable"><table class="informaltable" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Variable name</th><th>Purpose</th><th>Value before FreeBSD 10-CURRENT
	      <a xmlns="" href="https://svnweb.freebsd.org/changeset/base/254273"><span class="svnref">254273</span></a> (2013-08-13)</th><th>Value after FreeBSD 10-CURRENT
	      <a xmlns="" href="https://svnweb.freebsd.org/changeset/base/254273"><span class="svnref">254273</span></a> (2013-08-13)</th></tr></thead><tbody><tr><td><code class="varname">ICONV_CMD</code></td><td>Directory where the <code class="command">iconv</code>
	      binary resides</td><td><code class="literal">${LOCALBASE}/bin/iconv</code></td><td><code class="filename">/usr/bin/iconv</code></td></tr><tr><td><code class="varname">ICONV_LIB</code></td><td><code class="command">ld</code> argument to link to
	      <code class="filename">libiconv</code> (if needed)</td><td><code class="literal">-liconv</code></td><td>(empty)</td></tr><tr><td><code class="varname">ICONV_PREFIX</code></td><td>Directory where the <code class="command">iconv</code>
	      implementation resides (useful for configure
	      scripts)</td><td><code class="literal">${LOCALBASE}</code></td><td><code class="filename">/usr</code></td></tr><tr><td><code class="varname">ICONV_CONFIGURE_ARG</code></td><td>Preconstructed configure argument for
	      configure scripts</td><td><code class="literal">--with-libiconv-prefix=${LOCALBASE}</code></td><td>(empty)</td></tr><tr><td><code class="varname">ICONV_CONFIGURE_BASE</code></td><td>Preconstructed configure argument for
	      configure scripts</td><td><code class="literal">--with-libiconv=${LOCALBASE}</code></td><td>(empty)</td></tr></tbody></table></div><p>These two examples automatically populate the variables
      with the correct value for systems using
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/converters/libiconv/pkg-descr">converters/libiconv</a> or the
      native <code class="command">iconv</code> respectively:</p><div class="example"><a id="iconv-simple-use"></a><div class="example-title">Example 6.31. Simple <code class="command">iconv</code> Usage</div><div class="example-contents"><pre class="programlisting">USES=		iconv
LDFLAGS+=	-L${LOCALBASE}/lib ${ICONV_LIB}</pre></div></div><br class="example-break" /><div class="example"><a id="iconv-configure-use"></a><div class="example-title">Example 6.32. <code class="command">iconv</code> Usage with
	<code class="command">configure</code></div><div class="example-contents"><pre class="programlisting">USES=		iconv
CONFIGURE_ARGS+=${ICONV_CONFIGURE_ARG}</pre></div></div><br class="example-break" /><p>As shown above, <code class="varname">ICONV_LIB</code> is empty when
      a native <code class="command">iconv</code> is present.  This can be
      used to detect the native <code class="command">iconv</code> and respond
      appropriately.</p><p>Sometimes a program has an <code class="command">ld</code> argument
      or search path hardcoded in a <code class="filename">Makefile</code> or
      configure script.  This approach can be used to solve that
      problem:</p><div class="example"><a id="iconv-reinplace"></a><div class="example-title">Example 6.33. Fixing Hardcoded <code class="literal">-liconv</code></div><div class="example-contents"><pre class="programlisting">USES=		iconv

post-patch:
	@${REINPLACE_CMD} -e 's/-liconv/${ICONV_LIB}/' ${WRKSRC}/Makefile</pre></div></div><br class="example-break" /><p>In some cases it is necessary to set alternate values or
      perform operations depending on whether there is a native
      <code class="command">iconv</code>.
      <code class="filename">bsd.port.pre.mk</code> must be included before
      testing the value of <code class="varname">ICONV_LIB</code>:</p><div class="example"><a id="iconv-conditional"></a><div class="example-title">Example 6.34. Checking for Native <code class="command">iconv</code>
	Availability</div><div class="example-contents"><pre class="programlisting">USES=		iconv

.include &lt;bsd.port.pre.mk&gt;

post-patch:
.if empty(ICONV_LIB)
	# native iconv detected
	@${REINPLACE_CMD} -e 's|iconv||' ${WRKSRC}/Config.sh
.endif

.include &lt;bsd.port.post.mk&gt;</pre></div></div><br class="example-break" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using-lua.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="using-xfce.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">6.22. Using <span class="application">Lua</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6.24. Using Xfce</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>