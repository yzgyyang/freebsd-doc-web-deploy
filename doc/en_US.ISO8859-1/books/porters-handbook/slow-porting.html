<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>Chapter 4. Slow Porting</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="prev" href="porting-submitting.html" title="3.6. Submitting the New Port" /><link rel="next" href="slow-sources.html" title="4.2. Getting the Original Sources" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 4. Slow Porting</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="porting-submitting.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="slow-sources.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="slow-porting"></a>Chapter 4. Slow Porting</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="slow-porting.html#slow-work">4.1. How Things Work</a></span></dt><dt><span class="sect1"><a href="slow-sources.html">4.2. Getting the Original Sources</a></span></dt><dt><span class="sect1"><a href="slow-modifying.html">4.3. Modifying the Port</a></span></dt><dt><span class="sect1"><a href="slow-patch.html">4.4. Patching</a></span></dt><dt><span class="sect1"><a href="slow-configure.html">4.5. Configuring</a></span></dt><dt><span class="sect1"><a href="slow-user-input.html">4.6. Handling User Input</a></span></dt></dl></div><p>Okay, so it was not that simple, and the port required some
    modifications to get it to work.  In this section, we will
    explain, step by step, how to modify it to get it to work with the
    ports paradigm.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="slow-work"></a>4.1. How Things Work</h2></div></div></div><p>First, this is the sequence of events which occurs when the
      user first types <code class="command">make</code> in the port's
      directory.  Having
      <code class="filename">bsd.port.mk</code> in another window while
      reading this really helps to understand it.</p><p>But do not worry, not many people understand exactly how
      <code class="filename">bsd.port.mk</code> is working...
      <span class="emphasis"><em>:-)</em></span></p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>The <code class="buildtarget">fetch</code> target is run.  The
	  <code class="buildtarget">fetch</code> target is responsible for
	  making sure that the tarball exists locally in
	  <code class="varname">DISTDIR</code>.  If
	  <code class="buildtarget">fetch</code> cannot find the required
	  files in <code class="varname">DISTDIR</code> it will look up the URL
	  <code class="varname">MASTER_SITES</code>, which is set in the
	  Makefile, as well as our FTP mirrors where we put distfiles
	  as backup.  It will then attempt to fetch the named
	  distribution file with <code class="varname">FETCH</code>, assuming
	  that the requesting site has direct access to the Internet.
	  If that succeeds, it will save the file in
	  <code class="varname">DISTDIR</code> for future use and
	  proceed.</p></li><li class="step"><p>The <code class="buildtarget">extract</code> target is run.
	  It looks for the port's distribution file (typically a
	  compressed tarball) in
	  <code class="varname">DISTDIR</code> and unpacks it into a temporary
	  subdirectory specified by <code class="varname">WRKDIR</code>
	  (defaults to <code class="filename">work</code>).</p></li><li class="step"><p>The <code class="buildtarget">patch</code> target is run.
	  First, any patches defined in <code class="varname">PATCHFILES</code>
	  are applied.  Second, if any patch files named
	  <code class="filename">patch-<em class="replaceable"><code>*</code></em></code> are
	  found in <code class="varname">PATCHDIR</code> (defaults to the
	  <code class="filename">files</code> subdirectory), they are applied
	  at this time in alphabetical order.</p></li><li class="step"><p>The <code class="buildtarget">configure</code> target is run.
	  This can do any one of many different things.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>If it exists, <code class="filename">scripts/configure</code>
	      is run.</p></li><li class="listitem"><p>If <code class="varname">HAS_CONFIGURE</code> or
	      <code class="varname">GNU_CONFIGURE</code> is set,
	      <code class="filename">WRKSRC/configure</code> is run.</p></li></ol></div></li><li class="step"><p>The <code class="buildtarget">build</code> target is run.
	  This is responsible for descending into the port's private
	  working directory (<code class="varname">WRKSRC</code>) and building
	  it.</p></li><li class="step"><p>The <code class="buildtarget">stage</code> target is run.
	  This puts the final set of built files into a temporary
	  directory (<code class="varname">STAGEDIR</code>, see
	  <a class="xref" href="special.html#staging" title="6.1. Staging">Section 6.1, &#8220;Staging&#8221;</a>).  The hierarchy of this directory
	  mirrors that of the system on which the package will be
	  installed.</p></li><li class="step"><p>The <code class="buildtarget">package</code> target is run.
	  This creates a package using the files from the temporary
	  directory created during the
	  <code class="buildtarget">stage</code> target and the port's
	  <code class="filename">pkg-plist</code>.</p></li><li class="step"><p>The <code class="buildtarget">install</code> target is run.
	  This installs the package created during the
	  <code class="buildtarget">package</code> target into the host
	  system.</p></li></ol></div><p>The above are the default actions.  In addition,
      define targets
      <code class="buildtarget">pre-<em class="replaceable"><code>something</code></em></code>
      or
      <code class="buildtarget">post-<em class="replaceable"><code>something</code></em></code>,
      or put scripts with those names, in the
      <code class="filename">scripts</code> subdirectory, and they will be
      run before or after the default actions are done.</p><p>For example, if there is a
      <code class="buildtarget">post-extract</code> target defined in the
      <code class="filename">Makefile</code>, and a file
      <code class="filename">pre-build</code> in the
      <code class="filename">scripts</code> subdirectory, the
      <code class="buildtarget">post-extract</code> target will be called
      after the regular extraction actions, and
      <code class="filename">pre-build</code> will be executed before
      the default build rules are done.  It is recommended to
      use <code class="filename">Makefile</code> targets if the actions are
      simple enough, because it will be easier for someone to figure
      out what kind of non-default action the port requires.</p><p>The default actions are done by the
      <code class="buildtarget">do-<em class="replaceable"><code>something</code></em></code>
      targets from <code class="filename">bsd.port.mk</code>.
      For example, the commands to extract a port are in the target
      <code class="buildtarget">do-extract</code>.  If
      the default target does not do the job right, redefine the
      <code class="buildtarget">do-<em class="replaceable"><code>something</code></em></code>
      target in the <code class="filename">Makefile</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <span class="quote">&#8220;<span class="quote">main</span>&#8221;</span> targets (for example,
	<code class="buildtarget">extract</code>,
	<code class="buildtarget">configure</code>, etc.) do nothing more
	than make sure all the stages up to that one are completed and
	call the real targets or scripts, and they are not intended to
	be changed.  To fix the extraction, fix
	<code class="buildtarget">do-extract</code>, but never ever change
	the way <code class="buildtarget">extract</code> operates!
	Additionally, the target
	<code class="buildtarget">post-deinstall</code> is invalid and is
	not run by the ports infrastructure.</p></div><p>Now that what goes on when the user types <code class="command">make
	install</code> is better understood, let us go through the
      recommended steps to create the perfect port.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="porting-submitting.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="slow-sources.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3.6. Submitting the New Port </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 4.2. Getting the Original Sources</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>