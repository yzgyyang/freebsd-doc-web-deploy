<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>2.2. Kernel Organization</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="The Design and Implementation of the 4.4BSD Operating System" /><link rel="up" href="overview.html" title="Chapter 2. Design Overview of 4.4BSD" /><link rel="prev" href="overview.html" title="Chapter 2. Design Overview of 4.4BSD" /><link rel="next" href="overview-kernel-service.html" title="2.3. Kernel Services" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.2. Kernel Organization</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="overview.html">Prev</a> </td><th width="60%" align="center">Chapter 2. Design Overview of 4.4BSD</th><td width="20%" align="right"> <a accesskey="n" href="overview-kernel-service.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="overview-kernel-organization"></a>2.2. Kernel Organization</h2></div></div></div><p>In this section, we view the organization of the 4.4BSD
	kernel in two ways:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>As a static body of software,
	    categorized by the functionality offered by the modules
	    that make up the kernel</p></li><li class="listitem"><p>By its dynamic operation,
	    categorized according to the services provided to users</p></li></ol></div><p>The largest part of the kernel implements
	the system services that applications access through system calls.
	In 4.4BSD, this software has been organized according to the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Basic kernel facilities:
	    timer and system-clock handling,
	    descriptor management, and process management</p></li><li class="listitem"><p>Memory-management support:
	    paging and swapping</p></li><li class="listitem"><p>Generic system interfaces:
	    the I/O,
	    control, and multiplexing operations performed on descriptors</p></li><li class="listitem"><p>The filesystem:
	    files, directories, pathname translation, file locking,
	    and I/O buffer management</p></li><li class="listitem"><p>Terminal-handling support:
	    the terminal-interface driver and terminal
	    line disciplines</p></li><li class="listitem"><p>Interprocess-communication facilities:
	    sockets</p></li><li class="listitem"><p>Support for network communication:
	    communication protocols and
	    generic network facilities, such as routing</p></li></ul></div><div class="table"><a id="table-mach-indep"></a><div class="table-title">Table 2.1. Machine-independent software in the 4.4BSD kernel</div><div class="table-contents"><table class="table" summary="Machine-independent software in the 4.4BSD kernel" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Category</th><th>Lines of code</th><th>Percentage of kernel</th></tr></thead><tfoot><tr><th>total machine independent</th><th>162,617</th><th>80.4</th></tr></tfoot><tbody><tr><td>headers</td><td>9,393</td><td>4.6</td></tr><tr><td>initialization</td><td>1,107</td><td>0.6</td></tr><tr><td>kernel facilities</td><td>8,793</td><td>4.4</td></tr><tr><td>generic interfaces</td><td>4,782</td><td>2.4</td></tr><tr><td>interprocess communication</td><td>4,540</td><td>2.2</td></tr><tr><td>terminal handling</td><td>3,911</td><td>1.9</td></tr><tr><td>virtual memory</td><td>11,813</td><td>5.8</td></tr><tr><td>vnode management</td><td>7,954</td><td>3.9</td></tr><tr><td>filesystem naming</td><td>6,550</td><td>3.2</td></tr><tr><td>fast filestore</td><td>4,365</td><td>2.2</td></tr><tr><td>log-structure filestore</td><td>4,337</td><td>2.1</td></tr><tr><td>memory-based filestore</td><td>645</td><td>0.3</td></tr><tr><td>cd9660 filesystem</td><td>4,177</td><td>2.1</td></tr><tr><td>miscellaneous filesystems (10)</td><td>12,695</td><td>6.3</td></tr><tr><td>network filesystem</td><td>17,199</td><td>8.5</td></tr><tr><td>network communication</td><td>8,630</td><td>4.3</td></tr><tr><td>internet protocols</td><td>11,984</td><td>5.9</td></tr><tr><td>ISO protocols</td><td>23,924</td><td>11.8</td></tr><tr><td>X.25 protocols</td><td>10,626</td><td>5.3</td></tr><tr><td>XNS protocols</td><td>5,192</td><td>2.6</td></tr></tbody></table></div></div><br class="table-break" /><p>Most of the software in these categories is machine independent
	and is portable across different hardware architectures.</p><p>The machine-dependent aspects of the kernel
	are isolated from the mainstream code.
	In particular, none of the machine-independent code contains
	conditional code for specific architecture.
	When an architecture-dependent action is needed,
	the machine-independent code calls an architecture-dependent
	function that is located in the machine-dependent code.
	The software that is machine dependent includes</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Low-level system-startup actions</p></li><li class="listitem"><p>Trap and fault handling</p></li><li class="listitem"><p>Low-level manipulation of the run-time context of a
	    process</p></li><li class="listitem"><p>Configuration and initialization of hardware devices</p></li><li class="listitem"><p>Run-time support for I/O devices</p></li></ul></div><div class="table"><a id="table-mach-dep"></a><div class="table-title">Table 2.2. Machine-dependent software for the HP300 in the 4.4BSD
	  kernel</div><div class="table-contents"><table class="table" summary="Machine-dependent software for the HP300 in the 4.4BSD&#10;&#9;  kernel" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Category</th><th>Lines of code</th><th>Percentage of kernel</th></tr></thead><tfoot><tr><th>total machine dependent</th><th>39,634</th><th>19.6</th></tr></tfoot><tbody><tr><td>machine dependent headers</td><td>1,562</td><td>0.8</td></tr><tr><td>device driver headers</td><td>3,495</td><td>1.7</td></tr><tr><td>device driver source</td><td>17,506</td><td>8.7</td></tr><tr><td>virtual memory</td><td>3,087</td><td>1.5</td></tr><tr><td>other machine dependent</td><td>6,287</td><td>3.1</td></tr><tr><td>routines in assembly language</td><td>3,014</td><td>1.5</td></tr><tr><td>HP/UX compatibility</td><td>4,683</td><td>2.3</td></tr></tbody></table></div></div><br class="table-break" /><p><a class="xref" href="overview-kernel-organization.html#table-mach-indep" title="Table 2.1. Machine-independent software in the 4.4BSD kernel">Table 2.1, &#8220;Machine-independent software in the 4.4BSD kernel&#8221;</a> summarizes the machine-independent software that constitutes the
	4.4BSD kernel for the HP300.
	The numbers in column 2 are for lines of C source code,
	header files, and assembly language.
	Virtually all the software in the kernel is written in the C
	programming language;
	less than 2 percent is written in
	assembly language.
	As the statistics in <a class="xref" href="overview-kernel-organization.html#table-mach-dep" title="Table 2.2. Machine-dependent software for the HP300 in the 4.4BSD kernel">Table 2.2, &#8220;Machine-dependent software for the HP300 in the 4.4BSD
	  kernel&#8221;</a> show,
	the machine-dependent software, excluding
	HP/UX
	and device support,
	accounts for a minuscule 6.9 percent of the kernel.</p><p>Only a small part of the kernel is devoted to
	initializing the system.
	This code is used when the system is
	<span class="emphasis"><em>bootstrapped</em></span>
	into operation and is responsible for setting up the kernel hardware
	and software environment
	(see
	Chapter 14).
	Some operating systems (especially those with limited physical memory)
	discard or
	<span class="emphasis"><em>overlay</em></span>
	the software that performs these functions after that software has
	been executed.
	The 4.4BSD kernel does not reclaim the memory used by the
	startup code because that memory space is barely 0.5 percent
	of the kernel resources used on a typical machine.
	Also, the startup code does not appear in one place in the kernel -- it is
	scattered throughout, and it usually appears
	in places logically associated with what is being initialized.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="overview.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="overview.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="overview-kernel-service.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 2. Design Overview of 4.4BSD </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 2.3. Kernel Services</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>