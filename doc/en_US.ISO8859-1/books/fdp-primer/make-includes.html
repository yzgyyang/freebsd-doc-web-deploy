<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>5.4. FreeBSD Documentation Project Make Includes</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="FreeBSD Documentation Project Primer for New Contributors" /><link rel="up" href="doc-build.html" title="Chapter 5. The Documentation Build Process" /><link rel="prev" href="doc-build-makefiles.html" title="5.3. Understanding Makefiles in the Documentation Tree" /><link rel="next" href="the-website.html" title="Chapter 6. The Website" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.4. FreeBSD Documentation Project
      <span class="application">Make</span> Includes</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="doc-build-makefiles.html">Prev</a> </td><th width="60%" align="center">Chapter 5. The Documentation Build Process</th><td width="20%" align="right"> <a accesskey="n" href="the-website.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="make-includes"></a>5.4. FreeBSD Documentation Project
      <span class="application">Make</span> Includes</h2></div></div></div><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> includes are best explained by inspection of
      the code.  Here are the system include files:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">doc.project.mk</code> is the main project
	  include file, which includes all the following include
	  files, as necessary.</p></li><li class="listitem"><p><code class="filename">doc.subdir.mk</code> handles traversing of
	  the document tree during the build and install
	  processes.</p></li><li class="listitem"><p><code class="filename">doc.install.mk</code> provides variables
	  that affect ownership and installation of documents.</p></li><li class="listitem"><p><code class="filename">doc.docbook.mk</code> is included if
	  <code class="varname">DOCFORMAT</code> is <code class="literal">docbook</code>
	  and <code class="varname">DOC</code> is set.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="includes-doc-project-mk"></a>5.4.1. <code class="filename">doc.project.mk</code></h3></div></div></div><p>By inspection:</p><pre class="programlisting">DOCFORMAT?=	docbook
MAINTAINER?=	doc@FreeBSD.org

PREFIX?=	/usr/local
PRI_LANG?=	en_US.ISO8859-1

.if defined(DOC)
.if ${DOCFORMAT} == "docbook"
.include "doc.docbook.mk"
.endif
.endif

.include "doc.subdir.mk"
.include "doc.install.mk"</pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="doc-project-mk-variables"></a>5.4.1.1. Variables</h4></div></div></div><p><code class="varname">DOCFORMAT</code> and
	  <code class="varname">MAINTAINER</code> are assigned default values,
	  if these are not set by the document make file.</p><p><code class="varname">PREFIX</code> is the prefix under which the
	  <a class="link" href="tools.html" title="Chapter 2. Tools">documentation building tools</a>
	  are installed.  For normal package and port installation,
	  this is <code class="filename">/usr/local</code>.</p><p><code class="varname">PRI_LANG</code> should be set to whatever
	  language and encoding is natural amongst users these
	  documents are being built for.  US English is the
	  default.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="varname">PRI_LANG</code> does not affect which
	    documents can, or even will, be built.  Its main use is
	    creating links to commonly referenced documents into the
	    FreeBSD documentation install root.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="doc-project-mk-conditionals"></a>5.4.1.2. Conditionals</h4></div></div></div><p>The <code class="literal">.if defined(DOC)</code> line is an
	  example of a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> conditional which, like in other
	  programs, defines behavior if some condition is true or if
	  it is false.  <code class="literal">defined</code> is a function which
	  returns whether the variable given is defined or not.</p><p><code class="literal">.if ${DOCFORMAT} == "docbook"</code>, next,
	  tests whether the <code class="varname">DOCFORMAT</code> variable is
	  <code class="literal">"docbook"</code>, and in this case, includes
	  <code class="filename">doc.docbook.mk</code>.</p><p>The two <code class="literal">.endif</code>s close the two above
	  conditionals, marking the end of their application.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="includes-doc-subdir-mk"></a>5.4.2. <code class="filename">doc.subdir.mk</code></h3></div></div></div><p>This file is too long to explain in detail.  These notes
	describe the most important features.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="doc-subdir-mk-variables"></a>5.4.2.1. Variables</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">SUBDIR</code> is a list of
	      subdirectories that the build process should go further
	      down into.</p></li><li class="listitem"><p><code class="varname">ROOT_SYMLINKS</code> is the name of
	      directories that should be linked to the document
	      install root from their actual locations, if the current
	      language is the primary language (specified by
	      <code class="varname">PRI_LANG</code>).</p></li><li class="listitem"><p><code class="varname">COMPAT_SYMLINK</code> is described in
	      the
	      <a class="link" href="doc-build-makefiles.html#sub-make" title="5.3.1. Subdirectory Makefiles">Subdirectory Makefile</a>
	      section.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="doc-subdir-mk-targets-macro"></a>5.4.2.2. Targets and Macros</h4></div></div></div><p>Dependencies are described by
	  <code class="literal"><em class="replaceable"><code>target</code></em>:
	      <em class="replaceable"><code>dependency1 dependency2
	      ...</code></em></code> tuples, where to build
	  <code class="literal">target</code>, the given
	  dependencies must be built first.</p><p>After that descriptive tuple, instructions on how to
	  build the target may be given, if the conversion process
	  between the target and its dependencies are not previously
	  defined, or if this particular conversion is not the same as
	  the default conversion method.</p><p>A special dependency <code class="literal">.USE</code> defines
	  the equivalent of a macro.</p><pre class="programlisting">_SUBDIRUSE: .USE
.for entry in ${SUBDIR}
	@${ECHO} "===&gt; ${DIRPRFX}${entry}"
	@(cd ${.CURDIR}/${entry} &amp;&amp; \
	${MAKE} ${.TARGET:S/realpackage/package/:S/realinstall/install/} DIRPRFX=${DIRPRFX}${entry}/ )
.endfor</pre><p>In the above, <code class="buildtarget">_SUBDIRUSE</code> is
	  now a macro which will execute the given commands when it is
	  listed as a dependency.</p><p>What sets this macro apart from other targets?
	  Basically, it is executed <span class="emphasis"><em>after</em></span> the
	  instructions given in the build procedure it is listed as a
	  dependency to, and it does not adjust
	  <code class="varname">.TARGET</code>, which is the variable which
	  contains the name of the target currently being
	  built.</p><pre class="programlisting">clean: _SUBDIRUSE
	rm -f ${CLEANFILES}</pre><p>In the above, <code class="buildtarget">clean</code> will use
	  the <code class="buildtarget">_SUBDIRUSE</code> macro after it has
	  executed the instruction
	  <code class="command">rm -f ${CLEANFILES}</code>.  In effect, this
	  causes <code class="buildtarget">clean</code> to go further and
	  further down the directory tree, deleting built files as it
	  goes <span class="emphasis"><em>down</em></span>, not on the way back
	  up.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="doc-subdir-mk-provided-targets"></a>5.4.2.2.1. Provided Targets</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="buildtarget">install</code> and
		<code class="buildtarget">package</code> both go down the
		directory tree calling the real versions of themselves
		in the subdirectories
		(<code class="buildtarget">realinstall</code> and
		<code class="buildtarget">realpackage</code>
		respectively).</p></li><li class="listitem"><p><code class="buildtarget">clean</code> removes files
		created by the build process (and goes down the
		directory tree too).
		<code class="buildtarget">cleandir</code> does the same, and
		also removes the object directory, if any.</p></li></ul></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="doc-subdir-mk-conditionals"></a>5.4.2.3. More on Conditionals</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">exists</code> is another condition
	      function which returns true if the given file
	      exists.</p></li><li class="listitem"><p><code class="literal">empty</code> returns true if the given
	      variable is empty.</p></li><li class="listitem"><p><code class="literal">target</code> returns true if the given
	      target does not already exist.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="doc-subdir-mk-looping"></a>5.4.2.4. Looping Constructs in <code class="command">make
	    (.for)</code></h4></div></div></div><p><code class="literal">.for</code> provides a way to repeat a set
	  of instructions for each space-separated element in a
	  variable.  It does this by assigning a variable to contain
	  the current element in the list being examined.</p><pre class="programlisting">_SUBDIRUSE: .USE
.for entry in ${SUBDIR}
	@${ECHO} "===&gt; ${DIRPRFX}${entry}"
	@(cd ${.CURDIR}/${entry} &amp;&amp; \
	${MAKE} ${.TARGET:S/realpackage/package/:S/realinstall/install/} DIRPRFX=${DIRPRFX}${entry}/ )
.endfor</pre><p>In the above, if <code class="varname">SUBDIR</code> is empty, no
	  action is taken; if it has one or more elements, the
	  instructions between <code class="literal">.for</code> and
	  <code class="literal">.endfor</code> would repeat for every element,
	  with <code class="varname">entry</code> being replaced with the value
	  of the current element.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="doc-build-makefiles.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="doc-build.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="the-website.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.3. Understanding <code class="filename">Makefile</code>s in the
      Documentation Tree </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 6. The Website</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>