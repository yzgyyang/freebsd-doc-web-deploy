<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>FreeBSD Architecture Handbook</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><meta name="description" content="Welcome to the FreeBSD Architecture Handbook. This manual is a work in progress and is the work of many individuals. Many sections do not yet exist and some of those that do exist need to be updated. If you are interested in helping with this project, send email to the FreeBSD documentation project mailing list. The latest version of this document is always available from the FreeBSD World Wide Web server. It may also be downloaded in a variety of formats and compression options from the FreeBSD FTP server or one of the numerous mirror sites." /><link rel="home" href="index.html" title="FreeBSD Architecture Handbook" /><link rel="next" href="kernel.html" title="Part I. Kernel" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">FreeBSD Architecture Handbook</th></tr><tr><td width="20%" align="left"> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="kernel.html">Next</a></td></tr></table><hr /></div><div xml:lang="en" class="book" lang="en"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp46763384"></a>FreeBSD Architecture Handbook</h1></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="author"><h3 class="author"><span class="orgname">The FreeBSD Documentation
      Project</span></h3></div></div><div>Revision: <a href="https://svnweb.freebsd.org/changeset/doc/bc0c6af5f7"><span class="svnref">bc0c6af5f7</span></a></div><div><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2000-2006, 2012-2013 The FreeBSD Documentation Project</p></div><div><a xmlns="http://www.w3.org/1999/xhtml" href="trademarks.html">Legal Notice</a></div><div><a xmlns="http://www.w3.org/1999/xhtml" href="legalnotice.html">Copyright</a></div><div>Last modified on 2019-09-05 20:22:58 +0000 by bcr.</div><div><div xmlns="http://www.w3.org/1999/xhtml" class="abstract"><div class="abstract-title">Abstract</div><p>Welcome to the FreeBSD Architecture Handbook.  This manual is
	a
	<span class="emphasis"><em>work in progress</em></span> and is the work of many
	individuals.  Many sections do not yet exist and some of those
	that do exist need to be updated.  If you are interested in
	helping with this project, send email to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc" target="_top">FreeBSD documentation project mailing list</a>.</p><p>The latest version of this document is always available
	from the <a class="link" href="../../../../index.html" target="_top">FreeBSD
	  World Wide Web server</a>.  It may also be downloaded in
	a variety of formats and compression options from the <a class="link" href="https://download.freebsd.org/ftp/doc/" target="_top">FreeBSD
	  FTP server</a> or one of the numerous <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/mirrors-ftp.html" target="_top">mirror
	  sites</a>.</p></div></div></div><div class="docformatnavi">
      [
      
	  Split HTML
	
      /
      <a href="book.html">Single HTML</a>
      ]
    </div><hr /></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="part"><a href="kernel.html">I. Kernel</a></span></dt><dd><dl><dt><span class="chapter"><a href="boot.html">1. Bootstrapping and Kernel Initialization</a></span></dt><dd><dl><dt><span class="sect1"><a href="boot.html#boot-synopsis">1.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="boot-overview.html">1.2. Overview</a></span></dt><dt><span class="sect1"><a href="boot-bios.html">1.3. The <acronym class="acronym">BIOS</acronym></a></span></dt><dt><span class="sect1"><a href="boot-boot0.html">1.4. The Master Boot Record (<code class="literal">boot0</code>)</a></span></dt><dt><span class="sect1"><a href="boot-boot1.html">1.5. <code class="literal">boot1</code> Stage</a></span></dt><dt><span class="sect1"><a href="btx-server.html">1.6. The <acronym class="acronym">BTX</acronym> Server</a></span></dt><dt><span class="sect1"><a href="boot2.html">1.7. <span class="application">boot2</span> Stage</a></span></dt><dt><span class="sect1"><a href="boot-loader.html">1.8. <span class="application">loader</span> Stage</a></span></dt><dt><span class="sect1"><a href="boot-kernel.html">1.9. Kernel Initialization</a></span></dt></dl></dd><dt><span class="chapter"><a href="locking.html">2. Locking Notes</a></span></dt><dd><dl><dt><span class="sect1"><a href="locking.html#locking-mutexes">2.1. Mutexes</a></span></dt><dt><span class="sect1"><a href="locking-sx.html">2.2. Shared Exclusive Locks</a></span></dt><dt><span class="sect1"><a href="locking-atomic.html">2.3. Atomically Protected Variables</a></span></dt></dl></dd><dt><span class="chapter"><a href="kernel-objects.html">3. Kernel Objects</a></span></dt><dd><dl><dt><span class="sect1"><a href="kernel-objects.html#kernel-objects-term">3.1. Terminology</a></span></dt><dt><span class="sect1"><a href="kernel-objects-operation.html">3.2. Kobj Operation</a></span></dt><dt><span class="sect1"><a href="kernel-objects-using.html">3.3. Using Kobj</a></span></dt></dl></dd><dt><span class="chapter"><a href="jail.html">4. The Jail Subsystem</a></span></dt><dd><dl><dt><span class="sect1"><a href="jail.html#jail-arch">4.1. Architecture</a></span></dt><dt><span class="sect1"><a href="jail-restrictions.html">4.2. Restrictions</a></span></dt></dl></dd><dt><span class="chapter"><a href="sysinit.html">5. The SYSINIT Framework</a></span></dt><dd><dl><dt><span class="sect1"><a href="sysinit.html#sysinit-term">5.1. Terminology</a></span></dt><dt><span class="sect1"><a href="sysinit-operation.html">5.2. SYSINIT Operation</a></span></dt><dt><span class="sect1"><a href="sysinit-using.html">5.3. Using SYSINIT</a></span></dt></dl></dd><dt><span class="chapter"><a href="mac.html">6. The TrustedBSD MAC Framework</a></span></dt><dd><dl><dt><span class="sect1"><a href="mac.html#mac-copyright">6.1. MAC Documentation Copyright</a></span></dt><dt><span class="sect1"><a href="mac-synopsis.html">6.2. Synopsis</a></span></dt><dt><span class="sect1"><a href="mac-introduction.html">6.3. Introduction</a></span></dt><dt><span class="sect1"><a href="mac-background.html">6.4. Policy Background</a></span></dt><dt><span class="sect1"><a href="mac-framework-kernel-arch.html">6.5. MAC Framework Kernel Architecture</a></span></dt><dt><span class="sect1"><a href="mac-policy-architecture.html">6.6. MAC Policy Architecture</a></span></dt><dt><span class="sect1"><a href="mac-entry-point-reference.html">6.7. MAC Policy Entry Point Reference</a></span></dt><dt><span class="sect1"><a href="mac-userland-arch.html">6.8. Userland Architecture</a></span></dt><dt><span class="sect1"><a href="mac-conclusion.html">6.9. Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="vm.html">7. Virtual Memory System</a></span></dt><dd><dl><dt><span class="sect1"><a href="vm.html#vm-physmem">7.1. Management of Physical
      Memory&#8212;<code class="literal">vm_page_t</code></a></span></dt><dt><span class="sect1"><a href="vm-cache.html">7.2. The Unified Buffer
      Cache&#8212;<code class="literal">vm_object_t</code></a></span></dt><dt><span class="sect1"><a href="vm-fileio.html">7.3. Filesystem I/O&#8212;<code class="literal">struct buf</code></a></span></dt><dt><span class="sect1"><a href="vm-pagetables.html">7.4. Mapping Page Tables&#8212;<code class="literal">vm_map_t,
	vm_entry_t</code></a></span></dt><dt><span class="sect1"><a href="vm-kvm.html">7.5. KVM Memory Mapping</a></span></dt><dt><span class="sect1"><a href="vm-tuning.html">7.6. Tuning the FreeBSD VM System</a></span></dt></dl></dd><dt><span class="chapter"><a href="smp.html">8. SMPng Design Document</a></span></dt><dd><dl><dt><span class="sect1"><a href="smp.html#smp-intro">8.1. Introduction</a></span></dt><dt><span class="sect1"><a href="smp-lock-fundamentals.html">8.2. Basic Tools and Locking Fundamentals</a></span></dt><dt><span class="sect1"><a href="smp-design.html">8.3. General Architecture and Design</a></span></dt><dt><span class="sect1"><a href="smp-lock-strategies.html">8.4. Specific Locking Strategies</a></span></dt><dt><span class="sect1"><a href="smp-implementation-notes.html">8.5. Implementation Notes</a></span></dt><dt><span class="sect1"><a href="smp-misc.html">8.6. Miscellaneous Topics</a></span></dt><dt><span class="glossary"><a href="smp.html#smp-glossary">Glossary</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="devicedrivers.html">II. Device Drivers</a></span></dt><dd><dl><dt><span class="chapter"><a href="driverbasics.html">9. Writing FreeBSD Device Drivers</a></span></dt><dd><dl><dt><span class="sect1"><a href="driverbasics.html#driverbasics-intro">9.1. Introduction</a></span></dt><dt><span class="sect1"><a href="driverbasics-kld.html">9.2. Dynamic Kernel Linker Facility - KLD</a></span></dt><dt><span class="sect1"><a href="driverbasics-char.html">9.3. Character Devices</a></span></dt><dt><span class="sect1"><a href="driverbasics-block.html">9.4. Block Devices (Are Gone)</a></span></dt><dt><span class="sect1"><a href="driverbasics-net.html">9.5. Network Drivers</a></span></dt></dl></dd><dt><span class="chapter"><a href="isa-driver.html">10. ISA Device Drivers</a></span></dt><dd><dl><dt><span class="sect1"><a href="isa-driver.html#isa-driver-synopsis">10.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="isa-driver-basics.html">10.2. Basic Information</a></span></dt><dt><span class="sect1"><a href="isa-driver-device-t.html">10.3. <code class="varname">device_t</code> Pointer</a></span></dt><dt><span class="sect1"><a href="isa-driver-config.html">10.4. Configuration File and the Order of Identifying and Probing
	During Auto-Configuration</a></span></dt><dt><span class="sect1"><a href="isa-driver-resources.html">10.5. Resources</a></span></dt><dt><span class="sect1"><a href="isa-driver-busmem.html">10.6. Bus Memory Mapping</a></span></dt><dt><span class="sect1"><a href="isa-driver-dma.html">10.7. DMA</a></span></dt><dt><span class="sect1"><a href="isa-driver-probe.html">10.8. xxx_isa_probe</a></span></dt><dt><span class="sect1"><a href="isa-driver-attach.html">10.9. xxx_isa_attach</a></span></dt><dt><span class="sect1"><a href="isa-driver-detach.html">10.10. xxx_isa_detach</a></span></dt><dt><span class="sect1"><a href="isa-driver-shutdown.html">10.11. xxx_isa_shutdown</a></span></dt><dt><span class="sect1"><a href="isa-driver-intr.html">10.12. xxx_intr</a></span></dt></dl></dd><dt><span class="chapter"><a href="pci.html">11. PCI Devices</a></span></dt><dd><dl><dt><span class="sect1"><a href="pci.html#pci-probe">11.1. Probe and Attach</a></span></dt><dt><span class="sect1"><a href="pci-bus.html">11.2. Bus Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="scsi.html">12. Common Access Method SCSI Controllers</a></span></dt><dd><dl><dt><span class="sect1"><a href="scsi.html#scsi-synopsis">12.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="scsi-general.html">12.2. General Architecture</a></span></dt><dt><span class="sect1"><a href="scsi-polling.html">12.3. Polling</a></span></dt><dt><span class="sect1"><a href="scsi-async.html">12.4. Asynchronous Events</a></span></dt><dt><span class="sect1"><a href="scsi-interrupts.html">12.5. Interrupts</a></span></dt><dt><span class="sect1"><a href="scsi-errors.html">12.6. Errors Summary</a></span></dt><dt><span class="sect1"><a href="scsi-timeout.html">12.7. Timeout Handling</a></span></dt></dl></dd><dt><span class="chapter"><a href="usb.html">13. USB Devices</a></span></dt><dd><dl><dt><span class="sect1"><a href="usb.html#usb-intro">13.1. Introduction</a></span></dt><dt><span class="sect1"><a href="usb-hc.html">13.2. Host Controllers</a></span></dt><dt><span class="sect1"><a href="usb-dev.html">13.3. USB Device Information</a></span></dt><dt><span class="sect1"><a href="usb-devprobe.html">13.4. Device Probe and Attach</a></span></dt><dt><span class="sect1"><a href="usb-protocol.html">13.5. USB Drivers Protocol Information</a></span></dt></dl></dd><dt><span class="chapter"><a href="newbus.html">14. Newbus</a></span></dt><dd><dl><dt><span class="sect1"><a href="newbus.html#newbus-devdrivers">14.1. Device Drivers</a></span></dt><dt><span class="sect1"><a href="newbus-overview.html">14.2. Overview of Newbus</a></span></dt><dt><span class="sect1"><a href="newbus-api.html">14.3. Newbus API</a></span></dt></dl></dd><dt><span class="chapter"><a href="oss.html">15. Sound Subsystem</a></span></dt><dd><dl><dt><span class="sect1"><a href="oss.html#oss-intro">15.1. Introduction</a></span></dt><dt><span class="sect1"><a href="oss-files.html">15.2. Files</a></span></dt><dt><span class="sect1"><a href="pcm-probe-and-attach.html">15.3. Probing, Attaching, etc.</a></span></dt><dt><span class="sect1"><a href="oss-interfaces.html">15.4. Interfaces</a></span></dt></dl></dd><dt><span class="chapter"><a href="pccard.html">16. PC Card</a></span></dt><dd><dl><dt><span class="sect1"><a href="pccard.html#pccard-adddev">16.1. Adding a Device</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="appendices.html">III. Appendices</a></span></dt><dd><dl><dt><span class="bibliography"><a href="bi01.html">Bibliography</a></span></dt></dl></dd><dt><span class="index"><a href="ix01.html">Index</a></span></dt></dl></div><div class="list-of-figures"><div class="toc-title">List of Figures</div><dl><dt>1.1. <a href="boot-boot0.html#boot-boot0-makefile-as-is"><code class="filename">sys/boot/i386/boot0/Makefile</code></a></dt><dt>1.2. <a href="boot-boot0.html#boot-boot0-entrypoint"><code class="filename">sys/boot/i386/boot0/boot0.S</code></a></dt><dt>1.3. <a href="boot-boot0.html#boot-boot0-relocation"><code class="filename">sys/boot/i386/boot0/boot0.S</code></a></dt><dt>1.4. <a href="boot-boot0.html#boot-boot0-drivenumber"><code class="filename">sys/boot/i386/boot0/boot0.S</code></a></dt><dt>1.5. <a href="boot-boot0.html#boot-boot0-savedrivenumber"><code class="filename">sys/boot/i386/boot0/boot0.S</code></a></dt><dt>1.6. <a href="boot-boot0.html#boot-boot0-partition-scan"><code class="filename">sys/boot/i386/boot0/boot0.S</code></a></dt><dt>1.7. <a href="boot-boot0.html#boot-boot0-test-drives"><code class="filename">sys/boot/i386/boot0/boot0.S</code></a></dt><dt>1.8. <a href="boot-boot0.html#boot-boot0-prompt"><code class="filename">sys/boot/i386/boot0/boot0.S</code></a></dt><dt>1.9. <a href="boot-boot0.html#boot-boot0-start-input"><code class="filename">sys/boot/i386/boot0/boot0.S</code></a></dt><dt>1.10. <a href="boot-boot0.html#boot-boot0-check-bootable"><code class="filename">sys/boot/i386/boot0/boot0.S</code></a></dt><dt>1.11. <a href="boot-boot1.html#boot-boot1-entry"><code class="filename">sys/boot/i386/boot2/boot1.S</code></a></dt><dt>1.12. <a href="boot-boot1.html#boot-boot1-main"><code class="filename">sys/boot/i386/boot2/boot1.S</code></a></dt><dt>1.13. <a href="boot-boot1.html#boot-boot1-find-freebsd"><code class="filename">sys/boot/i386/boot2/boot1.S</code></a></dt><dt>1.14. <a href="boot-boot1.html#boot-boot2-make-fake-partition"><code class="filename">sys/boot/i386/boot2/Makefile</code></a></dt><dt>1.15. <a href="boot-boot1.html#boot-boot1-nread"><code class="filename">sys/boot/i386/boot2/boot1.S</code></a></dt><dt>1.16. <a href="boot-boot1.html#boot-boot1-xread1"><code class="filename">sys/boot/i386/boot2/boot1.S</code></a></dt><dt>1.17. <a href="boot-boot1.html#boot-boot1-find-part"><code class="filename">sys/boot/i386/boot2/boot1.S</code></a></dt><dt>1.18. <a href="boot-boot1.html#boot-boot1-main5"><code class="filename">sys/boot/i386/boot2/boot1.S</code></a></dt><dt>1.19. <a href="boot-boot1.html#boot-boot1-seta20"><code class="filename">sys/boot/i386/boot2/boot1.S</code></a></dt><dt>1.20. <a href="btx-server.html#boot-boot1-make-boot"><code class="filename">sys/boot/i386/boot2/Makefile</code></a></dt><dt>1.21. <a href="btx-server.html#boot-boot1-make-boot1"><code class="filename">sys/boot/i386/boot2/Makefile</code></a></dt><dt>1.22. <a href="btx-server.html#boot-boot1-make-boot2"><code class="filename">sys/boot/i386/boot2/Makefile</code></a></dt><dt>1.23. <a href="btx-server.html#boot-boot1-make-boot2-more"><code class="filename">sys/boot/i386/boot2/Makefile</code></a></dt><dt>1.24. <a href="btx-server.html#boot-boot1-make-boot2h"><code class="filename">sys/boot/i386/boot2/boot2.h</code></a></dt><dt>1.25. <a href="btx-server.html#btx-header"><code class="filename">sys/boot/i386/btx/btx/btx.S</code></a></dt><dt>1.26. <a href="btx-server.html#btx-init"><code class="filename">sys/boot/i386/btx/btx/btx.S</code></a></dt><dt>1.27. <a href="btx-server.html#btx-clear-mem"><code class="filename">sys/boot/i386/btx/btx/btx.S</code></a></dt><dt>1.28. <a href="btx-server.html#btx-ivt"><code class="filename">sys/boot/i386/btx/btx/btx.S</code></a></dt><dt>1.29. <a href="btx-server.html#btx-idt"><code class="filename">sys/boot/i386/btx/btx/btx.S</code></a></dt><dt>1.30. <a href="btx-server.html#btx-tss"><code class="filename">sys/boot/i386/btx/btx/btx.S</code></a></dt><dt>1.31. <a href="btx-server.html#btx-prot"><code class="filename">sys/boot/i386/btx/btx/btx.S</code></a></dt><dt>1.32. <a href="btx-server.html#btx-end"><code class="filename">sys/boot/i386/btx/btx/btx.S</code></a></dt><dt>14.1. <a href="newbus-api.html#idp56927480"><span class="emphasis"><em>driver_t</em></span> Implementation</a></dt><dt>14.2. <a href="newbus-api.html#idp56930040">Device
	  States <span class="emphasis"><em>device_state_t</em></span></a></dt></dl></div><div class="list-of-tables"><div class="toc-title">List of Tables</div><dl><dt>2.1. <a href="locking.html#idp51147896">Mutex List</a></dt><dt>2.2. <a href="locking-sx.html#idp51260280">Shared Exclusive Lock List</a></dt></dl></div><div class="list-of-examples"><div class="toc-title">List of Examples</div><dl><dt>5.1. <a href="sysinit-using.html#idp51654904">Example of a <code class="literal">SYSINIT()</code></a></dt><dt>5.2. <a href="sysinit-using.html#idp51662200">Example of Adjusting <code class="literal">SYSINIT()</code>
	  Order</a></dt><dt>5.3. <a href="sysinit-using.html#idp51665656">Example of a <code class="literal">SYSUNINIT()</code></a></dt><dt>9.1. <a href="driverbasics-char.html#idp56076536">Example of a Sample Echo Pseudo-Device Driver for
	FreeBSD 10.X - 12.X</a></dt><dt>14.1. <a href="newbus-overview.html#idp57434360">Newbus Methods</a></dt></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="kernel.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"> </td><td width="40%" align="right" valign="top"> Part I. Kernel</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>