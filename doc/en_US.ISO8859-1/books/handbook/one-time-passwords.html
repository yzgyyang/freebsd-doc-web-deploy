<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>13.3. One-time Passwords</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="FreeBSD Handbook" /><link rel="up" href="security.html" title="Chapter 13. Security" /><link rel="prev" href="security-intro.html" title="13.2. Introduction" /><link rel="next" href="tcpwrappers.html" title="13.4. TCP Wrapper" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">13.3. One-time Passwords</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="security-intro.html">Prev</a> </td><th width="60%" align="center">Chapter 13. Security</th><td width="20%" align="right"> <a accesskey="n" href="tcpwrappers.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="one-time-passwords"></a>13.3. One-time Passwords</h2></div></div></div><a id="idp58849528" class="indexterm"></a><a id="idp58850040" class="indexterm"></a><p>By default, FreeBSD includes support for One-time Passwords In
      Everything (<acronym class="acronym">OPIE</acronym>).  <acronym class="acronym">OPIE</acronym>
      is designed to prevent replay attacks, in which an attacker
      discovers a user's password and uses it to access a system.
      Since a password is only used once in <acronym class="acronym">OPIE</acronym>, a
      discovered password is of little use to an attacker.
      <acronym class="acronym">OPIE</acronym> uses a secure hash and a
      challenge/response system to manage passwords.  The FreeBSD
      implementation uses the <acronym class="acronym">MD5</acronym> hash by
      default.</p><p><acronym class="acronym">OPIE</acronym> uses three different types of
      passwords.  The first is the usual <span class="trademark">UNIX</span>® or Kerberos password.
      The second is the one-time password which is generated by
      <code class="command">opiekey</code>.  The third type of password is the
      <span class="quote">&#8220;<span class="quote">secret password</span>&#8221;</span> which is used to generate
      one-time passwords.  The secret password has nothing to do with,
      and should be different from, the <span class="trademark">UNIX</span>® password.</p><p>There are two other pieces of data that are important to
      <acronym class="acronym">OPIE</acronym>.  One is the <span class="quote">&#8220;<span class="quote">seed</span>&#8221;</span> or
      <span class="quote">&#8220;<span class="quote">key</span>&#8221;</span>, consisting of two letters and five digits.
      The other is the <span class="quote">&#8220;<span class="quote">iteration count</span>&#8221;</span>, a number
      between 1 and 100.  <acronym class="acronym">OPIE</acronym> creates the one-time
      password by concatenating the seed and the secret password,
      applying the <acronym class="acronym">MD5</acronym> hash as many times as
      specified by the iteration count, and turning the result into
      six short English words which represent the one-time password.
      The authentication system keeps track of the last one-time
      password used, and the user is authenticated if the hash of the
      user-provided password is equal to the previous password.
      Because a one-way hash is used, it is impossible to generate
      future one-time passwords if a successfully used password is
      captured.  The iteration count is decremented after each
      successful login to keep the user and the login program in sync.
      When the iteration count gets down to <code class="literal">1</code>,
      <acronym class="acronym">OPIE</acronym> must be reinitialized.</p><p>There are a few programs involved in this process.  A
      one-time password, or a consecutive list of one-time passwords,
      is generated by passing an iteration count, a seed, and a secret
      password to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a>.  In addition to initializing
      <acronym class="acronym">OPIE</acronym>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiepasswd</span>(1)</span></a> is used to change
      passwords, iteration counts, or seeds.  The relevant credential
      files in <code class="filename">/etc/opiekeys</code> are examined by
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opieinfo&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opieinfo</span>(1)</span></a> which prints out the invoking user's current
      iteration count and seed.</p><p>This section describes four different sorts of operations.
      The first is how to set up one-time-passwords for the first time
      over a secure connection.  The second is how to use
      <code class="command">opiepasswd</code> over an insecure connection.  The
      third is how to log in over an insecure connection.  The fourth
      is how to generate a number of keys which can be written down or
      printed out to use at insecure locations.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp58871928"></a>13.3.1. Initializing <acronym class="acronym">OPIE</acronym></h3></div></div></div><p>To initialize <acronym class="acronym">OPIE</acronym> for the first time,
	run this command from a secure location:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiepasswd -c</code></strong>
Adding unfurl:
Only use this method from the console; NEVER from remote. If you are using
telnet, xterm, or a dial-in, type ^C now or exit with no password.
Then run opiepasswd without the -c parameter.
Using MD5 to compute responses.
Enter new secret pass phrase:
Again new secret pass phrase:

ID unfurl OTP key is 499 to4268
MOS MALL GOAT ARM AVID COED</pre><p>The <code class="option">-c</code> sets console mode which assumes
	that the command is being run from a secure location, such as
	a computer under the user's control or a
	<acronym class="acronym">SSH</acronym> session to a computer under the user's
	control.</p><p>When prompted, enter the secret password which will be
	used to generate the one-time login keys.  This password
	should be difficult to guess and should be different than the
	password which is associated with the user's login account.
	It must be between 10 and 127 characters long.  Remember this
	password.</p><p>The <code class="literal">ID</code> line lists the login name
	(<code class="literal">unfurl</code>), default iteration count
	(<code class="literal">499</code>), and default seed
	(<code class="literal">to4268</code>).  When logging in, the system will
	remember these parameters and display them, meaning that they
	do not have to be memorized.  The last line lists the
	generated one-time password which corresponds to those
	parameters and the secret password.  At the next login, use
	this one-time password.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp58878200"></a>13.3.2. Insecure Connection Initialization</h3></div></div></div><p>To initialize or change the secret password on an
	insecure system, a secure connection is needed to some place
	where <code class="command">opiekey</code> can be run.  This might be a
	shell prompt on a trusted machine.  An iteration count is
	needed, where 100 is probably a good value, and the seed can
	either be specified or the randomly-generated one used.  On
	the insecure connection, the machine being initialized, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiepasswd</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiepasswd</code></strong>

Updating unfurl:
You need the response from an OTP generator.
Old secret pass phrase:
	otp-md5 498 to4268 ext
	Response: GAME GAG WELT OUT DOWN CHAT
New secret pass phrase:
	otp-md5 499 to4269
	Response: LINE PAP MILK NELL BUOY TROY

ID mark OTP key is 499 gr4269
LINE PAP MILK NELL BUOY TROY</pre><p>To accept the default seed, press <span class="keycap"><strong>Return</strong></span>.
	Before entering an access password, move over to the secure
	connection and give it the same parameters:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey 498 to4268</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</pre><p>Switch back over to the insecure connection, and copy the
	generated one-time password over to the relevant
	program.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp58888056"></a>13.3.3. Generating a Single One-time Password</h3></div></div></div><p>After initializing <acronym class="acronym">OPIE</acronym> and logging in,
	a prompt like this will be displayed:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>telnet example.com</code></strong>
Trying 10.0.0.1...
Connected to example.com
Escape character is '^]'.

FreeBSD/i386 (example.com) (ttypa)

login: <strong class="userinput"><code>&lt;username&gt;</code></strong>
otp-md5 498 gr4269 ext
Password: </pre><p>The <acronym class="acronym">OPIE</acronym> prompts provides a useful
	feature.  If <span class="keycap"><strong>Return</strong></span> is pressed at the
	password prompt, the prompt will turn echo on and display
	what is typed.  This can be useful when attempting to type in
	a password by hand from a printout.</p><a id="idp58904440" class="indexterm"></a><a id="idp58904952" class="indexterm"></a><a id="idp58905464" class="indexterm"></a><p>At this point, generate the one-time password to answer
	this login prompt.  This must be done on a trusted system
	where it is safe to run <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a>.  There are versions
	of this command for <span class="trademark">Windows</span>®, <span class="trademark">Mac OS</span>® and FreeBSD.  This command
	needs the iteration count and the seed as command line
	options.  Use cut-and-paste from the login prompt on the
	machine being logged in to.</p><p>On the trusted system:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey 498 to4268</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</pre><p>Once the one-time password is generated, continue to log
	in.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp58910072"></a>13.3.4. Generating Multiple One-time Passwords</h3></div></div></div><p>Sometimes there is no access to a trusted machine or
	secure connection.  In this case, it is possible to use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a> to generate a number of one-time passwords
	beforehand.  For example:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey -n 5 30 zz99999</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: <strong class="userinput"><code>&lt;secret password&gt;</code></strong>
26: JOAN BORE FOSS DES NAY QUIT
27: LATE BIAS SLAY FOLK MUCH TRIG
28: SALT TIN ANTI LOON NEAL USE
29: RIO ODIN GO BYE FURY TIC
30: GREW JIVE SAN GIRD BOIL PHI</pre><p>The <code class="option">-n 5</code> requests five keys in sequence,
	and <code class="option">30</code> specifies what the last iteration
	number should be.  Note that these are printed out in
	<span class="emphasis"><em>reverse</em></span> order of use.  The really
	paranoid might want to write the results down by hand;
	otherwise, print the list.  Each line shows both the iteration
	count and the one-time password.  Scratch off the passwords as
	they are used.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp58914936"></a>13.3.5. Restricting Use of <span class="trademark">UNIX</span>® Passwords</h3></div></div></div><p><acronym class="acronym">OPIE</acronym> can restrict the use of <span class="trademark">UNIX</span>®
	passwords based on the IP address of a login session.  The
	relevant file is <code class="filename">/etc/opieaccess</code>, which
	is present by default.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opieaccess&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opieaccess</span>(5)</span></a> for more
	information on this file and which security considerations to
	be aware of when using it.</p><p>Here is a sample <code class="filename">opieaccess</code>:</p><pre class="programlisting">permit 192.168.0.0 255.255.0.0</pre><p>This line allows users whose IP source address (which is
	vulnerable to spoofing) matches the specified value and mask,
	to use <span class="trademark">UNIX</span>® passwords at any time.</p><p>If no rules in <code class="filename">opieaccess</code> are
	matched, the default is to deny non-<acronym class="acronym">OPIE</acronym>
	logins.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="security-intro.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="tcpwrappers.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">13.2. Introduction </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 13.4. TCP Wrapper</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>