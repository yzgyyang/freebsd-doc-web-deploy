<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>8.5. Building and Installing a Custom Kernel</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="FreeBSD Handbook" /><link rel="up" href="kernelconfig.html" title="Chapter 8. Configuring the FreeBSD Kernel" /><link rel="prev" href="kernelconfig-config.html" title="8.4. The Configuration File" /><link rel="next" href="kernelconfig-trouble.html" title="8.6. If Something Goes Wrong" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">8.5. Building and Installing a Custom Kernel</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kernelconfig-config.html">Prev</a> </td><th width="60%" align="center">Chapter 8. Configuring the FreeBSD Kernel</th><td width="20%" align="right"> <a accesskey="n" href="kernelconfig-trouble.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-building"></a>8.5. Building and Installing a Custom Kernel</h2></div></div></div><p>Once the edits to the custom configuration file have been
      saved, the source code for the kernel can be compiled using the
      following steps:</p><div class="procedure"><a id="idp55883896"></a><div class="procedure-title">Procedure 8.1. Building a Kernel</div><a id="idp55884536" class="indexterm"></a><ol class="procedure" type="1"><li class="step"><p>Change to this directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre></li><li class="step"><p>Compile the new kernel by specifying the name of the
	  custom kernel configuration file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=<em class="replaceable"><code>MYKERNEL</code></em></code></strong></pre></li><li class="step"><p>Install the new kernel associated with the specified
	  kernel configuration file.  This command will copy the new
	  kernel to <code class="filename">/boot/kernel/kernel</code> and save
	  the old kernel to
	  <code class="filename">/boot/kernel.old/kernel</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=<em class="replaceable"><code>MYKERNEL</code></em></code></strong></pre></li><li class="step"><p>Shutdown the system and reboot into the new kernel.
	  If something goes wrong, refer to <a class="xref" href="kernelconfig-trouble.html#kernelconfig-noboot">The kernel does not boot</a>.</p></li></ol></div><p>By default, when a custom kernel is compiled, all kernel
      modules are rebuilt.  To update a kernel faster or to build
      only custom modules, edit <code class="filename">/etc/make.conf</code>
      before starting to build the kernel.</p><p>For example, this variable specifies the list of modules to
      build instead of using the default of building all
      modules:</p><pre class="programlisting">MODULES_OVERRIDE = linux acpi</pre><p>Alternately, this variable lists which modules to exclude
      from the build process:</p><pre class="programlisting">WITHOUT_MODULES = linux acpi sound</pre><p>Additional variables are available.  Refer to
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a> for details.</p><a id="idp55921272" class="indexterm"></a></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernelconfig-config.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="kernelconfig.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="kernelconfig-trouble.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">8.4. The Configuration File </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 8.6. If Something Goes Wrong</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>