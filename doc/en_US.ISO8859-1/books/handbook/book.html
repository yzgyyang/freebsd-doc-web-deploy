<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>FreeBSD Handbook</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><meta name="description" content="Welcome to FreeBSD! This handbook covers the installation and day to day use of FreeBSD 12.1-RELEASE and FreeBSD 11.4-RELEASE. This book is the result of ongoing work by many individuals. Some sections might be outdated. Those interested in helping to update and expand this document should send email to the FreeBSD documentation project mailing list. The latest version of this book is available from the FreeBSD web site. Previous versions can be obtained from https://docs.FreeBSD.org/doc/. The book can be downloaded in a variety of formats and compression options from the FreeBSD FTP server or one of the numerous mirror sites. Printed copies can be purchased at the FreeBSD Mall. Searches can be performed on the handbook and other documents on the search page." /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div xml:lang="en" class="book" lang="en"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp44147832"></a>FreeBSD Handbook</h1></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="author"><h3 class="author"><span class="orgname">The FreeBSD Documentation Project</span></h3></div></div><div>Revision: <a href="https://svnweb.freebsd.org/changeset/doc/a011126a3b"><span class="svnref">a011126a3b</span></a></div><div><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 1995-2020 The FreeBSD Documentation Project</p></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="legalnotice"><a id="legalnotice"></a><p class="legalnotice-title"><strong>Copyright</strong></p><p>Redistribution and use in source (XML DocBook) and 'compiled'
    forms (XML, HTML, PDF, PostScript, RTF and so forth) with or without
    modification, are permitted provided that the following conditions are
    met:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Redistributions of source code (XML DocBook) must retain the
        above copyright notice, this list of conditions and the following
        disclaimer as the first lines of this file unmodified.</p></li><li class="listitem"><p>Redistributions in compiled form (transformed to other DTDs,
        converted to PDF, PostScript, RTF and other formats) must
        reproduce the above copyright notice, this list of conditions and
        the following disclaimer in the documentation and/or other
        materials provided with the distribution.</p></li></ol></div><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">THIS DOCUMENTATION IS PROVIDED BY THE FREEBSD DOCUMENTATION
      PROJECT "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
      BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
      FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
      THE FREEBSD DOCUMENTATION PROJECT BE LIABLE FOR ANY DIRECT, INDIRECT,
      INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
      BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS
      OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
      ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
      TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
      USE OF THIS DOCUMENTATION, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
      DAMAGE.</p></div></div></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="legalnotice"><a id="trademarks"></a><p>FreeBSD is a registered trademark of
  the FreeBSD Foundation.</p><p>3Com and HomeConnect are registered
  trademarks of 3Com Corporation.</p><p>3ware is a registered
  trademark of 3ware Inc.</p><p>ARM is a registered trademark of ARM
  Limited.</p><p>Adaptec is a registered trademark of
  Adaptec, Inc.</p><p>Adobe, Acrobat, Acrobat Reader, Flash and
  PostScript are either registered trademarks or trademarks of Adobe
  Systems Incorporated in the United States and/or other
  countries.</p><p>Apple, AirPort, FireWire,
  iMac, iPhone, iPad,
  Mac, Macintosh, Mac OS,
  Quicktime, and TrueType are trademarks of Apple Inc.,
  registered in the U.S. and other countries.</p><p>Android
  is a trademark of Google Inc.</p><p>Heidelberg, Helvetica,
  Palatino, and Times Roman are either registered trademarks or
  trademarks of Heidelberger Druckmaschinen AG in the U.S. and other
  countries.</p><p>IBM, AIX, OS/2,
  PowerPC, PS/2, S/390, and ThinkPad are
  trademarks of International Business Machines Corporation in the
  United States, other countries, or both.</p><p>IEEE, POSIX, and 802 are registered
  trademarks of Institute of Electrical and Electronics Engineers,
  Inc. in the United States.</p><p>Intel, Celeron, Centrino, Core, EtherExpress, i386,
  i486, Itanium, Pentium, and Xeon are trademarks or registered
  trademarks of Intel Corporation or its subsidiaries in the United
  States and other countries.</p><p>Intuit and Quicken are registered
  trademarks and/or registered service marks of Intuit Inc., or one of
  its subsidiaries, in the United States and other countries.</p><p>Linux is a registered trademark of
  Linus Torvalds.</p><p>LSI Logic, AcceleRAID, eXtremeRAID,
  MegaRAID and Mylex are trademarks or registered trademarks of LSI
  Logic Corp.</p><p>Microsoft, IntelliMouse, MS-DOS,
  Outlook, Windows, Windows Media and Windows NT are either
  registered trademarks or trademarks of Microsoft Corporation in the
  United States and/or other countries.</p><p>Motif, OSF/1, and UNIX are
  registered trademarks and IT DialTone and The Open Group are
  trademarks of The Open Group in the United States and other
  countries.</p><p>Oracle is a registered trademark
  of Oracle Corporation.</p><p>RealNetworks, RealPlayer, and
  RealAudio are the registered trademarks of RealNetworks,
  Inc.</p><p>Red Hat, RPM, are trademarks or
  registered trademarks of Red Hat, Inc. in the United States and
  other countries.</p><p>Sun, Sun Microsystems, Java, Java
  Virtual Machine, JDK, JRE, JSP, JVM, Netra, OpenJDK,
  Solaris, StarOffice, SunOS
  and VirtualBox are trademarks or registered trademarks of
  Sun Microsystems, Inc. in the United States and other countries.</p><p>MATLAB is a registered trademark
  of The MathWorks, Inc.</p><p>SpeedTouch is a trademark of
  Thomson.</p><p>VMware is a trademark of VMware,
  Inc.</p><p>Mathematica is a registered
  trademark of Wolfram Research, Inc.</p><p>XFree86 is a trademark of The
  XFree86 Project, Inc.</p><p>Ogg Vorbis and Xiph.Org are trademarks
  of Xiph.Org.</p><p>Many of the designations used by
  manufacturers and sellers to distinguish their products are claimed
  as trademarks.  Where those designations appear in this document,
  and the FreeBSD Project was aware of the trademark claim, the
  designations have been followed by the <span class="quote">&#8220;<span class="quote">&#8482;</span>&#8221;</span> or the
  <span class="quote">&#8220;<span class="quote">®</span>&#8221;</span> symbol.</p></div></div><div>Last modified on 2020-10-04 05:07:49 +0000 by trhodes.</div><div><div xmlns="http://www.w3.org/1999/xhtml" class="abstract"><div class="abstract-title">Abstract</div><p>Welcome to FreeBSD! This handbook covers the installation
	and day to day use of
	<span class="emphasis"><em>FreeBSD 12.1-RELEASE</em></span> and
	<span class="emphasis"><em>FreeBSD 11.4-RELEASE</em></span>.  This book
	is the result of ongoing work by many individuals.  Some
	sections might be outdated.  Those interested in helping to
	update and expand this document should send email to the
	<a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc" target="_top">FreeBSD documentation project mailing list</a>.</p><p>The latest version of this book is available from the
	<a class="link" href="https://www.FreeBSD.org/" target="_top">FreeBSD web
	  site</a>.  Previous versions can be obtained from <code class="uri"><a class="uri" href="https://docs.FreeBSD.org/doc/" target="_top">https://docs.FreeBSD.org/doc/</a></code>.
	The book can be downloaded in a variety of formats and
	compression options from the <a class="link" href="https://download.freebsd.org/ftp/doc/" target="_top">FreeBSD
	  FTP server</a> or one of the numerous
	<a class="link" href="#mirrors-ftp" title="A.2. FTP Sites">mirror sites</a>.  Printed
	copies can be purchased at the
	<a class="link" href="https://www.freebsdmall.com/" target="_top">FreeBSD
	  Mall</a>.  Searches can be performed on the handbook and
	other documents on the
	<a class="link" href="../../../../search/index.html" target="_top">search
	  page</a>.</p></div></div></div><div class="docformatnavi">
      [
      <a href="index.html">Split HTML</a>
      /
      
	  Single HTML
	
      ]
    </div><hr /></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="preface"><a href="#book-preface">Preface</a></span></dt><dt><span class="part"><a href="#getting-started">I. Getting Started</a></span></dt><dd><dl><dt><span class="chapter"><a href="#introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="sect1"><a href="#introduction-synopsis">1.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#nutshell">1.2. Welcome to FreeBSD!</a></span></dt><dt><span class="sect1"><a href="#history">1.3. About the FreeBSD Project</a></span></dt></dl></dd><dt><span class="chapter"><a href="#bsdinstall">2. Installing FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#bsdinstall-synopsis">2.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-hardware">2.2. Minimum Hardware Requirements</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-pre">2.3. Pre-Installation Tasks</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-start">2.4. Starting the Installation</a></span></dt><dt><span class="sect1"><a href="#using-bsdinstall">2.5. Using <span class="application">bsdinstall</span></a></span></dt><dt><span class="sect1"><a href="#bsdinstall-partitioning">2.6. Allocating Disk Space</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-fetching-distribution">2.7. Fetching Distribution Files</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-post">2.8. Accounts, Time Zone, Services and Hardening</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-network">2.9. Network Interfaces</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-install-trouble">2.10. Troubleshooting</a></span></dt><dt><span class="sect1"><a href="#using-live-cd">2.11. Using the Live <acronym class="acronym">CD</acronym></a></span></dt></dl></dd><dt><span class="chapter"><a href="#basics">3. FreeBSD Basics</a></span></dt><dd><dl><dt><span class="sect1"><a href="#basics-synopsis">3.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#consoles">3.2. Virtual Consoles and Terminals</a></span></dt><dt><span class="sect1"><a href="#users-synopsis">3.3. Users and Basic Account Management</a></span></dt><dt><span class="sect1"><a href="#permissions">3.4. Permissions</a></span></dt><dt><span class="sect1"><a href="#dirstructure">3.5. Directory Structure</a></span></dt><dt><span class="sect1"><a href="#disk-organization">3.6. Disk Organization</a></span></dt><dt><span class="sect1"><a href="#mount-unmount">3.7. Mounting and Unmounting File Systems</a></span></dt><dt><span class="sect1"><a href="#basics-processes">3.8. Processes and Daemons</a></span></dt><dt><span class="sect1"><a href="#shells">3.9. Shells</a></span></dt><dt><span class="sect1"><a href="#editors">3.10. Text Editors</a></span></dt><dt><span class="sect1"><a href="#basics-devices">3.11. Devices and Device Nodes</a></span></dt><dt><span class="sect1"><a href="#basics-more-information">3.12. Manual Pages</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ports">4. Installing Applications: Packages and Ports</a></span></dt><dd><dl><dt><span class="sect1"><a href="#ports-synopsis">4.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#ports-overview">4.2. Overview of Software Installation</a></span></dt><dt><span class="sect1"><a href="#ports-finding-applications">4.3. Finding Software</a></span></dt><dt><span class="sect1"><a href="#pkgng-intro">4.4. Using <span class="application">pkg</span> for Binary Package
      Management</a></span></dt><dt><span class="sect1"><a href="#ports-using">4.5. Using the Ports Collection</a></span></dt><dt><span class="sect1"><a href="#ports-poudriere">4.6. Building Packages with
      <span class="application">Poudriere</span></a></span></dt><dt><span class="sect1"><a href="#ports-nextsteps">4.7. Post-Installation Considerations</a></span></dt><dt><span class="sect1"><a href="#ports-broken">4.8. Dealing with Broken Ports</a></span></dt></dl></dd><dt><span class="chapter"><a href="#x11">5. The X Window System</a></span></dt><dd><dl><dt><span class="sect1"><a href="#x11-synopsis">5.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#x-understanding">5.2. Terminology</a></span></dt><dt><span class="sect1"><a href="#x-install">5.3. Installing <span class="application">Xorg</span></a></span></dt><dt><span class="sect1"><a href="#x-config">5.4. <span class="application">Xorg</span> Configuration</a></span></dt><dt><span class="sect1"><a href="#x-fonts">5.5. Using Fonts in <span class="application">Xorg</span></a></span></dt><dt><span class="sect1"><a href="#x-xdm">5.6. The X Display Manager</a></span></dt><dt><span class="sect1"><a href="#x11-wm">5.7. Desktop Environments</a></span></dt><dt><span class="sect1"><a href="#x-compiz-fusion">5.8. Installing Compiz Fusion</a></span></dt><dt><span class="sect1"><a href="#x11-troubleshooting">5.9. Troubleshooting</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#common-tasks">II. Common Tasks</a></span></dt><dd><dl><dt><span class="chapter"><a href="#desktop">6. Desktop Applications</a></span></dt><dd><dl><dt><span class="sect1"><a href="#desktop-synopsis">6.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#desktop-browsers">6.2. Browsers</a></span></dt><dt><span class="sect1"><a href="#desktop-productivity">6.3. Productivity</a></span></dt><dt><span class="sect1"><a href="#desktop-viewers">6.4. Document Viewers</a></span></dt><dt><span class="sect1"><a href="#desktop-finance">6.5. Finance</a></span></dt></dl></dd><dt><span class="chapter"><a href="#multimedia">7. Multimedia</a></span></dt><dd><dl><dt><span class="sect1"><a href="#multimedia-synopsis">7.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#sound-setup">7.2. Setting Up the Sound Card</a></span></dt><dt><span class="sect1"><a href="#sound-mp3">7.3. MP3 Audio</a></span></dt><dt><span class="sect1"><a href="#video-playback">7.4. Video Playback</a></span></dt><dt><span class="sect1"><a href="#tvcard">7.5. TV Cards</a></span></dt><dt><span class="sect1"><a href="#mythtv">7.6. MythTV</a></span></dt><dt><span class="sect1"><a href="#scanners">7.7. Image Scanners</a></span></dt></dl></dd><dt><span class="chapter"><a href="#kernelconfig">8. Configuring the FreeBSD Kernel</a></span></dt><dd><dl><dt><span class="sect1"><a href="#kernelconfig-synopsis">8.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-custom-kernel">8.2. Why Build a Custom Kernel?</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-devices">8.3. Finding the System Hardware</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-config">8.4. The Configuration File</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-building">8.5. Building and Installing a Custom Kernel</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-trouble">8.6. If Something Goes Wrong</a></span></dt></dl></dd><dt><span class="chapter"><a href="#printing">9. Printing</a></span></dt><dd><dl><dt><span class="sect1"><a href="#printing-quick-start">9.1. Quick Start</a></span></dt><dt><span class="sect1"><a href="#printing-connections">9.2. Printer Connections</a></span></dt><dt><span class="sect1"><a href="#printing-pdls">9.3. Common Page Description Languages</a></span></dt><dt><span class="sect1"><a href="#printing-direct">9.4. Direct Printing</a></span></dt><dt><span class="sect1"><a href="#printing-lpd">9.5. <acronym class="acronym">LPD</acronym> (Line Printer Daemon)</a></span></dt><dt><span class="sect1"><a href="#printing-other">9.6. Other Printing Systems</a></span></dt></dl></dd><dt><span class="chapter"><a href="#linuxemu">10. <span class="trademark">Linux</span>® Binary Compatibility</a></span></dt><dd><dl><dt><span class="sect1"><a href="#linuxemu-synopsis">10.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#linuxemu-lbc-install">10.2. Configuring <span class="trademark">Linux</span>® Binary Compatibility</a></span></dt><dt><span class="sect1"><a href="#linuxemu-advanced">10.3. Advanced Topics</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#system-administration">III. System Administration</a></span></dt><dd><dl><dt><span class="chapter"><a href="#config-tuning">11. Configuration and Tuning</a></span></dt><dd><dl><dt><span class="sect1"><a href="#config-synopsis">11.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#configtuning-starting-services">11.2. Starting Services</a></span></dt><dt><span class="sect1"><a href="#configtuning-cron">11.3. Configuring cron(8)</a></span></dt><dt><span class="sect1"><a href="#configtuning-rcd">11.4. Managing Services in FreeBSD</a></span></dt><dt><span class="sect1"><a href="#config-network-setup">11.5. Setting Up Network Interface Cards</a></span></dt><dt><span class="sect1"><a href="#configtuning-virtual-hosts">11.6. Virtual Hosts</a></span></dt><dt><span class="sect1"><a href="#configtuning-syslog">11.7. Configuring System Logging</a></span></dt><dt><span class="sect1"><a href="#configtuning-configfiles">11.8. Configuration Files</a></span></dt><dt><span class="sect1"><a href="#configtuning-sysctl">11.9. Tuning with sysctl(8)</a></span></dt><dt><span class="sect1"><a href="#configtuning-disk">11.10. Tuning Disks</a></span></dt><dt><span class="sect1"><a href="#configtuning-kernel-limits">11.11. Tuning Kernel Limits</a></span></dt><dt><span class="sect1"><a href="#adding-swap-space">11.12. Adding Swap Space</a></span></dt><dt><span class="sect1"><a href="#acpi-overview">11.13. Power and Resource Management</a></span></dt></dl></dd><dt><span class="chapter"><a href="#boot">12. The FreeBSD Booting Process</a></span></dt><dd><dl><dt><span class="sect1"><a href="#boot-synopsis">12.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#boot-introduction">12.2. FreeBSD Boot Process</a></span></dt><dt><span class="sect1"><a href="#boot-splash">12.3. Configuring Boot Time Splash Screens</a></span></dt><dt><span class="sect1"><a href="#device-hints">12.4. Device Hints</a></span></dt><dt><span class="sect1"><a href="#boot-shutdown">12.5. Shutdown Sequence</a></span></dt></dl></dd><dt><span class="chapter"><a href="#security">13. Security</a></span></dt><dd><dl><dt><span class="sect1"><a href="#security-synopsis">13.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#security-intro">13.2. Introduction</a></span></dt><dt><span class="sect1"><a href="#one-time-passwords">13.3. One-time Passwords</a></span></dt><dt><span class="sect1"><a href="#tcpwrappers">13.4. TCP Wrapper</a></span></dt><dt><span class="sect1"><a href="#kerberos5">13.5. <span class="application">Kerberos</span></a></span></dt><dt><span class="sect1"><a href="#openssl">13.6. OpenSSL</a></span></dt><dt><span class="sect1"><a href="#ipsec">13.7. <acronym class="acronym">VPN</acronym> over
	<acronym class="acronym">IPsec</acronym></a></span></dt><dt><span class="sect1"><a href="#openssh">13.8. OpenSSH</a></span></dt><dt><span class="sect1"><a href="#fs-acl">13.9. Access Control Lists</a></span></dt><dt><span class="sect1"><a href="#security-pkg">13.10. Monitoring Third Party Security Issues</a></span></dt><dt><span class="sect1"><a href="#security-advisories">13.11. FreeBSD Security Advisories</a></span></dt><dt><span class="sect1"><a href="#security-accounting">13.12. Process Accounting</a></span></dt><dt><span class="sect1"><a href="#security-resourcelimits">13.13. Resource Limits</a></span></dt><dt><span class="sect1"><a href="#security-sudo">13.14. Shared Administration with Sudo</a></span></dt></dl></dd><dt><span class="chapter"><a href="#jails">14. Jails</a></span></dt><dd><dl><dt><span class="sect1"><a href="#jails-synopsis">14.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#jails-terms">14.2. Terms Related to Jails</a></span></dt><dt><span class="sect1"><a href="#jails-build">14.3. Creating and Controlling Jails</a></span></dt><dt><span class="sect1"><a href="#jails-tuning">14.4. Fine Tuning and Administration</a></span></dt><dt><span class="sect1"><a href="#jails-application">14.5. Updating Multiple Jails</a></span></dt><dt><span class="sect1"><a href="#jails-ezjail">14.6. Managing Jails with
	<span class="application">ezjail</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#mac">15. Mandatory Access Control</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mac-synopsis">15.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#mac-inline-glossary">15.2. Key Terms</a></span></dt><dt><span class="sect1"><a href="#mac-understandlabel">15.3. Understanding MAC Labels</a></span></dt><dt><span class="sect1"><a href="#mac-planning">15.4. Planning the Security Configuration</a></span></dt><dt><span class="sect1"><a href="#mac-policies">15.5. Available MAC Policies</a></span></dt><dt><span class="sect1"><a href="#mac-userlocked">15.6. User Lock Down</a></span></dt><dt><span class="sect1"><a href="#mac-implementing">15.7. Nagios in a MAC Jail</a></span></dt><dt><span class="sect1"><a href="#mac-troubleshoot">15.8. Troubleshooting the MAC Framework</a></span></dt></dl></dd><dt><span class="chapter"><a href="#audit">16. Security Event Auditing</a></span></dt><dd><dl><dt><span class="sect1"><a href="#audit-synopsis">16.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#audit-inline-glossary">16.2. Key Terms</a></span></dt><dt><span class="sect1"><a href="#audit-config">16.3. Audit Configuration</a></span></dt><dt><span class="sect1"><a href="#audit-administration">16.4. Working with Audit Trails</a></span></dt></dl></dd><dt><span class="chapter"><a href="#disks">17. Storage</a></span></dt><dd><dl><dt><span class="sect1"><a href="#disks-synopsis">17.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#disks-adding">17.2. Adding Disks</a></span></dt><dt><span class="sect1"><a href="#disks-growing">17.3. Resizing and Growing Disks</a></span></dt><dt><span class="sect1"><a href="#usb-disks">17.4. <acronym class="acronym">USB</acronym> Storage Devices</a></span></dt><dt><span class="sect1"><a href="#creating-cds">17.5. Creating and Using <acronym class="acronym">CD</acronym> Media</a></span></dt><dt><span class="sect1"><a href="#creating-dvds">17.6. Creating and Using <acronym class="acronym">DVD</acronym> Media</a></span></dt><dt><span class="sect1"><a href="#floppies">17.7. Creating and Using Floppy Disks</a></span></dt><dt><span class="sect1"><a href="#backup-basics">17.8. Backup Basics</a></span></dt><dt><span class="sect1"><a href="#disks-virtual">17.9. Memory Disks</a></span></dt><dt><span class="sect1"><a href="#snapshots">17.10. File System Snapshots</a></span></dt><dt><span class="sect1"><a href="#quotas">17.11. Disk Quotas</a></span></dt><dt><span class="sect1"><a href="#disks-encrypting">17.12. Encrypting Disk Partitions</a></span></dt><dt><span class="sect1"><a href="#swap-encrypting">17.13. Encrypting Swap</a></span></dt><dt><span class="sect1"><a href="#disks-hast">17.14. Highly Available Storage
	(<acronym class="acronym">HAST</acronym>)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#geom">18. GEOM: Modular Disk Transformation Framework</a></span></dt><dd><dl><dt><span class="sect1"><a href="#geom-synopsis">18.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#geom-striping">18.2. RAID0 - Striping</a></span></dt><dt><span class="sect1"><a href="#geom-mirror">18.3. RAID1 - Mirroring</a></span></dt><dt><span class="sect1"><a href="#geom-raid3">18.4. <acronym class="acronym">RAID</acronym>3 - Byte-level Striping with
	Dedicated Parity</a></span></dt><dt><span class="sect1"><a href="#geom-graid">18.5. Software <acronym class="acronym">RAID</acronym> Devices</a></span></dt><dt><span class="sect1"><a href="#geom-ggate">18.6. <acronym class="acronym">GEOM</acronym> Gate Network</a></span></dt><dt><span class="sect1"><a href="#geom-glabel">18.7. Labeling Disk Devices</a></span></dt><dt><span class="sect1"><a href="#geom-gjournal">18.8. UFS Journaling Through <acronym class="acronym">GEOM</acronym></a></span></dt></dl></dd><dt><span class="chapter"><a href="#zfs">19. The Z File System (<acronym class="acronym">ZFS</acronym>)</a></span></dt><dd><dl><dt><span class="sect1"><a href="#zfs-differences">19.1. What Makes <acronym class="acronym">ZFS</acronym> Different</a></span></dt><dt><span class="sect1"><a href="#zfs-quickstart">19.2. Quick Start Guide</a></span></dt><dt><span class="sect1"><a href="#zfs-zpool">19.3. <code class="command">zpool</code> Administration</a></span></dt><dt><span class="sect1"><a href="#zfs-zfs">19.4. <code class="command">zfs</code> Administration</a></span></dt><dt><span class="sect1"><a href="#zfs-zfs-allow">19.5. Delegated Administration</a></span></dt><dt><span class="sect1"><a href="#zfs-advanced">19.6. Advanced Topics</a></span></dt><dt><span class="sect1"><a href="#zfs-links">19.7. Additional Resources</a></span></dt><dt><span class="sect1"><a href="#zfs-term">19.8. <acronym class="acronym">ZFS</acronym> Features and Terminology</a></span></dt></dl></dd><dt><span class="chapter"><a href="#filesystems">20. Other File Systems</a></span></dt><dd><dl><dt><span class="sect1"><a href="#filesystems-synopsis">20.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#filesystems-linux">20.2. <span class="trademark">Linux</span>® File Systems</a></span></dt></dl></dd><dt><span class="chapter"><a href="#virtualization">21. Virtualization</a></span></dt><dd><dl><dt><span class="sect1"><a href="#virtualization-synopsis">21.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-parallels">21.2. FreeBSD as a Guest on <span class="application">Parallels</span> for
      <span class="trademark">Mac OS</span>® X</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-virtualpc">21.3. FreeBSD as a Guest on <span class="application">Virtual PC</span>
      for <span class="trademark">Windows</span>®</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-vmware">21.4. FreeBSD as a Guest on <span class="application">VMware Fusion</span>
      for <span class="trademark">Mac OS</span>®</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-virtualbox">21.5. FreeBSD as a Guest on <span class="trademark">VirtualBox</span>&#8482;</a></span></dt><dt><span class="sect1"><a href="#virtualization-host-virtualbox">21.6. FreeBSD as a Host with <span class="trademark">VirtualBox</span>&#8482;</a></span></dt><dt><span class="sect1"><a href="#virtualization-host-bhyve">21.7. FreeBSD as a Host with
      <span class="application">bhyve</span></a></span></dt><dt><span class="sect1"><a href="#virtualization-host-xen">21.8. FreeBSD as a <span class="trademark">Xen</span>&#8482;-Host</a></span></dt></dl></dd><dt><span class="chapter"><a href="#l10n">22. Localization -
      <acronym class="acronym">i18n</acronym>/<acronym class="acronym">L10n</acronym> Usage and
      Setup</a></span></dt><dd><dl><dt><span class="sect1"><a href="#l10n-synopsis">22.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#using-localization">22.2. Using Localization</a></span></dt><dt><span class="sect1"><a href="#l10n-compiling">22.3. Finding <acronym class="acronym">i18n</acronym> Applications</a></span></dt><dt><span class="sect1"><a href="#lang-setup">22.4. Locale Configuration for Specific Languages</a></span></dt></dl></dd><dt><span class="chapter"><a href="#updating-upgrading">23. Updating and Upgrading FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#updating-upgrading-synopsis">23.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#updating-upgrading-freebsdupdate">23.2. FreeBSD Update</a></span></dt><dt><span class="sect1"><a href="#updating-upgrading-documentation">23.3. Updating the Documentation Set</a></span></dt><dt><span class="sect1"><a href="#current-stable">23.4. Tracking a Development Branch</a></span></dt><dt><span class="sect1"><a href="#makeworld">23.5. Updating FreeBSD from Source</a></span></dt><dt><span class="sect1"><a href="#small-lan">23.6. Tracking for Multiple Machines</a></span></dt></dl></dd><dt><span class="chapter"><a href="#dtrace">24. DTrace</a></span></dt><dd><dl><dt><span class="sect1"><a href="#dtrace-synopsis">24.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#dtrace-implementation">24.2. Implementation Differences</a></span></dt><dt><span class="sect1"><a href="#dtrace-enable">24.3. Enabling DTrace Support</a></span></dt><dt><span class="sect1"><a href="#dtrace-using">24.4. Using DTrace</a></span></dt></dl></dd><dt><span class="chapter"><a href="#usb-device-mode">25. USB Device Mode / USB OTG</a></span></dt><dd><dl><dt><span class="sect1"><a href="#usb-device-mode-synopsis">25.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-terminals">25.2. <acronym class="acronym">USB</acronym> Virtual Serial Ports</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-network">25.3. <acronym class="acronym">USB</acronym> Device Mode Network
      Interfaces</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-storage">25.4. <acronym class="acronym">USB</acronym> Virtual Storage Device</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#network-communication">IV. Network Communication</a></span></dt><dd><dl><dt><span class="chapter"><a href="#serialcomms">26. Serial Communications</a></span></dt><dd><dl><dt><span class="sect1"><a href="#serial-synopsis">26.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#serial">26.2. Serial Terminology and Hardware</a></span></dt><dt><span class="sect1"><a href="#term">26.3. Terminals</a></span></dt><dt><span class="sect1"><a href="#dialup">26.4. Dial-in Service</a></span></dt><dt><span class="sect1"><a href="#dialout">26.5. Dial-out Service</a></span></dt><dt><span class="sect1"><a href="#serialconsole-setup">26.6. Setting Up the Serial Console</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ppp-and-slip">27. <acronym class="acronym">PPP</acronym></a></span></dt><dd><dl><dt><span class="sect1"><a href="#ppp-and-slip-synopsis">27.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#userppp">27.2. Configuring <acronym class="acronym">PPP</acronym></a></span></dt><dt><span class="sect1"><a href="#ppp-troubleshoot">27.3. Troubleshooting <acronym class="acronym">PPP</acronym> Connections</a></span></dt><dt><span class="sect1"><a href="#pppoe">27.4. Using <acronym class="acronym">PPP</acronym> over Ethernet (PPPoE)</a></span></dt><dt><span class="sect1"><a href="#pppoa">27.5. Using <span class="application">PPP</span> over
      <acronym class="acronym">ATM</acronym> (PPPoA)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#mail">28. Electronic Mail</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mail-synopsis">28.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#mail-using">28.2. Mail Components</a></span></dt><dt><span class="sect1"><a href="#sendmail">28.3. <span class="application">Sendmail</span> Configuration
	Files</a></span></dt><dt><span class="sect1"><a href="#mail-changingmta">28.4. Changing the Mail Transfer Agent</a></span></dt><dt><span class="sect1"><a href="#mail-trouble">28.5. Troubleshooting</a></span></dt><dt><span class="sect1"><a href="#mail-advanced">28.6. Advanced Topics</a></span></dt><dt><span class="sect1"><a href="#outgoing-only">28.7. Setting Up to Send Only</a></span></dt><dt><span class="sect1"><a href="#SMTP-dialup">28.8. Using Mail with a Dialup Connection</a></span></dt><dt><span class="sect1"><a href="#SMTP-Auth">28.9. SMTP Authentication</a></span></dt><dt><span class="sect1"><a href="#mail-agents">28.10. Mail User Agents</a></span></dt><dt><span class="sect1"><a href="#mail-fetchmail">28.11. Using <span class="application">fetchmail</span></a></span></dt><dt><span class="sect1"><a href="#mail-procmail">28.12. Using <span class="application">procmail</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#network-servers">29. Network Servers</a></span></dt><dd><dl><dt><span class="sect1"><a href="#network-servers-synopsis">29.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#network-inetd">29.2. The <span class="application">inetd</span>
      Super-Server</a></span></dt><dt><span class="sect1"><a href="#network-nfs">29.3. Network File System (NFS)</a></span></dt><dt><span class="sect1"><a href="#network-nis">29.4. Network Information System
      (<acronym class="acronym">NIS</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-ldap">29.5. Lightweight Directory Access Protocol
	(<acronym class="acronym">LDAP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-dhcp">29.6. Dynamic Host Configuration Protocol
      (<acronym class="acronym">DHCP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-dns">29.7. Domain Name System (<acronym class="acronym">DNS</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-apache">29.8. Apache HTTP Server</a></span></dt><dt><span class="sect1"><a href="#network-ftp">29.9. File Transfer Protocol (<acronym class="acronym">FTP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-samba">29.10. File and Print Services for <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® Clients
      (Samba)</a></span></dt><dt><span class="sect1"><a href="#network-ntp">29.11. Clock Synchronization with NTP</a></span></dt><dt><span class="sect1"><a href="#network-iscsi">29.12. <acronym class="acronym">iSCSI</acronym> Initiator and Target
      Configuration</a></span></dt></dl></dd><dt><span class="chapter"><a href="#firewalls">30. Firewalls</a></span></dt><dd><dl><dt><span class="sect1"><a href="#firewalls-intro">30.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#firewalls-concepts">30.2. Firewall Concepts</a></span></dt><dt><span class="sect1"><a href="#firewalls-pf">30.3. PF</a></span></dt><dt><span class="sect1"><a href="#firewalls-ipfw">30.4. <span class="application">IPFW</span></a></span></dt><dt><span class="sect1"><a href="#firewalls-ipf">30.5. IPFILTER (IPF)</a></span></dt><dt><span class="sect1"><a href="#firewalls-blacklistd">30.6. Blacklistd</a></span></dt></dl></dd><dt><span class="chapter"><a href="#advanced-networking">31. Advanced Networking</a></span></dt><dd><dl><dt><span class="sect1"><a href="#advanced-networking-synopsis">31.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#network-routing">31.2. Gateways and Routes</a></span></dt><dt><span class="sect1"><a href="#network-wireless">31.3. Wireless Networking</a></span></dt><dt><span class="sect1"><a href="#network-usb-tethering">31.4. USB Tethering</a></span></dt><dt><span class="sect1"><a href="#network-bluetooth">31.5. Bluetooth</a></span></dt><dt><span class="sect1"><a href="#network-bridging">31.6. Bridging</a></span></dt><dt><span class="sect1"><a href="#network-aggregation">31.7. Link Aggregation and Failover</a></span></dt><dt><span class="sect1"><a href="#network-diskless">31.8. Diskless Operation with <acronym class="acronym">PXE</acronym></a></span></dt><dt><span class="sect1"><a href="#network-ipv6">31.9. <acronym class="acronym">IPv6</acronym></a></span></dt><dt><span class="sect1"><a href="#carp">31.10. Common Address Redundancy Protocol
	(<acronym class="acronym">CARP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-vlan">31.11. VLANs</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#appendices">V. Appendices</a></span></dt><dd><dl><dt><span class="appendix"><a href="#mirrors">A. Obtaining FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mirrors-cdrom">A.1. <acronym class="acronym">CD</acronym> and
      <acronym class="acronym">DVD</acronym> Sets</a></span></dt><dt><span class="sect1"><a href="#mirrors-ftp">A.2. <acronym class="acronym">FTP</acronym> Sites</a></span></dt><dt><span class="sect1"><a href="#svn">A.3. Using <span class="application">Subversion</span></a></span></dt><dt><span class="sect1"><a href="#mirrors-rsync">A.4. Using <span class="application">rsync</span></a></span></dt></dl></dd><dt><span class="appendix"><a href="#bibliography">B. Bibliography</a></span></dt><dd><dl><dt><span class="sect1"><a href="#bibliography-freebsd">B.1. Books Specific to FreeBSD</a></span></dt><dt><span class="sect1"><a href="#bibliography-userguides">B.2. Users' Guides</a></span></dt><dt><span class="sect1"><a href="#bibliography-adminguides">B.3. Administrators' Guides</a></span></dt><dt><span class="sect1"><a href="#bibliography-programmers">B.4. Programmers' Guides</a></span></dt><dt><span class="sect1"><a href="#bibliography-osinternals">B.5. Operating System Internals</a></span></dt><dt><span class="sect1"><a href="#bibliography-security">B.6. Security Reference</a></span></dt><dt><span class="sect1"><a href="#bibliography-hardware">B.7. Hardware Reference</a></span></dt><dt><span class="sect1"><a href="#bibliography-history">B.8. <span class="trademark">UNIX</span>® History</a></span></dt><dt><span class="sect1"><a href="#bibliography-journals">B.9. Periodicals, Journals, and Magazines</a></span></dt></dl></dd><dt><span class="appendix"><a href="#eresources">C. Resources on the Internet</a></span></dt><dd><dl><dt><span class="sect1"><a href="#eresources-www">C.1. Websites</a></span></dt><dt><span class="sect1"><a href="#eresources-mail">C.2. Mailing Lists</a></span></dt><dt><span class="sect1"><a href="#eresources-news">C.3. Usenet Newsgroups</a></span></dt><dt><span class="sect1"><a href="#eresources-web">C.4. Official Mirrors</a></span></dt></dl></dd><dt><span class="appendix"><a href="#pgpkeys">D. Open<acronym class="acronym">PGP</acronym> Keys</a></span></dt><dd><dl><dt><span class="sect1"><a href="#pgpkeys-officers">D.1. Officers</a></span></dt></dl></dd></dl></dd><dt><span class="glossary"><a href="#freebsd-glossary">FreeBSD Glossary</a></span></dt><dt><span class="index"><a href="#idp75582456">Index</a></span></dt></dl></div><div class="list-of-figures"><div class="toc-title">List of Figures</div><dl><dt>2.1. <a href="#bsdinstall-newboot-loader-menu">FreeBSD Boot Loader Menu</a></dt><dt>2.2. <a href="#bsdinstall-boot-options-menu">FreeBSD Boot Options Menu</a></dt><dt>2.3. <a href="#bsdinstall-choose-mode">Welcome Menu</a></dt><dt>2.4. <a href="#bsdinstall-keymap-loading">Keymap Loading</a></dt><dt>2.5. <a href="#bsdinstall-keymap-10">Keymap Selection Menu</a></dt><dt>2.6. <a href="#bsdinstall-keymap-testing">Keymap Testing Menu</a></dt><dt>2.7. <a href="#bsdinstall-config-hostname">Setting the Hostname</a></dt><dt>2.8. <a href="#bsdinstall-config-components">Selecting Components to Install</a></dt><dt>2.9. <a href="#bsdinstall-netinstall-notify">Installing from the Network</a></dt><dt>2.10. <a href="#bsdinstall-zfs-partmenu">Partitioning Choices</a></dt><dt>2.11. <a href="#bsdinstall-part-guided-disk">Selecting from Multiple Disks</a></dt><dt>2.12. <a href="#bsdinstall-part-entire-part">Selecting Entire Disk or Partition</a></dt><dt>2.13. <a href="#bsdinstall-ufs-warning">Confirmation</a></dt><dt>2.14. <a href="#bsdinstall-ufs-scheme">Select Partition Scheme</a></dt><dt>2.15. <a href="#bsdinstall-part-review">Review Created Partitions</a></dt><dt>2.16. <a href="#bsdinstall-ufs-final-confirmation">Final Confirmation</a></dt><dt>2.17. <a href="#bsdinstall-part-manual-create">Manually Create Partitions</a></dt><dt>2.18. <a href="#bsdinstall-part-manual-partscheme">Manually Create Partitions</a></dt><dt>2.19. <a href="#bsdinstall-part-manual-addpart">Manually Create Partitions</a></dt><dt>2.20. <a href="#bsdinstall-zfs-menu"><acronym class="acronym">ZFS</acronym> Partitioning Menu</a></dt><dt>2.21. <a href="#bsdinstall-zfs-vdev_type"><acronym class="acronym">ZFS</acronym> Pool Type</a></dt><dt>2.22. <a href="#bsdinstall-zfs-disk_select">Disk Selection</a></dt><dt>2.23. <a href="#bsdinstall-zfs-vdev_invalid">Invalid Selection</a></dt><dt>2.24. <a href="#bsdinstall-zfs-rescan-devices">Rescan Devices</a></dt><dt>2.25. <a href="#bsdinstall-zfs-disk_info">Analyzing a Disk</a></dt><dt>2.26. <a href="#bsdinstall-zfs-pool-name">Pool Name</a></dt><dt>2.27. <a href="#bsdinstall-zfs-swap-amount">Swap Amount</a></dt><dt>2.28. <a href="#bsdinstall-zfs-warning">Last Chance</a></dt><dt>2.29. <a href="#bsdinstall-zfs-geli_password">Disk Encryption Password</a></dt><dt>2.30. <a href="#bsdinstall-zfs-init-encription">Initializing Encryption</a></dt><dt>2.31. <a href="#bsdinstall-distfile-fetching">Fetching Distribution Files</a></dt><dt>2.32. <a href="#bsdinstall-distfile-verify">Verifying Distribution Files</a></dt><dt>2.33. <a href="#bsdinstall-distfile-extract">Extracting Distribution Files</a></dt><dt>2.34. <a href="#bsdinstall-post-set-root-passwd">Setting the <code class="systemitem">root</code> Password</a></dt><dt>2.35. <a href="#bsdinstall-timezone-region">Select a Region</a></dt><dt>2.36. <a href="#bsdinstall-timezone-country">Select a Country</a></dt><dt>2.37. <a href="#bsdinstall-timezone-zone">Select a Time Zone</a></dt><dt>2.38. <a href="#bsdinstall-timezone-confirmation">Confirm Time Zone</a></dt><dt>2.39. <a href="#bsdinstall-timezone-date">Select Date</a></dt><dt>2.40. <a href="#bsdinstall-timezone-time">Select Time</a></dt><dt>2.41. <a href="#bsdinstall-config-serv">Selecting Additional Services to Enable</a></dt><dt>2.42. <a href="#bsdinstall-hardening-options">Selecting Hardening Security Options</a></dt><dt>2.43. <a href="#bsdinstall-add-user1">Add User Accounts</a></dt><dt>2.44. <a href="#bsdinstall-add-user2">Enter User Information</a></dt><dt>2.45. <a href="#bsdinstall-add-user3">Exit User and Group Management</a></dt><dt>2.46. <a href="#bsdinstall-final-config">Final Configuration</a></dt><dt>2.47. <a href="#bsdinstall-final-modification-shell">Manual Configuration</a></dt><dt>2.48. <a href="#bsdinstall-final-main">Complete the Installation</a></dt><dt>2.49. <a href="#bsdinstall-configure-net-interface">Choose a Network Interface</a></dt><dt>2.50. <a href="#bsdinstall-wireless-scan">Scanning for Wireless Access Points</a></dt><dt>2.51. <a href="#bsdinstall-wireless-accesspoints">Choosing a Wireless Network</a></dt><dt>2.52. <a href="#bsdinstall-wireless-wpa2">WPA2 Setup</a></dt><dt>2.53. <a href="#bsdinstall-configure-net-ipv4">Choose <acronym class="acronym">IPv4</acronym> Networking</a></dt><dt>2.54. <a href="#bsdinstall-net-ipv4-dhcp">Choose <acronym class="acronym">IPv4</acronym> <acronym class="acronym">DHCP</acronym>
	  Configuration</a></dt><dt>2.55. <a href="#bsdinstall-net-ipv4-static"><acronym class="acronym">IPv4</acronym> Static Configuration</a></dt><dt>2.56. <a href="#bsdinstall-net-ipv6">Choose IPv6 Networking</a></dt><dt>2.57. <a href="#bsdinstall-net-ipv6-slaac">Choose IPv6 SLAAC Configuration</a></dt><dt>2.58. <a href="#bsdinstall-net-ipv6-static">IPv6 Static Configuration</a></dt><dt>2.59. <a href="#bsdinstall-net-dns-config">DNS Configuration</a></dt><dt>2.60. <a href="#bsdinstall-netinstall-mirror">Choosing a Mirror</a></dt><dt>31.1. <a href="#idp72539000"><acronym class="acronym">PXE</acronym> Booting Process with
	      <acronym class="acronym">NFS</acronym> Root Mount</a></dt></dl></div><div class="list-of-tables"><div class="toc-title">List of Tables</div><dl><dt>2.1. <a href="#partition-schemes">Partitioning Schemes</a></dt><dt>3.1. <a href="#users-modifying-utilities">Utilities for Managing User Accounts</a></dt><dt>3.2. <a href="#idp50458232"><span class="trademark">UNIX</span>® Permissions</a></dt><dt>3.3. <a href="#disks-naming">Disk Device Names</a></dt><dt>3.4. <a href="#shell-env-vars">Common Environment Variables</a></dt><dt>5.1. <a href="#xdm-config-files">XDM Configuration Files</a></dt><dt>7.1. <a href="#multimedia-sound-common-error-messages">Common Error Messages</a></dt><dt>9.1. <a href="#print-pdls-ps-to-other-tbl">Output <acronym class="acronym">PDL</acronym>s</a></dt><dt>12.1. <a href="#boot-loader-commands">Loader Built-In Commands</a></dt><dt>12.2. <a href="#boot-kernel">Kernel Interaction During Boot</a></dt><dt>13.1. <a href="#resource-limits">Login Class Resource Limits</a></dt><dt>16.1. <a href="#event-selection">Default Audit Event Classes</a></dt><dt>16.2. <a href="#event-prefixes">Prefixes for Audit Event Classes</a></dt><dt>22.1. <a href="#locale-lang-country">Common Language and Country Codes</a></dt><dt>22.2. <a href="#locale-charset">Defined Terminal Types for Character Sets</a></dt><dt>22.3. <a href="#locale-console">Available Console from Ports Collection</a></dt><dt>22.4. <a href="#locale-xim">Available Input Methods</a></dt><dt>23.1. <a href="#updating-src-obtaining-src-repopath">FreeBSD Versions and Repository Paths</a></dt><dt>26.1. <a href="#serialcomms-signal-names"><acronym class="acronym">RS-232C</acronym> Signal Names</a></dt><dt>26.2. <a href="#nullmodem-db25">DB-25 to DB-25 Null-Modem Cable</a></dt><dt>26.3. <a href="#nullmodem-db9">DB-9 to DB-9 Null-Modem Cable</a></dt><dt>26.4. <a href="#nullmodem-db9-25">DB-9 to DB-25 Null-Modem Cable</a></dt><dt>29.1. <a href="#idp67947896"><acronym class="acronym">NIS</acronym> Terminology</a></dt><dt>29.2. <a href="#idp68256888">Additional Users</a></dt><dt>29.3. <a href="#idp68268792">Additional Systems</a></dt><dt>29.4. <a href="#idp68743800"><acronym class="acronym">DNS</acronym> Terminology</a></dt><dt>30.1. <a href="#pfctl">Useful <code class="command">pfctl</code> Options</a></dt><dt>31.1. <a href="#routeflags">Commonly Seen Routing Table Flags</a></dt><dt>31.2. <a href="#idp71168248">Station Capability Codes</a></dt><dt>31.3. <a href="#reservedip6">Reserved <acronym class="acronym">IPv6</acronym> Addresses</a></dt></dl></div><div class="list-of-examples"><div class="toc-title">List of Examples</div><dl><dt>2.1. <a href="#bsdinstall-part-manual-splitfs">Creating Traditional Split File System
	  Partitions</a></dt><dt>3.1. <a href="#idp50223608">Install a Program As the Superuser</a></dt><dt>3.2. <a href="#users-modifying-adduser">Adding a User on FreeBSD</a></dt><dt>3.3. <a href="#idp50277496"><code class="command">rmuser</code> Interactive Account
	    Removal</a></dt><dt>3.4. <a href="#users-modifying-chpass-su">Using <code class="command">chpass</code> as
	    Superuser</a></dt><dt>3.5. <a href="#users-modifying-chpass-ru">Using <code class="command">chpass</code> as Regular
	    User</a></dt><dt>3.6. <a href="#idp50342904">Changing Your Password</a></dt><dt>3.7. <a href="#idp50345848">Changing Another User's Password as the
	    Superuser</a></dt><dt>3.8. <a href="#idp50369144">Adding a Group Using pw(8)</a></dt><dt>3.9. <a href="#idp50375544">Adding User Accounts to a New Group Using
	  pw(8)</a></dt><dt>3.10. <a href="#idp50382968">Adding a New Member to a Group Using pw(8)</a></dt><dt>3.11. <a href="#idp50403320">Using id(1) to Determine Group Membership</a></dt><dt>3.12. <a href="#basics-disk-slice-part">Sample Disk, Slice, and Partition Names</a></dt><dt>3.13. <a href="#basics-concept-disk-model">Conceptual Model of a Disk</a></dt><dt>5.1. <a href="#x-config-video-cards-file-intel">Select <span class="trademark">Intel</span>® Video Driver in a File</a></dt><dt>5.2. <a href="#x-config-video-cards-file-radeon">Select Radeon Video Driver in a File</a></dt><dt>5.3. <a href="#x-config-video-cards-file-vesa">Select <acronym class="acronym">VESA</acronym> Video Driver in a
		File</a></dt><dt>5.4. <a href="#x-config-video-cards-file-scfb">Select <code class="literal">scfb</code> Video Driver in a
		File</a></dt><dt>5.5. <a href="#idp52318456">Set Screen Resolution in a File</a></dt><dt>5.6. <a href="#idp52321656">Manually Setting Monitor Frequencies</a></dt><dt>5.7. <a href="#idp52330232">Setting a Keyboard Layout</a></dt><dt>5.8. <a href="#idp52331896">Setting Multiple Keyboard Layouts</a></dt><dt>5.9. <a href="#idp52342776">Enabling Keyboard Exit from X</a></dt><dt>5.10. <a href="#idp52352120">Setting the Number of Mouse Buttons</a></dt><dt>11.1. <a href="#idp55388024">Sample Log Server Configuration</a></dt><dt>11.2. <a href="#swapfile-10-and-later">Creating a Swap File</a></dt><dt>12.1. <a href="#boot-boot0-example"><code class="filename">boot0</code> Screenshot</a></dt><dt>12.2. <a href="#boot-boot2-example"><code class="filename">boot2</code> Screenshot</a></dt><dt>12.3. <a href="#boot-insecure-console">Configuring an Insecure Console in
	    <code class="filename">/etc/ttys</code></a></dt><dt>13.1. <a href="#idp57718264">Create a Secure Tunnel for
	    <acronym class="acronym">SMTP</acronym></a></dt><dt>13.2. <a href="#idp57722872">Secure Access of a <acronym class="acronym">POP3</acronym>
	    Server</a></dt><dt>13.3. <a href="#idp57733240">Bypassing a Firewall</a></dt><dt>14.1. <a href="#jails-ezjail-update-mergemaster-untrusted">mergemaster(8) on Untrusted Jail</a></dt><dt>14.2. <a href="#jails-ezjail-update-mergemaster-trusted">mergemaster(8) on Trusted Jail</a></dt><dt>14.3. <a href="#jails-ezjail-example-bind-steps">Running BIND in a Jail</a></dt><dt>17.1. <a href="#idp60469880">Using <code class="command">dump</code> over
	  <span class="application">ssh</span></a></dt><dt>17.2. <a href="#idp60473336">Using <code class="command">dump</code> over
	  <span class="application">ssh</span> with <code class="envar">RSH</code>
	  Set</a></dt><dt>17.3. <a href="#idp60481912">Backing Up the Current Directory with
	  <code class="command">tar</code></a></dt><dt>17.4. <a href="#idp60501368">Restoring Up the Current Directory with
	  <code class="command">tar</code></a></dt><dt>17.5. <a href="#idp60509816">Using <code class="command">ls</code> and <code class="command">cpio</code>
	  to Make a Recursive Backup of the Current Directory</a></dt><dt>17.6. <a href="#idp60524664">Backing Up the Current Directory with
	  <code class="command">pax</code></a></dt><dt>18.1. <a href="#idp61897080">Labeling Partitions on the Boot Disk</a></dt><dt>23.1. <a href="#updating-src-building-jobs-example">Increasing the Number of Build Jobs</a></dt><dt>26.1. <a href="#ex-etc-ttys">Configuring Terminal Entries</a></dt><dt>29.1. <a href="#network-inetd-reread">Reloading the <span class="application">inetd</span>
	  Configuration File</a></dt><dt>29.2. <a href="#idp67891192">Mounting an Export with autofs(5)</a></dt><dt>29.3. <a href="#idp69182456">Sample <code class="filename">/etc/ntp.conf</code></a></dt><dt>31.1. <a href="#networking-lacp-aggregation-cisco"><acronym class="acronym">LACP</acronym> Aggregation with a <span class="trademark">Cisco</span>®
	  Switch</a></dt><dt>31.2. <a href="#networking-lagg-failover">Failover Mode</a></dt><dt>31.3. <a href="#networking-lagg-wired-and-wireless">Failover Mode Between Ethernet and Wireless
	  Interfaces</a></dt></dl></div><div class="preface"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="book-preface"></a>Preface</h1></div></div></div><h2 class="title"><a id="preface-audience"></a>Intended
  Audience</h2><p>The FreeBSD newcomer will find that the first section of this
    book guides the user through the FreeBSD installation process and
    gently introduces the concepts and conventions that underpin
    <span class="trademark">UNIX</span>®.  Working through this section requires little more than
    the desire to explore, and the ability to take on board new
    concepts as they are introduced.</p><p>Once you have traveled this far, the second, far larger,
    section of the Handbook is a comprehensive reference to all manner
    of topics of interest to FreeBSD system administrators.  Some of
    these chapters may recommend that you do some prior reading, and
    this is noted in the synopsis at the beginning of each
    chapter.</p><p>For a list of additional sources of information, please see
    <a class="xref" href="#bibliography" title="Appendix B. Bibliography">Appendix B, <em>Bibliography</em></a>.</p><h2 class="title"><a id="preface-changes-from3"></a>Changes
    from the Third Edition</h2><p>The current online version of the Handbook represents the
    cumulative effort of many hundreds of contributors over the past
    10 years.  The following are some of the significant changes since
    the two volume third edition was published in 2004:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#dtrace" title="Chapter 24. DTrace">Chapter 24, <em>DTrace</em></a> has been added with information
	about the powerful DTrace performance analysis tool.</p></li><li class="listitem"><p><a class="xref" href="#filesystems" title="Chapter 20. Other File Systems">Chapter 20, <em>Other File Systems</em></a> has been added with
	information about non-native file systems in FreeBSD, such as ZFS
	from <span class="trademark">Sun</span>&#8482;.</p></li><li class="listitem"><p><a class="xref" href="#audit" title="Chapter 16. Security Event Auditing">Chapter 16, <em>Security Event Auditing</em></a> has been added to cover the new
	auditing capabilities in FreeBSD and explain its use.</p></li><li class="listitem"><p><a class="xref" href="#virtualization" title="Chapter 21. Virtualization">Chapter 21, <em>Virtualization</em></a> has been added with
	information about installing FreeBSD on virtualization
	software.</p></li><li class="listitem"><p><a class="xref" href="#bsdinstall" title="Chapter 2. Installing FreeBSD">Chapter 2, <em>Installing FreeBSD</em></a> has been added to cover
	installation of FreeBSD using the new installation utility,
	<span class="application">bsdinstall</span>.</p></li></ul></div><h2 class="title"><a id="preface-changes-from2"></a>Changes
    from the Second Edition (2004)</h2><p>The third edition was the culmination of over two years of
    work by the dedicated members of the FreeBSD Documentation
    Project.  The printed edition grew to such a size that it was
    necessary to publish as two separate volumes.  The following are
    the major changes in this new edition:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#config-tuning" title="Chapter 11. Configuration and Tuning">Chapter 11, <em>Configuration and Tuning</em></a> has been expanded with new
	information about the ACPI power and resource management, the
	<code class="command">cron</code> system utility, and more kernel tuning
	options.</p></li><li class="listitem"><p><a class="xref" href="#security" title="Chapter 13. Security">Chapter 13, <em>Security</em></a> has been expanded with new
	information about virtual private networks (VPNs), file system
	access control lists (ACLs), and security advisories.</p></li><li class="listitem"><p><a class="xref" href="#mac" title="Chapter 15. Mandatory Access Control">Chapter 15, <em>Mandatory Access Control</em></a> is a new chapter with this edition.
	It explains what MAC is and how this mechanism can be used to
	secure a FreeBSD system.</p></li><li class="listitem"><p><a class="xref" href="#disks" title="Chapter 17. Storage">Chapter 17, <em>Storage</em></a> has been expanded with new
	information about USB storage devices, file system snapshots,
	file system quotas, file and network backed filesystems, and
	encrypted disk partitions.</p></li><li class="listitem"><p>A troubleshooting section has been added to <a class="xref" href="#ppp-and-slip" title="Chapter 27. PPP">Chapter 27, <em><acronym class="acronym">PPP</acronym></em></a>.</p></li><li class="listitem"><p><a class="xref" href="#mail" title="Chapter 28. Electronic Mail">Chapter 28, <em>Electronic Mail</em></a> has been expanded with new
	information about using alternative transport agents, SMTP
	authentication, UUCP, <span class="application">fetchmail</span>,
	<span class="application">procmail</span>, and other advanced
	topics.</p></li><li class="listitem"><p><a class="xref" href="#network-servers" title="Chapter 29. Network Servers">Chapter 29, <em>Network Servers</em></a> is all new with this
	edition.  This chapter includes information about setting up
	the <span class="application">Apache HTTP Server</span>,
	<span class="application">ftpd</span>, and setting up a server for
	<span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® clients with
	<span class="application">Samba</span>.  Some sections from <a class="xref" href="#advanced-networking" title="Chapter 31. Advanced Networking">Chapter 31, <em>Advanced Networking</em></a> were moved here to improve
	the presentation.</p></li><li class="listitem"><p><a class="xref" href="#advanced-networking" title="Chapter 31. Advanced Networking">Chapter 31, <em>Advanced Networking</em></a> has been expanded
	with new information about using <span class="trademark">Bluetooth</span>® devices with
	FreeBSD, setting up wireless networks, and Asynchronous Transfer
	Mode (ATM) networking.</p></li><li class="listitem"><p>A glossary has been added to provide a central location
	for the definitions of technical terms used throughout the
	book.</p></li><li class="listitem"><p>A number of aesthetic improvements have been made to the
	tables and figures throughout the book.</p></li></ul></div><h2 class="title"><a id="preface-changes"></a>Changes from
    the First Edition (2001)</h2><p>The second edition was the culmination of over two years of
      work by the dedicated members of the FreeBSD Documentation Project.
      The following were the major changes in this edition:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A complete Index has been added.</p></li><li class="listitem"><p>All ASCII figures have been replaced by graphical
	  diagrams.</p></li><li class="listitem"><p>A standard synopsis has been added to each chapter to
	  give a quick summary of what information the chapter
	  contains, and what the reader is expected to know.</p></li><li class="listitem"><p>The content has been logically reorganized into three
	  parts: <span class="quote">&#8220;<span class="quote">Getting Started</span>&#8221;</span>, <span class="quote">&#8220;<span class="quote">System
	  Administration</span>&#8221;</span>, and
	  <span class="quote">&#8220;<span class="quote">Appendices</span>&#8221;</span>.</p></li><li class="listitem"><p><a class="xref" href="#basics" title="Chapter 3. FreeBSD Basics">Chapter 3, <em>FreeBSD Basics</em></a> has been expanded to contain
	  additional information about processes, daemons, and
	  signals.</p></li><li class="listitem"><p><a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a> has been expanded to contain
	  additional information about binary package
	  management.</p></li><li class="listitem"><p><a class="xref" href="#x11" title="Chapter 5. The X Window System">Chapter 5, <em>The X Window System</em></a> has been completely rewritten with
	  an emphasis on using modern desktop technologies such as
	  <span class="application">KDE</span> and
	  <span class="application">GNOME</span> on <span class="trademark">XFree86</span>&#8482; 4.X.</p></li><li class="listitem"><p><a class="xref" href="#boot" title="Chapter 12. The FreeBSD Booting Process">Chapter 12, <em>The FreeBSD Booting Process</em></a> has been expanded.</p></li><li class="listitem"><p><a class="xref" href="#disks" title="Chapter 17. Storage">Chapter 17, <em>Storage</em></a> has been written from what used
	  to be two separate chapters on <span class="quote">&#8220;<span class="quote">Disks</span>&#8221;</span> and
	  <span class="quote">&#8220;<span class="quote">Backups</span>&#8221;</span>.  We feel that the topics are easier
	  to comprehend when presented as a single chapter.  A section
	  on RAID (both hardware and software) has also been
	  added.</p></li><li class="listitem"><p><a class="xref" href="#serialcomms" title="Chapter 26. Serial Communications">Chapter 26, <em>Serial Communications</em></a> has been completely
	  reorganized and updated for FreeBSD 4.X/5.X.</p></li><li class="listitem"><p><a class="xref" href="#ppp-and-slip" title="Chapter 27. PPP">Chapter 27, <em><acronym class="acronym">PPP</acronym></em></a> has been substantially
	  updated.</p></li><li class="listitem"><p>Many new sections have been added to <a class="xref" href="#advanced-networking" title="Chapter 31. Advanced Networking">Chapter 31, <em>Advanced Networking</em></a>.</p></li><li class="listitem"><p><a class="xref" href="#mail" title="Chapter 28. Electronic Mail">Chapter 28, <em>Electronic Mail</em></a> has been expanded to include more
	  information about configuring
	  <span class="application">sendmail</span>.</p></li><li class="listitem"><p><a class="xref" href="#linuxemu" title="Chapter 10. Linux® Binary Compatibility">Chapter 10, <em><span class="trademark">Linux</span>® Binary Compatibility</em></a> has been expanded to include
	  information about installing
	  <span class="application"><span class="trademark">Oracle</span>®</span> and
	  <span class="application"><span class="trademark">SAP</span>® <span class="trademark">R/3</span>®</span>.</p></li><li class="listitem"><p>The following new topics are covered in this second
	  edition:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="xref" href="#config-tuning" title="Chapter 11. Configuration and Tuning">Chapter 11, <em>Configuration and Tuning</em></a>.</p></li><li class="listitem"><p><a class="xref" href="#multimedia" title="Chapter 7. Multimedia">Chapter 7, <em>Multimedia</em></a>.</p></li></ul></div></li></ul></div><h2 class="title"><a id="preface-overview"></a>Organization of This Book</h2><p>This book is split into five logically distinct sections.
    The first section, <span class="emphasis"><em>Getting Started</em></span>, covers
    the installation and basic usage of FreeBSD.  It is expected that
    the reader will follow these chapters in sequence, possibly
    skipping chapters covering familiar topics.  The second section,
    <span class="emphasis"><em>Common Tasks</em></span>, covers some frequently used
    features of FreeBSD.  This section, and all subsequent sections,
    can be read out of order.  Each chapter begins with a succinct
    synopsis that describes what the chapter covers and what the
    reader is expected to already know.  This is meant to allow the
    casual reader to skip around to find chapters of interest.  The
    third section, <span class="emphasis"><em>System Administration</em></span>, covers
    administration topics.  The fourth section, <span class="emphasis"><em>Network
      Communication</em></span>, covers networking and server topics.
    The fifth section contains appendices of reference
    information.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#introduction" title="Chapter 1. Introduction">Chapter 1, <em>Introduction</em></a></em></span></span></dt><dd><p>Introduces FreeBSD to a new user.  It describes the
	  history of the FreeBSD Project, its goals and development
	  model.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#bsdinstall" title="Chapter 2. Installing FreeBSD">Chapter 2, <em>Installing FreeBSD</em></a></em></span></span></dt><dd><p>Walks a user through the entire installation process of
	  FreeBSD 9.<em class="replaceable"><code>x</code></em> and later using
	  <span class="application">bsdinstall</span>.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#basics" title="Chapter 3. FreeBSD Basics">Chapter 3, <em>FreeBSD Basics</em></a></em></span></span></dt><dd><p>Covers the basic commands and functionality of the
	  FreeBSD operating system.  If you are familiar with <span class="trademark">Linux</span>®
	  or another flavor of <span class="trademark">UNIX</span>® then you can probably skip this
	  chapter.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a></em></span></span></dt><dd><p>Covers the installation of third-party software with
	  both FreeBSD's innovative <span class="quote">&#8220;<span class="quote">Ports Collection</span>&#8221;</span> and
	  standard binary packages.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#x11" title="Chapter 5. The X Window System">Chapter 5, <em>The X Window System</em></a></em></span></span></dt><dd><p>Describes the X Window System in general and using X11
	  on FreeBSD in particular.  Also describes common desktop
	  environments such as <span class="application">KDE</span> and
	  <span class="application">GNOME</span>.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#desktop" title="Chapter 6. Desktop Applications">Chapter 6, <em>Desktop Applications</em></a></em></span></span></dt><dd><p>Lists some common desktop applications, such as web
	  browsers and productivity suites, and describes how to
	  install them on FreeBSD.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#multimedia" title="Chapter 7. Multimedia">Chapter 7, <em>Multimedia</em></a></em></span></span></dt><dd><p>Shows how to set up sound and video playback support
	  for your system.  Also describes some sample audio and video
	  applications.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a></em></span></span></dt><dd><p>Explains why you might need to configure a new kernel
	  and provides detailed instructions for configuring,
	  building, and installing a custom kernel.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#printing" title="Chapter 9. Printing">Chapter 9, <em>Printing</em></a></em></span></span></dt><dd><p>Describes managing printers on FreeBSD, including
	  information about banner pages, printer accounting, and
	  initial setup.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#linuxemu" title="Chapter 10. Linux® Binary Compatibility">Chapter 10, <em><span class="trademark">Linux</span>® Binary Compatibility</em></a></em></span></span></dt><dd><p>Describes the <span class="trademark">Linux</span>® compatibility features of FreeBSD.
	  Also provides detailed installation instructions for many
	  popular <span class="trademark">Linux</span>® applications such as
	  <span class="application"><span class="trademark">Oracle</span>®</span> and
	  <span class="application"><span class="trademark">Mathematica</span>®</span>.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#config-tuning" title="Chapter 11. Configuration and Tuning">Chapter 11, <em>Configuration and Tuning</em></a></em></span></span></dt><dd><p>Describes the parameters available for system
	  administrators to tune a FreeBSD system for optimum
	  performance.  Also describes the various configuration files
	  used in FreeBSD and where to find them.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#boot" title="Chapter 12. The FreeBSD Booting Process">Chapter 12, <em>The FreeBSD Booting Process</em></a></em></span></span></dt><dd><p>Describes the FreeBSD boot process and explains how to
	  control this process with configuration options.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#security" title="Chapter 13. Security">Chapter 13, <em>Security</em></a></em></span></span></dt><dd><p>Describes many different tools available to help keep
	  your FreeBSD system secure, including Kerberos, IPsec and
	  OpenSSH.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#jails" title="Chapter 14. Jails">Chapter 14, <em>Jails</em></a></em></span></span></dt><dd><p>Describes the jails framework, and the improvements of
	  jails over the traditional chroot support of FreeBSD.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#mac" title="Chapter 15. Mandatory Access Control">Chapter 15, <em>Mandatory Access Control</em></a></em></span></span></dt><dd><p>Explains what Mandatory Access Control (MAC) is and
	  how this mechanism can be used to secure a FreeBSD
	  system.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#audit" title="Chapter 16. Security Event Auditing">Chapter 16, <em>Security Event Auditing</em></a></em></span></span></dt><dd><p>Describes what FreeBSD Event Auditing is, how it can be
	  installed, configured, and how audit trails can be inspected
	  or monitored.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#disks" title="Chapter 17. Storage">Chapter 17, <em>Storage</em></a></em></span></span></dt><dd><p>Describes how to manage storage media and filesystems
	  with FreeBSD.  This includes physical disks, RAID arrays,
	  optical and tape media, memory-backed disks, and network
	  filesystems.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#geom" title="Chapter 18. GEOM: Modular Disk Transformation Framework">Chapter 18, <em>GEOM: Modular Disk Transformation Framework</em></a></em></span></span></dt><dd><p>Describes what the GEOM framework in FreeBSD is and how
	  to configure various supported RAID levels.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#filesystems" title="Chapter 20. Other File Systems">Chapter 20, <em>Other File Systems</em></a></em></span></span></dt><dd><p>Examines support of non-native file systems in FreeBSD,
	  like the Z File System from <span class="trademark">Sun</span>&#8482;.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#virtualization" title="Chapter 21. Virtualization">Chapter 21, <em>Virtualization</em></a></em></span></span></dt><dd><p>Describes what virtualization systems offer, and how
	  they can be used with FreeBSD.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#l10n" title="Chapter 22. Localization - i18n/L10n Usage and Setup">Chapter 22, <em>Localization -
      <acronym class="acronym">i18n</acronym>/<acronym class="acronym">L10n</acronym> Usage and
      Setup</em></a></em></span></span></dt><dd><p>Describes how to use FreeBSD in languages other than
	  English.  Covers both system and application level
	  localization.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#updating-upgrading" title="Chapter 23. Updating and Upgrading FreeBSD">Chapter 23, <em>Updating and Upgrading FreeBSD</em></a></em></span></span></dt><dd><p>Explains the differences between FreeBSD-STABLE,
	  FreeBSD-CURRENT, and FreeBSD releases.  Describes which users
	  would benefit from tracking a development system and
	  outlines that process.  Covers the methods users may take
	  to update their system to the latest security
	  release.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#dtrace" title="Chapter 24. DTrace">Chapter 24, <em>DTrace</em></a></em></span></span></dt><dd><p>Describes how to configure and use the DTrace tool
	  from <span class="trademark">Sun</span>&#8482; in FreeBSD.  Dynamic tracing can help locate
	  performance issues, by performing real time system
	  analysis.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#serialcomms" title="Chapter 26. Serial Communications">Chapter 26, <em>Serial Communications</em></a></em></span></span></dt><dd><p>Explains how to connect terminals and modems to your
	  FreeBSD system for both dial in and dial out
	  connections.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#ppp-and-slip" title="Chapter 27. PPP">Chapter 27, <em><acronym class="acronym">PPP</acronym></em></a></em></span></span></dt><dd><p>Describes how to use PPP to connect to remote systems
	  with FreeBSD.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#mail" title="Chapter 28. Electronic Mail">Chapter 28, <em>Electronic Mail</em></a></em></span></span></dt><dd><p>Explains the different components of an email server
	  and dives into simple configuration topics for the most
	  popular mail server software:
	  <span class="application">sendmail</span>.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#network-servers" title="Chapter 29. Network Servers">Chapter 29, <em>Network Servers</em></a></em></span></span></dt><dd><p>Provides detailed instructions and example configuration
	  files to set up your FreeBSD machine as a network filesystem
	  server, domain name server, network information system
	  server, or time synchronization server.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#firewalls" title="Chapter 30. Firewalls">Chapter 30, <em>Firewalls</em></a></em></span></span></dt><dd><p>Explains the philosophy behind software-based firewalls
	  and provides detailed information about the configuration
	  of the different firewalls available for FreeBSD.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#advanced-networking" title="Chapter 31. Advanced Networking">Chapter 31, <em>Advanced Networking</em></a></em></span></span></dt><dd><p>Describes many networking topics, including sharing an
	  Internet connection with other computers on your LAN,
	  advanced routing topics, wireless networking, <span class="trademark">Bluetooth</span>®,
	  ATM, IPv6, and much more.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#mirrors" title="Appendix A. Obtaining FreeBSD">Appendix A, <em>Obtaining FreeBSD</em></a></em></span></span></dt><dd><p>Lists different sources for obtaining FreeBSD media on
	  CDROM or DVD as well as different sites on the Internet
	  that allow you to download and install FreeBSD.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#bibliography" title="Appendix B. Bibliography">Appendix B, <em>Bibliography</em></a></em></span></span></dt><dd><p>This book touches on many different subjects that may
	  leave you hungry for a more detailed explanation.  The
	  bibliography lists many excellent books that are referenced
	  in the text.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#eresources" title="Appendix C. Resources on the Internet">Appendix C, <em>Resources on the Internet</em></a></em></span></span></dt><dd><p>Describes the many forums available for FreeBSD users to
	  post questions and engage in technical conversations about
	  FreeBSD.</p></dd><dt><span class="term"><span class="emphasis"><em><a class="xref" href="#pgpkeys" title="Appendix D. OpenPGP Keys">Appendix D, <em>Open<acronym class="acronym">PGP</acronym> Keys</em></a></em></span></span></dt><dd><p>Lists the PGP fingerprints of several FreeBSD
	  Developers.</p></dd></dl></div><h2 class="title"><a id="preface-conv"></a>Conventions used
    in this book</h2><p>To provide a consistent and easy to read text, several
      conventions are followed throughout the book.</p><h3 class="title"><a id="preface-conv-typographic"></a>Typographic Conventions</h3><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em>Italic</em></span></span></dt><dd><p>An <span class="emphasis"><em>italic</em></span> font is used for
	  filenames, URLs, emphasized text, and the first usage of
	  technical terms.</p></dd><dt><span class="term"><code class="literal">Monospace</code></span></dt><dd><p>A <code class="literal">monospaced</code> font is used for error
	  messages, commands, environment variables, names of ports,
	  hostnames, user names, group names, device names, variables,
	  and code fragments.</p></dd><dt><span class="term"><span class="application">Bold</span></span></dt><dd><p>A <span class="keycap"><strong>bold</strong></span> font is used for
	  applications, commands, and keys.</p></dd></dl></div><h3 class="title"><a id="preface-conv-commands"></a>User
    Input</h3><p>Keys are shown in <span class="keycap"><strong>bold</strong></span> to stand out from
    other text.  Key combinations that are meant to be typed
    simultaneously are shown with `<code class="literal">+</code>' between
    the keys, such as:</p><p>
    <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>Del</strong></span></p><p>Meaning the user should type the <span class="keycap"><strong>Ctrl</strong></span>,
    <span class="keycap"><strong>Alt</strong></span>, and <span class="keycap"><strong>Del</strong></span> keys at the same
    time.</p><p>Keys that are meant to be typed in sequence will be separated
    with commas, for example:</p><p>
    <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>X</strong></span>,
    <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>S</strong></span></p><p>Would mean that the user is expected to type the
    <span class="keycap"><strong>Ctrl</strong></span> and <span class="keycap"><strong>X</strong></span> keys simultaneously
    and then to type the <span class="keycap"><strong>Ctrl</strong></span> and <span class="keycap"><strong>S</strong></span>
    keys simultaneously.</p><h3 class="title"><a id="preface-conv-examples"></a>Examples</h3><p>Examples starting with <code class="filename">C:\&gt;</code>
    indicate a <span class="trademark">MS-DOS</span>® command.  Unless otherwise noted, these
    commands may be executed from a <span class="quote">&#8220;<span class="quote">Command Prompt</span>&#8221;</span>
    window in a modern <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>®
    environment.</p><pre class="screen"><code class="prompt">E:\&gt;</code> <strong class="userinput"><code>tools\fdimage floppies\kern.flp A:</code></strong></pre><p>Examples starting with <code class="prompt">#</code> indicate a command that
    must be invoked as the superuser in FreeBSD.  You can login as
    <code class="systemitem">root</code> to type the
    command, or login as your normal account and use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> to
    gain superuser privileges.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=kern.flp of=/dev/fd0</code></strong></pre><p>Examples starting with <code class="prompt">%</code> indicate a command that
    should be invoked from a normal user account.  Unless otherwise
    noted, C-shell syntax is used for setting environment variables
    and other shell commands.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>top</code></strong></pre><h2 class="title"><a id="preface-acknowledgements"></a>Acknowledgments</h2><p>The book you are holding represents the efforts of many
    hundreds of people around the world.  Whether they sent in fixes
    for typos, or submitted complete chapters, all the contributions
    have been useful.</p><p>Several companies have supported the development of this
    document by paying authors to work on it full-time, paying for
    publication, etc.  In particular, BSDi (subsequently acquired by
    <a class="link" href="http://www.windriver.com" target="_top">Wind River
      Systems</a>) paid members of the FreeBSD Documentation Project
    to work on improving this book full time leading up to the
    publication of the first printed edition in March 2000 (ISBN
    1-57176-241-8).  Wind River Systems then paid several additional
    authors to make a number of improvements to the print-output
    infrastructure and to add additional chapters to the text.  This
    work culminated in the publication of the second printed edition
    in November 2001 (ISBN 1-57176-303-1).  In 2003-2004, <a class="link" href="http://www.freebsdmall.com" target="_top">FreeBSD Mall, Inc</a>,
    paid several contributors to improve the Handbook in preparation
    for the third printed edition.</p></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="getting-started"></a>Part I. Getting Started</h1></div></div></div><div class="partintro"><div xmlns=""></div><p>This part of the handbook is for users and administrators
	who are new to FreeBSD.  These chapters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Introduce FreeBSD.</p></li><li class="listitem"><p>Guide readers through the installation process.</p></li><li class="listitem"><p>Teach <span class="trademark">UNIX</span>® basics and fundamentals.</p></li><li class="listitem"><p>Show how to install the wealth of third party
	    applications available for FreeBSD.</p></li><li class="listitem"><p>Introduce X, the <span class="trademark">UNIX</span>® windowing system, and detail
	    how to configure a desktop environment that makes users
	    more productive.</p></li></ul></div><p>The number of forward references in the text have been
	kept to a minimum so that this section can be read from front
	to back with minimal page flipping.</p><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="chapter"><a href="#introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="sect1"><a href="#introduction-synopsis">1.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#nutshell">1.2. Welcome to FreeBSD!</a></span></dt><dt><span class="sect1"><a href="#history">1.3. About the FreeBSD Project</a></span></dt></dl></dd><dt><span class="chapter"><a href="#bsdinstall">2. Installing FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#bsdinstall-synopsis">2.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-hardware">2.2. Minimum Hardware Requirements</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-pre">2.3. Pre-Installation Tasks</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-start">2.4. Starting the Installation</a></span></dt><dt><span class="sect1"><a href="#using-bsdinstall">2.5. Using <span class="application">bsdinstall</span></a></span></dt><dt><span class="sect1"><a href="#bsdinstall-partitioning">2.6. Allocating Disk Space</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-fetching-distribution">2.7. Fetching Distribution Files</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-post">2.8. Accounts, Time Zone, Services and Hardening</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-network">2.9. Network Interfaces</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-install-trouble">2.10. Troubleshooting</a></span></dt><dt><span class="sect1"><a href="#using-live-cd">2.11. Using the Live <acronym class="acronym">CD</acronym></a></span></dt></dl></dd><dt><span class="chapter"><a href="#basics">3. FreeBSD Basics</a></span></dt><dd><dl><dt><span class="sect1"><a href="#basics-synopsis">3.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#consoles">3.2. Virtual Consoles and Terminals</a></span></dt><dt><span class="sect1"><a href="#users-synopsis">3.3. Users and Basic Account Management</a></span></dt><dt><span class="sect1"><a href="#permissions">3.4. Permissions</a></span></dt><dt><span class="sect1"><a href="#dirstructure">3.5. Directory Structure</a></span></dt><dt><span class="sect1"><a href="#disk-organization">3.6. Disk Organization</a></span></dt><dt><span class="sect1"><a href="#mount-unmount">3.7. Mounting and Unmounting File Systems</a></span></dt><dt><span class="sect1"><a href="#basics-processes">3.8. Processes and Daemons</a></span></dt><dt><span class="sect1"><a href="#shells">3.9. Shells</a></span></dt><dt><span class="sect1"><a href="#editors">3.10. Text Editors</a></span></dt><dt><span class="sect1"><a href="#basics-devices">3.11. Devices and Device Nodes</a></span></dt><dt><span class="sect1"><a href="#basics-more-information">3.12. Manual Pages</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ports">4. Installing Applications: Packages and Ports</a></span></dt><dd><dl><dt><span class="sect1"><a href="#ports-synopsis">4.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#ports-overview">4.2. Overview of Software Installation</a></span></dt><dt><span class="sect1"><a href="#ports-finding-applications">4.3. Finding Software</a></span></dt><dt><span class="sect1"><a href="#pkgng-intro">4.4. Using <span class="application">pkg</span> for Binary Package
      Management</a></span></dt><dt><span class="sect1"><a href="#ports-using">4.5. Using the Ports Collection</a></span></dt><dt><span class="sect1"><a href="#ports-poudriere">4.6. Building Packages with
      <span class="application">Poudriere</span></a></span></dt><dt><span class="sect1"><a href="#ports-nextsteps">4.7. Post-Installation Considerations</a></span></dt><dt><span class="sect1"><a href="#ports-broken">4.8. Dealing with Broken Ports</a></span></dt></dl></dd><dt><span class="chapter"><a href="#x11">5. The X Window System</a></span></dt><dd><dl><dt><span class="sect1"><a href="#x11-synopsis">5.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#x-understanding">5.2. Terminology</a></span></dt><dt><span class="sect1"><a href="#x-install">5.3. Installing <span class="application">Xorg</span></a></span></dt><dt><span class="sect1"><a href="#x-config">5.4. <span class="application">Xorg</span> Configuration</a></span></dt><dt><span class="sect1"><a href="#x-fonts">5.5. Using Fonts in <span class="application">Xorg</span></a></span></dt><dt><span class="sect1"><a href="#x-xdm">5.6. The X Display Manager</a></span></dt><dt><span class="sect1"><a href="#x11-wm">5.7. Desktop Environments</a></span></dt><dt><span class="sect1"><a href="#x-compiz-fusion">5.8. Installing Compiz Fusion</a></span></dt><dt><span class="sect1"><a href="#x11-troubleshooting">5.9. Troubleshooting</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="introduction"></a>Chapter 1. Introduction</h2></div><div><span class="authorgroup">Restructured, reorganized, and parts rewritten
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jim</span> <span class="surname">Mock</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#introduction-synopsis">1.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#nutshell">1.2. Welcome to FreeBSD!</a></span></dt><dt><span class="sect1"><a href="#history">1.3. About the FreeBSD Project</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="introduction-synopsis"></a>1.1. Synopsis</h2></div></div></div><p>Thank you for your interest in FreeBSD!  The following chapter
      covers various aspects of the FreeBSD Project, such as its
      history, goals, development model, and so on.</p><p>After reading this chapter you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How FreeBSD relates to other computer operating
	  systems.</p></li><li class="listitem"><p>The history of the FreeBSD Project.</p></li><li class="listitem"><p>The goals of the FreeBSD Project.</p></li><li class="listitem"><p>The basics of the FreeBSD open-source development
	  model.</p></li><li class="listitem"><p>And of course: where the name <span class="quote">&#8220;<span class="quote">FreeBSD</span>&#8221;</span> comes
	  from.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="nutshell"></a>1.2. Welcome to FreeBSD!</h2></div></div></div><a id="idp45685112" class="indexterm"></a><p>FreeBSD is an Open Source, standards-compliant Unix-like
      operating system for x86 (both 32 and 64 bit), <span class="trademark">ARM</span>®, AArch64,
      <span class="trademark">RISC-V</span>®, <span class="trademark">MIPS</span>®, <span class="trademark">POWER</span>®, <span class="trademark">PowerPC</span>®, and Sun <span class="trademark">UltraSPARC</span>®
      computers.  It provides all the features that are
      nowadays taken for granted, such as preemptive multitasking,
      memory protection, virtual memory, multi-user facilities, SMP
      support, all the Open Source development tools for different
      languages and frameworks, and desktop features centered around
      X Window System, KDE, or GNOME.  Its particular strengths
      are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Liberal Open Source license</em></span>,
	  which grants you rights to freely modify and extend
	  its source code and incorporate it in both Open Source
	  projects and closed products without imposing
	  restrictions typical to copyleft licenses, as well
	  as avoiding potential license incompatibility
	  problems.</p></li><li class="listitem"><p><span class="emphasis"><em>Strong TCP/IP networking</em></span>
	  <a id="idp45698552" class="indexterm"></a> - FreeBSD
	  implements industry standard protocols with ever
	  increasing performance and scalability.  This makes
	  it a good match in both server, and routing/firewalling
	  roles - and indeed many companies and vendors use it
	  precisely for that purpose.</p></li><li class="listitem"><p><span class="emphasis"><em>Fully integrated OpenZFS support</em></span>,
	  including root-on-ZFS, ZFS Boot Environments, fault
	  management, administrative delegation, support for jails,
	  FreeBSD specific documentation, and system installer
	  support.</p></li><li class="listitem"><p><span class="emphasis"><em>Extensive security features</em></span>,
	  from the Mandatory Access Control framework to Capsicum
	  capability and sandbox mechanisms.</p></li><li class="listitem"><p><span class="emphasis"><em>Over 30 thousand prebuilt
	    packages</em></span> for all supported architectures,
	  and the Ports Collection which makes it easy to build your
	  own, customized ones.</p></li><li class="listitem"><p><span class="emphasis"><em>Documentation</em></span> - in addition
	  to Handbook and books from different authors that cover
	  topics ranging from system administration to kernel
	  internals, there are also the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=man&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">man</span>(1)</span></a> pages, not only
	  for userspace daemons, utilities, and configuration files,
	  but also for kernel driver APIs (section 9) and individual
	  drivers (section 4).</p></li><li class="listitem"><p><span class="emphasis"><em>Simple and consistent repository structure
	    and build system</em></span> - FreeBSD uses a single
	  repository for all of its components, both kernel and
	  userspace.  This, along with an unified and easy to
	  customize build system and a well thought out development
	  process makes it easy to integrate FreeBSD with build
	  infrastructure for your own product.</p></li><li class="listitem"><p><span class="emphasis"><em>Staying true to Unix philosophy</em></span>,
	  preferring composability instead of monolithic <span class="quote">&#8220;<span class="quote">all
	    in one</span>&#8221;</span> daemons with hardcoded behavior.</p></li><li class="listitem"><p><a id="idp45732856" class="indexterm"></a>
	  <span class="emphasis"><em>Binary compatibility</em></span> with Linux,
	  which makes it possible to run many Linux binaries without
	  the need for virtualisation.</p></li></ul></div><p>FreeBSD is based on the 4.4BSD-Lite<a id="idp45741048" class="indexterm"></a> release from Computer
      Systems Research Group (CSRG)<a id="idp45748216" class="indexterm"></a> at the University of California at Berkeley, and
      carries on the distinguished tradition of BSD systems
      development.  In addition to the fine work provided by CSRG,
      the FreeBSD Project has put in many thousands of man-hours
      into extending the functionality and fine-tuning the system
      for maximum performance and reliability
      in real-life load situations.  FreeBSD offers performance and
      reliability on par with other Open Source and commercial
      offerings, combined with cutting-edge features not available
      anywhere else.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="os-overview"></a>1.2.1. What Can FreeBSD Do?</h3></div></div></div><p>The applications to which FreeBSD can be put are truly
	limited only by your own imagination.  From software
	development to factory automation, inventory control to
	azimuth correction of remote satellite antennae; if it can be
	done with a commercial <span class="trademark">UNIX</span>® product then it is more than
	likely that you can do it with FreeBSD too!  FreeBSD also benefits
	significantly from literally thousands of high quality
	applications developed by research centers and universities
	around the world, often available at little to no cost.</p><p>Because the source code for FreeBSD itself is freely
	available, the system can also be customized to an almost
	unheard of degree for special applications or projects, and in
	ways not generally possible with operating systems from most
	major commercial vendors.  Here is just a sampling of some of
	the applications in which people are currently using
	FreeBSD:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Internet Services:</em></span> The robust
	    TCP/IP networking built into FreeBSD makes it an ideal
	    platform for a variety of Internet services such
	    as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Web servers</p></li><li class="listitem"><p>IPv4 and IPv6 routing</p></li><li class="listitem"><p>Firewalls<a id="idp45765368" class="indexterm"></a>
		and NAT<a id="idp45767160" class="indexterm"></a>
		(<span class="quote">&#8220;<span class="quote">IP masquerading</span>&#8221;</span>) gateways</p></li><li class="listitem"><p>FTP servers<a id="idp45770872" class="indexterm"></a></p></li><li class="listitem"><p>
		<a id="idp45774712" class="indexterm"></a>
		<a id="idp45777528" class="indexterm"></a>
		Email servers</p></li><li class="listitem"><p>And more...</p></li></ul></div></li><li class="listitem"><p><span class="emphasis"><em>Education:</em></span>  Are you a student of
	    computer science or a related engineering field?  There
	    is no better way of learning about operating systems,
	    computer architecture and networking than the hands on,
	    under the hood experience that FreeBSD can provide.  A number
	    of freely available CAD, mathematical and graphic design
	    packages also make it highly useful to those whose primary
	    interest in a computer is to get
	    <span class="emphasis"><em>other</em></span> work done!</p></li><li class="listitem"><p><span class="emphasis"><em>Research:</em></span>  With source code for
	    the entire system available, FreeBSD is an excellent platform
	    for research in operating systems as well as other
	    branches of computer science.  FreeBSD's freely available
	    nature also makes it possible for remote groups to
	    collaborate on ideas or shared development without having
	    to worry about special licensing agreements or limitations
	    on what may be discussed in open forums.</p></li><li class="listitem"><p><span class="emphasis"><em>Networking:</em></span> Need a new
	    router?<a id="idp45790456" class="indexterm"></a>  A name server (DNS)?<a id="idp45792248" class="indexterm"></a>  A firewall to keep people out of your
	    internal network?  FreeBSD can easily turn that unused
	    PC sitting in the corner into an advanced router with
	    sophisticated packet-filtering capabilities.</p></li><li class="listitem"><p><span class="emphasis"><em>Embedded:</em></span> FreeBSD makes an
	    excellent platform to build embedded systems upon.
	    <a id="idp45809016" class="indexterm"></a>
	    With support for the <span class="trademark">ARM</span>®, <span class="trademark">MIPS</span>® and <span class="trademark">PowerPC</span>®
	    platforms, coupled with a robust network stack, cutting
	    edge features and the permissive <a class="link" href="../../../../doc/en_US.ISO8859-1/books/faq/introduction.html#bsd-license-restrictions" target="_top">BSD
	      license</a> FreeBSD makes an excellent foundation for
	    building embedded routers, firewalls, and other
	    devices.</p></li><li class="listitem"><p>
	    <a id="idp45821688" class="indexterm"></a>
	    <a id="idp45823608" class="indexterm"></a>
	    <a id="idp45825016" class="indexterm"></a>
	    <span class="emphasis"><em>Desktop:</em></span> FreeBSD makes a
	    fine choice for an inexpensive desktop solution
	    using the freely available X11 server.
	    FreeBSD offers a choice from many open-source desktop
	    environments, including the standard
	    <span class="application">GNOME</span> and
	    <span class="application">KDE</span> graphical user interfaces.
	    FreeBSD can even boot <span class="quote">&#8220;<span class="quote">diskless</span>&#8221;</span> from
	    a central server, making individual workstations
	    even cheaper and easier to administer.</p></li><li class="listitem"><p><span class="emphasis"><em>Software Development:</em></span>  The basic
	    FreeBSD system comes with a full suite of development
	    tools including a full
	    C/C++<a id="idp45832568" class="indexterm"></a>
	    compiler and debugger suite.
	    Support for many other languages are also available
	    through the ports and packages collection.</p></li></ul></div><p>FreeBSD is available to download free of charge, or can be
	obtained on either CD-ROM or DVD.  Please see
	<a class="xref" href="#mirrors" title="Appendix A. Obtaining FreeBSD">Appendix A, <em>Obtaining FreeBSD</em></a> for more information about obtaining
	FreeBSD.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="introduction-nutshell-users"></a>1.2.2. Who Uses FreeBSD?</h3></div></div></div><a id="idp45855480" class="indexterm"></a><p>FreeBSD has been known for its web serving capabilities -
	sites that run on FreeBSD include
	<a class="link" href="https://news.ycombinator.com/" target="_top">Hacker News</a>,
	<a class="link" href="http://www.netcraft.com/" target="_top">Netcraft</a>,
	<a class="link" href="http://www.163.com/" target="_top">NetEase</a>,
	<a class="link" href="https://signup.netflix.com/openconnect" target="_top">Netflix</a>,
	<a class="link" href="http://www.sina.com/" target="_top">Sina</a>,
	<a class="link" href="http://www.sony.co.jp/" target="_top">Sony Japan</a>,
	<a class="link" href="http://www.rambler.ru/" target="_top">Rambler</a>,
	<a class="link" href="http://www.yahoo.com/" target="_top">Yahoo!</a>, and
	<a class="link" href="http://www.yandex.ru/" target="_top">Yandex</a>.
      </p><p>FreeBSD's advanced features, proven security, predictable
	release cycle, and permissive license have led to its use as a
	platform for building many commercial and open source
	appliances, devices, and products.  Many of the world's
	largest IT companies use FreeBSD:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.apache.org/" target="_top">Apache</a>
	    <a id="idp45877624" class="indexterm"></a> - The Apache Software Foundation runs most of
	    its public facing infrastructure, including possibly one
	    of the largest SVN repositories in the world with over 1.4
	    million commits, on FreeBSD.</p></li><li class="listitem"><p><a class="link" href="http://www.apple.com/" target="_top">Apple</a>
	    <a id="idp45895416" class="indexterm"></a> - OS X borrows heavily from FreeBSD for the
	    network stack, virtual file system, and many userland
	    components.  Apple iOS also contains elements borrowed
	    from FreeBSD.</p></li><li class="listitem"><p><a class="link" href="http://www.cisco.com/" target="_top">Cisco</a>
	    <a id="idp45900280" class="indexterm"></a> - IronPort network security and anti-spam
	    appliances run a modified FreeBSD kernel.</p></li><li class="listitem"><p><a class="link" href="http://www.citrix.com/" target="_top">Citrix</a>
	    <a id="idp45905016" class="indexterm"></a> - The NetScaler line of security appliances
	    provide layer 4-7 load balancing, content caching,
	    application firewall, secure VPN, and mobile cloud network
	    access, along with the power of a FreeBSD shell.</p></li><li class="listitem"><p><a class="link" href="https://www.emc.com/isilon" target="_top">Dell EMC Isilon</a>
	    <a id="idp45908984" class="indexterm"></a> - Isilon's enterprise storage appliances
	    are based on FreeBSD.  The extremely liberal FreeBSD license
	    allowed Isilon to integrate their intellectual property
	    throughout the kernel and focus on building their product
	    instead of an operating system.</p></li><li class="listitem"><p><a class="link" href="http://www.quest.com/KACE" target="_top">Quest
	      KACE</a>
	    <a id="idp45913336" class="indexterm"></a> - The KACE system management appliances run
	    FreeBSD because of its reliability, scalability, and the
	    community that supports its continued development.</p></li><li class="listitem"><p><a class="link" href="http://www.ixsystems.com/" target="_top">iXsystems</a>
	    <a id="idp45918072" class="indexterm"></a> - The TrueNAS line of unified storage
	    appliances is based on FreeBSD.  In addition to their
	    commercial products, iXsystems also manages development of
	    the open source projects TrueOS and FreeNAS.</p></li><li class="listitem"><p><a class="link" href="http://www.juniper.net/" target="_top">Juniper</a>
	    <a id="idp45922552" class="indexterm"></a> - The JunOS operating system that powers all
	    Juniper networking gear (including routers, switches,
	    security, and networking appliances) is based on FreeBSD.
	    Juniper is one of many vendors that showcases the
	    symbiotic relationship between the project and vendors of
	    commercial products.  Improvements generated at Juniper
	    are upstreamed into FreeBSD to reduce the complexity of
	    integrating new features from FreeBSD back into JunOS in the
	    future.</p></li><li class="listitem"><p><a class="link" href="http://www.mcafee.com/" target="_top">McAfee</a>
	    <a id="idp45927160" class="indexterm"></a> - SecurOS, the basis of McAfee enterprise
	    firewall products including Sidewinder is based on
	    FreeBSD.</p></li><li class="listitem"><p><a class="link" href="http://www.netapp.com/" target="_top">NetApp</a>
	    <a id="idp45946104" class="indexterm"></a> - The Data ONTAP GX line of storage
	    appliances are based on FreeBSD.  In addition, NetApp has
	    contributed back many features, including the new BSD
	    licensed hypervisor, bhyve.</p></li><li class="listitem"><p><a class="link" href="http://www.netflix.com/" target="_top">Netflix</a>
	    <a id="idp45953784" class="indexterm"></a> - The OpenConnect appliance that Netflix
	    uses to stream movies to its customers is based on FreeBSD.
	    Netflix has made extensive contributions to the codebase
	    and works to maintain a zero delta from mainline FreeBSD.
	    Netflix OpenConnect appliances are responsible for
	    delivering more than 32% of all Internet traffic in North
	    America.</p></li><li class="listitem"><p><a class="link" href="http://www.sandvine.com/" target="_top">Sandvine</a>
	    <a id="idp45958776" class="indexterm"></a> - Sandvine uses FreeBSD as the basis of their
	    high performance real-time network processing platforms
	    that make up their intelligent network policy control
	    products.</p></li><li class="listitem"><p><a class="link" href="http://www.sony.com/" target="_top">Sony</a>
	    <a id="idp45963512" class="indexterm"></a> - The PlayStation 4 gaming console runs a
	    modified version of FreeBSD.</p></li><li class="listitem"><p><a class="link" href="http://www.sophos.com/" target="_top">Sophos</a>
	    <a id="idp45968248" class="indexterm"></a> - The Sophos Email Appliance product is based
	    on a hardened FreeBSD and scans inbound mail for spam and
	    viruses, while also monitoring outbound mail for malware
	    as well as the accidental loss of sensitive
	    information.</p></li><li class="listitem"><p><a class="link" href="http://www.spectralogic.com/" target="_top">Spectra
	      Logic</a>
	    <a id="idp45971704" class="indexterm"></a> - The nTier line of archive grade storage
	    appliances run FreeBSD and OpenZFS.</p></li><li class="listitem"><p><a class="link" href="https://www.stormshield.eu" target="_top">Stormshield</a>
	    <a id="idp45980792" class="indexterm"></a> - Stormshield Network Security appliances
	    are based on a hardened version of FreeBSD.  The BSD license
	    allows them to integrate their own intellectual property with
	    the system while returning a great deal of interesting
	    development to the community.</p></li><li class="listitem"><p><a class="link" href="http://www.weather.com/" target="_top">The Weather
	      Channel</a>
	    <a id="idp45985144" class="indexterm"></a> - The IntelliStar appliance that is installed
	    at each local cable provider's headend and is responsible
	    for injecting local weather forecasts into the cable TV
	    network's programming runs FreeBSD.</p></li><li class="listitem"><p><a class="link" href="http://www.verisign.com/" target="_top">Verisign</a>
	    <a id="idp45989752" class="indexterm"></a> - Verisign is responsible for operating the
	    .com and .net root domain registries as well as the
	    accompanying DNS infrastructure.  They rely on a number of
	    different network operating systems including FreeBSD to
	    ensure there is no common point of failure in their
	    infrastructure.</p></li><li class="listitem"><p><a class="link" href="http://www.voxer.com/" target="_top">Voxer</a>
	    <a id="idp45994232" class="indexterm"></a> - Voxer powers their mobile voice messaging
	    platform with ZFS on FreeBSD.  Voxer switched from a Solaris
	    derivative to FreeBSD because of its superior documentation,
	    larger and more active community, and more developer
	    friendly environment.  In addition to critical features
	    like <acronym class="acronym">ZFS</acronym> and DTrace, FreeBSD also offers
	    TRIM support for <acronym class="acronym">ZFS</acronym>.</p></li><li class="listitem"><p><a class="link" href="https://fudosecurity.com/en/" target="_top">Fudo
	      Security</a>
	    <a id="idp46001272" class="indexterm"></a> - The FUDO security appliance allows
	    enterprises to monitor, control, record, and audit
	    contractors and administrators who work on their systems.
	    Based on all of the best security features of FreeBSD
	    including ZFS, GELI, Capsicum, HAST, and
	    auditdistd.</p></li></ul></div><p>FreeBSD has also spawned a number of related open source
	projects:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://bsdrp.net/" target="_top">BSD
	      Router</a>
	    <a id="idp46021624" class="indexterm"></a> - A FreeBSD based replacement for large
	    enterprise routers designed to run on standard PC
	    hardware.</p></li><li class="listitem"><p><a class="link" href="http://www.freenas.org/" target="_top">FreeNAS</a>
	    <a id="idp46030584" class="indexterm"></a> - A customized FreeBSD designed to be used as a
	    network file server appliance.  Provides a python based
	    web interface to simplify the management of both the UFS
	    and ZFS file systems.  Includes support for NFS, SMB/CIFS,
	    AFP, FTP, and iSCSI.  Includes an extensible plugin system
	    based on FreeBSD jails.</p></li><li class="listitem"><p><a class="link" href="https://ghostbsd.org/" target="_top">GhostBSD</a>
	    <a id="idp46047480" class="indexterm"></a> - is derived from FreeBSD, uses the GTK
	    environment to provide a beautiful looks and comfortable
	    experience on the modern BSD platform offering a natural
	    and native <span class="trademark">UNIX</span>® work environment.</p></li><li class="listitem"><p><a class="link" href="http://mfsbsd.vx.sk/" target="_top">mfsBSD</a>
	    <a id="idp46053496" class="indexterm"></a> - A toolkit for building a FreeBSD system image
	    that runs entirely from memory.</p></li><li class="listitem"><p><a class="link" href="http://www.nas4free.org/" target="_top">NAS4Free</a>
	    <a id="idp46058360" class="indexterm"></a> - A file server distribution based on FreeBSD
	    with a PHP powered web interface.</p></li><li class="listitem"><p><a class="link" href="http://www.opnsense.org/" target="_top">OPNSense</a>
	    <a id="idp46063096" class="indexterm"></a> - OPNsense is an open source, easy-to-use and
	    easy-to-build FreeBSD based firewall and routing platform.
	    OPNsense includes most of the features available in
	    expensive commercial firewalls, and more in many cases.
	    It brings the rich feature set of commercial offerings
	    with the benefits of open and verifiable sources.</p></li><li class="listitem"><p><a class="link" href="https://www.trueos.org" target="_top">TrueOS</a>
	    <a id="idp46070776" class="indexterm"></a> - TrueOS is based on the legendary security
	    and stability of FreeBSD.  TrueOS follows FreeBSD-CURRENT, with
	    the latest drivers, security updates, and packages
	    available.</p></li><li class="listitem"><p><a class="link" href="https://www.furybsd.org" target="_top">FuryBSD</a>
	    <a id="idp46080504" class="indexterm"></a> - is a brand new, open source FreeBSD desktop.
	    FuryBSD pays homage to desktop BSD projects of the past
	    like PC-BSD and TrueOS with its graphical interface and
	    adds additional tools like a live, hybrid USB/DVD image.
	    FuryBSD is completely free to use and distributed under
	    the BSD license.</p></li><li class="listitem"><p><a class="link" href="https://www.midnightbsd.org" target="_top">MidnightBSD</a>
	    <a id="idp46097656" class="indexterm"></a> - is a FreeBSD derived operating system
	    developed with desktop users in mind.  It includes all the
	    software you'd expect for your daily tasks: mail,
	    web browsing, word processing, gaming, and much
	    more.</p></li><li class="listitem"><p><a class="link" href="http://www.pfsense.org/" target="_top">pfSense</a>
	    <a id="idp46102648" class="indexterm"></a> - A firewall distribution based on FreeBSD with
	    a huge array of features and extensive IPv6
	    support.</p></li><li class="listitem"><p><a class="link" href="http://zrouter.org/" target="_top">ZRouter</a>
	    <a id="idp46106616" class="indexterm"></a> - An open source alternative firmware for
	    embedded devices based on FreeBSD.  Designed to replace the
	    proprietary firmware on off-the-shelf routers.</p></li></ul></div><p>A list of <a class="link" href="https://www.freebsdfoundation.org/about/testimonials/" target="_top">
	  testimonials from companies basing their products and
	  services on FreeBSD</a> can be found at the FreeBSD
	  Foundation website.  Wikipedia also maintains a <a class="link" href="https://en.wikipedia.org/wiki/List_of_products_based_on_FreeBSD" target="_top">list
	  of products based on FreeBSD</a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="history"></a>1.3. About the FreeBSD Project</h2></div></div></div><p>The following section provides some background information
      on the project, including a brief history, project goals, and
      the development model of the project.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="intro-history"></a>1.3.1. A Brief History of FreeBSD</h3></div></div></div><a id="idp46117624" class="indexterm"></a><a id="idp46119032" class="indexterm"></a><a id="idp46119928" class="indexterm"></a><a id="idp46121080" class="indexterm"></a><a id="idp46122616" class="indexterm"></a><p>The FreeBSD Project had its genesis in the early part
	of 1993, partially as the brainchild of the Unofficial
	386BSDPatchkit's last 3 coordinators: Nate Williams,
	Rod Grimes and Jordan Hubbard.</p><a id="idp46126072" class="indexterm"></a><p>The original goal was to produce an intermediate snapshot
	of 386BSD in order to fix a number of problems that
	the patchkit mechanism was just not capable of solving.  The
	early working title for the project was 386BSD 0.5 or 386BSD
	Interim in reference of that fact.</p><a id="idp46128632" class="indexterm"></a><p>386BSD was Bill Jolitz's operating system, which had been
	up to that point suffering rather severely from almost a
	year's worth of neglect.  As the patchkit swelled ever more
	uncomfortably with each passing day, they decided to assist
	Bill by providing this interim <span class="quote">&#8220;<span class="quote">cleanup</span>&#8221;</span>
	snapshot.  Those plans came to a rude halt when Bill Jolitz
	suddenly decided to withdraw his sanction from the project
	without any clear indication of what would be done
	instead.</p><a id="idp46131960" class="indexterm"></a><a id="idp46133112" class="indexterm"></a><p>The trio thought that the goal remained worthwhile, even
	without Bill's support, and so they adopted the name "FreeBSD"
	coined by David Greenman.  The initial objectives were set
	after consulting with the system's current users and, once it
	became clear that the project was on the road to perhaps even
	becoming a reality, Jordan contacted Walnut Creek CDROM with
	an eye toward improving FreeBSD's distribution channels for those
	many unfortunates without easy access to the Internet.  Walnut
	Creek CDROM not only supported the idea of distributing FreeBSD
	on CD but also went so far as to provide the project with a
	machine to work on and a fast Internet connection.  Without
	Walnut Creek CDROM's almost unprecedented degree of faith in
	what was, at the time, a completely unknown project, it is
	quite unlikely that FreeBSD would have gotten as far, as fast, as
	it has today.</p><a id="idp46135416" class="indexterm"></a><a id="idp46136568" class="indexterm"></a><a id="idp46138232" class="indexterm"></a><a id="idp46140280" class="indexterm"></a><a id="idp46142328" class="indexterm"></a><p>The first CD-ROM (and general net-wide) distribution was
	FreeBSD 1.0, released in December of 1993.  This was based
	on the 4.3BSD-Lite (<span class="quote">&#8220;<span class="quote">Net/2</span>&#8221;</span>) tape from U.C.
	Berkeley, with many components also provided by 386BSD and the
	Free Software Foundation.  It was a fairly reasonable success
	for a first offering, and they followed it with the highly
	successful FreeBSD 1.1 release in May of 1994.</p><a id="idp46147448" class="indexterm"></a><a id="idp46152696" class="indexterm"></a><a id="idp46154104" class="indexterm"></a><a id="idp46155384" class="indexterm"></a><p>Around this time, some rather unexpected storm clouds
	formed on the horizon as Novell and U.C. Berkeley settled
	their long-running lawsuit over the legal status of the
	Berkeley Net/2 tape.  A condition of that settlement was U.C.
	Berkeley's concession that large parts of Net/2 were
	<span class="quote">&#8220;<span class="quote">encumbered</span>&#8221;</span> code and the property of Novell, who
	had in turn acquired it from AT&amp;T some time previously.
	What Berkeley got in return was Novell's
	<span class="quote">&#8220;<span class="quote">blessing</span>&#8221;</span> that the 4.4BSD-Lite release, when
	it was finally released, would be declared unencumbered and
	all existing Net/2 users would be strongly encouraged to
	switch.  This included FreeBSD, and the project was given until
	the end of July 1994 to stop shipping its own Net/2 based
	product.  Under the terms of that agreement, the project was
	allowed one last release before the deadline, that release
	being FreeBSD 1.1.5.1.</p><p>FreeBSD then set about the arduous task of literally
	re-inventing itself from a completely new and rather
	incomplete set of 4.4BSD-Lite bits.  The <span class="quote">&#8220;<span class="quote">Lite</span>&#8221;</span>
	releases were light in part because Berkeley's CSRG had
	removed large chunks of code required for actually
	constructing a bootable running system (due to various legal
	requirements) and the fact that the Intel port of 4.4 was
	highly incomplete.  It took the project until November of 1994
	to make this transition, and in December it released
	FreeBSD 2.0 to the world.  Despite being still more than a
	little rough around the edges, the release was a significant
	success and was followed by the more robust and easier to
	install FreeBSD 2.0.5 release in June of 1995.</p><p>Since that time, FreeBSD has made a series of releases each
	time improving the stability, speed, and feature set of the
	previous version.</p><p>For now, long-term development projects continue to take
	place in the 10.X-CURRENT (trunk) branch, and snapshot
	releases of 10.X are continually made available from <a class="link" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/snapshots/" target="_top">the
	  snapshot server</a> as work progresses.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="goals"></a>1.3.2. FreeBSD Project Goals</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jordan</span> <span class="surname">Hubbard</span></span>. </span></div></div></div><a id="idp46172664" class="indexterm"></a><p>The goals of the FreeBSD Project are to provide software
	that may be used for any purpose and without strings attached.
	Many of us have a significant investment in the code (and
	project) and would certainly not mind a little financial
	compensation now and then, but we are definitely not prepared
	to insist on it.  We believe that our first and foremost
	<span class="quote">&#8220;<span class="quote">mission</span>&#8221;</span> is to provide code to any and all
	comers, and for whatever purpose, so that the code gets the
	widest possible use and provides the widest possible benefit.
	This is, I believe, one of the most fundamental goals of Free
	Software and one that we enthusiastically support.</p><a id="idp46189432" class="indexterm"></a><a id="idp46191096" class="indexterm"></a><a id="idp46193144" class="indexterm"></a><p>That code in our source tree which falls under the GNU
	General Public License (GPL) or Library General Public License
	(LGPL) comes with slightly more strings attached, though at
	least on the side of enforced access rather than the usual
	opposite.  Due to the additional complexities that can evolve
	in the commercial use of GPL software we do, however, prefer
	software submitted under the more relaxed BSD license when
	it is a reasonable option to do so.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="development"></a>1.3.3. The FreeBSD Development Model</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Satoshi</span> <span class="surname">Asami</span></span>. </span></div></div></div><a id="idp46203896" class="indexterm"></a><p>The development of FreeBSD is a very open and flexible
	process, being literally built from the contributions of
	thousands of people around the world, as can be seen from our
	<a class="link" href="../../../../doc/en_US.ISO8859-1/articles/contributors/article.html" target="_top">list
	  of contributors</a>.  FreeBSD's development infrastructure
	allow these thousands of contributors to collaborate over the
	Internet.  We are constantly on the lookout for new developers
	and ideas, and those interested in becoming more closely
	involved with the project need simply contact us at the
	<a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers" target="_top">FreeBSD technical discussions mailing list</a>.  The <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce" target="_top">FreeBSD announcements mailing list</a> is also available to those
	wishing to make other FreeBSD users aware of major areas of
	work.</p><p>Useful things to know about the FreeBSD Project and its
	development process, whether working independently or in close
	cooperation:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">The SVN repositories<a id="development-cvs-repository"></a></span></dt><dd><p>
	      <a id="idp46219000" class="indexterm"></a>

	      <a id="idp46222072" class="indexterm"></a>

	      <a id="idp46237432" class="indexterm"></a>

	      <a id="idp46242040" class="indexterm"></a>

	      <a id="idp46243960" class="indexterm"></a>

	      <a id="idp46245752" class="indexterm"></a>
	      For several years, the central source tree for FreeBSD
	      was maintained by
	      <a class="link" href="http://www.nongnu.org/cvs/" target="_top">CVS</a>
	      (Concurrent Versions System), a freely available source
	      code control tool.  In June 2008, the Project switched
	      to using <a class="link" href="http://subversion.tigris.org" target="_top">SVN</a>
	      (Subversion).  The switch was deemed necessary, as the
	      technical limitations imposed by
	      <span class="application">CVS</span> were becoming obvious due
	      to the rapid expansion of the source tree and the amount
	      of history already stored.  The Documentation Project
	      and Ports Collection repositories also moved from
	      <span class="application">CVS</span> to
	      <span class="application">SVN</span> in May 2012 and July
	        2012, respectively.  Please refer to the <a class="link" href="#synching">Obtaining the Source</a>
		section for more information on obtaining the
		FreeBSD <code class="literal">src/</code> repository and <a class="link" href="#ports-using" title="4.5. Using the Ports Collection">Using the Ports
		Collection</a> for details on obtaining the FreeBSD
	      Ports Collection.</p></dd><dt><span class="term">The committers list<a id="development-committers"></a></span></dt><dd><p>The <em class="firstterm">committers</em>
	      <a id="idp46261752" class="indexterm"></a> are the people who have
	      <span class="emphasis"><em>write</em></span> access to the Subversion
	      tree, and are authorized to make modifications to the
	      FreeBSD source (the term <span class="quote">&#8220;<span class="quote">committer</span>&#8221;</span> comes
	      from <code class="command">commit</code>, the source control
	      command which is used to bring new changes into the
	      repository).  Anyone can submit a bug to the <a class="link" href="https://bugs.FreeBSD.org/submit/" target="_top">Bug
	      Database</a>.  Before submitting a bug report, the
	    FreeBSD mailing lists, IRC channels, or forums can be used to
	    help verify that an issue is actually a bug.</p></dd><dt><span class="term">The FreeBSD core team<a id="development-core"></a></span></dt><dd><p>The <em class="firstterm">FreeBSD core team</em>
	      <a id="idp46285176" class="indexterm"></a> would be equivalent to the board of
	      directors if the FreeBSD Project were a company.  The
	      primary task of the core team is to make sure the
	      project, as a whole, is in good shape and is heading in
	      the right directions.  Inviting dedicated and
	      responsible developers to join our group of committers
	      is one of the functions of the core team, as is the
	      recruitment of new core team members as others move on.
	      The current core team was elected from a pool of
	      committer candidates in June 2020.  Elections are held
	      every 2 years.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Like most developers, most members of the
		core team are also volunteers when
		it comes to FreeBSD development and do not benefit from
		the project financially, so <span class="quote">&#8220;<span class="quote">commitment</span>&#8221;</span>
		should also not be misconstrued as meaning
		<span class="quote">&#8220;<span class="quote">guaranteed support.</span>&#8221;</span>  The
		<span class="quote">&#8220;<span class="quote">board of directors</span>&#8221;</span> analogy above is not
		very accurate, and it may be more suitable to say that
		these are the people who gave up their lives in favor
		of FreeBSD against their better judgement!</p></div></dd><dt><span class="term">Outside contributors</span></dt><dd><p>Last, but definitely not least, the largest group of
	      developers are the users themselves who provide feedback
	      and bug fixes to us on an almost constant basis.  The
	      primary way of keeping in touch with FreeBSD's more
	      non-centralized development is to subscribe to the
	      <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers" target="_top">FreeBSD technical discussions mailing list</a> where such things are discussed.  See
	      <a class="xref" href="#eresources" title="Appendix C. Resources on the Internet">Appendix C, <em>Resources on the Internet</em></a> for more information about
	      the various FreeBSD mailing lists.</p><p><em class="citetitle"><a class="link" href="../../../../doc/en_US.ISO8859-1/articles/contributors/article.html" target="_top">The
		  FreeBSD Contributors List</a></em>
	      <a id="idp46300280" class="indexterm"></a> is a long and growing one, so why not join
	      it by contributing something back to FreeBSD today?</p><p>Providing code is not the only way of contributing
	      to the project; for a more complete list of things that
	      need doing, please refer to the <a class="link" href="../../../../index.html" target="_top">FreeBSD Project
		web site</a>.</p></dd></dl></div><p>In summary, our development model is organized as a loose
	set of concentric circles.  The centralized model is designed
	for the convenience of the <span class="emphasis"><em>users</em></span> of FreeBSD,
	who are provided with an easy way of tracking one central code
	base, not to keep potential contributors out! Our desire is to
	present a stable operating system with a large set of coherent
	<a class="link" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">application programs</a> that the
	users can easily install and use &#8212; this model works very
	well in accomplishing that.</p><p>All we ask of those who would join us as FreeBSD developers
	is some of the same dedication its current people have to its
	continued success!</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="third-party-programs"></a>1.3.4. Third Party Programs</h3></div></div></div><p>In addition to the base distributions, FreeBSD offers a
	ported software collection with thousands of commonly
	sought-after programs.  At the time of this writing, there
	were over 24,000 ports!  The list of ports ranges from
	http servers, to games, languages, editors, and almost
	everything in between.  The entire Ports Collection requires
	approximately 500 MB.  To compile a port, you simply
	change to the directory of the program you wish to install,
	type <code class="command">make install</code>, and let the system do
	the rest.  The full original distribution for each port you
	build is retrieved dynamically so you need only enough disk
	space to build the ports you want.  Almost every port is also
	provided as a pre-compiled <span class="quote">&#8220;<span class="quote">package</span>&#8221;</span>, which can
	be installed with a simple command
	(<code class="command">pkg install</code>) by those who do not wish to
	compile their own ports from source.  More information on
	packages and ports can be found in
	<a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp46316024"></a>1.3.5. Additional Documentation</h3></div></div></div><p>All supported FreeBSD versions provide an option in the
	installer to
	install additional documentation under
	<code class="filename">/usr/local/share/doc/freebsd</code> during the
	initial system setup.  Documentation may also be installed at
	any later time using packages as described in
	<a class="xref" href="#doc-ports-install-package" title="23.3.2. Updating Documentation from Ports">Section 23.3.2, &#8220;Updating Documentation from Ports&#8221;</a>.  You may view the
	locally installed manuals with any HTML capable browser using
	the following URLs:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">The FreeBSD Handbook</span></dt><dd><p><a class="link" href="file://localhost/usr/local/share/doc/freebsd/handbook/index.html" target="_top"><code class="filename">/usr/local/share/doc/freebsd/handbook/index.html</code></a></p></dd><dt><span class="term">The FreeBSD FAQ</span></dt><dd><p><a class="link" href="file://localhost/usr/local/share/doc/freebsd/faq/index.html" target="_top"><code class="filename">/usr/local/share/doc/freebsd/faq/index.html</code></a></p></dd></dl></div><p>You can also view the master (and most frequently updated)
	copies at <code class="uri"><a class="uri" href="https://www.FreeBSD.org/" target="_top">https://www.FreeBSD.org/</a></code>.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall"></a>Chapter 2. Installing FreeBSD</h2></div><div><span class="authorgroup">Restructured, reorganized, and parts rewritten
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jim</span> <span class="surname">Mock</span></span>. </span></div><div><span class="authorgroup">Updated for bsdinstall by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Gavin</span> <span class="surname">Atkinson</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div><div><span class="authorgroup">Updated for root-on-ZFS by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#bsdinstall-synopsis">2.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-hardware">2.2. Minimum Hardware Requirements</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-pre">2.3. Pre-Installation Tasks</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-start">2.4. Starting the Installation</a></span></dt><dt><span class="sect1"><a href="#using-bsdinstall">2.5. Using <span class="application">bsdinstall</span></a></span></dt><dt><span class="sect1"><a href="#bsdinstall-partitioning">2.6. Allocating Disk Space</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-fetching-distribution">2.7. Fetching Distribution Files</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-post">2.8. Accounts, Time Zone, Services and Hardening</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-network">2.9. Network Interfaces</a></span></dt><dt><span class="sect1"><a href="#bsdinstall-install-trouble">2.10. Troubleshooting</a></span></dt><dt><span class="sect1"><a href="#using-live-cd">2.11. Using the Live <acronym class="acronym">CD</acronym></a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-synopsis"></a>2.1. Synopsis</h2></div></div></div><a id="idp46388344" class="indexterm"></a><p>There are several different ways of getting FreeBSD to run,
      depending on the environment.  Those are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Virtual Machine images, to download and import on a
	  virtual environment of choice.  These can be downloaded from
	  the <a class="link" href="https://www.freebsd.org/where.html" target="_top">Download
	    FreeBSD</a> page.  There are images for KVM
	  (<span class="quote">&#8220;<span class="quote">qcow2</span>&#8221;</span>), VMWare (<span class="quote">&#8220;<span class="quote">vmdk</span>&#8221;</span>),
	  Hyper-V (<span class="quote">&#8220;<span class="quote">vhd</span>&#8221;</span>), and raw device images that are
	  universally supported.  These are not installation images,
	  but rather the preconfigured (<span class="quote">&#8220;<span class="quote">already
	    installed</span>&#8221;</span>) instances, ready to run and perform
	  post-installation tasks.</p></li><li class="listitem"><p>Virtual Machine images available at Amazon's <a class="link" href="https://aws.amazon.com/marketplace/pp/B07L6QV354" target="_top">AWS
	    Marketplace</a>, <a class="link" href="https://azuremarketplace.microsoft.com/en-us/marketplace/apps?search=freebsd&amp;page=1" target="_top">Microsoft
	    Azure Marketplace</a>, and <a class="link" href="https://console.cloud.google.com/marketplace/details/freebsd-cloud/freebsd-12" target="_top">Google
	    Cloud Platform</a>, to run on their respective hosting
	  services.  For more information on deploying FreeBSD on Azure
	  please consult the relevant chapter in the <a class="link" href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/freebsd-intro-on-azure" target="_top">Azure
	    Documentation</a>.</p></li><li class="listitem"><p>SD card images, for embedded systems such as Raspberry
	  Pi or BeagleBone Black.  These can be downloaded from the
	  <a class="link" href="https://www.freebsd.org/where.html" target="_top">Download
	    FreeBSD</a> page.  These files must be uncompressed and
	  written as a raw image to an SD card, from which the board
	  will then boot.</p></li><li class="listitem"><p>Installation images, to install FreeBSD on
	  a hard drive for the usual desktop, laptop, or server
	  systems.</p></li></ul></div><p>The rest of this chapter describes the fourth case,
      explaining how to install FreeBSD using the text-based
      installation program named
      <span class="application">bsdinstall</span>.</p><p>In general, the installation instructions in this chapter
      are written for the <span class="trademark">i386</span>&#8482; and <acronym class="acronym">AMD64</acronym>
      architectures.  Where applicable, instructions specific to other
      platforms will be listed.  There may be minor differences
      between the installer and what is shown here, so use this
      chapter as a general guide rather than as a set of literal
      instructions.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Users who prefer to install FreeBSD using a graphical
      installer may be interested in
      <a class="link" href="https://www.furybsd.org" target="_top">FuryBSD</a>,
      <a class="link" href="https://ghostbsd.org" target="_top">GhostBSD</a> or
      <a class="link" href="https://www.midnightbsd.org" target="_top">MidnightBSD</a>.</p></div><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The minimum hardware requirements and FreeBSD supported
	  architectures.</p></li><li class="listitem"><p>How to create the FreeBSD installation media.</p></li><li class="listitem"><p>How to start
	  <span class="application">bsdinstall</span>.</p></li><li class="listitem"><p>The questions <span class="application">bsdinstall</span> will
	  ask, what they mean, and how to answer them.</p></li><li class="listitem"><p>How to troubleshoot a failed installation.</p></li><li class="listitem"><p>How to access a live version of FreeBSD before committing
	  to an installation.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Read the supported hardware list that shipped with the
	  version of FreeBSD to be installed and verify that the system's
	  hardware is supported.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-hardware"></a>2.2. Minimum Hardware Requirements</h2></div></div></div><p>The hardware requirements to install FreeBSD vary by
      architecture.  Hardware architectures and devices supported by a
      FreeBSD release are listed on the <a class="link" href="../../../../releases/index.html" target="_top">FreeBSD Release
      Information</a> page.  The <a class="link" href="../../../../where.html" target="_top">FreeBSD download page</a>
      also has recommendations for choosing the correct image for
      different architectures.</p><p>A FreeBSD installation requires a minimum of 96 MB of
      <acronym class="acronym">RAM</acronym> and 1.5 GB of free hard drive space.
      However, such small amounts of memory and disk space are really
      only suitable for custom applications like embedded appliances.
      General-purpose desktop systems need more resources.
      2-4 GB RAM and at least 8 GB hard drive space is a
      good starting point.</p><p>These are the processor requirements for each
      architecture:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">amd64</span></dt><dd><p>This is the most common desktop and laptop processor
	    type, used in most modern systems.  <span class="trademark">Intel</span>® calls it
	    <acronym class="acronym">Intel64</acronym>.  Other manufacturers sometimes
	    call it <acronym class="acronym">x86-64</acronym>.</p><p>Examples of amd64 compatible processors
	    include: <span class="trademark">AMD Athlon</span>&#8482;64, <span class="trademark">AMD Opteron</span>&#8482;,
	    multi-core <span class="trademark">Intel</span>® <span class="trademark">Xeon</span>&#8482;, and
	    <span class="trademark">Intel</span>® <span class="trademark">Core</span>&#8482; 2 and later processors.</p></dd><dt><span class="term">i386</span></dt><dd><p>Older desktops and laptops often use this 32-bit, x86
	    architecture.</p><p>Almost all i386-compatible processors with a floating
	    point unit are supported.  All <span class="trademark">Intel</span>® processors 486 or
	    higher are supported.</p><p>FreeBSD will take advantage of Physical Address
	    Extensions (<acronym class="acronym">PAE</acronym>) support on
	    <acronym class="acronym">CPU</acronym>s with this feature.  A kernel with
	    the <acronym class="acronym">PAE</acronym> feature enabled will detect
	    memory above 4 GB and allow it to be used by the
	    system.  However, using <acronym class="acronym">PAE</acronym> places
	    constraints on device drivers and other features of
	    FreeBSD.</p></dd><dt><span class="term">powerpc</span></dt><dd><p>All New World <acronym class="acronym">ROM</acronym> <span class="trademark">Apple</span>®
	    <span class="trademark">Mac</span>® systems with built-in <acronym class="acronym">USB</acronym>
	    are supported.  <acronym class="acronym">SMP</acronym> is supported on
	    machines with multiple <acronym class="acronym">CPU</acronym>s.</p><p>A 32-bit kernel can only use the first 2 GB of
	    <acronym class="acronym">RAM</acronym>.</p></dd><dt><span class="term">sparc64</span></dt><dd><p>Systems supported by FreeBSD/sparc64 are listed at
	    the <a class="link" href="../../../../platforms/sparc.html" target="_top">FreeBSD/sparc64
	      Project</a>.</p><p><acronym class="acronym">SMP</acronym> is supported on all systems
	    with more than 1 processor.  A dedicated disk is required
	    as it is not possible to share a disk with another
	    operating system at this time.</p></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-pre"></a>2.3. Pre-Installation Tasks</h2></div></div></div><p>Once it has been determined that the system meets the
      minimum hardware requirements for installing FreeBSD, the
      installation file should be downloaded and the installation
      media prepared.  Before doing this, check that the system is
      ready for an installation by verifying the items in this
      checklist:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Back Up Important Data</strong></p><p>Before installing any operating system,
	  <span class="emphasis"><em>always</em></span> backup all important data first.
	  Do not store the backup on the system being installed.
	  Instead, save the data to a removable disk such as a
	  <acronym class="acronym">USB</acronym> drive, another system on the network,
	  or an online backup service.  Test the backup before
	  starting the installation to make sure it contains all of
	  the needed files.  Once the installer formats the system's
	  disk, all data stored on that disk will be lost.</p></li><li class="step"><p class="title"><strong>Decide Where to Install FreeBSD</strong></p><p>If FreeBSD will be the only operating system installed,
	  this step can be skipped.  But if FreeBSD will share the disk
	  with another operating system, decide which disk or
	  partition will be used for FreeBSD.</p><p>In the i386 and amd64 architectures, disks
	  can be divided into multiple partitions using one of two
	  partitioning schemes.  A traditional <em class="firstterm">Master Boot
	    Record</em> (<acronym class="acronym">MBR</acronym>) holds a
	  partition table defining up to four <em class="firstterm">primary
	    partitions</em>.  For historical reasons, FreeBSD
	  calls these primary partition
	  <em class="firstterm">slices</em>.  One of these primary
	  partitions can be made into an <em class="firstterm">extended
	    partition</em> containing multiple
	  <em class="firstterm">logical partitions</em>.  The
	  <em class="firstterm">GUID Partition Table</em>
	  (<acronym class="acronym">GPT</acronym>) is a newer and simpler method of
	  partitioning a disk.  Common <acronym class="acronym">GPT</acronym>
	  implementations allow up to 128 partitions per disk,
	  eliminating the need for logical partitions.</p><p>The FreeBSD boot loader requires either a primary or
	  <acronym class="acronym">GPT</acronym> partition.  If all of the primary or
	  <acronym class="acronym">GPT</acronym> partitions are already in use, one
	  must be freed for FreeBSD.  To create a partition without
	  deleting existing data, use a partition resizing tool to
	  shrink an existing partition and create a new partition
	  using the freed space.</p><p>A variety of free and commercial partition resizing
	  tools are listed at <a class="link" href="http://en.wikipedia.org/wiki/List_of_disk_partitioning_software" target="_top">http://en.wikipedia.org/wiki/List_of_disk_partitioning_software</a>.
	  <span class="application">GParted Live</span> (<a class="link" href="http://gparted.sourceforge.net/livecd.php" target="_top">http://gparted.sourceforge.net/livecd.php</a>)
	  is a free live <acronym class="acronym">CD</acronym> which includes the
	  <span class="application">GParted</span> partition editor.
	  <span class="application">GParted</span> is also included with
	  many other Linux live <acronym class="acronym">CD</acronym>
	  distributions.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">When used properly, disk shrinking utilities can
	    safely create space for creating a new partition.  Since
	    the possibility of selecting the wrong partition exists,
	    always backup any important data and verify the integrity
	    of the backup before modifying disk partitions.</p></div><p>Disk partitions containing different operating systems
	  make it possible to install multiple operating systems on
	  one computer.  An alternative is to use virtualization
	  (<a class="xref" href="#virtualization" title="Chapter 21. Virtualization">Chapter 21, <em>Virtualization</em></a>) which allows multiple
	  operating systems to run at the same time without modifying
	  any disk partitions.</p></li><li class="step"><p class="title"><strong>Collect Network Information</strong></p><p>Some FreeBSD installation methods require a network
	  connection in order to download the installation files.
	  After any installation, the installer will offer to setup
	  the system's network interfaces.</p><p>If the network has a <acronym class="acronym">DHCP</acronym> server, it
	  can be used to provide automatic network configuration.  If
	  <acronym class="acronym">DHCP</acronym> is not available, the following
	  network information for the system must be obtained from the
	  local network administrator or Internet service
	  provider:</p><div class="orderedlist"><a id="bsdinstall-collect-network-information"></a><div class="orderedlist-title">Required Network Information</div><ol class="orderedlist" type="1"><li class="listitem"><p><acronym class="acronym">IP</acronym> address</p></li><li class="listitem"><p>Subnet mask</p></li><li class="listitem"><p><acronym class="acronym">IP</acronym> address of default
	      gateway</p></li><li class="listitem"><p>Domain name of the network</p></li><li class="listitem"><p><acronym class="acronym">IP</acronym> addresses of the network's
	      <acronym class="acronym">DNS</acronym> servers</p></li></ol></div></li><li class="step"><p class="title"><strong>Check for FreeBSD Errata</strong></p><p>Although the FreeBSD Project strives to ensure that
	  each release of FreeBSD is as stable as possible, bugs
	  occasionally creep into the process.  On very rare occasions
	  those bugs affect the installation process.  As these
	  problems are discovered and fixed, they are noted in the
	  FreeBSD Errata (<a class="link" href="../../../../releases/12.1R/errata.html" target="_top">https://www.freebsd.org/releases/12.1R/errata.html</a>)
	  on the FreeBSD web site.  Check the errata before installing to
	  make sure that there are no problems that might affect the
	  installation.</p><p>Information and errata for all the releases can be found
	  on the release information section of the FreeBSD web site
	  (<a class="link" href="../../../../releases/index.html" target="_top">https://www.freebsd.org/releases/index.html</a>).</p></li></ol></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-installation-media"></a>2.3.1. Prepare the Installation Media</h3></div></div></div><p>The FreeBSD installer is not an application that can be run
	from within another operating system.  Instead, download a
	FreeBSD installation file, burn it to the media associated with
	its file type and size (<acronym class="acronym">CD</acronym>,
	<acronym class="acronym">DVD</acronym>, or <acronym class="acronym">USB</acronym>), and boot
	the system to install from the inserted media.</p><p>FreeBSD installation files are available at <a class="link" href="../../../../where.html#download" target="_top">www.freebsd.org/where.html#download</a>.
	Each installation file's name includes the release version of
	FreeBSD, the architecture, and the type of file.  For example, to
	install FreeBSD 12.1 on an amd64 system from a
	<acronym class="acronym">DVD</acronym>, download
	<code class="filename">FreeBSD-12.1-RELEASE-amd64-dvd1.iso</code>, burn
	this file to a <acronym class="acronym">DVD</acronym>, and boot the system
	with the <acronym class="acronym">DVD</acronym> inserted.</p><p>Installation files are available in several formats.
	The formats vary depending on computer architecture and media
	type.</p><p><a id="bsdinstall-installation-media-uefi"></a>Additional
	installation files are included for computers that boot with
	<acronym class="acronym">UEFI</acronym> (Unified Extensible Firmware
	Interface).  The names of these files include the string
	<code class="filename">uefi</code>.</p><p>File types:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">-bootonly.iso</code>: This is the smallest
	    installation file as it only contains the installer.  A
	    working Internet connection is required during
	    installation as the installer will download the files it
	    needs to complete the FreeBSD installation.  This file should
	    be burned to a <acronym class="acronym">CD</acronym> using a
	    <acronym class="acronym">CD</acronym> burning application.</p></li><li class="listitem"><p><code class="literal">-disc1.iso</code>: This file contains all
	    of the files needed to install FreeBSD, its source, and the
	    Ports Collection.  It should be burned to a
	    <acronym class="acronym">CD</acronym> using a <acronym class="acronym">CD</acronym>
	    burning application.</p></li><li class="listitem"><p><code class="literal">-dvd1.iso</code>: This file contains all
	    of the files needed to install FreeBSD, its source, and the
	    Ports Collection.  It also contains a set of popular
	    binary packages for installing a window manager and some
	    applications so that a complete system can be installed
	    from media without requiring a connection to the Internet.
	    This file should be burned to a <acronym class="acronym">DVD</acronym>
	    using a <acronym class="acronym">DVD</acronym> burning application.</p></li><li class="listitem"><p><code class="literal">-memstick.img</code>: This file contains
	    all of the files needed to install FreeBSD, its source, and
	    the Ports Collection.  It should be burned to a
	    <acronym class="acronym">USB</acronym> stick using the instructions
	    below.</p></li><li class="listitem"><p><code class="literal">-mini-memstick.img</code>: Like
	    <code class="literal">-bootonly.iso</code>, does not include
	    installation files, but downloads them as needed.  A
	    working internet connection is required during
	    installation.  Write this file to a <acronym class="acronym">USB</acronym>
	    stick as shown in <a class="xref" href="#bsdinstall-usb" title="2.3.1.1. Writing an Image File to USB">Section 2.3.1.1, &#8220;Writing an Image File to <acronym class="acronym">USB</acronym>&#8221;</a>.</p></li></ul></div><p>After downloading the image file, download
	<code class="filename">CHECKSUM.SHA256</code> from
	the same directory.  Calculate a
	<em class="firstterm">checksum</em> for the image file.
	FreeBSD provides <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sha256&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sha256</span>(1)</span></a> for this, used as <code class="command">sha256
	  <em class="replaceable"><code>imagefilename</code></em></code>.
	Other operating systems have similar programs.</p><p>Compare the calculated checksum with the one shown in
	<code class="filename">CHECKSUM.SHA256</code>.  The checksums must
	match exactly.  If the checksums do not match, the image file
	is corrupt and must be downloaded again.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-usb"></a>2.3.1.1. Writing an Image File to <acronym class="acronym">USB</acronym></h4></div></div></div><p>The <code class="filename">*.img</code> file is an
	  <span class="emphasis"><em>image</em></span> of the complete contents of a
	  memory stick.  It <span class="emphasis"><em>cannot</em></span> be copied to
	  the target device as a file.  Several applications are
	  available for writing the <code class="filename">*.img</code> to a
	  <acronym class="acronym">USB</acronym> stick.  This section describes two of
	  these utilities.</p><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">Before proceeding, back up any important data on the
	    <acronym class="acronym">USB</acronym> stick.  This procedure will erase
	    the existing data on the stick.</p></div><div class="procedure"><a id="bsdinstall-usb-dd"></a><div class="procedure-title">Procedure 2.1. Using <code class="command">dd</code> to Write the
	    Image</div><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">This example uses <code class="filename">/dev/da0</code> as
	      the target device where the image will be written.  Be
	      <span class="emphasis"><em>very careful</em></span> that the correct
	      device is used as this command will destroy the existing
	      data on the specified target device.</p></div><ul class="procedure"><li class="step"><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dd</span>(1)</span></a> command-line utility is
	      available on BSD, <span class="trademark">Linux</span>®, and <span class="trademark">Mac OS</span>® systems.  To burn
	      the image using <code class="command">dd</code>, insert the
	      <acronym class="acronym">USB</acronym> stick and determine its device
	      name.  Then, specify the name of the downloaded
	      installation file and the device name for the
	      <acronym class="acronym">USB</acronym> stick.  This example burns the
	      amd64 installation image to the first
	      <acronym class="acronym">USB</acronym> device on an existing FreeBSD
	      system.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=<em class="replaceable"><code>FreeBSD-12.1-RELEASE-amd64-memstick.img</code></em> of=/dev/<em class="replaceable"><code>da0</code></em> bs=1M conv=sync</code></strong></pre><p>If this command fails, verify that the
	      <acronym class="acronym">USB</acronym> stick is not mounted and that the
	      device name is for the disk, not a partition.  Some
	      operating systems might require this command to be run
	      with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sudo&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sudo</span>(8)</span></a>.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dd</span>(1)</span></a> syntax varies slightly
	      across different platforms; for example, <span class="trademark">Mac OS</span>® requires
	      a lower-case <code class="option">bs=1m</code>.
	      Systems like <span class="trademark">Linux</span>® might buffer
	      writes.  To force all writes to complete, use
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sync&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sync</span>(8)</span></a>.</p></li></ul></div><div class="procedure"><a id="idp49154936"></a><div class="procedure-title">Procedure 2.2. Using <span class="trademark">Windows</span>® to Write the Image</div><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Be sure to give the correct drive letter as the
	      existing data on the specified drive will be overwritten
	      and destroyed.</p></div><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Obtaining <span class="application">Image Writer for
		<span class="trademark">Windows</span>®</span></strong></p><p><span class="application">Image Writer for
		<span class="trademark">Windows</span>®</span> is a free application that can
	      correctly write an image file to a memory stick.
	      Download it from <code class="uri"><a class="uri" href="https://sourceforge.net/projects/win32diskimager/" target="_top">https://sourceforge.net/projects/win32diskimager/</a></code>
	      and extract it into a folder.</p></li><li class="step"><p class="title"><strong>Writing the Image with Image Writer</strong></p><p>Double-click the
	      <span class="application">Win32DiskImager</span> icon to start
	      the program.  Verify that the drive letter shown under
	      <code class="computeroutput">Device</code> is the drive
	      with the memory stick.  Click the folder icon and select
	      the image to be written to the memory stick.  Click
	      <span class="guibutton">[ Save ]</span> to accept the
	      image file name.  Verify that everything is correct, and
	      that no folders on the memory stick are open in other
	      windows.  When everything is ready, click
	      <span class="guibutton">[ Write ]</span> to write the
	      image file to the memory stick.</p></li></ol></div><p>You are now ready to start installing FreeBSD.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-start"></a>2.4. Starting the Installation</h2></div></div></div><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">By default, the installation will not make any changes to
	the disk(s) before the following message:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">Your changes will now be written to disk. If you
have chosen to overwrite existing data, it will
be PERMANENTLY ERASED. Are you sure you want to
commit your changes?</pre><p xmlns="http://www.w3.org/1999/xhtml">The install can be exited at any time prior to this
	warning.  If
	there is a concern that something is incorrectly configured,
	just turn the computer off before this point and no changes
	will be made to the system's disks.</p></div><p>This section describes how to boot the system from the
      installation media which was prepared using the instructions in
      <a class="xref" href="#bsdinstall-installation-media" title="2.3.1. Prepare the Installation Media">Section 2.3.1, &#8220;Prepare the Installation Media&#8221;</a>.  When using a
      bootable USB stick, plug in the <acronym class="acronym">USB</acronym> stick
      before turning on the computer.  When booting from
      <acronym class="acronym">CD</acronym> or <acronym class="acronym">DVD</acronym>, turn on the
      computer and insert the media at the first opportunity.  How to
      configure the system to boot from the inserted media depends
      upon the architecture.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-starting-i386"></a>2.4.1. Booting on <span class="trademark">i386</span>&#8482; and amd64</h3></div></div></div><p>These architectures provide a <acronym class="acronym">BIOS</acronym>
	menu for selecting the boot device.  Depending upon the
	installation media being used, select the
	<acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> or
	<acronym class="acronym">USB</acronym> device as the first boot device.  Most
	systems also provide a key for selecting the boot device
	during startup without having to enter the
	<acronym class="acronym">BIOS</acronym>.  Typically, the key is either
	<span class="keycap"><strong>F10</strong></span>, <span class="keycap"><strong>F11</strong></span>,
	<span class="keycap"><strong>F12</strong></span>, or <span class="keycap"><strong>Escape</strong></span>.</p><p>If the computer loads the existing operating system
	instead of the FreeBSD installer, then either:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The installation media was not inserted early enough
	    in the boot process.  Leave the media inserted and try
	    restarting the computer.</p></li><li class="listitem"><p>The <acronym class="acronym">BIOS</acronym> changes were incorrect or
	    not saved.  Double-check that the right boot device is
	    selected as the first boot device.</p></li><li class="listitem"><p>This system is too old to support booting from the
	    chosen media.  In this case, the <span class="application">Plop Boot
	      Manager</span> (<a class="link" href="http://www.plop.at/en/bootmanagers.html" target="_top">http://www.plop.at/en/bootmanagers.html</a>)
	    can be used to boot the system from the selected
	    media.</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp49193592"></a>2.4.2. Booting on <span class="trademark">PowerPC</span>®</h3></div></div></div><p>On most machines, holding <span class="keycap"><strong>C</strong></span> on the
	keyboard during boot will boot from the <acronym class="acronym">CD</acronym>.
	Otherwise, hold <span class="keycap"><strong>Command</strong></span>+<span class="keycap"><strong>Option</strong></span>+<span class="keycap"><strong>O</strong></span>+<span class="keycap"><strong>F</strong></span>, or
	<span class="keycap"><strong>Windows</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>O</strong></span>+<span class="keycap"><strong>F</strong></span> on non-<span class="trademark">Apple</span>® keyboards.  At the
	<code class="prompt">0 &gt;</code> prompt, enter</p><pre class="screen"><strong class="userinput"><code>boot cd:,\ppc\loader cd:0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-view-probe"></a>2.4.3. FreeBSD Boot Menu</h3></div></div></div><p>Once the system boots from the installation media, a menu
	similar to the following will be displayed:</p><div class="figure"><a id="bsdinstall-newboot-loader-menu"></a><div class="figure-title">Figure 2.1. FreeBSD Boot Loader Menu</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-newboot-loader-menu.png" alt="FreeBSD Boot Loader Menu" /></div></div></div><br class="figure-break" /><p>By default, the menu will wait ten seconds for user input
	before booting into the FreeBSD installer or, if FreeBSD is already
	installed, before booting into FreeBSD.  To pause the boot timer
	in order to review the selections, press
	<span class="keycap"><strong>Space</strong></span>.  To select an option, press its
	highlighted number, character, or key.  The following options
	are available.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">Boot Multi User</code>: This will
	    continue the FreeBSD boot process.  If the boot timer has
	    been paused, press <span class="keycap"><strong>1</strong></span>, upper- or
	    lower-case <span class="keycap"><strong>B</strong></span>, or
	    <span class="keycap"><strong>Enter</strong></span>.</p></li><li class="listitem"><p><code class="literal">Boot Single User</code>: This mode can be
	    used to fix an existing FreeBSD installation as described in
	    <a class="xref" href="#boot-singleuser" title="12.2.4.1. Single-User Mode">Section 12.2.4.1, &#8220;Single-User Mode&#8221;</a>.  Press
	    <span class="keycap"><strong>2</strong></span> or the upper- or lower-case
	    <span class="keycap"><strong>S</strong></span> to enter this mode.</p></li><li class="listitem"><p><code class="literal">Escape to loader prompt</code>: This will
	    boot the system into a repair prompt that contains a
	    limited number of low-level commands.  This prompt is
	    described in <a class="xref" href="#boot-loader" title="12.2.3. Stage Three">Section 12.2.3, &#8220;Stage Three&#8221;</a>.  Press
	    <span class="keycap"><strong>3</strong></span> or <span class="keycap"><strong>Esc</strong></span> to boot into
	    this prompt.</p></li><li class="listitem"><p><code class="literal">Reboot</code>: Reboots the system.</p></li><li class="listitem"><p><code class="literal">Kernel</code>: Loads a different
            kernel.</p></li><li class="listitem"><p><code class="literal">Configure Boot Options</code>: Opens the
	    menu shown in, and described under, <a class="xref" href="#bsdinstall-boot-options-menu" title="Figure 2.2. FreeBSD Boot Options Menu">Figure 2.2, &#8220;FreeBSD Boot Options Menu&#8221;</a>.</p></li></ul></div><div class="figure"><a id="bsdinstall-boot-options-menu"></a><div class="figure-title">Figure 2.2. FreeBSD Boot Options Menu</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-boot-options-menu.png" alt="FreeBSD Boot Options Menu" /></div></div></div><br class="figure-break" /><p>The boot options menu is divided into two sections.  The
	first section can be used to either return to the main boot
	menu or to reset any toggled options back to their
	defaults.</p><p>The next section is used to toggle the available options
	to <code class="literal">On</code> or <code class="literal">Off</code> by pressing
	the option's highlighted number or character.  The system will
	always boot using the settings for these options until they
	are modified.  Several options can be toggled using this
	menu:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">ACPI Support</code>: If the system hangs
	    during boot, try toggling this option to
	    <code class="literal">Off</code>.</p></li><li class="listitem"><p><code class="literal">Safe Mode</code>: If the system still
	    hangs during boot even with <code class="literal">ACPI
	      Support</code> set to <code class="literal">Off</code>, try
	    setting this option to <code class="literal">On</code>.</p></li><li class="listitem"><p><code class="literal">Single User</code>: Toggle this option to
	    <code class="literal">On</code> to fix an existing FreeBSD installation
	    as described in <a class="xref" href="#boot-singleuser" title="12.2.4.1. Single-User Mode">Section 12.2.4.1, &#8220;Single-User Mode&#8221;</a>.  Once
	    the problem is fixed, set it back to
	    <code class="literal">Off</code>.</p></li><li class="listitem"><p><code class="literal">Verbose</code>: Toggle this option to
	    <code class="literal">On</code> to see more detailed messages during
	    the boot process.  This can be useful when troubleshooting
	    a piece of hardware.</p></li></ul></div><p>After making the needed selections, press
	<span class="keycap"><strong>1</strong></span> or <span class="keycap"><strong>Backspace</strong></span> to return to
	the main boot menu, then press <span class="keycap"><strong>Enter</strong></span> to
	continue booting into FreeBSD.  A series of boot messages will
	appear as FreeBSD carries out its hardware device probes and
	loads the installation program.  Once the boot is complete,
	the welcome menu shown in <a class="xref" href="#bsdinstall-choose-mode" title="Figure 2.3. Welcome Menu">Figure 2.3, &#8220;Welcome Menu&#8221;</a> will be displayed.</p><div class="figure"><a id="bsdinstall-choose-mode"></a><div class="figure-title">Figure 2.3. Welcome Menu</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-choose-mode.png" alt="Welcome Menu" /></div></div></div><br class="figure-break" /><p>Press <span class="keycap"><strong>Enter</strong></span> to select the default of
	<span class="guibutton">[ Install ]</span> to enter the
	installer.  The rest of this chapter describes how to use this
	installer.  Otherwise, use the right or left arrows or the
	colorized letter to select the desired menu item.  The
	<span class="guibutton">[ Shell ]</span> can be used to
	access a FreeBSD shell in order to use command line utilities to
	prepare the disks before installation.  The
	<span class="guibutton">[ Live CD ]</span> option can be
	used to try out FreeBSD before installing it.  The live version
	is described in <a class="xref" href="#using-live-cd" title="2.11. Using the Live CD">Section 2.11, &#8220;Using the Live <acronym class="acronym">CD</acronym>&#8221;</a>.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">To review the boot messages, including the hardware
	  device probe, press the upper- or lower-case
	  <span class="keycap"><strong>S</strong></span> and then <span class="keycap"><strong>Enter</strong></span> to access
	  a shell.  At the shell prompt, type <code class="command">more
	    /var/run/dmesg.boot</code> and use the space bar to
	  scroll through the messages.  When finished, type
	  <code class="command">exit</code> to return to the welcome
	  menu.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-bsdinstall"></a>2.5. Using <span class="application">bsdinstall</span></h2></div></div></div><p>This section shows the order of the
      <span class="application">bsdinstall</span> menus and the type of
      information that will be asked before the system is installed.
      Use the arrow keys to highlight a menu option, then
      <span class="keycap"><strong>Space</strong></span> to select or deselect that menu item.
      When finished, press <span class="keycap"><strong>Enter</strong></span> to save the
      selection and move onto the next screen.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-keymap"></a>2.5.1. Selecting the Keymap Menu</h3></div></div></div><p>Before starting the process,
	<span class="application">bsdinstall</span> will load the keymap
	files as show in <a class="xref" href="#bsdinstall-keymap-loading" title="Figure 2.4. Keymap Loading">Figure 2.4, &#8220;Keymap Loading&#8221;</a>.</p><div class="figure"><a id="bsdinstall-keymap-loading"></a><div class="figure-title">Figure 2.4. Keymap Loading</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-keymap-loading.png" alt="Keymap Loading" /></div></div></div><br class="figure-break" /><p>After the keymaps have been loaded
	<span class="application">bsdinstall</span> displays the
	menu shown in <a class="xref" href="#bsdinstall-keymap-10" title="Figure 2.5. Keymap Selection Menu">Figure 2.5, &#8220;Keymap Selection Menu&#8221;</a>.  Use the
	up and down arrows to select the keymap that most closely
	represents the mapping of the keyboard attached to the system.
	Press <span class="keycap"><strong>Enter</strong></span> to save the selection.</p><div class="figure"><a id="bsdinstall-keymap-10"></a><div class="figure-title">Figure 2.5. Keymap Selection Menu</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-keymap-10.png" alt="Keymap Selection Menu" /></div></div></div><br class="figure-break" /><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Pressing <span class="keycap"><strong>Esc</strong></span> will exit this menu
	and use the default keymap.  If the choice of keymap is not
	clear, <span class="guimenuitem">United States of America
	ISO-8859-1</span> is also a safe option.</p></div><p>In addition, when selecting a different keymap, the user
	can try the keymap and ensure it is correct before proceeding
	as shown in <a class="xref" href="#bsdinstall-keymap-testing" title="Figure 2.6. Keymap Testing Menu">Figure 2.6, &#8220;Keymap Testing Menu&#8221;</a>.</p><div class="figure"><a id="bsdinstall-keymap-testing"></a><div class="figure-title">Figure 2.6. Keymap Testing Menu</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-keymap-testing.png" alt="Keymap Testing Menu" /></div></div></div><br class="figure-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-hostname"></a>2.5.2. Setting the Hostname</h3></div></div></div><p>The next <span class="application">bsdinstall</span> menu is
	used to set the hostname for the newly installed
	system.</p><div class="figure"><a id="bsdinstall-config-hostname"></a><div class="figure-title">Figure 2.7. Setting the Hostname</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-config-hostname.png" alt="Setting the Hostname" /></div></div></div><br class="figure-break" /><p>Type in a hostname that is unique for the network.  It
	should be a fully-qualified hostname, such as <code class="systemitem">machine3.example.com</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-components"></a>2.5.3. Selecting Components to Install</h3></div></div></div><p>Next, <span class="application">bsdinstall</span> will prompt to
	select optional components to install.</p><div class="figure"><a id="bsdinstall-config-components"></a><div class="figure-title">Figure 2.8. Selecting Components to Install</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-config-components.png" alt="Selecting Components to Install" /></div></div></div><br class="figure-break" /><p>Deciding which components to install will depend largely
	on the intended use of the system and the amount of disk space
	available.  The FreeBSD kernel and userland, collectively known
	as the <em class="firstterm">base system</em>, are always
	installed.  Depending on the architecture, some of these
	components may not appear:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">base-dbg</code> - Base tools like
	    <span class="application">cat</span>,
	    <span class="application">ls</span> among many others with
	    debug symbols activated.</p></li><li class="listitem"><p><code class="literal">kernel-dbg</code> - Kernel and modules with
	    debug symbols activated.</p></li><li class="listitem"><p><code class="literal">lib32-dbg</code> - Compatibility libraries
	    for running 32-bit applications on a 64-bit version of
	    FreeBSD with debug symbols activated.</p></li><li class="listitem"><p><code class="literal">lib32</code> - Compatibility libraries for
	    running 32-bit applications on a 64-bit version of
	    FreeBSD.</p></li><li class="listitem"><p><code class="literal">ports</code> - The FreeBSD Ports Collection
	    is a collection of files which automates the downloading,
	    compiling and installation of third-party software
	    packages.  <a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a> discusses how to use
	    the Ports Collection.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">The installation program does not check for
	      adequate disk space.  Select this option only if
	      sufficient hard disk space is available.  The FreeBSD Ports
	      Collection takes up about 500 MB of disk
	      space.</p></div></li><li class="listitem"><p><code class="literal">src</code> - The complete FreeBSD source code
	    for both the kernel and the userland.  Although not
	    required for the majority of applications, it may be
	    required to build device drivers, kernel modules, or some
	    applications from the Ports Collection.  It is also used
	    for developing FreeBSD itself.  The full source tree requires
	    1 GB of disk space and recompiling the entire FreeBSD
	    system requires an additional 5 GB of space.</p></li><li class="listitem"><p><code class="literal">tests</code> - FreeBSD Test Suite.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-netinstall"></a>2.5.4. Installing from the Network</h3></div></div></div><p>The menu shown in
	<a class="xref" href="#bsdinstall-netinstall-notify" title="Figure 2.9. Installing from the Network">Figure 2.9, &#8220;Installing from the Network&#8221;</a> only appears
	when installing from a <code class="filename">-bootonly.iso</code> or
	<code class="filename">-mini-memstick.img</code> as this installation
	media does not hold copies of the installation files.
	Since the installation files must be retrieved over a network
	connection, this menu indicates that the network interface must
	be configured first.  If this menu is shown in any step of the
	process remember to follow the instructions in
	<a class="xref" href="#bsdinstall-config-network-dev" title="2.9.1. Configuring Network Interfaces">Section 2.9.1, &#8220;Configuring Network Interfaces&#8221;</a>.</p><div class="figure"><a id="bsdinstall-netinstall-notify"></a><div class="figure-title">Figure 2.9. Installing from the Network</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-netinstall-files.png" alt="Installing from the Network" /></div></div></div><br class="figure-break" /></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-partitioning"></a>2.6. Allocating Disk Space</h2></div></div></div><p>The next menu is used to determine the method for
      allocating disk space.</p><div class="figure"><a id="bsdinstall-zfs-partmenu"></a><div class="figure-title">Figure 2.10. Partitioning Choices</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-partmenu.png" alt="Partitioning Choices" /></div></div></div><br class="figure-break" /><p><span class="application">bsdinstall</span> gives the user four
      methods for allocating disk space:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">Auto (UFS)</code> partitioning
	  automatically sets up the disk partitions using the
	  <code class="literal">UFS</code> file system.</p></li><li class="listitem"><p><code class="literal">Manual</code> partitioning allows
	  advanced users to create customized partitions from menu
	  options.</p></li><li class="listitem"><p><code class="literal">Shell</code> opens a shell prompt where
	  advanced users can create customized partitions using
	  command-line utilities like <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fdisk</span>(8)</span></a>,
	  and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>.</p></li><li class="listitem"><p><code class="literal">Auto (ZFS)</code> partitioning creates a
	  root-on-ZFS system with optional GELI encryption support for
	  <em class="firstterm">boot environments</em>.</p></li></ul></div><p>This section describes what to consider when laying out the
      disk partitions.  It then demonstrates how to use the different
      partitioning methods.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="configtuning-initial"></a>2.6.1. Designing the Partition Layout</h3></div></div></div><a id="idp49368440" class="indexterm"></a><a id="idp49368952" class="indexterm"></a><a id="idp49369848" class="indexterm"></a><a id="idp49370744" class="indexterm"></a><p>When laying out file systems, remember that hard drives
	transfer data faster from the outer tracks to the inner.
	Thus, smaller and heavier-accessed file systems should be
	closer to the outside of the drive, while larger partitions
	like <code class="filename">/usr</code> should be placed toward the
	inner parts of the disk.  It is a good idea to create
	partitions in an order similar to: <code class="filename">/</code>,
	swap, <code class="filename">/var</code>, and
	<code class="filename">/usr</code>.</p><p>The size of the <code class="filename">/var</code> partition
	reflects the intended machine's usage.  This partition is
	used to hold mailboxes, log files, and printer spools.
	Mailboxes and log files can grow to unexpected sizes
	depending on the number of users and how long log files are
	kept.  On average, most users rarely need more than about a
	gigabyte of free disk space in
	<code class="filename">/var</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Sometimes, a lot of disk space is required in
	  <code class="filename">/var/tmp</code>.  When new software is
	  installed, the packaging tools extract a temporary copy of
	  the packages under <code class="filename">/var/tmp</code>.  Large
	  software packages, like <span class="application">Firefox</span>
	  or <span class="application">LibreOffice</span> may be tricky to
	  install if there is not enough disk space under
	  <code class="filename">/var/tmp</code>.</p></div><p>The <code class="filename">/usr</code> partition holds many of the
	files which support the system, including the FreeBSD Ports
	Collection and system source code.  At least 2 gigabytes of
	space is recommended for this partition.</p><p>When selecting partition sizes, keep the space
	requirements in mind.  Running out of space in one partition
	while barely using another can be a hassle.</p><a id="idp49390968" class="indexterm"></a><a id="idp49391736" class="indexterm"></a><p>As a rule of thumb, the swap partition should be about
	double the size of physical memory (<acronym class="acronym">RAM</acronym>).
	Systems with minimal <acronym class="acronym">RAM</acronym> may perform
	better with more swap.  Configuring too little swap can lead
	to inefficiencies in the <acronym class="acronym">VM</acronym> page scanning
	code and might create issues later if more memory is
	added.</p><p>On larger systems with multiple <acronym class="acronym">SCSI</acronym>
	disks or multiple <acronym class="acronym">IDE</acronym> disks operating on
	different controllers, it is recommended that swap be
	configured on each drive, up to four drives.  The swap
	partitions should be approximately the same size.  The
	kernel can handle arbitrary sizes but internal data structures
	scale to 4 times the largest swap partition.  Keeping the swap
	partitions near the same size will allow the kernel to
	optimally stripe swap space across disks.  Large swap sizes
	are fine, even if swap is not used much.  It might be easier
	to recover from a runaway program before being forced to
	reboot.</p><p>By properly partitioning a system, fragmentation
	introduced in the smaller write heavy partitions will not
	bleed over into the mostly read partitions.  Keeping the
	write loaded partitions closer to the disk's edge will
	increase <acronym class="acronym">I/O</acronym> performance in the
	partitions where it occurs the most.  While
	<acronym class="acronym">I/O</acronym> performance in the larger partitions
	may be needed, shifting them more toward the edge of the disk
	will not lead to a significant performance improvement over
	moving <code class="filename">/var</code> to the edge.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-part-guided"></a>2.6.2. Guided Partitioning Using UFS</h3></div></div></div><p>When this method is selected, a menu will display the
	available disk(s).  If multiple disks are connected, choose
	the one where FreeBSD is to be installed.</p><div class="figure"><a id="bsdinstall-part-guided-disk"></a><div class="figure-title">Figure 2.11. Selecting from Multiple Disks</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-guided-disk.png" alt="Selecting from Multiple Disks" /></div></div></div><br class="figure-break" /><p>Once the disk is selected, the next menu prompts to
	install to either the entire disk or to create a partition
	using free space.  If
	<span class="guibutton">[ Entire Disk ]</span> is
	chosen, a general partition layout filling the whole disk is
	automatically created.  Selecting
	<span class="guibutton">[ Partition ]</span> creates a
	partition layout from the unused space on the disk.</p><div class="figure"><a id="bsdinstall-part-entire-part"></a><div class="figure-title">Figure 2.12. Selecting Entire Disk or Partition</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-entire-part.png" alt="Selecting Entire Disk or Partition" /></div></div></div><br class="figure-break" /><p>After
	<span class="guibutton">[ Entire Disk ]</span> is
	chosen <span class="application">bsdinstall</span> displays a
	dialog indicating that the disk will be erased.</p><div class="figure"><a id="bsdinstall-ufs-warning"></a><div class="figure-title">Figure 2.13. Confirmation</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-ufs-warning.png" alt="Confirmation" /></div></div></div><br class="figure-break" /><p>The next menu shows a list with the partition schemes
	types.  GPT is usually the most appropriate choice for amd64
	computers.  Older computers that are not compatible with GPT
	should use MBR.  The other partition schemes are generally
	used for uncommon or older computers.  More information is
	available in <a class="xref" href="#partition-schemes" title="Table 2.1. Partitioning Schemes">Table 2.1, &#8220;Partitioning Schemes&#8221;</a>.</p><div class="figure"><a id="bsdinstall-ufs-scheme"></a><div class="figure-title">Figure 2.14. Select Partition Scheme</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-manual-partscheme.png" alt="Select Partition Scheme" /></div></div></div><br class="figure-break" /><p>After the partition layout has been created, review it to
	ensure it meets the needs of the installation.  Selecting
	<span class="guibutton">[ Revert ]</span> will reset the
	partitions to their original values and pressing
	<span class="guibutton">[ Auto ]</span> will recreate the
	automatic FreeBSD partitions.  Partitions can also be manually
	created, modified, or deleted.  When the partitioning is
	correct, select <span class="guibutton">[ Finish ]</span> to
	continue with the installation.</p><div class="figure"><a id="bsdinstall-part-review"></a><div class="figure-title">Figure 2.15. Review Created Partitions</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-review.png" alt="Review Created Partitions" /></div></div></div><br class="figure-break" /><p>Once the disks are configured, the next menu provides the
	last chance to make changes before the selected drives are
	formatted.  If changes need to be made, select
	<span class="guibutton">[ Back ]</span> to return to the
	main partitioning menu.
      	<span class="guibutton">[ Revert &amp; Exit ]</span>
	exits the installer without making any changes to the drive.
	Select <span class="guibutton">[ Commit ]</span> to start
	the installation process.</p><div class="figure"><a id="bsdinstall-ufs-final-confirmation"></a><div class="figure-title">Figure 2.16. Final Confirmation</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-final-confirmation.png" alt="Final Confirmation" /></div></div></div><br class="figure-break" /><p>To continue with the installation process go to
      <a class="xref" href="#bsdinstall-fetching-distribution" title="2.7. Fetching Distribution Files">Section 2.7, &#8220;Fetching Distribution Files&#8221;</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-part-manual"></a>2.6.3. Manual Partitioning</h3></div></div></div><p>Selecting this method opens the partition editor:</p><div class="figure"><a id="bsdinstall-part-manual-create"></a><div class="figure-title">Figure 2.17. Manually Create Partitions</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-manual-create.png" alt="Manually Create Partitions" /></div></div></div><br class="figure-break" /><p>Highlight the installation drive
	(<code class="filename">ada0</code> in this example) and select
	<span class="guibutton">[ Create ]</span> to display a menu
	of available partition schemes:</p><div class="figure"><a id="bsdinstall-part-manual-partscheme"></a><div class="figure-title">Figure 2.18. Manually Create Partitions</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-manual-partscheme.png" alt="Manually Create Partitions" /></div></div></div><br class="figure-break" /><p><acronym class="acronym">GPT</acronym> is usually the most appropriate
	choice for amd64 computers.  Older computers that are
	not compatible with <acronym class="acronym">GPT</acronym> should use
	<acronym class="acronym">MBR</acronym>.  The other partition schemes are
	generally used for uncommon or older computers.</p><div class="table"><a id="partition-schemes"></a><div class="table-title">Table 2.1. Partitioning Schemes</div><div class="table-contents"><table class="table" summary="Partitioning Schemes" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Abbreviation</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">APM</td><td align="left">Apple Partition Map, used by <span class="trademark">PowerPC</span>®.</td></tr><tr><td align="left">BSD</td><td align="left"><acronym class="acronym">BSD</acronym> label without an
		<acronym class="acronym">MBR</acronym>, sometimes called
		<em class="firstterm">dangerously dedicated mode</em> as
		non-<acronym class="acronym">BSD</acronym> disk utilities may not
		recognize it.</td></tr><tr><td align="left">GPT</td><td align="left">GUID Partition Table (<a class="link" href="http://en.wikipedia.org/wiki/GUID_Partition_Table" target="_top">http://en.wikipedia.org/wiki/GUID_Partition_Table</a>).</td></tr><tr><td align="left">MBR</td><td align="left">Master Boot Record (<a class="link" href="http://en.wikipedia.org/wiki/Master_boot_record" target="_top">http://en.wikipedia.org/wiki/Master_boot_record</a>).</td></tr><tr><td align="left">VTOC8</td><td align="left">Volume Table Of Contents used by Sun SPARC64 and
		UltraSPARC computers.</td></tr></tbody></table></div></div><br class="table-break" /><p>After the partitioning scheme has been selected and
	created, select <span class="guibutton">[ Create ]</span>
	again to create the partitions.  The <span class="keycap"><strong>Tab</strong></span>
	key is used to move the cursor between fields.</p><div class="figure"><a id="bsdinstall-part-manual-addpart"></a><div class="figure-title">Figure 2.19. Manually Create Partitions</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-part-manual-addpart.png" alt="Manually Create Partitions" /></div></div></div><br class="figure-break" /><p>A standard FreeBSD <acronym class="acronym">GPT</acronym> installation uses
	at least three partitions:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">freebsd-boot</code> - Holds the FreeBSD boot
	    code.</p></li><li class="listitem"><p><code class="literal">freebsd-ufs</code> - A FreeBSD
	    <acronym class="acronym">UFS</acronym> file system.</p></li><li class="listitem"><p><code class="literal">freebsd-zfs</code> - A FreeBSD
	    <acronym class="acronym">ZFS</acronym> file system.  More information about
	    ZFS is available in <a class="xref" href="#zfs" title="Chapter 19. The Z File System (ZFS)">Chapter 19, <em>The Z File System (<acronym class="acronym">ZFS</acronym>)</em></a>.</p></li><li class="listitem"><p><code class="literal">freebsd-swap</code> - FreeBSD swap
	    space.</p></li></ul></div><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a> for descriptions of the available
	<acronym class="acronym">GPT</acronym> partition types.</p><p>Multiple file system partitions can be created and some
	people prefer a traditional layout with separate partitions
	for <code class="filename">/</code>, <code class="filename">/var</code>,
	<code class="filename">/tmp</code>, and <code class="filename">/usr</code>.  See
	<a class="xref" href="#bsdinstall-part-manual-splitfs" title="Example 2.1. Creating Traditional Split File System Partitions">Example 2.1, &#8220;Creating Traditional Split File System
	  Partitions&#8221;</a> for an
	example.</p><p>The <code class="literal">Size</code> may be entered with common
	abbreviations: <span class="emphasis"><em>K</em></span> for kilobytes,
	<span class="emphasis"><em>M</em></span> for megabytes, or
	<span class="emphasis"><em>G</em></span> for gigabytes.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Proper sector alignment provides the best performance,
	  and making partition sizes even multiples of 4K bytes helps
	  to ensure alignment on drives with either 512-byte or
	  4K-byte sectors.  Generally, using partition sizes that are
	  even multiples of 1M or 1G is the easiest way to make sure
	  every partition starts at an even multiple of 4K.  There is
	  one exception: the <span class="emphasis"><em>freebsd-boot</em></span>
	  partition should be no larger than 512K due to current boot
	  code limitations.</p></div><p>A <code class="literal">Mountpoint</code> is needed if the partition
	will contain a file system.  If only a single
	<acronym class="acronym">UFS</acronym> partition will be created, the
	mountpoint should be <code class="filename">/</code>.</p><p>The <code class="literal">Label</code> is a name by which the
	partition will be known.  Drive names or numbers can change if
	the drive is connected to a different controller or port, but
	the partition label does not change.  Referring to labels
	instead of drive names and partition numbers in files like
	<code class="filename">/etc/fstab</code> makes the system more tolerant
	to hardware changes.  <acronym class="acronym">GPT</acronym> labels appear in
	<code class="filename">/dev/gpt/</code> when a disk is attached.  Other
	partitioning schemes have different label capabilities and
	their labels appear in different directories in
	<code class="filename">/dev/</code>.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Use a unique label on every partition to avoid
	  conflicts from identical labels.  A few letters from the
	  computer's name, use, or location can be added to the label.
	  For instance, use <code class="literal">labroot</code> or
	  <code class="literal">rootfslab</code> for the <acronym class="acronym">UFS</acronym>
	  root partition on the computer named
	  <code class="literal">lab</code>.</p></div><div class="example"><a id="bsdinstall-part-manual-splitfs"></a><div class="example-title">Example 2.1. Creating Traditional Split File System
	  Partitions</div><div class="example-contents"><p>For a traditional partition layout where the
	  <code class="filename">/</code>, <code class="filename">/var</code>,
	  <code class="filename">/tmp</code>, and <code class="filename">/usr</code>
	  directories are separate file systems on their own
	  partitions, create a <acronym class="acronym">GPT</acronym> partitioning
	  scheme, then create the partitions as shown.  Partition
	  sizes shown are typical for a 20G target disk.  If more
	  space is available on the target disk, larger swap or
	  <code class="filename">/var</code> partitions may be useful.  Labels
	  shown here are prefixed with <code class="literal">ex</code> for
	  <span class="quote">&#8220;<span class="quote">example</span>&#8221;</span>, but readers should use other unique
	  label values as described above.</p><p>By default, FreeBSD's <code class="filename">gptboot</code> expects
	  the first <acronym class="acronym">UFS</acronym> partition to be the
	  <code class="filename">/</code> partition.</p><div class="informaltable"><table class="informaltable" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Partition Type</th><th>Size</th><th>Mountpoint</th><th>Label</th></tr></thead><tbody><tr><td><code class="literal">freebsd-boot</code></td><td><code class="literal">512K</code></td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td><code class="literal">freebsd-ufs</code></td><td><code class="literal">2G</code></td><td><code class="filename">/</code></td><td><code class="literal">exrootfs</code></td></tr><tr><td><code class="literal">freebsd-swap</code></td><td><code class="literal">4G</code></td><td> </td><td><code class="literal">exswap</code></td></tr><tr><td><code class="literal">freebsd-ufs</code></td><td><code class="literal">2G</code></td><td><code class="filename">/var</code></td><td><code class="literal">exvarfs</code></td></tr><tr><td><code class="literal">freebsd-ufs</code></td><td><code class="literal">1G</code></td><td><code class="filename">/tmp</code></td><td><code class="literal">extmpfs</code></td></tr><tr><td><code class="literal">freebsd-ufs</code></td><td>accept the default (remainder of the
		  disk)</td><td><code class="filename">/usr</code></td><td><code class="literal">exusrfs</code></td></tr></tbody></table></div></div></div><br class="example-break" /><p>After the custom partitions have been created, select
	<span class="guibutton">[ Finish ]</span> to continue with
	the installation and go to
	<a class="xref" href="#bsdinstall-fetching-distribution" title="2.7. Fetching Distribution Files">Section 2.7, &#8220;Fetching Distribution Files&#8221;</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-part-zfs"></a>2.6.4. Guided Partitioning Using Root-on-ZFS</h3></div></div></div><p>This partitioning mode only works with whole disks and
	will erase the contents of the entire disk.  The main
	<acronym class="acronym">ZFS</acronym> configuration menu offers a number of
	options to control the creation of the pool.</p><div class="figure"><a id="bsdinstall-zfs-menu"></a><div class="figure-title">Figure 2.20. <acronym class="acronym">ZFS</acronym> Partitioning Menu</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-menu.png" alt="ZFS Partitioning Menu" /></div></div></div><br class="figure-break" /><p>Here is a summary of the options which can be used in
	this menu:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">Install</code> - Proceed with the
	  installation with the selected options.</p></li><li class="listitem"><p><code class="literal">Pool Type/Disks</code> - Allow to configure
	  the <code class="literal">Pool Type</code> and the disk(s) that will
	  constitute the pool.  The automatic <acronym class="acronym">ZFS</acronym>
	  installer currently only supports the creation of a single top
	  level vdev, except in stripe mode.  To create more complex
	  pools, use the instructions in <a class="xref" href="#bsdinstall-part-shell" title="2.6.5. Shell Mode Partitioning">Section 2.6.5, &#8220;Shell Mode Partitioning&#8221;</a>
	  to create the pool.</p></li><li class="listitem"><p><code class="literal">Rescan Devices</code> - Repopulate the list
	  of available disks.</p></li><li class="listitem"><p><code class="literal">Disk Info</code> - Disk Info menu can be
	  used to inspect each disk, including its partition table and
	  various other information such as the device model number
	  and serial number, if available.</p></li><li class="listitem"><p><code class="literal">Pool Name</code> - Establish the name of the
	  pool.  The default name is
	  <span class="emphasis"><em>zroot</em></span>.</p></li><li class="listitem"><p><code class="literal">Force 4K Sectors?</code> - Force the use of
	  4K sectors.  By default, the installer will automatically
	  create partitions aligned to 4K boundaries and force ZFS to
	  use 4K sectors.  This is safe even with 512 byte sector
	  disks, and has the added benefit of ensuring that pools
	  created on 512 byte disks will be able to have 4K sector
	  disks added in the future, either as additional storage
	  space or as replacements for failed disks.  Press the
	  <span class="keycap"><strong>Enter</strong></span> key to chose to activate it or
	  not.</p></li><li class="listitem"><p><code class="literal">Encrypt Disks?</code> - Encrypting the disks
	  allows the user to encrypt the disks using
	  <acronym class="acronym">GELI</acronym>.  More information about disk
	  encryption is available in <a class="xref" href="#disks-encrypting-geli" title="17.12.2. Disk Encryption with geli">Section 17.12.2, &#8220;Disk Encryption with <code class="command">geli</code>&#8221;</a>.
	  Press the <span class="keycap"><strong>Enter</strong></span> key to chose activate it or
	  not.</p></li><li class="listitem"><p><code class="literal">Partition Scheme</code> - Allow to choose
	  the partition scheme.  GPT is the recommended option in
	  most cases.  Press the <span class="keycap"><strong>Enter</strong></span> key to chose
	  between the different options.</p></li><li class="listitem"><p><code class="literal">Swap Size</code> - Establish the amount of
	  swap space.</p></li><li class="listitem"><p><code class="literal">Mirror Swap?</code> - Allows the user to
	  mirror the swap between the disks.  Be aware, enabling
	  mirror swap will break crash dumps.  Press the
	  <span class="keycap"><strong>Enter</strong></span> key to activate it or not.</p></li><li class="listitem"><p><code class="literal">Encrypt Swap?</code> - Allow the user the
	  possibility to encrypt the swap.  Encrypts the swap with a
	  temporary key each time that the system boots and discards
	  it on reboot.  Press the <span class="keycap"><strong>Enter</strong></span> key to chose
	  activate it or not.  More information about swap encryption
	  in <a class="xref" href="#swap-encrypting" title="17.13. Encrypting Swap">Section 17.13, &#8220;Encrypting Swap&#8221;</a>.</p></li></ul></div><p>Select <span class="keycap"><strong>T</strong></span> to configure the <code class="literal">Pool
	Type</code> and the disk(s) that will constitute the
	pool.</p><div class="figure"><a id="bsdinstall-zfs-vdev_type"></a><div class="figure-title">Figure 2.21. <acronym class="acronym">ZFS</acronym> Pool Type</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-vdev_type.png" alt="ZFS Pool Type" /></div></div></div><br class="figure-break" /><p>Here is a summary of the <code class="literal">Pool Type</code>
	which can be selected in this menu:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">stripe</code> - Striping provides maximum
	  storage of all connected devices, but no redundancy.  If
	  just one disk fails the data on the pool is lost
	  irrevocably.</p></li><li class="listitem"><p><code class="literal">mirror</code> - Mirroring stores a complete
	  copy of all data on every disk.  Mirroring provides a good
	  read perfomance because data is read from all disks in
	  parallel.  Write performance is slower as the data must be
	  written to all disks in the pool.  Allows all but one disk
	  to fail.  This option requires at least two disks.</p></li><li class="listitem"><p><code class="literal">raid10</code> - Striped mirrors.  Provides
	  the best performance, but the least storage.  This option
	  needs at least an even number of disks and a minimum of four
	  disks.</p></li><li class="listitem"><p><code class="literal">raidz1</code> - Single Redundant RAID.
	  Allow one disk to fail concurrently.  This option needs at
	  least three disks.</p></li><li class="listitem"><p><code class="literal">raidz2</code> - Double Redundant RAID.
	  Allows two disks to fail concurrently.  This option needs
	  at least four disks.</p></li><li class="listitem"><p><code class="literal">raidz3</code> - Triple Redundant RAID.
	  Allows three disks to fail concurrently.  This option needs
	  at least five disks.</p></li></ul></div><p>Once a <code class="literal">Pool Type</code> has been selected, a
	list of available disks is displayed, and the user is prompted
	to select one or more disks to make up the pool.  The
	configuration is then validated, to ensure enough disks are
	selected.  If not, select <span class="guibutton">&lt;Change
	Selection&gt;</span> to return to the list of disks, or
	<span class="guibutton">&lt;Back&gt;</span> to change the
	<code class="literal">Pool Type</code>.</p><div class="figure"><a id="bsdinstall-zfs-disk_select"></a><div class="figure-title">Figure 2.22. Disk Selection</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-disk_select.png" alt="Disk Selection" /></div></div></div><br class="figure-break" /><div class="figure"><a id="bsdinstall-zfs-vdev_invalid"></a><div class="figure-title">Figure 2.23. Invalid Selection</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-vdev_invalid.png" alt="Invalid Selection" /></div></div></div><br class="figure-break" /><p>If one or more disks are missing from the list, or if
	disks were attached after the installer was started, select
	<span class="guibutton">- Rescan Devices</span> to repopulate the list
	of available disks.</p><div class="figure"><a id="bsdinstall-zfs-rescan-devices"></a><div class="figure-title">Figure 2.24. Rescan Devices</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-rescan-devices.png" alt="Rescan Devices" /></div></div></div><br class="figure-break" /><p>To avoid accidentally erasing the wrong disk, the
	<span class="guibutton">- Disk Info</span> menu can be used to inspect
	each disk, including its partition table and various other
	information such as the device model number and serial number,
	if available.</p><div class="figure"><a id="bsdinstall-zfs-disk_info"></a><div class="figure-title">Figure 2.25. Analyzing a Disk</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-disk_info.png" alt="Analyzing a Disk" /></div></div></div><br class="figure-break" /><p>Select <span class="keycap"><strong>N</strong></span> to configure the
	<code class="literal">Pool Name</code>.  Enter the desired name then
	select <span class="guibutton">&lt;OK&gt;</span> to establish it or
	<span class="guibutton">&lt;Cancel&gt;</span> to return to the
	main menu and leave the default name.</p><div class="figure"><a id="bsdinstall-zfs-pool-name"></a><div class="figure-title">Figure 2.26. Pool Name</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-pool-name.png" alt="Pool Name" /></div></div></div><br class="figure-break" /><p>Select <span class="keycap"><strong>S</strong></span> to set the amount of
	swap.  Enter the desired amount of swap and then select
	<span class="guibutton">&lt;OK&gt;</span> to establish it or
	<span class="guibutton">&lt;Cancel&gt;</span> to return to the
	main menu and let the default amount.</p><div class="figure"><a id="bsdinstall-zfs-swap-amount"></a><div class="figure-title">Figure 2.27. Swap Amount</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-swap-amount.png" alt="Swap Amount" /></div></div></div><br class="figure-break" /><p>Once all options have been set to the desired values,
	select the <span class="guibutton">&gt;&gt;&gt; Install</span>
	option at the top of the menu.  The installer then offers a
	last chance to cancel before the contents of the selected
	drives are destroyed to create the <acronym class="acronym">ZFS</acronym>
	pool.</p><div class="figure"><a id="bsdinstall-zfs-warning"></a><div class="figure-title">Figure 2.28. Last Chance</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-warning.png" alt="Last Chance" /></div></div></div><br class="figure-break" /><p>If <acronym class="acronym">GELI</acronym> disk encryption was enabled,
	the installer will prompt twice for the passphrase to be used
	to encrypt the disks.  And after that the initializing of the
	encryption begins.</p><div class="figure"><a id="bsdinstall-zfs-geli_password"></a><div class="figure-title">Figure 2.29. Disk Encryption Password</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-geli_password.png" alt="Disk Encryption Password" /></div></div></div><br class="figure-break" /><div class="figure"><a id="bsdinstall-zfs-init-encription"></a><div class="figure-title">Figure 2.30. Initializing Encryption</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-zfs-init-encription.png" alt="Initializing Encryption" /></div></div></div><br class="figure-break" /><p>The installation then proceeds normally.  To continue
	with the installation go to
	<a class="xref" href="#bsdinstall-fetching-distribution" title="2.7. Fetching Distribution Files">Section 2.7, &#8220;Fetching Distribution Files&#8221;</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-part-shell"></a>2.6.5. Shell Mode Partitioning</h3></div></div></div><p>When creating advanced installations, the
	<span class="application">bsdinstall</span> partitioning menus may
	not provide the level of flexibility required.  Advanced users
	can select the <span class="guibutton">Shell</span> option from the
	partitioning menu in order to manually partition the drives,
	create the file system(s), populate
	<code class="filename">/tmp/bsdinstall_etc/fstab</code>, and mount the
	file systems under <code class="filename">/mnt</code>.  Once this is
	done, type <code class="command">exit</code> to return to
	<span class="application">bsdinstall</span> and continue the
	installation.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-fetching-distribution"></a>2.7. Fetching Distribution Files</h2></div></div></div><p>Installation time will vary depending on the distributions
      chosen, installation media, and speed of the computer.  A series
      of messages will indicate the progress.</p><p>First, the installer formats the selected disk(s) and
      initializes the partitions.  Next, in the case of a
      <code class="literal">bootonly media</code> or
      <code class="literal">mini memstick</code>, it downloads the selected
      components:</p><div class="figure"><a id="bsdinstall-distfile-fetching"></a><div class="figure-title">Figure 2.31. Fetching Distribution Files</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-distfile-fetching.png" alt="Fetching Distribution Files" /></div></div></div><br class="figure-break" /><p>Next, the integrity of the distribution files is verified
      to ensure they have not been corrupted during download or
      misread from the installation media:</p><div class="figure"><a id="bsdinstall-distfile-verify"></a><div class="figure-title">Figure 2.32. Verifying Distribution Files</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-distfile-verifying.png" alt="Verifying Distribution Files" /></div></div></div><br class="figure-break" /><p>Finally, the verified distribution files are extracted to
      the disk:</p><div class="figure"><a id="bsdinstall-distfile-extract"></a><div class="figure-title">Figure 2.33. Extracting Distribution Files</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-distfile-extracting.png" alt="Extracting Distribution Files" /></div></div></div><br class="figure-break" /><p>Once all requested distribution files have been extracted,
      <span class="application">bsdinstall</span> displays the first
      post-installation configuration screen.  The available
      post-configuration options are described in the next
      section.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-post"></a>2.8. Accounts, Time Zone, Services and Hardening</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-post-root"></a>2.8.1. Setting the
	<code class="systemitem">root</code>
	Password</h3></div></div></div><p>First, the <code class="systemitem">root</code>
	password must be set.  While entering the password, the
	characters being typed are not displayed on the screen.  After
	the password has been entered, it must be entered again.  This
	helps prevent typing errors.</p><div class="figure"><a id="bsdinstall-post-set-root-passwd"></a><div class="figure-title">Figure 2.34. Setting the <code class="systemitem">root</code> Password</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-post-root-passwd.png" alt="Setting the root Password" /></div></div></div><br class="figure-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-timezone"></a>2.8.2. Setting the Time Zone</h3></div></div></div><p>The next series of menus are used to determine the correct
	local time by selecting the geographic region, country, and
	time zone.  Setting the time zone allows the system to
	automatically correct for regional time changes, such as
	daylight savings time, and perform other time zone related
	functions properly.</p><p>The example shown here is for a machine located in the
	mainland time zone of Spain, Europe.  The selections will
	vary according to the geographical location.</p><div class="figure"><a id="bsdinstall-timezone-region"></a><div class="figure-title">Figure 2.35. Select a Region</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-timezone-region.png" alt="Select a Region" /></div></div></div><br class="figure-break" /><p>The appropriate region is selected using the arrow keys
	and then pressing <span class="keycap"><strong>Enter</strong></span>.</p><div class="figure"><a id="bsdinstall-timezone-country"></a><div class="figure-title">Figure 2.36. Select a Country</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-timezone-country.png" alt="Select a Country" /></div></div></div><br class="figure-break" /><p>Select the appropriate country using the arrow keys and
	press <span class="keycap"><strong>Enter</strong></span>.</p><div class="figure"><a id="bsdinstall-timezone-zone"></a><div class="figure-title">Figure 2.37. Select a Time Zone</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-timezone-zone.png" alt="Select a Time Zone" /></div></div></div><br class="figure-break" /><p>The appropriate time zone is selected using the arrow keys
	and pressing <span class="keycap"><strong>Enter</strong></span>.</p><div class="figure"><a id="bsdinstall-timezone-confirmation"></a><div class="figure-title">Figure 2.38. Confirm Time Zone</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-timezone-confirm.png" alt="Confirm Time Zone" /></div></div></div><br class="figure-break" /><p>Confirm the abbreviation for the time zone is
	correct.</p><div class="figure"><a id="bsdinstall-timezone-date"></a><div class="figure-title">Figure 2.39. Select Date</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-timezone-date.png" alt="Select Date" /></div></div></div><br class="figure-break" /><p>The appropriate date is selected using the arrow keys
	and then pressing
	<span class="guibutton">[ Set Date ]</span>.
	Otherwise, the date selection can be skipped by pressing
	<span class="guibutton">[ Skip ]</span>.</p><div class="figure"><a id="bsdinstall-timezone-time"></a><div class="figure-title">Figure 2.40. Select Time</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-timezone-time.png" alt="Select Time" /></div></div></div><br class="figure-break" /><p>The appropriate time is selected using the arrow keys
	and then pressing
	<span class="guibutton">[ Set Time ]</span>.
	Otherwise, the time selection can be skipped by pressing
	<span class="guibutton">[ Skip ]</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-sysconf"></a>2.8.3. Enabling Services</h3></div></div></div><p>The next menu is used to configure which system services
	will be started whenever the system boots.  All of these
	services are optional.  Only start the services that are
	needed for the system to function.</p><div class="figure"><a id="bsdinstall-config-serv"></a><div class="figure-title">Figure 2.41. Selecting Additional Services to Enable</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-config-services.png" alt="Selecting Additional Services to Enable" /></div></div></div><br class="figure-break" /><p>Here is a summary of the services which can be enabled in
	this menu:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">local_unbound</code> - Enable the DNS
	    local unbound.  It is necessary to keep in mind that this
	    is the unbound of the base system and is only meant for
	    use as a local caching forwarding resolver.  If the
	    objective is to set up a resolver for the entire network
	    install <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/dns/unbound/pkg-descr">dns/unbound</a>.</p></li><li class="listitem"><p><code class="literal">sshd</code> - The Secure Shell
	    (<acronym class="acronym">SSH</acronym>) daemon is used to remotely access
	    a system over an encrypted connection.  Only enable this
	    service if the system should be available for remote
	    logins.</p></li><li class="listitem"><p><code class="literal">moused</code> - Enable this service if the
	    mouse will be used from the command-line system
	    console.</p></li><li class="listitem"><p><code class="literal">ntpdate</code> - Enable the automatic
	    clock synchronization at boot time.  The functionality of
	    this program is now available in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> daemon.
	    After a suitable period of mourning, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>
	    utility will be retired.</p></li><li class="listitem"><p><code class="literal">ntpd</code> - The Network Time Protocol
	    (<acronym class="acronym">NTP</acronym>) daemon for automatic clock
	    synchronization.  Enable this service if there is a
	    <span class="trademark">Windows</span>®, Kerberos, or <acronym class="acronym">LDAP</acronym> server on
	    the network.</p></li><li class="listitem"><p><code class="literal">powerd</code> - System power control
	    utility for power control and energy saving.</p></li><li class="listitem"><p><code class="literal">dumpdev</code> - Enabling crash dumps is
	    useful in debugging issues with the system, so users are
	    encouraged to enable crash dumps.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-hardening"></a>2.8.4. Enabling Hardening Security Options</h3></div></div></div><p>The next menu is used to configure which security
	options will be enabled.  All of these options are optional.
	But their use is encouraged.</p><div class="figure"><a id="bsdinstall-hardening-options"></a><div class="figure-title">Figure 2.42. Selecting Hardening Security Options</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-hardening.png" alt="Selecting Hardening Security Options" /></div></div></div><br class="figure-break" /><p>Here is a summary of the options which can be enabled in
	this menu:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">hide_uids</code> - Hide processes running
	    as other users to prevent the unprivileged users to see
	    other running processes in execution by other users (UID)
	    preventing information leakage.</p></li><li class="listitem"><p><code class="literal">hide_gids</code> - Hide processes running
	    as other groups to prevent the unprivileged users to see
	    other running processes in execution by other groups (GID)
	    preventing information leakage.</p></li><li class="listitem"><p><code class="literal">hide_jail</code> - Hide processes running
	    in jails to prevent the unprivileged users to see
	    processes running inside the jails.</p></li><li class="listitem"><p><code class="literal">read_msgbuf</code> - Disabling reading
	    kernel message buffer for unprivileged users prevent from
	    using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> to view messages from the kernel's log
	    buffer.</p></li><li class="listitem"><p><code class="literal">proc_debug</code> - Disabling process
	    debugging facilities for unprivileged users disables
	    a variety of unprivileged inter-process debugging
	    services, including some procfs functionality, ptrace(),
	    and ktrace().  Please note that this will also prevent
	    debugging tools, for instance <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lldb&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lldb</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=truss&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">truss</span>(1)</span></a>,
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=procstat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">procstat</span>(1)</span></a>, as well as some built-in debugging
	    facilities in certain scripting language like PHP, etc.,
	    from working for unprivileged users.</p></li><li class="listitem"><p><code class="literal">random_pid</code> - Randomize the PID of
	    newly created processes.</p></li><li class="listitem"><p><code class="literal">clear_tmp</code> - Clean
	    <code class="filename">/tmp</code> when the system starts
	    up.</p></li><li class="listitem"><p><code class="literal">disable_syslogd</code> - Disable opening
	    <span class="application">syslogd</span> network socket.  By
	    default FreeBSD runs <span class="application">syslogd</span> in a
	    secure way with <code class="command">-s</code>.  That prevents the
	    daemon from listening for incoming UDP requests
	    at port 514.  With this option enabled
	    <span class="application">syslogd</span> will run with the flag
	    <code class="command">-ss</code> which prevents
	    <span class="application">syslogd</span> from opening any port.
	    To get more information consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>.</p></li><li class="listitem"><p><code class="literal">disable_sendmail</code> - Disable the
	    sendmail mail transport agent.</p></li><li class="listitem"><p><code class="literal">secure_console</code> - When this option
	    is enabled, the prompt requests the <code class="systemitem">root</code> password when
	    entering single-user mode.</p></li><li class="listitem"><p><code class="literal">disable_ddtrace</code> - DTrace can run
	    in a mode that will actually affect the running kernel.
	    Destructive actions may not be used unless they have
	    been explicitly enabled.  To enable this option when using
	    DTrace use <code class="command">-w</code>.  To get more
	    information consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dtrace&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dtrace</span>(1)</span></a>.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-addusers"></a>2.8.5. Add Users</h3></div></div></div><p>The next menu prompts to create at least one user account.
	It is recommended to login to the system using a user account
	rather than as <code class="systemitem">root</code>.
	When logged in as <code class="systemitem">root</code>, there are essentially no
	limits or protection on what can be done.  Logging in as a
	normal user is safer and more secure.</p><p>Select <span class="guibutton">[ Yes ]</span> to add new
	users.</p><div class="figure"><a id="bsdinstall-add-user1"></a><div class="figure-title">Figure 2.43. Add User Accounts</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-adduser1.png" alt="Add User Accounts" /></div></div></div><br class="figure-break" /><p>Follow the prompts and input the requested information for
	the user account.  The example shown in <a class="xref" href="#bsdinstall-add-user2" title="Figure 2.44. Enter User Information">Figure 2.44, &#8220;Enter User Information&#8221;</a> creates the <code class="systemitem">asample</code> user account.</p><div class="figure"><a id="bsdinstall-add-user2"></a><div class="figure-title">Figure 2.44. Enter User Information</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-adduser2.png" alt="Enter User Information" /></div></div></div><br class="figure-break" /><p>Here is a summary of the information to input:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">Username</code> - The name the user will
	    enter to log in.  A common convention is to use the first
	    letter of the first name combined with the last name, as
	    long as each username is unique for the system.  The
	    username is case sensitive and should not contain any
	    spaces.</p></li><li class="listitem"><p><code class="literal">Full name</code> - The user's full name.
	    This can contain spaces and is used as a description for
	    the user account.</p></li><li class="listitem"><p><code class="literal">Uid</code> - User <acronym class="acronym">ID</acronym>.
	    Typically, this is left blank so the system will assign a
	    value.</p></li><li class="listitem"><p><code class="literal">Login group</code> - The user's group.
	    Typically this is left blank to accept the default.</p></li><li class="listitem"><p><code class="literal">Invite <em class="replaceable"><code>user</code></em> into
	      other groups?</code> - Additional groups to which the
	    user will be added as a member.  If the user needs
	    administrative access, type <code class="literal">wheel</code>
	    here.</p></li><li class="listitem"><p><code class="literal">Login class</code> - Typically left blank
	    for the default.</p></li><li class="listitem"><p><code class="literal">Shell</code> - Type in one of the listed
	    values to set the interactive shell for the user.  Refer
	    to <a class="xref" href="#shells" title="3.9. Shells">Section 3.9, &#8220;Shells&#8221;</a> for more information about
	    shells.</p></li><li class="listitem"><p><code class="literal">Home directory</code> - The user's home
	    directory.  The default is usually correct.</p></li><li class="listitem"><p><code class="literal">Home directory permissions</code> -
	    Permissions on the user's home directory.  The default is
	    usually correct.</p></li><li class="listitem"><p><code class="literal">Use password-based authentication?</code>
	    - Typically <code class="literal">yes</code> so that the user is
	    prompted to input their password at login.</p></li><li class="listitem"><p><code class="literal">Use an empty password?</code> -
	    Typically <code class="literal">no</code> as it is insecure to have
	    a blank password.</p></li><li class="listitem"><p><code class="literal">Use a random password?</code> - Typically
	    <code class="literal">no</code> so that the user can set their own
	    password in the next prompt.</p></li><li class="listitem"><p><code class="literal">Enter password</code> - The password for
	    this user.  Characters typed will not show on the
	    screen.</p></li><li class="listitem"><p><code class="literal">Enter password again</code> - The password
	    must be typed again for verification.</p></li><li class="listitem"><p><code class="literal">Lock out the account after
	      creation?</code> - Typically <code class="literal">no</code> so
	    that the user can login.</p></li></ul></div><p>After entering everything, a summary is shown for review.
	If a mistake was made, enter <code class="literal">no</code> and try
	again.  If everything is correct, enter <code class="literal">yes</code>
	to create the new user.</p><div class="figure"><a id="bsdinstall-add-user3"></a><div class="figure-title">Figure 2.45. Exit User and Group Management</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-adduser3.png" alt="Exit User and Group Management" /></div></div></div><br class="figure-break" /><p>If there are more users to add, answer the <code class="literal">Add
	  another user?</code> question with
	<code class="literal">yes</code>.  Enter <code class="literal">no</code> to finish
	adding users and continue the installation.</p><p>For more information on adding users and user management,
	see <a class="xref" href="#users-synopsis" title="3.3. Users and Basic Account Management">Section 3.3, &#8220;Users and Basic Account Management&#8221;</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-final-conf"></a>2.8.6. Final Configuration</h3></div></div></div><p>After everything has been installed and configured, a
	final chance is provided to modify settings.</p><div class="figure"><a id="bsdinstall-final-config"></a><div class="figure-title">Figure 2.46. Final Configuration</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-finalconfiguration.png" alt="Final Configuration" /></div></div></div><br class="figure-break" /><p>Use this menu to make any changes or do any additional
	configuration before completing the installation.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">Add User</code> - Described in <a class="xref" href="#bsdinstall-addusers" title="2.8.5. Add Users">Section 2.8.5, &#8220;Add Users&#8221;</a>.</p></li><li class="listitem"><p><code class="literal">Root Password</code> - Described in <a class="xref" href="#bsdinstall-post-root" title="2.8.1. Setting the root Password">Section 2.8.1, &#8220;Setting the
	<code class="systemitem">root</code>
	Password&#8221;</a>.</p></li><li class="listitem"><p><code class="literal">Hostname</code> - Described in <a class="xref" href="#bsdinstall-hostname" title="2.5.2. Setting the Hostname">Section 2.5.2, &#8220;Setting the Hostname&#8221;</a>.</p></li><li class="listitem"><p><code class="literal">Network</code> - Described in <a class="xref" href="#bsdinstall-config-network-dev" title="2.9.1. Configuring Network Interfaces">Section 2.9.1, &#8220;Configuring Network Interfaces&#8221;</a>.</p></li><li class="listitem"><p><code class="literal">Services</code> - Described in <a class="xref" href="#bsdinstall-sysconf" title="2.8.3. Enabling Services">Section 2.8.3, &#8220;Enabling Services&#8221;</a>.</p></li><li class="listitem"><p><code class="literal">System Hardening</code> - Described in
	      <a class="xref" href="#bsdinstall-hardening" title="2.8.4. Enabling Hardening Security Options">Section 2.8.4, &#8220;Enabling Hardening Security Options&#8221;</a>.</p></li><li class="listitem"><p><code class="literal">Time Zone</code> - Described in <a class="xref" href="#bsdinstall-timezone" title="2.8.2. Setting the Time Zone">Section 2.8.2, &#8220;Setting the Time Zone&#8221;</a>.</p></li><li class="listitem"><p><code class="literal">Handbook</code> - Download and install the
	    FreeBSD Handbook.</p></li></ul></div><p>After any final configuration is complete, select
	<span class="guibutton">Exit</span>.</p><div class="figure"><a id="bsdinstall-final-modification-shell"></a><div class="figure-title">Figure 2.47. Manual Configuration</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-final-modification-shell.png" alt="Manual Configuration" /></div></div></div><br class="figure-break" /><p><span class="application">bsdinstall</span> will prompt if there
	are any additional configuration that needs to be done before
	rebooting into the new system.  Select
	<span class="guibutton">[ Yes ]</span> to exit to a shell
	within the new system or
	<span class="guibutton">[ No ]</span> to proceed to the last
	step of the installation.</p><div class="figure"><a id="bsdinstall-final-main"></a><div class="figure-title">Figure 2.48. Complete the Installation</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-mainexit.png" alt="Complete the Installation" /></div></div></div><br class="figure-break" /><p>If further configuration or special setup is needed,
	select <span class="guibutton">[ Live CD ]</span> to
	boot the install media into Live <acronym class="acronym">CD</acronym>
	mode.</p><p>If the installation is complete, select
	<span class="guibutton">[ Reboot ]</span> to reboot the
	computer and start the new FreeBSD system.  Do not forget to
	remove the FreeBSD install media or the computer may boot from it
	again.</p><p>As FreeBSD boots, informational messages are displayed.
	After the system finishes booting, a login prompt is
	displayed.  At the <code class="prompt">login:</code> prompt, enter the
	username added during the installation.  Avoid logging in as
	<code class="systemitem">root</code>.  Refer to
	<a class="xref" href="#users-superuser" title="3.3.1.3. The Superuser Account">Section 3.3.1.3, &#8220;The Superuser Account&#8221;</a> for instructions on how to
	become the superuser when administrative access is
	needed.</p><p>The messages that appeared during boot can be reviewed by
	pressing <span class="keycap"><strong>Scroll-Lock</strong></span> to turn on the
	scroll-back buffer.  The <span class="keycap"><strong>PgUp</strong></span>,
	<span class="keycap"><strong>PgDn</strong></span>, and arrow keys can be used to scroll
	back through the messages.  When finished, press
	<span class="keycap"><strong>Scroll-Lock</strong></span> again to unlock the display and
	return to the console.  To review these messages once the
	system has been up for some time, type <code class="command">less
	  /var/run/dmesg.boot</code> from a command prompt.  Press
	<span class="keycap"><strong>q</strong></span> to return to the command line after
	viewing.</p><p>If <span class="application">sshd</span> was enabled in <a class="xref" href="#bsdinstall-config-serv" title="Figure 2.41. Selecting Additional Services to Enable">Figure 2.41, &#8220;Selecting Additional Services to Enable&#8221;</a>, the first boot may be
	a bit slower as the system will generate the
	<acronym class="acronym">RSA</acronym> and <acronym class="acronym">DSA</acronym> keys.
	Subsequent boots will be faster.  The fingerprints of the keys
	will be displayed, as seen in this example:</p><pre class="screen">Generating public/private rsa1 key pair.
Your identification has been saved in /etc/ssh/ssh_host_key.
Your public key has been saved in /etc/ssh/ssh_host_key.pub.
The key fingerprint is:
10:a0:f5:af:93:ae:a3:1a:b2:bb:3c:35:d9:5a:b3:f3 root@machine3.example.com
The key's randomart image is:
+--[RSA1 1024]----+
|    o..          |
|   o . .         |
|  .   o          |
|       o         |
|    o   S        |
|   + + o         |
|o . + *          |
|o+ ..+ .         |
|==o..o+E         |
+-----------------+
Generating public/private dsa key pair.
Your identification has been saved in /etc/ssh/ssh_host_dsa_key.
Your public key has been saved in /etc/ssh/ssh_host_dsa_key.pub.
The key fingerprint is:
7e:1c:ce:dc:8a:3a:18:13:5b:34:b5:cf:d9:d1:47:b2 root@machine3.example.com
The key's randomart image is:
+--[ DSA 1024]----+
|       ..     . .|
|      o  .   . + |
|     . ..   . E .|
|    . .  o o . . |
|     +  S = .    |
|    +  . = o     |
|     +  . * .    |
|    . .  o .     |
|      .o. .      |
+-----------------+
Starting sshd.</pre><p>Refer to <a class="xref" href="#openssh" title="13.8. OpenSSH">Section 13.8, &#8220;OpenSSH&#8221;</a> for more information
	about fingerprints and <acronym class="acronym">SSH</acronym>.</p><p>FreeBSD does not install a graphical environment by default.
	Refer to <a class="xref" href="#x11" title="Chapter 5. The X Window System">Chapter 5, <em>The X Window System</em></a> for more information about
	installing and configuring a graphical window manager.</p><p>Proper shutdown of a FreeBSD computer helps protect data and
	hardware from damage.  <span class="emphasis"><em>Do not turn off the power
	before the system has been properly shut down!</em></span>  If
	the user is a member of the <code class="systemitem">wheel</code> group, become the
	superuser by typing <code class="command">su</code> at the command line
	and entering the <code class="systemitem">root</code> password.  Then, type
	<code class="command">shutdown -p now</code> and the system will shut
	down cleanly, and if the hardware supports it, turn itself
	off.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-network"></a>2.9. Network Interfaces</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdinstall-config-network-dev"></a>2.9.1. Configuring Network Interfaces</h3></div></div></div><p>Next, a list of the network interfaces found on the
	computer is shown.  Select the interface to configure.</p><div class="figure"><a id="bsdinstall-configure-net-interface"></a><div class="figure-title">Figure 2.49. Choose a Network Interface</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface.png" alt="Choose a Network Interface" /></div></div></div><br class="figure-break" /><p>If an Ethernet interface is selected, the installer will
	skip ahead to the menu shown in <a class="xref" href="#bsdinstall-configure-net-ipv4" title="Figure 2.53. Choose IPv4 Networking">Figure 2.53, &#8220;Choose <acronym class="acronym">IPv4</acronym> Networking&#8221;</a>.  If a wireless
	network interface is chosen, the system will instead scan for
	wireless access points:</p><div class="figure"><a id="bsdinstall-wireless-scan"></a><div class="figure-title">Figure 2.50. Scanning for Wireless Access Points</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-wireless-scan.png" alt="Scanning for Wireless Access Points" /></div></div></div><br class="figure-break" /><p>Wireless networks are identified by a Service Set
	Identifier (<acronym class="acronym">SSID</acronym>), a short, unique name
	given to each network.  <acronym class="acronym">SSIDs</acronym> found during
	the scan are listed, followed by a description of the
	encryption types available for that network.  If the desired
	<acronym class="acronym">SSID</acronym> does not appear in the list, select
	<span class="guibutton">[ Rescan ]</span> to scan again.  If
	the desired network still does not appear, check for problems
	with antenna connections or try moving the computer closer to
	the access point.  Rescan after each change is made.</p><div class="figure"><a id="bsdinstall-wireless-accesspoints"></a><div class="figure-title">Figure 2.51. Choosing a Wireless Network</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-wireless-accesspoints.png" alt="Choosing a Wireless Network" /></div></div></div><br class="figure-break" /><p>Next, enter the encryption information for connecting to
	the selected wireless network.  <acronym class="acronym">WPA2</acronym>
	encryption is strongly recommended as older encryption types,
	like <acronym class="acronym">WEP</acronym>, offer little security.  If the
	network uses <acronym class="acronym">WPA2</acronym>, input the password, also
	known as the Pre-Shared Key (<acronym class="acronym">PSK</acronym>).  For
	security reasons, the characters typed into the input box are
	displayed as asterisks.</p><div class="figure"><a id="bsdinstall-wireless-wpa2"></a><div class="figure-title">Figure 2.52. WPA2 Setup</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-wireless-wpa2setup.png" alt="WPA2 Setup" /></div></div></div><br class="figure-break" /><p>Next, choose whether or not an <acronym class="acronym">IPv4</acronym>
	address should be configured on the Ethernet or wireless
	interface:</p><div class="figure"><a id="bsdinstall-configure-net-ipv4"></a><div class="figure-title">Figure 2.53. Choose <acronym class="acronym">IPv4</acronym> Networking</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-ipv4.png" alt="Choose IPv4 Networking" /></div></div></div><br class="figure-break" /><p>There are two methods of <acronym class="acronym">IPv4</acronym>
	configuration.  <acronym class="acronym">DHCP</acronym> will automatically
	configure the network interface correctly and should be used
	if the network provides a <acronym class="acronym">DHCP</acronym> server.
	Otherwise, the addressing information needs to be input
	manually as a static configuration.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Do not enter random network information as it will not
	  work.  If a <acronym class="acronym">DHCP</acronym> server is not available,
	  obtain the information listed in <a class="xref" href="#bsdinstall-collect-network-information" title="Required Network Information">Required Network Information</a> from
	  the network administrator or Internet service
	  provider.</p></div><p>If a <acronym class="acronym">DHCP</acronym> server is available, select
	<span class="guibutton">[ Yes ]</span> in the next menu to
	automatically configure the network interface.  The installer
	will appear to pause for a minute or so as it finds the
	<acronym class="acronym">DHCP</acronym> server and obtains the addressing
	information for the system.</p><div class="figure"><a id="bsdinstall-net-ipv4-dhcp"></a><div class="figure-title">Figure 2.54. Choose <acronym class="acronym">IPv4</acronym> <acronym class="acronym">DHCP</acronym>
	  Configuration</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-ipv4-dhcp.png" alt="Choose IPv4 DHCP Configuration" /></div></div></div><br class="figure-break" /><p>If a <acronym class="acronym">DHCP</acronym> server is not available,
	select <span class="guibutton">[ No ]</span> and input the
	following addressing information in this menu:</p><div class="figure"><a id="bsdinstall-net-ipv4-static"></a><div class="figure-title">Figure 2.55. <acronym class="acronym">IPv4</acronym> Static Configuration</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-ipv4-static.png" alt="IPv4 Static Configuration" /></div></div></div><br class="figure-break" /><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">IP Address</code> - The
	    <acronym class="acronym">IPv4</acronym> address assigned to this computer.
	    The address must be unique and not already in use by
	    another piece of equipment on the local network.</p></li><li class="listitem"><p><code class="literal">Subnet Mask</code> - The subnet mask for
	    the network.</p></li><li class="listitem"><p><code class="literal">Default Router</code> - The
	    <acronym class="acronym">IP</acronym> address of the network's default
	    gateway.</p></li></ul></div><p>The next screen will ask if the interface should be
	configured for <acronym class="acronym">IPv6</acronym>.  If
	<acronym class="acronym">IPv6</acronym> is available and desired, choose
	<span class="guibutton">[ Yes ]</span> to select it.</p><div class="figure"><a id="bsdinstall-net-ipv6"></a><div class="figure-title">Figure 2.56. Choose IPv6 Networking</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-ipv6.png" alt="Choose IPv6 Networking" /></div></div></div><br class="figure-break" /><p><acronym class="acronym">IPv6</acronym> also has two methods of
	configuration.    StateLess Address AutoConfiguration
	(<acronym class="acronym">SLAAC</acronym>) will automatically request the
	correct configuration information from a local router.  Refer
	to <a class="link" href="http://tools.ietf.org/html/rfc4862" target="_top">rfc4862</a>
	for more information.  Static configuration requires manual
	entry of network information.</p><p>If an <acronym class="acronym">IPv6</acronym> router is available, select
	<span class="guibutton">[ Yes ]</span> in the next menu to
	automatically configure the network interface.  The installer
	will appear to pause for a minute or so as it finds the router
	and obtains the addressing information for the system.</p><div class="figure"><a id="bsdinstall-net-ipv6-slaac"></a><div class="figure-title">Figure 2.57. Choose IPv6 SLAAC Configuration</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-slaac.png" alt="Choose IPv6 SLAAC Configuration" /></div></div></div><br class="figure-break" /><p>If an <acronym class="acronym">IPv6</acronym> router is not available,
	select <span class="guibutton">[ No ]</span> and input the
	following addressing information in this menu:</p><div class="figure"><a id="bsdinstall-net-ipv6-static"></a><div class="figure-title">Figure 2.58. IPv6 Static Configuration</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-interface-ipv6-static.png" alt="IPv6 Static Configuration" /></div></div></div><br class="figure-break" /><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">IPv6 Address</code> - The
	    <acronym class="acronym">IPv6</acronym> address assigned to this computer.
	    The address must be unique and not already in use by
	    another piece of equipment on the local network.</p></li><li class="listitem"><p><code class="literal">Default Router</code> - The
	    <acronym class="acronym">IPv6</acronym> address of the network's default
	    gateway.</p></li></ul></div><p>The last network configuration menu is used to configure
	the Domain Name System (<acronym class="acronym">DNS</acronym>) resolver,
	which converts hostnames to and from network addresses.  If
	<acronym class="acronym">DHCP</acronym> or <acronym class="acronym">SLAAC</acronym> was used
	to autoconfigure the network interface, the <code class="literal">Resolver
	  Configuration</code> values may already be filled in.
	Otherwise, enter the local network's domain name in the
	<code class="literal">Search</code> field.  <code class="literal">DNS #1</code>
	and <code class="literal">DNS #2</code> are the <acronym class="acronym">IPv4</acronym>
	and/or <acronym class="acronym">IPv6</acronym> addresses of the
	<acronym class="acronym">DNS</acronym> servers.  At least one
	<acronym class="acronym">DNS</acronym> server is required.</p><div class="figure"><a id="bsdinstall-net-dns-config"></a><div class="figure-title">Figure 2.59. DNS Configuration</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-configure-network-ipv4-dns.png" alt="DNS Configuration" /></div></div></div><br class="figure-break" /><p>Once the interface is configured, select a mirror site
	that is located in the same region of the world as the
	computer on which FreeBSD is being installed.  Files can be
	retrieved more quickly when the mirror is close to the
	target computer, reducing installation time.</p><div class="figure"><a id="bsdinstall-netinstall-mirror"></a><div class="figure-title">Figure 2.60. Choosing a Mirror</div><div class="figure-contents"><div class="mediaobject"><img src="bsdinstall/bsdinstall-netinstall-mirrorselect.png" alt="Choosing a Mirror" /></div></div></div><br class="figure-break" /></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bsdinstall-install-trouble"></a>2.10. Troubleshooting</h2></div></div></div><a id="idp50022392" class="indexterm"></a><p>This section covers basic installation
      troubleshooting, such as common problems people have
      reported.</p><p>Check the Hardware Notes (<a class="link" href="../../../../releases/index.html" target="_top">https://www.freebsd.org/releases/index.html</a>)
      document for the version of FreeBSD to make sure the hardware is
      supported.  If the hardware is supported and lock-ups or other
      problems occur, build a custom kernel using the instructions in
      <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a> to add support for devices which
      are not present in the <code class="filename">GENERIC</code> kernel.  The
      default kernel assumes that most hardware devices are in their
      factory default configuration in terms of
      <acronym class="acronym">IRQ</acronym>s, <acronym class="acronym">I/O</acronym> addresses, and
      <acronym class="acronym">DMA</acronym> channels.  If the hardware has been
      reconfigured, a custom kernel configuration file can tell FreeBSD
      where to find things.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some installation problems can be avoided or alleviated by
	updating the firmware on various hardware components, most
	notably the motherboard.  Motherboard firmware is usually
	referred to as the <acronym class="acronym">BIOS</acronym>.  Most motherboard
	and computer manufacturers have a website for upgrades and
	upgrade information.</p><p xmlns="http://www.w3.org/1999/xhtml">Manufacturers generally advise against upgrading the
	motherboard <acronym class="acronym">BIOS</acronym> unless there is a good
	reason for doing so, like a critical update.  The upgrade
	process <span class="emphasis"><em>can</em></span> go wrong, leaving the
	<acronym class="acronym">BIOS</acronym> incomplete and the computer
	inoperative.</p></div><p>If the system hangs while probing hardware during boot, or
      it behaves strangely during install, <acronym class="acronym">ACPI</acronym> may
      be the culprit.  FreeBSD makes extensive use of the system
      <acronym class="acronym">ACPI</acronym> service on the i386 and
      amd64 platforms to aid in system configuration
      if it is detected during boot.  Unfortunately, some bugs still
      exist in both the <acronym class="acronym">ACPI</acronym> driver and within
      system motherboards and <acronym class="acronym">BIOS</acronym> firmware.
      <acronym class="acronym">ACPI</acronym> can be disabled by setting the
      <code class="literal">hint.acpi.0.disabled</code> hint in the third stage
      boot loader:</p><pre class="screen"><strong class="userinput"><code>set hint.acpi.0.disabled="1"</code></strong></pre><p>This is reset each time the system is booted, so it is
      necessary to add <code class="literal">hint.acpi.0.disabled="1"</code> to
      the file <code class="filename">/boot/loader.conf</code>.  More
      information about the boot loader can be found in <a class="xref" href="#boot-synopsis" title="12.1. Synopsis">Section 12.1, &#8220;Synopsis&#8221;</a>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-live-cd"></a>2.11. Using the Live <acronym class="acronym">CD</acronym></h2></div></div></div><p>The welcome menu of <span class="application">bsdinstall</span>,
      shown in <a class="xref" href="#bsdinstall-choose-mode" title="Figure 2.3. Welcome Menu">Figure 2.3, &#8220;Welcome Menu&#8221;</a>, provides a
      <span class="guibutton">[ Live CD ]</span> option.  This
      is useful for those who are still wondering whether FreeBSD is the
      right operating system for them and want to test some of the
      features before installing.</p><p>The following points should be noted before using the
      <span class="guibutton">[ Live CD ]</span>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>To gain access to the system, authentication is
	  required.  The username is <code class="systemitem">root</code> and the password is
	  blank.</p></li><li class="listitem"><p>As the system runs directly from the installation media,
	  performance will be significantly slower than that of a
	  system installed on a hard disk.</p></li><li class="listitem"><p>This option only provides a command prompt and not a
	  graphical interface.</p></li></ul></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="basics"></a>Chapter 3. FreeBSD Basics</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#basics-synopsis">3.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#consoles">3.2. Virtual Consoles and Terminals</a></span></dt><dt><span class="sect1"><a href="#users-synopsis">3.3. Users and Basic Account Management</a></span></dt><dt><span class="sect1"><a href="#permissions">3.4. Permissions</a></span></dt><dt><span class="sect1"><a href="#dirstructure">3.5. Directory Structure</a></span></dt><dt><span class="sect1"><a href="#disk-organization">3.6. Disk Organization</a></span></dt><dt><span class="sect1"><a href="#mount-unmount">3.7. Mounting and Unmounting File Systems</a></span></dt><dt><span class="sect1"><a href="#basics-processes">3.8. Processes and Daemons</a></span></dt><dt><span class="sect1"><a href="#shells">3.9. Shells</a></span></dt><dt><span class="sect1"><a href="#editors">3.10. Text Editors</a></span></dt><dt><span class="sect1"><a href="#basics-devices">3.11. Devices and Device Nodes</a></span></dt><dt><span class="sect1"><a href="#basics-more-information">3.12. Manual Pages</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-synopsis"></a>3.1. Synopsis</h2></div></div></div><p>This chapter covers the basic commands and functionality of
      the FreeBSD operating system.  Much of this material is relevant
      for any <span class="trademark">UNIX</span>®-like operating system.  New FreeBSD users are
      encouraged to read through this chapter carefully.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to use and configure virtual consoles.</p></li><li class="listitem"><p>How to create and manage users and groups on
	  FreeBSD.</p></li><li class="listitem"><p>How <span class="trademark">UNIX</span>® file permissions and FreeBSD file flags
	  work.</p></li><li class="listitem"><p>The default FreeBSD file system layout.</p></li><li class="listitem"><p>The FreeBSD disk organization.</p></li><li class="listitem"><p>How to mount and unmount file systems.</p></li><li class="listitem"><p>What processes, daemons, and signals are.</p></li><li class="listitem"><p>What a shell is, and how to change the default login
	  environment.</p></li><li class="listitem"><p>How to use basic text editors.</p></li><li class="listitem"><p>What devices and device nodes are.</p></li><li class="listitem"><p>How to read manual pages for more information.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="consoles"></a>3.2. Virtual Consoles and Terminals</h2></div></div></div><a id="idp50071288" class="indexterm"></a><a id="idp50072056" class="indexterm"></a><a id="idp50072824" class="indexterm"></a><p>Unless FreeBSD has been configured to automatically start a
      graphical environment during startup, the system will boot
      into a command line login prompt, as seen in this
      example:</p><pre class="screen">FreeBSD/amd64 (pc3.example.org) (ttyv0)

login:</pre><p>The first line contains some information about the system.
      The <code class="literal">amd64</code> indicates that the system in this
      example is running a 64-bit version of FreeBSD.  The hostname is
      <code class="systemitem">pc3.example.org</code>, and
      <code class="filename">ttyv0</code> indicates that this is the
      <span class="quote">&#8220;<span class="quote">system console</span>&#8221;</span>.  The second line is the login
      prompt.</p><p>Since FreeBSD is a multiuser system, it needs some way to
      distinguish between different users.  This is accomplished by
      requiring every user to log into the system before gaining
      access to the programs on the system.  Every user has a
      unique name <span class="quote">&#8220;<span class="quote">username</span>&#8221;</span> and a personal
      <span class="quote">&#8220;<span class="quote">password</span>&#8221;</span>.</p><p>To log into the system console, type the username that
      was configured during system installation, as described in
      <a class="xref" href="#bsdinstall-addusers" title="2.8.5. Add Users">Section 2.8.5, &#8220;Add Users&#8221;</a>, and press
      <span class="keycap"><strong>Enter</strong></span>.  Then enter the password associated
      with the username and press <span class="keycap"><strong>Enter</strong></span>.  The
      password is <span class="emphasis"><em>not echoed</em></span> for security
      reasons.</p><p>Once the correct password is input, the message of the
      day (<acronym class="acronym">MOTD</acronym>) will be displayed followed
      by a command prompt.  Depending upon the shell that was
      selected when the user was created, this prompt will be a
      <code class="literal">#</code>, <code class="literal">$</code>, or
      <code class="literal">%</code> character.  The prompt indicates that
      the user is now logged into the FreeBSD system console and ready
      to try the available commands.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="consoles-virtual"></a>3.2.1. Virtual Consoles</h3></div></div></div><p>While the system console can be used to interact with
	the system, a user working from the command line at the
	keyboard of a FreeBSD system will typically instead log into a
	virtual console.  This is because system messages are
	configured by default to display on the system console.
	These messages will appear over the command or file that the
	user is working on, making it difficult to concentrate on
	the work at hand.</p><p>By default, FreeBSD is configured to provide several virtual
	consoles for inputting commands.  Each virtual console has
	its own login prompt and shell and it is easy to switch
	between virtual consoles.  This essentially provides the
	command line equivalent of having several windows open at the
	same time in a graphical environment.</p><p>The key combinations
	<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span>
	through
	<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F8</strong></span>
	have been reserved by FreeBSD for switching between virtual
	consoles.  Use
	<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span>
	to switch to the system console
	(<code class="filename">ttyv0</code>),
	<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F2</strong></span>
	to access the first virtual console
	(<code class="filename">ttyv1</code>),
	<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F3</strong></span>
	to access the second virtual console
	(<code class="filename">ttyv2</code>), and so on.
	When using <span class="application">Xorg</span> as a graphical
	console, the combination becomes <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span> to return to a text-based virtual console.</p><p>When switching from one console to the next, FreeBSD
	manages the screen output.  The result is an illusion of
	having multiple virtual screens and keyboards that can be used
	to type commands for FreeBSD to run.  The programs that are
	launched in one virtual console do not stop running when
	the user switches to a different virtual console.</p><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kbdcontrol&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kbdcontrol</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vidcontrol&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vidcontrol</span>(1)</span></a>,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=atkbd&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">atkbd</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syscons&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syscons</span>(4)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vt</span>(4)</span></a> for a more
	technical description of the FreeBSD console and its keyboard
	drivers.</p><p>In FreeBSD, the number of available virtual consoles is
	configured in this section of
	<code class="filename">/etc/ttys</code>:</p><pre class="programlisting"># name    getty                         type  status comments
#
ttyv0   "/usr/libexec/getty Pc"         xterm   on  secure
# Virtual terminals
ttyv1   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv2   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv3   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv4   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv5   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv6   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv7   "/usr/libexec/getty Pc"         xterm   on  secure
ttyv8   "/usr/X11R6/bin/xdm -nodaemon"  xterm   off secure</pre><p>To disable a virtual console, put a comment symbol
	(<code class="literal">#</code>) at the beginning of the line
	representing that virtual console.  For example, to reduce the
	number of available virtual consoles from eight to four, put a
	<code class="literal">#</code> in front of the last four lines
	representing virtual consoles <code class="filename">ttyv5</code>
	through <code class="filename">ttyv8</code>.
	<span class="emphasis"><em>Do not</em></span> comment out the line for the
	system console <code class="filename">ttyv0</code>.  Note that the last
	virtual console (<code class="filename">ttyv8</code>) is used to access
	the graphical environment if <span class="application">Xorg</span>
	has been installed and configured as described in
	<a class="xref" href="#x11" title="Chapter 5. The X Window System">Chapter 5, <em>The X Window System</em></a>.</p><p>For a detailed description of every column in this file
	and the available options for the virtual consoles, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ttys&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ttys</span>(5)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="consoles-singleuser"></a>3.2.2. Single User Mode</h3></div></div></div><p>The FreeBSD boot menu provides an option labelled as
	<span class="quote">&#8220;<span class="quote">Boot Single User</span>&#8221;</span>.  If this option is selected,
	the system will boot into a special mode known as
	<span class="quote">&#8220;<span class="quote">single user mode</span>&#8221;</span>.  This mode is typically used
	to repair a system that will not boot or to reset the
	<code class="systemitem">root</code> password when
	it is not known.  While in single user mode, networking and
	other virtual consoles are not available.  However, full
	<code class="systemitem">root</code> access to the
	system is available, and by default, the
	<code class="systemitem">root</code> password is not
	needed.  For these reasons, physical access to the keyboard is
	needed to boot into this mode and determining who has physical
	access to the keyboard is something to consider when securing
	a FreeBSD system.</p><p>The settings which control single user mode are found in
	this section of <code class="filename">/etc/ttys</code>:</p><pre class="programlisting"># name  getty                           type  status  comments
#
# If console is marked "insecure", then init will ask for the root password
# when going to single-user mode.
console none                            unknown  off  secure</pre><p>By default, the status is set to
	<code class="literal">secure</code>.  This assumes that who has physical
	access to the keyboard is either not important or it is
	controlled by a physical security policy.  If this setting is
	changed to <code class="literal">insecure</code>, the assumption is that
	the environment itself is insecure because anyone can access
	the keyboard.  When this line is changed to
	<code class="literal">insecure</code>, FreeBSD will prompt for the
	<code class="systemitem">root</code> password when a
	user selects to boot into single user mode.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="emphasis"><em>Be careful when changing this setting to
	    <code class="literal">insecure</code></em></span>!  If the
	  <code class="systemitem">root</code> password is
	  forgotten, booting into single user mode is still possible,
	  but may be difficult for someone who is not familiar with
	  the FreeBSD booting process.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="consoles-vidcontrol"></a>3.2.3. Changing Console Video Modes</h3></div></div></div><p>The FreeBSD console default video mode may be adjusted to
	1024x768, 1280x1024, or any other size supported by the
	graphics chip and monitor.  To use a different video mode
	load the <code class="literal">VESA</code> module:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload vesa</code></strong></pre><p>To determine which video modes are supported by the
	hardware, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vidcontrol&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vidcontrol</span>(1)</span></a>.  To get a list of supported
	video modes issue the following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>vidcontrol -i mode</code></strong></pre><p>The output of this command lists the video modes that are
	supported by the hardware.  To select a new video mode,
	specify the mode using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vidcontrol&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vidcontrol</span>(1)</span></a> as the
	<code class="systemitem">root</code> user:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>vidcontrol MODE_279</code></strong></pre><p>If the new video mode is acceptable, it can be permanently
	set on boot by adding it to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">allscreens_flags="MODE_279"</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="users-synopsis"></a>3.3. Users and Basic Account Management</h2></div></div></div><p>FreeBSD allows multiple users to use the computer at the same
      time.  While only one user can sit in front of the screen and
      use the keyboard at any one time, any number of users can log
      in to the system through the network.  To use the system, each
      user should have their own user account.</p><p>This chapter describes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The different types of user accounts on a
	  FreeBSD system.</p></li><li class="listitem"><p>How to add, remove, and modify user accounts.</p></li><li class="listitem"><p>How to set limits to control the
	  resources that users and
	  groups are allowed to access.</p></li><li class="listitem"><p>How to create groups and add users as members of a
	  group.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-introduction"></a>3.3.1. Account Types</h3></div></div></div><p>Since all access to the FreeBSD system is achieved using
	accounts and all processes are run by users, user and account
	management is important.</p><p>There are three main types of accounts: system accounts,
	user accounts, and the superuser account.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-system"></a>3.3.1.1. System Accounts</h4></div></div></div><a id="idp50142072" class="indexterm"></a><p>System accounts are used to run services such as DNS,
	  mail, and web servers.  The reason for this is security; if
	  all services ran as the superuser, they could act without
	  restriction.</p><a id="idp50143608" class="indexterm"></a><a id="idp50145016" class="indexterm"></a><p>Examples of system accounts are
	  <code class="systemitem">daemon</code>,
	  <code class="systemitem">operator</code>,
	  <code class="systemitem">bind</code>,
	  <code class="systemitem">news</code>, and
	  <code class="systemitem">www</code>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Care must be taken when using the operator group, as
	    unintended superuser-like access privileges may be
	    granted, including but not limited to shutdown, reboot,
	    and access to all items in <code class="filename">/dev</code>
	    in the group.</p></div><a id="idp50162808" class="indexterm"></a><p><code class="systemitem">nobody</code> is the
	  generic unprivileged system account.  However, the more
	  services that use
	  <code class="systemitem">nobody</code>, the more
	  files and processes that user will become associated with,
	  and hence the more privileged that user becomes.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-user"></a>3.3.1.2. User Accounts</h4></div></div></div><a id="idp50166520" class="indexterm"></a><p>User accounts are assigned to real people and are used
	  to log in and use the system.  Every person accessing the
	  system should have a unique user account.  This allows the
	  administrator to find out who is doing what and prevents
	  users from clobbering the settings of other users.</p><p>Each user can set up their own environment to
	  accommodate their use of the system, by configuring their
	  default shell, editor, key bindings, and language
	  settings.</p><p>Every user account on a FreeBSD system has certain
	  information associated with it:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">User name</span></dt><dd><p>The user name is typed at the
		<code class="prompt">login:</code> prompt.  Each user must have
		a unique user name.  There are a number of rules for
		creating valid user names which are documented in
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(5)</span></a>.  It is recommended to use user names
		that consist of eight or fewer, all lower case
		characters in order to maintain backwards
		compatibility with applications.</p></dd><dt><span class="term">Password</span></dt><dd><p>Each account has an associated password.</p></dd><dt><span class="term">User ID (<acronym class="acronym">UID</acronym>)</span></dt><dd><p>The User ID (<acronym class="acronym">UID</acronym>) is a number
		used to uniquely identify the user to the FreeBSD system.
		Commands that allow a user name to be specified will
		first convert it to the <acronym class="acronym">UID</acronym>.  It is
		recommended to use a UID less than 65535, since higher
		values may cause compatibility issues with some
		software.</p></dd><dt><span class="term">Group ID (<acronym class="acronym">GID</acronym>)</span></dt><dd><p>The Group ID (<acronym class="acronym">GID</acronym>) is a number
		used to uniquely identify the primary group that the
		user belongs to.  Groups are a mechanism for
		controlling access to resources based on a user's
		<acronym class="acronym">GID</acronym> rather than their
		<acronym class="acronym">UID</acronym>.  This can significantly reduce
		the size of some configuration files and allows users
		to be members of more than one group.  It is
		recommended to use a GID of 65535 or lower as higher
		GIDs may break some software.</p></dd><dt><span class="term">Login class</span></dt><dd><p>Login classes are an extension to the group
		mechanism that provide additional flexibility when
		tailoring the system to different users.  Login
		classes are discussed further in
		<a class="xref" href="#users-limiting" title="13.13.1. Configuring Login Classes">Section 13.13.1, &#8220;Configuring Login Classes&#8221;</a>.</p></dd><dt><span class="term">Password change time</span></dt><dd><p>By default, passwords do not expire.  However,
		password expiration can be enabled on a per-user
		basis, forcing some or all users to change their
		passwords after a certain amount of time has
		elapsed.</p></dd><dt><span class="term">Account expiration time</span></dt><dd><p>By default, FreeBSD does not expire accounts.  When
		creating accounts that need a limited lifespan, such
		as student accounts in a school, specify the account
		expiry date using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>.  After the expiry time
		has elapsed, the account cannot be used to log in to
		the system, although the account's directories and
		files will remain.</p></dd><dt><span class="term">User's full name</span></dt><dd><p>The user name uniquely identifies the account to
		FreeBSD, but does not necessarily reflect the user's real
		name.  Similar to a comment, this information can
		contain spaces, uppercase characters, and be more
		than 8 characters long.</p></dd><dt><span class="term">Home directory</span></dt><dd><p>The home directory is the full path to a directory
		on the system.  This is the user's starting directory
		when the user logs in.  A common convention is to put
		all user home directories under <code class="filename"><em class="replaceable"><code>/home/username</code></em></code>
		or <code class="filename"><em class="replaceable"><code>/usr/home/username</code></em></code>.
		Each user stores their personal files and
		subdirectories in their own home directory.</p></dd><dt><span class="term">User shell</span></dt><dd><p>The shell provides the user's default environment
		for interacting with the system.  There are many
		different kinds of shells and experienced users will
		have their own preferences, which can be reflected in
		their account settings.</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-superuser"></a>3.3.1.3. The Superuser Account</h4></div></div></div><a id="idp50212088" class="indexterm"></a><p>The superuser account, usually called
	  <code class="systemitem">root</code>, is used to
	  manage the system with no limitations on privileges.  For
	  this reason, it should not be used for day-to-day tasks like
	  sending and receiving mail, general exploration of the
	  system, or programming.</p><p>The superuser, unlike other user accounts, can operate
	  without limits, and misuse of the superuser account may
	  result in spectacular disasters.  User accounts are unable
	  to destroy the operating system by mistake, so it is
	  recommended to login as a user account and to only become
	  the superuser when a command requires extra
	  privilege.</p><p>Always double and triple-check any commands issued as
	  the superuser, since an extra space or missing character can
	  mean irreparable data loss.</p><p>There are several ways to gain superuser privilege.
	  While one can log in as
	  <code class="systemitem">root</code>, this is
	  highly discouraged.</p><p>Instead, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> to become the superuser.  If
	  <code class="literal">-</code> is specified when running this command,
	  the user will also inherit the root user's environment.  The
	  user running this command must be in the
	  <code class="systemitem">wheel</code> group or
	  else the command will fail.  The user must also know the
	  password for the
	  <code class="systemitem">root</code> user
	  account.</p><p>In this example, the user only becomes superuser in
	  order to run <code class="command">make install</code> as this step
	  requires superuser privilege.  Once the command completes,
	  the user types <code class="command">exit</code> to leave the
	  superuser account and return to the privilege of their user
	  account.</p><div class="example"><a id="idp50223608"></a><div class="example-title">Example 3.1. Install a Program As the Superuser</div><div class="example-contents"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>configure</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>su -</code></strong>
Password:
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong>
<code class="prompt">%</code></pre></div></div><br class="example-break" /><p>The built-in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> framework works well for single
	  systems or small networks with just one system
	  administrator.  An alternative is to install the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/sudo/pkg-descr">security/sudo</a> package or port.  This
	  software provides activity logging and allows the
	  administrator to configure which users can run which
	  commands as the superuser.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-modifying"></a>3.3.2. Managing Accounts</h3></div></div></div><a id="idp50231288" class="indexterm"></a><p>FreeBSD provides a variety of different commands to manage
	user accounts.  The most common commands are summarized in
	<a class="xref" href="#users-modifying-utilities" title="Table 3.1. Utilities for Managing User Accounts">Table 3.1, &#8220;Utilities for Managing User Accounts&#8221;</a>, followed by some
	examples of their usage.  See the manual page for each utility
	for more details and usage examples.</p><div class="table"><a id="users-modifying-utilities"></a><div class="table-title">Table 3.1. Utilities for Managing User Accounts</div><div class="table-contents"><table class="table" summary="Utilities for Managing User Accounts" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Command</th><th>Summary</th></tr></thead><tbody><tr><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a></td><td>The recommended command-line application for
		adding new users.</td></tr><tr><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rmuser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rmuser</span>(8)</span></a></td><td>The recommended command-line application for
		removing users.</td></tr><tr><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chpass</span>(1)</span></a></td><td>A flexible tool for changing user database
		information.</td></tr><tr><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a></td><td>The command-line tool to change user
		passwords.</td></tr><tr><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a></td><td>A powerful and flexible tool for modifying all
		aspects of user accounts.</td></tr></tbody></table></div></div><br class="table-break" /><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-adduser"></a>3.3.2.1. <code class="command">adduser</code></h4></div></div></div><a id="idp50255224" class="indexterm"></a><a id="idp50256376" class="indexterm"></a><a id="idp50261368" class="indexterm"></a><a id="idp50262264" class="indexterm"></a><p>The recommended program for adding new users is
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a>.  When a new user is added, this program
	  automatically updates <code class="filename">/etc/passwd</code> and
	  <code class="filename">/etc/group</code>.  It also creates a home
	  directory for the new user, copies in the default
	  configuration files from
	  <code class="filename">/usr/share/skel</code>, and can optionally
	  mail the new user a welcome message.  This utility must be
	  run as the superuser.</p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a> utility is interactive and walks
	  through the steps for creating a new user account.  As seen
	  in <a class="xref" href="#users-modifying-adduser" title="Example 3.2. Adding a User on FreeBSD">Example 3.2, &#8220;Adding a User on FreeBSD&#8221;</a>, either input
	  the required information or press <span class="keycap"><strong>Return</strong></span>
	  to accept the default value shown in square brackets.
	  In this example, the user has been invited into the
	  <code class="systemitem">wheel</code> group,
	  allowing them to become the superuser with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a>.
	  When finished, the utility will prompt to either
	  create another user or to exit.</p><div class="example"><a id="users-modifying-adduser"></a><div class="example-title">Example 3.2. Adding a User on FreeBSD</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>adduser</code></strong>
Username: <strong class="userinput"><code>jru</code></strong>
Full name: <strong class="userinput"><code>J. Random User</code></strong>
Uid (Leave empty for default):
Login group [jru]:
Login group is jru. Invite jru into other groups? []: <strong class="userinput"><code>wheel</code></strong>
Login class [default]:
Shell (sh csh tcsh zsh nologin) [sh]: <strong class="userinput"><code>zsh</code></strong>
Home directory [/home/jru]:
Home directory permissions (Leave empty for default):
Use password-based authentication? [yes]:
Use an empty password? (yes/no) [no]:
Use a random password? (yes/no) [no]:
Enter password:
Enter password again:
Lock out the account after creation? [no]:
Username   : jru
Password   : ****
Full Name  : J. Random User
Uid        : 1001
Class      :
Groups     : jru wheel
Home       : /home/jru
Shell      : /usr/local/bin/zsh
Locked     : no
OK? (yes/no): <strong class="userinput"><code>yes</code></strong>
adduser: INFO: Successfully added (jru) to the user database.
Add another user? (yes/no): <strong class="userinput"><code>no</code></strong>
Goodbye!
<code class="prompt">#</code></pre></div></div><br class="example-break" /><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Since the password is not echoed when typed, be
	    careful to not mistype the password when creating the user
	    account.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-rmuser"></a>3.3.2.2. <code class="command">rmuser</code></h4></div></div></div><a id="idp49922808" class="indexterm"></a><a id="idp49923704" class="indexterm"></a><p>To completely remove a user from the system, run
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rmuser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rmuser</span>(8)</span></a> as the superuser.  This command performs the
	  following steps:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Removes the user's <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crontab</span>(1)</span></a> entry, if one
	      exists.</p></li><li class="step"><p>Removes any <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=at&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">at</span>(1)</span></a> jobs belonging to the
	      user.</p></li><li class="step"><p>Kills all processes owned by the user.</p></li><li class="step"><p>Removes the user from the system's local password
	      file.</p></li><li class="step"><p>Optionally removes the user's home directory, if it
	      is owned by the user.</p></li><li class="step"><p>Removes the incoming mail files belonging to the
	      user from <code class="filename">/var/mail</code>.</p></li><li class="step"><p>Removes all files owned by the user from temporary
	      file storage areas such as
	      <code class="filename">/tmp</code>.</p></li><li class="step"><p>Finally, removes the username from all groups to
	      which it belongs in <code class="filename">/etc/group</code>.  If
	      a group becomes empty and the group name is the same as
	      the username, the group is removed.  This complements
	      the per-user unique groups created by
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a>.</p></li></ol></div><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rmuser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rmuser</span>(8)</span></a> cannot be used to remove superuser
	  accounts since that is almost always an indication of
	  massive destruction.</p><p>By default, an interactive mode is used, as shown
	  in the following example.</p><div class="example"><a id="idp50277496"></a><div class="example-title">Example 3.3. <code class="command">rmuser</code> Interactive Account
	    Removal</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rmuser jru</code></strong>
Matching password entry:
jru:*:1001:1001::0:0:J. Random User:/home/jru:/usr/local/bin/zsh
Is this the entry you wish to remove? <strong class="userinput"><code>y</code></strong>
Remove user's home directory (/home/jru)? <strong class="userinput"><code>y</code></strong>
Removing user (jru): mailspool home passwd.
<code class="prompt">#</code></pre></div></div><br class="example-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-chpass"></a>3.3.2.3. <code class="command">chpass</code></h4></div></div></div><a id="idp50285688" class="indexterm"></a><p>Any user can use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chpass</span>(1)</span></a> to change their default
	  shell and personal information associated with their user
	  account.  The superuser can use this utility to change
	  additional account information for any user.</p><p>When passed no options, aside from an optional username,
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chpass</span>(1)</span></a> displays an editor containing user
	  information.  When the user exits from the editor, the user
	  database is updated with the new information.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">This utility will prompt for the user's password when
	    exiting the editor, unless the utility is run as the
	    superuser.</p></div><p>In <a class="xref" href="#users-modifying-chpass-su" title="Example 3.4. Using chpass as Superuser">Example 3.4, &#8220;Using <code class="command">chpass</code> as
	    Superuser&#8221;</a>, the
	  superuser has typed <code class="command">chpass jru</code> and is
	  now viewing the fields that can be changed for this user.
	  If <code class="systemitem">jru</code> runs this
	  command instead, only the last six fields will be displayed
	  and available for editing.  This is shown in
	  <a class="xref" href="#users-modifying-chpass-ru" title="Example 3.5. Using chpass as Regular User">Example 3.5, &#8220;Using <code class="command">chpass</code> as Regular
	    User&#8221;</a>.</p><div class="example"><a id="users-modifying-chpass-su"></a><div class="example-title">Example 3.4. Using <code class="command">chpass</code> as
	    Superuser</div><div class="example-contents"><pre class="screen">#Changing user database information for jru.
Login: jru
Password: *
Uid [#]: 1001
Gid [# or name]: 1001
Change [month day year]:
Expire [month day year]:
Class:
Home directory: /home/jru
Shell: /usr/local/bin/zsh
Full Name: J. Random User
Office Location:
Office Phone:
Home Phone:
Other information:</pre></div></div><br class="example-break" /><div class="example"><a id="users-modifying-chpass-ru"></a><div class="example-title">Example 3.5. Using <code class="command">chpass</code> as Regular
	    User</div><div class="example-contents"><pre class="screen">#Changing user database information for jru.
Shell: /usr/local/bin/zsh
Full Name: J. Random User
Office Location:
Office Phone:
Home Phone:
Other information:</pre></div></div><br class="example-break" /><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The commands <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chfn&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chfn</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chsh</span>(1)</span></a> are links
	    to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chpass</span>(1)</span></a>, as are <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypchpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypchpass</span>(1)</span></a>,
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypchfn&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypchfn</span>(1)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypchsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypchsh</span>(1)</span></a>.  Since
	    <acronym class="acronym">NIS</acronym> support is automatic, specifying
	    the <code class="literal">yp</code> before the command is not
	    necessary.  How to configure NIS is covered in <a class="xref" href="#network-servers" title="Chapter 29. Network Servers">Chapter 29, <em>Network Servers</em></a>.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-passwd"></a>3.3.2.4. <code class="command">passwd</code></h4></div></div></div><a id="idp50339704" class="indexterm"></a><a id="idp50340600" class="indexterm"></a><p>Any user can easily change their password using
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a>.  To prevent accidental or unauthorized
	  changes, this command will prompt for the user's original
	  password before a new password can be set:</p><div class="example"><a id="idp50342904"></a><div class="example-title">Example 3.6. Changing Your Password</div><div class="example-contents"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>passwd</code></strong>
Changing local password for jru.
Old password:
New password:
Retype new password:
passwd: updating the database...
passwd: done</pre></div></div><br class="example-break" /><p>The superuser can change any user's password by
	  specifying the username when running <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a>.  When
	  this utility is run as the superuser, it will not prompt for
	  the user's current password.  This allows the password to be
	  changed when a user cannot remember the original
	  password.</p><div class="example"><a id="idp50345848"></a><div class="example-title">Example 3.7. Changing Another User's Password as the
	    Superuser</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>passwd jru</code></strong>
Changing local password for jru.
New password:
Retype new password:
passwd: updating the database...
passwd: done</pre></div></div><br class="example-break" /><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">As with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chpass</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=yppasswd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">yppasswd</span>(1)</span></a> is a link to
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a>, so <acronym class="acronym">NIS</acronym> works with
	    either command.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-pw"></a>3.3.2.5. <code class="command">pw</code></h4></div></div></div><a id="idp50356344" class="indexterm"></a><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> utility can create, remove,
	  modify, and display users and groups.  It functions as a
	  front end to the system user and group files.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>
	  has a very powerful set of command line options that make it
	  suitable for use in shell scripts, but new users may find it
	  more complicated than the other commands presented in this
	  section.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-groups"></a>3.3.3. Managing Groups</h3></div></div></div><a id="idp50360184" class="indexterm"></a><a id="idp50360952" class="indexterm"></a><a id="idp50361848" class="indexterm"></a><p>A group is a list of users.  A group is identified by its
	group name and <acronym class="acronym">GID</acronym>.  In FreeBSD, the kernel
	uses the <acronym class="acronym">UID</acronym> of a process, and the list of
	groups it belongs to, to determine what the process is allowed
	to do.  Most of the time, the <acronym class="acronym">GID</acronym> of a user
	or process usually means the first group in the list.</p><p>The group name to <acronym class="acronym">GID</acronym> mapping is listed
	in <code class="filename">/etc/group</code>.  This is a plain text file
	with four colon-delimited fields.  The first field is the
	group name, the second is the encrypted password, the third
	the <acronym class="acronym">GID</acronym>, and the fourth the comma-delimited
	list of members.  For a more complete description of the
	syntax, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=group&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">group</span>(5)</span></a>.</p><p>The superuser can modify <code class="filename">/etc/group</code>
	using a text editor.  Alternatively, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> can be used to
	add and edit groups.  For example, to add a group called
	<code class="systemitem">teamtwo</code> and then
	confirm that it exists:</p><div class="example"><a id="idp50369144"></a><div class="example-title">Example 3.8. Adding a Group Using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupadd teamtwo</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pw groupshow teamtwo</code></strong>
teamtwo:*:1100:</pre></div></div><br class="example-break" /><p>In this example, <code class="literal">1100</code> is the
	<acronym class="acronym">GID</acronym> of
	<code class="systemitem">teamtwo</code>.  Right
	now, <code class="systemitem">teamtwo</code> has no
	members.  This command will add
	<code class="systemitem">jru</code> as a member of
	<code class="systemitem">teamtwo</code>.</p><div class="example"><a id="idp50375544"></a><div class="example-title">Example 3.9. Adding User Accounts to a New Group Using
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod teamtwo -M jru</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pw groupshow teamtwo</code></strong>
teamtwo:*:1100:jru</pre></div></div><br class="example-break" /><p>The argument to <code class="option">-M</code> is a comma-delimited
	list of users to be added to a new (empty) group or to replace
	the members of an existing group.  To the user, this group
	membership is different from (and in addition to) the user's
	primary group listed in the password file.  This means that
	the user will not show up as a member when using
	<code class="option">groupshow</code> with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>, but will show up
	when the information is queried via <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=id&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">id</span>(1)</span></a> or a similar
	tool.  When <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> is used to add a user to a group, it
	only manipulates <code class="filename">/etc/group</code> and does not
	attempt to read additional data from
	<code class="filename">/etc/passwd</code>.</p><div class="example"><a id="idp50382968"></a><div class="example-title">Example 3.10. Adding a New Member to a Group Using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod teamtwo -m db</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pw groupshow teamtwo</code></strong>
teamtwo:*:1100:jru,db</pre></div></div><br class="example-break" /><p>In this example, the argument to <code class="option">-m</code> is a
	comma-delimited list of users who are to be added to the
	group.  Unlike the previous example, these users are appended
	to the group and do not replace existing users in the
	group.</p><div class="example"><a id="idp50403320"></a><div class="example-title">Example 3.11. Using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=id&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">id</span>(1)</span></a> to Determine Group Membership</div><div class="example-contents"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>id jru</code></strong>
uid=1001(jru) gid=1001(jru) groups=1001(jru), 1100(teamtwo)</pre></div></div><br class="example-break" /><p>In this example,
	<code class="systemitem">jru</code> is a member of
	the groups <code class="systemitem">jru</code> and
	<code class="systemitem">teamtwo</code>.</p><p>For more information about this command and the format of
	<code class="filename">/etc/group</code>, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=group&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">group</span>(5)</span></a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="permissions"></a>3.4. Permissions</h2></div></div></div><a id="idp50415224" class="indexterm"></a><p>In FreeBSD, every file and directory has an associated set of
      permissions and several utilities are available for viewing
      and modifying these permissions.  Understanding how permissions
      work is necessary to make sure that users are able to access
      the files that they need and are unable to improperly access
      the files used by the operating system or owned by other
      users.</p><p>This section discusses the traditional <span class="trademark">UNIX</span>® permissions
      used in FreeBSD.  For finer grained file system access control,
      refer to <a class="xref" href="#fs-acl" title="13.9. Access Control Lists">Section 13.9, &#8220;Access Control Lists&#8221;</a>.</p><p>In <span class="trademark">UNIX</span>®, basic permissions are assigned using
      three types of access: read, write, and execute.  These access
      types are used to determine file access to the file's owner,
      group, and others (everyone else).  The read, write, and execute
      permissions can be represented as the letters
      <code class="literal">r</code>, <code class="literal">w</code>, and
      <code class="literal">x</code>.  They can also be represented as binary
      numbers as each permission is either on or off
      (<code class="literal">0</code>).  When represented as a number, the
      order is always read as <code class="literal">rwx</code>, where
      <code class="literal">r</code> has an on value of <code class="literal">4</code>,
      <code class="literal">w</code> has an on value of <code class="literal">2</code>
      and <code class="literal">x</code> has an on value of
      <code class="literal">1</code>.</p><p>Table 4.1 summarizes the possible numeric and alphabetic
      possibilities.  When reading the <span class="quote">&#8220;<span class="quote">Directory
	Listing</span>&#8221;</span> column, a <code class="literal">-</code> is used to
      represent a permission that is set to off.</p><a id="idp50428024" class="indexterm"></a><a id="idp50457464" class="indexterm"></a><div class="table"><a id="idp50458232"></a><div class="table-title">Table 3.2. <span class="trademark">UNIX</span>® Permissions</div><div class="table-contents"><table class="table" summary="UNIX Permissions" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Value</th><th>Permission</th><th>Directory Listing</th></tr></thead><tbody><tr><td>0</td><td>No read, no write, no execute</td><td><code class="literal">---</code></td></tr><tr><td>1</td><td>No read, no write, execute</td><td><code class="literal">--x</code></td></tr><tr><td>2</td><td>No read, write, no execute</td><td><code class="literal">-w-</code></td></tr><tr><td>3</td><td>No read, write, execute</td><td><code class="literal">-wx</code></td></tr><tr><td>4</td><td>Read, no write, no execute</td><td><code class="literal">r--</code></td></tr><tr><td>5</td><td>Read, no write, execute</td><td><code class="literal">r-x</code></td></tr><tr><td>6</td><td>Read, write, no execute</td><td><code class="literal">rw-</code></td></tr><tr><td>7</td><td>Read, write, execute</td><td><code class="literal">rwx</code></td></tr></tbody></table></div></div><br class="table-break" /><a id="idp50156280" class="indexterm"></a><a id="idp50157560" class="indexterm"></a><p>Use the <code class="option">-l</code> argument to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> to view a
      long directory listing that includes a column of information
      about a file's permissions for the owner, group, and everyone
      else.  For example, a <code class="command">ls -l</code> in an arbitrary
      directory may show:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ls -l</code></strong>
total 530
-rw-r--r--  1 root  wheel     512 Sep  5 12:31 myfile
-rw-r--r--  1 root  wheel     512 Sep  5 12:31 otherfile
-rw-r--r--  1 root  wheel    7680 Sep  5 12:31 email.txt</pre><p>The first (leftmost) character in the first column indicates
      whether this file is a regular file, a directory, a special
      character device, a socket, or any other special pseudo-file
      device.  In this example, the <code class="literal">-</code> indicates a
      regular file.  The next three characters, <code class="literal">rw-</code>
      in this example, give the permissions for the owner of the file.
      The next three characters, <code class="literal">r--</code>, give the
      permissions for the group that the file belongs to.  The final
      three characters, <code class="literal">r--</code>, give the permissions
      for the rest of the world.  A dash means that the permission is
      turned off.  In this example, the permissions are set so the
      owner can read and write to the file, the group can read the
      file, and the rest of the world can only read the file.
      According to the table above, the permissions for this file
      would be <code class="literal">644</code>, where each digit represents the
      three parts of the file's permission.</p><p>How does the system control permissions on devices? FreeBSD
      treats most hardware devices as a file that programs can open,
      read, and write data to.  These special device files are
      stored in <code class="filename">/dev/</code>.</p><p>Directories are also treated as files.  They have read,
      write, and execute permissions.  The executable bit for a
      directory has a slightly different meaning than that of files.
      When a directory is marked executable, it means it is possible
      to change into that directory using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cd</span>(1)</span></a>.  This also
      means that it is possible to access the files within that
      directory, subject to the permissions on the files
      themselves.</p><p>In order to perform a directory listing, the read permission
      must be set on the directory.  In order to delete a file that
      one knows the name of, it is necessary to have write
      <span class="emphasis"><em>and</em></span> execute permissions to the directory
      containing the file.</p><p>There are more permission bits, but they are primarily used
      in special circumstances such as setuid binaries and sticky
      directories.  For more information on file permissions and how
      to set them, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp50486904"></a>3.4.1. Symbolic Permissions</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp50191224" class="indexterm"></a><p>Symbolic permissions use characters instead of octal
	values to assign permissions to files or directories.
	Symbolic permissions use the syntax of (who) (action)
	(permissions), where the following values are
	available:</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Option</th><th>Letter</th><th>Represents</th></tr></thead><tbody><tr><td>(who)</td><td>u</td><td>User</td></tr><tr><td>(who)</td><td>g</td><td>Group owner</td></tr><tr><td>(who)</td><td>o</td><td>Other</td></tr><tr><td>(who)</td><td>a</td><td>All (<span class="quote">&#8220;<span class="quote">world</span>&#8221;</span>)</td></tr><tr><td>(action)</td><td>+</td><td>Adding permissions</td></tr><tr><td>(action)</td><td>-</td><td>Removing permissions</td></tr><tr><td>(action)</td><td>=</td><td>Explicitly set permissions</td></tr><tr><td>(permissions)</td><td>r</td><td>Read</td></tr><tr><td>(permissions)</td><td>w</td><td>Write</td></tr><tr><td>(permissions)</td><td>x</td><td>Execute</td></tr><tr><td>(permissions)</td><td>t</td><td>Sticky bit</td></tr><tr><td>(permissions)</td><td>s</td><td>Set UID or GID</td></tr></tbody></table></div><p>These values are used with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a>, but with
	letters instead of numbers.  For example, the following
	command would block other users from accessing
	<em class="replaceable"><code>FILE</code></em>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>chmod go= FILE</code></strong></pre><p>A comma separated list can be provided when more than one
	set of changes to a file must be made.  For example, the
	following command removes the group and
	<span class="quote">&#8220;<span class="quote">world</span>&#8221;</span> write permission on
	<em class="replaceable"><code>FILE</code></em>, and adds the execute
	permissions for everyone:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>chmod go-w,a+x <em class="replaceable"><code>FILE</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp50535672"></a>3.4.2. FreeBSD File Flags</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>In addition to file permissions, FreeBSD supports the use of
	<span class="quote">&#8220;<span class="quote">file flags</span>&#8221;</span>.  These flags add an additional
	level of security and control over files, but not directories.
	With file flags, even
	<code class="systemitem">root</code> can be
	prevented from removing or altering files.</p><p>File flags are modified using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a>.  For
	example, to enable the system undeletable flag on the file
	<code class="filename">file1</code>, issue the following
	command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chflags sunlink file1</code></strong></pre><p>To disable the system undeletable flag, put a
	<span class="quote">&#8220;<span class="quote">no</span>&#8221;</span> in front of the
	<code class="option">sunlink</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chflags nosunlink file1</code></strong></pre><p>To view the flags of a file, use <code class="option">-lo</code> with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls -lo file1</code></strong></pre><pre class="programlisting">-rw-r--r--  1 trhodes  trhodes  sunlnk 0 Mar  1 05:54 file1</pre><p>Several file flags may only be added or removed by the
	<code class="systemitem">root</code> user.  In other
	cases, the file owner may set its file flags.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chflags</span>(2)</span></a> for more
	information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp50558456"></a>3.4.3. The <code class="literal">setuid</code>,
	  <code class="literal">setgid</code>, and <code class="literal">sticky</code>
	  Permissions</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>Other than the permissions already discussed, there are
	three other specific settings that all administrators should
	know about.  They are the <code class="literal">setuid</code>,
	<code class="literal">setgid</code>, and <code class="literal">sticky</code>
	permissions.</p><p>These settings are important for some <span class="trademark">UNIX</span>® operations
	as they provide functionality not normally granted to normal
	users.  To understand them, the difference between the real
	user ID and effective user ID must be noted.</p><p>The real user ID is the <acronym class="acronym">UID</acronym> who owns
	or starts the process.  The effective <acronym class="acronym">UID</acronym>
	is the user ID the process runs as.  As an example,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a> runs with the real user ID when a user changes
	their password.  However, in order to update the password
	database, the command runs as the effective ID of the
	<code class="systemitem">root</code> user.  This
	allows users to change their passwords without seeing a
	<span class="errorname">Permission Denied</span> error.</p><p>The setuid permission may be set by prefixing a permission
	set with the number four (4) as shown in the following
	example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 4755 suidexample.sh</code></strong></pre><p>The permissions on
	<code class="filename"><em class="replaceable"><code>suidexample.sh</code></em></code>
	now look like the following:</p><pre class="programlisting">-rwsr-xr-x   1 trhodes  trhodes    63 Aug 29 06:36 suidexample.sh</pre><p>Note that a <code class="literal">s</code> is now part of the
	permission set designated for the file owner, replacing the
	executable bit.  This allows utilities which need elevated
	permissions, such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <code class="literal">nosuid</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> option will
	  cause such binaries to silently fail without alerting
	  the user.  That option is not completely reliable as a
	  <code class="literal">nosuid</code> wrapper may be able to circumvent
	  it.</p></div><p>To view this in real time, open two terminals.  On
	one, type <code class="command">passwd</code> as a normal user.
	While it waits for a new password, check the process
	table and look at the user information for
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a>:</p><p>In terminal A:</p><pre class="screen">Changing local password for trhodes
Old Password:</pre><p>In terminal B:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ps aux | grep passwd</code></strong></pre><pre class="screen">trhodes  5232  0.0  0.2  3420  1608   0  R+    2:10AM   0:00.00 grep passwd
root     5211  0.0  0.2  3620  1724   2  I+    2:09AM   0:00.01 passwd</pre><p>Although <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a> is run as a normal user, it is
	using the effective <acronym class="acronym">UID</acronym> of
	<code class="systemitem">root</code>.</p><p>The <code class="literal">setgid</code> permission performs the
	same function as the <code class="literal">setuid</code> permission;
	except that it alters the group settings.  When an application
	or utility executes with this setting, it will be granted the
	permissions based on the group that owns the file, not the
	user who started the process.</p><p>To set the <code class="literal">setgid</code> permission on a
	file, provide <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a> with a leading two (2):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 2755 sgidexample.sh</code></strong></pre><p>In the following listing, notice that the
	<code class="literal">s</code> is now in the field designated for the
	group permission settings:</p><pre class="screen">-rwxr-sr-x   1 trhodes  trhodes    44 Aug 31 01:49 sgidexample.sh</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In these examples, even though the shell script in
	  question is an executable file, it will not run with
	  a different <acronym class="acronym">EUID</acronym> or effective user ID.
	  This is because shell scripts may not access the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setuid&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setuid</span>(2)</span></a> system calls.</p></div><p>The <code class="literal">setuid</code> and
	<code class="literal">setgid</code> permission bits may lower system
	security, by allowing for elevated permissions.  The third
	special permission, the <code class="literal">sticky bit</code>, can
	strengthen the security of a system.</p><p>When the <code class="literal">sticky bit</code> is set on a
	directory, it allows file deletion only by the file owner.
	This is useful to prevent file deletion in public directories,
	such as <code class="filename">/tmp</code>, by users
	who do not own the file.  To utilize this permission, prefix
	the permission set with a one (1):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 1777 /tmp</code></strong></pre><p>The <code class="literal">sticky bit</code> permission will display
	as a <code class="literal">t</code> at the very end of the permission
	set:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls -al / | grep tmp</code></strong></pre><pre class="screen">drwxrwxrwt  10 root  wheel         512 Aug 31 01:49 tmp</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dirstructure"></a>3.5. Directory Structure</h2></div></div></div><a id="idp50631672" class="indexterm"></a><p>The FreeBSD directory hierarchy is fundamental to obtaining
      an overall understanding of the system.  The most important
      directory is root or, <span class="quote">&#8220;<span class="quote">/</span>&#8221;</span>.  This directory is the
      first one mounted at boot time and it contains the base system
      necessary to prepare the operating system for multi-user
      operation.  The root directory also contains mount points for
      other file systems that are mounted during the transition to
      multi-user operation.</p><p>A mount point is a directory where additional file systems
      can be grafted onto a parent file system (usually the root file
      system).  This is further described in
      <a class="xref" href="#disk-organization" title="3.6. Disk Organization">Section 3.6, &#8220;Disk Organization&#8221;</a>.  Standard mount points
      include <code class="filename">/usr/</code>, <code class="filename">/var/</code>,
      <code class="filename">/tmp/</code>, <code class="filename">/mnt/</code>, and
      <code class="filename">/cdrom/</code>.  These directories are usually
      referenced to entries in <code class="filename">/etc/fstab</code>.  This
      file is a table of various file systems and mount points and is
      read by the system.  Most of the file systems in
      <code class="filename">/etc/fstab</code> are mounted automatically at
      boot time from the script <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> unless their entry includes
      <code class="option">noauto</code>.  Details can be found in
      <a class="xref" href="#disks-fstab" title="3.7.1. The fstab File">Section 3.7.1, &#8220;The <code class="filename">fstab</code> File&#8221;</a>.</p><p>A complete description of the file system hierarchy is
      available in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hier&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hier</span>(7)</span></a>.  The following table provides a brief
      overview of the most common directories.</p><p>
      </p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Directory</th><th>Description</th></tr></thead><tbody valign="top"><tr><td valign="top"><code class="filename">/</code></td><td valign="top">Root directory of the file system.</td></tr><tr><td valign="top"><code class="filename">/bin/</code></td><td valign="top">User utilities fundamental to both single-user
		and multi-user environments.</td></tr><tr><td valign="top"><code class="filename">/boot/</code></td><td valign="top">Programs and configuration files used during
		operating system bootstrap.</td></tr><tr><td valign="top"><code class="filename">/boot/defaults/</code></td><td valign="top">Default boot configuration files.  Refer to
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> for details.</td></tr><tr><td valign="top"><code class="filename">/dev/</code></td><td valign="top">Device nodes.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=intro&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">intro</span>(4)</span></a> for
		details.</td></tr><tr><td valign="top"><code class="filename">/etc/</code></td><td valign="top">System configuration files and scripts.</td></tr><tr><td valign="top"><code class="filename">/etc/defaults/</code></td><td valign="top">Default system configuration files.  Refer to
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> for details.</td></tr><tr><td valign="top"><code class="filename">/etc/mail/</code></td><td valign="top">Configuration files for mail transport agents
		such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></a>.</td></tr><tr><td valign="top"><code class="filename">/etc/periodic/</code></td><td valign="top">Scripts that run daily, weekly, and monthly,
		via <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a> for
		details.</td></tr><tr><td valign="top"><code class="filename">/etc/ppp/</code></td><td valign="top"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> configuration files.</td></tr><tr><td valign="top"><code class="filename">/mnt/</code></td><td valign="top">Empty directory commonly used by system
		administrators as a temporary mount point.</td></tr><tr><td valign="top"><code class="filename">/proc/</code></td><td valign="top">Process file system.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=procfs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">procfs</span>(5)</span></a>,
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_procfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_procfs</span>(8)</span></a> for details.</td></tr><tr><td valign="top"><code class="filename">/rescue/</code></td><td valign="top">Statically linked programs for emergency
		recovery as described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rescue&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rescue</span>(8)</span></a>.</td></tr><tr><td valign="top"><code class="filename">/root/</code></td><td valign="top">Home directory for the
		<code class="systemitem">root</code>
		account.</td></tr><tr><td valign="top"><code class="filename">/sbin/</code></td><td valign="top">System programs and administration utilities
		fundamental to both single-user and multi-user
		environments.</td></tr><tr><td valign="top"><code class="filename">/tmp/</code></td><td valign="top">Temporary files which are usually
		<span class="emphasis"><em>not</em></span> preserved across a system
		reboot.  A memory-based file system is often mounted
		at <code class="filename">/tmp</code>.  This can be automated
		using the tmpmfs-related variables of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
		or with an entry in <code class="filename">/etc/fstab</code>;
		refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a> for details.</td></tr><tr><td valign="top"><code class="filename">/usr/</code></td><td valign="top">The majority of user utilities and
		applications.</td></tr><tr><td valign="top"><code class="filename">/usr/bin/</code></td><td valign="top">Common utilities, programming tools, and
		applications.</td></tr><tr><td valign="top"><code class="filename">/usr/include/</code></td><td valign="top">Standard C include files.</td></tr><tr><td valign="top"><code class="filename">/usr/lib/</code></td><td valign="top">Archive libraries.</td></tr><tr><td valign="top"><code class="filename">/usr/libdata/</code></td><td valign="top">Miscellaneous utility data files.</td></tr><tr><td valign="top"><code class="filename">/usr/libexec/</code></td><td valign="top">System daemons and system utilities executed
		by other programs.</td></tr><tr><td valign="top"><code class="filename">/usr/local/</code></td><td valign="top">Local executables and libraries.  Also used as
		the default destination for the FreeBSD ports framework.
		Within
		<code class="filename">/usr/local</code>, the
		general layout sketched out by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hier&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hier</span>(7)</span></a> for
		<code class="filename">/usr</code> should be
		used.  Exceptions are the man directory, which is
		directly under <code class="filename">/usr/local</code> rather than
		under <code class="filename">/usr/local/share</code>, and
		the ports documentation is in <code class="filename">share/doc/<em class="replaceable"><code>port</code></em></code>.</td></tr><tr><td valign="top"><code class="filename">/usr/obj/</code></td><td valign="top">Architecture-specific target tree produced by
		building the <code class="filename">/usr/src</code>
		tree.</td></tr><tr><td valign="top"><code class="filename">/usr/ports/</code></td><td valign="top">The FreeBSD Ports Collection (optional).</td></tr><tr><td valign="top"><code class="filename">/usr/sbin/</code></td><td valign="top">System daemons and system utilities executed
		by users.</td></tr><tr><td valign="top"><code class="filename">/usr/share/</code></td><td valign="top">Architecture-independent files.</td></tr><tr><td valign="top"><code class="filename">/usr/src/</code></td><td valign="top">BSD and/or local source files.</td></tr><tr><td valign="top"><code class="filename">/var/</code></td><td valign="top">Multi-purpose log, temporary, transient, and
		spool files.  A memory-based file system is sometimes
		mounted at
		<code class="filename">/var</code>.  This can
		be automated using the varmfs-related variables in
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> or with an entry in
		<code class="filename">/etc/fstab</code>; refer to
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a> for details.</td></tr><tr><td valign="top"><code class="filename">/var/log/</code></td><td valign="top">Miscellaneous system log files.</td></tr><tr><td valign="top"><code class="filename">/var/mail/</code></td><td valign="top">User mailbox files.</td></tr><tr><td valign="top"><code class="filename">/var/spool/</code></td><td valign="top">Miscellaneous printer and mail system spooling
		directories.</td></tr><tr><td valign="top"><code class="filename">/var/tmp/</code></td><td valign="top">Temporary files which are usually preserved
		across a system reboot, unless
		<code class="filename">/var</code> is a
		memory-based file system.</td></tr><tr><td valign="top"><code class="filename">/var/yp/</code></td><td valign="top">NIS maps.</td></tr></tbody></table></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disk-organization"></a>3.6. Disk Organization</h2></div></div></div><p>The smallest unit of organization that FreeBSD uses to find
      files is the filename.  Filenames are case-sensitive, which
      means that <code class="filename">readme.txt</code> and
      <code class="filename">README.TXT</code> are two separate files.  FreeBSD
      does not use the extension of a file to determine whether the
      file is a program, document, or some other form of data.</p><p>Files are stored in directories.  A directory may contain no
      files, or it may contain many hundreds of files.  A directory
      can also contain other directories, allowing a hierarchy of
      directories within one another in order to organize
      data.</p><p>Files and directories are referenced by giving the file or
      directory name, followed by a forward slash,
      <code class="literal">/</code>, followed by any other directory names that
      are necessary.  For example, if the directory
      <code class="filename">foo</code> contains a directory
      <code class="filename">bar</code> which contains the
      file <code class="filename">readme.txt</code>, the full name, or
      <em class="firstterm">path</em>, to the file is
      <code class="filename">foo/bar/readme.txt</code>.  Note that this is
      different from <span class="trademark">Windows</span>® which uses <code class="literal">\</code> to
      separate file and directory names.  FreeBSD does not use drive
      letters, or other drive names in the path.  For example, one
      would not type <code class="filename">c:\foo\bar\readme.txt</code> on
      FreeBSD.</p><p>Directories and files are stored in a file system.  Each
      file system contains exactly one directory at the very top
      level, called the <em class="firstterm">root directory</em> for that
      file system.  This root directory can contain other directories.
      One file system is designated the
      <em class="firstterm">root file system</em> or <code class="literal">/</code>.
      Every other file system is <em class="firstterm">mounted</em> under
      the root file system.  No matter how many disks are on the FreeBSD
      system, every directory appears to be part of the same
      disk.</p><p>Consider three file systems, called <code class="literal">A</code>,
      <code class="literal">B</code>, and <code class="literal">C</code>.  Each file
      system has one root directory, which contains two other
      directories, called <code class="literal">A1</code>, <code class="literal">A2</code>
      (and likewise <code class="literal">B1</code>, <code class="literal">B2</code> and
      <code class="literal">C1</code>, <code class="literal">C2</code>).</p><p>Call <code class="literal">A</code> the root file system.  If
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> is used to view the contents of this directory,
      it will show two subdirectories, <code class="literal">A1</code> and
      <code class="literal">A2</code>.  The directory tree looks like
      this:</p><div class="mediaobject"><img src="basics/example-dir1.png" /></div><p>A file system must be mounted on to a directory in another
      file system.  When mounting file system <code class="literal">B</code>
      on to the directory <code class="literal">A1</code>, the root directory
      of <code class="literal">B</code> replaces <code class="literal">A1</code>, and
      the directories in <code class="literal">B</code> appear
      accordingly:</p><div class="mediaobject"><img src="basics/example-dir2.png" /></div><p>Any files that are in the <code class="literal">B1</code> or
      <code class="literal">B2</code> directories can be reached with the path
      <code class="filename">/A1/B1</code> or
      <code class="filename">/A1/B2</code> as necessary.  Any
      files that were in <code class="filename">/A1</code>
      have been temporarily hidden.  They will reappear if
      <code class="literal">B</code> is <em class="firstterm">unmounted</em> from
      <code class="literal">A</code>.</p><p>If <code class="literal">B</code> had been mounted on
      <code class="literal">A2</code> then the diagram would look like
      this:</p><div class="mediaobject"><img src="basics/example-dir3.png" /></div><p>and the paths would be
      <code class="filename">/A2/B1</code> and
      <code class="filename">/A2/B2</code>
      respectively.</p><p>File systems can be mounted on top of one another.
      Continuing the last example, the <code class="literal">C</code> file
      system could be mounted on top of the <code class="literal">B1</code>
      directory in the <code class="literal">B</code> file system, leading to
      this arrangement:</p><div class="mediaobject"><img src="basics/example-dir4.png" /></div><p>Or <code class="literal">C</code> could be mounted directly on to the
      <code class="literal">A</code> file system, under the
      <code class="literal">A1</code> directory:</p><div class="mediaobject"><img src="basics/example-dir5.png" /></div><p>It is entirely possible to have one large root file system,
      and not need to create any others.  There are some drawbacks to
      this approach, and one advantage.</p><div class="itemizedlist"><div class="itemizedlist-title">Benefits of Multiple File Systems</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Different file systems can have different
	  <em class="firstterm">mount options</em>.  For example, the root
	  file system can be mounted read-only, making it impossible
	  for users to inadvertently delete or edit a critical file.
	  Separating user-writable file systems, such as
	  <code class="filename">/home</code>, from other
	  file systems allows them to be mounted
	  <em class="firstterm">nosuid</em>.  This option prevents the
	  <em class="firstterm">suid</em>/<em class="firstterm">guid</em> bits
	  on executables stored on the file system from taking effect,
	  possibly improving security.</p></li><li class="listitem"><p>FreeBSD automatically optimizes the layout of files on a
	  file system, depending on how the file system is being used.
	  So a file system that contains many small files that are
	  written frequently will have a different optimization to one
	  that contains fewer, larger files.  By having one big file
	  system this optimization breaks down.</p></li><li class="listitem"><p>FreeBSD's file systems are robust if power is lost.
	  However, a power loss at a critical point could still damage
	  the structure of the file system.  By splitting data over
	  multiple file systems it is more likely that the system will
	  still come up, making it easier to restore from backup as
	  necessary.</p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Benefit of a Single File System</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>File systems are a fixed size.  If you create a file
	  system when you install FreeBSD and give it a specific size,
	  you may later discover that you need to make the partition
	  bigger.  This is not easily accomplished without backing up,
	  recreating the file system with the new size, and then
	  restoring the backed up data.</p><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD features the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growfs</span>(8)</span></a> command, which makes
	    it possible to increase the size of file system on the
	    fly, removing this limitation.</p></div></li></ul></div><p>File systems are contained in partitions.  This does not
      have the same meaning as the common usage of the term partition
      (for example, <span class="trademark">MS-DOS</span>® partition), because of FreeBSD's <span class="trademark">UNIX</span>®
      heritage.  Each partition is identified by a letter from
      <code class="literal">a</code> through to <code class="literal">h</code>.  Each
      partition can contain only one file system, which means that
      file systems are often described by either their typical mount
      point in the file system hierarchy, or the letter of the
      partition they are contained in.</p><p>FreeBSD also uses disk space for
      <em class="firstterm">swap space</em> to provide
      <em class="firstterm">virtual memory</em>.  This allows your
      computer to behave as though it has much more memory than it
      actually does.  When FreeBSD runs out of memory, it moves some of
      the data that is not currently being used to the swap space, and
      moves it back in (moving something else out) when it needs
      it.</p><p>Some partitions have certain conventions associated with
      them.</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Partition</th><th>Convention</th></tr></thead><tbody valign="top"><tr><td valign="top"><code class="literal">a</code></td><td valign="top">Normally contains the root file system.</td></tr><tr><td valign="top"><code class="literal">b</code></td><td valign="top">Normally contains swap space.</td></tr><tr><td valign="top"><code class="literal">c</code></td><td valign="top">Normally the same size as the enclosing slice.
	      This allows utilities that need to work on the entire
	      slice, such as a bad block scanner, to work on the
	      <code class="literal">c</code> partition.  A file system would not
	      normally be created on this partition.</td></tr><tr><td valign="top"><code class="literal">d</code></td><td valign="top">Partition <code class="literal">d</code> used to have a
	      special meaning associated with it, although that is now
	      gone and <code class="literal">d</code> may work as any normal
	      partition.</td></tr></tbody></table></div><p>Disks in FreeBSD are divided into slices, referred to in
      <span class="trademark">Windows</span>® as partitions, which are numbered from 1 to 4.  These
      are then divided into partitions, which contain file systems,
      and are labeled using letters.</p><a id="idp50881784" class="indexterm"></a><a id="idp50882552" class="indexterm"></a><a id="idp50883320" class="indexterm"></a><p>Slice numbers follow the device name, prefixed with an
      <code class="literal">s</code>, starting at 1.  So
      <span class="quote">&#8220;<span class="quote">da0<span class="emphasis"><em>s1</em></span></span>&#8221;</span> is the first slice on
      the first SCSI drive.  There can only be four physical slices on
      a disk, but there can be logical slices inside physical slices
      of the appropriate type.  These extended slices are numbered
      starting at 5, so <span class="quote">&#8220;<span class="quote">ada0<span class="emphasis"><em>s5</em></span></span>&#8221;</span> is
      the first extended slice on the first SATA disk.  These devices
      are used by file systems that expect to occupy a slice.</p><p>Slices, <span class="quote">&#8220;<span class="quote">dangerously dedicated</span>&#8221;</span> physical
      drives, and other drives contain
      <em class="firstterm">partitions</em>, which are represented as
      letters from <code class="literal">a</code> to <code class="literal">h</code>.  This
      letter is appended to the device name, so
      <span class="quote">&#8220;<span class="quote">da0<span class="emphasis"><em>a</em></span></span>&#8221;</span> is the
      <code class="literal">a</code> partition on the first
      <code class="literal">da</code> drive, which is
      <span class="quote">&#8220;<span class="quote">dangerously dedicated</span>&#8221;</span>.
      <span class="quote">&#8220;<span class="quote">ada1s3<span class="emphasis"><em>e</em></span></span>&#8221;</span> is the fifth
      partition in the third slice of the second SATA disk
      drive.</p><p>Finally, each disk on the system is identified.  A disk name
      starts with a code that indicates the type of disk, and then a
      number, indicating which disk it is.  Unlike slices, disk
      numbering starts at 0.  Common codes are listed in
      <a class="xref" href="#disks-naming" title="Table 3.3. Disk Device Names">Table 3.3, &#8220;Disk Device Names&#8221;</a>.</p><p>When referring to a partition, include the disk name,
      <code class="literal">s</code>, the slice number, and then the partition
      letter.  Examples are shown in
      <a class="xref" href="#basics-disk-slice-part" title="Example 3.12. Sample Disk, Slice, and Partition Names">Example 3.12, &#8220;Sample Disk, Slice, and Partition Names&#8221;</a>.</p><p><a class="xref" href="#basics-concept-disk-model" title="Example 3.13. Conceptual Model of a Disk">Example 3.13, &#8220;Conceptual Model of a Disk&#8221;</a> shows a
      conceptual model of a disk layout.</p><p>When installing FreeBSD, configure the disk slices, create
      partitions within the slice to be used for FreeBSD, create a file
      system or swap space in each partition, and decide where each
      file system will be mounted.</p><div class="table"><a id="disks-naming"></a><div class="table-title">Table 3.3. Disk Device Names</div><div class="table-contents"><table class="table" summary="Disk Device Names" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Drive Type</th><th>Drive Device Name</th></tr></thead><tbody><tr><td><acronym class="acronym">SATA</acronym> and <acronym class="acronym">IDE</acronym>
	      hard drives</td><td><code class="literal">ada</code> or
	      <code class="literal">ad</code></td></tr><tr><td><acronym class="acronym">SCSI</acronym> hard drives and
	      <acronym class="acronym">USB</acronym> storage devices</td><td><code class="literal">da</code></td></tr><tr><td><acronym class="acronym">SATA</acronym> and <acronym class="acronym">IDE</acronym>
	      <acronym class="acronym">CD-ROM</acronym> drives</td><td><code class="literal">cd</code> or
	      <code class="literal">acd</code></td></tr><tr><td><acronym class="acronym">SCSI</acronym> <acronym class="acronym">CD-ROM</acronym>
	      drives</td><td><code class="literal">cd</code></td></tr><tr><td>Floppy drives</td><td><code class="literal">fd</code></td></tr><tr><td>Assorted non-standard <acronym class="acronym">CD-ROM</acronym>
	      drives</td><td><code class="literal">mcd</code> for Mitsumi
	      <acronym class="acronym">CD-ROM</acronym> and <code class="literal">scd</code> for
	      Sony <acronym class="acronym">CD-ROM</acronym> devices</td></tr><tr><td><acronym class="acronym">SCSI</acronym> tape drives</td><td><code class="literal">sa</code></td></tr><tr><td><acronym class="acronym">IDE</acronym> tape drives</td><td><code class="literal">ast</code></td></tr><tr><td>RAID drives</td><td>Examples include <code class="literal">aacd</code> for
	      <span class="trademark">Adaptec</span>® AdvancedRAID, <code class="literal">mlxd</code> and
	      <code class="literal">mlyd</code> for <span class="trademark">Mylex</span>®,
	      <code class="literal">amrd</code> for AMI <span class="trademark">MegaRAID</span>®,
	      <code class="literal">idad</code> for Compaq Smart RAID,
	      <code class="literal">twed</code> for <span class="trademark">3ware</span>® RAID.</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="basics-disk-slice-part"></a><div class="example-title">Example 3.12. Sample Disk, Slice, and Partition Names</div><div class="example-contents"><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Name</th><th>Meaning</th></tr></thead><tbody><tr><td><code class="literal">ada0s1a</code></td><td>The first partition (<code class="literal">a</code>) on the
		first slice (<code class="literal">s1</code>) on the first
		<acronym class="acronym">SATA</acronym>
		disk (<code class="literal">ada0</code>).</td></tr><tr><td><code class="literal">da1s2e</code></td><td>The fifth partition (<code class="literal">e</code>) on the
		second slice (<code class="literal">s2</code>) on the second
		SCSI disk (<code class="literal">da1</code>).</td></tr></tbody></table></div></div></div><br class="example-break" /><div class="example"><a id="basics-concept-disk-model"></a><div class="example-title">Example 3.13. Conceptual Model of a Disk</div><div class="example-contents"><p>This diagram shows FreeBSD's view of the first
	<acronym class="acronym">SATA</acronym> disk attached to the system.  Assume
	that the disk is 250 GB in size, and contains an
	80 GB slice and a 170 GB slice (<span class="trademark">MS-DOS</span>®
	partitions).  The first slice contains a <span class="trademark">Windows</span>®
	<acronym class="acronym">NTFS</acronym> file system, <code class="filename">C:</code>,
	and the second slice contains a FreeBSD installation.  This
	example FreeBSD installation has four data partitions and a swap
	partition.</p><p>The four partitions each hold a file system.  Partition
	<code class="literal">a</code> is used for the root file system,
	<code class="literal">d</code> for <code class="filename">/var/</code>,
	<code class="literal">e</code> for <code class="filename">/tmp/</code>, and
	<code class="literal">f</code> for <code class="filename">/usr/</code>.
	Partition letter <code class="literal">c</code> refers to the entire
	slice, and so is not used for ordinary partitions.</p><div class="mediaobject"><img src="basics/disk-layout.png" /></div></div></div><br class="example-break" /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mount-unmount"></a>3.7. Mounting and Unmounting File Systems</h2></div></div></div><p>The file system is best visualized as a tree, rooted, as it
      were, at <code class="filename">/</code>.
      <code class="filename">/dev</code>,
      <code class="filename">/usr</code>, and the other
      directories in the root directory are branches, which may have
      their own branches, such as
      <code class="filename">/usr/local</code>, and so
      on.</p><a id="idp50960888" class="indexterm"></a><p>There are various reasons to house some of these
      directories on separate file systems.
      <code class="filename">/var</code> contains the
      directories <code class="filename">log/</code>,
      <code class="filename">spool/</code>, and various types
      of temporary files, and as such, may get filled up.  Filling up
      the root file system is not a good idea, so splitting
      <code class="filename">/var</code> from
      <code class="filename">/</code> is often
      favorable.</p><p>Another common reason to contain certain directory trees on
      other file systems is if they are to be housed on separate
      physical disks, or are separate virtual disks, such as Network
      File System mounts, described in <a class="xref" href="#network-nfs" title="29.3. Network File System (NFS)">Section 29.3, &#8220;Network File System (NFS)&#8221;</a>,
      or CDROM drives.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-fstab"></a>3.7.1. The <code class="filename">fstab</code> File</h3></div></div></div><a id="idp50969976" class="indexterm"></a><p>During the boot process (<a class="xref" href="#boot" title="Chapter 12. The FreeBSD Booting Process">Chapter 12, <em>The FreeBSD Booting Process</em></a>), file
	systems listed in <code class="filename">/etc/fstab</code> are
	automatically mounted except for the entries containing
	<code class="option">noauto</code>.  This file contains entries in the
	following format:</p><pre class="programlisting"><em class="replaceable"><code>device</code></em>       <em class="replaceable"><code>/mount-point</code></em> <em class="replaceable"><code>fstype</code></em>     <em class="replaceable"><code>options</code></em>      <em class="replaceable"><code>dumpfreq</code></em>     <em class="replaceable"><code>passno</code></em></pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">device</code></span></dt><dd><p>An existing device name as explained in
	      <a class="xref" href="#disks-naming" title="Table 3.3. Disk Device Names">Table 3.3, &#8220;Disk Device Names&#8221;</a>.</p></dd><dt><span class="term"><code class="literal">mount-point</code></span></dt><dd><p>An existing directory on which to mount the file
	      system.</p></dd><dt><span class="term"><code class="literal">fstype</code></span></dt><dd><p>The file system type to pass to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.  The
	      default FreeBSD file system is
	      <code class="literal">ufs</code>.</p></dd><dt><span class="term"><code class="literal">options</code></span></dt><dd><p>Either <code class="option">rw</code> for read-write file
	      systems, or <code class="option">ro</code> for read-only file
	      systems, followed by any other options that may be
	      needed.  A common option is <code class="option">noauto</code> for
	      file systems not normally mounted during the boot
	      sequence.  Other options are listed in
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.</p></dd><dt><span class="term"><code class="literal">dumpfreq</code></span></dt><dd><p>Used by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> to determine which file systems
	      require dumping.  If the field is missing, a value of
	      zero is assumed.</p></dd><dt><span class="term"><code class="literal">passno</code></span></dt><dd><p>Determines the order in which file systems should be
	      checked.  File systems that should be skipped should
	      have their <code class="literal">passno</code> set to zero.  The
	      root file system needs to be checked before everything
	      else and should have its <code class="literal">passno</code> set
	      to one.  The other file systems should be set to
	      values greater than one.  If more than one file system
	      has the same <code class="literal">passno</code>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>
	      will attempt to check file systems in parallel if
	      possible.</p></dd></dl></div><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> for more information on the format
	of <code class="filename">/etc/fstab</code> and its options.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-mount"></a>3.7.2. Using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a></h3></div></div></div><a id="idp51015672" class="indexterm"></a><p>File systems are mounted using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.  The most
	basic syntax is as follows:</p><div class="informalexample"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount <em class="replaceable"><code>device</code></em> <em class="replaceable"><code>mountpoint</code></em></code></strong></pre></div><p>This command provides many options which are described in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>, The most commonly used options include:</p><div class="variablelist"><div class="variablelist-title">Mount Options</div><dl class="variablelist"><dt><span class="term"><code class="option">-a</code></span></dt><dd><p>Mount all the file systems listed in
	      <code class="filename">/etc/fstab</code>, except those marked as
	      <span class="quote">&#8220;<span class="quote">noauto</span>&#8221;</span>, excluded by the
	      <code class="option">-t</code> flag, or those that are already
	      mounted.</p></dd><dt><span class="term"><code class="option">-d</code></span></dt><dd><p>Do everything except for the actual mount system
	      call.  This option is useful in conjunction with the
	      <code class="option">-v</code> flag to determine what <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>
	      is actually trying to do.</p></dd><dt><span class="term"><code class="option">-f</code></span></dt><dd><p>Force the mount of an unclean file system
	      (dangerous), or the revocation of write access when
	      downgrading a file system's mount status from read-write
	      to read-only.</p></dd><dt><span class="term"><code class="option">-r</code></span></dt><dd><p>Mount the file system read-only.  This is identical
	      to using <code class="option">-o ro</code>.</p></dd><dt><span class="term"><code class="option">-t</code>
	    <em class="replaceable"><code>fstype</code></em></span></dt><dd><p>Mount the specified file system type or mount only
	      file systems of the given type, if <code class="option">-a</code>
	      is included.  <span class="quote">&#8220;<span class="quote">ufs</span>&#8221;</span> is the default file
	      system type.</p></dd><dt><span class="term"><code class="option">-u</code></span></dt><dd><p>Update mount options on the file system.</p></dd><dt><span class="term"><code class="option">-v</code></span></dt><dd><p>Be verbose.</p></dd><dt><span class="term"><code class="option">-w</code></span></dt><dd><p>Mount the file system read-write.</p></dd></dl></div><p>The following options can be passed to <code class="option">-o</code>
	as a comma-separated list:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">nosuid</span></dt><dd><p>Do not interpret setuid or setgid flags on the
	      file system.  This is also a useful security
	      option.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-umount"></a>3.7.3. Using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=umount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">umount</span>(8)</span></a></h3></div></div></div><a id="idp51063928" class="indexterm"></a><p>To unmount a file system use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=umount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">umount</span>(8)</span></a>.  This command
	takes one parameter which can be a mountpoint, device name,
	<code class="option">-a</code> or <code class="option">-A</code>.</p><p>All forms take <code class="option">-f</code> to force unmounting,
	and <code class="option">-v</code> for verbosity.  Be warned that
	<code class="option">-f</code> is not generally a good idea as it might
	crash the computer or damage data on the file system.</p><p>To unmount all mounted file systems, or just the file
	system types listed after <code class="option">-t</code>, use
	<code class="option">-a</code> or <code class="option">-A</code>.  Note that
	<code class="option">-A</code> does not attempt to unmount the root file
	system.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-processes"></a>3.8. Processes and Daemons</h2></div></div></div><p>FreeBSD is a multi-tasking operating system.  Each program
      running at any one time is called a
      <em class="firstterm">process</em>.  Every running command starts
      at least one new process and there are a number of system
      processes that are run by FreeBSD.</p><p>Each process is uniquely identified by a number called a
      <em class="firstterm">process ID</em> (<acronym class="acronym">PID</acronym>).
      Similar to files, each process has one owner and group, and
      the owner and group permissions are used to determine which
      files and devices the process can open.  Most processes also
      have a parent process that started them.  For example, the
      shell is a process, and any command started in the shell is a
      process which has the shell as its parent process.  The
      exception is a special process called <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a> which is
      always the first process to start at boot time and which always
      has a <acronym class="acronym">PID</acronym> of <code class="literal">1</code>.</p><p>Some programs are not designed to be run with continuous
      user input and disconnect from the terminal at the first
      opportunity.  For example, a web server responds to web
      requests, rather than user input.  Mail servers are another
      example of this type of application.  These types of programs
      are known as <em class="firstterm">daemons</em>.  The term daemon
      comes from Greek mythology and represents an entity that is
      neither good nor evil, and which invisibly performs useful
      tasks.  This is why the BSD mascot is the cheerful-looking
      daemon with sneakers and a pitchfork.</p><p>There is a convention to name programs that normally run as
      daemons with a trailing <span class="quote">&#8220;<span class="quote">d</span>&#8221;</span>.  For example,
      <span class="application">BIND</span> is the Berkeley Internet Name
      Domain, but the actual program that executes is
      <code class="command">named</code>.  The
      <span class="application">Apache</span> web server program is
      <code class="command">httpd</code> and the line printer spooling daemon
      is <code class="command">lpd</code>.  This is only a naming convention.
      For example, the main mail daemon for the
      <span class="application">Sendmail</span> application is
      <code class="command">sendmail</code>, and not
      <code class="literal">maild</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp51083640"></a>3.8.1. Viewing Processes</h3></div></div></div><p>To see the processes running on the system, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a>
	or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a>.   To display a static list of the currently
	running processes, their <acronym class="acronym">PID</acronym>s, how much
	memory they are using, and the command they were started with,
	use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a>.  To display all the running processes and
	update the display every few seconds in order to interactively
	see what the computer is doing, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a>.</p><p>By default, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> only shows the commands that are
	running and owned by the user.  For example:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ps</code></strong>
 PID TT  STAT    TIME COMMAND
8203  0  Ss   0:00.59 /bin/csh
8895  0  R+   0:00.00 ps</pre><p>The output from <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> is organized into a number of
	columns.  The <code class="literal">PID</code> column displays the
	process ID.  <acronym class="acronym">PID</acronym>s are assigned starting at
	1, go up to 99999, then wrap around back to the beginning.
	However, a <acronym class="acronym">PID</acronym> is not reassigned if it is
	already in use.  The <code class="literal">TT</code> column shows the
	tty the program is running on and <code class="literal">STAT</code>
	shows the program's state.  <code class="literal">TIME</code> is the
	amount of time the program has been running on the CPU.  This
	is usually not the elapsed time since the program was started,
	as most programs spend a lot of time waiting for things to
	happen before they need to spend time on the CPU.  Finally,
	<code class="literal">COMMAND</code> is the command that was used to
	start the program.</p><p>A number of different options are available to change the
	information that is displayed.  One of the most useful sets is
	<code class="literal">auxww</code>, where  <code class="option">a</code> displays
	information about all the running processes of all users,
	<code class="option">u</code> displays the username and memory usage of
	the process' owner, <code class="option">x</code> displays
	information about daemon processes, and <code class="option">ww</code>
	causes <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> to display the full command line for each
	process, rather than truncating it once it gets too long to
	fit on the screen.</p><p>The output from <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> is similar:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>top</code></strong>
last pid:  9609;  load averages:  0.56,  0.45,  0.36              up 0+00:20:03  10:21:46
107 processes: 2 running, 104 sleeping, 1 zombie
CPU:  6.2% user,  0.1% nice,  8.2% system,  0.4% interrupt, 85.1% idle
Mem: 541M Active, 450M Inact, 1333M Wired, 4064K Cache, 1498M Free
ARC: 992M Total, 377M MFU, 589M MRU, 250K Anon, 5280K Header, 21M Other
Swap: 2048M Total, 2048M Free

  PID USERNAME    THR PRI NICE   SIZE    RES STATE   C   TIME   WCPU COMMAND
  557 root          1 -21  r31   136M 42296K select  0   2:20  9.96% Xorg
 8198 dru           2  52    0   449M 82736K select  3   0:08  5.96% kdeinit4
 8311 dru          27  30    0  1150M   187M uwait   1   1:37  0.98% firefox
  431 root          1  20    0 14268K  1728K select  0   0:06  0.98% moused
 9551 dru           1  21    0 16600K  2660K CPU3    3   0:01  0.98% top
 2357 dru           4  37    0   718M   141M select  0   0:21  0.00% kdeinit4
 8705 dru           4  35    0   480M    98M select  2   0:20  0.00% kdeinit4
 8076 dru           6  20    0   552M   113M uwait   0   0:12  0.00% soffice.bin
 2623 root          1  30   10 12088K  1636K select  3   0:09  0.00% powerd
 2338 dru           1  20    0   440M 84532K select  1   0:06  0.00% kwin
 1427 dru           5  22    0   605M 86412K select  1   0:05  0.00% kdeinit4</pre><p>The output is split into two sections.  The header (the
	first five or six lines) shows the <acronym class="acronym">PID</acronym> of
	the last process to run, the system load averages (which are a
	measure of how busy the system is), the system uptime (time
	since the last reboot) and the current time.  The other
	figures in the header relate to how many processes are
	running, how much memory and swap space has been used, and how
	much time the system is spending in different CPU states.  If
	the <acronym class="acronym">ZFS</acronym> file system module has been loaded,
	an <code class="literal">ARC</code> line indicates how much data was
	read from the memory cache instead of from disk.</p><p>Below the header is a series of columns containing similar
	information to the output from <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a>, such as the
	<acronym class="acronym">PID</acronym>, username, amount of CPU time, and the
	command that started the process.  By default, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a>
	also displays the amount of memory space taken by the process.
	This is split into two columns: one for total size and one for
	resident size.  Total size is how much memory the application
	has needed and the resident size is how much it is actually
	using now.</p><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> automatically updates the display every two
	seconds.  A different interval can be specified with
	<code class="option">-s</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="basics-daemons"></a>3.8.2. Killing Processes</h3></div></div></div><p>One way to communicate with any running process or daemon
	is to send a <em class="firstterm">signal</em> using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a>.
	There are a number of different signals; some have a specific
	meaning while others are described in the application's
	documentation.  A user can only send a signal to a process
	they own and sending a signal to someone else's process will
	result in a permission denied error.  The exception is the
	<code class="systemitem">root</code> user, who can
	send signals to anyone's processes.</p><p>The operating system can also send a signal to a process.
	If an application is badly written and tries to access memory
	that it is not supposed to, FreeBSD will send the process the
	<span class="quote">&#8220;<span class="quote">Segmentation Violation</span>&#8221;</span> signal
	(<code class="literal">SIGSEGV</code>).  If an application has been
	written to use the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=alarm&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">alarm</span>(3)</span></a> system call to be alerted
	after a period of time has elapsed, it will be sent the
	<span class="quote">&#8220;<span class="quote">Alarm</span>&#8221;</span> signal
	(<code class="literal">SIGALRM</code>).</p><p>Two signals can be used to stop a process:
	<code class="literal">SIGTERM</code> and <code class="literal">SIGKILL</code>.
	<code class="literal">SIGTERM</code> is the polite way to kill a process
	as the process can read the signal, close any log files it may
	have open, and attempt to finish what it is doing before
	shutting down.  In some cases, a process may ignore
	<code class="literal">SIGTERM</code> if it is in the middle of some task
	that cannot be interrupted.</p><p><code class="literal">SIGKILL</code> cannot be ignored by a
	process.  Sending a <code class="literal">SIGKILL</code> to a
	process will usually stop that process there and then.
	<a href="#ftn.idp51133816" class="footnote" id="idp51133816"><sup class="footnote">[1]</sup></a>.</p><p>Other commonly used signals are <code class="literal">SIGHUP</code>,
	<code class="literal">SIGUSR1</code>, and <code class="literal">SIGUSR2</code>.
	Since these are general purpose signals, different
	applications will respond differently.</p><p>For example, after changing a web server's configuration
	file, the web server needs to be told to re-read its
	configuration.  Restarting <code class="command">httpd</code> would
	result in a brief outage period on the web server.  Instead,
	send the daemon the <code class="literal">SIGHUP</code> signal.  Be
	aware that different daemons will have different behavior, so
	refer to the documentation for the daemon to determine if
	<code class="literal">SIGHUP</code> will achieve the desired
	results.</p><div class="procedure"><a id="idp51137912"></a><div class="procedure-title">Procedure 3.1. Sending a Signal to a Process</div><p>This example shows how to send a signal to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> configuration file is
	  <code class="filename">/etc/inetd.conf</code>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> will
	  re-read this configuration file when it is sent a
	  <code class="literal">SIGHUP</code>.</p><ol class="procedure" type="1"><li class="step"><p>Find the <acronym class="acronym">PID</acronym> of the process to send
	    the signal to using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pgrep&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pgrep</span>(1)</span></a>.  In this example, the
	    <acronym class="acronym">PID</acronym> for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> is 198:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>pgrep -l inetd</code></strong>
198  inetd -wW</pre></li><li class="step"><p>Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> to send the signal.  Because
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> is owned by
	    <code class="systemitem">root</code>, use
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> to become
	    <code class="systemitem">root</code>
	    first.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>su</code></strong>
<code class="prompt">Password:</code>
<code class="prompt">#</code> <strong class="userinput"><code>/bin/kill -s HUP 198</code></strong></pre><p>Like most <span class="trademark">UNIX</span>® commands, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> will not print
	    any output if it is successful.  If a signal is sent to a
	    process not owned by that user, the message
	    <span class="errorname">kill: <em class="replaceable"><code>PID</code></em>: Operation
	      not permitted</span> will be displayed.  Mistyping
	    the <acronym class="acronym">PID</acronym> will either send the signal to
	    the wrong process, which could have negative results, or
	    will send the signal to a <acronym class="acronym">PID</acronym> that is
	    not currently in use, resulting in the error
	    <span class="errorname">kill: <em class="replaceable"><code>PID</code></em>: No such
	      process</span>.</p><div xmlns="" class="note"><h3 class="admontitle">Why Use <code xmlns="http://www.w3.org/1999/xhtml" class="command">/bin/kill</code>?: </h3><p xmlns="http://www.w3.org/1999/xhtml">Many shells provide <code class="command">kill</code> as a
	      built in command, meaning that the shell will send the
	      signal directly, rather than running
	      <code class="filename">/bin/kill</code>.  Be aware that different
	      shells have a different syntax for specifying the name
	      of the signal to send.  Rather than try to learn all of
	      them, it can be simpler to specify
	      <code class="command">/bin/kill</code>.</p></div></li></ol></div><p>When sending other signals, substitute
	<code class="literal">TERM</code> or <code class="literal">KILL</code> with the
	name of the signal.</p><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">Killing a random process on the system is a bad idea.
	  In particular, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>, <acronym class="acronym">PID</acronym> 1, is
	  special.  Running <code class="command">/bin/kill -s KILL 1</code> is
	  a quick, and unrecommended, way to shutdown the system.
	  <span class="emphasis"><em>Always</em></span> double check the arguments to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> <span class="emphasis"><em>before</em></span> pressing
	  <span class="keycap"><strong>Return</strong></span>.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="shells"></a>3.9. Shells</h2></div></div></div><a id="idp51186168" class="indexterm"></a><a id="idp51186936" class="indexterm"></a><p>A <em class="firstterm">shell</em> provides a command line
      interface for interacting with the operating system.  A shell
      receives commands from the input channel and executes them.
      Many shells provide built in functions to help with everyday
      tasks such as file management, file globbing, command line
      editing, command macros, and environment variables.  FreeBSD comes
      with several shells, including the Bourne shell (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a>) and
      the extended C shell (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a>).  Other shells are available
      from the FreeBSD Ports Collection, such as
      <code class="command">zsh</code> and <code class="command">bash</code>.</p><p>The shell that is used is really a matter of taste.  A C
      programmer might feel more comfortable with a C-like shell such
      as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a>.  A <span class="trademark">Linux</span>® user might prefer
      <code class="command">bash</code>.  Each shell has unique properties that
      may or may not work with a user's preferred working environment,
      which is why there is a choice of which shell to use.</p><p>One common shell feature is filename completion.  After a
      user types the first few letters of a command or filename and
      presses <span class="keycap"><strong>Tab</strong></span>, the shell completes the rest of
      the command or filename.  Consider two files called
      <code class="filename">foobar</code> and <code class="filename">football</code>.
      To delete <code class="filename">foobar</code>, the user might type
      <code class="command">rm foo</code> and press <span class="keycap"><strong>Tab</strong></span> to
      complete the filename.</p><p>But the shell only shows <code class="command">rm foo</code>.  It was
      unable to complete the filename because both
      <code class="filename">foobar</code> and <code class="filename">football</code>
      start with <code class="literal">foo</code>.  Some shells sound a beep or
      show all the choices if more than one name matches.  The user
      must then type more characters to identify the desired filename.
      Typing a <code class="literal">t</code> and pressing <span class="keycap"><strong>Tab</strong></span>
      again is enough to let the shell determine which filename is
      desired and fill in the rest.</p><a id="idp51202296" class="indexterm"></a><p>Another feature of the shell is the use of environment
      variables.  Environment variables are a variable/key pair stored
      in the shell's environment.  This environment can be read by any
      program invoked by the shell, and thus contains a lot of program
      configuration.  <a class="xref" href="#shell-env-vars" title="Table 3.4. Common Environment Variables">Table 3.4, &#8220;Common Environment Variables&#8221;</a> provides a list
      of common environment variables and their meanings.  Note that
      the names of environment variables are always in
      uppercase.</p><div class="table"><a id="shell-env-vars"></a><div class="table-title">Table 3.4. Common Environment Variables</div><div class="table-contents"><table class="table" summary="Common Environment Variables" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Variable</th><th>Description</th></tr></thead><tbody><tr><td><code class="envar">USER</code></td><td>Current logged in user's name.</td></tr><tr><td><code class="envar">PATH</code></td><td>Colon-separated list of directories to search for
	      binaries.</td></tr><tr><td><code class="envar">DISPLAY</code></td><td>Network name of the
	      <span class="application">Xorg</span>
	      display to connect to, if available.</td></tr><tr><td><code class="envar">SHELL</code></td><td>The current shell.</td></tr><tr><td><code class="envar">TERM</code></td><td>The name of the user's type of terminal.  Used to
	      determine the capabilities of the terminal.</td></tr><tr><td><code class="envar">TERMCAP</code></td><td>Database entry of the terminal escape codes to
	      perform various terminal functions.</td></tr><tr><td><code class="envar">OSTYPE</code></td><td>Type of operating system.</td></tr><tr><td><code class="envar">MACHTYPE</code></td><td>The system's CPU architecture.</td></tr><tr><td><code class="envar">EDITOR</code></td><td>The user's preferred text editor.</td></tr><tr><td><code class="envar">PAGER</code></td><td>The user's preferred utility for viewing text one
	      page at a time.</td></tr><tr><td><code class="envar">MANPATH</code></td><td>Colon-separated list of directories to search for
	      manual pages.</td></tr></tbody></table></div></div><br class="table-break" /><a id="idp51238264" class="indexterm"></a><p>How to set an environment variable differs between shells.
      In <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a>, use
      <code class="command">setenv</code> to set environment variables.  In
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> and <code class="command">bash</code>, use
      <code class="command">export</code> to set the current environment
      variables.  This example sets the default <code class="envar">EDITOR</code>
      to <code class="filename">/usr/local/bin/emacs</code> for the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a> shell:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>setenv EDITOR /usr/local/bin/emacs</code></strong></pre><p>The equivalent command for <code class="command">bash</code>
      would be:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>export EDITOR="/usr/local/bin/emacs"</code></strong></pre><p>To expand an environment variable in order to see its
      current setting, type a <code class="literal">$</code> character in front
      of its name on the command line.  For example,
      <code class="command">echo $TERM</code> displays the current
      <code class="envar">$TERM</code> setting.</p><p>Shells treat special characters, known as meta-characters,
      as special representations of data.  The most common
      meta-character is <code class="literal">*</code>, which represents any
      number of characters in a filename.  Meta-characters can be used
      to perform filename globbing.  For example, <code class="command">echo
	*</code> is equivalent to <code class="command">ls</code> because
      the shell takes all the files that match <code class="literal">*</code>
      and <code class="command">echo</code> lists them on the command
      line.</p><p>To prevent the shell from interpreting a special character,
      escape it from the shell by starting it with a backslash
      (<code class="literal">\</code>).  For example, <code class="command">echo
	$TERM</code> prints the terminal setting whereas
      <code class="command">echo \$TERM</code> literally prints the string
      <code class="literal">$TERM</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="changing-shells"></a>3.9.1. Changing the Shell</h3></div></div></div><p>The easiest way to permanently change the default shell is
	to use <code class="command">chsh</code>.  Running this command will
	open the editor that is configured in the
	<code class="envar">EDITOR</code> environment variable, which by default
	is set to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a>.  Change the <code class="literal">Shell:</code>
	line to the full path of the new shell.</p><p>Alternately, use <code class="command">chsh -s</code> which will set
	the specified shell without opening an editor.  For example,
	to change the shell to <code class="command">bash</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>chsh -s /usr/local/bin/bash</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The new shell <span class="emphasis"><em>must</em></span> be present in
	  <code class="filename">/etc/shells</code>.  If the shell was
	  installed from the FreeBSD Ports Collection as described in
	  <a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a>, it should be automatically added
	  to this file.  If it is missing, add it using this command,
	  replacing the path with the path of the shell:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo <em class="replaceable"><code>/usr/local/bin/bash</code></em> &gt;&gt; /etc/shells</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Then, rerun <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chsh</span>(1)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp51278712"></a>3.9.2. Advanced Shell Techniques</h3></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>The <span class="trademark">UNIX</span>® shell is not just a command interpreter, it
	acts as a powerful tool which allows users to execute
	commands, redirect their output, redirect their input and
	chain commands together to improve the final command output.
	When this functionality is mixed with built in commands, the
	user is provided with an environment that can maximize
	efficiency.</p><p>Shell redirection is the action of sending the output or
	the input of a command into another command or into a file.
	To capture the output of the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> command, for example,
	into a file, redirect the output:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ls &gt; directory_listing.txt</code></strong></pre><p>The directory contents will now be listed in
	<code class="filename">directory_listing.txt</code>.  Some commands can
	be used to read input, such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sort&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sort</span>(1)</span></a>.  To sort this
	listing, redirect the input:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sort &lt; directory_listing.txt</code></strong></pre><p>The input will be sorted and placed on the screen.  To
	redirect that input into another file, one could redirect the
	output of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sort&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sort</span>(1)</span></a> by mixing the direction:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sort &lt; directory_listing.txt &gt; sorted.txt</code></strong></pre><p>In all of the previous examples, the commands are
	performing redirection using file descriptors.  Every <span class="trademark">UNIX</span>®
	system has file descriptors, which include standard input
	(stdin), standard output (stdout), and standard error
	(stderr).  Each one has a purpose, where input could be a
	keyboard or a mouse, something that provides input.  Output
	could be a screen or paper in a printer.  And error would be
	anything that is used for diagnostic or error messages.  All
	three are considered <acronym class="acronym">I/O</acronym> based file
	descriptors and sometimes considered streams.</p><p>Through the use of these descriptors, the shell allows
	output and input to be passed around through various commands
	and redirected to or from a file.  Another method of
	redirection is the pipe operator.</p><p>The <span class="trademark">UNIX</span>® pipe operator, <span class="quote">&#8220;<span class="quote">|</span>&#8221;</span> allows the
	output of one command to be directly passed or directed to
	another program.  Basically, a pipe allows the standard
	output of a command to be passed as standard input to another
	command, for example:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cat directory_listing.txt | sort | less</code></strong></pre><p>In that example, the contents of
	<code class="filename">directory_listing.txt</code> will be sorted and
	the output passed to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=less&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">less</span>(1)</span></a>.  This allows the user to
	scroll through the output at their own pace and prevent it
	from scrolling off the screen.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="editors"></a>3.10. Text Editors</h2></div></div></div><a id="idp51304184" class="indexterm"></a><a id="idp51304952" class="indexterm"></a><p>Most FreeBSD configuration is done by editing text files.
      Because of this, it is a good idea to become familiar with a
      text editor.  FreeBSD comes with a few as part of the base system,
      and many more are available in the Ports Collection.</p><a id="idp51318392" class="indexterm"></a><a id="idp51319288" class="indexterm"></a><p>A simple editor to learn is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ee&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ee</span>(1)</span></a>, which stands for
      easy editor.  To start this editor, type <code class="command">ee
	<em class="replaceable"><code>filename</code></em></code> where
      <em class="replaceable"><code>filename</code></em> is the name of the file to
      be edited.  Once inside the editor, all of the commands for
      manipulating the editor's functions are listed at the top of the
      display.  The caret (<code class="literal">^</code>) represents
      <span class="keycap"><strong>Ctrl</strong></span>, so <code class="literal">^e</code> expands to
      <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>e</strong></span>.  To leave <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ee&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ee</span>(1)</span></a>, press <span class="keycap"><strong>Esc</strong></span>,
      then choose the <span class="quote">&#8220;<span class="quote">leave editor</span>&#8221;</span> option from the main
      menu.  The editor will prompt to save any changes if the file
      has been modified.</p><a id="idp51327224" class="indexterm"></a><a id="idp51328120" class="indexterm"></a><a id="idp51328888" class="indexterm"></a><p>FreeBSD also comes with more powerful text editors, such as
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a>, as part of the base system.  Other editors, like
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/editors/emacs/pkg-descr">editors/emacs</a> and
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/editors/vim/pkg-descr">editors/vim</a>, are part of the
      FreeBSD Ports Collection.  These editors offer more functionality
      at the expense of being more complicated to learn.  Learning a
      more powerful editor such as <span class="application">vim</span> or
      <span class="application">Emacs</span> can save more time in the long
      run.</p><p>Many applications which modify files or require typed input
      will automatically open a text editor.  To change the default
      editor, set the <code class="envar">EDITOR</code> environment
      variable as described in <a class="xref" href="#shells" title="3.9. Shells">Section 3.9, &#8220;Shells&#8221;</a>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-devices"></a>3.11. Devices and Device Nodes</h2></div></div></div><p>A device is a term used mostly for hardware-related
      activities in a system, including disks, printers, graphics
      cards, and keyboards.  When FreeBSD boots, the majority of the boot
      messages refer to devices being detected.  A copy of the boot
      messages are saved to
      <code class="filename">/var/run/dmesg.boot</code>.</p><p>Each device has a device name and number.  For example,
      <code class="filename">ada0</code> is the first SATA hard drive,
      while <code class="filename">kbd0</code> represents the
      keyboard.</p><p>Most devices in FreeBSD must be accessed through special
      files called device nodes, which are located in
      <code class="filename">/dev</code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-more-information"></a>3.12. Manual Pages</h2></div></div></div><a id="idp51342328" class="indexterm"></a><p>The most comprehensive documentation on FreeBSD is in the form
      of manual pages.  Nearly every program on the system comes with
      a short reference manual explaining the basic operation and
      available arguments.  These manuals can be viewed using
      <code class="command">man</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>man <em class="replaceable"><code>command</code></em></code></strong></pre><p>where <em class="replaceable"><code>command</code></em> is the name of the
      command to learn about.  For example, to learn more about
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a>, type:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>man ls</code></strong></pre><p>Manual pages are divided into sections which represent the
      type of topic.  In FreeBSD, the following sections are
      available:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>User commands.</p></li><li class="listitem"><p>System calls and error numbers.</p></li><li class="listitem"><p>Functions in the C libraries.</p></li><li class="listitem"><p>Device drivers.</p></li><li class="listitem"><p>File formats.</p></li><li class="listitem"><p>Games and other diversions.</p></li><li class="listitem"><p>Miscellaneous information.</p></li><li class="listitem"><p>System maintenance and operation commands.</p></li><li class="listitem"><p>System kernel interfaces.</p></li></ol></div><p>In some cases, the same topic may appear in more than one
      section of the online manual.  For example, there is a
      <code class="command">chmod</code> user command and a
      <code class="function">chmod()</code> system call.  To tell <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=man&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">man</span>(1)</span></a>
      which section to display, specify the section number:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>man 1 chmod</code></strong></pre><p>This will display the manual page for the user command
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a>.  References to a particular section of the
      online manual are traditionally placed in parenthesis in
      written documentation, so <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a> refers to the user
      command and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chmod</span>(2)</span></a> refers to the system call.</p><p>If the name of the manual page is unknown, use <code class="command">man
	-k</code> to search for keywords in the manual page
      descriptions:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>man -k <em class="replaceable"><code>mail</code></em></code></strong></pre><p>This command displays a list of commands that have the
      keyword <span class="quote">&#8220;<span class="quote">mail</span>&#8221;</span> in their descriptions.  This is
      equivalent to using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=apropos&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">apropos</span>(1)</span></a>.</p><p>To read the descriptions for all of the commands in
      <code class="filename">/usr/bin</code>, type:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd /usr/bin</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>man -f * | more</code></strong></pre><p>or</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd /usr/bin</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>whatis * |more</code></strong></pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="basics-info"></a>3.12.1. GNU Info Files</h3></div></div></div><a id="idp51377656" class="indexterm"></a><p>FreeBSD includes several applications and utilities produced
	by the Free Software Foundation (FSF).  In addition to manual
	pages, these programs may include hypertext documents called
	<code class="literal">info</code> files.  These can be viewed using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=info&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">info</span>(1)</span></a> or, if <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/editors/emacs/pkg-descr">editors/emacs</a> is
	installed, the info mode of
	<span class="application">emacs</span>.</p><p>To use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=info&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">info</span>(1)</span></a>, type:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>info</code></strong></pre><p>For a brief introduction, type <code class="literal">h</code>.  For
	a quick command reference, type <code class="literal">?</code>.</p></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp51133816" class="footnote"><p><a href="#idp51133816" class="para"><sup class="para">[1] </sup></a>There are a few tasks that cannot be
	    interrupted.  For example, if the process is trying to
	    read from a file that is on another computer on the
	    network, and the other computer is unavailable, the
	    process is said to be <span class="quote">&#8220;<span class="quote">uninterruptible</span>&#8221;</span>.
	    Eventually the process will time out, typically after two
	    minutes.  As soon as this time out occurs the process will
	    be killed.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports"></a>Chapter 4. Installing Applications: Packages and Ports</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#ports-synopsis">4.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#ports-overview">4.2. Overview of Software Installation</a></span></dt><dt><span class="sect1"><a href="#ports-finding-applications">4.3. Finding Software</a></span></dt><dt><span class="sect1"><a href="#pkgng-intro">4.4. Using <span class="application">pkg</span> for Binary Package
      Management</a></span></dt><dt><span class="sect1"><a href="#ports-using">4.5. Using the Ports Collection</a></span></dt><dt><span class="sect1"><a href="#ports-poudriere">4.6. Building Packages with
      <span class="application">Poudriere</span></a></span></dt><dt><span class="sect1"><a href="#ports-nextsteps">4.7. Post-Installation Considerations</a></span></dt><dt><span class="sect1"><a href="#ports-broken">4.8. Dealing with Broken Ports</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-synopsis"></a>4.1. Synopsis</h2></div></div></div><a id="idp51398520" class="indexterm"></a><a id="idp51399032" class="indexterm"></a><p>FreeBSD is bundled with a rich collection of system tools as
      part of the base system.  In addition,  FreeBSD provides two
      complementary technologies for installing third-party software:
      the FreeBSD Ports Collection, for installing from source, and
      packages, for installing from pre-built binaries.  Either
      method may be used to install software from local media or
      from the network.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The difference between binary packages and ports.</p></li><li class="listitem"><p>How to find third-party software that has been ported
	  to FreeBSD.</p></li><li class="listitem"><p>How to manage binary packages using
	  <span class="application">pkg</span>.</p></li><li class="listitem"><p>How to build third-party software from source using the
	  Ports Collection.</p></li><li class="listitem"><p>How to find the files installed with the application
	  for post-installation configuration.</p></li><li class="listitem"><p>What to do if a software installation fails.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-overview"></a>4.2. Overview of Software Installation</h2></div></div></div><p>The typical steps for installing third-party software on a
      <span class="trademark">UNIX</span>® system include:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Find and download the software, which might be
	  distributed in source code format or as a binary.</p></li><li class="step"><p>Unpack the software from its distribution format.  This
	  is typically a tarball compressed with a program such as
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=compress&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">compress</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gzip&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gzip</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bzip2&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bzip2</span>(1)</span></a> or
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xz&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xz</span>(1)</span></a>.</p></li><li class="step"><p>Locate the documentation in
	  <code class="filename">INSTALL</code>, <code class="filename">README</code>
	  or some file in a <code class="filename">doc/</code> subdirectory and
	  read up on how to install the software.</p></li><li class="step"><p>If the software was distributed in source format,
	  compile it.  This may involve editing a
	  <code class="filename">Makefile</code> or running a
	  <code class="command">configure</code> script.</p></li><li class="step"><p>Test and install the software.</p></li></ol></div><p>A FreeBSD <span class="emphasis"><em>port</em></span> is a collection of files
      designed to automate
      the process of compiling an application from source code.  The
      files that comprise a port contain all the necessary information
      to automatically download, extract, patch, compile, and install
      the application.</p><p>If the software has not already been adapted and tested
      on FreeBSD, the source code might need editing in
      order for it to install and run properly.</p><p>However, over <a class="link" href="../../../../ports/index.html" target="_top">24,000</a>
      third-party applications have already been ported to FreeBSD.  When
      feasible, these applications are made available for download as
      pre-compiled <span class="emphasis"><em>packages</em></span>.</p><p>Packages
      can be manipulated with the FreeBSD package management
      commands.</p><p>Both packages and ports understand dependencies.  If a
      package or port is used to install an application and a
      dependent library is not already installed, the library will
      automatically be installed first.</p><p>A FreeBSD package contains pre-compiled copies of all the
      commands for an application, as well as any configuration files
      and documentation.  A package can be manipulated with the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg</span>(8)</span></a> commands, such as
      <code class="command">pkg install</code>.</p><p>While the two technologies are similar, packages and
      ports each have their own strengths.  Select the technology that
      meets your requirements for installing a particular
      application.</p><div class="itemizedlist"><div class="itemizedlist-title">Package Benefits</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A compressed package tarball is typically smaller than
	  the compressed tarball containing the source code for the
	  application.</p></li><li class="listitem"><p>Packages do not require compilation time.  For large
	  applications, such as <span class="application">Mozilla</span>,
	  <span class="application">KDE</span>, or
	  <span class="application">GNOME</span>, this can be important
	  on a slow system.</p></li><li class="listitem"><p>Packages do not require any understanding of the process
	  involved in compiling software on FreeBSD.</p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Port Benefits</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Packages are normally compiled with conservative
	  options because they have to run on the maximum number of
	  systems.  By compiling from the port, one can change the
	  compilation options.</p></li><li class="listitem"><p>Some applications have compile-time options relating to
	  which features are installed.  For example,
	  <span class="application">Apache</span> can be configured with a
	  wide variety of different built-in options.</p><p>In some cases, multiple packages will exist for the same
	  application to specify certain settings.  For example,
	  <span class="application">Ghostscript</span> is available as a
	  <code class="filename">ghostscript</code> package and a
	  <code class="filename">ghostscript-nox11</code> package, depending on
	  whether or not <span class="application">Xorg</span> is installed.
	  Creating multiple packages rapidly becomes impossible if an
	  application has more than one or two different compile-time
	  options.</p></li><li class="listitem"><p>The licensing conditions of some software forbid binary
	  distribution.  Such software must be distributed as source
	  code which must be compiled by the end-user.</p></li><li class="listitem"><p>Some people do not trust binary distributions or prefer
	  to read through source code in order to look for potential
	  problems.</p></li><li class="listitem"><p>Source code is needed in
	  order to apply custom patches.</p></li></ul></div><p>To keep track of updated ports, subscribe to the
      <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports" target="_top">FreeBSD ports mailing list</a> and the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-bugs" target="_top">FreeBSD ports bugs mailing list</a>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Before installing any application, check <a class="link" href="https://vuxml.freebsd.org/" target="_top">https://vuxml.freebsd.org/</a>
	for security issues related to the application or type
	<code class="command">pkg audit -F</code> to check all installed
	applications for known vulnerabilities.</p></div><p>The remainder of this chapter explains how to use packages
      and ports to install and manage third-party software on
      FreeBSD.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-finding-applications"></a>4.3. Finding Software</h2></div></div></div><p>FreeBSD's list of available applications is growing all the
      time.  There are a number of ways to find software to
      install:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The FreeBSD web site maintains an up-to-date searchable
	  list of all the available applications, at <a class="link" href="../../../../ports/index.html" target="_top">https://www.FreeBSD.org/ports/</a>.
	  The ports can be searched by application name or by
	  software category.</p></li><li class="listitem"><a id="idp51460088" class="indexterm"></a><p>Dan Langille maintains <a class="link" href="http://www.FreshPorts.org/" target="_top">FreshPorts.org</a>
	  which provides a comprehensive search utility and also
	  tracks changes to the applications in the Ports Collection.
	  Registered users can create a customized watch list in order
	  to receive an automated email when their watched ports are
	  updated.</p></li><li class="listitem"><a id="idp51461880" class="indexterm"></a><p>If finding a particular application becomes challenging,
	  try searching a site like <a class="link" href="http://www.sourceforge.net/" target="_top">SourceForge.net</a>
	  or <a class="link" href="http://www.github.com/" target="_top">GitHub.com</a> then
	  check back at the <a class="link" href="../../../../ports/index.html" target="_top">FreeBSD site</a>
	  to see if the application has been ported.</p></li><li class="listitem"><a id="idp51464696" class="indexterm"></a><p><a id="pkg-search"></a>To search the binary package
	  repository for an application:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg search <em class="replaceable"><code>subversion</code></em></code></strong>
git-subversion-<em class="replaceable"><code>1.9.2</code></em>
java-subversion-<em class="replaceable"><code>1.8.8_2</code></em>
p5-subversion-<em class="replaceable"><code>1.8.8_2</code></em>
py27-hgsubversion-<em class="replaceable"><code>1.6</code></em>
py27-subversion-<em class="replaceable"><code>1.8.8_2</code></em>
ruby-subversion-<em class="replaceable"><code>1.8.8_2</code></em>
subversion-<em class="replaceable"><code>1.8.8_2</code></em>
subversion-book-<em class="replaceable"><code>4515</code></em>
subversion-static-<em class="replaceable"><code>1.8.8_2</code></em>
subversion16-<em class="replaceable"><code>1.6.23_4</code></em>
subversion17-<em class="replaceable"><code>1.7.16_2</code></em></pre><p>Package names include the version number and, in the
	  case of ports based on python, the version number of the
	  version of python the package was built with.  Some ports
	  also have multiple versions available.  In the case of
	  <span class="application">Subversion</span>, there are different
	  versions available, as well as different compile options.
	  In this case, the statically linked version of
	  <span class="application">Subversion</span>.  When indicating
	  which package to install, it is best to specify the
	  application by the port origin, which is the path in the
	  ports tree.  Repeat the <code class="command">pkg search</code> with
	  <code class="option">-o</code> to list the origin of each
	  package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg search -o <em class="replaceable"><code>subversion</code></em></code></strong>
devel/git-subversion
java/java-subversion
devel/p5-subversion
devel/py-hgsubversion
devel/py-subversion
devel/ruby-subversion
devel/subversion16
devel/subversion17
devel/subversion
devel/subversion-book
devel/subversion-static</pre><p>Searching by shell globs, regular expressions, exact
	  match, by description, or any other field in the repository
	  database is also supported by <code class="command">pkg search</code>.
	  After installing <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/pkg/pkg-descr">ports-mgmt/pkg</a> or
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/pkg-devel/pkg-descr">ports-mgmt/pkg-devel</a>, see
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg-search&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg-search</span>(8)</span></a> for more details.</p></li><li class="listitem"><p>If the Ports Collection is already installed, there are
	  several methods to query the local version of the ports
	  tree.  To find out which category a port is in, type
	  <code class="command">whereis <em class="replaceable"><code>file</code></em></code>,
	  where <em class="replaceable"><code>file</code></em> is the program to be
	  installed:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>whereis lsof</code></strong>
lsof: /usr/ports/sysutils/lsof</pre><p>Alternately, an <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=echo&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">echo</span>(1)</span></a> statement can be
	  used:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo /usr/ports/*/*lsof*</code></strong>
/usr/ports/sysutils/lsof</pre><p>Note that this will also return any matched files
	  downloaded into the
	  <code class="filename">/usr/ports/distfiles</code> directory.</p></li><li class="listitem"><p>Another way to find software is by using the Ports
	  Collection's built-in search mechanism.  To use the search
	  feature, <span class="application">cd</span> to
	  <code class="filename">/usr/ports</code> then run <code class="command">make
	    search name=program-name</code> where
	  <em class="replaceable"><code>program-name</code></em> is the name of the
	  software.  For example, to search for
	  <code class="command">lsof</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make search name=lsof</code></strong>
Port:   lsof-4.88.d,8
Path:   /usr/ports/sysutils/lsof
Info:   Lists information about open files (similar to fstat(1))
Maint:  ler@lerctr.org
Index:  sysutils
B-deps:
R-deps: </pre><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">The built-in search mechanism uses a file
	    of index information.  If a message indicates that the
	    <code class="filename">INDEX</code> is required, run
	    <code class="command">make fetchindex</code> to download the current
	    index file.  With the <code class="filename">INDEX</code> present,
	    <code class="command">make search</code> will be able to perform the
	    requested search.</p></div><p>The <span class="quote">&#8220;<span class="quote">Path:</span>&#8221;</span> line indicates where to find
	  the port.</p><p>To receive less information, use the
	  <code class="command">quicksearch</code> feature:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make quicksearch name=lsof</code></strong>
Port:   lsof-4.88.d,8
Path:   /usr/ports/sysutils/lsof
Info:   Lists information about open files (similar to fstat(1))</pre><p>For more in-depth searching, use
	  <code class="command">make search
	  key=<em class="replaceable"><code>string</code></em></code> or
	  <code class="command">make quicksearch
	  key=<em class="replaceable"><code>string</code></em></code>, where
	  <em class="replaceable"><code>string</code></em> is some text to search
	  for.  The text can be in comments, descriptions, or
	  dependencies in order to find ports which relate to a
	  particular subject when the name of the program is
	  unknown.</p><p>When using <code class="buildtarget">search</code> or
	  <code class="buildtarget">quicksearch</code>, the search string
	  is case-insensitive.  Searching for <span class="quote">&#8220;<span class="quote">LSOF</span>&#8221;</span> will
	  yield the same results as searching for
	  <span class="quote">&#8220;<span class="quote">lsof</span>&#8221;</span>.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pkgng-intro"></a>4.4. Using <span class="application">pkg</span> for Binary Package
      Management</h2></div></div></div><p><span class="application">pkg</span> is the next generation
      replacement for the traditional FreeBSD package management tools,
      offering many features that make dealing with binary packages
      faster and easier.</p><p>For sites wishing to only use prebuilt binary packages
      from the FreeBSD mirrors, managing packages with
      <span class="application">pkg</span> can be sufficient.</p><p>However, for those sites building from source or using their
      own repositories, a separate <a class="link" href="#ports-upgrading-tools" title="4.5.3.1. Tools to Upgrade and Manage Ports">port management tool</a>
      will be needed.</p><p>Since <span class="application">pkg</span> only works with
      binary packages, it
      is not a replacement for such tools.  Those tools can be
      used to install software from both binary packages
      and the Ports Collection, while
      <span class="application">pkg</span> installs only binary
      packages.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-initial-setup"></a>4.4.1. Getting Started with
	<span class="application">pkg</span></h3></div></div></div><p>FreeBSD includes a bootstrap utility which can be used to
	download and install <span class="application">pkg</span>
	and its manual pages.  This utility is designed to work
	with versions of FreeBSD starting with
	10.<em class="replaceable"><code>X</code></em>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Not all FreeBSD versions and architectures
	  support this bootstrap process.  The current list is at
	  <a class="link" href="https://pkg.freebsd.org/" target="_top">https://pkg.freebsd.org/</a>.
	  For other cases,
	  <span class="application">pkg</span> must instead be installed
	  from the Ports Collection or as a binary package.</p></div><p>To bootstrap the system, run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/sbin/pkg</code></strong></pre><p>You must have a working Internet connection for the
	bootstrap process to succeed.</p><p>Otherwise, to install the port, run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/ports-mgmt/pkg</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>When upgrading an existing system that originally used the
	older pkg_* tools, the database must be converted to the
	new format, so that the new tools are aware of the already
	installed packages.  Once <span class="application">pkg</span> has
	been installed, the
	package database must be converted from the traditional format
	to the new format by running this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg2ng</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">This step is not required for new installations that
	do not yet have any third-party software
	installed.</p></div><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">This step is not reversible.  Once the package database
	  has been converted to the <span class="application">pkg</span>
	  format, the traditional <code class="literal">pkg_*</code> tools
	  should no longer be used.</p></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The package database conversion may emit errors as the
	  contents are converted to the new version.  Generally, these
	  errors can be safely ignored.  However, a list of
	  software that was not successfully converted
	  is shown after <code class="command">pkg2ng</code> finishes.
	  These applications must be manually reinstalled.</p></div><p>To ensure that the Ports Collection registers
	new software with <span class="application">pkg</span> instead of
	the traditional packages database, FreeBSD versions earlier than
	10.<em class="replaceable"><code>X</code></em> require this line in
	<code class="filename">/etc/make.conf</code>:</p><pre class="programlisting">WITH_PKGNG=	yes</pre><p>By default, <span class="application">pkg</span> uses the
	binary packages from the FreeBSD
	package mirrors (the <span class="emphasis"><em>repository</em></span>).
	For information about building a custom
	package repository, see
	<a class="xref" href="#ports-poudriere" title="4.6. Building Packages with Poudriere">Section 4.6, &#8220;Building Packages with
      <span class="application">Poudriere</span>&#8221;</a>.</p><p>Additional <span class="application">pkg</span> configuration
	options are described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg.conf</span>(5)</span></a>.</p><p>Usage information for <span class="application">pkg</span> is
	available in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg</span>(8)</span></a> manual page or by running
	<code class="command">pkg</code> without additional arguments.</p><p>Each <span class="application">pkg</span> command argument is
	documented in a command-specific manual page.  To read the
	manual page for <code class="command">pkg install</code>, for example,
	run either of these commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg help install</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>man pkg-install</code></strong></pre><p>The rest of this section demonstrates common binary
	package management tasks which can be performed using
	<span class="application">pkg</span>.  Each demonstrated command
	provides many switches to customize its use.  Refer to a
	command's help or man page for details and more
	examples.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="quarterly-latest-branch"></a>4.4.2. Quarterly and Latest Ports Branches</h3></div></div></div><p>The <code class="literal">Quarterly</code> branch provides users
	with a more predictable and stable experience for port and
	package installation and upgrades.  This is done essentially
	by only allowing non-feature updates.  Quarterly branches aim
	to receive security fixes (that may be version updates, or
	backports of commits), bug fixes and ports compliance or
	framework changes.  The Quarterly branch is cut from HEAD at
	the beginning of every (yearly) quarter in January, April,
	July, and October.  Branches are named according to the year
	(YYYY) and quarter (Q1-4) they are created in.  For example,
	the quarterly branch created in January 2016, is named 2016Q1.
	And the <code class="literal">Latest</code> branch provides the latest
	versions of the packages to the users.</p><p>To switch from quarterly to latest run the following
	commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /etc/pkg/FreeBSD.conf /usr/local/etc/pkg/repos/FreeBSD.conf</code></strong></pre><p>Edit the file
	<code class="filename">/usr/local/etc/pkg/repos/FreeBSD.conf</code>
	and change the string <span class="emphasis"><em>quarterly</em></span> to
	<span class="emphasis"><em>latest</em></span> in the <code class="literal">url:</code>
	line.</p><p>The result should be similar to the following:</p><pre class="programlisting">FreeBSD: {
  url: "pkg+http://pkg.FreeBSD.org/${ABI}/latest",
  mirror_type: "srv",
  signature_type: "fingerprints",
  fingerprints: "/usr/share/keys/pkg",
  enabled: yes
}</pre><p>And finally run this command to update from the new
	(latest) repository metadata.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg update -f</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-pkg-info"></a>4.4.3. Obtaining Information About Installed Packages</h3></div></div></div><p>Information about the packages installed on a system
	can be viewed by running <code class="command">pkg info</code> which,
	when run without any switches, will list the package version
	for either all installed packages or the specified
	package.</p><p>For example, to see which version of
	<span class="application">pkg</span> is installed, run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg info pkg</code></strong>
pkg-1.1.4_1</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-installing-deinstalling"></a>4.4.4. Installing and Removing Packages</h3></div></div></div><p>To install a binary package use the following command,
	where <em class="replaceable"><code>packagename</code></em> is the name of
	the package to install:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install <em class="replaceable"><code>packagename</code></em></code></strong></pre><p>This command uses repository data to determine which
	version of the software to install and if it has any
	uninstalled dependencies.  For example, to install
	<span class="application">curl</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install curl</code></strong>
Updating repository catalogue
/usr/local/tmp/All/curl-7.31.0_1.txz          100% of 1181 kB 1380 kBps 00m01s

/usr/local/tmp/All/ca_root_nss-3.15.1_1.txz   100% of  288 kB 1700 kBps 00m00s

Updating repository catalogue
The following 2 packages will be installed:

        Installing ca_root_nss: 3.15.1_1
        Installing curl: 7.31.0_1

The installation will require 3 MB more space

0 B to be downloaded

Proceed with installing packages [y/N]: <strong class="userinput"><code>y</code></strong>
Checking integrity... done
[1/2] Installing ca_root_nss-3.15.1_1... done
[2/2] Installing curl-7.31.0_1... done
Cleaning up cache files...Done</pre><p>The new package and any additional packages that were
	  installed as dependencies can be seen in the installed
	  packages list:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg info</code></strong>
ca_root_nss-3.15.1_1	The root certificate bundle from the Mozilla Project
curl-7.31.0_1	Non-interactive tool to get files from FTP, GOPHER, HTTP(S) servers
pkg-1.1.4_6	New generation package manager</pre><p>Packages that are no longer needed can be removed with
	  <code class="command">pkg delete</code>.  For example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg delete curl</code></strong>
The following packages will be deleted:

	curl-7.31.0_1

The deletion will free 3 MB

Proceed with deleting packages [y/N]: <strong class="userinput"><code>y</code></strong>
[1/1] Deleting curl-7.31.0_1... done</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-upgrading"></a>4.4.5. Upgrading Installed Packages</h3></div></div></div><p>Installed packages can be upgraded to their latest
	versions by running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg upgrade</code></strong></pre><p>This command will compare the installed versions with
	those available in the repository catalogue and upgrade them
	from the repository.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-auditing"></a>4.4.6. Auditing Installed Packages</h3></div></div></div><p>Software vulnerabilities are regularly discovered
	in third-party applications.  To address this,
	<span class="application">pkg</span> includes a built-in auditing
	mechanism.  To determine if there are any known
	vulnerabilities for the software installed on the system,
	run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg audit -F</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-autoremove"></a>4.4.7. Automatically Removing Unused Packages</h3></div></div></div><p>Removing a package may leave behind dependencies which
	are no longer required.  Unneeded packages that were installed
	as dependencies (leaf packages) can be automatically detected
	and removed using:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg autoremove</code></strong>
Packages to be autoremoved:
	ca_root_nss-3.15.1_1

The autoremoval will free 723 kB

Proceed with autoremoval of packages [y/N]: <strong class="userinput"><code>y</code></strong>
Deinstalling ca_root_nss-3.15.1_1... done</pre><p>Packages installed as dependencies are
	called <span class="emphasis"><em>automatic</em></span> packages.  Non-automatic
	packages, i.e the packages that were explicity installed not
	as a dependency to another package, can be listed
	using:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg prime-list</code></strong>
nginx
openvpn
sudo</pre><p><code class="command">pkg prime-list</code> is an alias command
	declared in <code class="filename">/usr/local/etc/pkg.conf</code>.
	There are many others that can be used to query the package
	database of the system.  For instance, command
	<code class="command">pkg prime-origins</code> can be used to get the
	origin port directory of the list mentioned above:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg prime-origins</code></strong>
www/nginx
security/openvpn
security/sudo</pre><p>This list can be used to rebuild all packages
	installed on a system using build tools such as <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/&#10;&#9;ports-mgmt/poudriere/pkg-descr">
	ports-mgmt/poudriere</a> or <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/&#10;&#9;ports-mgmt/synth/pkg-descr">
	ports-mgmt/synth</a>.</p><p>Marking an installed package as automatic can be
      done using:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -A 1 devel/cmake</code></strong></pre><p>Once a package is a leaf package and is marked
	as automatic, it gets selected by
	<code class="command">pkg autoremove</code>.</p><p>Marking an installed package as <span class="emphasis"><em>not</em></span>
	automatic can be done using:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -A 0 devel/cmake</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-backup"></a>4.4.8. Restoring the Package Database</h3></div></div></div><p>Unlike the traditional package management system,
	<span class="application">pkg</span> includes its own package
	database backup mechanism.  This functionality is enabled by
	default.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">To disable the periodic script from backing up the
	  package database, set
	  <code class="literal">daily_backup_pkgdb_enable="NO"</code> in
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic.conf</span>(5)</span></a>.</p></div><p>To restore the contents of a previous package database
	backup, run the following command replacing
	<em class="replaceable"><code>/path/to/pkg.sql</code></em> with the location
	of the backup:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg backup -r <em class="replaceable"><code>/path/to/pkg.sql</code></em></code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If restoring a backup taken by the periodic script,
	  it must be decompressed prior to being restored.</p></div><p>To run a manual backup of the
	<span class="application">pkg</span> database, run the following
	command, replacing <em class="replaceable"><code>/path/to/pkg.sql</code></em>
	with a suitable file name and location:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg backup -d <em class="replaceable"><code>/path/to/pkg.sql</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-clean"></a>4.4.9. Removing Stale Packages</h3></div></div></div><p>By default, <span class="application">pkg</span> stores
	binary packages in a cache directory defined by
	<code class="envar">PKG_CACHEDIR</code> in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg.conf</span>(5)</span></a>.  Only copies
	of the latest installed packages are kept.  Older versions of
	<span class="application">pkg</span> kept all previous packages.  To
	remove these outdated binary packages, run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg clean</code></strong></pre><p>The entire cache may be cleared by running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg clean -a</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-set"></a>4.4.10. Modifying Package Metadata</h3></div></div></div><p>Software within the FreeBSD Ports Collection can
	undergo major version number changes.  To address this,
	<span class="application">pkg</span> has a built-in command to
	update package origins.  This can be useful, for example, if
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/php5/pkg-descr">lang/php5</a> is renamed to
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/php53/pkg-descr">lang/php53</a> so that
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/php5/pkg-descr">lang/php5</a> can now
	represent version <code class="literal">5.4</code>.</p><p>To change the package origin for the above example,
	run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -o lang/php5:lang/php53</code></strong></pre><p>As another example, to update
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/ruby18/pkg-descr">lang/ruby18</a> to
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/ruby19/pkg-descr">lang/ruby19</a>, run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -o lang/ruby18:lang/ruby19</code></strong></pre><p>As a final example, to change the origin of the
	<code class="filename">libglut</code> shared libraries from
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/libglut/pkg-descr">graphics/libglut</a> to
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/freeglut/pkg-descr">graphics/freeglut</a>, run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -o graphics/libglut:graphics/freeglut</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">When changing package origins, it is important to
	  reinstall packages that are dependent on the package with
	  the modified origin.  To force a reinstallation of dependent
	  packages, run:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install -Rf <em class="replaceable"><code>graphics/freeglut</code></em></code></strong></pre></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-using"></a>4.5. Using the Ports Collection</h2></div></div></div><p>The Ports Collection is a set of
      <code class="filename">Makefile</code>s, patches, and description files.
      Each set of these files is used to compile and install an
      individual application on FreeBSD, and is called a
      <span class="emphasis"><em>port</em></span>.</p><p>By default, the Ports Collection itself is stored as a
      subdirectory of <code class="filename">/usr/ports</code>.</p><p>Before an application can be compiled using a port, the
      Ports Collection must first be installed.  If it was not
      installed during the installation of FreeBSD, use one of the
      following methods to install it:</p><div class="procedure"><a id="ports-using-portsnap-method"></a><div class="procedure-title">Procedure 4.1. Portsnap Method</div><p>The base system of FreeBSD includes
	<span class="application">Portsnap</span>.  This is a fast and
	user-friendly tool for retrieving the Ports Collection and
	is the recommended choice for most users not running
	FreeBSD-CURRENT.  This utility
	connects to a FreeBSD site, verifies the secure key, and
	downloads a new copy of the Ports Collection.  The key is used
	to verify the integrity of all downloaded files.</p><ol class="procedure" type="1"><li class="step"><p>To download a compressed snapshot of the Ports
	  Collection into
	  <code class="filename">/var/db/portsnap</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch</code></strong></pre></li><li class="step"><p>When running <span class="application">Portsnap</span> for the
	  first time, extract the snapshot into
	  <code class="filename">/usr/ports</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap extract</code></strong></pre></li><li class="step"><p>After the first use of
	  <span class="application">Portsnap</span> has been completed as
	  shown above, <code class="filename">/usr/ports</code> can be updated
	  as needed by running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>portsnap update</code></strong></pre><p>When using <code class="literal">fetch</code>, the
	  <code class="literal">extract</code> or the <code class="literal">update</code>
	  operation may be run consecutively, like so:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch update</code></strong></pre></li></ol></div><div class="procedure"><a id="ports-using-subversion-method"></a><div class="procedure-title">Procedure 4.2. Subversion Method</div><p>If more control over the ports tree is needed or if local
	changes need to be maintained, or if running FreeBSD-CURRENT,
	<span class="application">Subversion</span> can be used to obtain
	the Ports Collection.  Refer to <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/committers-guide/subversion-primer.html" target="_top">the
	  Subversion Primer</a> for a detailed description of
	<span class="application">Subversion</span>.</p><ol class="procedure" type="1"><li class="step"><p><span class="application">Subversion</span> must be installed
	  before it can be used to check out the ports tree.  If a
	  copy of the ports tree is already present, install
	  <span class="application">Subversion</span> like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/devel/subversion</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>If the ports tree is not available, or
	  <span class="application">pkg</span> is being used to manage
	  packages, <span class="application">Subversion</span> can be
	  installed as a package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install subversion</code></strong></pre></li><li class="step"><p>Check out a copy of the ports tree:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svn checkout https://svn.FreeBSD.org/ports/head /usr/ports</code></strong></pre></li><li class="step"><p>As needed, update <code class="filename">/usr/ports</code> after
	  the initial <span class="application">Subversion</span>
	  checkout:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svn update /usr/ports</code></strong></pre></li></ol></div><p>The Ports Collection contains directories
      for software categories.  Inside each category are
      subdirectories for individual applications.  Each application
      subdirectory contains a set of files that
      tells FreeBSD how to compile and install that program,
      called a <span class="emphasis"><em>ports skeleton</em></span>.  Each port
      skeleton includes these files and directories:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">Makefile</code>: contains statements that
	  specify how the application should be compiled and where
	  its components should be installed.</p></li><li class="listitem"><p><code class="filename">distinfo</code>: contains the names and
	  checksums of the files that must be downloaded to build the
	  port.</p></li><li class="listitem"><p><code class="filename">files/</code>: this directory contains
	  any patches needed for the program to compile and install
	  on FreeBSD.  This directory may also contain other files used
	  to build the port.</p></li><li class="listitem"><p><code class="filename">pkg-descr</code>: provides a more detailed
	  description of the program.</p></li><li class="listitem"><p><code class="filename">pkg-plist</code>:  a list of all the
	  files that will be installed by the port.  It also tells
	  the ports system which files to remove upon
	  deinstallation.</p></li></ul></div><p>Some ports include <code class="filename">pkg-message</code> or
      other files to handle special situations.  For more details
      on these files, and on ports in general, refer to the <a class="link" href="../../../../doc/en_US.ISO8859-1/books/porters-handbook/index.html" target="_top">FreeBSD
	Porter's Handbook</a>.</p><p>The port does not include the actual source code, also
      known as a <code class="filename">distfile</code>.  The extract portion
      of building a port will automatically save the downloaded
      source to <code class="filename">/usr/ports/distfiles</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-skeleton"></a>4.5.1. Installing Ports</h3></div></div></div><a id="idp51726456" class="indexterm"></a><p>This section provides basic instructions on using the
	Ports Collection to install or remove software.  The detailed
	description of available <code class="command">make</code> targets and
	environment variables is available in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ports&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ports</span>(7)</span></a>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Before compiling any port, be sure to update the Ports
	  Collection as described in the previous section.  Since
	  the installation of any third-party software can introduce
	  security vulnerabilities, it is recommended to first check
	  <a class="link" href="https://vuxml.freebsd.org/" target="_top">https://vuxml.freebsd.org/</a>
	  for known security issues related to the port.  Alternately,
	  run <code class="command">pkg audit -F</code> before installing a new
	  port.  This command can be configured to automatically
	  perform a security audit and an update of the vulnerability
	  database during the daily security system check.  For more
	  information, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg-audit&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg-audit</span>(8)</span></a> and
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a>.</p></div><p>Using the Ports Collection assumes a working Internet
	connection.  It also requires superuser privilege.</p><p>To compile and install the port, change to the directory
	of the port to be installed, then type <code class="command">make
	  install</code> at the prompt.  Messages will indicate
	the progress:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/sysutils/lsof</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
&gt;&gt; lsof_4.88D.freebsd.tar.gz doesn't seem to exist in /usr/ports/distfiles/.
&gt;&gt; Attempting to fetch from ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/.
===&gt;  Extracting for lsof-4.88
...
[extraction output snipped]
...
&gt;&gt; Checksum OK for lsof_4.88D.freebsd.tar.gz.
===&gt;  Patching for lsof-4.88.d,8
===&gt;  Applying FreeBSD patches for lsof-4.88.d,8
===&gt;  Configuring for lsof-4.88.d,8
...
[configure output snipped]
...
===&gt;  Building for lsof-4.88.d,8
...
[compilation output snipped]
...

===&gt;  Installing for lsof-4.88.d,8
...
[installation output snipped]
...
===&gt;   Generating temporary packing list
===&gt;   Compressing manual pages for lsof-4.88.d,8
===&gt;   Registering installation for lsof-4.88.d,8
===&gt;  SECURITY NOTE:
      This port has installed the following binaries which execute with
      increased privileges.
/usr/local/sbin/lsof
<code class="prompt">#</code></pre><p>Since <code class="command">lsof</code> is a program that runs
	with increased privileges, a security warning is displayed
	as it is installed.  Once the installation is complete, the
	prompt will be returned.</p><p>Some shells keep a cache of the commands that are
	available in the directories listed in the
	<code class="envar">PATH</code> environment variable, to speed up lookup
	operations for the executable file of these commands.  Users
	of the <code class="command">tcsh</code> shell should type
	<code class="command">rehash</code> so that a newly installed command
	can be used without specifying its full path.  Use
	<code class="command">hash -r</code> instead for the
	<code class="command">sh</code> shell.  Refer to the documentation
	for the shell for more information.</p><p>During installation, a working subdirectory is created
	which contains all the temporary files used during
	compilation.  Removing this directory saves disk space and
	minimizes the chance of problems later when upgrading to the
	newer version of the port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make clean</code></strong>
===&gt;  Cleaning for lsof-88.d,8
<code class="prompt">#</code></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">To save this extra step, instead use <code class="command">make
	    install clean</code> when compiling the port.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp51745528"></a>4.5.1.1. Customizing Ports Installation</h4></div></div></div><p>Some ports provide build options which can be used to
	  enable or disable application components, provide security
	  options, or allow for other customizations.  Examples
	  include <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/firefox/pkg-descr">www/firefox</a>,
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/gpgme/pkg-descr">security/gpgme</a>, and
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/sylpheed-claws/pkg-descr">mail/sylpheed-claws</a>.  If the port depends
	  upon other ports which have configurable options, it may
	  pause several times for user interaction as the default
	  behavior is to prompt the user to select options from a
	  menu.  To avoid this and do all of the configuration in one
	  batch, run <code class="command">make config-recursive</code> within
	  the port skeleton.  Then, run <code class="command">make install
	    [clean]</code> to compile and install the port.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">When using
	    <code class="buildtarget">config-recursive</code>, the list of
	    ports to configure are gathered by the
	    <code class="buildtarget">all-depends-list</code> target.  It is
	    recommended to run <code class="command">make
	      config-recursive</code> until all dependent ports
	    options have been defined, and ports options screens no
	    longer appear, to be certain that all dependency options
	    have been configured.</p></div><p>There are several ways to revisit a port's build options
	  menu in order to add, remove, or change these options after
	  a port has been built.  One method is to
	  <code class="command">cd</code> into the directory containing the
	  port and type <code class="command">make config</code>.  Another
	  option is to use <code class="command">make showconfig</code>.
	  Another option is to execute <code class="command">make
	    rmconfig</code> which will remove all selected options
	  and allow you to start over.  All of these options, and
	  others, are explained in great detail in
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ports&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ports</span>(7)</span></a>.</p><p>The ports system uses <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fetch&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fetch</span>(1)</span></a> to download the
	  source files, which supports various environment variables.
	  The <code class="envar">FTP_PASSIVE_MODE</code>,
	  <code class="envar">FTP_PROXY</code>, and <code class="envar">FTP_PASSWORD</code>
	  variables may need to be set if the FreeBSD system is behind
	  a firewall or FTP/HTTP proxy.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fetch&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fetch</span>(3)</span></a> for the
	  complete list of supported variables.</p><p>For users who cannot be connected to the Internet all
	  the time, <code class="command">make fetch</code> can be run within
	  <code class="filename">/usr/ports</code>, to fetch all distfiles, or
	  within a category, such as
	  <code class="filename">/usr/ports/net</code>, or within the specific
	  port skeleton.  Note that if a port has any dependencies,
	  running this command in a category or ports skeleton will
	  <span class="emphasis"><em>not</em></span> fetch the distfiles of ports from
	  another category.  Instead, use <code class="command">make
	    fetch-recursive</code> to also fetch the distfiles for
	  all the dependencies of a port.</p><p>In rare cases, such as when an organization has a local
	  distfiles repository, the <code class="varname">MASTER_SITES</code>
	  variable can be used to override the download locations
	  specified in the <code class="filename">Makefile</code>.  When using,
	  specify the alternate location:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/<em class="replaceable"><code>directory</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make MASTER_SITE_OVERRIDE= \
<em class="replaceable"><code>ftp://ftp.organization.org/pub/FreeBSD/ports/distfiles/</code></em> fetch</code></strong></pre><p>The <code class="varname">WRKDIRPREFIX</code> and
	  <code class="varname">PREFIX</code> variables can override the default
	  working and target directories.  For example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make WRKDIRPREFIX=/usr/home/example/ports install</code></strong></pre><p>will compile the port in
	  <code class="filename">/usr/home/example/ports</code> and install
	  everything under <code class="filename">/usr/local</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make PREFIX=/usr/home/example/local install</code></strong></pre><p>will compile the port in <code class="filename">/usr/ports</code>
	  and install it in
	  <code class="filename">/usr/home/example/local</code>.  And:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make WRKDIRPREFIX=../ports PREFIX=../local install</code></strong></pre><p>will combine the two.</p><p>These can also be set as environmental variables.  Refer
	  to the manual page for your shell for instructions on how to
	  set an environmental variable.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-removing"></a>4.5.2. Removing Installed Ports</h3></div></div></div><a id="idp51790328" class="indexterm"></a><p>Installed ports can be uninstalled using <code class="command">pkg
	  delete</code>.  Examples for using this command can be
	found in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg-delete&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg-delete</span>(8)</span></a> manual page.</p><p>Alternately, <code class="command">make deinstall</code> can be
	run in the port's directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/sysutils/lsof</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make deinstall</code></strong>
===&gt;  Deinstalling for sysutils/lsof
===&gt;   Deinstalling
Deinstallation has been requested for the following 1 packages:

	lsof-4.88.d,8

The deinstallation will free 229 kB
[1/1] Deleting lsof-4.88.d,8... done</pre><p>It is recommended to read the messages as the port is
	uninstalled.  If the port has any applications that depend
	upon it, this information will be displayed but the
	uninstallation will proceed.  In such cases, it may be better
	to reinstall the application in order to prevent broken
	dependencies.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-upgrading"></a>4.5.3. Upgrading Ports</h3></div></div></div><a id="idp51796856" class="indexterm"></a><p>Over time, newer versions of software become available
	in the Ports Collection.  This section describes how to
	determine which software can be upgraded and how to perform
	the upgrade.</p><p>To determine if newer versions of installed ports are
	available, ensure that the latest version of the ports tree is
	installed, using the updating command described in either
	<a class="xref" href="#ports-using-portsnap-method" title="Procedure 4.1. Portsnap Method">Procedure 4.1, &#8220;Portsnap Method&#8221;</a> or
	<a class="xref" href="#ports-using-subversion-method" title="Procedure 4.2. Subversion Method">Procedure 4.2, &#8220;Subversion Method&#8221;</a>.  On FreeBSD 10
	and later, or if the system has been converted to
	<span class="application">pkg</span>, the following command will
	list the installed ports which are out of date:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg version -l "&lt;"</code></strong></pre><p>For FreeBSD 9.<em class="replaceable"><code>X</code></em> and lower, the
	following command will list the installed ports that are out
	of date:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg_version -l "&lt;"</code></strong></pre><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">Before
	  attempting an upgrade, read
	  <code class="filename">/usr/ports/UPDATING</code> from the top of
	  the file to the date closest to the last time ports were
	  upgraded or the system was installed.  This file describes
	  various issues and additional steps users may encounter and
	  need to perform when updating a port, including such things
	  as file format changes, changes in locations of
	  configuration files, or any incompatibilities with previous
	  versions.  Make note of any instructions which match any of
	  the ports that need upgrading and follow these instructions
	  when performing the upgrade.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-upgrading-tools"></a>4.5.3.1. Tools to Upgrade and Manage Ports</h4></div></div></div><a id="idp51804408" class="indexterm"></a><p>The Ports Collection contains several utilities to
	  perform the actual upgrade.  Each has its strengths and
	  weaknesses.</p><p>Historically, most installations used either
	  <span class="application">Portmaster</span> or
	  <span class="application">Portupgrade</span>.
	  <span class="application">Synth</span> is a newer
	  alternative.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The choice of which tool is best for a particular
	    system is up to the system administrator.  It is
	    recommended practice to back up your data before using any
	    of these tools.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portmaster"></a>4.5.3.2. Upgrading Ports Using
	  <span class="application">Portmaster</span></h4></div></div></div><a id="idp51813624" class="indexterm"></a><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a> is a very
	  small utility for upgrading installed ports.
	  It is designed to use the tools installed with the FreeBSD
	  base system
	  without depending on other ports or databases.
	  To install this utility
	  as a port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/ports-mgmt/portmaster</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p><span class="application">Portmaster</span> defines four
	  categories of ports:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Root port: has no dependencies and is not a
	      dependency of any other ports.</p></li><li class="listitem"><p>Trunk port: has no dependencies, but other ports
	      depend upon it.</p></li><li class="listitem"><p>Branch port: has dependencies and other ports
	      depend upon it.</p></li><li class="listitem"><p>Leaf port: has dependencies but no other ports
	      depend upon it.</p></li></ul></div><p>To list these categories and search for updates:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -L</code></strong>
===&gt;&gt;&gt; Root ports (No dependencies, not depended on)
===&gt;&gt;&gt; ispell-3.2.06_18
===&gt;&gt;&gt; screen-4.0.3
        ===&gt;&gt;&gt; New version available: screen-4.0.3_1
===&gt;&gt;&gt; tcpflow-0.21_1
===&gt;&gt;&gt; 7 root ports
...
===&gt;&gt;&gt; Branch ports (Have dependencies, are depended on)
===&gt;&gt;&gt; apache22-2.2.3
        ===&gt;&gt;&gt; New version available: apache22-2.2.8
...
===&gt;&gt;&gt; Leaf ports (Have dependencies, not depended on)
===&gt;&gt;&gt; automake-1.9.6_2
===&gt;&gt;&gt; bash-3.1.17
        ===&gt;&gt;&gt; New version available: bash-3.2.33
...
===&gt;&gt;&gt; 32 leaf ports

===&gt;&gt;&gt; 137 total installed ports
        ===&gt;&gt;&gt; 83 have new versions available</pre><p>This command is used to upgrade all outdated
	  ports:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -a</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">By default, <span class="application">Portmaster</span>
	    makes a backup package before deleting the existing port.
	    If the installation of the new version is successful,
	    <span class="application">Portmaster</span> deletes the
	    backup.  Using <code class="option">-b</code> instructs
	    <span class="application">Portmaster</span> not to automatically
	    delete the backup.  Adding <code class="option">-i</code> starts
	    <span class="application">Portmaster</span> in interactive mode,
	    prompting for confirmation before upgrading each port.
	    Many other options are available.  Read through the
	    manual page for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=portmaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">portmaster</span>(8)</span></a> for details regarding
	    their usage.</p></div><p>If errors are encountered during the upgrade process,
	  add <code class="option">-f</code> to upgrade and rebuild all
	  ports:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -af</code></strong></pre><p><span class="application">Portmaster</span> can also be used
	  to install new ports on the system, upgrading all
	  dependencies before building and installing the new
	  port.  To use this function, specify the location of the
	  port in the Ports Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmaster <em class="replaceable"><code>shells/bash</code></em></code></strong></pre><p>More information about
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a> may be found in its
	  <code class="filename">pkg-descr</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portupgrade"></a>4.5.3.3. Upgrading Ports Using Portupgrade</h4></div></div></div><a id="idp51837048" class="indexterm"></a><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portupgrade/pkg-descr">ports-mgmt/portupgrade</a> is another
	  utility that can be used to upgrade ports.  It installs a
	  suite of applications which can be used to manage ports.
	  However, it is dependent upon Ruby.  To install the
	  port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/ports-mgmt/portupgrade</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>Before performing an upgrade using this utility, it is
	  recommended to scan the list of installed ports using
	  <code class="command">pkgdb -F</code> and to fix all the
	  inconsistencies it reports.</p><p>To upgrade all the outdated ports installed on the
	  system, use <code class="command">portupgrade -a</code>.  Alternately,
	  include <code class="option">-i</code> to be asked for confirmation
	  of every individual upgrade:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -ai</code></strong></pre><p>To upgrade only a specified application instead of all
	  available ports, use <code class="command">portupgrade
	    <em class="replaceable"><code>pkgname</code></em></code>.  It is very
	  important to include <code class="option">-R</code> to first upgrade
	  all the ports required by the given application:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -R firefox</code></strong></pre><p>If
	  <code class="option">-P</code> is included,
	  <span class="application">Portupgrade</span> searches for
	  available packages in the local directories listed in
	  <code class="envar">PKG_PATH</code>.  If none are available locally, it
	  then fetches packages from a remote site.  If packages can
	  not be found locally or fetched remotely,
	  <span class="application">Portupgrade</span> will use ports.  To
	  avoid using ports entirely, specify <code class="option">-PP</code>.
	  This last set of options tells
	  <span class="application">Portupgrade</span> to abort if no
	  packages are available:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -PP gnome3</code></strong></pre><p>To just fetch the port distfiles, or packages, if
	  <code class="option">-P</code> is specified, without building or
	  installing anything, use <code class="option">-F</code>.  For further
	  information on all of the available switches, refer to the
	  manual page for <code class="command">portupgrade</code>.</p><p>More information about
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portupgrade/pkg-descr">ports-mgmt/portupgrade</a> may be found in
	  its <code class="filename">pkg-descr</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-disk-space"></a>4.5.4. Ports and Disk Space</h3></div></div></div><a id="idp51897720" class="indexterm"></a><p>Using the Ports Collection will use up disk space over
	time.  After building and installing a port, running
	<code class="command">make clean</code> within the ports skeleton will
	clean up the temporary <code class="filename">work</code> directory.
	If <span class="application">Portmaster</span> is used to install a
	port, it will automatically remove this directory unless
	<code class="option">-K</code> is specified.  If
	<span class="application">Portupgrade</span> is installed, this
	command will remove all <code class="filename">work</code> directories
	found within the local copy of the Ports Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsclean -C</code></strong></pre><p>In addition, outdated source distribution files
	accumulate in <code class="filename">/usr/ports/distfiles</code> over
	time.  To use <span class="application">Portupgrade</span> to
	delete all the distfiles that are no longer
	referenced by any ports:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsclean -D</code></strong></pre><p><span class="application">Portupgrade</span> can remove
	all distfiles not referenced by any port currently installed
	on the system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsclean -DD</code></strong></pre><p>If <span class="application">Portmaster</span> is installed,
	use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmaster --clean-distfiles</code></strong></pre><p>By default, this command is interactive and prompts
	the user to confirm if a distfile should be deleted.</p><p>In addition to these commands,
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/pkg_cutleaves/pkg-descr">ports-mgmt/pkg_cutleaves</a>
	automates the task of removing installed ports that are no
	longer needed.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-poudriere"></a>4.6. Building Packages with
      <span class="application">Poudriere</span></h2></div></div></div><p><span class="application">Poudriere</span> is a
      <acronym class="acronym">BSD</acronym>-licensed utility for creating and testing
      FreeBSD packages.  It uses FreeBSD jails to set up isolated
      compilation environments.  These jails can be used to build
      packages for versions of FreeBSD that are different from the system
      on which it is installed, and also to build packages for i386 if
      the host is an amd64 system.  Once the packages are
      built, they are in a layout identical to the official mirrors.
      These packages are usable by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg</span>(8)</span></a> and other package
      management tools.</p><p><span class="application">Poudriere</span> is installed using
      the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/poudriere/pkg-descr">ports-mgmt/poudriere</a> package
      or port.  The installation includes a sample configuration
      file <code class="filename">/usr/local/etc/poudriere.conf.sample</code>.
      Copy this file to
      <code class="filename">/usr/local/etc/poudriere.conf</code>.  Edit the
      copied file to suit the local configuration.</p><p>While <acronym class="acronym">ZFS</acronym> is not required on the system
      running <span class="application">poudriere</span>, it is beneficial.
      When <acronym class="acronym">ZFS</acronym> is used,
      <code class="varname">ZPOOL</code> must be specified in
      <code class="filename">/usr/local/etc/poudriere.conf</code> and
      <code class="varname">FREEBSD_HOST</code> should be set to a nearby
      mirror.  Defining <code class="varname">CCACHE_DIR</code> enables the use
      of <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/devel/ccache/pkg-descr">devel/ccache</a> to cache
      compilation and reduce build times for frequently-compiled code.
      It may be convenient to put
      <span class="application">poudriere</span> datasets in an isolated
      tree mounted at <code class="filename">/poudriere</code>.  Defaults for the
      other configuration values are adequate.</p><p>The number of processor cores detected is used to define how
      many builds will run in parallel.  Supply enough virtual memory,
      either with <acronym class="acronym">RAM</acronym> or swap space.  If virtual
      memory runs out, the compilation jails will stop and be torn
      down, resulting in weird error messages.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="poudriere-initialization"></a>4.6.1. Initialize Jails and Port Trees</h3></div></div></div><p>After configuration, initialize
	<span class="application">poudriere</span> so that it installs a
	jail with the required FreeBSD tree and a ports tree.  Specify a
	name for the jail using <code class="option">-j</code> and the FreeBSD
	version with <code class="option">-v</code>.  On systems running
	FreeBSD/amd64, the architecture can be set with
	<code class="option">-a</code> to either <code class="literal">i386</code> or
	<code class="literal">amd64</code>.  The default is the
	architecture shown by <code class="command">uname</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>poudriere jail -c -j <em class="replaceable"><code>11amd64</code></em> -v <em class="replaceable"><code>11.4-RELEASE</code></em></code></strong>
[00:00:00] Creating 11amd64 fs at /poudriere/jails/11amd64... done
[00:00:00] Using pre-distributed MANIFEST for FreeBSD 11.4-RELEASE amd64
[00:00:00] Fetching base for FreeBSD 11.4-RELEASE amd64
/poudriere/jails/11amd64/fromftp/base.txz              125 MB 4110 kBps    31s
[00:00:33] Extracting base... done
[00:00:54] Fetching src for FreeBSD 11.4-RELEASE amd64
/poudriere/jails/11amd64/fromftp/src.txz               154 MB 4178 kBps    38s
[00:01:33] Extracting src... done
[00:02:31] Fetching lib32 for FreeBSD 11.4-RELEASE amd64
/poudriere/jails/11amd64/fromftp/lib32.txz              24 MB 3969 kBps    06s
[00:02:38] Extracting lib32... done
[00:02:42] Cleaning up... done
[00:02:42] Recording filesystem state for clean... done
[00:02:42] Upgrading using ftp
/etc/resolv.conf -&gt; /poudriere/jails/11amd64/etc/resolv.conf
Looking up update.FreeBSD.org mirrors... 3 mirrors found.
Fetching public key from update4.freebsd.org... done.
Fetching metadata signature for 11.4-RELEASE from update4.freebsd.org... done.
Fetching metadata index... done.
Fetching 2 metadata files... done.
Inspecting system... done.
Preparing to download files... done.
Fetching 124 patches.....10....20....30....40....50....60....70....80....90....100....110....120.. done.
Applying patches... done.
Fetching 6 files... done.
The following files will be added as part of updating to
11.4-RELEASE-p1:
/usr/src/contrib/unbound/.github
/usr/src/contrib/unbound/.github/FUNDING.yml
/usr/src/contrib/unbound/contrib/drop2rpz
/usr/src/contrib/unbound/contrib/unbound_portable.service.in
/usr/src/contrib/unbound/services/rpz.c
/usr/src/contrib/unbound/services/rpz.h
/usr/src/lib/libc/tests/gen/spawnp_enoexec.sh
The following files will be updated as part of updating to
11.4-RELEASE-p1:
[&#8230;]
Installing updates...Scanning //usr/share/certs/blacklisted for certificates...
Scanning //usr/share/certs/trusted for certificates...
 done.
11.4-RELEASE-p1
[00:04:06] Recording filesystem state for clean... done
[00:04:07] Jail 11amd64 11.4-RELEASE-p1 amd64 is ready to be used</pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>poudriere ports -c -p <em class="replaceable"><code>local</code></em> -m svn+https</code></strong>
[00:00:00] Creating local fs at /poudriere/ports/local... done
[00:00:00] Checking out the ports tree... done</pre><p>On a single computer, <span class="application">poudriere</span>
	can build ports with multiple configurations, in multiple
	jails, and from different port trees.  Custom configurations
	for these combinations are called <span class="emphasis"><em>sets</em></span>.
	See the CUSTOMIZATION section of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=poudriere&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">poudriere</span>(8)</span></a> for details
	after <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/poudriere/pkg-descr">ports-mgmt/poudriere</a> or
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/poudriere-devel/pkg-descr">ports-mgmt/poudriere-devel</a> is
	installed.</p><p>The basic configuration shown here puts a single jail-,
	port-, and set-specific <code class="filename">make.conf</code> in
	<code class="filename">/usr/local/etc/poudriere.d</code>.
	The filename in this example is created by combining the jail
	name, port name, and set name:
	<code class="filename"><em class="replaceable"><code>11amd64-local-workstation</code></em>-make.conf</code>.
	The system <code class="filename">make.conf</code> and this new file
	are combined at build time to create the
	<code class="filename">make.conf</code> used by the build jail.</p><p>Packages to be built are entered in
	<code class="filename"><em class="replaceable"><code>11amd64-local-workstation</code></em>-pkglist</code>:</p><pre class="programlisting">editors/emacs
devel/git
ports-mgmt/pkg
...</pre><p>Options and dependencies for the specified ports are
	configured:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>poudriere options -j <em class="replaceable"><code>11amd64</code></em> -p <em class="replaceable"><code>local</code></em> -z <em class="replaceable"><code>workstation</code></em> -f <em class="replaceable"><code>11amd64-local-workstation-pkglist</code></em></code></strong></pre><p>Finally, packages are built and a package
	repository is created:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>poudriere bulk -j <em class="replaceable"><code>11amd64</code></em> -p <em class="replaceable"><code>local</code></em> -z <em class="replaceable"><code>workstation</code></em> -f <em class="replaceable"><code>11amd64-local-workstation-pkglist</code></em></code></strong></pre><p>While running, pressing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>t</strong></span>
	displays the current state of the build.
	<span class="application">Poudriere</span> also builds files in
	<code class="filename">/poudriere/logs/bulk/<em class="replaceable"><code>jailname</code></em></code>
	that can be used with a web server to display build
	information.</p><p>After completion, the new packages are now available for
	installation from the <span class="application">poudriere</span>
	repository.</p><p>For more information on using
	<span class="application">poudriere</span>, see <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=poudriere&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">poudriere</span>(8)</span></a>
	and the main web site, <a class="link" href="https://github.com/freebsd/poudriere/wiki" target="_top">https://github.com/freebsd/poudriere/wiki</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52017272"></a>4.6.2. Configuring pkg Clients to Use a Poudriere
	Repository</h3></div></div></div><p>While it is possible to use both a custom repository along
	side of the official repository, sometimes it is useful to
	disable the official repository.  This is done by creating a
	configuration file that overrides and disables the official
	configuration file.  Create
	<code class="filename">/usr/local/etc/pkg/repos/FreeBSD.conf</code>
	that contains the following:</p><pre class="programlisting">FreeBSD: {
	enabled: no
}</pre><p>Usually it is easiest to serve a poudriere repository to
	the client machines via HTTP.  Set up a webserver to serve up
	the package directory, for instance:
	<code class="filename">/usr/local/poudriere/data/packages/<em class="replaceable"><code>11amd64</code></em></code>,
	where <code class="filename"><em class="replaceable"><code>11amd64</code></em></code>
	is the name of the build.</p><p>If the URL to the package repository is:
	<code class="literal">http://pkg.example.com/11amd64</code>, then the
	repository configuration file in
	<code class="filename">/usr/local/etc/pkg/repos/custom.conf</code>
	would look like:</p><pre class="programlisting">custom: {
	url: "<em class="replaceable"><code>http://pkg.example.com/11amd64</code></em>",
	enabled: yes,
}</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-nextsteps"></a>4.7. Post-Installation Considerations</h2></div></div></div><p>Regardless of whether the software was installed from a
      binary package or port, most third-party applications require
      some level of configuration after installation.  The following
      commands and locations can be used to help determine what was
      installed with the application.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Most applications install at least one default
	  configuration file in <code class="filename">/usr/local/etc</code>.
	  In cases where an application has a large number of
	  configuration files, a subdirectory will be created to hold
	  them.  Often, sample configuration files are installed which
	  end with a suffix such as <code class="filename">.sample</code>.  The
	  configuration files should be reviewed and possibly
	  edited to meet the system's needs.  To edit a sample file,
	  first copy it without the <code class="filename">.sample</code>
	  extension.</p></li><li class="listitem"><p>Applications which provide documentation will install
	  it into <code class="filename">/usr/local/share/doc</code> and many
	  applications also install manual pages.  This documentation
	  should be consulted before continuing.</p></li><li class="listitem"><p>Some applications run services which must be added
	  to <code class="filename">/etc/rc.conf</code> before starting the
	  application.  These applications usually install a startup
	  script in <code class="filename">/usr/local/etc/rc.d</code>.  See
	  <a class="link" href="#configtuning-starting-services" title="11.2. Starting Services">Starting
	    Services</a> for more information.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">By design, applications do not run their startup
	    script upon installation, nor do they run their stop
	    script upon deinstallation or upgrade.  This decision
	    is left to the individual system administrator.</p></div></li><li class="listitem"><p>Users of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a> should run
	  <code class="command">rehash</code> to rebuild the known binary list
	  in the shells <code class="envar">PATH</code>.</p></li><li class="listitem"><p>Use <code class="command">pkg info</code> to determine which
	  files, man pages, and binaries were installed with the
	  application.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-broken"></a>4.8. Dealing with Broken Ports</h2></div></div></div><p>When a port does not build or
      install, try the following:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Search to see if there is a fix pending for the port in
	  the <a class="link" href="../../../../support.html" target="_top">Problem
	    Report database</a>.  If so, implementing the proposed
	  fix may fix the issue.</p></li><li class="listitem"><p>Ask the maintainer of the port for help.  Type
	  <code class="command">make maintainer</code>
	  in the ports skeleton or read the port's
	  <code class="filename">Makefile</code> to find the maintainer's
	  email address.  Remember to include the
	  <code class="literal">$FreeBSD:</code> line from the port's
	  <code class="filename">Makefile</code> and the output leading up to
	  the error in the email to the maintainer.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some ports are not maintained by an individual but
	    instead by a group maintainer represented by a <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/mailing-list-faq/article.html" target="_top">mailing
	      list</a>.  Many, but not all, of these addresses look
	    like <code class="email">&lt;freebsd-<em class="replaceable"><code>listname</code></em>@FreeBSD.org&gt;</code>.
	    Please take this into account when sending an
	    email.</p><p xmlns="http://www.w3.org/1999/xhtml">In particular, ports maintained by
	    <code class="email">&lt;ports@FreeBSD.org&gt;</code> are not
	    maintained by a specific individual.  Instead, any fixes
	    and support come from the general community who subscribe
	    to that mailing list.  More volunteers are always
	    needed!</p></div><p>If there is no response to the email, use
	  Bugzilla to submit a bug report using the
	  instructions in <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/problem-reports/article.html" target="_top">Writing
	    FreeBSD Problem Reports</a>.</p></li><li class="listitem"><p>Fix it!  The <a class="link" href="../../../../doc/en_US.ISO8859-1/books/porters-handbook/index.html" target="_top">Porter's
	    Handbook</a> includes detailed information on the
	  ports infrastructure so that you can fix the occasional
	  broken port or even submit your own!</p></li><li class="listitem"><p>Install the package instead of the port using the
	  instructions in <a class="xref" href="#pkgng-intro" title="4.4. Using pkg for Binary Package Management">Section 4.4, &#8220;Using <span class="application">pkg</span> for Binary Package
      Management&#8221;</a>.</p></li></ol></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x11"></a>Chapter 5. The X Window System</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#x11-synopsis">5.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#x-understanding">5.2. Terminology</a></span></dt><dt><span class="sect1"><a href="#x-install">5.3. Installing <span class="application">Xorg</span></a></span></dt><dt><span class="sect1"><a href="#x-config">5.4. <span class="application">Xorg</span> Configuration</a></span></dt><dt><span class="sect1"><a href="#x-fonts">5.5. Using Fonts in <span class="application">Xorg</span></a></span></dt><dt><span class="sect1"><a href="#x-xdm">5.6. The X Display Manager</a></span></dt><dt><span class="sect1"><a href="#x11-wm">5.7. Desktop Environments</a></span></dt><dt><span class="sect1"><a href="#x-compiz-fusion">5.8. Installing Compiz Fusion</a></span></dt><dt><span class="sect1"><a href="#x11-troubleshooting">5.9. Troubleshooting</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x11-synopsis"></a>5.1. Synopsis</h2></div></div></div><p>An installation of FreeBSD using
      <span class="application">bsdinstall</span> does not automatically
      install a graphical user interface.  This chapter describes how
      to install and configure <span class="application">Xorg</span>,
      which provides the open source X Window System used to provide a
      graphical environment.  It then describes how to find and
      install a desktop environment or window manager.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Users who prefer an installation method that automatically
	configures the <span class="application">Xorg</span> should refer
	to <a class="link" href="https://www.furybsd.org" target="_top">FuryBSD</a>,
	<a class="link" href="https://ghostbsd.org" target="_top">GhostBSD</a> or
	<a class="link" href="https://www.midnightbsd.org" target="_top">MidnightBSD</a>.</p></div><p>For more information on the video hardware that
      <span class="application">Xorg</span> supports, refer to the <a class="link" href="http://www.x.org/" target="_top">x.org</a> website.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The various components of the X Window System, and how
	  they interoperate.</p></li><li class="listitem"><p>How to install and configure
	  <span class="application">Xorg</span>.</p></li><li class="listitem"><p>How to install and configure several window managers
	  and desktop environments.</p></li><li class="listitem"><p>How to use <span class="trademark">TrueType</span>® fonts in
	  <span class="application">Xorg</span>.</p></li><li class="listitem"><p>How to set up your system for graphical logins
	  (<span class="application">XDM</span>).</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Know how to install additional third-party
	  software as described in <a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a>.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-understanding"></a>5.2. Terminology</h2></div></div></div><p>While it is not necessary to understand all of the details
      of the various components in the X Window System and how they
      interact, some basic knowledge of these components can be
      useful.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">X server</span></dt><dd><p>X was designed from the beginning to be
	    network-centric, and adopts a <span class="quote">&#8220;<span class="quote">client-server</span>&#8221;</span>
	    model.  In this model, the <span class="quote">&#8220;<span class="quote">X server</span>&#8221;</span> runs on
	    the computer that has the keyboard, monitor, and mouse
	    attached.  The server's responsibility includes tasks such
	    as managing the display, handling input from the keyboard
	    and mouse, and handling input or output from other devices
	    such as a tablet or a video projector.  This confuses some
	    people, because the X terminology is exactly backward to
	    what they expect.  They expect the <span class="quote">&#8220;<span class="quote">X server</span>&#8221;</span>
	    to be the big powerful machine down the hall, and the
	    <span class="quote">&#8220;<span class="quote">X client</span>&#8221;</span> to be the machine on their
	    desk.</p></dd><dt><span class="term">X client</span></dt><dd><p>Each X application, such as
	    <span class="application">XTerm</span> or
	    <span class="application">Firefox</span>, is a
	    <span class="quote">&#8220;<span class="quote">client</span>&#8221;</span>.  A client sends messages to the
	    server such as <span class="quote">&#8220;<span class="quote">Please draw a window at these
	      coordinates</span>&#8221;</span>, and the server sends back messages
	    such as <span class="quote">&#8220;<span class="quote">The user just clicked on the OK
	      button</span>&#8221;</span>.</p><p>In a home or small office environment, the X server
	    and the X clients commonly run on the same computer.  It
	    is also possible to run the X server on a less powerful
	    computer and to run the X applications on a more powerful
	    system.  In this scenario, the communication between the X
	    client and server takes place over the network.</p></dd><dt><span class="term">window manager</span></dt><dd><p>X does not dictate what windows should look like
	    on-screen, how to move them around with the mouse, which
	    keystrokes should be used to move between windows, what
	    the title bars on each window should look like, whether or
	    not they have close buttons on them, and so on.  Instead,
	    X delegates this responsibility to a separate window
	    manager application.  There are <a class="link" href="http://www.xwinman.org/" target="_top">dozens of window
	      managers</a> available.  Each window manager provides
	    a different look and feel: some support virtual desktops,
	    some allow customized keystrokes to manage the desktop,
	    some have a <span class="quote">&#8220;<span class="quote">Start</span>&#8221;</span> button, and some are
	    themeable, allowing a complete change of the desktop's
	    look-and-feel.  Window managers are available in the
	    <code class="filename">x11-wm</code> category of the Ports
	    Collection.</p><p>Each window manager uses a different configuration
	    mechanism.  Some expect configuration file written by hand
	    while others provide graphical tools for most
	    configuration tasks.</p></dd><dt><span class="term">desktop environment</span></dt><dd><p><span class="application">KDE</span> and
	    <span class="application">GNOME</span> are considered to be
	    desktop environments as they include an entire suite of
	    applications for performing common desktop tasks.  These
	    may include office suites, web browsers, and games.</p></dd><dt><span class="term">focus policy</span></dt><dd><p>The window manager is responsible for the mouse focus
	    policy.  This policy provides some means for choosing
	    which window is actively receiving keystrokes and it
	    should also visibly indicate which window is currently
	    active.</p><p>One focus policy is called
	    <span class="quote">&#8220;<span class="quote">click-to-focus</span>&#8221;</span>.  In this model, a window
	    becomes active upon receiving a mouse click.  In the
	    <span class="quote">&#8220;<span class="quote">focus-follows-mouse</span>&#8221;</span> policy, the window that
	    is under the mouse pointer has focus and the focus is
	    changed by pointing at another window.  If the mouse is
	    over the root window, then this window is focused.  In the
	    <span class="quote">&#8220;<span class="quote">sloppy-focus</span>&#8221;</span> model, if the mouse is moved
	    over the root window, the most recently used window still
	    has the focus.  With sloppy-focus, focus is only changed
	    when the cursor enters a new window, and not when exiting
	    the current window.  In the <span class="quote">&#8220;<span class="quote">click-to-focus</span>&#8221;</span>
	    policy, the active window is selected by mouse click.  The
	    window may then be raised and appear in front of all other
	    windows.  All keystrokes will now be directed to this
	    window, even if the cursor is moved to another
	    window.</p><p>Different window managers support different focus
	    models.  All of them support click-to-focus, and the
	    majority of them also support other policies.  Consult the
	    documentation for the window manager to determine which
	    focus models are available.</p></dd><dt><span class="term">widgets</span></dt><dd><p>Widget is a term for all of the items in the user
	    interface that can be clicked or manipulated in some way.
	    This includes buttons, check boxes, radio buttons, icons,
	    and lists.  A widget toolkit is a set of widgets used to
	    create graphical applications.  There are several popular
	    widget toolkits, including Qt, used by
	    <span class="application">KDE</span>, and GTK+, used by
	    <span class="application">GNOME</span>.  As a result,
	    applications will have a different look and feel,
	    depending upon which widget toolkit was used to create the
	    application.</p></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-install"></a>5.3. Installing <span class="application">Xorg</span></h2></div></div></div><p>On FreeBSD, <span class="application">Xorg</span> can be installed
      as a package or port.</p><p>The binary package can be installed quickly but with
      fewer options for customization:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install xorg</code></strong></pre><p>To build and install from the Ports Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11/xorg</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>Either of these installations results in the complete
      <span class="application">Xorg</span> system being installed.  Binary packages
      are the best option for most users.</p><p>A smaller version of the X system suitable for experienced
      users is available in <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/xorg-minimal/pkg-descr">x11/xorg-minimal</a>.  Most
      of the documents, libraries, and applications will not be
      installed.  Some applications require these additional
      components to function.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-config"></a>5.4. <span class="application">Xorg</span> Configuration</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div></div></div><a id="idp52153464" class="indexterm"></a><a id="idp52153976" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-quick-start"></a>5.4.1. Quick Start</h3></div></div></div><p><span class="application">Xorg</span> supports most common
	video cards, keyboards, and pointing devices.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Video cards, monitors, and input devices are
	  automatically detected and do not require any manual
	  configuration.  Do not create <code class="filename">xorg.conf</code>
	  or run a <code class="option">-configure</code> step unless automatic
	  configuration fails.</p></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>If <span class="application">Xorg</span> has been used on
	    this computer before, move or remove any existing
	    configuration files:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mv /etc/X11/xorg.conf ~/xorg.conf.etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv /usr/local/etc/X11/xorg.conf ~/xorg.conf.localetc</code></strong></pre></li><li class="step"><p>Add the user who will run
	    <span class="application">Xorg</span> to the
	    <code class="systemitem">video</code> or
	    <code class="systemitem">wheel</code> group to enable 3D acceleration
	    when available.  To add user
	    <em class="replaceable"><code>jru</code></em> to whichever group is
	    available:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod video -m <em class="replaceable"><code>jru</code></em> || pw groupmod wheel -m <em class="replaceable"><code>jru</code></em></code></strong></pre></li><li class="step"><p>The <span class="application">twm</span> window manager is included
	    by default.  It is started when
	    <span class="application">Xorg</span> starts:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>startx</code></strong></pre></li><li class="step"><p>On some older versions of FreeBSD, the system console
	    must be set to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vt</span>(4)</span></a> before switching back to the
	    text console will work properly.  See
	    <a class="xref" href="#x-config-kms" title="5.4.3. Kernel Mode Setting (KMS)">Section 5.4.3, &#8220;Kernel Mode Setting (<acronym class="acronym">KMS</acronym>)&#8221;</a>.</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-user-group"></a>5.4.2. User Group for Accelerated Video</h3></div></div></div><p>Access to <code class="filename">/dev/dri</code> is needed to allow
	3D acceleration on video cards.  It is usually simplest to add
	the user who will be running X to either the
	<code class="systemitem">video</code> or <code class="systemitem">wheel</code> group.
	Here, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> is used to add user
	<em class="replaceable"><code>slurms</code></em> to the
	<code class="systemitem">video</code> group, or to the
	<code class="systemitem">wheel</code> group if there is no
	<code class="systemitem">video</code> group:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod video -m <em class="replaceable"><code>slurms</code></em> || pw groupmod wheel -m <em class="replaceable"><code>slurms</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-kms"></a>5.4.3. Kernel Mode Setting (<acronym class="acronym">KMS</acronym>)</h3></div></div></div><p>When the computer switches from displaying the console to
	a higher screen resolution for X, it must set the video
	output <span class="emphasis"><em>mode</em></span>.  Recent versions of
	<acronym class="acronym">Xorg</acronym> use a system inside the kernel to do
	these mode changes more efficiently.  Older versions of FreeBSD
	use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sc&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sc</span>(4)</span></a>, which is not aware of the
	<acronym class="acronym">KMS</acronym> system.  The end result is that after
	closing X, the system console is blank, even though it is
	still working.  The newer <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vt</span>(4)</span></a> console avoids this
	problem.</p><p>Add this line to <code class="filename">/boot/loader.conf</code>
	to enable <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vt</span>(4)</span></a>:</p><pre class="programlisting">kern.vty=vt</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-files"></a>5.4.4. Configuration Files</h3></div></div></div><p>Manual configuration is usually not necessary.  Please do
	not manually create configuration files unless
	autoconfiguration does not work.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-files-directory"></a>5.4.4.1. Directory</h4></div></div></div><p><span class="application">Xorg</span> looks in several
	  directories for configuration files.
	  <code class="filename">/usr/local/etc/X11/</code> is the recommended
	  directory for these files on FreeBSD.  Using this directory
	  helps keep application files separate from operating system
	  files.</p><p>Storing configuration files in the legacy
	  <code class="filename">/etc/X11/</code> still works.  However, this
	  mixes application files with the base FreeBSD files and is not
	  recommended.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-files-single-or-multi"></a>5.4.4.2. Single or Multiple Files</h4></div></div></div><p>It is easier to use multiple files that each configure a
	  specific setting than the traditional single
	  <code class="filename">xorg.conf</code>.  These files are stored in
	  the <code class="filename">xorg.conf.d/</code> subdirectory of the
	  main configuration file directory.  The full path is
	  typically
	  <code class="filename">/usr/local/etc/X11/xorg.conf.d/</code>.</p><p>Examples of these files are shown later in this
	  section.</p><p>The traditional single <code class="filename">xorg.conf</code>
	  still works, but is neither as clear nor as flexible as
	  multiple files in the <code class="filename">xorg.conf.d/</code>
	  subdirectory.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-video-cards"></a>5.4.5. Video Cards</h3></div></div></div><p>Because of changes made in recent versions of FreeBSD, it
	is now possible to use graphics drivers provided by the Ports
	framework or as packages.  As such, users can use one of the
	following drivers available from
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/drm-kmod/pkg-descr">graphics/drm-kmod</a>.</p><div class="variablelist"><dl class="variablelist"><dt><a id="x-config-video-cards-ports"></a><span class="term">Intel KMS driver, </span><span class="term">Radeon KMS driver, </span><span class="term">AMD KMS driver</span></dt><dd><p>2D and 3D acceleration is supported on most
	      Intel KMS driver graphics cards provided by Intel.</p><p>Driver name: <code class="literal">i915kms</code></p><p>2D and 3D acceleration is supported on most older
	      Radeon KMS driver graphics cards provided by AMD.</p><p>Driver name: <code class="literal">radeonkms</code></p><p>2D and 3D acceleration is supported on most newer
	      AMD KMS driver graphics cards provided by AMD.</p><p>Driver name: <code class="literal">amdgpu</code></p><p>For reference, please see <a class="link" href="https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units" target="_top">https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units</a>
	      or <a class="link" href="https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units" target="_top">https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units</a>
	      for a list of supported GPUs.</p></dd><dt><a id="x-config-video-cards-intel"></a><span class="term"><span class="trademark">Intel</span>®</span></dt><dd><p>3D acceleration is supported on most <span class="trademark">Intel</span>®
	      graphics up to Ivy Bridge (HD Graphics 2500, 4000, and
	      P4000), including Iron Lake (HD Graphics) and
	      Sandy Bridge (HD Graphics 2000).</p><p>Driver name: <code class="literal">intel</code></p><p>For reference, see <a class="link" href="https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units" target="_top">https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units</a>.</p></dd><dt><a id="x-config-video-cards-radeon"></a><span class="term"><span class="trademark">AMD</span>® Radeon</span></dt><dd><p>2D and 3D acceleration is supported on Radeon
	      cards up to and including the HD6000 series.</p><p>Driver name: <code class="literal">radeon</code></p><p>For reference, see <a class="link" href="https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units" target="_top">https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units</a>.</p></dd><dt><a id="x-config-video-cards-nvidia"></a><span class="term">NVIDIA</span></dt><dd><p>Several NVIDIA drivers are available in the
	      <code class="filename">x11</code> category of the Ports
	      Collection.  Install the driver that matches the video
	      card.</p><p>For reference, see <a class="link" href="https://en.wikipedia.org/wiki/List_of_Nvidia_graphics_processing_units" target="_top">https://en.wikipedia.org/wiki/List_of_Nvidia_graphics_processing_units</a>.</p></dd><dt><a id="x-config-video-cards-hybrid"></a><span class="term">Hybrid Combination Graphics</span></dt><dd><p>Some notebook computers add additional graphics
	      processing units to those built into the chipset or
	      processor.  <span class="emphasis"><em>Optimus</em></span> combines
	      <span class="trademark">Intel</span>® and NVIDIA hardware.
	      <span class="emphasis"><em>Switchable Graphics</em></span> or
	      <span class="emphasis"><em>Hybrid Graphics</em></span> are a combination
	      of an <span class="trademark">Intel</span>® or <span class="trademark">AMD</span>® processor and an <span class="trademark">AMD</span>® Radeon
	      <acronym class="acronym">GPU</acronym>.</p><p>Implementations of these hybrid graphics systems
	      vary, and <span class="application">Xorg</span> on FreeBSD is
	      not able to drive all versions of them.</p><p>Some computers provide a <acronym class="acronym">BIOS</acronym>
	      option to disable one of the graphics adapters or select
	      a <span class="emphasis"><em>discrete</em></span> mode which can be used
	      with one of the standard video card drivers.  For
	      example, it is sometimes possible to disable the NVIDIA
	      <acronym class="acronym">GPU</acronym> in an Optimus system.  The
	      <span class="trademark">Intel</span>® video can then be used with an <span class="trademark">Intel</span>®
	      driver.</p><p><acronym class="acronym">BIOS</acronym> settings depend on the model
	      of computer.  In some situations, both
	      <acronym class="acronym">GPU</acronym>s can be left enabled, but
	      creating a configuration file that only uses the main
	      <acronym class="acronym">GPU</acronym> in the <code class="literal">Device</code>
	      section is enough to make such a system
	      functional.</p></dd><dt><a id="x-config-video-cards-other"></a><span class="term">Other Video Cards</span></dt><dd><p>Drivers for some less-common video cards can be
	      found in the <code class="filename">x11-drivers</code> directory
	      of the Ports Collection.</p><p>Cards that are not supported by a specific driver
	      might still be usable with the
	      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-drivers/xf86-video-vesa/pkg-descr">x11-drivers/xf86-video-vesa</a> driver.
	      This driver is installed by <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/xorg/pkg-descr">x11/xorg</a>.
	      It can also be installed manually as
	      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-drivers/xf86-video-vesa/pkg-descr">x11-drivers/xf86-video-vesa</a>.
	      <span class="application">Xorg</span> attempts to use this
	      driver when a specific driver is not found for the video
	      card.</p><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-drivers/xf86-video-scfb/pkg-descr">x11-drivers/xf86-video-scfb</a> is a
	      similar nonspecialized video driver that works on many
	      <acronym class="acronym">UEFI</acronym> and <span class="trademark">ARM</span>® computers.</p></dd><dt><a id="x-config-video-cards-file"></a><span class="term">Setting the Video Driver in a File</span></dt><dd><p>To set the <span class="trademark">Intel</span>® driver in a configuration
	      file:</p><div class="example"><a id="x-config-video-cards-file-intel"></a><div class="example-title">Example 5.1. Select <span class="trademark">Intel</span>® Video Driver in a File</div><div class="example-contents"><p><code class="filename">/usr/local/etc/X11/xorg.conf.d/driver-intel.conf</code></p><pre class="programlisting">Section "Device"
	Identifier "Card0"
	Driver     "intel"
	# BusID    "PCI:1:0:0"
EndSection</pre><p>If more than one video card is present, the
		<code class="literal">BusID</code> identifier can be uncommented
		and set to select the desired card.  A list of video
		card bus <acronym class="acronym">ID</acronym>s can be displayed with
		<code class="command">pciconf -lv | grep -B3
		  display</code>.</p></div></div><br class="example-break" /><p>To set the Radeon driver in a configuration
	      file:</p><div class="example"><a id="x-config-video-cards-file-radeon"></a><div class="example-title">Example 5.2. Select Radeon Video Driver in a File</div><div class="example-contents"><p><code class="filename">/usr/local/etc/X11/xorg.conf.d/driver-radeon.conf</code></p><pre class="programlisting">Section "Device"
	Identifier "Card0"
	Driver     "radeon"
EndSection</pre></div></div><br class="example-break" /><p>To set the <acronym class="acronym">VESA</acronym> driver in a
	      configuration file:</p><div class="example"><a id="x-config-video-cards-file-vesa"></a><div class="example-title">Example 5.3. Select <acronym class="acronym">VESA</acronym> Video Driver in a
		File</div><div class="example-contents"><p><code class="filename">/usr/local/etc/X11/xorg.conf.d/driver-vesa.conf</code></p><pre class="programlisting">Section "Device"
	Identifier "Card0"
	Driver     "vesa"
EndSection</pre></div></div><br class="example-break" /><p>To set the <code class="literal">scfb</code> driver for use
	      with a <acronym class="acronym">UEFI</acronym> or <span class="trademark">ARM</span>® computer:</p><div class="example"><a id="x-config-video-cards-file-scfb"></a><div class="example-title">Example 5.4. Select <code class="literal">scfb</code> Video Driver in a
		File</div><div class="example-contents"><p><code class="filename">/usr/local/etc/X11/xorg.conf.d/driver-scfb.conf</code></p><pre class="programlisting">Section "Device"
	Identifier "Card0"
	Driver     "scfb"
EndSection</pre></div></div><br class="example-break" /></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-monitors"></a>5.4.6. Monitors</h3></div></div></div><p>Almost all monitors support the Extended Display
	Identification Data standard (<acronym class="acronym">EDID</acronym>).
	<span class="application">Xorg</span> uses <acronym class="acronym">EDID</acronym>
	to communicate with the monitor and detect the supported
	resolutions and refresh rates.  Then it selects the most
	appropriate combination of settings to use with that
	monitor.</p><p>Other resolutions supported by the monitor can be
	chosen by setting the desired resolution in configuration
	files, or after the X server has been started with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a>.</p><div class="variablelist"><dl class="variablelist"><dt><a id="x-config-monitors-xrandr"></a><span class="term">Using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a></span></dt><dd><p>Run <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a> without any parameters to see a
	      list of video outputs and detected monitor modes:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>xrandr</code></strong>
Screen 0: minimum 320 x 200, current 3000 x 1920, maximum 8192 x 8192
DVI-0 connected primary 1920x1200+1080+0 (normal left inverted right x axis y axis) 495mm x 310mm
   1920x1200     59.95*+
   1600x1200     60.00
   1280x1024     85.02    75.02    60.02
   1280x960      60.00
   1152x864      75.00
   1024x768      85.00    75.08    70.07    60.00
   832x624       74.55
   800x600       75.00    60.32
   640x480       75.00    60.00
   720x400       70.08
DisplayPort-0 disconnected (normal left inverted right x axis y axis)
HDMI-0 disconnected (normal left inverted right x axis y axis)</pre><p>This shows that the <code class="literal">DVI-0</code> output
	      is being used to display a screen resolution of
	      1920x1200 pixels at a refresh rate of about 60 Hz.
	      Monitors are not attached to the
	      <code class="literal">DisplayPort-0</code> and
	      <code class="literal">HDMI-0</code> connectors.</p><p>Any of the other display modes can be selected with
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a>.  For example, to switch to 1280x1024 at
	      60 Hz:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>xrandr --mode 1280x1024 --rate 60</code></strong></pre><p>A common task is using the external video output on
	      a notebook computer for a video projector.</p><p>The type and quantity of output connectors varies
	      between devices, and the name given to each output
	      varies from driver to driver.  What one driver calls
	      <code class="literal">HDMI-1</code>, another might call
	      <code class="literal">HDMI1</code>.  So the first step is to run
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a> to list all the available
	      outputs:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>xrandr</code></strong>
Screen 0: minimum 320 x 200, current 1366 x 768, maximum 8192 x 8192
LVDS1 connected 1366x768+0+0 (normal left inverted right x axis y axis) 344mm x 193mm
   1366x768      60.04*+
   1024x768      60.00
   800x600       60.32    56.25
   640x480       59.94
VGA1 connected (normal left inverted right x axis y axis)
   1280x1024     60.02 +  75.02
   1280x960      60.00
   1152x864      75.00
   1024x768      75.08    70.07    60.00
   832x624       74.55
   800x600       72.19    75.00    60.32    56.25
   640x480       75.00    72.81    66.67    60.00
   720x400       70.08
HDMI1 disconnected (normal left inverted right x axis y axis)
DP1 disconnected (normal left inverted right x axis y axis)</pre><p>Four outputs were found: the built-in panel
	      <code class="literal">LVDS1</code>, and external
	      <code class="literal">VGA1</code>, <code class="literal">HDMI1</code>, and
	      <code class="literal">DP1</code> connectors.</p><p>The projector has been connected to the
	      <code class="literal">VGA1</code> output.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a> is now
	      used to set that output to the native resolution of the
	      projector and add the additional space to the right side
	      of the desktop:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>xrandr --output VGA1 --auto --right-of LVDS1</code></strong></pre><p><code class="literal">--auto</code> chooses the resolution and
	      refresh rate detected by <acronym class="acronym">EDID</acronym>.  If
	      the resolution is not correctly detected, a fixed value
	      can be given with <code class="literal">--mode</code> instead of
	      the <code class="literal">--auto</code> statement.  For example,
	      most projectors can be used with a 1024x768 resolution,
	      which is set with
	      <code class="literal">--mode 1024x768</code>.</p><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xrandr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xrandr</span>(1)</span></a> is often run from
	      <code class="filename">.xinitrc</code> to set the appropriate
	      mode when X starts.</p></dd><dt><a id="x-config-monitors-files"></a><span class="term">Setting Monitor Resolution in a File</span></dt><dd><p>To set a screen resolution of 1024x768 in a
	      configuration file:</p><div class="example"><a id="idp52318456"></a><div class="example-title">Example 5.5. Set Screen Resolution in a File</div><div class="example-contents"><p><code class="filename">/usr/local/etc/X11/xorg.conf.d/screen-resolution.conf</code></p><pre class="programlisting">Section "Screen"
	Identifier "Screen0"
	Device     "Card0"
	SubSection "Display"
	Modes      "1024x768"
	EndSubSection
EndSection</pre></div></div><br class="example-break" /><p>The few monitors that do not have
	      <acronym class="acronym">EDID</acronym> can be configured by setting
	      <code class="literal">HorizSync</code> and
	      <code class="literal">VertRefresh</code> to the range of
	      frequencies supported by the monitor.</p><div class="example"><a id="idp52321656"></a><div class="example-title">Example 5.6. Manually Setting Monitor Frequencies</div><div class="example-contents"><p><code class="filename">/usr/local/etc/X11/xorg.conf.d/monitor0-freq.conf</code></p><pre class="programlisting">Section "Monitor"
	Identifier   "Monitor0"
	HorizSync    30-83   # kHz
	VertRefresh  50-76   # Hz
EndSection</pre></div></div><br class="example-break" /></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-input"></a>5.4.7. Input Devices</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-input-keyboard"></a>5.4.7.1. Keyboards</h4></div></div></div><div class="variablelist"><dl class="variablelist"><dt><a id="x-config-input-keyboard-layout"></a><span class="term">Keyboard Layout</span></dt><dd><p>The standardized location of keys on a keyboard
		is called a <span class="emphasis"><em>layout</em></span>.  Layouts and
		other adjustable parameters are listed in
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xkeyboard-config&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xkeyboard-config</span>(7)</span></a>.</p><p>A United States layout is the default.  To select
		an alternate layout, set the
		<code class="literal">XkbLayout</code> and
		<code class="literal">XkbVariant</code> options in an
		<code class="literal">InputClass</code>.  This will be applied
		to all input devices that match the class.</p><p>This example selects a French keyboard
		layout.</p><div class="example"><a id="idp52330232"></a><div class="example-title">Example 5.7. Setting a Keyboard Layout</div><div class="example-contents"><p><code class="filename">/usr/local/etc/X11/xorg.conf.d/keyboard-fr.conf</code></p><pre class="programlisting">Section	"InputClass"
	Identifier	"KeyboardDefaults"
	MatchIsKeyboard	"on"
	Option		"XkbLayout" "fr"
EndSection</pre></div></div><br class="example-break" /><div class="example"><a id="idp52331896"></a><div class="example-title">Example 5.8. Setting Multiple Keyboard Layouts</div><div class="example-contents"><p>Set United States, Spanish, and Ukrainian
		  keyboard layouts.  Cycle through these layouts by
		  pressing
		  <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>Shift</strong></span>.  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/xxkb/pkg-descr">x11/xxkb</a> or
		  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/sbxkb/pkg-descr">x11/sbxkb</a> can be used for
		  improved layout switching control and
		  current layout indicators.</p><p><code class="filename">/usr/local/etc/X11/xorg.conf.d/kbd-layout-multi.conf</code></p><pre class="programlisting">Section	"InputClass"
	Identifier	"All Keyboards"
	MatchIsKeyboard	"yes"
	Option		"XkbLayout" "us, es, ua"
EndSection</pre></div></div><br class="example-break" /></dd><dt><a id="x-config-input-keyboard-zap"></a><span class="term">Closing <span class="application">Xorg</span> From the
	    Keyboard</span></dt><dd><p>X can be closed with a combination of keys.
		By default, that key combination is not set because it
		conflicts with keyboard commands for some
		applications.  Enabling this option requires changes
		to the keyboard <code class="literal">InputDevice</code>
		section:</p><div class="example"><a id="idp52342776"></a><div class="example-title">Example 5.9. Enabling Keyboard Exit from X</div><div class="example-contents"><p><code class="filename">/usr/local/etc/X11/xorg.conf.d/keyboard-zap.conf</code></p><pre class="programlisting">Section	"InputClass"
	Identifier	"KeyboardDefaults"
	MatchIsKeyboard	"on"
	Option		"XkbOptions" "terminate:ctrl_alt_bksp"
EndSection</pre></div></div><br class="example-break" /></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x11-input-mice"></a>5.4.7.2. Mice and Pointing Devices</h4></div></div></div><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">If using <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/xorg-server/pkg-descr">xorg-server</a> 1.20.8 or
	    later under FreeBSD 12.1 and not
	    using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=moused&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">moused</span>(8)</span></a>, add
	    <strong class="userinput"><code>kern.evdev.rcpt_mask=12</code></strong> to
	    <code class="filename">/etc/sysctl.conf</code>.</p></div><p>Many mouse parameters can be adjusted with configuration
	  options.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mousedrv&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mousedrv</span>(4)</span></a> for a full list.</p><div class="variablelist"><dl class="variablelist"><dt><a id="x11-input-mice-buttons"></a><span class="term">Mouse Buttons</span></dt><dd><p>The number of buttons on a mouse can be set in the
		mouse <code class="literal">InputDevice</code> section of
		<code class="filename">xorg.conf</code>.  To set the number of
		buttons to 7:</p><div class="example"><a id="idp52352120"></a><div class="example-title">Example 5.10. Setting the Number of Mouse Buttons</div><div class="example-contents"><p><code class="filename">/usr/local/etc/X11/xorg.conf.d/mouse0-buttons.conf</code></p><pre class="programlisting">Section "InputDevice"
	Identifier  "Mouse0"
	Option      "Buttons" "7"
EndSection</pre></div></div><br class="example-break" /></dd></dl></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-config-manual-configuration"></a>5.4.8. Manual Configuration</h3></div></div></div><p>In some cases, <span class="application">Xorg</span>
	autoconfiguration does not work with particular hardware, or a
	different configuration is desired.  For these cases, a custom
	configuration file can be created.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Do not create manual configuration files unless
	  required.  Unnecessary manual configuration can prevent
	  proper operation.</p></div><p>A configuration file can be generated by
	<span class="application">Xorg</span> based on the detected
	hardware.  This file is often a useful starting point for
	custom configurations.</p><p>Generating an <code class="filename">xorg.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>Xorg -configure</code></strong></pre><p>The configuration file is saved to
	<code class="filename">/root/xorg.conf.new</code>.  Make any changes
	desired, then test that file (using <code class="option">-retro</code>
	so there is a visible background) with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>Xorg -retro -config /root/xorg.conf.new</code></strong></pre><p>After the new configuration has been adjusted and tested,
	it can be split into smaller files in the normal location,
	<code class="filename">/usr/local/etc/X11/xorg.conf.d/</code>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-fonts"></a>5.5. Using Fonts in <span class="application">Xorg</span></h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="type1"></a>5.5.1. Type1 Fonts</h3></div></div></div><p>The default fonts that ship with
	<span class="application">Xorg</span> are less than ideal for
	typical desktop publishing applications.  Large presentation
	fonts show up jagged and unprofessional looking, and small
	fonts are almost completely unintelligible.  However, there
	are several free, high quality Type1 (<span class="trademark">PostScript</span>®) fonts
	available which can be readily used with
	<span class="application">Xorg</span>.  For instance, the URW font
	collection (<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-fonts/urwfonts/pkg-descr">x11-fonts/urwfonts</a>) includes
	high quality versions of standard type1 fonts (<span class="trademark">Times Roman</span>®, <span class="trademark">Helvetica</span>®, <span class="trademark">Palatino</span>® and others).  The
	Freefonts collection (<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-fonts/freefonts/pkg-descr">x11-fonts/freefonts</a>)
	includes many more fonts, but most of them are intended for
	use in graphics software such as the
	<span class="application">Gimp</span>, and are not complete enough
	to serve as screen fonts.  In addition,
	<span class="application">Xorg</span> can be configured to use
	<span class="trademark">TrueType</span>® fonts with a minimum of effort.  For more details
	on this, see the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=X&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">X</span>(7)</span></a> manual page or <a class="xref" href="#truetype" title="5.5.2. TrueType® Fonts">Section 5.5.2, &#8220;<span class="trademark">TrueType</span>® Fonts&#8221;</a>.</p><p>To install the above Type1 font collections from binary packages,
	run the following commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install urwfonts</code></strong></pre><p>Alternatively, to build from the Ports Collection, run the following
	commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11-fonts/urwfonts</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>And likewise with the freefont or other collections.  To
	have the X server detect these fonts, add an appropriate line
	to the X server configuration file
	(<code class="filename">/etc/X11/xorg.conf</code>), which reads:</p><pre class="programlisting">FontPath "/usr/local/share/fonts/urwfonts/"</pre><p>Alternatively, at the command line in the X session
	run:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>xset fp+ /usr/local/share/fonts/urwfonts</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>xset fp rehash</code></strong></pre><p>This will work but will be lost when the X session is
	closed, unless it is added to the startup file
	(<code class="filename">~/.xinitrc</code> for a normal
	<code class="command">startx</code> session, or
	<code class="filename">~/.xsession</code> when logging in through a
	graphical login manager like <span class="application">XDM</span>).
	A third way is to use the new
	<code class="filename">/usr/local/etc/fonts/local.conf</code> as
	demonstrated in <a class="xref" href="#antialias" title="5.5.3. Anti-Aliased Fonts">Section 5.5.3, &#8220;Anti-Aliased Fonts&#8221;</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="truetype"></a>5.5.2. <span class="trademark">TrueType</span>® Fonts</h3></div></div></div><a id="idp52406136" class="indexterm"></a><a id="idp52406904" class="indexterm"></a><p><span class="application">Xorg</span> has built in support for
	rendering <span class="trademark">TrueType</span>® fonts.  There are two different modules
	that can enable this functionality.  The freetype module is
	used in this example because it is more consistent with the
	other font rendering back-ends.  To enable the freetype module
	just add the following line to the <code class="literal">"Module"</code>
	section of <code class="filename">/etc/X11/xorg.conf</code>.</p><pre class="programlisting">Load  "freetype"</pre><p>Now make a directory for the <span class="trademark">TrueType</span>® fonts (for
	example, <code class="filename">/usr/local/share/fonts/TrueType</code>)
	and copy all of the <span class="trademark">TrueType</span>® fonts into this directory.
	Keep in mind that <span class="trademark">TrueType</span>® fonts cannot be directly taken
	from an <span class="trademark">Apple</span>® <span class="trademark">Mac</span>®; they must be in
	<span class="trademark">UNIX</span>®/<span class="trademark">MS-DOS</span>®/<span class="trademark">Windows</span>® format for use by
	<span class="application">Xorg</span>.  Once the files have been
	copied into this directory, use
	<span class="application">mkfontscale</span> to create a
	<code class="filename">fonts.dir</code>, so that the X font renderer
	knows that these new files have been installed.
	<code class="command">mkfontscale</code> can be installed as a
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install mkfontscale</code></strong></pre><p>Then create an index of X font files in a
	directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/share/fonts/TrueType</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkfontscale</code></strong></pre><p>Now add the <span class="trademark">TrueType</span>® directory to the font path.  This
	is just the same as described in <a class="xref" href="#type1" title="5.5.1. Type1 Fonts">Section 5.5.1, &#8220;Type1 Fonts&#8221;</a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>xset fp+ /usr/local/share/fonts/TrueType</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>xset fp rehash</code></strong></pre><p>or add a <code class="literal">FontPath</code> line to
	<code class="filename">xorg.conf</code>.</p><p>Now <span class="application">Gimp</span>,
	<span class="application">Apache OpenOffice</span>, and all of the
	other X applications should now recognize the installed
	<span class="trademark">TrueType</span>® fonts.  Extremely small fonts (as with text in a
	high resolution display on a web page) and extremely large
	fonts (within <span class="application"><span class="trademark">StarOffice</span>&#8482;</span>) will
	look much better now.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="antialias"></a>5.5.3. Anti-Aliased Fonts</h3></div></div></div><a id="idp52431352" class="indexterm"></a><a id="idp52444408" class="indexterm"></a><p>All fonts in <span class="application">Xorg</span> that are
	found in <code class="filename">/usr/local/share/fonts/</code> and
	<code class="filename">~/.fonts/</code> are automatically made
	available for anti-aliasing to Xft-aware applications.  Most
	recent applications are Xft-aware, including
	<span class="application">KDE</span>,
	<span class="application">GNOME</span>, and
	<span class="application">Firefox</span>.</p><p>To control which fonts are anti-aliased, or to
	configure anti-aliasing properties, create (or edit, if it
	already exists) the file
	<code class="filename">/usr/local/etc/fonts/local.conf</code>.  Several
	advanced features of the Xft font system can be tuned using
	this file; this section describes only some simple
	possibilities.  For more details, please see
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fonts-conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fonts-conf</span>(5)</span></a>.</p><a id="idp52449912" class="indexterm"></a><p>This file must be in XML format.  Pay careful attention to
	case, and make sure all tags are properly closed.  The file
	begins with the usual XML header followed by a DOCTYPE
	definition, and then the <code class="literal">&lt;fontconfig&gt;</code>
	tag:</p><pre class="programlisting">&lt;?xml version="1.0"?&gt;
      &lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
      &lt;fontconfig&gt;</pre><p>As previously stated, all fonts in
	<code class="filename">/usr/local/share/fonts/</code> as well as
	<code class="filename">~/.fonts/</code> are already made available to
	Xft-aware applications.  To add another directory
	outside of these two directory trees, add a line like
	this to
	<code class="filename">/usr/local/etc/fonts/local.conf</code>:</p><pre class="programlisting">&lt;dir&gt;/path/to/my/fonts&lt;/dir&gt;</pre><p>After adding new fonts, and especially new font
	directories, rebuild
	the font caches:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fc-cache -f</code></strong></pre><p>Anti-aliasing makes borders slightly fuzzy, which makes
	very small text more readable and removes
	<span class="quote">&#8220;<span class="quote">staircases</span>&#8221;</span> from large text, but can cause
	eyestrain if applied to normal text.  To exclude font sizes
	smaller than 14 point from anti-aliasing, include these
	lines:</p><pre class="programlisting">        &lt;match target="font"&gt;
	    &lt;test name="size" compare="less"&gt;
		&lt;double&gt;14&lt;/double&gt;
	    &lt;/test&gt;
	    &lt;edit name="antialias" mode="assign"&gt;
		&lt;bool&gt;false&lt;/bool&gt;
	    &lt;/edit&gt;
	&lt;/match&gt;
	&lt;match target="font"&gt;
	    &lt;test name="pixelsize" compare="less" qual="any"&gt;
		&lt;double&gt;14&lt;/double&gt;
	    &lt;/test&gt;
	    &lt;edit mode="assign" name="antialias"&gt;
		&lt;bool&gt;false&lt;/bool&gt;
	    &lt;/edit&gt;
	&lt;/match&gt;</pre><a id="idp52455928" class="indexterm"></a><p>Spacing for some monospaced fonts might also be
	inappropriate with anti-aliasing.  This seems to be an issue
	with <span class="application">KDE</span>, in particular.  One
	possible fix is to force the spacing for such fonts
	to be 100. Add these lines:</p><pre class="programlisting">	&lt;match target="pattern" name="family"&gt;
	   &lt;test qual="any" name="family"&gt;
	       &lt;string&gt;fixed&lt;/string&gt;
	   &lt;/test&gt;
	   &lt;edit name="family" mode="assign"&gt;
	       &lt;string&gt;mono&lt;/string&gt;
	   &lt;/edit&gt;
	&lt;/match&gt;
	&lt;match target="pattern" name="family"&gt;
	    &lt;test qual="any" name="family"&gt;
		&lt;string&gt;console&lt;/string&gt;
	    &lt;/test&gt;
	    &lt;edit name="family" mode="assign"&gt;
		&lt;string&gt;mono&lt;/string&gt;
	    &lt;/edit&gt;
	&lt;/match&gt;</pre><p>(this aliases the other common names for fixed fonts as
	<code class="literal">"mono"</code>), and then add:</p><pre class="programlisting">         &lt;match target="pattern" name="family"&gt;
	     &lt;test qual="any" name="family"&gt;
		 &lt;string&gt;mono&lt;/string&gt;
	     &lt;/test&gt;
	     &lt;edit name="spacing" mode="assign"&gt;
		 &lt;int&gt;100&lt;/int&gt;
	     &lt;/edit&gt;
	 &lt;/match&gt;      </pre><p>Certain fonts, such as Helvetica, may have a problem when
	anti-aliased.  Usually this manifests itself as a font that
	seems cut in half vertically.  At worst, it may cause
	applications to crash.  To avoid this, consider adding the
	following to <code class="filename">local.conf</code>:</p><pre class="programlisting">         &lt;match target="pattern" name="family"&gt;
	     &lt;test qual="any" name="family"&gt;
		 &lt;string&gt;Helvetica&lt;/string&gt;
	     &lt;/test&gt;
	     &lt;edit name="family" mode="assign"&gt;
		 &lt;string&gt;sans-serif&lt;/string&gt;
	     &lt;/edit&gt;
	 &lt;/match&gt;        </pre><p>After editing
	<code class="filename">local.conf</code>, make certain to end the file
	with the <code class="literal">&lt;/fontconfig&gt;</code> tag.  Not
	doing this will cause changes to be ignored.</p><p>Users can add personalized settings by creating their own
	<code class="filename">~/.config/fontconfig/fonts.conf</code>.  This
	file uses the same <acronym class="acronym">XML</acronym> format described
	above.</p><a id="idp52467064" class="indexterm"></a><a id="idp52467576" class="indexterm"></a><p>One last point: with an LCD screen, sub-pixel sampling may
	be desired.  This basically treats the (horizontally
	separated) red, green and blue components separately to
	improve the horizontal resolution; the results can be
	dramatic.  To enable this, add the line somewhere in
	<code class="filename">local.conf</code>:</p><pre class="programlisting">	 &lt;match target="font"&gt;
	     &lt;test qual="all" name="rgba"&gt;
		 &lt;const&gt;unknown&lt;/const&gt;
	     &lt;/test&gt;
	     &lt;edit name="rgba" mode="assign"&gt;
		 &lt;const&gt;rgb&lt;/const&gt;
	     &lt;/edit&gt;
	 &lt;/match&gt;</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Depending on the sort of display,
	  <code class="literal">rgb</code> may need to be changed to
	  <code class="literal">bgr</code>, <code class="literal">vrgb</code> or
	  <code class="literal">vbgr</code>: experiment and see which works
	  best.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-xdm"></a>5.6. The X Display Manager</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Seth</span> <span class="surname">Kingsley</span></span>. </span></div></div></div><a id="idp52475640" class="indexterm"></a><p><span class="application">Xorg</span> provides an X Display
      Manager, <span class="application">XDM</span>, which can be used for
      login session management.  <span class="application">XDM</span>
      provides a graphical interface for choosing which display server
      to connect to and for entering authorization information such as
      a login and password combination.</p><p>This section demonstrates how to configure the X Display
      Manager on FreeBSD.  Some desktop environments provide their own
      graphical login manager.  Refer to <a class="xref" href="#x11-wm-gnome" title="5.7.1. GNOME">Section 5.7.1, &#8220;GNOME&#8221;</a> for instructions on how to configure
      the GNOME Display Manager and <a class="xref" href="#x11-wm-kde" title="5.7.2. KDE">Section 5.7.2, &#8220;KDE&#8221;</a> for
      instructions on how to configure the KDE Display Manager.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52478712"></a>5.6.1. Configuring <span class="application">XDM</span></h3></div></div></div><p>To install <span class="application">XDM</span>, use the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/xdm/pkg-descr">x11/xdm</a> package or port.  Once installed,
	<span class="application">XDM</span> can be configured to run when
	the  machine boots up by editing this entry in
	<code class="filename">/etc/ttys</code>:</p><pre class="screen">ttyv8   "/usr/local/bin/xdm -nodaemon"  xterm   off secure</pre><p>Change the <code class="literal">off</code> to <code class="literal">on</code>
	and save the edit.  The <code class="literal">ttyv8</code> in this entry
	indicates that <span class="application">XDM</span> will run on the
	ninth virtual terminal.</p><p>The <span class="application">XDM</span> configuration directory
	is located in <code class="filename">/usr/local/etc/X11/xdm</code>.
	This directory contains several files used to change the
	behavior and appearance of <span class="application">XDM</span>, as
	well as a few scripts and programs used to set up the desktop
	when <span class="application">XDM</span> is running.  <a class="xref" href="#xdm-config-files" title="Table 5.1. XDM Configuration Files">Table 5.1, &#8220;XDM Configuration Files&#8221;</a> summarizes the function of each
	of these files.  The exact syntax and usage of these files is
	described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xdm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xdm</span>(1)</span></a>.</p><div class="table"><a id="xdm-config-files"></a><div class="table-title">Table 5.1. XDM Configuration Files</div><div class="table-contents"><table class="table" summary="XDM Configuration Files" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>File</th><th>Description</th></tr></thead><tbody><tr><td><code class="filename">Xaccess</code></td><td>The protocol for connecting to
		<span class="application">XDM</span> is called the X Display
		Manager Connection Protocol (<acronym class="acronym">XDMCP</acronym>).
		This file is a client authorization ruleset for
		controlling <acronym class="acronym">XDMCP</acronym> connections from
		remote machines.  By default, this file does not allow
		any remote clients to connect.</td></tr><tr><td><code class="filename">Xresources</code></td><td>This file controls the look and feel of the
		<span class="application">XDM</span> display chooser and
		login screens.  The default configuration is a simple
		rectangular login window with the hostname of the
		machine displayed at the top in a large font and
		<span class="quote">&#8220;<span class="quote">Login:</span>&#8221;</span> and <span class="quote">&#8220;<span class="quote">Password:</span>&#8221;</span>
		prompts below.  The format of this file is identical
		to the app-defaults file described in the
		<span class="application">Xorg</span>
		documentation.</td></tr><tr><td><code class="filename">Xservers</code></td><td>The list of local and remote displays the chooser
		should provide as login choices.</td></tr><tr><td><code class="filename">Xsession</code></td><td>Default session script for logins which is run by
		<span class="application">XDM</span> after a user has logged
		in.  This points to a customized session
		script in <code class="filename">~/.xsession</code>.</td></tr><tr><td><code class="filename">Xsetup_</code>*</td><td>Script to automatically launch applications
		before displaying the chooser or login interfaces.
		There is a script for each display being used, named
		<code class="filename">Xsetup_*</code>, where
		<code class="literal">*</code> is the local display number.
		Typically these scripts run one or two programs in the
		background such as
		<code class="command">xconsole</code>.</td></tr><tr><td><code class="filename">xdm-config</code></td><td>Global configuration for all displays running
		on this machine.</td></tr><tr><td><code class="filename">xdm-errors</code></td><td>Contains errors generated by the server program.
		If a display that <span class="application">XDM</span> is
		trying to start hangs, look at this file for error
		messages.  These messages are also written to the
		user's <code class="filename">~/.xsession-errors</code> on a
		per-session basis.</td></tr><tr><td><code class="filename">xdm-pid</code></td><td>The running process <acronym class="acronym">ID</acronym> of
		<span class="application">XDM</span>.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52523768"></a>5.6.2. Configuring Remote Access</h3></div></div></div><p>By default, only users on the same system can login using
	<span class="application">XDM</span>.  To enable users on other
	systems to connect to the display server, edit the access
	control rules and enable the connection listener.</p><p>To configure <span class="application">XDM</span> to listen for
	any remote connection, comment out the
	<code class="literal">DisplayManager.requestPort</code> line in
	<code class="filename">/usr/local/etc/X11/xdm/xdm-config</code> by
	putting a <code class="literal">!</code> in front of it:</p><pre class="screen">! SECURITY: do not listen for XDMCP or Chooser requests
! Comment out this line if you want to manage X terminals with xdm
DisplayManager.requestPort:     0</pre><p>Save the edits and restart <span class="application">XDM</span>.
	To restrict remote access, look at the example entries in
	<code class="filename">/usr/local/etc/X11/xdm/Xaccess</code> and refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xdm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xdm</span>(1)</span></a> for further information.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x11-wm"></a>5.7. Desktop Environments</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Valentino</span> <span class="surname">Vaschetto</span></span>. </span></div></div></div><p>This section describes how to install three popular desktop
      environments on a FreeBSD system.  A desktop environment can range
      from a simple window manager to a complete suite of desktop
      applications.  Over a hundred desktop environments are available
      in the <code class="filename">x11-wm</code> category of the Ports
      Collection.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x11-wm-gnome"></a>5.7.1. GNOME</h3></div></div></div><a id="idp52535032" class="indexterm"></a><p><span class="application">GNOME</span> is a user-friendly
	desktop environment.  It includes a panel for starting
	applications and displaying status, a desktop, a set of tools
	and applications, and a set of conventions that make it easy
	for applications to cooperate and be consistent with each
	other.  More information regarding
	<span class="application">GNOME</span> on FreeBSD can be found at <a class="link" href="https://www.FreeBSD.org/gnome" target="_top">https://www.FreeBSD.org/gnome</a>.
	That web site contains additional documentation about
	installing, configuring, and managing
	<span class="application">GNOME</span> on FreeBSD.</p><p>This desktop environment can be installed from a
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install gnome3</code></strong></pre><p>To instead build <span class="application">GNOME</span> from
	ports, use the following command.
	<span class="application">GNOME</span> is a large application and
	will take some time to compile, even on a fast
	computer.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11/gnome3</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p><span class="application">GNOME</span>
	requires <code class="filename">/proc</code> to be mounted.  Add this
	line to <code class="filename">/etc/fstab</code> to mount this file
	system automatically during system startup:</p><pre class="programlisting">proc           /proc       procfs  rw  0   0</pre><p><span class="application">GNOME</span> uses
	<span class="application">D-Bus</span> and
	<span class="application">HAL</span> for a message bus and hardware
	abstraction.  These applications are automatically installed
	as dependencies of <span class="application">GNOME</span>.  Enable
	them in <code class="filename">/etc/rc.conf</code> so they will be
	started when the system boots:</p><pre class="programlisting">dbus_enable="YES"
hald_enable="YES"</pre><p>After installation,
	configure <span class="application">Xorg</span> to start
	<span class="application">GNOME</span>.  The easiest way to do this
	is to enable the GNOME Display Manager,
	<span class="application">GDM</span>, which is installed as part of
	the <span class="application">GNOME</span> package or port.  It can
	be enabled by adding this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">gdm_enable="YES"</pre><p>It is often desirable to also start all
	<span class="application">GNOME</span> services.  To achieve this,
	add a second line to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">gnome_enable="YES"</pre><p><span class="application">GDM</span> will start
	automatically when the system boots.</p><p>A second method for starting
	<span class="application">GNOME</span> is to type
	<code class="command">startx</code> from the command-line after
	configuring <code class="filename">~/.xinitrc</code>.  If this file
	already exists, replace the line that starts the current
	window manager with one that starts
	<code class="filename">/usr/local/bin/gnome-session</code>.  If this
	file does not exist, create it with this command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>echo "exec /usr/local/bin/gnome-session" &gt; ~/.xinitrc</code></strong></pre><p>A third method is to use <span class="application">XDM</span> as
	the display manager.  In this case, create an executable
	<code class="filename">~/.xsession</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>echo "exec /usr/local/bin/gnome-session" &gt; ~/.xsession</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x11-wm-kde"></a>5.7.2. KDE</h3></div></div></div><a id="idp52573176" class="indexterm"></a><p><span class="application">KDE</span> is another easy-to-use
	desktop environment.  This desktop provides a suite of
	applications with a consistent look and feel, a standardized
	menu and toolbars, keybindings, color-schemes,
	internationalization, and a centralized, dialog-driven desktop
	configuration.  More information on
	<span class="application">KDE</span> can be found at <a class="link" href="http://www.kde.org/" target="_top">http://www.kde.org/</a>.
	For FreeBSD-specific information, consult <a class="link" href="http://freebsd.kde.org/" target="_top">http://freebsd.kde.org</a>.</p><p>To install the <span class="application">KDE</span> package,
	type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install x11/kde5</code></strong></pre><p>To instead build the <span class="application">KDE</span> port,
	use the following command.  Installing the port will provide a
	menu for selecting which components to install.
	<span class="application">KDE</span> is a large application and will
	take some time to compile, even on a fast computer.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11/kde5</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p><span class="application">KDE</span> requires
	<code class="filename">/proc</code> to be mounted.  Add this line to
	<code class="filename">/etc/fstab</code> to mount this file system
	automatically during system startup:</p><pre class="programlisting">proc           /proc       procfs  rw  0   0</pre><p><span class="application">KDE</span> uses
	<span class="application">D-Bus</span> and
	<span class="application">HAL</span> for a message bus and hardware
	abstraction.  These applications are automatically installed
	as dependencies of <span class="application">KDE</span>.  Enable
	them in <code class="filename">/etc/rc.conf</code> so they will be
	started when the system boots:</p><pre class="programlisting">dbus_enable="YES"
hald_enable="YES"</pre><a id="idp52588920" class="indexterm"></a><p>Since KDE Plasma 5, the KDE Display Manager,
	<span class="application">KDM</span> is no longer developed.
	A possible replacement is <span class="application">SDDM</span>.
	To install it, type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install x11/sddm</code></strong></pre><p>Add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">sddm_enable="YES"</pre><p>A second method for launching
	<span class="application">KDE Plasma</span> is to type
	<code class="command">startx</code> from the command line.  For this to
	work, the following line is needed in
	<code class="filename">~/.xinitrc</code>:</p><pre class="programlisting">exec ck-launch-session startplasma-x11</pre><p>A third method for starting <span class="application">KDE Plasma</span>
	is through <span class="application">XDM</span>.  To do so, create
	an executable <code class="filename">~/.xsession</code> as
	follows:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>echo "exec ck-launch-session startplasma-x11" &gt; ~/.xsession</code></strong></pre><p>Once <span class="application">KDE Plasma</span> is started, refer to
	its built-in help system for more information on how to use
	its various menus and applications.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x11-wm-xfce"></a>5.7.3. Xfce</h3></div></div></div><p><span class="application">Xfce</span> is a desktop environment
	based on the GTK+ toolkit used by
	<span class="application">GNOME</span>.  However, it is more
	lightweight and provides a simple, efficient, easy-to-use
	desktop.  It is fully configurable, has a main panel with
	menus, applets, and application launchers, provides a file
	manager and sound manager, and is themeable.  Since it is
	fast, light, and efficient, it is ideal for older or slower
	machines with memory limitations.  More information on
	<span class="application">Xfce</span> can be found at <a class="link" href="http://www.xfce.org/" target="_top">http://www.xfce.org</a>.</p><p>To install the <span class="application">Xfce</span>
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install xfce</code></strong></pre><p>Alternatively, to build the port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11-wm/xfce4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p><span class="application">Xfce</span> uses
	<span class="application">D-Bus</span> for a message bus.  This
	application is automatically installed as dependency of
	<span class="application">Xfce</span>.  Enable it in
	<code class="filename">/etc/rc.conf</code> so it will be started when
	the system boots:</p><pre class="programlisting">dbus_enable="YES"</pre><p>Unlike <span class="application">GNOME</span> or
	<span class="application">KDE</span>,
	<span class="application">Xfce</span> does not provide its own login
	manager.  In order to start <span class="application">Xfce</span>
	from the command line by typing <code class="command">startx</code>,
	first create <code class="filename">~/.xinitrc</code> with this
	command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>echo ". /usr/local/etc/xdg/xfce4/xinitrc" &gt; ~/.xinitrc</code></strong></pre><p>An alternate method is to use
	<span class="application">XDM</span>.  To configure this method,
	create an executable <code class="filename">~/.xsession</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>echo ". /usr/local/etc/xdg/xfce4/xinitrc" &gt; ~/.xsession</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x-compiz-fusion"></a>5.8. Installing Compiz Fusion</h2></div></div></div><p>One way to make using a desktop
      computer more pleasant is with nice 3D effects.</p><p>Installing the <span class="application">Compiz Fusion</span>
      package is easy, but configuring it requires a few steps that
      are not described in the port's documentation.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="x-compiz-video-card"></a>5.8.1. Setting up the FreeBSD nVidia Driver</h3></div></div></div><p>Desktop effects can cause quite a load on the graphics
	card.  For an nVidia-based graphics card, the proprietary
	driver is required for good performance.  Users of other
	graphics cards can skip this section and continue with the
	<code class="filename">xorg.conf</code> configuration.</p><p>To determine which nVidia driver is needed see the <a class="link" href="../../../../doc/en_US.ISO8859-1/books/faq/x.html#idp59950544" target="_top">FAQ question
	  on the subject</a>.</p><p>Having determined the correct driver to use for your card,
	installation is as simple as installing any other
	package.</p><p>For example, to install the latest driver:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install x11/nvidia-driver</code></strong></pre><p>The driver will create a kernel module, which needs to be
	loaded at system startup.  Add the following line to
	<code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">nvidia_load="YES"</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">To immediately load the kernel module into the running
	  kernel issue a command like <code class="command">kldload
	    nvidia</code>. However, it has been noted that some
	  versions of <span class="application">Xorg</span> will not
	  function properly if the driver is not loaded at boot time.
	  After editing <code class="filename">/boot/loader.conf</code>, a
	  reboot is recommended.</p></div><p>With the kernel module loaded, you normally only need to
	change a single line in <code class="filename">xorg.conf</code>
	to enable the proprietary driver:</p><p>Find the following line in
	<code class="filename">/etc/X11/xorg.conf</code>:</p><pre class="programlisting">Driver      "nv"</pre><p>and change it to:</p><pre class="programlisting">Driver      "nvidia"</pre><p>Start the GUI as usual, and you should be greeted by the
	nVidia splash.  Everything should work as usual.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="xorg-configuration"></a>5.8.2. Configuring xorg.conf for Desktop Effects</h3></div></div></div><p>To enable <span class="application">Compiz Fusion</span>,
	<code class="filename">/etc/X11/xorg.conf</code> needs to be
	modified:</p><p>Add the following section to enable composite
	effects:</p><pre class="programlisting">Section "Extensions"
    Option         "Composite" "Enable"
EndSection</pre><p>Locate the <span class="quote">&#8220;<span class="quote">Screen</span>&#8221;</span> section which should look
	similar to the one below:</p><pre class="programlisting">Section "Screen"
    Identifier     "Screen0"
    Device         "Card0"
    Monitor        "Monitor0"
    ...</pre><p>and add the following two lines (after
	<span class="quote">&#8220;<span class="quote">Monitor</span>&#8221;</span> will do):</p><pre class="programlisting">DefaultDepth    24
Option         "AddARGBGLXVisuals" "True"</pre><p>Locate the <span class="quote">&#8220;<span class="quote">Subsection</span>&#8221;</span> that refers to the
	screen resolution that you wish to use.  For example, if you
	wish to use 1280x1024, locate the section that follows.  If
	the desired resolution does not appear in any subsection, you
	may add the relevant entry by hand:</p><pre class="programlisting">SubSection     "Display"
    Viewport    0 0
    Modes      "1280x1024"
EndSubSection</pre><p>A color depth of 24 bits is needed for desktop
	composition, change the above subsection to:</p><pre class="programlisting">SubSection     "Display"
    Viewport    0 0
    Depth       24
    Modes      "1280x1024"
EndSubSection</pre><p>Finally, confirm that the <span class="quote">&#8220;<span class="quote">glx</span>&#8221;</span> and
	<span class="quote">&#8220;<span class="quote">extmod</span>&#8221;</span> modules are loaded in the
	<span class="quote">&#8220;<span class="quote">Module</span>&#8221;</span> section:</p><pre class="programlisting">Section "Module"
    Load           "extmod"
    Load           "glx"
    ...</pre><p>The preceding can be done automatically with
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/nvidia-xconfig/pkg-descr">x11/nvidia-xconfig</a> by running (as
	root):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nvidia-xconfig --add-argb-glx-visuals</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>nvidia-xconfig --composite</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>nvidia-xconfig --depth=24</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="compiz-fusion"></a>5.8.3. Installing and Configuring Compiz Fusion</h3></div></div></div><p>Installing <span class="application">Compiz Fusion</span>
	is as simple as any other package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install x11-wm/compiz-fusion</code></strong></pre><p>When the installation is finished, start your graphic
	desktop and at a terminal, enter the following commands (as a
	normal user):</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>compiz --replace --sm-disable --ignore-desktop-hints ccp &amp;</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>emerald --replace &amp;</code></strong></pre><p>Your screen will flicker for a few seconds, as your window
	manager (e.g. <span class="application">Metacity</span> if you are
	using <span class="application">GNOME</span>) is replaced by
	<span class="application">Compiz Fusion</span>.
	<span class="application">Emerald</span> takes care of the window
	decorations (i.e. close, minimize, maximize buttons, title
	bars and so on).</p><p>You may convert this to a trivial script and have it run
	at startup automatically (e.g. by adding to
	<span class="quote">&#8220;<span class="quote">Sessions</span>&#8221;</span> in a <span class="application">GNOME</span>
	desktop):</p><pre class="programlisting">#! /bin/sh
compiz --replace --sm-disable --ignore-desktop-hints ccp &amp;
emerald --replace &amp;</pre><p>Save this in your home directory as, for example,
	<code class="filename">start-compiz</code> and make it
	executable:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>chmod +x ~/start-compiz</code></strong></pre><p>Then use the GUI to add it to <span class="guimenuitem">Startup
	  Programs</span> (located in
	<span class="guimenuitem">System</span>,
	<span class="guimenuitem">Preferences</span>,
	<span class="guimenuitem">Sessions</span> on a
	<span class="application">GNOME</span> desktop).</p><p>To actually select all the desired effects and their
	settings, execute (again as a normal user) the
	<span class="application">Compiz Config Settings Manager</span>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ccsm</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In <span class="application">GNOME</span>, this can also be
	  found in the <span class="guimenuitem">System</span>,
	  <span class="guimenuitem">Preferences</span> menu.</p></div><p>If you have selected <span class="quote">&#8220;<span class="quote">gconf support</span>&#8221;</span> during
	the build, you will also be able to view these settings using
	<code class="command">gconf-editor</code> under
	<code class="literal">apps/compiz</code>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="x11-troubleshooting"></a>5.9. Troubleshooting</h2></div></div></div><p>If the mouse does not work, you will need to first configure
      it before proceeding.
      In recent <span class="application">Xorg</span>
      versions, the <code class="literal">InputDevice</code> sections in
      <code class="filename">xorg.conf</code> are ignored in favor of the
      autodetected devices.  To restore the old behavior, add the
      following line to the <code class="literal">ServerLayout</code> or
      <code class="literal">ServerFlags</code> section of this file:</p><pre class="programlisting">Option "AutoAddDevices" "false"</pre><p>Input devices may then be configured as in previous
	versions, along with any other options needed (e.g., keyboard
	layout switching).</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">As previously explained the
	  <span class="application">hald</span> daemon will, by default,
	  automatically detect your keyboard.  There are chances that
	  your keyboard layout or model will not be correct, desktop
	  environments like <span class="application">GNOME</span>,
	  <span class="application">KDE</span> or
	  <span class="application">Xfce</span> provide tools to configure
	  the keyboard.  However, it is possible to set the keyboard
	  properties directly either with the help of the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setxkbmap&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setxkbmap</span>(1)</span></a> utility or with a
	  <span class="application">hald</span>'s configuration rule.</p><p xmlns="http://www.w3.org/1999/xhtml">For example if, one wants to use a PC 102 keys keyboard
	  coming with a french layout, we have to create a keyboard
	  configuration file for <span class="application">hald</span>
	  called <code class="filename">x11-input.fdi</code> and saved in the
	  <code class="filename">/usr/local/etc/hal/fdi/policy</code>
	  directory.  This file should contain the following
	  lines:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.capabilities" contains="input.keyboard"&gt;
	  &lt;merge key="input.x11_options.XkbModel" type="string"&gt;pc102&lt;/merge&gt;
	  &lt;merge key="input.x11_options.XkbLayout" type="string"&gt;fr&lt;/merge&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</pre><p xmlns="http://www.w3.org/1999/xhtml">If this file already exists, just copy and add to your
	  file the lines regarding the keyboard configuration.</p><p xmlns="http://www.w3.org/1999/xhtml">You will have to reboot your machine to force
	  <span class="application">hald</span> to read this file.</p><p xmlns="http://www.w3.org/1999/xhtml">It is possible to do the same configuration from an X
	  terminal or a script with this command line:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">%</code> <strong class="userinput"><code>setxkbmap -model pc102 -layout fr</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml"><code class="filename">/usr/local/share/X11/xkb/rules/base.lst</code>
	  lists the various keyboard, layouts and options
	  available.</p></div><a id="idp52737528" class="indexterm"></a><p>The <code class="filename">xorg.conf.new</code> configuration file
	may now be tuned to taste.  Open the file in a text editor
	such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=emacs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">emacs</span>(1)</span></a> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ee&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ee</span>(1)</span></a>.  If the monitor is an
	older or unusual model that does not support autodetection of
	sync frequencies, those settings can be added to
	<code class="filename">xorg.conf.new</code> under the
	<code class="literal">"Monitor"</code> section:</p><pre class="programlisting">Section "Monitor"
	Identifier   "Monitor0"
	VendorName   "Monitor Vendor"
	ModelName    "Monitor Model"
	HorizSync    30-107
	VertRefresh  48-120
EndSection</pre><p>Most monitors support sync frequency autodetection, making
	manual entry of these values unnecessary.  For the few
	monitors that do not support autodetection, avoid potential
	damage by only entering values provided by the
	manufacturer.</p><p>X allows DPMS (Energy Star) features to be used with
	capable monitors.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xset&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xset</span>(1)</span></a> program controls the
	time-outs and can force standby, suspend, or off modes.  If
	you wish to enable DPMS features for your monitor, you must
	add the following line to the monitor section:</p><pre class="programlisting">Option       "DPMS"</pre><a id="idp52743928" class="indexterm"></a><p>While the <code class="filename">xorg.conf.new</code> configuration
	file is still open in an editor, select the default resolution
	and color depth desired.  This is defined in the
	<code class="literal">"Screen"</code> section:</p><pre class="programlisting">Section "Screen"
	Identifier "Screen0"
	Device     "Card0"
	Monitor    "Monitor0"
	DefaultDepth 24
	SubSection "Display"
		Viewport  0 0
		Depth     24
		Modes     "1024x768"
	EndSubSection
EndSection</pre><p>The <code class="literal">DefaultDepth</code> keyword describes the
	color depth to run at by default.  This can be overridden with
	the <code class="option">-depth</code> command line switch to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=Xorg&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">Xorg</span>(1)</span></a>.  The <code class="literal">Modes</code> keyword describes
	the resolution to run at for the given color depth.  Note that
	only VESA standard modes are supported as defined by the
	target system's graphics hardware.  In the example above, the
	default color depth is twenty-four bits per pixel.  At this
	color depth, the accepted resolution is 1024 by 768
	pixels.</p><p>Finally, write the configuration file and test it using
	the test mode given above.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">One of the tools available to assist you during
	  troubleshooting process are the
	  <span class="application">Xorg</span> log files, which contain
	  information on each device that the
	  <span class="application">Xorg</span> server attaches to.
	  <span class="application">Xorg</span> log file names are in the
	  format of <code class="filename">/var/log/Xorg.0.log</code>.  The
	  exact name of the log can vary from
	  <code class="filename">Xorg.0.log</code> to
	  <code class="filename">Xorg.8.log</code> and so forth.</p></div><p>If all is well, the configuration file needs to be
	installed in a common location where <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=Xorg&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">Xorg</span>(1)</span></a> can find it.
	This is typically <code class="filename">/etc/X11/xorg.conf</code> or
	<code class="filename">/usr/local/etc/X11/xorg.conf</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp xorg.conf.new /etc/X11/xorg.conf</code></strong></pre><p>The <span class="application">Xorg</span> configuration
	process is now complete.  <span class="application">Xorg</span>
	may be now started with the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=startx&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">startx</span>(1)</span></a> utility.  The
	<span class="application">Xorg</span> server may also be started
	with the use of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=xdm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">xdm</span>(1)</span></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52766712"></a>5.9.1. Configuration with <span class="trademark">Intel</span>® <code class="literal">i810</code>
	  Graphics Chipsets</h3></div></div></div><a id="idp52768248" class="indexterm"></a><p>Configuration with <span class="trademark">Intel</span>® i810 integrated chipsets
	  requires the <code class="filename">agpgart</code> AGP programming
	  interface for <span class="application">Xorg</span> to drive the
	  card.  See the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=agp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">agp</span>(4)</span></a> driver manual page for more
	  information.</p><p>This will allow configuration of the hardware as any
	  other graphics board.  Note on systems without the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=agp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">agp</span>(4)</span></a> driver compiled in the kernel, trying to load
	  the module with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a> will not work.  This driver
	  has to be in the kernel at boot time through being compiled
	  in or using <code class="filename">/boot/loader.conf</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52773880"></a>5.9.2. Adding a Widescreen Flatpanel to the Mix</h3></div></div></div><a id="idp52774520" class="indexterm"></a><p>This section assumes a bit of advanced configuration
	  knowledge.  If attempts to use the standard configuration
	  tools above have not resulted in a working configuration,
	  there is information enough in the log files to be of use in
	  getting the setup working.  Use of a text editor will be
	  necessary.</p><p>Current widescreen (WSXGA, WSXGA+, WUXGA, WXGA, WXGA+,
	  et.al.) formats support 16:10 and 10:9 formats or aspect
	  ratios that can be problematic.  Examples of some common
	  screen resolutions for 16:10 aspect ratios are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>2560x1600</p></li><li class="listitem"><p>1920x1200</p></li><li class="listitem"><p>1680x1050</p></li><li class="listitem"><p>1440x900</p></li><li class="listitem"><p>1280x800</p></li></ul></div><p>At some point, it will be as easy as adding one of these
	  resolutions as a possible <code class="literal">Mode</code> in the
	  <code class="literal">Section "Screen"</code> as such:</p><pre class="programlisting">Section "Screen"
Identifier "Screen0"
Device     "Card0"
Monitor    "Monitor0"
DefaultDepth 24
SubSection "Display"
	Viewport  0 0
	Depth     24
	Modes     "1680x1050"
EndSubSection
EndSection</pre><p><span class="application">Xorg</span> is smart enough to
	  pull the resolution information from the widescreen via
	  I2C/DDC information so it knows what the monitor can handle
	  as far as frequencies and resolutions.</p><p>If those <code class="literal">ModeLines</code> do not exist in
	  the drivers, one might need to give
	  <span class="application">Xorg</span> a little hint.  Using
	  <code class="filename">/var/log/Xorg.0.log</code> one can extract
	  enough information to manually create a
	  <code class="literal">ModeLine</code> that will work.  Simply look for
	  information resembling this:</p><pre class="programlisting">(II) MGA(0): Supported additional Video Mode:
(II) MGA(0): clock: 146.2 MHz   Image Size:  433 x 271 mm
(II) MGA(0): h_active: 1680  h_sync: 1784  h_sync_end 1960 h_blank_end 2240 h_border: 0
(II) MGA(0): v_active: 1050  v_sync: 1053  v_sync_end 1059 v_blanking: 1089 v_border: 0
(II) MGA(0): Ranges: V min: 48  V max: 85 Hz, H min: 30  H max: 94 kHz, PixClock max 170 MHz</pre><p>This information is called EDID information.  Creating a
	  <code class="literal">ModeLine</code> from this is just a matter of
	  putting the numbers in the correct order:</p><pre class="programlisting">ModeLine &lt;name&gt; &lt;clock&gt; &lt;4 horiz. timings&gt; &lt;4 vert. timings&gt;</pre><p>So that the <code class="literal">ModeLine</code> in
	  <code class="literal">Section "Monitor"</code> for this example would
	  look like this:</p><pre class="programlisting">Section "Monitor"
Identifier      "Monitor1"
VendorName      "Bigname"
ModelName       "BestModel"
ModeLine        "1680x1050" 146.2 1680 1784 1960 2240 1050 1053 1059 1089
Option          "DPMS"
EndSection</pre><p>Now having completed these simple editing steps, X
	  should start on your new widescreen monitor.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="compiz-troubleshooting"></a>5.9.3. Troubleshooting Compiz Fusion</h3></div></div></div><div class="qandaset"><a id="idp52796920"></a><dl><dt>5.9.3.1. <a href="#idp52797176">I have installed
		Compiz Fusion, and
		after running the commands you mention, my windows are
		left without title bars and buttons.  What is
		wrong?</a></dt><dt>5.9.3.2. <a href="#idp52800888">When I run the command to start
		Compiz Fusion, the X
		server crashes and I am back at the console.  What is
		wrong?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp52797176"></a><a id="no-decorations"></a><p><strong>5.9.3.1.</strong></p></td><td align="left" valign="top"><p>I have installed
		<span class="application">Compiz Fusion</span>, and
		after running the commands you mention, my windows are
		left without title bars and buttons.  What is
		wrong?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>You are probably missing a setting in
		<code class="filename">/etc/X11/xorg.conf</code>.  Review this
		file carefully and check especially the
		<code class="literal">DefaultDepth</code> and
		<code class="literal">AddARGBGLXVisuals</code>
		directives.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp52800888"></a><a id="xorg-crash"></a><p><strong>5.9.3.2.</strong></p></td><td align="left" valign="top"><p>When I run the command to start
		<span class="application">Compiz Fusion</span>, the X
		server crashes and I am back at the console.  What is
		wrong?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If you check
		<code class="filename">/var/log/Xorg.0.log</code>, you
		will probably find error messages during the X
		startup.  The most common would be:</p><pre class="screen">(EE) NVIDIA(0):     Failed to initialize the GLX module; please check in your X
(EE) NVIDIA(0):     log file that the GLX module has been loaded in your X
(EE) NVIDIA(0):     server, and that the module is the NVIDIA GLX module.  If
(EE) NVIDIA(0):     you continue to encounter problems, Please try
(EE) NVIDIA(0):     reinstalling the NVIDIA driver.</pre><p>This is usually the case when you upgrade
	      <span class="application">Xorg</span>.  You will need to
	      reinstall the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11/nvidia-driver/pkg-descr">x11/nvidia-driver</a>
	      package so glx is built again.</p></td></tr></tbody></table></div></div></div></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="common-tasks"></a>Part II. Common Tasks</h1></div></div></div><div class="partintro"><div xmlns=""></div><p>Now that the basics have been covered, this part of the
	book discusses some frequently used features of FreeBSD.  These
	chapters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Introduce popular and useful desktop applications:
	    browsers, productivity tools, document viewers, and
	    more.</p></li><li class="listitem"><p>Introduce a number of multimedia tools available for
	    FreeBSD.</p></li><li class="listitem"><p>Explain the process of building a customized FreeBSD
	    kernel to enable extra functionality.</p></li><li class="listitem"><p>Describe the print system in detail, both for desktop
	    and network-connected printer setups.</p></li><li class="listitem"><p>Show how to run Linux applications on the FreeBSD
	    system.</p></li></ul></div><p>Some of these chapters recommend prior reading, and this
	is noted in the synopsis at the beginning of each
	chapter.</p><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="chapter"><a href="#desktop">6. Desktop Applications</a></span></dt><dd><dl><dt><span class="sect1"><a href="#desktop-synopsis">6.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#desktop-browsers">6.2. Browsers</a></span></dt><dt><span class="sect1"><a href="#desktop-productivity">6.3. Productivity</a></span></dt><dt><span class="sect1"><a href="#desktop-viewers">6.4. Document Viewers</a></span></dt><dt><span class="sect1"><a href="#desktop-finance">6.5. Finance</a></span></dt></dl></dd><dt><span class="chapter"><a href="#multimedia">7. Multimedia</a></span></dt><dd><dl><dt><span class="sect1"><a href="#multimedia-synopsis">7.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#sound-setup">7.2. Setting Up the Sound Card</a></span></dt><dt><span class="sect1"><a href="#sound-mp3">7.3. MP3 Audio</a></span></dt><dt><span class="sect1"><a href="#video-playback">7.4. Video Playback</a></span></dt><dt><span class="sect1"><a href="#tvcard">7.5. TV Cards</a></span></dt><dt><span class="sect1"><a href="#mythtv">7.6. MythTV</a></span></dt><dt><span class="sect1"><a href="#scanners">7.7. Image Scanners</a></span></dt></dl></dd><dt><span class="chapter"><a href="#kernelconfig">8. Configuring the FreeBSD Kernel</a></span></dt><dd><dl><dt><span class="sect1"><a href="#kernelconfig-synopsis">8.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-custom-kernel">8.2. Why Build a Custom Kernel?</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-devices">8.3. Finding the System Hardware</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-config">8.4. The Configuration File</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-building">8.5. Building and Installing a Custom Kernel</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-trouble">8.6. If Something Goes Wrong</a></span></dt></dl></dd><dt><span class="chapter"><a href="#printing">9. Printing</a></span></dt><dd><dl><dt><span class="sect1"><a href="#printing-quick-start">9.1. Quick Start</a></span></dt><dt><span class="sect1"><a href="#printing-connections">9.2. Printer Connections</a></span></dt><dt><span class="sect1"><a href="#printing-pdls">9.3. Common Page Description Languages</a></span></dt><dt><span class="sect1"><a href="#printing-direct">9.4. Direct Printing</a></span></dt><dt><span class="sect1"><a href="#printing-lpd">9.5. <acronym class="acronym">LPD</acronym> (Line Printer Daemon)</a></span></dt><dt><span class="sect1"><a href="#printing-other">9.6. Other Printing Systems</a></span></dt></dl></dd><dt><span class="chapter"><a href="#linuxemu">10. <span class="trademark">Linux</span>® Binary Compatibility</a></span></dt><dd><dl><dt><span class="sect1"><a href="#linuxemu-synopsis">10.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#linuxemu-lbc-install">10.2. Configuring <span class="trademark">Linux</span>® Binary Compatibility</a></span></dt><dt><span class="sect1"><a href="#linuxemu-advanced">10.3. Advanced Topics</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="desktop"></a>Chapter 6. Desktop Applications</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#desktop-synopsis">6.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#desktop-browsers">6.2. Browsers</a></span></dt><dt><span class="sect1"><a href="#desktop-productivity">6.3. Productivity</a></span></dt><dt><span class="sect1"><a href="#desktop-viewers">6.4. Document Viewers</a></span></dt><dt><span class="sect1"><a href="#desktop-finance">6.5. Finance</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="desktop-synopsis"></a>6.1. Synopsis</h2></div></div></div><p>While FreeBSD is popular as a server for its performance and
      stability, it is also suited for day-to-day use as a desktop.
      With over 24,000 applications available as FreeBSD packages
      or ports, it is easy to build a customized desktop that runs
      a wide variety of desktop applications.  This chapter
      demonstrates how to install numerous desktop applications,
      including web browsers, productivity software, document viewers,
      and financial software.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Users who prefer to install a pre-built desktop version
	of FreeBSD rather than configuring one from scratch should
	refer to <a class="link" href="https://www.furybsd.org" target="_top">FuryBSD</a>,
	<a class="link" href="https://ghostbsd.org" target="_top">GhostBSD</a> or
	<a class="link" href="https://www.midnightbsd.org" target="_top">MidnightBSD</a>.</p></div><p>Readers of this chapter should know how to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Install additional software using packages or
	  ports as described in <a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a>.</p></li><li class="listitem"><p>Install X and a window manager as described in
	  <a class="xref" href="#x11" title="Chapter 5. The X Window System">Chapter 5, <em>The X Window System</em></a>.</p></li></ul></div><p>For information on how to configure a multimedia
      environment, refer to <a class="xref" href="#multimedia" title="Chapter 7. Multimedia">Chapter 7, <em>Multimedia</em></a>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="desktop-browsers"></a>6.2. Browsers</h2></div></div></div><a id="idp52838392" class="indexterm"></a><p>FreeBSD does not come with a pre-installed web browser.
      Instead, the <a class="link" href="https://www.FreeBSD.org/ports/www.html" target="_top">www</a>
      category of the Ports Collection contains many browsers which
      can be installed as a package or compiled from the Ports
      Collection.</p><p>The <span class="application">KDE</span> and
      <span class="application">GNOME</span> desktop environments include
      their own HTML browser.  Refer to <a class="xref" href="#x11-wm" title="5.7. Desktop Environments">Section 5.7, &#8220;Desktop Environments&#8221;</a>
      for more information on how to set up these complete
      desktops.</p><p>Some lightweight browsers include
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/dillo2/pkg-descr">www/dillo2</a>, <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/links/pkg-descr">www/links</a>, and
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/w3m/pkg-descr">www/w3m</a>.</p><p>This section demonstrates how to install the following
      popular web browsers and indicates if the application is
      resource-heavy, takes time to compile from ports, or has any
      major dependencies.</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Application Name</th><th>Resources Needed</th><th>Installation from Ports</th><th>Notes</th></tr></thead><tbody><tr><td><span class="application">Firefox</span></td><td>medium</td><td>heavy</td><td>FreeBSD, <span class="trademark">Linux</span>®, and localized versions are
	      available</td></tr><tr><td><span class="application">Konqueror</span></td><td>medium</td><td>heavy</td><td>Requires <span class="application">KDE</span>
	      libraries</td></tr><tr><td><span class="application">Chromium</span></td><td>medium</td><td>heavy</td><td>Requires <span class="application">Gtk+</span></td></tr></tbody></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52871416"></a>6.2.1. Firefox</h3></div></div></div><a id="idp52872056" class="indexterm"></a><p><span class="application">Firefox</span> is an open source
	browser that features a
	standards-compliant HTML display engine, tabbed browsing,
	popup blocking, extensions, improved security, and more.
	<span class="application">Firefox</span> is based on the
	<span class="application">Mozilla</span> codebase.</p><p>To install the package of the latest release version of
	<span class="application">Firefox</span>, type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install firefox</code></strong></pre><p>To instead install <span class="application">Firefox</span>
	Extended Support Release (ESR) version, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install firefox-esr</code></strong></pre><p>The Ports Collection can instead be used to compile the
	desired version of <span class="application">Firefox</span> from
	source code.  This example builds
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/firefox/pkg-descr">www/firefox</a>, where
	<code class="literal">firefox</code> can be replaced with the ESR or
	localized version to install.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/www/firefox</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52885112"></a>6.2.2. Konqueror</h3></div></div></div><a id="idp52885752" class="indexterm"></a><p><span class="application">Konqueror</span> is more than a web
	browser as it is also a file manager and a multimedia
	viewer.  Supports WebKit as well as its own KHTML.  WebKit is
	a rendering engine used by many modern browsers including
	Chromium.</p><p><span class="application">Konqueror</span> can be installed as
	a package by typing:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install konqueror</code></strong></pre><p>To install from the Ports Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/x11-fm/konqueror/</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52891000"></a>6.2.3. Chromium</h3></div></div></div><a id="idp52891640" class="indexterm"></a><p><span class="application">Chromium</span> is an open source
	browser project that aims to build a safer, faster, and more
	stable web browsing experience.
	<span class="application">Chromium</span> features tabbed browsing,
	popup blocking, extensions, and much more.
	<span class="application">Chromium</span> is the open source project
	upon which the Google Chrome web browser is based.</p><p><span class="application">Chromium</span> can be installed as a
	package by typing:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install chromium</code></strong></pre><p>Alternatively, <span class="application">Chromium</span> can be
	compiled from source using the Ports Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/www/chromium</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The executable for <span class="application">Chromium</span>
	  is <code class="filename">/usr/local/bin/chrome</code>, not
	  <code class="filename">/usr/local/bin/chromium</code>.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="desktop-productivity"></a>6.3. Productivity</h2></div></div></div><p>When it comes to productivity, users often look for an
      office suite or an easy-to-use word processor.  While some
      <a class="link" href="#x11-wm" title="5.7. Desktop Environments">desktop environments</a> like
      <span class="application">KDE</span> provide an office suite, there
      is no default productivity package.  Several office suites and
      graphical word processors are available for FreeBSD, regardless
      of the installed window manager.</p><p>This section demonstrates how to install the following
      popular productivity software and indicates if the application
      is resource-heavy, takes time to compile from ports, or has any
      major dependencies.</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Application Name</th><th>Resources Needed</th><th>Installation from Ports</th><th>Major Dependencies</th></tr></thead><tbody><tr><td><span class="application">Calligra</span></td><td>light</td><td>heavy</td><td><span class="application">KDE</span></td></tr><tr><td><span class="application">AbiWord</span></td><td>light</td><td>light</td><td><span class="application">Gtk+</span> or
	      <span class="application">GNOME</span></td></tr><tr><td><span class="application">The Gimp</span></td><td>light</td><td>heavy</td><td><span class="application">Gtk+</span></td></tr><tr><td><span class="application">Apache
		OpenOffice</span></td><td>heavy</td><td>huge</td><td><span class="application"><span class="trademark">JDK</span>&#8482;</span> and
	      <span class="application">Mozilla</span></td></tr><tr><td><span class="application">LibreOffice</span></td><td>somewhat heavy</td><td>huge</td><td><span class="application">Gtk+</span>, or
	      <span class="application">KDE</span>/
	      <span class="application">GNOME</span>, or
	      <span class="application"><span class="trademark">JDK</span>&#8482;</span></td></tr></tbody></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52940152"></a>6.3.1. Calligra</h3></div></div></div><a id="idp52940792" class="indexterm"></a><a id="idp52941688" class="indexterm"></a><p>The KDE desktop environment includes
	an office suite which can be installed separately from
	<span class="application">KDE</span>.
	<span class="application">Calligra</span> includes standard
	components that can be found in other office suites.
	<span class="application">Words</span> is the word processor,
	<span class="application">Sheets</span> is the spreadsheet program,
	<span class="application">Stage</span> manages slide presentations,
	and <span class="application">Karbon</span> is used to draw
	graphical documents.</p><p>In FreeBSD, <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/editors/calligra/pkg-descr">editors/calligra</a> can be
	installed as a package or a port.  To install the
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install calligra</code></strong></pre><p>If the package is not available, use the Ports Collection
	instead:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/editors/calligra</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52953592"></a>6.3.2. AbiWord</h3></div></div></div><a id="idp52954232" class="indexterm"></a><p><span class="application">AbiWord</span> is a free word
	processing program similar in look and feel to
	<span class="application"><span class="trademark">Microsoft</span>® Word</span>.  It is fast,
	contains many features, and is user-friendly.</p><p><span class="application">AbiWord</span> can import or export
	many file formats, including some proprietary ones like
	<span class="trademark">Microsoft</span>® <code class="filename">.rtf</code>.</p><p>To install the <span class="application">AbiWord</span>
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install abiword</code></strong></pre><p>If the package is not available, it can be compiled from
	the Ports Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/editors/abiword</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52961912"></a>6.3.3. The GIMP</h3></div></div></div><a id="idp52962552" class="indexterm"></a><p>For image authoring or picture retouching,
	<span class="application">The GIMP</span> provides a sophisticated
	image manipulation program.  It can be used as a simple paint
	program or as a quality photo retouching suite.  It supports a
	large number of plugins and features a scripting interface.
	<span class="application">The GIMP</span> can read and write a wide
	range of file formats and supports interfaces with scanners
	and tablets.</p><p>To install the package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install gimp</code></strong></pre><p>Alternately, use the Ports Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/gimp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>The graphics category (<a class="link" href="https://www.FreeBSD.org/ports/graphics.html" target="_top">freebsd.org/ports/graphics.html</a>)
	of the Ports Collection contains several
	<span class="application">GIMP</span>-related plugins, help files,
	and user manuals.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52973432"></a>6.3.4. Apache OpenOffice</h3></div></div></div><a id="idp52974072" class="indexterm"></a><a id="idp52975224" class="indexterm"></a><p><span class="application">Apache OpenOffice</span> is an open
	source office suite which is developed under the wing of the
	Apache Software Foundation's Incubator.  It includes all of
	the applications found in a complete office productivity
	suite: a word processor, spreadsheet, presentation manager,
	and drawing program.  Its user interface is similar to other
	office suites, and it can import and export in various popular
	file formats.  It is available in a number of different
	languages and internationalization has been extended to
	interfaces, spell checkers, and dictionaries.</p><p>The word processor of <span class="application">Apache
	  OpenOffice</span> uses a native XML file format for
	increased portability and flexibility.  The spreadsheet
	program features a macro language which can be interfaced
	with external databases.  <span class="application">Apache
	  OpenOffice</span> is stable and runs natively on
	<span class="trademark">Windows</span>®, <span class="trademark">Solaris</span>&#8482;, <span class="trademark">Linux</span>®, FreeBSD, and <span class="trademark">Mac OS</span>® X.
	More information about <span class="application">Apache
	  OpenOffice</span> can be found at <a class="link" href="http://openoffice.org/" target="_top">openoffice.org</a>.
	For FreeBSD specific information refer to <a class="link" href="http://porting.openoffice.org/freebsd/" target="_top">porting.openoffice.org/freebsd/</a>.</p><p>To install the <span class="application">Apache
	  OpenOffice</span> package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install apache-openoffice</code></strong></pre><p>Once the package is installed, type the following command
	to launch <span class="application">Apache OpenOffice</span>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>openoffice-<em class="replaceable"><code>X.Y.Z</code></em></code></strong></pre><p>where <em class="replaceable"><code>X.Y.Z</code></em> is the version
	number of the installed version of <span class="application">Apache
	  OpenOffice</span>.  The first time
	<span class="application">Apache OpenOffice</span> launches, some
	questions will be asked and a
	<code class="filename">.openoffice.org</code> folder will be created in
	the user's home directory.</p><p>If the desired <span class="application">Apache
	  OpenOffice</span> package is not available, compiling
	the port is still an option.  However, this requires a lot of
	disk space and a fairly long time to compile:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/editors/openoffice-4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">To build a localized version, replace the previous
	  command with:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make LOCALIZED_LANG=<em class="replaceable"><code>your_language</code></em> install clean</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Replace
	  <em class="replaceable"><code>your_language</code></em> with the correct
	  language ISO-code.  A list of supported language codes is
	  available in
	  <code class="filename">files/Makefile.localized</code>, located in
	  the port's directory.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp52980856"></a>6.3.5. LibreOffice</h3></div></div></div><a id="idp52981496" class="indexterm"></a><a id="idp52982392" class="indexterm"></a><p><span class="application">LibreOffice</span> is a free software
	office suite developed by <a class="link" href="http://www.documentfoundation.org/" target="_top">documentfoundation.org</a>.
	It is compatible with other major office suites and available
	on a variety of platforms.  It is a rebranded fork of
	<span class="application">Apache OpenOffice</span> and includes
	applications found in a complete office productivity suite:
	a word processor, spreadsheet, presentation manager, drawing
	program, database management program, and a tool for creating
	and editing mathematical formulæ.  It is available in
	a number of different languages and internationalization has
	been extended to interfaces, spell checkers, and
	dictionaries.</p><p>The word processor of
	<span class="application">LibreOffice</span> uses a native XML file
	format for increased portability and flexibility.  The
	spreadsheet program features a macro language which can be
	interfaced with external databases.
	<span class="application">LibreOffice</span> is stable and runs
	natively on <span class="trademark">Windows</span>®, <span class="trademark">Linux</span>®, FreeBSD, and <span class="trademark">Mac OS</span>® X.
	More information about <span class="application">LibreOffice</span>
	can be found at <a class="link" href="http://www.libreoffice.org/" target="_top">libreoffice.org</a>.</p><p>To install the English version of the
	<span class="application">LibreOffice</span> package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install libreoffice</code></strong></pre><p>The editors category (<a class="link" href="https://www.FreeBSD.org/ports/editors.html" target="_top">freebsd.org/ports/editors.html</a>)
	of the Ports Collection contains several localizations for
	<span class="application">LibreOffice</span>.  When installing a
	localized package, replace <code class="literal">libreoffice</code>
	with the name of the localized package.</p><p>Once the package is installed, type the following command
	to run <span class="application">LibreOffice</span>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>libreoffice</code></strong></pre><p>During the first launch, some questions will be asked
	and a <code class="filename">.libreoffice</code> folder will be created
	in the user's home directory.</p><p>If the desired <span class="application">LibreOffice</span>
	package is not available, compiling the port is still an
	option.  However, this requires a lot of disk space and a
	fairly long time to compile.  This example compiles the
	English version:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/editors/libreoffice</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">To build a localized version,
	  <code class="command">cd</code> into the port directory of
	  the desired language.  Supported languages can be found
	  in the editors category (<a class="link" href="https://www.FreeBSD.org/ports/editors.html" target="_top">freebsd.org/ports/editors.html</a>)
	  of the Ports Collection.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="desktop-viewers"></a>6.4. Document Viewers</h2></div></div></div><p>Some new document formats have gained popularity since
      the advent of <span class="trademark">UNIX</span>® and the viewers they require may not be
      available in the base system.  This section demonstrates how to
      install the following document viewers:</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Application Name</th><th>Resources Needed</th><th>Installation from Ports</th><th>Major Dependencies</th></tr></thead><tbody><tr><td><span class="application">Xpdf</span></td><td>light</td><td>light</td><td><span class="application">FreeType</span></td></tr><tr><td><span class="application">gv</span></td><td>light</td><td>light</td><td><span class="application">Xaw3d</span></td></tr><tr><td><span class="application">Geeqie</span></td><td>light</td><td>light</td><td><span class="application">Gtk+</span> or
	      <span class="application">GNOME</span></td></tr><tr><td><span class="application">ePDFView</span></td><td>light</td><td>light</td><td><span class="application">Gtk+</span></td></tr><tr><td><span class="application">Okular</span></td><td>light</td><td>heavy</td><td><span class="application">KDE</span></td></tr></tbody></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53040504"></a>6.4.1. Xpdf</h3></div></div></div><a id="idp53041144" class="indexterm"></a><a id="idp53046136" class="indexterm"></a><p>For users that prefer a small FreeBSD PDF viewer,
	<span class="application">Xpdf</span> provides a light-weight and
	efficient viewer which requires few resources.  It uses the
	standard X fonts and does not require any additional
	toolkits.</p><p>To install the <span class="application">Xpdf</span>
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install xpdf</code></strong></pre><p>If the package is not available, use the Ports
	Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/xpdf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>Once the installation is complete, launch
	<code class="command">xpdf</code> and use the right mouse button to
	activate the menu.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53052664"></a>6.4.2. <span class="application">gv</span></h3></div></div></div><a id="idp53053432" class="indexterm"></a><a id="idp53054328" class="indexterm"></a><a id="idp53055480" class="indexterm"></a><p><span class="application">gv</span> is a <span class="trademark">PostScript</span>® and PDF
	viewer.  It is based on <span class="application">ghostview</span>,
	but has a nicer look as it is based on the
	<span class="application">Xaw3d</span> widget toolkit.
	<span class="application">gv</span> has many configurable features,
	such as orientation, paper size, scale, and anti-aliasing.
	Almost any operation can be performed with either the
	keyboard or the mouse.</p><p>To install <span class="application">gv</span> as a
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install gv</code></strong></pre><p>If a package is unavailable, use the Ports
	Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/print/gv</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53066872"></a>6.4.3. Geeqie</h3></div></div></div><a id="idp53067512" class="indexterm"></a><p><span class="application">Geeqie</span> is a fork from the
	unmaintained <span class="application">GQView</span> project, in an
	effort to move development forward and integrate the existing
	patches.  <span class="application">Geeqie</span> is an image
	manager which supports viewing a file with a single click,
	launching an external editor, and thumbnail previews.  It also
	features a slideshow mode and some basic file operations,
	making it easy to manage image collections and to find
	duplicate files.  <span class="application">Geeqie</span> supports
	full screen viewing and internationalization.</p><p>To install the <span class="application">Geeqie</span>
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install geeqie</code></strong></pre><p>If the package is not available, use the Ports
	Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/geeqie</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53074040"></a>6.4.4. ePDFView</h3></div></div></div><a id="idp53074680" class="indexterm"></a><a id="idp53079672" class="indexterm"></a><p><span class="application">ePDFView</span> is a lightweight
	<acronym class="acronym">PDF</acronym> document viewer that only uses the
	<span class="application">Gtk+</span> and
	<span class="application">Poppler</span> libraries.  It is currently
	under development, but already opens most
	<acronym class="acronym">PDF</acronym> files (even encrypted), save copies of
	documents, and has support for printing using
	<span class="application">CUPS</span>.</p><p>To install <span class="application">ePDFView</span> as a
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install epdfview</code></strong></pre><p>If a package is unavailable, use the Ports
	Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/epdfview</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53087224"></a>6.4.5. Okular</h3></div></div></div><a id="idp53087864" class="indexterm"></a><a id="idp53088760" class="indexterm"></a><p><span class="application">Okular</span> is a universal document
	viewer based on <span class="application">KPDF</span> for
	<span class="application">KDE</span>.  It can open many document
	formats, including <acronym class="acronym">PDF</acronym>, <span class="trademark">PostScript</span>®, DjVu,
	<acronym class="acronym">CHM</acronym>, <acronym class="acronym">XPS</acronym>, and
	ePub.</p><p>To install <span class="application">Okular</span> as a
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install okular</code></strong></pre><p>If a package is unavailable, use the Ports
	Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/okular</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="desktop-finance"></a>6.5. Finance</h2></div></div></div><p>For managing personal finances on a FreeBSD desktop, some
      powerful and easy-to-use applications can be installed.  Some
      are compatible with widespread file formats, such as the formats
      used by <span class="application">Quicken</span> and
      <span class="application">Excel</span>.</p><p>This section covers these programs:</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Application Name</th><th>Resources Needed</th><th>Installation from Ports</th><th>Major Dependencies</th></tr></thead><tbody><tr><td><span class="application">GnuCash</span></td><td>light</td><td>heavy</td><td><span class="application">GNOME</span></td></tr><tr><td><span class="application">Gnumeric</span></td><td>light</td><td>heavy</td><td><span class="application">GNOME</span></td></tr><tr><td><span class="application">KMyMoney</span></td><td>light</td><td>heavy</td><td><span class="application">KDE</span></td></tr></tbody></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53126136"></a>6.5.1. GnuCash</h3></div></div></div><a id="idp53126776" class="indexterm"></a><p><span class="application">GnuCash</span> is part of the
	<span class="application">GNOME</span> effort to provide
	user-friendly, yet powerful, applications to end-users.
	<span class="application">GnuCash</span> can be used to keep track
	of income and expenses, bank accounts, and stocks.  It
	features an intuitive interface while remaining
	professional.</p><p><span class="application">GnuCash</span> provides a smart
	register, a hierarchical system of accounts, and many keyboard
	accelerators and auto-completion methods.  It can split a
	single transaction into several more detailed pieces.
	<span class="application">GnuCash</span> can import and merge
	<span class="application">Quicken</span> QIF files.  It also handles
	most international date and currency formats.</p><p>To install the <span class="application">GnuCash</span>
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install gnucash</code></strong></pre><p>If the package is not available, use the Ports
	Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/finance/gnucash</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53154808"></a>6.5.2. Gnumeric</h3></div></div></div><a id="idp53155448" class="indexterm"></a><a id="idp53156344" class="indexterm"></a><p><span class="application">Gnumeric</span> is a spreadsheet
	program developed by the <span class="application">GNOME</span>
	community.  It features convenient automatic guessing of user
	input according to the cell format with an autofill system
	for many sequences.  It can import files in a number of
	popular formats, including <span class="application">Excel</span>,
	<span class="application">Lotus 1-2-3</span>, and
	<span class="application">Quattro Pro</span>.  It has a large number
	of built-in functions and allows all of the usual cell formats
	such as number, currency, date, time, and much more.</p><p>To install <span class="application">Gnumeric</span> as a
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install gnumeric</code></strong></pre><p>If the package is not available, use the Ports
	Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/math/gnumeric</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53180024"></a>6.5.3. KMyMoney</h3></div></div></div><a id="idp53180664" class="indexterm"></a><a id="idp53185400" class="indexterm"></a><p><span class="application">KMyMoney</span> is a personal finance
	application created by the <span class="application">KDE</span>
	community.  <span class="application">KMyMoney</span> aims to
	provide the important features found in commercial personal
	finance manager applications.  It also highlights ease-of-use
	and proper double-entry accounting among its features.
	<span class="application">KMyMoney</span> imports from standard
	<span class="application">Quicken</span> QIF files, tracks
	investments, handles multiple currencies, and provides a
	wealth of reports.</p><p>To install <span class="application">KMyMoney</span> as a
	package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install kmymoney-kde4</code></strong></pre><p>If the package is not available, use the Ports
	Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/finance/kmymoney-kde4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="multimedia"></a>Chapter 7. Multimedia</h2></div><div><span class="authorgroup">Edited by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Ross</span> <span class="surname">Lippert</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#multimedia-synopsis">7.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#sound-setup">7.2. Setting Up the Sound Card</a></span></dt><dt><span class="sect1"><a href="#sound-mp3">7.3. MP3 Audio</a></span></dt><dt><span class="sect1"><a href="#video-playback">7.4. Video Playback</a></span></dt><dt><span class="sect1"><a href="#tvcard">7.5. TV Cards</a></span></dt><dt><span class="sect1"><a href="#mythtv">7.6. MythTV</a></span></dt><dt><span class="sect1"><a href="#scanners">7.7. Image Scanners</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="multimedia-synopsis"></a>7.1. Synopsis</h2></div></div></div><p>FreeBSD supports a wide variety of sound cards, allowing users
      to enjoy high fidelity output from a FreeBSD system.  This includes
      the ability to record and play back audio in the MPEG Audio Layer
      3 (<acronym class="acronym">MP3</acronym>), Waveform Audio File
      (<acronym class="acronym">WAV</acronym>), Ogg Vorbis, and other formats.  The
      FreeBSD Ports Collection contains many applications for editing
      recorded audio, adding sound effects, and controlling attached
      MIDI devices.</p><p>FreeBSD also supports the playback of video files and
      <acronym class="acronym">DVD</acronym>s.  The FreeBSD Ports Collection contains
      applications to encode, convert, and playback various video
      media.</p><p>This chapter describes how to configure sound cards, video
      playback, TV tuner cards, and scanners on FreeBSD.  It also
      describes some of the applications which are available for
      using these devices.</p><p>After reading this chapter, you will know how to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Configure a sound card on FreeBSD.</p></li><li class="listitem"><p>Troubleshoot the sound setup.</p></li><li class="listitem"><p>Playback and encode MP3s and other audio.</p></li><li class="listitem"><p>Prepare a FreeBSD system for video playback.</p></li><li class="listitem"><p>Play <acronym class="acronym">DVD</acronym>s, <code class="filename">.mpg</code>,
	  and <code class="filename">.avi</code> files.</p></li><li class="listitem"><p>Rip <acronym class="acronym">CD</acronym> and <acronym class="acronym">DVD</acronym>
	  content into files.</p></li><li class="listitem"><p>Configure a TV card.</p></li><li class="listitem"><p>Install and setup MythTV on FreeBSD</p></li><li class="listitem"><p>Configure an image scanner.</p></li><li class="listitem"><p>Configure a Bluetooth headset.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Know how to install applications as described in
	<a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a>.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sound-setup"></a>7.2. Setting Up the Sound Card</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Moses</span> <span class="surname">Moore</span></span>. </span></div><div><span class="authorgroup">Enhanced by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp53226616" class="indexterm"></a><a id="idp53227128" class="indexterm"></a><p>Before beginning the configuration, determine the model of
      the sound card and the chip it uses.  FreeBSD supports a wide
      variety of sound cards.  Check the supported audio devices
      list of the <a class="link" href="https://www.FreeBSD.org/releases/12.0R/hardware.html" target="_top">Hardware
	Notes</a> to see if the card is supported and which FreeBSD
      driver it uses.</p><a id="idp53228536" class="indexterm"></a><p>In order to use the sound device, its device driver must be
      loaded.  The easiest way is to load a kernel module for the
      sound card with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.  This example loads the driver
      for a built-in audio chipset based on the Intel
      specification:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_hda</code></strong></pre><p>To automate the loading of this driver at boot time, add the
      driver to <code class="filename">/boot/loader.conf</code>.  The line for
      this driver is:</p><pre class="programlisting">snd_hda_load="YES"</pre><p>Other available sound modules are listed in
      <code class="filename">/boot/defaults/loader.conf</code>.  When unsure
      which driver to use, load the <code class="filename">snd_driver</code>
      module:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_driver</code></strong></pre><p>This is a metadriver which loads all of the most common
      sound drivers and can be used to speed up the search for the
      correct driver.  It is also possible to load all sound drivers
      by adding the metadriver to
      <code class="filename">/boot/loader.conf</code>.</p><p>To determine which driver was selected for the sound card
      after loading the <code class="filename">snd_driver</code> metadriver,
      type <code class="command">cat /dev/sndstat</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53236856"></a>7.2.1. Configuring a Custom Kernel with Sound Support</h3></div></div></div><p>This section is for users who prefer to statically compile
	in support for the sound card in a custom kernel.  For more
	information about recompiling a kernel, refer to <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>.</p><p>When using a custom kernel to provide sound support, make
	sure that the audio framework driver exists in the custom
	kernel configuration file:</p><pre class="programlisting">device sound</pre><p>Next, add support for the sound card.  To continue the
	example of the built-in audio chipset based on the Intel
	specification from the previous section, use the following
	line in the custom kernel configuration file:</p><pre class="programlisting">device snd_hda</pre><p>Be sure to read the manual page of the driver for the
	device name to use for the driver.</p><p>Non-PnP ISA sound cards may require the IRQ and I/O port
	settings of the card to be added to
	<code class="filename">/boot/device.hints</code>.  During the boot
	process, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> reads this file and passes the
	settings to the kernel.  For example, an old Creative
	<span class="trademark">SoundBlaster</span>® 16 ISA non-PnP card will use the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> driver in conjunction with
	<code class="literal">snd_sb16</code>.  For this card, the following
	lines must be added to the kernel configuration file:</p><pre class="programlisting">device snd_sbc
device snd_sb16</pre><p>If the card uses the <code class="literal">0x220</code> I/O port and
	IRQ <code class="literal">5</code>, these lines must also be added to
	<code class="filename">/boot/device.hints</code>:</p><pre class="programlisting">hint.sbc.0.at="isa"
hint.sbc.0.port="0x220"
hint.sbc.0.irq="5"
hint.sbc.0.drq="1"
hint.sbc.0.flags="0x15"</pre><p>The syntax used in <code class="filename">/boot/device.hints</code>
	is described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sound&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sound</span>(4)</span></a> and the manual page for the
	driver of the sound card.</p><p>The settings shown above are the defaults.  In some
	cases, the IRQ or other settings may need to be changed to
	match the card.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> for more information
	about this card.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-testing"></a>7.2.2. Testing Sound</h3></div></div></div><p>After loading the required module or rebooting into the
	custom kernel, the sound card should be detected.  To confirm,
	run <code class="command">dmesg | grep pcm</code>.  This example is
	from a system with a built-in Conexant CX20590 chipset:</p><pre class="screen">pcm0: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; at nid 5 on hdaa0
pcm1: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; at nid 6 on hdaa0
pcm2: &lt;Conexant CX20590 (Analog 2.0+HP/2.0)&gt; at nid 31,25 and 35,27 on hdaa1</pre><p>The status of the sound card may also be checked using
	this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat /dev/sndstat</code></strong>
FreeBSD Audio Driver (newpcm: 64bit 2009061500/amd64)
Installed devices:
pcm0: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; (play)
pcm1: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; (play)
pcm2: &lt;Conexant CX20590 (Analog 2.0+HP/2.0)&gt; (play/rec) default</pre><p>The output will vary depending upon the sound card.  If no
	<code class="filename">pcm</code> devices are listed, double-check
	that the correct device driver was loaded or compiled into the
	kernel.  The next section lists some common problems and their
	solutions.</p><p>If all goes well, the sound card should now work in FreeBSD.
	If the <acronym class="acronym">CD</acronym> or <acronym class="acronym">DVD</acronym> drive
	is properly connected to the sound card, one can insert an
	audio <acronym class="acronym">CD</acronym> in the drive and play it with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cdcontrol&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cdcontrol</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cdcontrol -f /dev/acd0 play 1</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Audio <acronym class="acronym">CD</acronym>s have specialized encodings
	  which means that they should not be mounted using
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.</p></div><p>Various applications, such as
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/workman/pkg-descr">audio/workman</a>, provide a friendlier
	interface.  The <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/mpg123/pkg-descr">audio/mpg123</a> port can be
	installed to listen to MP3 audio files.</p><p>Another quick way to test the card is to send data to
	<code class="filename">/dev/dsp</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cat <em class="replaceable"><code>filename</code></em> &gt; /dev/dsp</code></strong></pre><p>where
	<code class="filename"><em class="replaceable"><code>filename</code></em></code> can
	be any type of file.  This command should produce some noise,
	confirming that the sound card is working.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <code class="filename">/dev/dsp*</code> device nodes will
	  be created automatically as needed.  When not in use, they
	  do not exist and will not appear in the output of
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bluetooth-headset"></a>7.2.3. Setting up Bluetooth Sound Devices</h3></div></div></div><a id="idp53285240" class="indexterm"></a><p>Connecting to a Bluetooth device is out of scope for this
	chapter.  Refer to <a class="xref" href="#network-bluetooth" title="31.5. Bluetooth">Section 31.5, &#8220;Bluetooth&#8221;</a> for more information.</p><p>To get Bluetooth sound sink working with FreeBSD's sound
	system, users have to install
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/virtual_oss/pkg-descr">audio/virtual_oss</a> first:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install virtual_oss</code></strong></pre><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/virtual_oss/pkg-descr">audio/virtual_oss</a> requires
	<code class="literal">cuse</code> to be loaded into the kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload cuse</code></strong></pre><p>To load <code class="literal">cuse</code> during system startup, run
	this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf cuse_load=yes</code></strong></pre><p>To use headphones as a sound sink with
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/virtual_oss/pkg-descr">audio/virtual_oss</a>, users need to create a
	virtual device after connecting to a Bluetooth audio
	device:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>virtual_oss -C 2 -c 2 -r 48000 -b 16 -s 768 -R /dev/null -P /dev/bluetooth/<em class="replaceable"><code>headphones</code></em> -d dsp</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><em class="replaceable"><code>headphones</code></em> in this example is
	  a hostname from <code class="filename">/etc/bluetooth/hosts</code>.
	  <code class="literal">BT_ADDR</code> could be used instead.</p></div><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=virtual_oss&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">virtual_oss</span>(8)</span></a> for more information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="troubleshooting"></a>7.2.4. Troubleshooting Sound</h3></div></div></div><a id="idp53318520" class="indexterm"></a><a id="idp53319032" class="indexterm"></a><a id="idp53319544" class="indexterm"></a><a id="idp53320056" class="indexterm"></a><p><a class="xref" href="#multimedia-sound-common-error-messages" title="Table 7.1. Common Error Messages">Table 7.1, &#8220;Common Error Messages&#8221;</a>
	lists some common error messages and their solutions:</p><div class="table"><a id="multimedia-sound-common-error-messages"></a><div class="table-title">Table 7.1. Common Error Messages</div><div class="table-contents"><table class="table" summary="Common Error Messages" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Error</th><th>Solution</th></tr></thead><tbody><tr><td><span class="errorname">sb_dspwr(XX) timed
		  out</span></td><td><p>The I/O port is not set
		correctly.</p></td></tr><tr><td><span class="errorname">bad irq XX</span></td><td><p>The IRQ is set incorrectly.  Make sure
		that the set IRQ and the sound IRQ are the
		same.</p></td></tr><tr><td><span class="errorname">xxx: gus pcm not attached, out of
		  memory</span></td><td><p>There is not enough available memory to
		use the device.</p></td></tr><tr><td><span class="errorname">xxx: can't open
		  /dev/dsp!</span></td><td><p>Type <code class="command">fstat | grep
		  dsp</code> to check if another application is
		holding the device open.  Noteworthy troublemakers are
		<span class="application">esound</span> and
		<span class="application">KDE</span>'s sound
		support.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Modern graphics cards often come with their own sound
	driver for use with <acronym class="acronym">HDMI</acronym>.  This sound
	device is sometimes enumerated before the sound card meaning
	that the sound card will not be used as the default playback
	device.  To check if this is the case, run
	<span class="application">dmesg</span> and look for
	<code class="literal">pcm</code>.  The output looks something like
	this:</p><pre class="programlisting">...
hdac0: HDA Driver Revision: 20100226_0142
hdac1: HDA Driver Revision: 20100226_0142
hdac0: HDA Codec #0: NVidia (Unknown)
hdac0: HDA Codec #1: NVidia (Unknown)
hdac0: HDA Codec #2: NVidia (Unknown)
hdac0: HDA Codec #3: NVidia (Unknown)
pcm0: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 0 nid 1 on hdac0
pcm1: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 1 nid 1 on hdac0
pcm2: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 2 nid 1 on hdac0
pcm3: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 3 nid 1 on hdac0
hdac1: HDA Codec #2: Realtek ALC889
pcm4: &lt;HDA Realtek ALC889 PCM #0 Analog&gt; at cad 2 nid 1 on hdac1
pcm5: &lt;HDA Realtek ALC889 PCM #1 Analog&gt; at cad 2 nid 1 on hdac1
pcm6: &lt;HDA Realtek ALC889 PCM #2 Digital&gt; at cad 2 nid 1 on hdac1
pcm7: &lt;HDA Realtek ALC889 PCM #3 Digital&gt; at cad 2 nid 1 on hdac1
...</pre><p>In this example, the graphics card
	(<code class="literal">NVidia</code>) has been enumerated before the
	sound card (<code class="literal">Realtek ALC889</code>).  To use the
	sound card as the default playback device, change
	<code class="varname">hw.snd.default_unit</code> to the unit that should
	be used for playback:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.default_unit=<em class="replaceable"><code>n</code></em></code></strong></pre><p>where <code class="literal">n</code> is the number of the sound
	device to use.  In this example, it should be
	<code class="literal">4</code>.  Make this change permanent by adding
	the following line to
	<code class="filename">/etc/sysctl.conf</code>:</p><pre class="programlisting">hw.snd.default_unit=<em class="replaceable"><code>4</code></em></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-multiple-sources"></a>7.2.5. Utilizing Multiple Sound Sources</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Munish</span> <span class="surname">Chopra</span></span>. </span></div></div></div><p>It is often desirable to have multiple sources of sound
	that are able to play simultaneously.  FreeBSD uses
	<span class="quote">&#8220;<span class="quote">Virtual Sound Channels</span>&#8221;</span> to multiplex the sound
	card's playback by mixing sound in the kernel.</p><p>Three <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> knobs are available for configuring
	virtual channels:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl dev.pcm.0.play.vchans=4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl dev.pcm.0.rec.vchans=4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.maxautovchans=4</code></strong></pre><p>This example allocates four virtual channels, which is a
	practical number for everyday use.  Both
	<code class="varname">dev.pcm.0.play.vchans=4</code> and
	<code class="varname">dev.pcm.0.rec.vchans=4</code> are configurable
	after a device has been attached and represent the number of
	virtual channels <code class="filename">pcm0</code> has for playback
	and recording.  Since the <code class="filename">pcm</code> module can
	be loaded independently of the hardware drivers,
	<code class="varname">hw.snd.maxautovchans</code> indicates how many
	virtual channels will be given to an audio device when it is
	attached.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> for more information.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The number of virtual channels for a device cannot be
	  changed while it is in use.  First, close any programs using
	  the device, such as music players or sound daemons.</p></div><p>The correct <code class="filename">pcm</code> device will
	automatically be allocated transparently to a program that
	requests <code class="filename">/dev/dsp0</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53384184"></a>7.2.6. Setting Default Values for Mixer Channels</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Josef</span> <span class="surname">El-Rayes</span></span>. </span></div></div></div><p>The default values for the different mixer channels are
	hardcoded in the source code of the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> driver.  While
	sound card mixer levels can be changed using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a> or
	third-party applications and daemons, this is not a permanent
	solution.  To instead set default mixer values at the driver
	level, define the appropriate values in
	<code class="filename">/boot/device.hints</code>, as seen in this
	example:</p><pre class="programlisting">hint.pcm.0.vol="50"</pre><p>This will set the volume channel to a default value of
	<code class="literal">50</code> when the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> module is
	loaded.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sound-mp3"></a>7.3. MP3 Audio</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><p>This section describes some <acronym class="acronym">MP3</acronym>
      players available for FreeBSD, how to rip audio
      <acronym class="acronym">CD</acronym> tracks, and how to encode and decode
      <acronym class="acronym">MP3</acronym>s.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mp3-players"></a>7.3.1. MP3 Players</h3></div></div></div><p>A popular graphical <acronym class="acronym">MP3</acronym> player is
	<span class="application">Audacious</span>.  It supports
	<span class="application">Winamp</span> skins and additional
	plugins.  The interface is intuitive, with a playlist, graphic
	equalizer, and more.  Those familiar with
	<span class="application">Winamp</span> will find
	<span class="application">Audacious</span> simple to use.  On FreeBSD,
	<span class="application">Audacious</span> can be installed from the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/audacious/pkg-descr">multimedia/audacious</a> port or package.
	Audacious is a descendant of XMMS.</p><p>The <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/mpg123/pkg-descr">audio/mpg123</a> package or port
	provides an alternative, command-line <acronym class="acronym">MP3</acronym>
	player.  Once installed, specify the <acronym class="acronym">MP3</acronym>
	file to play on the command line.  If the system has multiple
	audio devices, the sound device can also be specified:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mpg123 <em class="replaceable"><code>-a /dev/dsp1.0 Foobar-GreatestHits.mp3</code></em></code></strong>
High Performance MPEG 1.0/2.0/2.5 Audio Player for Layers 1, 2 and 3
        version 1.18.1; written and copyright by Michael Hipp and others
        free software (LGPL) without any warranty but with best wishes

Playing MPEG stream from Foobar-GreatestHits.mp3 ...
MPEG 1.0 layer III, 128 kbit/s, 44100 Hz joint-stereo</pre><p>Additional <acronym class="acronym">MP3</acronym> players are available in
	the FreeBSD Ports Collection.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="rip-cd"></a>7.3.2. Ripping <acronym class="acronym">CD</acronym> Audio Tracks</h3></div></div></div><p>Before encoding a <acronym class="acronym">CD</acronym> or
	<acronym class="acronym">CD</acronym> track to <acronym class="acronym">MP3</acronym>, the
	audio data on the <acronym class="acronym">CD</acronym> must be ripped to the
	hard drive.  This is done by copying the raw
	<acronym class="acronym">CD</acronym> Digital Audio (<acronym class="acronym">CDDA</acronym>)
	data to <acronym class="acronym">WAV</acronym> files.</p><p>The <code class="command">cdda2wav</code> tool, which is installed
	with the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a> suite, can be
	used to rip audio information from
	<acronym class="acronym">CD</acronym>s.</p><p>With the audio <acronym class="acronym">CD</acronym> in the drive, the
	following command can be issued as
	<code class="systemitem">root</code> to rip an
	entire <acronym class="acronym">CD</acronym> into individual, per track,
	<acronym class="acronym">WAV</acronym> files:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cdda2wav -D <em class="replaceable"><code>0,1,0</code></em> -B</code></strong></pre><p>In this example, the
	<code class="option">-D <em class="replaceable"><code>0,1,0</code></em></code> indicates
	the <acronym class="acronym">SCSI</acronym> device <code class="filename">0,1,0</code>
	containing the <acronym class="acronym">CD</acronym> to rip.  Use
	<code class="command">cdrecord -scanbus</code> to determine the correct
	device parameters for the system.</p><p>To rip individual tracks, use <code class="option">-t</code> to
	specify the track:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cdda2wav -D <em class="replaceable"><code>0,1,0</code></em> -t 7</code></strong></pre><p>To rip a range of tracks, such as track one to seven,
	specify a range:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cdda2wav -D <em class="replaceable"><code>0,1,0</code></em> -t 1+7</code></strong></pre><p>To rip from an <acronym class="acronym">ATAPI</acronym>
	(<acronym class="acronym">IDE</acronym>) <acronym class="acronym">CDROM</acronym> drive,
	specify the device name in place of the
	<acronym class="acronym">SCSI</acronym> unit numbers.  For example, to rip
	track 7 from an IDE drive:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cdda2wav -D <em class="replaceable"><code>/dev/acd0 -t 7</code></em></code></strong></pre><p>Alternately, <code class="command">dd</code> can be used to extract
	audio tracks on <acronym class="acronym">ATAPI</acronym> drives, as described
	in <a class="xref" href="#duplicating-audiocds" title="17.5.5. Duplicating Audio CDs">Section 17.5.5, &#8220;Duplicating Audio <acronym class="acronym">CD</acronym>s&#8221;</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mp3-encoding"></a>7.3.3. Encoding and Decoding MP3s</h3></div></div></div><p><span class="application">Lame</span> is a popular
	<acronym class="acronym">MP3</acronym> encoder which can be installed from the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/lame/pkg-descr">audio/lame</a> port.  Due to patent issues, a
	package is not available.</p><p>The following command will convert the ripped
	<acronym class="acronym">WAV</acronym> file
	<code class="filename"><em class="replaceable"><code>audio01.wav</code></em></code> to
	<code class="filename"><em class="replaceable"><code>audio01.mp3</code></em></code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lame -h -b <em class="replaceable"><code>128</code></em> --tt "<em class="replaceable"><code>Foo Song Title</code></em>" --ta "<em class="replaceable"><code>FooBar Artist</code></em>" --tl "<em class="replaceable"><code>FooBar Album</code></em>" \
--ty "<em class="replaceable"><code>2014</code></em>" --tc "<em class="replaceable"><code>Ripped and encoded by Foo</code></em>" --tg "<em class="replaceable"><code>Genre</code></em>" <em class="replaceable"><code>audio01.wav audio01.mp3</code></em></code></strong></pre><p>The specified 128 kbits is a standard
	<acronym class="acronym">MP3</acronym> bitrate while the 160 and 192 bitrates
	provide higher quality.  The higher the bitrate, the larger
	the size of the resulting <acronym class="acronym">MP3</acronym>.  The
	<code class="option">-h</code> turns on the
	<span class="quote">&#8220;<span class="quote">higher quality but a little slower</span>&#8221;</span>
	mode.  The options beginning with <code class="option">--t</code>
	indicate <acronym class="acronym">ID3</acronym> tags, which usually contain
	song information, to be embedded within the
	<acronym class="acronym">MP3</acronym> file.  Additional encoding options can
	be found in the <span class="application">lame</span> manual
	page.</p><p>In order to burn an audio <acronym class="acronym">CD</acronym> from
	<acronym class="acronym">MP3</acronym>s, they must first be converted to a
	non-compressed file format.  <span class="application">XMMS</span>
	can be used to convert to the <acronym class="acronym">WAV</acronym> format,
	while <span class="application">mpg123</span> can be used to convert
	to the raw Pulse-Code Modulation (<acronym class="acronym">PCM</acronym>)
	audio data format.</p><p>To convert <code class="filename">audio01.mp3</code> using
	<span class="application">mpg123</span>, specify the name of the
	<acronym class="acronym">PCM</acronym> file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mpg123 -s <em class="replaceable"><code>audio01.mp3</code></em> &gt; <em class="replaceable"><code>audio01.pcm</code></em></code></strong></pre><p>To use <span class="application">XMMS</span> to convert a
	<acronym class="acronym">MP3</acronym> to <acronym class="acronym">WAV</acronym> format, use
	these steps:</p><div class="procedure"><a id="idp53488632"></a><div class="procedure-title">Procedure 7.1. Converting to <acronym class="acronym">WAV</acronym> Format in
	  <span class="application">XMMS</span></div><ol class="procedure" type="1"><li class="step"><p>Launch <span class="application">XMMS</span>.</p></li><li class="step"><p>Right-click the window to bring up the
	    <span class="application">XMMS</span> menu.</p></li><li class="step"><p>Select <code class="literal">Preferences</code> under
	    <code class="literal">Options</code>.</p></li><li class="step"><p>Change the Output Plugin to <span class="quote">&#8220;<span class="quote">Disk Writer
	      Plugin</span>&#8221;</span>.</p></li><li class="step"><p>Press <code class="literal">Configure</code>.</p></li><li class="step"><p>Enter or browse to a directory to write the
	    uncompressed files to.</p></li><li class="step"><p>Load the <acronym class="acronym">MP3</acronym> file into
	    <span class="application">XMMS</span> as usual, with volume at
	    100% and EQ settings turned off.</p></li><li class="step"><p>Press <code class="literal">Play</code>.  The
	    <span class="application">XMMS</span> will appear as if it is
	    playing the <acronym class="acronym">MP3</acronym>, but no music will be
	    heard.  It is actually playing the <acronym class="acronym">MP3</acronym>
	    to a file.</p></li><li class="step"><p>When finished, be sure to set the default Output
	    Plugin back to what it was before in order to listen to
	    <acronym class="acronym">MP3</acronym>s again.</p></li></ol></div><p>Both the <acronym class="acronym">WAV</acronym> and <acronym class="acronym">PCM</acronym>
	formats can be used with <span class="application">cdrecord</span>.
	When using <acronym class="acronym">WAV</acronym> files, there will be a small
	tick sound at the beginning of each track.  This sound is the
	header of the <acronym class="acronym">WAV</acronym> file.  The
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/sox/pkg-descr">audio/sox</a> port or package can be used to
	remove the header:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sox -t wav -r 44100 -s -w -c 2 <em class="replaceable"><code>track.wav track.raw</code></em></code></strong></pre><p>Refer to <a class="xref" href="#creating-cds" title="17.5. Creating and Using CD Media">Section 17.5, &#8220;Creating and Using <acronym class="acronym">CD</acronym> Media&#8221;</a> for more
	information on using a <acronym class="acronym">CD</acronym> burner in
	FreeBSD.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="video-playback"></a>7.4. Video Playback</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Ross</span> <span class="surname">Lippert</span></span>. </span></div></div></div><p>Before configuring video playback, determine the model and
      chipset of the video card.  While
      <span class="application">Xorg</span> supports a wide variety of
      video cards, not all provide good playback performance.  To
      obtain a list of extensions supported by the
      <span class="application">Xorg</span> server using the card, run
      <code class="command">xdpyinfo</code> while
      <span class="application">Xorg</span> is running.</p><p>It is a good idea to have a short MPEG test file for
      evaluating various players and options.  Since some
      <acronym class="acronym">DVD</acronym> applications look for
      <acronym class="acronym">DVD</acronym> media in <code class="filename">/dev/dvd</code> by
      default, or have this device name hardcoded in them, it might be
      useful to make a symbolic link to the proper device:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ln -sf /dev/cd0 /dev/dvd</code></strong></pre><p>Due to the nature of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>, manually created links
      will not persist after a system reboot.  In order to recreate
      the symbolic link automatically when the system boots, add the
      following line to <code class="filename">/etc/devfs.conf</code>:</p><pre class="programlisting">link cd0 dvd</pre><p><acronym class="acronym">DVD</acronym> decryption invokes certain functions
      that require write permission to the <acronym class="acronym">DVD</acronym>
      device.</p><p>To enhance the shared memory
      <span class="application">Xorg</span> interface, it is recommended
      to increase the values of these <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
      variables:</p><pre class="programlisting">kern.ipc.shmmax=67108864
kern.ipc.shmall=32768</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-interface"></a>7.4.1. Determining Video Capabilities</h3></div></div></div><a id="idp53529464" class="indexterm"></a><a id="idp53529976" class="indexterm"></a><a id="idp53530488" class="indexterm"></a><p>There are several possible ways to display video under
	<span class="application">Xorg</span> and what works is largely
	hardware dependent.  Each method described below will have
	varying quality across different hardware.</p><p>Common video interfaces include:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="application">Xorg</span>: normal output using
	    shared memory.</p></li><li class="listitem"><p>XVideo: an extension to the
	    <span class="application">Xorg</span> interface which
	    allows video to be directly displayed in drawable objects
	    through a special acceleration.  This extension provides
	    good quality playback even on low-end machines.  The next
	    section describes how to determine if this extension is
	    running.</p></li><li class="listitem"><p><acronym class="acronym">SDL</acronym>: the Simple Directmedia Layer
	    is a porting layer for many operating systems, allowing
	    cross-platform applications to be developed which make
	    efficient use of sound and graphics.
	    <acronym class="acronym">SDL</acronym> provides a low-level abstraction to
	    the hardware which can sometimes be more efficient than
	    the <span class="application">Xorg</span> interface.  On FreeBSD,
	    <acronym class="acronym">SDL</acronym> can be installed using the
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/devel/sdl20/pkg-descr">devel/sdl20</a> package or port.</p></li><li class="listitem"><p><acronym class="acronym">DGA</acronym>: the Direct Graphics Access is
	    an <span class="application">Xorg</span> extension which
	    allows a program to bypass the
	    <span class="application">Xorg</span> server and directly
	    alter the framebuffer.  Because it relies on a low level
	    memory mapping, programs using it must be run as
	    <code class="systemitem">root</code>.  The
	    <acronym class="acronym">DGA</acronym> extension can be tested and
	    benchmarked using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dga&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dga</span>(1)</span></a>.  When
	    <code class="command">dga</code> is running, it changes the colors
	    of the display whenever a key is pressed.  To quit, press
	    <span class="keycap"><strong>q</strong></span>.</p></li><li class="listitem"><p>SVGAlib: a low level console graphics layer.</p></li></ol></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-interface-xvideo"></a>7.4.1.1. XVideo</h4></div></div></div><p>To check whether this extension is running, use
	  <code class="command">xvinfo</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>xvinfo</code></strong></pre><p>XVideo is supported for the card if the result is
	  similar to:</p><pre class="screen">X-Video Extension version 2.2
  screen #0
  Adaptor #0: "Savage Streams Engine"
    number of ports: 1
    port base: 43
    operations supported: PutImage
    supported visuals:
      depth 16, visualID 0x22
      depth 16, visualID 0x23
    number of attributes: 5
      "XV_COLORKEY" (range 0 to 16777215)
              client settable attribute
              client gettable attribute (current value is 2110)
      "XV_BRIGHTNESS" (range -128 to 127)
              client settable attribute
              client gettable attribute (current value is 0)
      "XV_CONTRAST" (range 0 to 255)
              client settable attribute
              client gettable attribute (current value is 128)
      "XV_SATURATION" (range 0 to 255)
              client settable attribute
              client gettable attribute (current value is 128)
      "XV_HUE" (range -180 to 180)
              client settable attribute
              client gettable attribute (current value is 0)
    maximum XvImage size: 1024 x 1024
    Number of image formats: 7
      id: 0x32595559 (YUY2)
        guid: 59555932-0000-0010-8000-00aa00389b71
        bits per pixel: 16
        number of planes: 1
        type: YUV (packed)
      id: 0x32315659 (YV12)
        guid: 59563132-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        type: YUV (planar)
      id: 0x30323449 (I420)
        guid: 49343230-0000-0010-8000-00aa00389b71
        bits per pixel: 12
        number of planes: 3
        type: YUV (planar)
      id: 0x36315652 (RV16)
        guid: 52563135-0000-0000-0000-000000000000
        bits per pixel: 16
        number of planes: 1
        type: RGB (packed)
        depth: 0
        red, green, blue masks: 0x1f, 0x3e0, 0x7c00
      id: 0x35315652 (RV15)
        guid: 52563136-0000-0000-0000-000000000000
        bits per pixel: 16
        number of planes: 1
        type: RGB (packed)
        depth: 0
        red, green, blue masks: 0x1f, 0x7e0, 0xf800
      id: 0x31313259 (Y211)
        guid: 59323131-0000-0010-8000-00aa00389b71
        bits per pixel: 6
        number of planes: 3
        type: YUV (packed)
      id: 0x0
        guid: 00000000-0000-0000-0000-000000000000
        bits per pixel: 0
        number of planes: 0
        type: RGB (packed)
        depth: 1
        red, green, blue masks: 0x0, 0x0, 0x0</pre><p>The formats listed, such as YUV2 and YUV12, are not
	  present with every implementation of XVideo and their
	  absence may hinder some players.</p><p>If the result instead looks like:</p><pre class="screen">X-Video Extension version 2.2
screen #0
no adaptors present</pre><p>XVideo is probably not supported for the card.  This
	  means that it will be more difficult for the display to meet
	  the computational demands of rendering video, depending on
	  the video card and processor.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-ports"></a>7.4.2. Ports and Packages Dealing with Video</h3></div></div></div><a id="idp53564536" class="indexterm"></a><a id="idp53565048" class="indexterm"></a><p>This section introduces some of the software available
	from the FreeBSD Ports Collection which can be used for video
	playback.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-mplayer"></a>7.4.2.1. <span class="application">MPlayer</span> and
	  <span class="application">MEncoder</span></h4></div></div></div><p><span class="application">MPlayer</span> is a command-line
	  video player with an optional graphical interface which aims
	  to provide speed and flexibility.  Other graphical
	  front-ends to <span class="application">MPlayer</span> are
	  available from the FreeBSD Ports Collection.</p><a id="idp53568248" class="indexterm"></a><p><span class="application">MPlayer</span> can be installed
	  using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/mplayer/pkg-descr">multimedia/mplayer</a> package or
	  port.  Several compile options are available and a variety
	  of hardware checks occur during the build process.  For
	  these reasons, some users prefer to build the port rather
	  than install the package.</p><p>When compiling the port, the menu options should be
	  reviewed to determine the type of support to compile into
	  the port.  If an option is not selected,
	  <span class="application">MPlayer</span> will not be able to
	  display that type of video format.  Use the arrow keys and
	  spacebar to select the required formats.  When finished,
	  press <span class="keycap"><strong>Enter</strong></span> to continue the port compile
	  and installation.</p><p>By default, the package or port will build the
	  <code class="command">mplayer</code> command line utility and the
	  <code class="command">gmplayer</code> graphical utility.  To encode
	  videos, compile the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/mencoder/pkg-descr">multimedia/mencoder</a>
	  port.  Due to licensing restrictions, a package is not
	  available for <span class="application">MEncoder</span>.</p><p>The first time <span class="application">MPlayer</span> is
	  run, it will create <code class="filename">~/.mplayer</code> in the
	  user's home directory.  This subdirectory contains default
	  versions of the user-specific configuration files.</p><p>This section describes only a few common uses.  Refer to
	  mplayer(1) for a complete description of its numerous
	  options.</p><p>To play the file
	  <code class="filename"><em class="replaceable"><code>testfile.avi</code></em></code>,
	  specify the video interfaces with <code class="option">-vo</code>, as
	  seen in the following examples:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mplayer -vo xv <em class="replaceable"><code>testfile.avi</code></em></code></strong></pre><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mplayer -vo sdl <em class="replaceable"><code>testfile.avi</code></em></code></strong></pre><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mplayer -vo x11 <em class="replaceable"><code>testfile.avi</code></em></code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mplayer -vo dga <em class="replaceable"><code>testfile.avi</code></em></code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mplayer -vo 'sdl:dga' <em class="replaceable"><code>testfile.avi</code></em></code></strong></pre><p>It is worth trying all of these options, as their
	  relative performance depends on many factors and will vary
	  significantly with hardware.</p><p>To play a <acronym class="acronym">DVD</acronym>, replace
	  <code class="filename"><em class="replaceable"><code>testfile.avi</code></em></code>
	  with <code class="option">dvd://<em class="replaceable"><code>N</code></em> -dvd-device
	   <em class="replaceable"><code>DEVICE</code></em></code>, where
	  <em class="replaceable"><code>N</code></em> is the title number to play and
	  <em class="replaceable"><code>DEVICE</code></em> is the device node for the
	  <acronym class="acronym">DVD</acronym>.  For example, to play title 3 from
	  <code class="filename">/dev/dvd</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mplayer -vo xv dvd://3 -dvd-device /dev/dvd</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The default <acronym class="acronym">DVD</acronym> device can be
	    defined during the build of the
	    <span class="application">MPlayer</span> port by including the
	    <code class="varname">WITH_DVD_DEVICE=/path/to/desired/device</code>
	    option.  By default, the device is
	    <code class="filename">/dev/cd0</code>.  More details can be found
	    in the port's
	    <code class="filename">Makefile.options</code>.</p></div><p>To stop, pause, advance, and so on, use a keybinding.
	  To see the list of keybindings, run <code class="command">mplayer
	    -h</code> or read mplayer(1).</p><p>Additional playback options include <code class="option">-fs
	    -zoom</code>, which engages fullscreen mode, and
	  <code class="option">-framedrop</code>, which helps performance.</p><p>Each user can add commonly used options to their
	  <code class="filename">~/.mplayer/config</code> like so:</p><pre class="programlisting">vo=xv
fs=yes
zoom=yes</pre><p><code class="command">mplayer</code> can be used to rip a
	  <acronym class="acronym">DVD</acronym> title to a <code class="filename">.vob</code>.
	  To dump the second title from a
	  <acronym class="acronym">DVD</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mplayer -dumpstream -dumpfile out.vob dvd://2 -dvd-device /dev/dvd</code></strong></pre><p>The output file, <code class="filename">out.vob</code>, will be
	  in <acronym class="acronym">MPEG</acronym> format.</p><p>Anyone wishing to obtain a high level of expertise with
	  <span class="trademark">UNIX</span>® video should consult <a class="link" href="http://www.mplayerhq.hu/DOCS/" target="_top">mplayerhq.hu/DOCS</a>
	  as it is technically informative.  This documentation should
	  be considered as required reading before submitting any bug
	  reports.</p><a id="idp53618296" class="indexterm"></a><p>Before using <code class="command">mencoder</code>, it is a good
	  idea to become familiar with the options described at <a class="link" href="http://www.mplayerhq.hu/DOCS/HTML/en/mencoder.html" target="_top">mplayerhq.hu/DOCS/HTML/en/mencoder.html</a>.
	  There are innumerable ways to improve quality, lower
	  bitrate, and change formats, and some of these options may
	  make the difference between good or bad performance.
	  Improper combinations of command line options can yield
	  output files that are unplayable even by
	  <code class="command">mplayer</code>.</p><p>Here is an example of a simple copy:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mencoder <em class="replaceable"><code>input.avi</code></em> -oac copy -ovc copy -o <em class="replaceable"><code>output.avi</code></em></code></strong></pre><p>To rip to a file, use <code class="option">-dumpfile</code> with
	  <code class="command">mplayer</code>.</p><p>To convert
	  <code class="filename"><em class="replaceable"><code>input.avi</code></em></code> to
	  the MPEG4 codec with MPEG3 audio encoding, first install the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/lame/pkg-descr">audio/lame</a> port.  Due to licensing
	  restrictions, a package is not available.  Once installed,
	  type:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mencoder <em class="replaceable"><code>input.avi</code></em> -oac mp3lame -lameopts br=192 \
	 -ovc lavc -lavcopts vcodec=mpeg4:vhq -o <em class="replaceable"><code>output.avi</code></em></code></strong></pre><p>This will produce output playable by applications such
	  as <code class="command">mplayer</code> and
	  <code class="command">xine</code>.</p><p><code class="filename"><em class="replaceable"><code>input.avi</code></em></code>
	  can be replaced with <code class="option">dvd://1 -dvd-device
	    /dev/dvd</code> and run as <code class="systemitem">root</code> to re-encode a
	  <acronym class="acronym">DVD</acronym> title directly.  Since it may take a
	  few tries to get the desired result, it is recommended to
	  instead dump the title to a file and to work on the
	  file.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-xine"></a>7.4.2.2. The <span class="application">xine</span> Video
	  Player</h4></div></div></div><p><span class="application">xine</span> is a video player with a
	  reusable base library and a modular executable which can be
	  extended with plugins.  It can be installed using the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/xine/pkg-descr">multimedia/xine</a> package or port.</p><p>In practice, <span class="application">xine</span> requires
	  either a fast CPU with a fast video card, or support for the
	  XVideo extension.  The <span class="application">xine</span> video
	  player performs best on XVideo interfaces.</p><p>By default, the <span class="application">xine</span> player
	  starts a graphical user interface.  The menus can then be
	  used to open a specific file.</p><p>Alternatively, <span class="application">xine</span> may be
	  invoked from the command line by specifying the name of the
	  file to play:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>xine -g -p <em class="replaceable"><code>mymovie.avi</code></em></code></strong></pre><p>Refer to <a class="link" href="http://www.xine-project.org/faq" target="_top">
	    xine-project.org/faq</a> for more information and
	  troubleshooting tips.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="video-ports-transcode"></a>7.4.2.3. The <span class="application">Transcode</span>
	  Utilities</h4></div></div></div><p><span class="application">Transcode</span> provides a suite of
	  tools for re-encoding video and audio files.
	  <span class="application">Transcode</span> can be used to merge
	  video files or repair broken files using command line tools
	  with stdin/stdout stream interfaces.</p><p>In FreeBSD, <span class="application">Transcode</span> can be
	  installed using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/transcode/pkg-descr">multimedia/transcode</a>
	  package or port.  Many users prefer to compile the port as
	  it provides a menu of compile options for specifying the
	  support and codecs to compile in.  If an option is not
	  selected, <span class="application">Transcode</span> will not be
	  able to encode that format.  Use the arrow keys and spacebar
	  to select the required formats.  When finished, press
	  <span class="keycap"><strong>Enter</strong></span> to continue the port compile and
	  installation.</p><p>This example demonstrates how to convert a DivX file
	  into a PAL MPEG-1 file (PAL VCD):</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>transcode -i <em class="replaceable"><code>input.avi</code></em> -V --export_prof vcd-pal -o output_vcd</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>mplex -f 1 -o <em class="replaceable"><code>output_vcd.mpg output_vcd.m1v output_vcd.mpa</code></em></code></strong></pre><p>The resulting <acronym class="acronym">MPEG</acronym> file,
	  <code class="filename"><em class="replaceable"><code>output_vcd.mpg</code></em></code>,
	  is ready to be played with
	  <span class="application">MPlayer</span>.  The file can be burned
	  on a <acronym class="acronym">CD</acronym> media to create a video
	  <acronym class="acronym">CD</acronym> using a utility such as
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/vcdimager/pkg-descr">multimedia/vcdimager</a> or
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrdao/pkg-descr">sysutils/cdrdao</a>.</p><p>In addition to the manual page for
	  <code class="command">transcode</code>, refer to  <a class="link" href="http://www.transcoding.org/cgi-bin/transcode" target="_top">transcoding.org/cgi-bin/transcode</a>
	  for further information and examples.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="tvcard"></a>7.5. TV Cards</h2></div><div><span class="authorgroup">Original contribution by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Josef</span> <span class="surname">El-Rayes</span></span>. </span></div><div><span class="authorgroup">Enhanced and adapted by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp53683448" class="indexterm"></a><p>TV cards can be used to watch broadcast or cable TV on a
      computer.  Most cards accept composite video via an
      <acronym class="acronym">RCA</acronym> or S-video input and some cards include a
      <acronym class="acronym">FM</acronym> radio tuner.</p><p>FreeBSD provides support for PCI-based TV cards using a
      Brooktree Bt848/849/878/879 video capture chip with the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bktr</span>(4)</span></a> driver.  This driver supports most Pinnacle PCTV
      video cards.  Before purchasing a TV card, consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bktr</span>(4)</span></a>
      for a list of supported tuners.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53687544"></a>7.5.1. Loading the Driver</h3></div></div></div><p>In order to use the card, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bktr</span>(4)</span></a> driver must be
	loaded.  To automate this at boot time, add the following line
	to <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">bktr_load="YES"</pre><p>Alternatively, one can statically compile support for
	the TV card into a custom kernel.  In that case, add the
	following lines to the custom kernel configuration
	file:</p><pre class="programlisting">device	 bktr
device	iicbus
device	iicbb
device	smbus</pre><p>These additional devices are necessary as the card
	components are interconnected via an I2C bus.  Then, build and
	install a new kernel.</p><p>To test that the tuner is correctly detected, reboot the
	system.  The TV card should appear in the boot messages, as
	seen in this example:</p><pre class="programlisting">bktr0: &lt;BrookTree 848A&gt; mem 0xd7000000-0xd7000fff irq 10 at device 10.0 on pci0
iicbb0: &lt;I2C bit-banging driver&gt; on bti2c0
iicbus0: &lt;Philips I2C bus&gt; on iicbb0 master-only
iicbus1: &lt;Philips I2C bus&gt; on iicbb0 master-only
smbus0: &lt;System Management Bus&gt; on bti2c0
bktr0: Pinnacle/Miro TV, Philips SECAM tuner.</pre><p>The messages will differ according to the hardware.  If
	necessary, it is possible to override some of the detected
	parameters using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> or custom kernel configuration
	options.  For example, to force the tuner to a Philips SECAM
	tuner, add the following line to a custom kernel configuration
	file:</p><pre class="programlisting">options OVERRIDE_TUNER=6</pre><p>or, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.bt848.tuner=6</code></strong></pre><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bktr</span>(4)</span></a> for a description of the available
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> parameters and kernel options.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53353592"></a>7.5.2. Useful Applications</h3></div></div></div><p>To use the TV card, install one of the following
	applications:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/fxtv/pkg-descr">multimedia/fxtv</a>
	    provides TV-in-a-window and image/audio/video capture
	    capabilities.</p></li><li class="listitem"><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/xawtv/pkg-descr">multimedia/xawtv</a>
	    is another TV application with similar features.</p></li><li class="listitem"><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/audio/xmradio/pkg-descr">audio/xmradio</a>
	    provides an application for using the FM radio tuner of a
	    TV card.</p></li></ul></div><p>More applications are available in the FreeBSD Ports
	Collection.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53358584"></a>7.5.3. Troubleshooting</h3></div></div></div><p>If any problems are encountered with the TV card, check
	that the video capture chip and the tuner are supported by
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bktr&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bktr</span>(4)</span></a> and that the right configuration options were
	used.  For more support or to ask questions about supported TV
	cards, refer to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-multimedia" target="_top">freebsd-multimedia</a> mailing list.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mythtv"></a>7.6. MythTV</h2></div></div></div><p>MythTV is a popular, open source Personal Video Recorder
      (<acronym class="acronym">PVR</acronym>) application.  This section demonstrates
      how to install and setup MythTV on FreeBSD.  Refer to <a class="link" href="http://www.mythtv.org/wiki/" target="_top">mythtv.org/wiki</a>
      for more information on how to use MythTV.</p><p>MythTV requires a frontend and a backend.  These components
      can either be installed on the same system or on different
      machines.</p><p>The frontend can be installed on FreeBSD using the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/mythtv-frontend/pkg-descr">multimedia/mythtv-frontend</a> package or port.
      <span class="application">Xorg</span> must also be installed and
      configured as described in <a class="xref" href="#x11" title="Chapter 5. The X Window System">Chapter 5, <em>The X Window System</em></a>.  Ideally, this
      system has a video card that supports X-Video Motion
      Compensation (<acronym class="acronym">XvMC</acronym>) and, optionally, a Linux
      Infrared Remote Control (<acronym class="acronym">LIRC</acronym>)-compatible
      remote.</p><p>To install both the backend and the frontend on FreeBSD, use
      the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/mythtv/pkg-descr">multimedia/mythtv</a> package or port.  A
      <span class="trademark">MySQL</span>&#8482; database server is also required and should
      automatically be installed as a dependency.  Optionally, this
      system should have a tuner card and sufficient storage to hold
      recorded data.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53715320"></a>7.6.1. Hardware</h3></div></div></div><p>MythTV uses Video for Linux (<acronym class="acronym">V4L</acronym>) to
	access video input devices such as encoders and tuners.  In
	FreeBSD, MythTV works best with <acronym class="acronym">USB</acronym> DVB-S/C/T
	cards as they are well supported by the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/webcamd/pkg-descr">multimedia/webcamd</a> package or port which
	provides a <acronym class="acronym">V4L</acronym> userland application.  Any
	Digital Video Broadcasting (<acronym class="acronym">DVB</acronym>) card
	supported by <span class="application">webcamd</span> should work
	with MythTV.  A list of known working cards can be found at
	<a class="link" href="https://wiki.freebsd.org/WebcamCompat" target="_top">wiki.freebsd.org/WebcamCompat</a>.
	Drivers are also available for Hauppauge cards in the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/pvr250/pkg-descr">multimedia/pvr250</a> and
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/pvrxxx/pkg-descr">multimedia/pvrxxx</a> ports, but they provide a
	non-standard driver interface that does not work with versions
	of MythTV greater than 0.23.  Due to licensing restrictions,
	no packages are available and these two ports must be
	compiled.</p><p>The <a class="link" href="https://wiki.freebsd.org/HTPC" target="_top">wiki.freebsd.org/HTPC</a>
	page contains a list of all available <acronym class="acronym">DVB</acronym>
	drivers.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53725432"></a>7.6.2. Setting up the MythTV Backend</h3></div></div></div><p>To install MythTV using binary packages:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install mythtv</code></strong></pre><p>Alternatively, to install from the Ports Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/multimedia/mythtv</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre><p>Once installed, set up the MythTV database:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mysql -uroot -p &lt; /usr/local/share/mythtv/database/mc.sql</code></strong></pre><p>Then, configure the backend:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mythtv-setup</code></strong></pre><p>Finally, start the backend:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc mythbackend_enable=yes</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service mythbackend start</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="scanners"></a>7.7. Image Scanners</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp53754360" class="indexterm"></a><p>In FreeBSD, access to image scanners is provided by
      <span class="application">SANE</span> (Scanner Access Now Easy), which
      is available in the FreeBSD Ports Collection.
      <span class="application">SANE</span> will also use some FreeBSD device
      drivers to provide access to the scanner hardware.</p><p>FreeBSD supports both <acronym class="acronym">SCSI</acronym> and
      <acronym class="acronym">USB</acronym> scanners.  Depending upon the scanner
      interface, different device drivers are required.  Be sure the
      scanner is supported by <span class="application">SANE</span> prior
      to performing any configuration.  Refer to <a class="link" href="http://www.sane-project.org/sane-supported-devices.html" target="_top">
      http://www.sane-project.org/sane-supported-devices.html</a>
      for more information about supported scanners.</p><p>This chapter describes how to determine if the scanner has
      been detected by FreeBSD.  It then provides an overview of how to
      configure and use <span class="application">SANE</span> on a FreeBSD
      system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="scanners-kernel-usb"></a>7.7.1. Checking the Scanner</h3></div></div></div><p>The <code class="filename">GENERIC</code> kernel includes the
	device drivers needed to support <acronym class="acronym">USB</acronym>
	scanners.  Users with a custom kernel should ensure that the
	following lines are present in the custom kernel configuration
	file:</p><pre class="programlisting">device usb
device uhci
device ohci
device ehci
device xhci</pre><p>To determine if the <acronym class="acronym">USB</acronym> scanner is
	detected, plug it in and use <code class="command">dmesg</code> to
	determine whether the scanner appears in the system message
	buffer.  If it does, it should display a message similar to
	this:</p><pre class="screen">ugen0.2: &lt;EPSON&gt; at usbus0</pre><p>In this example, an <span class="trademark">EPSON
  Perfection</span>® 1650
	<acronym class="acronym">USB</acronym> scanner was detected on
	<code class="filename">/dev/ugen0.2</code>.</p><p>If the scanner uses a <acronym class="acronym">SCSI</acronym> interface,
	it is important to know which <acronym class="acronym">SCSI</acronym>
	controller board it will use.  Depending upon the
	<acronym class="acronym">SCSI</acronym> chipset, a custom kernel configuration
	file may be needed.  The <code class="filename">GENERIC</code> kernel
	supports the most common <acronym class="acronym">SCSI</acronym> controllers.
	Refer to <code class="filename">/usr/src/sys/conf/NOTES</code> to
	determine the correct line to add to a custom kernel
	configuration file.  In addition to the
	<acronym class="acronym">SCSI</acronym> adapter driver, the following lines
	are needed in a custom kernel configuration file:</p><pre class="programlisting">device scbus
device pass</pre><p>Verify that the device is displayed in the system message
	buffer:</p><pre class="screen">pass2 at aic0 bus 0 target 2 lun 0
pass2: &lt;AGFA SNAPSCAN 600 1.10&gt; Fixed Scanner SCSI-2 device
pass2: 3.300MB/s transfers</pre><p>If the scanner was not powered-on at system boot, it is
	still possible to manually force detection by performing a
	<acronym class="acronym">SCSI</acronym> bus scan with
	<code class="command">camcontrol</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol rescan all</code></strong>
Re-scan of bus 0 was successful
Re-scan of bus 1 was successful
Re-scan of bus 2 was successful
Re-scan of bus 3 was successful</pre><p>The scanner should now appear in the
	<acronym class="acronym">SCSI</acronym> devices list:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol devlist</code></strong>
&lt;IBM DDRS-34560 S97B&gt;              at scbus0 target 5 lun 0 (pass0,da0)
&lt;IBM DDRS-34560 S97B&gt;              at scbus0 target 6 lun 0 (pass1,da1)
&lt;AGFA SNAPSCAN 600 1.10&gt;           at scbus1 target 2 lun 0 (pass3)
&lt;PHILIPS CDD3610 CD-R/RW 1.00&gt;     at scbus2 target 0 lun 0 (pass2,cd0)</pre><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=scsi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">scsi</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=camcontrol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">camcontrol</span>(8)</span></a> for more
	details about <acronym class="acronym">SCSI</acronym> devices on FreeBSD.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53783544"></a>7.7.2. <span class="application">SANE</span> Configuration</h3></div></div></div><p>The <span class="application">SANE</span> system provides the
	access to the scanner via backends (<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-backends/pkg-descr">graphics/sane-backends</a>).
	Refer to <a class="link" href="http://www.sane-project.org/sane-supported-devices.html" target="_top">http://www.sane-project.org/sane-supported-devices.html</a>
	to determine which backend supports the scanner.  A
	graphical scanning interface is provided by third party
	applications like <span class="application">Kooka</span>
	(<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/kooka/pkg-descr">graphics/kooka</a>) or
	<span class="application">XSane</span>
	(<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/xsane/pkg-descr">graphics/xsane</a>).
	<span class="application">SANE</span>'s backends are enough to test
	the scanner.</p><p>To install the backends from binary package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install sane-backends</code></strong></pre><p>Alternatively, to install from the Ports Collection</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/graphics/sane-backends</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>After installing the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-backends/pkg-descr">graphics/sane-backends</a> port or package, use
	<code class="command">sane-find-scanner</code> to check the scanner
	detection by the <span class="application">SANE</span>
	system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sane-find-scanner -q</code></strong>
found SCSI scanner "AGFA SNAPSCAN 600 1.10" at /dev/pass3</pre><p>The output should show the interface type of the scanner
	and the device node used to attach the scanner to the system.
	The vendor and the product model may or may not appear.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some <acronym class="acronym">USB</acronym> scanners require firmware to
	  be loaded.  Refer to sane-find-scanner(1) and sane(7) for
	  details.</p></div><p>Next, check if the scanner will be identified by a
	scanning frontend.  The <span class="application">SANE</span>
	backends include <code class="command">scanimage</code> which can be
	used to list the devices and perform an image acquisition.
	Use <code class="option">-L</code> to list the scanner devices.  The
	first example is for a <acronym class="acronym">SCSI</acronym> scanner and the
	second is for a <acronym class="acronym">USB</acronym> scanner:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>
device `snapscan:/dev/pass3' is a AGFA SNAPSCAN 600 flatbed scanner
<code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>
device 'epson2:libusb:000:002' is a Epson GT-8200 flatbed scanner</pre><p>In this second example,
	<code class="literal">epson2</code> is
	the backend name and
	<code class="literal">libusb:000:002</code> means
	<code class="filename">/dev/ugen0.2</code> is the device node used by the
	scanner.</p><p>If <code class="command">scanimage</code> is unable to identify the
	scanner, this message will appear:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>

No scanners were identified. If you were expecting something different,
check that the scanner is plugged in, turned on and detected by the
sane-find-scanner tool (if appropriate). Please read the documentation
which came with this software (README, FAQ, manpages).</pre><p>If this happens, edit the backend configuration file in
	<code class="filename">/usr/local/etc/sane.d/</code> and define the
	scanner device used.  For example, if the undetected scanner
	model is an <span class="trademark">EPSON
  Perfection</span>® 1650 and it uses the
	<code class="literal">epson2</code> backend, edit
	<code class="filename">/usr/local/etc/sane.d/epson2.conf</code>.  When
	editing, add a line specifying the interface and the device
	node used.  In this case, add the following line:</p><pre class="programlisting">usb /dev/ugen0.2</pre><p>Save the edits and verify that the scanner is identified
	with the right backend name and the device node:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>
device 'epson2:libusb:000:002' is a Epson GT-8200 flatbed scanner</pre><p>Once <code class="command">scanimage -L</code> sees the scanner, the
	configuration is complete and the scanner is now ready to
	use.</p><p>While <code class="command">scanimage</code> can be used to perform
	an image acquisition from the command line, it is often
	preferable to use a graphical interface to perform image
	scanning.  Applications like <span class="application">Kooka</span>
	or <span class="application">XSane</span> are popular scanning
	frontends.  They
	offer advanced features such as various scanning modes, color
	correction, and batch scans.  <span class="application">XSane</span>
	is also usable as a <span class="application">GIMP</span> plugin.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp53822328"></a>7.7.3. Scanner Permissions</h3></div></div></div><p>In order to have access to the scanner, a user needs read
	and write permissions to the device node used by the scanner.
	In the previous example, the <acronym class="acronym">USB</acronym> scanner
	uses the device node <code class="filename">/dev/ugen0.2</code> which
	is really a symlink to the real device node
	<code class="filename">/dev/usb/0.2.0</code>.  The symlink and the
	device node are owned, respectively, by the <code class="systemitem">wheel</code> and <code class="systemitem">operator</code> groups.  While
	adding the user to these groups will allow access to the
	scanner, it is considered insecure to add a user to
	<code class="systemitem">wheel</code>.  A better
	solution is to create a group and make the scanner device
	accessible to members of this group.</p><p>This example creates a group called <code class="systemitem"><em class="replaceable"><code>usb</code></em></code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupadd usb</code></strong></pre><p>Then, make the <code class="filename">/dev/ugen0.2</code> symlink
	and the <code class="filename">/dev/usb/0.2.0</code> device node
	accessible to the <code class="systemitem">usb</code> group with write
	permissions of <code class="literal">0660</code> or
	<code class="literal">0664</code> by adding the following lines to
	<code class="filename">/etc/devfs.rules</code>:</p><pre class="programlisting">[system=5]
add path ugen0.2 mode 0660 group usb
add path usb/0.2.0 mode 0666 group usb</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">It happens the device node changes with the addition or
	  removal of devices, so one may want to give access to all
	  USB devices using this ruleset instead:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">[system=5]
add path 'ugen*' mode 0660 group usb
add path 'usb/*' mode 0666 group usb</pre></div><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs.rules</span>(5)</span></a> for more information about
	this file.</p><p>Next, enable the ruleset in /etc/rc.conf:</p><pre class="programlisting">devfs_system_ruleset="system"</pre><p>And, restart the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service devfs restart</code></strong></pre><p>Finally, add the users to <code class="systemitem"><em class="replaceable"><code>usb</code></em></code>
	in order to allow access to the scanner:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod usb -m <em class="replaceable"><code>joe</code></em></code></strong></pre><p>For more details refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="kernelconfig"></a>Chapter 8. Configuring the FreeBSD Kernel</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#kernelconfig-synopsis">8.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-custom-kernel">8.2. Why Build a Custom Kernel?</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-devices">8.3. Finding the System Hardware</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-config">8.4. The Configuration File</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-building">8.5. Building and Installing a Custom Kernel</a></span></dt><dt><span class="sect1"><a href="#kernelconfig-trouble">8.6. If Something Goes Wrong</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-synopsis"></a>8.1. Synopsis</h2></div></div></div><a id="idp53846264" class="indexterm"></a><p>The kernel is the core of the FreeBSD operating system.  It
      is responsible for managing memory, enforcing security controls,
      networking, disk access, and much more.  While much of FreeBSD is
      dynamically configurable, it is still occasionally necessary to
      configure and compile a custom kernel.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>When to build a custom kernel.</p></li><li class="listitem"><p>How to take a hardware inventory.</p></li><li class="listitem"><p>How to customize a kernel configuration file.</p></li><li class="listitem"><p>How to use the kernel configuration file to create and
	  build a new kernel.</p></li><li class="listitem"><p>How to install the new kernel.</p></li><li class="listitem"><p>How to troubleshoot if things go wrong.</p></li></ul></div><p>All of the commands listed in the examples in this chapter
      should be executed as <code class="systemitem">root</code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-custom-kernel"></a>8.2. Why Build a Custom Kernel?</h2></div></div></div><p>Traditionally, FreeBSD used a monolithic kernel.  The kernel
      was one large program, supported a fixed list of devices, and in
      order to change the kernel's behavior, one had to compile and
      then reboot into a new kernel.</p><p>Today, most of the functionality in the FreeBSD kernel is
      contained in modules which can be dynamically loaded and
      unloaded from the kernel as necessary.  This allows the running
      kernel to adapt immediately to new hardware and for new
      functionality to be brought into the kernel.  This is known as
      a modular kernel.</p><p>Occasionally, it is still necessary to perform static kernel
      configuration.  Sometimes the needed functionality is so tied
      to the kernel that it can not be made dynamically loadable.
      Some security environments prevent the loading and unloading of
      kernel modules and require that only needed functionality is
      statically compiled into the kernel.</p><p>Building a custom kernel is often a rite of passage for
      advanced BSD users.  This process, while time consuming, can
      provide benefits to the FreeBSD system.  Unlike the
      <code class="filename">GENERIC</code> kernel, which must support a wide
      range of hardware, a custom kernel can be stripped down to only
      provide support for that computer's hardware.  This has a number
      of benefits, such as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Faster boot time.  Since the kernel will only probe the
	  hardware on the system, the time it takes the system to boot
	  can decrease.</p></li><li class="listitem"><p>Lower memory usage.  A custom kernel often uses less
	  memory than the <code class="filename">GENERIC</code> kernel by
	  omitting unused features and device drivers.  This is
	  important because the kernel code remains resident in
	  physical memory at all times, preventing that memory from
	  being used by applications.  For this reason, a custom
	  kernel is useful on a system with a small amount of
	  RAM.</p></li><li class="listitem"><p>Additional hardware support.  A custom kernel can add
	  support for devices which are not present in the
	  <code class="filename">GENERIC</code> kernel.</p></li></ul></div><p>Before building a custom kernel, consider the reason for
      doing so.  If there is a need for specific hardware support,
      it may already exist as a module.</p><p>Kernel modules exist in <code class="filename">/boot/kernel</code>
      and may be dynamically loaded into the running kernel using
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.  Most kernel drivers have a loadable module and
      manual page.  For example, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a> wireless Ethernet
      driver has the following information in its manual page:</p><pre class="screen">Alternatively, to load the driver as a module at boot time, place the
following line in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a>:

    if_ath_load="YES"</pre><p>Adding <code class="literal">if_ath_load="YES"</code> to
      <code class="filename">/boot/loader.conf</code> will load this module
      dynamically at boot time.</p><p>In some cases, there is no associated module in
      <code class="filename">/boot/kernel</code>.  This is mostly true for
      certain subsystems.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-devices"></a>8.3. Finding the System Hardware</h2></div></div></div><p>Before editing the kernel configuration file, it is
      recommended to perform an inventory of the machine's hardware.
      On a dual-boot system, the inventory can be created from the
      other operating system.  For example, <span class="trademark">Microsoft</span>®'s
      <span class="application">Device Manager</span> contains information
      about installed devices.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some versions of <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® have a
	<span class="application">System</span> icon which can be used to
	access <span class="application">Device Manager</span>.</p></div><p>If FreeBSD is the only installed operating system, use
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> to determine the hardware that was found and
      listed during the boot probe.  Most device drivers on FreeBSD have
      a manual page which lists the hardware supported by that driver.
      For example, the following lines indicate that the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=psm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">psm</span>(4)</span></a>
      driver found a mouse:</p><pre class="screen">psm0: &lt;PS/2 Mouse&gt; irq 12 on atkbdc0
psm0: [GIANT-LOCKED]
psm0: [ITHREAD]
psm0: model Generic PS/2 mouse, device ID 0</pre><p>Since this hardware exists, this driver should not be
      removed from a custom kernel configuration file.</p><p>If the output of <code class="command">dmesg</code> does not display
      the results of the boot probe output, instead read the contents
      of <code class="filename">/var/run/dmesg.boot</code>.</p><p>Another tool for finding hardware is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pciconf&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pciconf</span>(8)</span></a>, which
      provides more verbose output.  For example:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>pciconf -lv</code></strong>
ath0@pci0:3:0:0:        class=0x020000 card=0x058a1014 chip=0x1014168c rev=0x01 hdr=0x00
    vendor     = 'Atheros Communications Inc.'
    device     = 'AR5212 Atheros AR5212 802.11abg wireless'
    class      = network
    subclass   = ethernet</pre><p>This output shows that the <code class="filename">ath</code> driver
      located a wireless Ethernet device.</p><p>The <code class="option">-k</code> flag of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=man&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">man</span>(1)</span></a> can be used to
      provide useful information.  For example, it can be
      used to display a list of manual pages which contain a
      particular device brand or name:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>man -k <em class="replaceable"><code>Atheros</code></em></code></strong>
ath(4)                   - Atheros IEEE 802.11 wireless network driver
ath_hal(4)               - Atheros Hardware Access Layer (HAL)</pre><p>Once the hardware inventory list is created, refer to it
      to ensure that drivers for installed hardware are not removed
      as the custom kernel configuration is edited.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-config"></a>8.4. The Configuration File</h2></div></div></div><p>In order to create a custom kernel configuration file and
      build a custom kernel, the full FreeBSD source tree must first be
      installed.</p><p>If <code class="filename">/usr/src/</code> does not exist or it is
      empty, source has not been installed.  Source can be installed
      using <span class="application">Subversion</span> and the instructions
      in <a class="xref" href="#svn" title="A.3. Using Subversion">Section A.3, &#8220;Using <span class="application">Subversion</span>&#8221;</a>.</p><p>Once source is installed, review the contents of
      <code class="filename">/usr/src/sys</code>.  This directory contains a
      number of subdirectories, including those which represent the
      following supported architectures: <code class="filename">amd64</code>,
      <code class="filename">i386</code>,
      <code class="filename">powerpc</code>, and
      <code class="filename">sparc64</code>.  Everything inside a particular
      architecture's directory deals with that architecture only and
      the rest of the code is machine independent code common to all
      platforms.  Each supported architecture has a
      <code class="filename">conf</code> subdirectory which contains the
      <code class="filename">GENERIC</code> kernel configuration file for that
      architecture.</p><p>Do not make edits to <code class="filename">GENERIC</code>.  Instead,
      copy the file to a different name and make edits to the copy.
      The convention is to use a name with all capital letters.  When
      maintaining multiple FreeBSD machines with different hardware, it
      is a good idea to name it after the machine's hostname.  This
      example creates a copy, named <code class="filename">MYKERNEL</code>, of
      the <code class="filename">GENERIC</code> configuration file for the
      <code class="literal">amd64</code> architecture:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/<em class="replaceable"><code>amd64</code></em>/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC <em class="replaceable"><code>MYKERNEL</code></em></code></strong></pre><p><code class="filename"><em class="replaceable"><code>MYKERNEL</code></em></code> can
      now be customized with any <acronym class="acronym">ASCII</acronym> text editor.
      The default editor is <span class="application">vi</span>, though an
      easier editor for beginners, called
      <span class="application">ee</span>, is also installed with
      FreeBSD.</p><a id="idp53930232" class="indexterm"></a><a id="idp53943672" class="indexterm"></a><a id="idp53944184" class="indexterm"></a><p>The format of the kernel configuration file is simple.
      Each line contains a keyword that represents a device or
      subsystem, an argument, and a brief description.  Any text
      after a <code class="literal">#</code> is considered a comment and
      ignored.  To remove kernel support for a device or subsystem,
      put a <code class="literal">#</code> at the beginning of the line
      representing that device or subsystem.  Do not add or remove a
      <code class="literal">#</code> for any line that you do not
      understand.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is easy to remove support for a device or option and
	end up with a broken kernel.  For example, if the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ata&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ata</span>(4)</span></a>
	driver is removed from the kernel configuration file, a system
	using <acronym class="acronym">ATA</acronym> disk drivers may not boot.  When
	in doubt, just leave support in the kernel.</p></div><p>In addition to the brief descriptions provided in this file,
      additional descriptions are contained in
      <code class="filename">NOTES</code>, which can be found in the same
      directory as <code class="filename">GENERIC</code> for that architecture.
      For architecture independent options, refer to
      <code class="filename">/usr/src/sys/conf/NOTES</code>.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">When finished customizing the kernel configuration file,
	save a backup copy to a location outside of
	<code class="filename">/usr/src</code>.</p><p xmlns="http://www.w3.org/1999/xhtml">Alternately, keep the kernel configuration file elsewhere
	and create a symbolic link to the file:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/amd64/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /root/kernels</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC /root/kernels/MYKERNEL</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /root/kernels/MYKERNEL</code></strong></pre></div><p>An <code class="literal">include</code> directive is available for use
      in configuration files.  This allows another configuration file
      to be included in the current one, making it easy to maintain
      small changes relative to an existing file.  If only a small
      number of additional options or drivers are required, this
      allows a delta to be maintained with respect to
      <code class="filename">GENERIC</code>, as seen in this example:</p><pre class="programlisting">include GENERIC
ident MYKERNEL

options         IPFIREWALL
options         DUMMYNET
options         IPFIREWALL_DEFAULT_TO_ACCEPT
options         IPDIVERT</pre><p>Using this method, the local configuration file expresses
      local differences from a <code class="filename">GENERIC</code> kernel.
      As upgrades are performed, new features added to
      <code class="filename">GENERIC</code> will also be added to the local
      kernel unless they are specifically prevented using
      <code class="literal">nooptions</code> or <code class="literal">nodevice</code>.  A
      comprehensive list of configuration directives and their
      descriptions may be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">config</span>(5)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">To build a file which contains all available options,
	run the following command as <code class="systemitem">root</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf &amp;&amp; make LINT</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-building"></a>8.5. Building and Installing a Custom Kernel</h2></div></div></div><p>Once the edits to the custom configuration file have been
      saved, the source code for the kernel can be compiled using the
      following steps:</p><div class="procedure"><a id="idp54021112"></a><div class="procedure-title">Procedure 8.1. Building a Kernel</div><a id="idp54021752" class="indexterm"></a><ol class="procedure" type="1"><li class="step"><p>Change to this directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre></li><li class="step"><p>Compile the new kernel by specifying the name of the
	  custom kernel configuration file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=<em class="replaceable"><code>MYKERNEL</code></em></code></strong></pre></li><li class="step"><p>Install the new kernel associated with the specified
	  kernel configuration file.  This command will copy the new
	  kernel to <code class="filename">/boot/kernel/kernel</code> and save
	  the old kernel to
	  <code class="filename">/boot/kernel.old/kernel</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=<em class="replaceable"><code>MYKERNEL</code></em></code></strong></pre></li><li class="step"><p>Shutdown the system and reboot into the new kernel.
	  If something goes wrong, refer to <a class="xref" href="#kernelconfig-noboot">The kernel does not boot</a>.</p></li></ol></div><p>By default, when a custom kernel is compiled, all kernel
      modules are rebuilt.  To update a kernel faster or to build
      only custom modules, edit <code class="filename">/etc/make.conf</code>
      before starting to build the kernel.</p><p>For example, this variable specifies the list of modules to
      build instead of using the default of building all
      modules:</p><pre class="programlisting">MODULES_OVERRIDE = linux acpi</pre><p>Alternately, this variable lists which modules to exclude
      from the build process:</p><pre class="programlisting">WITHOUT_MODULES = linux acpi sound</pre><p>Additional variables are available.  Refer to
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a> for details.</p><a id="idp54038008" class="indexterm"></a></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-trouble"></a>8.6. If Something Goes Wrong</h2></div></div></div><p>There are four categories of trouble that can occur when
      building a custom kernel:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="command">config</code> fails</span></dt><dd><p>If <code class="command">config</code> fails, it will print the
	    line number that is incorrect.  As an example, for the
	    following message, make sure that line 17 is typed
	    correctly by comparing it to <code class="filename">GENERIC</code>
	    or <code class="filename">NOTES</code>:</p><pre class="screen">config: line 17: syntax error</pre></dd><dt><span class="term"><code class="command">make</code> fails</span></dt><dd><p>If <code class="command">make</code> fails, it is usually due to
	    an error in the kernel configuration file which is not
	    severe enough for <code class="command">config</code> to catch.
	    Review the configuration, and if the problem is not
	    apparent, send an email to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">FreeBSD general questions mailing list</a> which
	    contains the kernel configuration file.</p></dd><dt><a id="kernelconfig-noboot"></a><span class="term">The kernel does not boot</span></dt><dd><p>If the new kernel does not boot or fails to recognize
	    devices, do not panic!  Fortunately, FreeBSD has an excellent
	    mechanism for recovering from incompatible kernels.
	    Simply choose the kernel to boot from at the FreeBSD boot
	    loader.  This can be accessed when the system boot menu
	    appears by selecting the <span class="quote">&#8220;<span class="quote">Escape to a loader
	      prompt</span>&#8221;</span> option.  At the prompt, type
	    <code class="command">boot
	      <em class="replaceable"><code>kernel.old</code></em></code>, or the
	    name of any other kernel that is known to boot
	    properly.</p><p>After booting with a good kernel, check over the
	    configuration file and try to build it again.  One helpful
	    resource is <code class="filename">/var/log/messages</code> which
	    records the kernel messages from every successful boot.
	    Also, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> will print the kernel messages from
	    the current boot.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">When troubleshooting a kernel, make sure to keep
	      a copy of <code class="filename">GENERIC</code>, or some other
	      kernel that is known to work, as a different name that
	      will not get erased on the next build.  This is
	      important because every time a new kernel is installed,
	      <code class="filename">kernel.old</code> is overwritten with the
	      last installed kernel, which may or may not be bootable.
	      As soon as possible, move the working kernel by renaming
	      the directory containing the good kernel:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mv /boot/kernel <em class="replaceable"><code>/boot/kernel.bad</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv /boot/<em class="replaceable"><code>kernel.good</code></em> /boot/kernel</code></strong></pre></div></dd><dt><span class="term">The kernel works, but <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> does not</span></dt><dd><p>If the kernel version differs from the one that the
	    system utilities have been built with, for example, a
	    kernel built from -CURRENT sources is installed on a
	    -RELEASE system, many system status commands like
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vmstat&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vmstat</span>(8)</span></a> will not work.  To fix this,
	    <a class="link" href="#makeworld" title="23.5. Updating FreeBSD from Source">recompile and install a
	      world</a> built with the same version of the source
	    tree as the kernel.  It is never a good idea to use a
	    different version of the kernel than the rest of the
	    operating system.</p></dd></dl></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing"></a>Chapter 9. Printing</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#printing-quick-start">9.1. Quick Start</a></span></dt><dt><span class="sect1"><a href="#printing-connections">9.2. Printer Connections</a></span></dt><dt><span class="sect1"><a href="#printing-pdls">9.3. Common Page Description Languages</a></span></dt><dt><span class="sect1"><a href="#printing-direct">9.4. Direct Printing</a></span></dt><dt><span class="sect1"><a href="#printing-lpd">9.5. <acronym class="acronym">LPD</acronym> (Line Printer Daemon)</a></span></dt><dt><span class="sect1"><a href="#printing-other">9.6. Other Printing Systems</a></span></dt></dl></div><p>Putting information on paper is a vital function, despite many
    attempts to eliminate it.  Printing has two basic components.  The
    data must be delivered to the printer, and must be in a form that
    the printer can understand.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-quick-start"></a>9.1. Quick Start</h2></div></div></div><p>Basic printing can be set up quickly.  The printer must be
      capable of printing plain <acronym class="acronym">ASCII</acronym> text.  For
      printing to other types of files, see
      <a class="xref" href="#printing-lpd-filters" title="9.5.3. Filters">Section 9.5.3, &#8220;Filters&#8221;</a>.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create a directory to store files while they are being
	  printed:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /var/spool/lpd/lp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown daemon:daemon /var/spool/lpd/lp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 770 /var/spool/lpd/lp</code></strong></pre></li><li class="step"><p>As <code class="systemitem">root</code>,
	  create <code class="filename">/etc/printcap</code> with these
	  contents:</p><pre class="programlisting">lp:\
	<em class="replaceable"><code>:lp=/dev/unlpt0:\</code></em>  <a id="printing-qs-co-printcap"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/lp:\
	:lf=/var/log/lpd-errs:</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#printing-qs-co-printcap"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This line is for a printer connected to a
	      <acronym class="acronym">USB</acronym> port.</p><p>For a printer connected to a parallel or
	      <span class="quote">&#8220;<span class="quote">printer</span>&#8221;</span> port, use:</p><pre class="programlisting">:lp=/dev/lpt0:\</pre><p>For a printer connected directly to a network,
	      use:</p><pre class="programlisting">:lp=:rm=<em class="replaceable"><code>network-printer-name</code></em>:rp=raw:\</pre><p>Replace
	      <em class="replaceable"><code>network-printer-name</code></em> with the
	      <acronym class="acronym">DNS</acronym> host name of the network
	      printer.</p></td></tr></table></div></li><li class="step"><p>Enable <code class="command">lpd</code> by editing
	  <code class="filename">/etc/rc.conf</code>, adding this line:</p><pre class="programlisting">lpd_enable="YES"</pre><p>Start the service:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service lpd start</code></strong>
Starting lpd.</pre></li><li class="step"><p>Print a test:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>printf "1. This printer can print.\n2. This is the second line.\n" | lpr</code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">If both lines do not start at the left border, but
	    <span class="quote">&#8220;<span class="quote">stairstep</span>&#8221;</span> instead, see
	    <a class="xref" href="#printing-lpd-filters-stairstep" title="9.5.3.1. Preventing Stairstepping on Plain Text Printers">Section 9.5.3.1, &#8220;Preventing Stairstepping on Plain Text Printers&#8221;</a>.</p></div><p>Text files can now be printed with
	  <code class="command">lpr</code>.  Give the filename on the command
	  line, or pipe output directly into
	  <code class="command">lpr</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr textfile.txt</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>ls -lh | lpr</code></strong></pre></li></ol></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-connections"></a>9.2. Printer Connections</h2></div></div></div><p>Printers are connected to computer systems in a variety of
      ways.  Small desktop printers are usually connected directly to
      a computer's <acronym class="acronym">USB</acronym> port.  Older printers are
      connected to a parallel or <span class="quote">&#8220;<span class="quote">printer</span>&#8221;</span> port.  Some
      printers are directly connected to a network, making it easy for
      multiple computers to share them.  A few printers use a rare
      serial port connection.</p><p>FreeBSD can communicate with all of these types of
      printers.</p><div class="variablelist"><dl class="variablelist"><dt><a id="printing-connections-usb"></a><span class="term"><acronym class="acronym">USB</acronym></span></dt><dd><p><acronym class="acronym">USB</acronym> printers can be connected to
	    any available <acronym class="acronym">USB</acronym> port on the
	    computer.</p><p>When FreeBSD detects a <acronym class="acronym">USB</acronym> printer,
	    two device entries are created:
	    <code class="filename">/dev/ulpt0</code> and
	    <code class="filename">/dev/unlpt0</code>.  Data sent to either
	    device will be relayed to the printer.  After each print
	    job, <code class="filename">ulpt0</code> resets the
	    <acronym class="acronym">USB</acronym> port.  Resetting the port can cause
	    problems with some printers, so the
	    <code class="filename">unlpt0</code> device is usually used
	    instead.  <code class="filename">unlpt0</code> does not reset the
	    USB port at all.</p></dd><dt><a id="printing-connections-parallel"></a><span class="term">Parallel (<acronym class="acronym">IEEE</acronym>-1284)</span></dt><dd><p>The parallel port device is
	    <code class="filename">/dev/lpt0</code>.  This device appears
	    whether a printer is attached or not, it is not
	    autodetected.</p><p>Vendors have largely moved away from these
	    <span class="quote">&#8220;<span class="quote">legacy</span>&#8221;</span> ports, and many computers no longer
	    have them.  Adapters can be used to connect a parallel
	    printer to a <acronym class="acronym">USB</acronym> port.  With such an
	    adapter, the printer can be treated as if it were actually
	    a <acronym class="acronym">USB</acronym> printer.  Devices called
	    <span class="emphasis"><em>print servers</em></span> can also be used to
	    connect parallel printers directly to a network.</p></dd><dt><a id="printing-connections-serial"></a><span class="term">Serial (RS-232)</span></dt><dd><p>Serial ports are another legacy port, rarely used for
	    printers except in certain niche applications.  Cables,
	    connectors, and required wiring vary widely.</p><p>For serial ports built into a motherboard, the serial
	    device name is <code class="filename">/dev/cuau0</code> or
	    <code class="filename">/dev/cuau1</code>.  Serial
	    <acronym class="acronym">USB</acronym> adapters can also be used, and
	    these will appear as
	    <code class="filename">/dev/cuaU<em class="replaceable"><code>0</code></em></code>.</p><p>Several communication parameters must be known to
	    communicate with a serial printer.  The most important are
	    <span class="emphasis"><em>baud rate</em></span> or <acronym class="acronym">BPS</acronym>
	    (Bits Per Second) and <span class="emphasis"><em>parity</em></span>.  Values
	    vary, but typical serial printers use a baud rate of 9600
	    and no parity.</p></dd><dt><a id="printing-connections-network"></a><span class="term">Network</span></dt><dd><p>Network printers are connected directly to the local
	    computer network.</p><p>The <acronym class="acronym">DNS</acronym> hostname of the printer
	    must be known.  If the printer is assigned a dynamic
	    address by <acronym class="acronym">DHCP</acronym>, <acronym class="acronym">DNS</acronym>
	    should be dynamically updated so that the host name always
	    has the correct <acronym class="acronym">IP</acronym> address.  Network
	    printers are often given static <acronym class="acronym">IP</acronym>
	    addresses to avoid this problem.</p><p>Most network printers understand print jobs sent with
	    the <acronym class="acronym">LPD</acronym> protocol.  A print queue name
	    can also be specified.  Some printers process data
	    differently depending on which queue is used.  For
	    example, a <code class="literal">raw</code> queue prints the data
	    unchanged, while the <code class="literal">text</code> queue adds
	    carriage returns to plain text.</p><p>Many network printers can also print data sent
	    directly to port 9100.</p></dd></dl></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-connections-summary"></a>9.2.1. Summary</h3></div></div></div><p>Wired network connections are usually the easiest to
	set up and give the fastest printing.  For direct connection
	to the computer, <acronym class="acronym">USB</acronym> is preferred for speed
	and simplicity.  Parallel connections work but have
	limitations on cable length and speed.  Serial connections are
	more difficult to configure.  Cable wiring differs between
	models, and communication parameters like baud rate and parity
	bits must add to the complexity.  Fortunately, serial printers
	are rare.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-pdls"></a>9.3. Common Page Description Languages</h2></div></div></div><p>Data sent to a printer must be in a language that the
      printer can understand.  These languages are called Page
      Description Languages, or <acronym class="acronym">PDL</acronym>s.</p><div class="variablelist"><dl class="variablelist"><dt><a id="print-pdls-ascii"></a><span class="term"><acronym class="acronym">ASCII</acronym></span></dt><dd><p>Plain <acronym class="acronym">ASCII</acronym> text is the simplest
	    way to send data to a printer.  Characters correspond one
	    to one with what will be printed: an <code class="literal">A</code>
	    in the data prints an <code class="literal">A</code> on the page.
	    Very little formatting is available.  There is no way to
	    select a font or proportional spacing.  The forced
	    simplicity of plain <acronym class="acronym">ASCII</acronym> means that
	    text can be printed straight from the computer with little
	    or no encoding or translation.  The printed output
	    corresponds directly with what was sent.</p><p>Some inexpensive printers cannot print plain
	    <acronym class="acronym">ASCII</acronym> text.  This makes them more
	    difficult to set up, but it is usually still
	    possible.</p></dd><dt><a id="print-pdls-postscript"></a><span class="term"><span class="trademark">PostScript</span>®</span></dt><dd><p><span class="trademark">PostScript</span>® is almost the opposite of
	    <acronym class="acronym">ASCII</acronym>.  Rather than simple text, a
	    <span class="trademark">PostScript</span>® program is a set of instructions that draw
	    the final document.  Different fonts and graphics can be
	    used.  However, this power comes at a price.  The program
	    that draws the page must be written.  Usually this program
	    is generated by application software, so the process is
	    invisible to the user.</p><p>Inexpensive printers sometimes leave out <span class="trademark">PostScript</span>®
	    compatibility as a cost-saving measure.</p></dd><dt><a id="print-pdls-pcl"></a><span class="term"><acronym class="acronym">PCL</acronym> (Printer Command Language)</span></dt><dd><p><acronym class="acronym">PCL</acronym> is an extension of
	    <acronym class="acronym">ASCII</acronym>, adding escape sequences for
	    formatting, font selection, and printing graphics.  Many
	    printers provide <acronym class="acronym">PCL5</acronym> support.  Some
	    support the newer <acronym class="acronym">PCL6</acronym> or
	    <acronym class="acronym">PCLXL</acronym>.  These later versions are
	    supersets of <acronym class="acronym">PCL5</acronym> and can provide
	    faster printing.</p></dd><dt><a id="print-pdls-host-based"></a><span class="term">Host-Based</span></dt><dd><p>Manufacturers can reduce the cost of a printer by
	    giving it a simple processor and very little memory.
	    These printers are not capable of printing plain text.
	    Instead, bitmaps of text and graphics are drawn by a
	    driver on the host computer and then sent to the printer.
	    These are called <span class="emphasis"><em>host-based</em></span>
	    printers.</p><p>Communication between the driver and a host-based
	    printer is often through proprietary or undocumented
	    protocols, making them functional only on the most common
	    operating systems.</p></dd></dl></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="print-pdls-table"></a>9.3.1. Converting <span class="trademark">PostScript</span>® to Other
	<acronym class="acronym">PDL</acronym>s</h3></div></div></div><p>Many applications from the Ports Collection and FreeBSD
	utilities produce <span class="trademark">PostScript</span>® output.  This table shows
	the utilities available to convert that into other common
	<acronym class="acronym">PDL</acronym>s:</p><div class="table"><a id="print-pdls-ps-to-other-tbl"></a><div class="table-title">Table 9.1. Output <acronym class="acronym">PDL</acronym>s</div><div class="table-contents"><table class="table" summary="Output PDLs" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Output
		<acronym class="acronym">PDL</acronym></th><th align="left">Generated By</th><th align="left">Notes</th></tr></thead><tbody><tr><td align="left"><acronym class="acronym">PCL</acronym> or
		<acronym class="acronym">PCL5</acronym></td><td align="left"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a></td><td align="left"><code class="literal">-sDEVICE=ljet4</code> for monochrome,
		<code class="literal">-sDEVICE=cljet5</code> for color</td></tr><tr><td align="left"><acronym class="acronym">PCLXL</acronym> or
		<acronym class="acronym">PCL6</acronym></td><td align="left"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a></td><td align="left"><code class="literal">-sDEVICE=pxlmono</code> for
		monochrome, <code class="literal">-sDEVICE=pxlcolor</code> for
		color</td></tr><tr><td align="left"><acronym class="acronym">ESC/P2</acronym></td><td align="left"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a></td><td align="left"><code class="literal">-sDEVICE=uniprint</code></td></tr><tr><td align="left"><acronym class="acronym">XQX</acronym></td><td align="left"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/foo2zjs/pkg-descr">print/foo2zjs</a></td><td align="left"> </td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="print-pdls-summary"></a>9.3.2. Summary</h3></div></div></div><p>For the easiest printing, choose a printer that supports
	<span class="trademark">PostScript</span>®.  Printers that support <acronym class="acronym">PCL</acronym>
	are the next preferred.  With
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a>, these
	printers can be used as if they understood <span class="trademark">PostScript</span>®
	natively.  Printers that support <span class="trademark">PostScript</span>® or
	<acronym class="acronym">PCL</acronym> directly almost always support direct
	printing of plain <acronym class="acronym">ASCII</acronym> text files
	also.</p><p>Line-based printers like typical inkjets usually do not
	support <span class="trademark">PostScript</span>® or <acronym class="acronym">PCL</acronym>.  They often
	can print plain <acronym class="acronym">ASCII</acronym> text files.
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a>
	supports the <acronym class="acronym">PDL</acronym>s used by some of these
	printers.  However, printing an entire graphic-based page on
	these printers is often very slow due to the large amount of
	data to be transferred and printed.</p><p>Host-based printers are often more difficult to set up.
	Some cannot be used at all because of proprietary
	<acronym class="acronym">PDL</acronym>s.  Avoid these printers when
	possible.</p><p>Descriptions of many <acronym class="acronym">PDL</acronym>s can be found
	at <a class="link" href="http://www.undocprint.org/formats/page_description_languages" target="_top">http://www.undocprint.org/formats/page_description_languages</a>.
	The particular <acronym class="acronym">PDL</acronym> used by various models
	of printers can be found at <a class="link" href="http://www.openprinting.org/printers" target="_top">http://www.openprinting.org/printers</a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-direct"></a>9.4. Direct Printing</h2></div></div></div><p>For occasional printing, files can be sent directly to a
      printer device without any setup.  For example, a file called
      <code class="filename">sample.txt</code> can be sent to a
      <acronym class="acronym">USB</acronym> printer:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp sample.txt /dev/unlpt0</code></strong></pre><p>Direct printing to network printers depends on the
      abilities of the printer, but most accept print jobs on port
      9100, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=nc&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">nc</span>(1)</span></a> can be used with them.  To print the
      same file to a printer with the <acronym class="acronym">DNS</acronym>
      hostname of <em class="replaceable"><code>netlaser</code></em>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nc <em class="replaceable"><code>netlaser</code></em> 9100 &lt; sample.txt</code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-lpd"></a>9.5. <acronym class="acronym">LPD</acronym> (Line Printer Daemon)</h2></div></div></div><p>Printing a file in the background is called
      <span class="emphasis"><em>spooling</em></span>.  A spooler allows the user to
      continue with other programs on the computer without waiting for
      the printer to slowly complete the print job.</p><p>FreeBSD includes a spooler called <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a>.  Print jobs are
      submitted with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-setup"></a>9.5.1. Initial Setup</h3></div></div></div><p>A directory for storing print jobs is created, ownership
	is set, and the permissions are set to prevent other users
	from viewing the contents of those files:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /var/spool/lpd/lp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown daemon:daemon /var/spool/lpd/lp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 770 /var/spool/lpd/lp</code></strong></pre><p>Printers are defined in
	<code class="filename">/etc/printcap</code>.  An entry for each printer
	includes details like a name, the port where it is attached,
	and various other settings.  Create
	<code class="filename">/etc/printcap</code> with these contents:</p><pre class="programlisting">lp:\				<a id="printing-lpd-co-name"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
	:lp=/dev/unlpt0:\	<a id="printing-lpd-co-device"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
	:sh:\			<a id="printing-lpd-co-header"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
	:mx#0:\			<a id="printing-lpd-co-mx"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
	:sd=/var/spool/lpd/lp:\	<a id="printing-lpd-co-sd"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
	:lf=/var/log/lpd-errs:	<a id="printing-lpd-co-lf"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-name"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The name of this printer.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> sends print
	    jobs to the <code class="literal">lp</code> printer unless another
	    printer is specified with <code class="option">-P</code>, so the
	    default printer should be named
	    <code class="literal">lp</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-device"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The device where the printer is connected.  Replace
	    this line with the appropriate one for the connection type
	    shown here.</p><div class="informaltable"><a id="printing-lpd-co-device-tbl"></a><table class="informaltable" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>Connection Type</th><th>Device Entry in
		    <code class="filename">/etc/printcap</code></th></tr></thead><tbody><tr><td><acronym class="acronym">USB</acronym></td><td><pre class="programlisting">:lp=/dev/unlpt0:\</pre>

		    <p>This is the
		      <span class="emphasis"><em>non-resetting</em></span>
		      <acronym class="acronym">USB</acronym> printer device.  If
		      problems are experienced, use
		      <code class="filename">ulpt0</code> instead, which resets
		      the <acronym class="acronym">USB</acronym> port on each
		      use.</p></td></tr><tr><td>Parallel</td><td><pre class="programlisting">:lp=/dev/lpt0:\</pre></td></tr><tr><td>Network</td><td><p>For a printer supporting the
		    <acronym class="acronym">LPD</acronym> protocol:</p>

		    <pre class="programlisting">:lp=:rm=<em class="replaceable"><code>network-printer-name</code></em>:rp=raw:\</pre>

		    <p>For printers supporting port 9100
		      printing:</p>

		    <pre class="programlisting">:lp=9100@<em class="replaceable"><code>network-printer-name</code></em>:\</pre>

		    <p>For both types, replace
		      <em class="replaceable"><code>network-printer-name</code></em>
		      with the <acronym class="acronym">DNS</acronym> host name of the
		      network printer.</p></td></tr><tr><td>Serial</td><td><pre class="programlisting">:lp=/dev/cuau0:br=9600:pa=none:\</pre>

		    <p>These values are for a typical serial
		      printer connected to a motherboard serial port.
		      The baud rate is 9600, and no parity is
		      used.</p></td></tr></tbody></table></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-header"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Suppress the printing of a header page at the start of
	    a print job.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-mx"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Do not limit the maximum size of a print job.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-sd"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The path to the spooling directory for this printer.
	    Each printer uses its own spooling directory.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-co-lf"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The log file where errors on this printer will be
	    reported.</p></td></tr></table></div><p>After creating <code class="filename">/etc/printcap</code>, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chkprintcap&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chkprintcap</span>(8)</span></a> to test it for errors:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chkprintcap</code></strong></pre><p>Fix any reported problems before continuing.</p><p>Enable <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a> in
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">lpd_enable="YES"</pre><p>Start the service:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service lpd start</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-lpr"></a>9.5.2. Printing with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a></h3></div></div></div><p>Documents are sent to the printer with
	<code class="command">lpr</code>.  A file to be printed can be named on
	the command line or piped into <code class="command">lpr</code>.  These
	two commands are equivalent, sending the contents of
	<code class="filename">doc.txt</code> to the default printer:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr doc.txt</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cat doc.txt | lpr</code></strong></pre><p>Printers can be selected with <code class="option">-P</code>.  To
	print to a printer called
	<em class="replaceable"><code>laser</code></em>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr -Plaser doc.txt</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters"></a>9.5.3. Filters</h3></div></div></div><p>The examples shown so far have sent the contents of a text
	file directly to the printer.  As long as the printer
	understands the content of those files, output will be printed
	correctly.</p><p>Some printers are not capable of printing plain text, and
	the input file might not even be plain text.</p><p><span class="emphasis"><em>Filters</em></span> allow files to be
	translated or processed.  The typical use is to translate one
	type of input, like plain text, into a form that the printer
	can understand, like <span class="trademark">PostScript</span>® or <acronym class="acronym">PCL</acronym>.
	Filters can also be used to provide additional features, like
	adding page numbers or highlighting source code to make it
	easier to read.</p><p>The filters discussed here are
	<span class="emphasis"><em>input filters</em></span> or
	<span class="emphasis"><em>text filters</em></span>.  These filters convert the
	incoming file into different forms.  Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> to become
	<code class="systemitem">root</code> before
	creating the files.</p><p>Filters are specified in
	<code class="filename">/etc/printcap</code> with the
	<code class="literal">if=</code> identifier.  To use
	<code class="filename">/usr/local/libexec/lf2crlf</code> as a filter,
	modify <code class="filename">/etc/printcap</code> like this:</p><pre class="programlisting">lp:\
	:lp=/dev/unlpt0:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/lp:\
	:if=/usr/local/libexec/lf2crlf:\   <a id="printing-lpd-filters-co-if"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
	:lf=/var/log/lpd-errs:</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#printing-lpd-filters-co-if"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p><code class="literal">if=</code> identifies the
	    <span class="emphasis"><em>input filter</em></span> that will be used on
	    incoming text.</p></td></tr></table></div><div xmlns="" class="tip"><h3 class="admontitle"><a xmlns="http://www.w3.org/1999/xhtml" id="printing-lpd-filters-oneline"></a>Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">The backslash <span class="emphasis"><em>line continuation</em></span>
	  characters at the end of the lines in
	  <code class="filename">printcap</code> entries reveal that an entry
	  for a printer is really just one long line with entries
	  delimited by colon characters.  An earlier example can be
	  rewritten as a single less-readable line:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">lp:lp=/dev/unlpt0:sh:mx#0:sd=/var/spool/lpd/lp:if=/usr/local/libexec/lf2crlf:lf=/var/log/lpd-errs:</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters-stairstep"></a>9.5.3.1. Preventing Stairstepping on Plain Text Printers</h4></div></div></div><p>Typical FreeBSD text files contain only a single line feed
	  character at the end of each line.  These lines will
	  <span class="quote">&#8220;<span class="quote">stairstep</span>&#8221;</span> on a standard printer:</p><pre class="programlisting">A printed file looks
                    like the steps of a staircase
                                                 scattered by the wind</pre><p>A filter can convert the newline characters into
	  carriage returns and newlines.  The carriage returns make
	  the printer return to the left after each line.  Create
	  <code class="filename">/usr/local/libexec/lf2crlf</code> with these
	  contents:</p><pre class="programlisting">#!/bin/sh
CR=$'\r'
/usr/bin/sed -e "s/$/${CR}/g"</pre><p>Set the permissions and make it executable:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 555 /usr/local/libexec/lf2crlf</code></strong></pre><p>Modify <code class="filename">/etc/printcap</code> to use the
	  new filter:</p><pre class="programlisting">:if=/usr/local/libexec/lf2crlf:\</pre><p>Test the filter by printing the same plain text file.
	  The carriage returns will cause each line to start at the
	  left side of the page.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters-enscript"></a>9.5.3.2. Fancy Plain Text on <span class="trademark">PostScript</span>® Printers with
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/enscript/pkg-descr">print/enscript</a></h4></div></div></div><p><acronym class="acronym">GNU</acronym>
	  <span class="application">Enscript</span> converts plain text
	  files into nicely-formatted <span class="trademark">PostScript</span>® for printing on
	  <span class="trademark">PostScript</span>® printers.  It adds page numbers, wraps long
	  lines, and provides numerous other features to make printed
	  text files easier to read.  Depending on the local paper
	  size, install either
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/enscript-letter/pkg-descr">print/enscript-letter</a> or
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/enscript-a4/pkg-descr">print/enscript-a4</a> from the
	  Ports Collection.</p><p>Create <code class="filename">/usr/local/libexec/enscript</code>
	  with these contents:</p><pre class="programlisting">#!/bin/sh
/usr/local/bin/enscript -o -</pre><p>Set the permissions and make it executable:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 555 /usr/local/libexec/enscript</code></strong></pre><p>Modify <code class="filename">/etc/printcap</code> to use the
	  new filter:</p><pre class="programlisting">:if=/usr/local/libexec/enscript:\</pre><p>Test the filter by printing a plain text file.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters-ps2pcl"></a>9.5.3.3. Printing <span class="trademark">PostScript</span>® to
	  <acronym class="acronym">PCL</acronym> Printers</h4></div></div></div><p>Many programs produce <span class="trademark">PostScript</span>® documents.
	  However, inexpensive printers often only understand plain
	  text or <acronym class="acronym">PCL</acronym>.  This filter converts
	  <span class="trademark">PostScript</span>® files to <acronym class="acronym">PCL</acronym> before sending
	  them to the printer.</p><p>Install the Ghostscript <span class="trademark">PostScript</span>® interpreter,
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript9-base/pkg-descr">print/ghostscript9-base</a>,
	  from the Ports Collection.</p><p>Create <code class="filename">/usr/local/libexec/ps2pcl</code>
	  with these contents:</p><pre class="programlisting">#!/bin/sh
/usr/local/bin/gs -dSAFER -dNOPAUSE -dBATCH -q -sDEVICE=ljet4 -sOutputFile=- -</pre><p>Set the permissions and make it executable:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 555 /usr/local/libexec/ps2pcl</code></strong></pre><p><span class="trademark">PostScript</span>® input sent to this script will be rendered
	  and converted to <acronym class="acronym">PCL</acronym> before being sent on
	  to the printer.</p><p>Modify <code class="filename">/etc/printcap</code> to use this
	  new input filter:</p><pre class="programlisting">:if=/usr/local/libexec/ps2pcl:\</pre><p>Test the filter by sending a small <span class="trademark">PostScript</span>® program
	  to it:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>printf "%%\!PS \n /Helvetica findfont 18 scalefont setfont \
72 432 moveto (PostScript printing successful.) show showpage \004" | lpr</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters-smart"></a>9.5.3.4. Smart Filters</h4></div></div></div><p>A filter that detects the type of input and
	  automatically converts it to the correct format for the
	  printer can be very convenient.  The first two characters of
	  a <span class="trademark">PostScript</span>® file are usually <code class="literal">%!</code>.  A
	  filter can detect those two characters.  <span class="trademark">PostScript</span>® files
	  can be sent on to a <span class="trademark">PostScript</span>® printer unchanged.  Text
	  files can be converted to <span class="trademark">PostScript</span>® with
	  <span class="application">Enscript</span> as shown earlier.
	  Create <code class="filename">/usr/local/libexec/psif</code> with
	  these contents:</p><pre class="programlisting">#!/bin/sh
#
#  psif - Print PostScript or plain text on a PostScript printer
#
IFS="" read -r first_line
first_two_chars=`expr "$first_line" : '\(..\)'`

case "$first_two_chars" in
%!)
    # %! : PostScript job, print it.
    echo "$first_line" &amp;&amp; cat &amp;&amp; exit 0
    exit 2
    ;;
*)
    # otherwise, format with enscript
    ( echo "$first_line"; cat ) | /usr/local/bin/enscript -o - &amp;&amp; exit 0
    exit 2
    ;;
esac</pre><p>Set the permissions and make it executable:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 555 /usr/local/libexec/psif</code></strong></pre><p>Modify <code class="filename">/etc/printcap</code> to use this
	  new input filter:</p><pre class="programlisting">:if=/usr/local/libexec/psif:\</pre><p>Test the filter by printing <span class="trademark">PostScript</span>® and plain text
	  files.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-filters-othersmart"></a>9.5.3.5. Other Smart Filters</h4></div></div></div><p>Writing a filter that detects many different types of
	  input and formats them correctly is challenging.
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/apsfilter/pkg-descr">print/apsfilter</a> from the
	  Ports Collection is a smart <span class="quote">&#8220;<span class="quote">magic</span>&#8221;</span> filter that
	  detects dozens of file types and automatically converts them
	  to the <acronym class="acronym">PDL</acronym> understood by the printer.
	  See <a class="link" href="http://www.apsfilter.org" target="_top">http://www.apsfilter.org</a> for
	  more details.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-queues"></a>9.5.4. Multiple Queues</h3></div></div></div><p>The entries in <code class="filename">/etc/printcap</code> are
	really definitions of <span class="emphasis"><em>queues</em></span>.  There can
	be more than one queue for a single printer.  When combined
	with filters, multiple queues provide users more control over
	how their jobs are printed.</p><p>As an example, consider a networked <span class="trademark">PostScript</span>® laser
	printer in an office.  Most users want to print plain text,
	but a few advanced users want to be able to print <span class="trademark">PostScript</span>®
	files directly.  Two entries can be created for the same
	printer in <code class="filename">/etc/printcap</code>:</p><pre class="programlisting">textprinter:\
	:lp=9100@officelaser:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/textprinter:\
	:if=/usr/local/libexec/enscript:\
	:lf=/var/log/lpd-errs:

psprinter:\
	:lp=9100@officelaser:\
	:sh:\
	:mx#0:\
	:sd=/var/spool/lpd/psprinter:\
	:lf=/var/log/lpd-errs:</pre><p>Documents sent to <code class="literal">textprinter</code> will be
	formatted by the
	<code class="filename">/usr/local/libexec/enscript</code> filter shown
	in an earlier example.  Advanced users can print <span class="trademark">PostScript</span>®
	files on <code class="literal">psprinter</code>, where no filtering is
	done.</p><p>This multiple queue technique can be used to provide
	direct access to all kinds of printer features.  A printer
	with a duplexer could use two queues, one for ordinary
	single-sided printing, and one with a filter that sends the
	command sequence to enable double-sided printing and then
	sends the incoming file.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-monitor"></a>9.5.5. Monitoring and Controlling Printing</h3></div></div></div><p>Several utilities are available to monitor print jobs and
	check and control printer operation.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-monitor-lpq"></a>9.5.5.1. <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpq</span>(1)</span></a></h4></div></div></div><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpq</span>(1)</span></a> shows the status of a user's print
	  jobs.  Print jobs from other users are not shown.</p><p>Show the current user's pending jobs on a single
	  printer:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpq -P<em class="replaceable"><code>lp</code></em></code></strong>
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     0    (standard input)                      12792 bytes</pre><p>Show the current user's pending jobs on all
	  printers:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpq -a</code></strong>
lp:
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     1    (standard input)                      27320 bytes

laser:
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     287  (standard input)                      22443 bytes</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-monitor-lprm"></a>9.5.5.2. <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lprm</span>(1)</span></a></h4></div></div></div><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lprm</span>(1)</span></a> is used to remove print jobs.  Normal users
	  are only allowed to remove their own jobs.
	  <code class="systemitem">root</code> can remove
	  any or all jobs.</p><p>Remove all pending jobs from a printer:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lprm -P<em class="replaceable"><code>lp</code></em> -</code></strong>
dfA002smithy dequeued
cfA002smithy dequeued
dfA003smithy dequeued
cfA003smithy dequeued
dfA004smithy dequeued
cfA004smithy dequeued</pre><p>Remove a single job from a
	  printer.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpq</span>(1)</span></a> is used to find the job number.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpq</code></strong>
Rank   Owner      Job  Files                                 Total Size
1st    jsmith     5    (standard input)                      12188 bytes
<code class="prompt">%</code> <strong class="userinput"><code>lprm -P<em class="replaceable"><code>lp</code></em> <em class="replaceable"><code>5</code></em></code></strong>
dfA005smithy dequeued
cfA005smithy dequeued</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-monitor-lpc"></a>9.5.5.3. <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpc</span>(8)</span></a></h4></div></div></div><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpc</span>(8)</span></a> is used to check and modify printer status.
	  <code class="literal">lpc</code> is followed by a command and an
	  optional printer name.  <code class="literal">all</code> can be used
	  instead of a specific printer name, and the command will be
	  applied to all printers.  Normal users can view status with
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpc</span>(8)</span></a>.  Only
	  <code class="systemitem">root</code> can use
	  commands which modify printer status.</p><p>Show the status of all printers:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpc status all</code></strong>
lp:
	queuing is enabled
	printing is enabled
	1 entry in spool area
	printer idle
laser:
	queuing is enabled
	printing is enabled
	1 entry in spool area
	waiting for laser to come up</pre><p>Prevent a printer from accepting new jobs, then begin
	  accepting new jobs again:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lpc disable <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	queuing disabled
<code class="prompt">#</code> <strong class="userinput"><code>lpc enable <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	queuing enabled</pre><p>Stop printing, but continue to accept new jobs.  Then
	  begin printing again:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lpc stop <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	printing disabled
<code class="prompt">#</code> <strong class="userinput"><code>lpc start <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	printing enabled
	daemon started</pre><p>Restart a printer after some error condition:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lpc restart <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	no daemon to abort
	printing enabled
	daemon restarted</pre><p>Turn the print queue off and disable printing, with a
	  message to explain the problem to users:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lpc down <em class="replaceable"><code>lp</code></em> Repair parts will arrive on Monday</code></strong>
lp:
	printer and queuing disabled
	status message is now: Repair parts will arrive on Monday</pre><p>Re-enable a printer that is down:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lpc up <em class="replaceable"><code>lp</code></em></code></strong>
lp:
	printing enabled
	daemon started</pre><p>See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpc</span>(8)</span></a> for more commands and options.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-shared"></a>9.5.6. Shared Printers</h3></div></div></div><p>Printers are often shared by multiple users in businesses
	and schools.  Additional features are provided to make sharing
	printers more convenient.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-shared-aliases"></a>9.5.6.1. Aliases</h4></div></div></div><p>The printer name is set in the first line of the
	  entry in <code class="filename">/etc/printcap</code>.  Additional
	  names, or <span class="emphasis"><em>aliases</em></span>, can be added after
	  that name.  Aliases are separated from the name and each
	  other by vertical bars:</p><pre class="programlisting">lp|<em class="replaceable"><code>repairsprinter</code></em>|<em class="replaceable"><code>salesprinter</code></em>:\</pre><p>Aliases can be used in place of the printer name.  For
	  example, users in the Sales department print to their
	  printer with</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr -P<em class="replaceable"><code>salesprinter</code></em> <em class="replaceable"><code>sales-report.txt</code></em></code></strong></pre><p>Users in the Repairs department print to
	  <span class="emphasis"><em>their</em></span> printer with</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr -P<em class="replaceable"><code>repairsprinter</code></em> <em class="replaceable"><code>repairs-report.txt</code></em></code></strong></pre><p>All of the documents print on that single printer.  When
	  the Sales department grows enough to need their own printer,
	  the alias can be removed from the shared printer entry and
	  used as the name of a new printer.  Users in both
	  departments continue to use the same commands, but the Sales
	  documents are sent to the new printer.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-shared-headers"></a>9.5.6.2. Header Pages</h4></div></div></div><p>It can be difficult for users to locate their documents
	  in the stack of pages produced by a busy shared printer.
	  <span class="emphasis"><em>Header pages</em></span> were created to solve this
	  problem.  A header page with the user name and document name
	  is printed before each print job.  These pages are also
	  sometimes called <span class="emphasis"><em>banner</em></span> or
	  <span class="emphasis"><em>separator</em></span> pages.</p><p>Enabling header pages differs depending on whether the
	  printer is connected directly to the computer with a
	  <acronym class="acronym">USB</acronym>, parallel, or serial cable, or
	  is connected remotely over a network.</p><p>Header pages on directly-connected printers are enabled
	  by removing the <code class="literal">:sh:\</code> (Suppress Header)
	  line from the entry in <code class="filename">/etc/printcap</code>.
	  These header pages only use line feed characters for new
	  lines.  Some printers will need the
	  <code class="filename">/usr/share/examples/printing/hpif</code>
	  filter to prevent stairstepped text.  The filter configures
	  <acronym class="acronym">PCL</acronym> printers to print both carriage
	  returns and line feeds when a line feed is received.</p><p>Header pages for network printers must be configured on
	  the printer itself.  Header page entries in
	  <code class="filename">/etc/printcap</code> are ignored.  Settings
	  are usually available from the printer front panel or a
	  configuration web page accessible with a web browser.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-lpd-references"></a>9.5.7. References</h3></div></div></div><p>Example files: <code class="filename">/usr/share/examples/printing/</code>.</p><p>The <span class="emphasis"><em>4.3BSD Line Printer Spooler
	  Manual</em></span>,
	<code class="filename">/usr/share/doc/smm/07.lpd/paper.ascii.gz</code>.</p><p>Manual pages: <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=printcap&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">printcap</span>(5)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a>,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpc</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lprm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lprm</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpq&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpq</span>(1)</span></a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-other"></a>9.6. Other Printing Systems</h2></div></div></div><p>Several other printing systems are available in
      addition to the built-in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a>.  These systems
      offer support for other protocols or additional features.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-other-cups"></a>9.6.1. <acronym class="acronym">CUPS</acronym> (Common <span class="trademark">UNIX</span>® Printing
	System)</h3></div></div></div><p><acronym class="acronym">CUPS</acronym> is a popular printing system
	available on many operating systems.  Using
	<acronym class="acronym">CUPS</acronym> on FreeBSD is documented in a separate
	article:<a class="link" href="../../../../doc/en_US.ISO8859-1/articles/cups" target="_top">../../../../doc/en_US.ISO8859-1/articles/cups</a></p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-other-hplip"></a>9.6.2. HPLIP</h3></div></div></div><p>Hewlett Packard provides a printing system that supports
	many of their inkjet and laser printers.  The port is
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/print/hplip/pkg-descr">print/hplip</a>.  The main web page
	is at <a class="link" href="http://hplipopensource.com/hplip-web/index.html" target="_top">http://hplipopensource.com/hplip-web/index.html</a>.
	The port handles all the installation details on FreeBSD.
	Configuration information is shown at <a class="link" href="http://hplipopensource.com/hplip-web/install/manual/hp_setup.html" target="_top">http://hplipopensource.com/hplip-web/install/manual/hp_setup.html</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-other-lprng"></a>9.6.3. LPRng</h3></div></div></div><p><span class="application">LPRng</span> was developed as an
	enhanced alternative to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a>.  The port is
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/LPRng/pkg-descr">sysutils/LPRng</a>.  For details
	and documentation, see
	<a class="link" href="http://www.lprng.com/" target="_top">http://www.lprng.com/</a>.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu"></a>Chapter 10. <span class="trademark">Linux</span>® Binary Compatibility</h2></div><div><span class="authorgroup">Restructured and parts updated by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jim</span> <span class="surname">Mock</span></span>. </span></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Brian N.</span> <span class="surname">Handy</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Rich</span> <span class="surname">Murphey</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#linuxemu-synopsis">10.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#linuxemu-lbc-install">10.2. Configuring <span class="trademark">Linux</span>® Binary Compatibility</a></span></dt><dt><span class="sect1"><a href="#linuxemu-advanced">10.3. Advanced Topics</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-synopsis"></a>10.1. Synopsis</h2></div></div></div><a id="idp54547320" class="indexterm"></a><a id="idp54548088" class="indexterm"></a><p>FreeBSD provides binary compatibility with <span class="trademark">Linux</span>®,
      allowing users to install and run most <span class="trademark">Linux</span>® binaries
      on a FreeBSD system without having to first modify the binary.  It
      has even been reported that, in some situations, <span class="trademark">Linux</span>®
      binaries perform better on FreeBSD than they do on <span class="trademark">Linux</span>®.</p><p>However, some <span class="trademark">Linux</span>®-specific operating system features
      are not supported under FreeBSD.  For example, <span class="trademark">Linux</span>® binaries
      will not work on FreeBSD if they overly use <span class="trademark">i386</span>&#8482; specific calls,
      such as enabling virtual 8086 mode.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Support for 64-bit binary compatibility with <span class="trademark">Linux</span>® was
	added in FreeBSD 10.3.</p></div><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to enable <span class="trademark">Linux</span>® binary compatibility on a FreeBSD
	  system.</p></li><li class="listitem"><p>How to install additional <span class="trademark">Linux</span>® shared
	  libraries.</p></li><li class="listitem"><p>How to install <span class="trademark">Linux</span>® applications on a FreeBSD
	  system.</p></li><li class="listitem"><p>The implementation details of <span class="trademark">Linux</span>® compatibility in
	  FreeBSD.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Know how to install <a class="link" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">additional
	    third-party software</a>.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-lbc-install"></a>10.2. Configuring <span class="trademark">Linux</span>® Binary Compatibility</h2></div></div></div><a id="idp54564088" class="indexterm"></a><p>By default, <span class="trademark">Linux</span>® libraries are not installed and <span class="trademark">Linux</span>®
      binary compatibility is not enabled.  <span class="trademark">Linux</span>® libraries can
      either be installed manually or from the FreeBSD Ports
      Collection.</p><p>Before attempting to build the port, load the <span class="trademark">Linux</span>® kernel
      module, otherwise the build will fail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload linux</code></strong></pre><p>For 64-bit compatibility:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload linux64</code></strong></pre><p>To verify that the module is loaded:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kldstat</code></strong>
      Id Refs Address    Size     Name
      1    2 0xc0100000 16bdb8   kernel
      7    1 0xc24db000 d000     linux.ko</pre><p>The <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/linux_base-c7/pkg-descr">emulators/linux_base-c7</a> package or
      port is the easiest way to install a base set of <span class="trademark">Linux</span>®
      libraries and binaries on a FreeBSD system.  To install the
      port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install emulators/linux_base-c7</code></strong></pre><p>For <span class="trademark">Linux</span>® compatibility to be enabled at boot time,
      add this line to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">linux_enable="YES"</pre><p>On 64-bit machines, <code class="filename">/etc/rc.d/abi</code> will
      automatically load the module for 64-bit emulation.</p><a id="idp54579832" class="indexterm"></a><p>Since the <span class="trademark">Linux</span>® binary compatibility layer has gained
      support for running both 32- and 64-bit <span class="trademark">Linux</span>® binaries (on
      64-bit x86 hosts), it is no longer possible to link the
      emulation functionality statically into a custom kernel.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu-libs-manually"></a>10.2.1. Installing Additional Libraries Manually</h3></div></div></div><a id="idp54595448" class="indexterm"></a><p>If a <span class="trademark">Linux</span>® application complains about missing shared
	libraries after configuring <span class="trademark">Linux</span>® binary compatibility,
	determine which shared libraries the <span class="trademark">Linux</span>® binary needs and
	install them manually.</p><p>From a <span class="trademark">Linux</span>® system, <code class="command">ldd</code> can be used
	to determine which shared libraries the application needs.
	For example, to check which shared libraries
	<code class="command">linuxdoom</code> needs, run this command from a
	<span class="trademark">Linux</span>® system that has <span class="application">Doom</span>
	installed:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ldd linuxdoom</code></strong>
libXt.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libXt.so.3.1.0
libX11.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libX11.so.3.1.0
libc.so.4 (DLL Jump 4.5pl26) =&gt; /lib/libc.so.4.6.29</pre><a id="idp54601848" class="indexterm"></a><p>Then, copy all the files in the last column of the output
	from the <span class="trademark">Linux</span>® system into
	<code class="filename">/compat/linux</code> on the FreeBSD system.  Once
	copied, create symbolic links to the names in the first
	column.  This example will result in the following files on
	the FreeBSD system:</p><pre class="screen">/compat/linux/usr/X11/lib/libXt.so.3.1.0
/compat/linux/usr/X11/lib/libXt.so.3 -&gt; libXt.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3 -&gt; libX11.so.3.1.0
/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre><p>If a <span class="trademark">Linux</span>® shared library already exists with a
	matching major revision number to the first column of the
	<code class="command">ldd</code> output, it does not need to be copied
	to the file named in the last column, as the existing library
	should work.  It is advisable to copy the shared library if it
	is a newer version, though.  The old one can be removed, as
	long as the symbolic link points to the new one.</p><p>For example, these libraries already exist on the FreeBSD
	system:</p><pre class="screen">/compat/linux/lib/libc.so.4.6.27
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.27</pre><p>and <code class="command">ldd</code> indicates that a binary
	requires a later version:</p><pre class="screen">libc.so.4 (DLL Jump 4.5pl26) -&gt; libc.so.4.6.29</pre><p>Since the existing library is only one or two versions out
	of date in the last digit, the program should still work with
	the slightly older version.  However, it is safe to replace
	the existing <code class="filename">libc.so</code> with the newer
	version:</p><pre class="screen">/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre><p>Generally, one will need to look for the shared libraries
	that <span class="trademark">Linux</span>® binaries depend on only the first few times that
	a <span class="trademark">Linux</span>® program is installed on FreeBSD.  After a while, there
	will be a sufficient set of <span class="trademark">Linux</span>® shared libraries on the
	system to be able to run newly installed <span class="trademark">Linux</span>® binaries
	without any extra work.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp54627832"></a>10.2.2. Installing <span class="trademark">Linux</span>® <acronym class="acronym">ELF</acronym>
	Binaries</h3></div></div></div><a id="idp54629368" class="indexterm"></a><p><acronym class="acronym">ELF</acronym> binaries sometimes require an extra
	step.  When an unbranded <acronym class="acronym">ELF</acronym> binary is
	executed, it will generate an error message:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./my-linux-elf-binary</code></strong>
ELF binary type not known
Abort</pre><p>To help the FreeBSD kernel distinguish between a FreeBSD
	<acronym class="acronym">ELF</acronym> binary and a <span class="trademark">Linux</span>® binary, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>brandelf -t Linux my-linux-elf-binary</code></strong></pre><a id="idp54635512" class="indexterm"></a><p>Since the GNU toolchain places the appropriate branding
	information into <acronym class="acronym">ELF</acronym> binaries
	automatically, this step is usually not necessary.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp54637176"></a>10.2.3. Installing a <span class="trademark">Linux</span>® <acronym class="acronym">RPM</acronym> Based
	Application</h3></div></div></div><p>To install a <span class="trademark">Linux</span>® <acronym class="acronym">RPM</acronym>-based
	application, first install the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/archivers/rpm4/pkg-descr">archivers/rpm4</a> package or port.  Once
	installed, <code class="systemitem">root</code> can
	use this command to install a
	<code class="filename">.rpm</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /compat/linux</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rpm2cpio &lt; /path/to/linux.archive.rpm | cpio -id</code></strong></pre><p>If necessary, <code class="command">brandelf</code> the installed
	<acronym class="acronym">ELF</acronym> binaries.  Note that this will prevent
	a clean uninstall.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp54652536"></a>10.2.4. Configuring the Hostname Resolver</h3></div></div></div><p>If <acronym class="acronym">DNS</acronym> does not work or this error
	appears:</p><pre class="screen">resolv+: "bind" is an invalid keyword resolv+:
"hosts" is an invalid keyword</pre><p>configure <code class="filename">/compat/linux/etc/host.conf</code>
	as follows:</p><pre class="programlisting">order hosts, bind
multi on</pre><p>This specifies that <code class="filename">/etc/hosts</code> is
	searched first and <acronym class="acronym">DNS</acronym> is searched second.
	When <code class="filename">/compat/linux/etc/host.conf</code> does not
	exist, <span class="trademark">Linux</span>® applications use
	<code class="filename">/etc/host.conf</code> and complain about the
	incompatible FreeBSD syntax.  Remove <code class="literal">bind</code> if a
	name server is not configured using
	<code class="filename">/etc/resolv.conf</code>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-advanced"></a>10.3. Advanced Topics</h2></div></div></div><p>This section describes how <span class="trademark">Linux</span>® binary compatibility
      works and is based on an email written to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">FreeBSD chat mailing list</a> by
      Terry Lambert <code class="email">&lt;<a xmlns="" class="email" href="mailto:tlambert@primenet.com">tlambert@primenet.com</a>&gt;</code> (Message ID:
      <code class="literal">&lt;199906020108.SAA07001@usr09.primenet.com&gt;</code>).</p><a id="idp54936568" class="indexterm"></a><p>FreeBSD has an abstraction called an
      <span class="quote">&#8220;<span class="quote">execution class loader</span>&#8221;</span>.  This is a wedge into the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> system call.</p><p>Historically, the <span class="trademark">UNIX</span>® loader examined the magic number
      (generally the first 4 or 8 bytes of the file) to see if it was
      a binary known to the system, and if so, invoked the binary
      loader.</p><p>If it was not the binary type for the system, the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> call returned a failure, and the shell
      attempted to start executing it as shell commands.  The
      assumption was a default of
      <span class="quote">&#8220;<span class="quote">whatever the current shell is</span>&#8221;</span>.</p><p>Later, a hack was made for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> to examine the first
      two characters, and if they were <code class="literal">:\n</code>, it
      invoked the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a> shell instead.</p><p>FreeBSD has a list of loaders, instead of a single loader, with
      a fallback to the <code class="literal">#!</code> loader for running shell
      interpreters or shell scripts.</p><a id="idp54956408" class="indexterm"></a><a id="idp54957176" class="indexterm"></a><p>For the <span class="trademark">Linux</span>® <acronym class="acronym">ABI</acronym> support, FreeBSD sees
      the magic number as an ELF binary.  The ELF loader looks for a
      specialized <span class="emphasis"><em>brand</em></span>, which is a comment
      section in the ELF image, and which is not present on
      SVR4/<span class="trademark">Solaris</span>&#8482; ELF binaries.</p><p>For <span class="trademark">Linux</span>® binaries to function, they must be
      <span class="emphasis"><em>branded</em></span> as type <code class="literal">Linux</code>
      using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>brandelf -t Linux file</code></strong></pre><a id="idp54963320" class="indexterm"></a><p>When the ELF loader sees the <code class="literal">Linux</code>
      brand, the loader replaces a pointer in the
      <code class="literal">proc</code> structure.  All system calls are indexed
      through this pointer.  In addition, the process is flagged for
      special handling of the trap vector for the signal trampoline
      code, and several other (minor) fix-ups that are handled by the
      <span class="trademark">Linux</span>® kernel module.</p><p>The <span class="trademark">Linux</span>® system call vector contains, among other things,
      a list of <code class="literal">sysent[]</code> entries whose addresses
      reside in the kernel module.</p><p>When a system call is called by the <span class="trademark">Linux</span>® binary, the trap
      code dereferences the system call function pointer off the
      <code class="literal">proc</code> structure, and gets the <span class="trademark">Linux</span>®, not the
      FreeBSD, system call entry points.</p><p><span class="trademark">Linux</span>® mode dynamically <span class="emphasis"><em>reroots</em></span>
      lookups.  This is, in effect, equivalent to
      <code class="option">union</code> to file system mounts.  First, an
      attempt is made to lookup the file in
      <code class="filename">/compat/linux/<em class="replaceable"><code>original-path</code></em></code>.
      If that fails, the lookup is done in
      <code class="filename">/<em class="replaceable"><code>original-path</code></em></code>.
      This makes sure that binaries that require other binaries can
      run.  For example, the <span class="trademark">Linux</span>® toolchain can all run under
      <span class="trademark">Linux</span>® <acronym class="acronym">ABI</acronym> support.  It also means that the
      <span class="trademark">Linux</span>® binaries can load and execute FreeBSD binaries, if there
      are no corresponding <span class="trademark">Linux</span>® binaries present, and that a
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a> command can be placed in the
      <code class="filename">/compat/linux</code> directory tree to ensure that
      the <span class="trademark">Linux</span>® binaries cannot tell they are not running on
      <span class="trademark">Linux</span>®.</p><p>In effect, there is a <span class="trademark">Linux</span>® kernel in the FreeBSD kernel.
      The various underlying functions that implement all of the
      services provided by the kernel are identical to both the FreeBSD
      system call table entries, and the <span class="trademark">Linux</span>® system call table
      entries: file system operations, virtual memory operations,
      signal delivery, and System V IPC.  The only difference is that
      FreeBSD binaries get the FreeBSD <span class="emphasis"><em>glue</em></span> functions,
      and <span class="trademark">Linux</span>® binaries get the <span class="trademark">Linux</span>® <span class="emphasis"><em>glue</em></span>
      functions.  The FreeBSD <span class="emphasis"><em>glue</em></span> functions are
      statically linked into the kernel, and the <span class="trademark">Linux</span>®
      <span class="emphasis"><em>glue</em></span> functions can be statically linked, or
      they can be accessed via a kernel module.</p><p>Technically, this is not really emulation, it is an
      <acronym class="acronym">ABI</acronym> implementation.  It is sometimes called
      <span class="quote">&#8220;<span class="quote"><span class="trademark">Linux</span>® emulation</span>&#8221;</span> because the implementation was
      done at a time when there was no other word to describe what was
      going on.  Saying that FreeBSD ran <span class="trademark">Linux</span>® binaries was not true,
      since the code was not compiled in.</p></div></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="system-administration"></a>Part III. System Administration</h1></div></div></div><div class="partintro"><div xmlns=""></div><p>The remaining chapters cover all aspects of FreeBSD system
	administration.  Each chapter starts by describing what will
	be learned as a result of reading the chapter, and also
	details what the reader is expected to know before tackling
	the material.</p><p>These chapters are designed to be read as the information
	is needed.  They do not need to be read in any particular
	order, nor must all of them be read before beginning to use
	FreeBSD.</p><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="chapter"><a href="#config-tuning">11. Configuration and Tuning</a></span></dt><dd><dl><dt><span class="sect1"><a href="#config-synopsis">11.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#configtuning-starting-services">11.2. Starting Services</a></span></dt><dt><span class="sect1"><a href="#configtuning-cron">11.3. Configuring cron(8)</a></span></dt><dt><span class="sect1"><a href="#configtuning-rcd">11.4. Managing Services in FreeBSD</a></span></dt><dt><span class="sect1"><a href="#config-network-setup">11.5. Setting Up Network Interface Cards</a></span></dt><dt><span class="sect1"><a href="#configtuning-virtual-hosts">11.6. Virtual Hosts</a></span></dt><dt><span class="sect1"><a href="#configtuning-syslog">11.7. Configuring System Logging</a></span></dt><dt><span class="sect1"><a href="#configtuning-configfiles">11.8. Configuration Files</a></span></dt><dt><span class="sect1"><a href="#configtuning-sysctl">11.9. Tuning with sysctl(8)</a></span></dt><dt><span class="sect1"><a href="#configtuning-disk">11.10. Tuning Disks</a></span></dt><dt><span class="sect1"><a href="#configtuning-kernel-limits">11.11. Tuning Kernel Limits</a></span></dt><dt><span class="sect1"><a href="#adding-swap-space">11.12. Adding Swap Space</a></span></dt><dt><span class="sect1"><a href="#acpi-overview">11.13. Power and Resource Management</a></span></dt></dl></dd><dt><span class="chapter"><a href="#boot">12. The FreeBSD Booting Process</a></span></dt><dd><dl><dt><span class="sect1"><a href="#boot-synopsis">12.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#boot-introduction">12.2. FreeBSD Boot Process</a></span></dt><dt><span class="sect1"><a href="#boot-splash">12.3. Configuring Boot Time Splash Screens</a></span></dt><dt><span class="sect1"><a href="#device-hints">12.4. Device Hints</a></span></dt><dt><span class="sect1"><a href="#boot-shutdown">12.5. Shutdown Sequence</a></span></dt></dl></dd><dt><span class="chapter"><a href="#security">13. Security</a></span></dt><dd><dl><dt><span class="sect1"><a href="#security-synopsis">13.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#security-intro">13.2. Introduction</a></span></dt><dt><span class="sect1"><a href="#one-time-passwords">13.3. One-time Passwords</a></span></dt><dt><span class="sect1"><a href="#tcpwrappers">13.4. TCP Wrapper</a></span></dt><dt><span class="sect1"><a href="#kerberos5">13.5. <span class="application">Kerberos</span></a></span></dt><dt><span class="sect1"><a href="#openssl">13.6. OpenSSL</a></span></dt><dt><span class="sect1"><a href="#ipsec">13.7. <acronym class="acronym">VPN</acronym> over
	<acronym class="acronym">IPsec</acronym></a></span></dt><dt><span class="sect1"><a href="#openssh">13.8. OpenSSH</a></span></dt><dt><span class="sect1"><a href="#fs-acl">13.9. Access Control Lists</a></span></dt><dt><span class="sect1"><a href="#security-pkg">13.10. Monitoring Third Party Security Issues</a></span></dt><dt><span class="sect1"><a href="#security-advisories">13.11. FreeBSD Security Advisories</a></span></dt><dt><span class="sect1"><a href="#security-accounting">13.12. Process Accounting</a></span></dt><dt><span class="sect1"><a href="#security-resourcelimits">13.13. Resource Limits</a></span></dt><dt><span class="sect1"><a href="#security-sudo">13.14. Shared Administration with Sudo</a></span></dt></dl></dd><dt><span class="chapter"><a href="#jails">14. Jails</a></span></dt><dd><dl><dt><span class="sect1"><a href="#jails-synopsis">14.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#jails-terms">14.2. Terms Related to Jails</a></span></dt><dt><span class="sect1"><a href="#jails-build">14.3. Creating and Controlling Jails</a></span></dt><dt><span class="sect1"><a href="#jails-tuning">14.4. Fine Tuning and Administration</a></span></dt><dt><span class="sect1"><a href="#jails-application">14.5. Updating Multiple Jails</a></span></dt><dt><span class="sect1"><a href="#jails-ezjail">14.6. Managing Jails with
	<span class="application">ezjail</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#mac">15. Mandatory Access Control</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mac-synopsis">15.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#mac-inline-glossary">15.2. Key Terms</a></span></dt><dt><span class="sect1"><a href="#mac-understandlabel">15.3. Understanding MAC Labels</a></span></dt><dt><span class="sect1"><a href="#mac-planning">15.4. Planning the Security Configuration</a></span></dt><dt><span class="sect1"><a href="#mac-policies">15.5. Available MAC Policies</a></span></dt><dt><span class="sect1"><a href="#mac-userlocked">15.6. User Lock Down</a></span></dt><dt><span class="sect1"><a href="#mac-implementing">15.7. Nagios in a MAC Jail</a></span></dt><dt><span class="sect1"><a href="#mac-troubleshoot">15.8. Troubleshooting the MAC Framework</a></span></dt></dl></dd><dt><span class="chapter"><a href="#audit">16. Security Event Auditing</a></span></dt><dd><dl><dt><span class="sect1"><a href="#audit-synopsis">16.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#audit-inline-glossary">16.2. Key Terms</a></span></dt><dt><span class="sect1"><a href="#audit-config">16.3. Audit Configuration</a></span></dt><dt><span class="sect1"><a href="#audit-administration">16.4. Working with Audit Trails</a></span></dt></dl></dd><dt><span class="chapter"><a href="#disks">17. Storage</a></span></dt><dd><dl><dt><span class="sect1"><a href="#disks-synopsis">17.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#disks-adding">17.2. Adding Disks</a></span></dt><dt><span class="sect1"><a href="#disks-growing">17.3. Resizing and Growing Disks</a></span></dt><dt><span class="sect1"><a href="#usb-disks">17.4. <acronym class="acronym">USB</acronym> Storage Devices</a></span></dt><dt><span class="sect1"><a href="#creating-cds">17.5. Creating and Using <acronym class="acronym">CD</acronym> Media</a></span></dt><dt><span class="sect1"><a href="#creating-dvds">17.6. Creating and Using <acronym class="acronym">DVD</acronym> Media</a></span></dt><dt><span class="sect1"><a href="#floppies">17.7. Creating and Using Floppy Disks</a></span></dt><dt><span class="sect1"><a href="#backup-basics">17.8. Backup Basics</a></span></dt><dt><span class="sect1"><a href="#disks-virtual">17.9. Memory Disks</a></span></dt><dt><span class="sect1"><a href="#snapshots">17.10. File System Snapshots</a></span></dt><dt><span class="sect1"><a href="#quotas">17.11. Disk Quotas</a></span></dt><dt><span class="sect1"><a href="#disks-encrypting">17.12. Encrypting Disk Partitions</a></span></dt><dt><span class="sect1"><a href="#swap-encrypting">17.13. Encrypting Swap</a></span></dt><dt><span class="sect1"><a href="#disks-hast">17.14. Highly Available Storage
	(<acronym class="acronym">HAST</acronym>)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#geom">18. GEOM: Modular Disk Transformation Framework</a></span></dt><dd><dl><dt><span class="sect1"><a href="#geom-synopsis">18.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#geom-striping">18.2. RAID0 - Striping</a></span></dt><dt><span class="sect1"><a href="#geom-mirror">18.3. RAID1 - Mirroring</a></span></dt><dt><span class="sect1"><a href="#geom-raid3">18.4. <acronym class="acronym">RAID</acronym>3 - Byte-level Striping with
	Dedicated Parity</a></span></dt><dt><span class="sect1"><a href="#geom-graid">18.5. Software <acronym class="acronym">RAID</acronym> Devices</a></span></dt><dt><span class="sect1"><a href="#geom-ggate">18.6. <acronym class="acronym">GEOM</acronym> Gate Network</a></span></dt><dt><span class="sect1"><a href="#geom-glabel">18.7. Labeling Disk Devices</a></span></dt><dt><span class="sect1"><a href="#geom-gjournal">18.8. UFS Journaling Through <acronym class="acronym">GEOM</acronym></a></span></dt></dl></dd><dt><span class="chapter"><a href="#zfs">19. The Z File System (<acronym class="acronym">ZFS</acronym>)</a></span></dt><dd><dl><dt><span class="sect1"><a href="#zfs-differences">19.1. What Makes <acronym class="acronym">ZFS</acronym> Different</a></span></dt><dt><span class="sect1"><a href="#zfs-quickstart">19.2. Quick Start Guide</a></span></dt><dt><span class="sect1"><a href="#zfs-zpool">19.3. <code class="command">zpool</code> Administration</a></span></dt><dt><span class="sect1"><a href="#zfs-zfs">19.4. <code class="command">zfs</code> Administration</a></span></dt><dt><span class="sect1"><a href="#zfs-zfs-allow">19.5. Delegated Administration</a></span></dt><dt><span class="sect1"><a href="#zfs-advanced">19.6. Advanced Topics</a></span></dt><dt><span class="sect1"><a href="#zfs-links">19.7. Additional Resources</a></span></dt><dt><span class="sect1"><a href="#zfs-term">19.8. <acronym class="acronym">ZFS</acronym> Features and Terminology</a></span></dt></dl></dd><dt><span class="chapter"><a href="#filesystems">20. Other File Systems</a></span></dt><dd><dl><dt><span class="sect1"><a href="#filesystems-synopsis">20.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#filesystems-linux">20.2. <span class="trademark">Linux</span>® File Systems</a></span></dt></dl></dd><dt><span class="chapter"><a href="#virtualization">21. Virtualization</a></span></dt><dd><dl><dt><span class="sect1"><a href="#virtualization-synopsis">21.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-parallels">21.2. FreeBSD as a Guest on <span class="application">Parallels</span> for
      <span class="trademark">Mac OS</span>® X</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-virtualpc">21.3. FreeBSD as a Guest on <span class="application">Virtual PC</span>
      for <span class="trademark">Windows</span>®</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-vmware">21.4. FreeBSD as a Guest on <span class="application">VMware Fusion</span>
      for <span class="trademark">Mac OS</span>®</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-virtualbox">21.5. FreeBSD as a Guest on <span class="trademark">VirtualBox</span>&#8482;</a></span></dt><dt><span class="sect1"><a href="#virtualization-host-virtualbox">21.6. FreeBSD as a Host with <span class="trademark">VirtualBox</span>&#8482;</a></span></dt><dt><span class="sect1"><a href="#virtualization-host-bhyve">21.7. FreeBSD as a Host with
      <span class="application">bhyve</span></a></span></dt><dt><span class="sect1"><a href="#virtualization-host-xen">21.8. FreeBSD as a <span class="trademark">Xen</span>&#8482;-Host</a></span></dt></dl></dd><dt><span class="chapter"><a href="#l10n">22. Localization -
      <acronym class="acronym">i18n</acronym>/<acronym class="acronym">L10n</acronym> Usage and
      Setup</a></span></dt><dd><dl><dt><span class="sect1"><a href="#l10n-synopsis">22.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#using-localization">22.2. Using Localization</a></span></dt><dt><span class="sect1"><a href="#l10n-compiling">22.3. Finding <acronym class="acronym">i18n</acronym> Applications</a></span></dt><dt><span class="sect1"><a href="#lang-setup">22.4. Locale Configuration for Specific Languages</a></span></dt></dl></dd><dt><span class="chapter"><a href="#updating-upgrading">23. Updating and Upgrading FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#updating-upgrading-synopsis">23.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#updating-upgrading-freebsdupdate">23.2. FreeBSD Update</a></span></dt><dt><span class="sect1"><a href="#updating-upgrading-documentation">23.3. Updating the Documentation Set</a></span></dt><dt><span class="sect1"><a href="#current-stable">23.4. Tracking a Development Branch</a></span></dt><dt><span class="sect1"><a href="#makeworld">23.5. Updating FreeBSD from Source</a></span></dt><dt><span class="sect1"><a href="#small-lan">23.6. Tracking for Multiple Machines</a></span></dt></dl></dd><dt><span class="chapter"><a href="#dtrace">24. DTrace</a></span></dt><dd><dl><dt><span class="sect1"><a href="#dtrace-synopsis">24.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#dtrace-implementation">24.2. Implementation Differences</a></span></dt><dt><span class="sect1"><a href="#dtrace-enable">24.3. Enabling DTrace Support</a></span></dt><dt><span class="sect1"><a href="#dtrace-using">24.4. Using DTrace</a></span></dt></dl></dd><dt><span class="chapter"><a href="#usb-device-mode">25. USB Device Mode / USB OTG</a></span></dt><dd><dl><dt><span class="sect1"><a href="#usb-device-mode-synopsis">25.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-terminals">25.2. <acronym class="acronym">USB</acronym> Virtual Serial Ports</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-network">25.3. <acronym class="acronym">USB</acronym> Device Mode Network
      Interfaces</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-storage">25.4. <acronym class="acronym">USB</acronym> Virtual Storage Device</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="config-tuning"></a>Chapter 11. Configuration and Tuning</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div><div><span class="authorgroup">Based on a tutorial written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mike</span> <span class="surname">Smith</span></span>. </span></div><div><span class="authorgroup">Also based on tuning(7) written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Matt</span> <span class="surname">Dillon</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#config-synopsis">11.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#configtuning-starting-services">11.2. Starting Services</a></span></dt><dt><span class="sect1"><a href="#configtuning-cron">11.3. Configuring cron(8)</a></span></dt><dt><span class="sect1"><a href="#configtuning-rcd">11.4. Managing Services in FreeBSD</a></span></dt><dt><span class="sect1"><a href="#config-network-setup">11.5. Setting Up Network Interface Cards</a></span></dt><dt><span class="sect1"><a href="#configtuning-virtual-hosts">11.6. Virtual Hosts</a></span></dt><dt><span class="sect1"><a href="#configtuning-syslog">11.7. Configuring System Logging</a></span></dt><dt><span class="sect1"><a href="#configtuning-configfiles">11.8. Configuration Files</a></span></dt><dt><span class="sect1"><a href="#configtuning-sysctl">11.9. Tuning with sysctl(8)</a></span></dt><dt><span class="sect1"><a href="#configtuning-disk">11.10. Tuning Disks</a></span></dt><dt><span class="sect1"><a href="#configtuning-kernel-limits">11.11. Tuning Kernel Limits</a></span></dt><dt><span class="sect1"><a href="#adding-swap-space">11.12. Adding Swap Space</a></span></dt><dt><span class="sect1"><a href="#acpi-overview">11.13. Power and Resource Management</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="config-synopsis"></a>11.1. Synopsis</h2></div></div></div><a id="idp54998776" class="indexterm"></a><a id="idp54999544" class="indexterm"></a><p>One of the important aspects of FreeBSD is proper system
      configuration.  This chapter explains much of the FreeBSD
      configuration process, including some of the parameters which
      can be set to tune a FreeBSD system.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The basics of <code class="filename">rc.conf</code> configuration
	  and <code class="filename">/usr/local/etc/rc.d</code> startup
	  scripts.</p></li><li class="listitem"><p>How to configure and test a network card.</p></li><li class="listitem"><p>How to configure virtual hosts on network
	  devices.</p></li><li class="listitem"><p>How to use the various configuration files in
	  <code class="filename">/etc</code>.</p></li><li class="listitem"><p>How to tune FreeBSD using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variables.</p></li><li class="listitem"><p>How to tune disk performance and modify kernel
	  limitations.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand <span class="trademark">UNIX</span>® and FreeBSD basics
	  (<a class="xref" href="#basics" title="Chapter 3. FreeBSD Basics">Chapter 3, <em>FreeBSD Basics</em></a>).</p></li><li class="listitem"><p>Be familiar with the basics of kernel configuration and
	  compilation (<a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>).</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-starting-services"></a>11.2. Starting Services</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp55023352" class="indexterm"></a><p>Many users install third party software on FreeBSD from the
      Ports Collection and require the installed services to be
      started upon system initialization.  Services, such as
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/postfix/pkg-descr">mail/postfix</a> or
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/apache22/pkg-descr">www/apache22</a> are just two of the many
      software packages which may be started during system
      initialization.  This section explains the procedures available
      for starting third party software.</p><p>In FreeBSD, most included services, such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>, are
      started through the system startup scripts.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55026424"></a>11.2.1. Extended Application Configuration</h3></div></div></div><p>Now that FreeBSD includes <code class="filename">rc.d</code>,
	configuration of application startup is easier and provides
	more features.  Using the key words discussed in
	<a class="xref" href="#configtuning-rcd" title="11.4. Managing Services in FreeBSD">Section 11.4, &#8220;Managing Services in FreeBSD&#8221;</a>, applications can be set to
	start after certain other services and extra flags can be
	passed through <code class="filename">/etc/rc.conf</code> in place of
	hard coded flags in the startup script.  A basic script may
	look similar to the following:</p><pre class="programlisting">#!/bin/sh
#
# PROVIDE: utility
# REQUIRE: DAEMON
# KEYWORD: shutdown

. /etc/rc.subr

name=utility
rcvar=utility_enable

command="/usr/local/sbin/utility"

load_rc_config $name

#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
# SET THEM IN THE /etc/rc.conf FILE
#
utility_enable=${utility_enable-"NO"}
pidfile=${utility_pidfile-"/var/run/utility.pid"}

run_rc_command "$1"</pre><p>This script will ensure that the provided
	<code class="literal">utility</code> will be started after the
	<code class="literal">DAEMON</code> pseudo-service.  It also provides a
	method for setting and tracking the process ID
	(<acronym class="acronym">PID</acronym>).</p><p>This application could then have the following line placed
	in <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">utility_enable="YES"</pre><p>This method allows for easier manipulation of command
	line arguments, inclusion of the default functions provided
	in <code class="filename">/etc/rc.subr</code>, compatibility with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rcorder</span>(8)</span></a>, and provides for easier configuration via
	<code class="filename">rc.conf</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55054456"></a>11.2.2. Using Services to Start Services</h3></div></div></div><p>Other services can be started using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>.
	Working with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> and its configuration is
	described in depth in
	<a class="xref" href="#network-inetd" title="29.2. The inetd Super-Server">Section 29.2, &#8220;The <span class="application">inetd</span>
      Super-Server&#8221;</a>.</p><p>In some cases, it may make more sense to use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> to start system services.  This approach
	has a number of advantages as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> runs these
	processes as the owner of the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crontab</span>(5)</span></a>.  This allows
	regular users to start and maintain their own
	applications.</p><p>The <code class="literal">@reboot</code> feature of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>,
	may be used in place of the time specification.  This causes
	the job to run when <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> is started, normally during
	system initialization.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-cron"></a>11.3. Configuring <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a></h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp55079032" class="indexterm"></a><p>One of the most useful utilities in FreeBSD is
      <span class="application">cron</span>.  This utility runs in the
      background and regularly checks
      <code class="filename">/etc/crontab</code> for tasks to execute and
      searches <code class="filename">/var/cron/tabs</code> for custom crontab
      files.  These files are used to schedule tasks which
      <span class="application">cron</span> runs at the specified times.
      Each entry in a crontab defines a task to run and is known as a
      <em class="firstterm">cron job</em>.</p><p>Two different types of configuration files are used: the
      system crontab, which should not be modified, and user crontabs,
      which can be created and edited as needed.  The format used by
      these files is documented in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crontab</span>(5)</span></a>.  The format of the
      system crontab, <code class="filename">/etc/crontab</code> includes a
      <code class="literal">who</code> column which does not exist in user
      crontabs.  In the system crontab,
      <span class="application">cron</span> runs the command as the user
      specified in this column.  In a user crontab, all commands run
      as the user who created the crontab.</p><p>User crontabs allow individual users to schedule their own
      tasks.  The <code class="systemitem">root</code> user
      can also have a user <code class="filename">crontab</code> which can be
      used to schedule tasks that do not exist in the system
      <code class="filename">crontab</code>.</p><p>Here is a sample entry from the system crontab,
      <code class="filename">/etc/crontab</code>:</p><pre class="programlisting"># /etc/crontab - root's crontab for FreeBSD
#
# <span translate="no" class="phrase">$FreeBSD$</span>
# <a id="co-comments"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin <a id="co-env"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
#
#minute	hour	mday	month	wday	who	command <a id="co-field-descr"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
#
*/5	*	*	*	*	root	/usr/libexec/atrun <a id="co-main"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-comments"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Lines that begin with the <code class="literal">#</code> character
	  are comments.  A comment can be placed in the file as a
	  reminder of what and why a desired action is performed.
	  Comments cannot be on the same line as a command or else
	  they will be interpreted as part of the command; they must
	  be on a new line.  Blank lines are ignored.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-env"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The equals (<code class="literal">=</code>) character is used to
	  define any environment settings.  In this example, it is
	  used to define the <code class="envar">SHELL</code> and
	  <code class="envar">PATH</code>.  If the <code class="envar">SHELL</code> is
	  omitted, <span class="application">cron</span> will use the
	  default Bourne shell.  If the <code class="envar">PATH</code> is
	  omitted, the full path must be given to the command or
	  script to run.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-field-descr"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This line defines the seven fields used in a system
	  crontab: <code class="literal">minute</code>, <code class="literal">hour</code>,
	  <code class="literal">mday</code>, <code class="literal">month</code>,
	  <code class="literal">wday</code>, <code class="literal">who</code>, and
	  <code class="literal">command</code>.  The <code class="literal">minute</code>
	  field is the time in minutes when the specified command will
	  be run, the <code class="literal">hour</code> is the hour when the
	  specified command will be run, the <code class="literal">mday</code>
	  is the day of the month, <code class="literal">month</code> is the
	  month, and <code class="literal">wday</code> is the day of the week.
	  These fields must be numeric values, representing the
	  twenty-four hour clock, or a <code class="literal">*</code>,
	  representing all values for that field.  The
	  <code class="literal">who</code> field only exists in the system
	  crontab and specifies which user the command should be run
	  as.  The last field is the command to be executed.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-main"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This entry defines the values for this cron job.  The
	  <code class="literal">*/5</code>, followed by several more
	  <code class="literal">*</code> characters, specifies that
	  <code class="command">/usr/libexec/atrun</code> is invoked by
	  <code class="systemitem">root</code> every five
	  minutes of every hour, of every day and day of the week, of
	  every month.</p><p>Commands can include any number of switches.  However,
	  commands which extend to multiple lines need to be broken
	  with the backslash <span class="quote">&#8220;<span class="quote">\</span>&#8221;</span> continuation
	  character.</p></td></tr></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="configtuning-installcrontab"></a>11.3.1. Creating a User Crontab</h3></div></div></div><p>To create a user crontab, invoke
	<code class="command">crontab</code> in editor mode:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>crontab -e</code></strong></pre><p>This will open the user's crontab using the default text
	editor.  The first time a user runs this command, it will open
	an empty file.  Once a user creates a crontab, this command
	will open that file for editing.</p><p>It is useful to add these lines to the top of the crontab
	file in order to set the environment variables and to remember
	the meanings of the fields in the crontab:</p><pre class="programlisting">SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin
# Order of crontab fields
# minute	hour	mday	month	wday	command</pre><p>Then add a line for each command or script to run,
	specifying the time to run the command.  This example runs the
	specified custom Bourne shell script every day at two in the
	afternoon.  Since the path to the script is not specified in
	<code class="literal">PATH</code>, the full path to the script is
	given:</p><pre class="programlisting">0	14	*	*	*	/usr/home/dru/bin/mycustomscript.sh</pre><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Before using a custom script, make sure it is executable
	  and test it with the limited set of environment variables
	  set by cron.  To replicate the environment that would be
	  used to run the above cron entry, use:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">env -i SHELL=/bin/sh PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin HOME=/home/<em class="replaceable"><code>dru</code></em> LOGNAME=<em class="replaceable"><code>dru</code></em> <em class="replaceable"><code>/usr/home/dru/bin/mycustomscript.sh</code></em></pre><p xmlns="http://www.w3.org/1999/xhtml">The environment set by cron is discussed in
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crontab</span>(5)</span></a>.  Checking that scripts operate correctly in
	  a cron environment is especially important if they include
	  any commands that delete files using wildcards.</p></div><p>When finished editing the crontab, save the file.  It
	will automatically be installed and
	<span class="application">cron</span> will read the crontab and run
	its cron jobs at their specified times.  To list the cron jobs
	in a crontab, use this command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>crontab -l</code></strong>
0	14	*	*	*	/usr/home/dru/bin/mycustomscript.sh</pre><p>To remove all of the cron jobs in a user crontab:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>crontab -r</code></strong>
remove crontab for dru? <strong class="userinput"><code>y</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-rcd"></a>11.4. Managing Services in FreeBSD</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>FreeBSD uses the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> system of startup scripts during
      system initialization and for managing services.  The scripts
      listed in <code class="filename">/etc/rc.d</code> provide basic services
      which can be controlled with the <code class="option">start</code>,
      <code class="option">stop</code>, and <code class="option">restart</code> options to
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=service&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">service</span>(8)</span></a>.  For instance, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> can be restarted
      with the following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sshd restart</code></strong></pre><p>This procedure can be used to start services on a running
      system.  Services will be started automatically at boot time
      as specified in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>.  For example, to enable
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> at system startup, add the following line to
      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">natd_enable="YES"</pre><p>If a <code class="option">natd_enable="NO"</code> line is already
      present, change the <code class="literal">NO</code> to
      <code class="literal">YES</code>.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> scripts will
      automatically load any dependent services during the next boot,
      as described below.</p><p>Since the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> system is primarily intended to start
      and stop services at system startup and shutdown time, the
      <code class="option">start</code>, <code class="option">stop</code> and
      <code class="option">restart</code> options will only perform their action
      if the appropriate <code class="filename">/etc/rc.conf</code> variable
      is set.  For instance, <code class="command">sshd restart</code> will
      only work if <code class="varname">sshd_enable</code> is set to
      <code class="option">YES</code> in <code class="filename">/etc/rc.conf</code>.
      To <code class="option">start</code>, <code class="option">stop</code> or
      <code class="option">restart</code> a service regardless of the settings
      in <code class="filename">/etc/rc.conf</code>, these commands should be
      prefixed with <span class="quote">&#8220;<span class="quote">one</span>&#8221;</span>.  For instance, to restart
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> regardless of the current
      <code class="filename">/etc/rc.conf</code> setting, execute the following
      command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sshd onerestart</code></strong></pre><p>To check if a service is enabled in
      <code class="filename">/etc/rc.conf</code>, run the appropriate
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> script with <code class="option">rcvar</code>.  This example
      checks to see if <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> is enabled in
      <code class="filename">/etc/rc.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sshd rcvar</code></strong>
# sshd
#
sshd_enable="YES"
#   (default: "")</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <code class="literal"># sshd</code> line is output from the
	above command, not a
	<code class="systemitem">root</code> console.</p></div><p>To determine whether or not a service is running, use
      <code class="option">status</code>.  For instance, to verify that
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> is running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sshd status</code></strong>
sshd is running as pid 433.</pre><p>In some cases, it is also possible to
      <code class="option">reload</code> a service.  This attempts to send a
      signal to an individual service, forcing the service to reload
      its configuration files.  In most cases, this means sending
      the service a <code class="literal">SIGHUP</code> signal.  Support for
      this feature is not included for every service.</p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> system is used for network services and it
      also contributes to most of the system initialization.  For
      instance, when the
      <code class="filename">/etc/rc.d/bgfsck</code> script is executed, it
      prints out the following message:</p><pre class="screen">Starting background file system checks in 60 seconds.</pre><p>This script is used for background file system checks,
      which occur only during system initialization.</p><p>Many system services depend on other services to function
      properly.  For example, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=yp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">yp</span>(8)</span></a> and other
      <acronym class="acronym">RPC</acronym>-based services may fail to start until
      after the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rpcbind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rpcbind</span>(8)</span></a> service has started.  To resolve this
      issue, information about dependencies and other meta-data is
      included in the comments at the top of each startup script.
      The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rcorder</span>(8)</span></a> program is used to parse these comments
      during system initialization to determine the order in which
      system services should be invoked to satisfy the
      dependencies.</p><p>The following key word must be included in all startup
      scripts as it is required by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a> to
      <span class="quote">&#8220;<span class="quote">enable</span>&#8221;</span> the startup script:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">PROVIDE</code>: Specifies the services this
	  file provides.</p></li></ul></div><p>The following key words may be included at the top of each
      startup script.  They are not strictly necessary, but are
      useful as hints to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rcorder&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rcorder</span>(8)</span></a>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">REQUIRE</code>: Lists services which are
	  required for this service.  The script containing this key
	  word will run <span class="emphasis"><em>after</em></span> the specified
	  services.</p></li><li class="listitem"><p><code class="literal">BEFORE</code>: Lists services which depend
	  on this service.  The script containing this key word will
	  run <span class="emphasis"><em>before</em></span> the specified
	  services.</p></li></ul></div><p>By carefully setting these keywords for each startup script,
      an administrator has a fine-grained level of control of the
      startup order of the scripts, without the need for
      <span class="quote">&#8220;<span class="quote">runlevels</span>&#8221;</span> used by some <span class="trademark">UNIX</span>® operating
      systems.</p><p>Additional information can be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> and
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>.  Refer to <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/rc-scripting" target="_top">this article</a>
      for instructions on how to create custom <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a>
      scripts.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="configtuning-core-configuration"></a>11.4.1. Managing System-Specific Configuration</h3></div></div></div><a id="idp55173624" class="indexterm"></a><p>The principal location for system configuration
	information is <code class="filename">/etc/rc.conf</code>.  This file
	contains a wide range of configuration information and it is
	read at system startup to configure the system.  It provides
	the configuration information for the
	<code class="filename">rc*</code> files.</p><p>The entries in <code class="filename">/etc/rc.conf</code> override
	the default settings in
	<code class="filename">/etc/defaults/rc.conf</code>.  The file
	containing the default settings should not be edited.
	Instead, all system-specific changes should be made to
	<code class="filename">/etc/rc.conf</code>.</p><p>A number of strategies may be applied in clustered
	applications to separate site-wide configuration from
	system-specific configuration in order to reduce
	administration overhead.  The recommended approach is to place
	system-specific configuration into
	<code class="filename">/etc/rc.conf.local</code>.  For example, these
	entries in <code class="filename">/etc/rc.conf</code> apply to all
	systems:</p><pre class="programlisting">sshd_enable="YES"
keyrate="fast"
defaultrouter="10.1.1.254"</pre><p>Whereas these entries in
	<code class="filename">/etc/rc.conf.local</code> apply to this system
	only:</p><pre class="programlisting">hostname="node1.example.org"
ifconfig_fxp0="inet 10.1.1.1/8"</pre><p>Distribute <code class="filename">/etc/rc.conf</code> to every
	system using an application such as
	<span class="application">rsync</span> or
	<span class="application">puppet</span>, while
	<code class="filename">/etc/rc.conf.local</code> remains
	unique.</p><p>Upgrading the system will not overwrite
	<code class="filename">/etc/rc.conf</code>, so system configuration
	information will not be lost.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Both <code class="filename">/etc/rc.conf</code> and
	  <code class="filename">/etc/rc.conf.local</code>
	  are parsed by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a>.  This allows system operators to
	  create complex configuration scenarios.  Refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> for further information on this
	  topic.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="config-network-setup"></a>11.5. Setting Up Network Interface Cards</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp54665592" class="indexterm"></a><p>Adding and configuring a network interface card
      (<acronym class="acronym">NIC</acronym>)  is a common task for any FreeBSD
      administrator.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp54667512"></a>11.5.1. Locating the Correct Driver</h3></div></div></div><a id="idp54668152" class="indexterm"></a><p>First, determine the model of the <acronym class="acronym">NIC</acronym>
	and the chip it uses.  FreeBSD supports a wide variety of
	<acronym class="acronym">NIC</acronym>s.  Check the Hardware Compatibility
	List for the FreeBSD release to see if the <acronym class="acronym">NIC</acronym>
	is supported.</p><p>If the <acronym class="acronym">NIC</acronym> is supported, determine
	the name of the FreeBSD driver for the <acronym class="acronym">NIC</acronym>.
	Refer to <code class="filename">/usr/src/sys/conf/NOTES</code> and
	<code class="filename">/usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf/NOTES</code>
	for the list of <acronym class="acronym">NIC</acronym> drivers with some
	information about the supported chipsets.  When in doubt, read
	the manual page of the driver as it will provide more
	information about the supported hardware and any known
	limitations of the driver.</p><p>The drivers for common <acronym class="acronym">NIC</acronym>s are already
	present in the <code class="filename">GENERIC</code> kernel, meaning
	the <acronym class="acronym">NIC</acronym> should be probed during boot.  The
	system's boot messages can be viewed by typing
	<code class="command">more /var/run/dmesg.boot</code> and using the
	spacebar to scroll through the text.  In this example, two
	Ethernet <acronym class="acronym">NIC</acronym>s using the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dc&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dc</span>(4)</span></a> driver
	are present on the system:</p><pre class="screen">dc0: &lt;82c169 PNIC 10/100BaseTX&gt; port 0xa000-0xa0ff mem 0xd3800000-0xd38
000ff irq 15 at device 11.0 on pci0
miibus0: &lt;MII bus&gt; on dc0
bmtphy0: &lt;BCM5201 10/100baseTX PHY&gt; PHY 1 on miibus0
bmtphy0:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc0: Ethernet address: 00:a0:cc:da:da:da
dc0: [ITHREAD]
dc1: &lt;82c169 PNIC 10/100BaseTX&gt; port 0x9800-0x98ff mem 0xd3000000-0xd30
000ff irq 11 at device 12.0 on pci0
miibus1: &lt;MII bus&gt; on dc1
bmtphy1: &lt;BCM5201 10/100baseTX PHY&gt; PHY 1 on miibus1
bmtphy1:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc1: Ethernet address: 00:a0:cc:da:da:db
dc1: [ITHREAD]</pre><p>If the driver for the <acronym class="acronym">NIC</acronym> is not
	present in <code class="filename">GENERIC</code>, but a driver is
	available, the driver will need to be loaded before the
	<acronym class="acronym">NIC</acronym> can be configured and used.  This may
	be accomplished in one of two ways:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The easiest way is to load a kernel module for the
	    <acronym class="acronym">NIC</acronym> using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.  To also
	    automatically load the driver at boot time, add the
	    appropriate line to
	    <code class="filename">/boot/loader.conf</code>.  Not all
	    <acronym class="acronym">NIC</acronym> drivers are available as
	    modules.</p></li><li class="listitem"><p>Alternatively, statically compile support for the
	    <acronym class="acronym">NIC</acronym> into a custom kernel.  Refer to
	    <code class="filename">/usr/src/sys/conf/NOTES</code>,
	    <code class="filename">/usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf/NOTES</code>
	    and the manual page of the driver to determine which line
	    to add to the custom kernel configuration file.  For more
	    information about recompiling the kernel, refer to <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>.  If the <acronym class="acronym">NIC</acronym>
	    was detected at boot, the kernel does not need to be
	    recompiled.</p></li></ul></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="config-network-ndis"></a>11.5.1.1. Using <span class="trademark">Windows</span>® <acronym class="acronym">NDIS</acronym> Drivers</h4></div></div></div><a id="idp55210616" class="indexterm"></a><a id="idp55211512" class="indexterm"></a><a id="idp55212280" class="indexterm"></a><a id="idp55213432" class="indexterm"></a><a id="idp55215352" class="indexterm"></a><p>Unfortunately, there are still many vendors that do not
	  provide schematics for their drivers to the open source
	  community because they regard such information as trade
	  secrets.  Consequently, the developers of FreeBSD and other
	  operating systems are left with two choices: develop the
	  drivers by a long and pain-staking process of reverse
	  engineering or using the existing driver binaries available
	  for <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® platforms.</p><p>FreeBSD provides <span class="quote">&#8220;<span class="quote">native</span>&#8221;</span> support for the
	  Network Driver Interface Specification
	  (<acronym class="acronym">NDIS</acronym>).  It includes <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndisgen&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndisgen</span>(8)</span></a>
	  which can be used to convert a <span class="trademark">Windows</span>® XP driver into a
	  format that can be used on FreeBSD.  Because the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndis</span>(4)</span></a>
	  driver uses a <span class="trademark">Windows</span>® XP binary, it only runs on <span class="trademark">i386</span>&#8482;
	  and amd64 systems.  <acronym class="acronym">PCI</acronym>, CardBus,
	  <acronym class="acronym">PCMCIA</acronym>, and <acronym class="acronym">USB</acronym>
	  devices are supported.</p><p>To use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndisgen&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndisgen</span>(8)</span></a>, three things are needed:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>FreeBSD kernel sources.</p></li><li class="listitem"><p>A <span class="trademark">Windows</span>® XP driver binary with a
	      <code class="filename">.SYS</code> extension.</p></li><li class="listitem"><p>A <span class="trademark">Windows</span>® XP driver configuration file with a
	      <code class="filename">.INF</code> extension.</p></li></ol></div><p>Download the <code class="filename">.SYS</code> and
	  <code class="filename">.INF</code> files for the specific
	  <acronym class="acronym">NIC</acronym>.  Generally, these can be found on
	  the driver CD or at the vendor's website.  The following
	  examples use <code class="filename">W32DRIVER.SYS</code> and
	  <code class="filename">W32DRIVER.INF</code>.</p><p>The driver bit width must match the version of FreeBSD.
	  For FreeBSD/i386, use a <span class="trademark">Windows</span>® 32-bit driver.  For
	  FreeBSD/amd64, a <span class="trademark">Windows</span>® 64-bit driver is needed.</p><p>The next step is to compile the driver binary into a
	  loadable kernel module.  As
	  <code class="systemitem">root</code>, use
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndisgen&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndisgen</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ndisgen <em class="replaceable"><code>/path/to/W32DRIVER.INF</code></em> <em class="replaceable"><code>/path/to/W32DRIVER.SYS</code></em></code></strong></pre><p>This command is interactive and prompts for any extra
	  information it requires.  A new kernel module will be
	  generated in the current directory.  Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>
	  to load the new module:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload <em class="replaceable"><code>./W32DRIVER_SYS.ko</code></em></code></strong></pre><p>In addition to the generated kernel module, the
	  <code class="filename">ndis.ko</code> and
	  <code class="filename">if_ndis.ko</code> modules must be loaded.
	  This should happen automatically when any module that
	  depends on <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndis</span>(4)</span></a> is loaded.  If not, load them
	  manually, using the following commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload ndis</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>kldload if_ndis</code></strong></pre><p>The first command loads the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndis</span>(4)</span></a> miniport driver
	  wrapper and the second loads the generated
	  <acronym class="acronym">NIC</acronym> driver.</p><p>Check <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> to see if there were any load
	  errors.  If all went well, the output should be similar to
	  the following:</p><pre class="screen">ndis0: &lt;Wireless-G PCI Adapter&gt; mem 0xf4100000-0xf4101fff irq 3 at device 8.0 on pci1
ndis0: NDIS API version: 5.0
ndis0: Ethernet address: 0a:b1:2c:d3:4e:f5
ndis0: 11b rates: 1Mbps 2Mbps 5.5Mbps 11Mbps
ndis0: 11g rates: 6Mbps 9Mbps 12Mbps 18Mbps 36Mbps 48Mbps 54Mbps</pre><p>From here, <code class="filename">ndis0</code> can be
	  configured like any other <acronym class="acronym">NIC</acronym>.</p><p>To configure the system to load the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ndis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ndis</span>(4)</span></a> modules
	  at boot time, copy the generated module,
	  <code class="filename">W32DRIVER_SYS.ko</code>, to
	  <code class="filename">/boot/modules</code>.  Then, add the following
	  line to <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">W32DRIVER_SYS_load="YES"</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp54749304"></a>11.5.2. Configuring the Network Card</h3></div></div></div><a id="idp54749944" class="indexterm"></a><p>Once the right driver is loaded for the
	<acronym class="acronym">NIC</acronym>, the card needs to be configured.  It
	may have been configured at installation time by
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsdinstall&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsdinstall</span>(8)</span></a>.</p><p>To display the <acronym class="acronym">NIC</acronym> configuration,
	enter the following command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ifconfig</code></strong>
dc0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:da
        inet 192.168.1.3 netmask 0xffffff00 broadcast 192.168.1.255
        media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)
        status: active
dc1: flags=8802&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:db
        inet 10.0.0.1 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet 10baseT/UTP
        status: no carrier
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; metric 0 mtu 16384
        options=3&lt;RXCSUM,TXCSUM&gt;
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x4
        inet6 ::1 prefixlen 128
        inet 127.0.0.1 netmask 0xff000000
        nd6 options=3&lt;PERFORMNUD,ACCEPT_RTADV&gt;</pre><p>In this example, the following devices were
	displayed:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">dc0</code>: The first Ethernet
	    interface.</p></li><li class="listitem"><p><code class="filename">dc1</code>: The second Ethernet
	    interface.</p></li><li class="listitem"><p><code class="filename">lo0</code>: The loopback
	    device.</p></li></ul></div><p>FreeBSD uses the driver name followed by the order in which
	the card is detected at boot to name the
	<acronym class="acronym">NIC</acronym>.  For example,
	<code class="filename">sis2</code> is the third
	<acronym class="acronym">NIC</acronym> on the system using the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sis</span>(4)</span></a>
	driver.</p><p>In this example, <code class="filename">dc0</code> is up and
	running.  The key indicators are:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="literal">UP</code> means that the card is
	    configured and ready.</p></li><li class="listitem"><p>The card has an Internet (<code class="literal">inet</code>)
	    address, <code class="systemitem">192.168.1.3</code>.</p></li><li class="listitem"><p>It has a valid subnet mask
	    (<code class="literal">netmask</code>), where
	    <code class="systemitem">0xffffff00</code> is the
	    same as <code class="systemitem">255.255.255.0</code>.</p></li><li class="listitem"><p>It has a valid broadcast address, <code class="systemitem">192.168.1.255</code>.</p></li><li class="listitem"><p>The <acronym class="acronym">MAC</acronym> address of the card
	    (<code class="literal">ether</code>) is <code class="systemitem">00:a0:cc:da:da:da</code>.</p></li><li class="listitem"><p>The physical media selection is on autoselection mode
	    (<code class="literal">media: Ethernet autoselect (100baseTX
	      &lt;full-duplex&gt;)</code>).  In this example,
	    <code class="filename">dc1</code> is configured to run with
	    <code class="literal">10baseT/UTP</code> media.  For more
	    information on available media types for a driver, refer
	    to its manual page.</p></li><li class="listitem"><p>The status of the link (<code class="literal">status</code>) is
	    <code class="literal">active</code>, indicating that the carrier
	    signal is detected.  For <code class="filename">dc1</code>, the
	    <code class="literal">status: no carrier</code> status is normal
	    when an Ethernet cable is not plugged into the
	    card.</p></li></ol></div><p>If the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> output had shown something similar
	to:</p><pre class="screen">dc0: flags=8843&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	options=80008&lt;VLAN_MTU,LINKSTATE&gt;
	ether 00:a0:cc:da:da:da
	media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)
	status: active</pre><p>it would indicate the card has not been configured.</p><p>The card must be configured as
	<code class="systemitem">root</code>.  The
	<acronym class="acronym">NIC</acronym> configuration can be performed from the
	command line with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> but will not persist after
	a reboot unless the configuration is also added to
	<code class="filename">/etc/rc.conf</code>.  If a
	<acronym class="acronym">DHCP</acronym> server is present on the LAN,
	just add this line:</p><pre class="programlisting">ifconfig_dc0="DHCP"</pre><p>Replace <em class="replaceable"><code>dc0</code></em> with the correct
	value for the system.</p><p>The line added, then, follow the instructions given in
	<a class="xref" href="#config-network-testing" title="11.5.3. Testing and Troubleshooting">Section 11.5.3, &#8220;Testing and Troubleshooting&#8221;</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If the network was configured during installation, some
	  entries for the <acronym class="acronym">NIC</acronym>(s) may be already
	  present.  Double check <code class="filename">/etc/rc.conf</code>
	  before adding any lines.</p></div><p>If there is no <acronym class="acronym">DHCP</acronym> server,
	the <acronym class="acronym">NIC</acronym>(s) must be configured manually.
	Add a line for each <acronym class="acronym">NIC</acronym> present on the
	system, as seen in this example:</p><pre class="programlisting">ifconfig_dc0="inet 192.168.1.3 netmask 255.255.255.0"
ifconfig_dc1="inet 10.0.0.1 netmask 255.255.255.0 media 10baseT/UTP"</pre><p>Replace <code class="filename">dc0</code> and
	<code class="filename">dc1</code> and the <acronym class="acronym">IP</acronym>
	address information with the correct values for the system.
	Refer to the man page for the driver, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>, and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> for more details about the allowed options and
	the syntax of <code class="filename">/etc/rc.conf</code>.</p><p>If the network is not using <acronym class="acronym">DNS</acronym>, edit
	<code class="filename">/etc/hosts</code> to add the names and
	<acronym class="acronym">IP</acronym> addresses of the hosts on the
	<acronym class="acronym">LAN</acronym>, if they are not already there.  For
	more information, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> and to
	<code class="filename">/usr/share/examples/etc/hosts</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If there is no <acronym class="acronym">DHCP</acronym> server and
	  access to the Internet is needed, manually configure the
	  default gateway and the nameserver:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'defaultrouter="<em class="replaceable"><code>your_default_router</code></em>"' &gt;&gt; /etc/rc.conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo 'nameserver <em class="replaceable"><code>your_DNS_server</code></em>' &gt;&gt; /etc/resolv.conf</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="config-network-testing"></a>11.5.3. Testing and Troubleshooting</h3></div></div></div><p>Once the necessary changes to
	<code class="filename">/etc/rc.conf</code> are saved, a reboot can be
	used to test the network configuration and to verify that the
	system restarts without any configuration errors.
	Alternatively, apply the settings to the networking system
	with this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif restart</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If a default gateway has been set in
	  <code class="filename">/etc/rc.conf</code>, also issue this
	  command:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service routing restart</code></strong></pre></div><p>Once the networking system has been relaunched, test the
	<acronym class="acronym">NIC</acronym>s.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp54828536"></a>11.5.3.1. Testing the Ethernet Card</h4></div></div></div><a id="idp54829176" class="indexterm"></a><p>To verify that an Ethernet card is configured correctly,
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> the interface itself, and then <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>
	  another machine on the <acronym class="acronym">LAN</acronym>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ping -c5 192.168.1.3</code></strong>
PING 192.168.1.3 (192.168.1.3): 56 data bytes
64 bytes from 192.168.1.3: icmp_seq=0 ttl=64 time=0.082 ms
64 bytes from 192.168.1.3: icmp_seq=1 ttl=64 time=0.074 ms
64 bytes from 192.168.1.3: icmp_seq=2 ttl=64 time=0.076 ms
64 bytes from 192.168.1.3: icmp_seq=3 ttl=64 time=0.108 ms
64 bytes from 192.168.1.3: icmp_seq=4 ttl=64 time=0.076 ms

--- 192.168.1.3 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.074/0.083/0.108/0.013 ms</pre><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ping -c5 192.168.1.2</code></strong>
PING 192.168.1.2 (192.168.1.2): 56 data bytes
64 bytes from 192.168.1.2: icmp_seq=0 ttl=64 time=0.726 ms
64 bytes from 192.168.1.2: icmp_seq=1 ttl=64 time=0.766 ms
64 bytes from 192.168.1.2: icmp_seq=2 ttl=64 time=0.700 ms
64 bytes from 192.168.1.2: icmp_seq=3 ttl=64 time=0.747 ms
64 bytes from 192.168.1.2: icmp_seq=4 ttl=64 time=0.704 ms

--- 192.168.1.2 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.700/0.729/0.766/0.025 ms</pre><p>To test network resolution, use the host name instead
	  of the <acronym class="acronym">IP</acronym> address.  If there is no
	  <acronym class="acronym">DNS</acronym> server on the network,
	  <code class="filename">/etc/hosts</code> must first be
	  configured.  To this purpose, edit
	  <code class="filename">/etc/hosts</code> to add the names and
	  <acronym class="acronym">IP</acronym> addresses of the hosts on the
	  <acronym class="acronym">LAN</acronym>, if they are not already there.  For
	  more information, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> and to
	  <code class="filename">/usr/share/examples/etc/hosts</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55256440"></a>11.5.3.2. Troubleshooting</h4></div></div></div><a id="idp55257080" class="indexterm"></a><p>When troubleshooting hardware and software
	  configurations, check the simple things first.  Is the
	  network cable plugged in?  Are the network services properly
	  configured?  Is the firewall configured correctly?  Is the
	  <acronym class="acronym">NIC</acronym> supported by FreeBSD?  Before sending
	  a bug report, always check the Hardware Notes, update the
	  version of FreeBSD to the latest STABLE version, check the
	  mailing list archives, and search the Internet.</p><p>If the card works, yet performance is poor, read
	  through <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tuning&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tuning</span>(7)</span></a>.  Also, check the network
	  configuration as incorrect network settings can cause slow
	  connections.</p><p>Some users experience one or two
	  <span class="errorname">device timeout</span> messages, which is
	  normal for some cards.  If they continue, or are bothersome,
	  determine if the device is conflicting with another device.
	  Double check the cable connections.  Consider trying another
	  card.</p><p>To resolve <span class="errorname">watchdog timeout</span>
	  errors,  first check the network cable.  Many cards
	  require a <acronym class="acronym">PCI</acronym> slot which supports bus
	  mastering.  On some old motherboards, only one
	  <acronym class="acronym">PCI</acronym> slot allows it, usually slot 0.
	  Check the <acronym class="acronym">NIC</acronym> and the motherboard
	  documentation to determine if that may be the
	  problem.</p><p><span class="errorname">No route to host</span> messages occur
	  if the system is unable to route a packet to the destination
	  host.  This can happen if no default route is specified or
	  if a cable is unplugged.  Check the output of
	  <code class="command">netstat -rn</code> and make sure there is a
	  valid route to the host.  If there is not, read
	  <a class="xref" href="#network-routing" title="31.2. Gateways and Routes">Section 31.2, &#8220;Gateways and Routes&#8221;</a>.</p><p><span class="errorname">ping: sendto: Permission denied</span>
	  error messages are often caused by a misconfigured firewall.
	  If a firewall is enabled on FreeBSD but no rules have been
	  defined, the default policy is to deny all traffic, even
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>.  Refer to
	  <a class="xref" href="#firewalls" title="Chapter 30. Firewalls">Chapter 30, <em>Firewalls</em></a> for more information.</p><p>Sometimes performance of the card is poor or below
	  average.  In these cases, try setting the media
	  selection mode from <code class="literal">autoselect</code> to the
	  correct media selection.  While this works for most
	  hardware, it may or may not resolve the issue.  Again,
	  check all the network settings, and refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tuning&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tuning</span>(7)</span></a>.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-virtual-hosts"></a>11.6. Virtual Hosts</h2></div></div></div><a id="idp55272952" class="indexterm"></a><a id="idp55273464" class="indexterm"></a><p>A common use of FreeBSD is virtual site hosting, where one
      server appears to the network as many servers.  This is achieved
      by assigning multiple network addresses to a single
      interface.</p><p>A given network interface has one <span class="quote">&#8220;<span class="quote">real</span>&#8221;</span>
      address, and may have any number of <span class="quote">&#8220;<span class="quote">alias</span>&#8221;</span>
      addresses.  These aliases are normally added by placing alias
      entries in <code class="filename">/etc/rc.conf</code>, as seen in this
      example:</p><pre class="programlisting">ifconfig_fxp0_alias0="inet xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx"</pre><p>Alias entries must start with
      <code class="literal">alias<em class="replaceable"><code>0</code></em></code> using a
      sequential number such as
      <code class="literal">alias0</code>, <code class="literal">alias1</code>,
      and so on.  The configuration process will stop at the first
      missing number.</p><p>The calculation of alias netmasks is important.  For a
      given interface, there must be one address which correctly
      represents the network's netmask.  Any other addresses which
      fall within this network must have a netmask of all
      <code class="literal">1</code>s, expressed as either
      <code class="systemitem">255.255.255.255</code> or
      <code class="systemitem">0xffffffff</code>.</p><p>For example, consider the case where the
      <code class="filename">fxp0</code> interface is connected to two
      networks: <code class="systemitem">10.1.1.0</code>
      with a netmask of
      <code class="systemitem">255.255.255.0</code> and
      <code class="systemitem">202.0.75.16</code> with a
      netmask of
      <code class="systemitem">255.255.255.240</code>.  The
      system is to be configured to appear in the ranges
      <code class="systemitem">10.1.1.1</code> through
      <code class="systemitem">10.1.1.5</code> and
      <code class="systemitem">202.0.75.17</code> through
      <code class="systemitem">202.0.75.20</code>.  Only
      the first address in a given network range should have a real
      netmask.  All the rest
      (<code class="systemitem">10.1.1.2</code> through
      <code class="systemitem">10.1.1.5</code> and
      <code class="systemitem">202.0.75.18</code> through
      <code class="systemitem">202.0.75.20</code>) must be
      configured with a netmask of
      <code class="systemitem">255.255.255.255</code>.</p><p>The following <code class="filename">/etc/rc.conf</code> entries
      configure the adapter correctly for this scenario:</p><pre class="programlisting">ifconfig_fxp0="inet 10.1.1.1 netmask 255.255.255.0"
ifconfig_fxp0_alias0="inet 10.1.1.2 netmask 255.255.255.255"
ifconfig_fxp0_alias1="inet 10.1.1.3 netmask 255.255.255.255"
ifconfig_fxp0_alias2="inet 10.1.1.4 netmask 255.255.255.255"
ifconfig_fxp0_alias3="inet 10.1.1.5 netmask 255.255.255.255"
ifconfig_fxp0_alias4="inet 202.0.75.17 netmask 255.255.255.240"
ifconfig_fxp0_alias5="inet 202.0.75.18 netmask 255.255.255.255"
ifconfig_fxp0_alias6="inet 202.0.75.19 netmask 255.255.255.255"
ifconfig_fxp0_alias7="inet 202.0.75.20 netmask 255.255.255.255"</pre><p>A simpler way to express this is with a space-separated list
      of <acronym class="acronym">IP</acronym> address ranges.  The first address
      will be given the
      indicated subnet mask and the additional addresses will have a
      subnet mask of <code class="literal">255.255.255.255</code>.</p><pre class="programlisting">ifconfig_fxp0_aliases="inet 10.1.1.1-5/24 inet 202.0.75.17-20/28"</pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-syslog"></a>11.7. Configuring System Logging</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Niclas</span> <span class="surname">Zeising</span></span>. </span></div></div></div><a id="idp55314424" class="indexterm"></a><a id="idp55315192" class="indexterm"></a><a id="idp55320056" class="indexterm"></a><p>Generating and reading system logs is an important aspect of
      system administration.  The information in system logs can be
      used to detect hardware and software issues as well as
      application and system configuration errors.  This information
      also plays an important role in security auditing and incident
      response.  Most system daemons and applications will generate
      log entries.</p><p>FreeBSD provides a system logger,
      <span class="application">syslogd</span>, to manage logging.  By
      default, <span class="application">syslogd</span> is started when the
      system boots.  This is controlled by the variable
      <code class="literal">syslogd_enable</code> in
      <code class="filename">/etc/rc.conf</code>.  There are numerous
      application arguments that can be set using
      <code class="literal">syslogd_flags</code> in
      <code class="filename">/etc/rc.conf</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> for
      more information on the available arguments.</p><p>This section describes how to configure the FreeBSD system
      logger for both local and remote logging and how to perform log
      rotation and log management.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55337848"></a>11.7.1. Configuring Local Logging</h3></div></div></div><a id="idp55338488" class="indexterm"></a><p>The configuration file,
	<code class="filename">/etc/syslog.conf</code>, controls what
	<span class="application">syslogd</span> does with log entries as
	they are received.  There are several parameters to control
	the handling of incoming events.  The
	<em class="firstterm">facility</em> describes which subsystem
	generated the message, such as the kernel or a daemon, and the
	<em class="firstterm">level</em> describes the severity of the
	event that occurred.  This makes it possible to configure if
	and where a log message is logged, depending on the facility
	and level.  It is also possible to take action depending on
	the application that sent the message, and in the case of
	remote logging, the hostname of the machine generating the
	logging event.</p><p>This configuration file contains one line per action,
	where the syntax for each line is a selector field followed by
	an action field.  The syntax of the selector field is
	<em class="replaceable"><code>facility.level</code></em> which will match log
	messages from <em class="replaceable"><code>facility</code></em> at level
	<em class="replaceable"><code>level</code></em> or higher.  It is also
	possible to add an optional comparison flag before the level
	to specify more precisely what is logged.  Multiple selector
	fields can be used for the same action, and are separated with
	a semicolon (<code class="literal">;</code>).  Using
	<code class="literal">*</code> will match everything.  The action field
	denotes where to send the log message, such as to a file or
	remote log host.  As an example, here is the default
	<code class="filename">syslog.conf</code> from FreeBSD:</p><pre class="programlisting"># <span translate="no" class="phrase">$FreeBSD$</span>
#
#       Spaces ARE valid field separators in this file. However,
#       other *nix-like systems still insist on using tabs as field
#       separators. If you are sharing this file between systems, you
#       may want to use only tabs as field separators here.
#       Consult the syslog.conf(5) manpage.
*.err;kern.warning;auth.notice;mail.crit                /dev/console
*.notice;authpriv.none;kern.debug;lpr.info;mail.crit;news.err   /var/log/messages
security.*                                      /var/log/security
auth.info;authpriv.info                         /var/log/auth.log
mail.info                                       /var/log/maillog
lpr.info                                        /var/log/lpd-errs
ftp.info                                        /var/log/xferlog
cron.*                                          /var/log/cron
!-devd
*.=debug                                        /var/log/debug.log
*.emerg                                         *
# uncomment this to log all writes to /dev/console to /var/log/console.log
#console.info                                   /var/log/console.log
# uncomment this to enable logging of all log messages to /var/log/all.log
# touch /var/log/all.log and chmod it to mode 600 before it will work
#*.*                                            /var/log/all.log
# uncomment this to enable logging to a remote loghost named loghost
#*.*                                            @loghost
# uncomment these if you're running inn
# news.crit                                     /var/log/news/news.crit
# news.err                                      /var/log/news/news.err
# news.notice                                   /var/log/news/news.notice
# Uncomment this if you wish to see messages produced by devd
# !devd
# *.&gt;=info
!ppp
*.*                                             /var/log/ppp.log
!*</pre><p>In this example:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Line 8 matches all messages with a level of
	    <code class="literal">err</code> or higher, as well as
	    <code class="literal">kern.warning</code>,
	    <code class="literal">auth.notice</code> and
	    <code class="literal">mail.crit</code>, and sends these log messages
	    to the console
	    (<code class="filename">/dev/console</code>).</p></li><li class="listitem"><p>Line 12 matches all messages from the
	    <code class="literal">mail</code> facility at level
	    <code class="literal">info</code> or above and logs the messages to
	    <code class="filename">/var/log/maillog</code>.</p></li><li class="listitem"><p>Line 17 uses a comparison flag (<code class="literal">=</code>)
	    to only match messages at level <code class="literal">debug</code>
	    and logs them to
	    <code class="filename">/var/log/debug.log</code>.</p></li><li class="listitem"><p>Line 33 is an example usage of a program
	    specification.  This makes the rules following it only
	    valid for the specified program.  In this case, only the
	    messages generated by <span class="application">ppp</span> are
	    logged to <code class="filename">/var/log/ppp.log</code>.</p></li></ul></div><p>The available levels, in order from most to least
	critical are <code class="literal">emerg</code>,
	<code class="literal">alert</code>, <code class="literal">crit</code>,
	<code class="literal">err</code>, <code class="literal">warning</code>,
	<code class="literal">notice</code>, <code class="literal">info</code>, and
	<code class="literal">debug</code>.</p><p>The facilities, in no particular order, are
	<code class="literal">auth</code>, <code class="literal">authpriv</code>,
	<code class="literal">console</code>, <code class="literal">cron</code>,
	<code class="literal">daemon</code>, <code class="literal">ftp</code>,
	<code class="literal">kern</code>, <code class="literal">lpr</code>,
	<code class="literal">mail</code>, <code class="literal">mark</code>,
	<code class="literal">news</code>, <code class="literal">security</code>,
	<code class="literal">syslog</code>, <code class="literal">user</code>,
	<code class="literal">uucp</code>, and <code class="literal">local0</code> through
	<code class="literal">local7</code>.  Be aware that other operating
	systems might have different facilities.</p><p>To log everything of level <code class="literal">notice</code> and
	higher to <code class="filename">/var/log/daemon.log</code>, add the
	following entry:</p><pre class="programlisting">daemon.notice                                        /var/log/daemon.log</pre><p>For more information about the different levels and
	facilities, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>.
	For more information about
	<code class="filename">/etc/syslog.conf</code>, its syntax, and more
	advanced usage examples, see <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslog.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslog.conf</span>(5)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp54713208"></a>11.7.2. Log Management and Rotation</h3></div></div></div><a id="idp54713848" class="indexterm"></a><a id="idp54714360" class="indexterm"></a><a id="idp54714872" class="indexterm"></a><a id="idp54715384" class="indexterm"></a><p>Log files can grow quickly, taking up disk space and
	making it more difficult to locate useful information.  Log
	management attempts to mitigate this.  In FreeBSD,
	<span class="application">newsyslog</span> is used to manage log
	files.  This built-in program periodically rotates and
	compresses log files, and optionally creates missing log files
	and signals programs when log files are moved.  The log files
	may be generated by <span class="application">syslogd</span> or by
	any other program which generates log files.  While
	<span class="application">newsyslog</span> is normally run from
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>, it is not a system daemon.  In the default
	configuration, it runs every hour.</p><p>To know which actions to take,
	<span class="application">newsyslog</span> reads its configuration
	file, <code class="filename">/etc/newsyslog.conf</code>.  This file
	contains one line for each log file that
	<span class="application">newsyslog</span> manages.  Each line
	states the file owner, permissions, when to rotate that file,
	optional flags that affect log rotation, such as compression,
	and programs to signal when the log is rotated.  Here is the
	default configuration in FreeBSD:</p><pre class="programlisting"># configuration file for newsyslog
# <span translate="no" class="phrase">$FreeBSD$</span>
#
# Entries which do not specify the '/pid_file' field will cause the
# syslogd process to be signalled when that log file is rotated.  This
# action is only appropriate for log files which are written to by the
# syslogd process (ie, files listed in /etc/syslog.conf).  If there
# is no process which needs to be signalled when a given log file is
# rotated, then the entry for that file should include the 'N' flag.
#
# The 'flags' field is one or more of the letters: BCDGJNUXZ or a '-'.
#
# Note: some sites will want to select more restrictive protections than the
# defaults.  In particular, it may be desirable to switch many of the 644
# entries to 640 or 600.  For example, some sites will consider the
# contents of maillog, messages, and lpd-errs to be confidential.  In the
# future, these defaults may change to more conservative ones.
#
# logfilename          [owner:group]    mode count size when  flags [/pid_file] [sig_num]
/var/log/all.log                        600  7     *    @T00  J
/var/log/amd.log                        644  7     100  *     J
/var/log/auth.log                       600  7     100  @0101T JC
/var/log/console.log                    600  5     100  *     J
/var/log/cron                           600  3     100  *     JC
/var/log/daily.log                      640  7     *    @T00  JN
/var/log/debug.log                      600  7     100  *     JC
/var/log/kerberos.log                   600  7     100  *     J
/var/log/lpd-errs                       644  7     100  *     JC
/var/log/maillog                        640  7     *    @T00  JC
/var/log/messages                       644  5     100  @0101T JC
/var/log/monthly.log                    640  12    *    $M1D0 JN
/var/log/pflog                          600  3     100  *     JB    /var/run/pflogd.pid
/var/log/ppp.log        root:network    640  3     100  *     JC
/var/log/devd.log                       644  3     100  *     JC
/var/log/security                       600  10    100  *     JC
/var/log/sendmail.st                    640  10    *    168   B
/var/log/utx.log                        644  3     *    @01T05 B
/var/log/weekly.log                     640  5     1    $W6D0 JN
/var/log/xferlog                        600  7     100  *     JC</pre><p>Each line starts with the name of the log to be rotated,
	optionally followed by an owner and group for both rotated and
	newly created files.  The <code class="literal">mode</code> field sets
	the permissions on the log file and <code class="literal">count</code>
	denotes how many rotated log files should be kept.  The
	<code class="literal">size</code> and <code class="literal">when</code> fields
	tell <span class="application">newsyslog</span> when to rotate the
	file.  A log file is rotated when either its size is larger
	than the <code class="literal">size</code> field or when the time in the
	<code class="literal">when</code> field has passed.  An asterisk
	(<code class="literal">*</code>) means that this field is ignored.  The
	<em class="replaceable"><code>flags</code></em> field gives further
	instructions, such as how to compress the rotated file or to
	create the log file if it is missing.  The last two fields are
	optional and specify the name of the Process ID
	(<acronym class="acronym">PID</acronym>) file of a process and a signal number
	to send to that process when the file is rotated.</p><p>For more information on all fields, valid flags, and how
	to specify the rotation time, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">newsyslog.conf</span>(5)</span></a>.
	Since <span class="application">newsyslog</span> is run from
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>, it cannot rotate files more often than it is
	scheduled to run from <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-syslogd"></a>11.7.3. Configuring Remote Logging</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>Monitoring the log files of multiple hosts can become
	unwieldy as the number of systems increases.  Configuring
	centralized logging can reduce some of the administrative
	burden of log file administration.</p><p>In FreeBSD, centralized log file aggregation, merging, and
	rotation can be configured using
	<span class="application">syslogd</span> and
	<span class="application">newsyslog</span>.  This section
	demonstrates an example configuration, where host
	<code class="systemitem">A</code>, named <code class="systemitem">logserv.example.com</code>, will
	collect logging information for the local network.  Host
	<code class="systemitem">B</code>, named <code class="systemitem">logclient.example.com</code>,
	will be configured to pass logging information to the logging
	server.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55377912"></a>11.7.3.1. Log Server Configuration</h4></div></div></div><p>A log server is a system that has been configured to
	  accept logging information from other hosts.  Before
	  configuring a log server, check the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If there is a firewall between the logging server
	      and any logging clients, ensure that the firewall
	      ruleset allows <acronym class="acronym">UDP</acronym> port 514 for both
	      the clients and the server.</p></li><li class="listitem"><p>The logging server and all client  machines must
	      have forward and reverse entries in the local
	      <acronym class="acronym">DNS</acronym>.  If the network does not have a
	      <acronym class="acronym">DNS</acronym> server, create entries in each
	      system's <code class="filename">/etc/hosts</code>.  Proper name
	      resolution is required so that log entries are not
	      rejected by the logging server.</p></li></ul></div><p>On the log server, edit
	  <code class="filename">/etc/syslog.conf</code> to specify the name of
	  the client to receive log entries from, the logging facility
	  to be used, and the name of the log to store the host's log
	  entries.  This example adds the hostname of
	  <code class="systemitem">B</code>, logs all facilities, and stores
	  the log entries in
	  <code class="filename">/var/log/logclient.log</code>.</p><div class="example"><a id="idp55388024"></a><div class="example-title">Example 11.1. Sample Log Server Configuration</div><div class="example-contents"><pre class="programlisting">+logclient.example.com
*.*     /var/log/logclient.log</pre></div></div><br class="example-break" /><p>When adding multiple log clients, add a similar two-line
	  entry for each client.  More information about the available
	  facilities may be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslog.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslog.conf</span>(5)</span></a>.</p><p>Next, configure
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">syslogd_enable="YES"
syslogd_flags="-a logclient.example.com -v -v"</pre><p>The first entry starts
	  <span class="application">syslogd</span> at system boot.  The
	  second entry allows log entries from the specified client.
	  The <code class="option">-v -v</code> increases the verbosity of logged
	  messages.  This is useful for tweaking facilities as
	  administrators are able to see what type of messages are
	  being logged under each facility.</p><p>Multiple <code class="option">-a</code> options may be specified to
	  allow logging from multiple clients.  <acronym class="acronym">IP</acronym>
	  addresses and whole netblocks may also be specified.  Refer
	  to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> for a full list of possible
	  options.</p><p>Finally, create the log file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>touch /var/log/logclient.log</code></strong></pre><p>At this point, <span class="application">syslogd</span> should
	  be restarted and verified:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pgrep syslog</code></strong></pre><p>If a <acronym class="acronym">PID</acronym> is returned, the server
	  restarted successfully, and client configuration can begin.
	  If the server did not restart, consult
	  <code class="filename">/var/log/messages</code> for the error.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55186552"></a>11.7.3.2. Log Client Configuration</h4></div></div></div><p>A logging client sends log entries to a logging server
	  on the network.  The client also keeps a local copy of its
	  own logs.</p><p>Once a logging server has been configured, edit
	  <code class="filename">/etc/rc.conf</code> on the logging
	  client:</p><pre class="programlisting">syslogd_enable="YES"
syslogd_flags="-s -v -v"</pre><p>The first entry enables
	  <span class="application">syslogd</span> on boot up.  The second
	  entry prevents logs from being accepted by this client from
	  other hosts (<code class="option">-s</code>) and increases the
	  verbosity of logged messages.</p><p>Next, define the logging server in the client's
	  <code class="filename">/etc/syslog.conf</code>.  In this example, all
	  logged facilities are sent to a remote system, denoted by
	  the <code class="literal">@</code> symbol, with the specified
	  hostname:</p><pre class="programlisting">*.*		@logserv.example.com</pre><p>After saving the edit, restart
	  <span class="application">syslogd</span> for the changes to take
	  effect:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong></pre><p>To test that log messages are being sent across the
	  network, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=logger&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">logger</span>(1)</span></a> on the client to send a message
	  to <span class="application">syslogd</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>logger "<em class="replaceable"><code>Test message from logclient</code></em>"</code></strong></pre><p>This message should now exist both in
	  <code class="filename">/var/log/messages</code> on the client and
	  <code class="filename">/var/log/logclient.log</code> on the log
	  server.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55418360"></a>11.7.3.3. Debugging Log Servers</h4></div></div></div><p>If no messages are being received on the log server, the
	  cause is most likely a network connectivity issue, a
	  hostname resolution issue, or a typo in a configuration
	  file.  To isolate the cause, ensure that both the logging
	  server and the logging client are able to
	  <code class="command">ping</code> each other using the hostname
	  specified in their <code class="filename">/etc/rc.conf</code>.  If
	  this fails, check the network cabling, the firewall ruleset,
	  and the hostname entries in the <acronym class="acronym">DNS</acronym>
	  server or <code class="filename">/etc/hosts</code> on both the
	  logging server and clients.  Repeat until the
	  <code class="command">ping</code> is successful from both
	  hosts.</p><p>If the <code class="command">ping</code> succeeds on both hosts
	  but log messages are still not being received, temporarily
	  increase logging verbosity to narrow down the configuration
	  issue.  In the following example,
	  <code class="filename">/var/log/logclient.log</code> on the logging
	  server is empty and <code class="filename">/var/log/messages</code>
	  on the logging client does not indicate a reason for the
	  failure.  To increase debugging output, edit the
	  <code class="literal">syslogd_flags</code> entry on the logging server
	  and issue a restart:</p><pre class="programlisting">syslogd_flags="-d -a logclient.example.com -v -v"</pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong></pre><p>Debugging data similar to the following will flash on
	  the console immediately after the restart:</p><pre class="screen">logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
Logging to FILE /var/log/messages
syslogd: kernel boot file is /boot/kernel/kernel
cvthname(192.168.1.10)
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com;
rejected in rule 0 due to name mismatch.</pre><p>In this example, the log messages are being rejected due
	  to a typo which results in a hostname mismatch.  The
	  client's hostname should be <code class="literal">logclient</code>,
	  not <code class="literal">logclien</code>.  Fix the typo, issue a
	  restart, and verify the results:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong>
logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
syslogd: kernel boot file is /boot/kernel/kernel
logmsg: pri 166, flags 17, from logserv.example.com,
msg Dec 10 20:55:02 &lt;syslog.err&gt; logserv.example.com syslogd: exiting on signal 2
cvthname(192.168.1.10)
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com;
accepted in rule 0.
logmsg: pri 15, flags 0, from logclient.example.com, msg Dec 11 02:01:28 trhodes: Test message 2
Logging to FILE /var/log/logclient.log
Logging to FILE /var/log/messages</pre><p>At this point, the messages are being properly received
	  and placed in the correct file.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55460856"></a>11.7.3.4. Security Considerations</h4></div></div></div><p>As with any network service, security requirements
	  should be considered before implementing a logging server.
	  Log files may contain sensitive data about services enabled
	  on the local host, user accounts, and configuration data.
	  Network data sent from the client to the server will not be
	  encrypted or password protected.  If a need for encryption
	  exists, consider using <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/stunnel/pkg-descr">security/stunnel</a>,
	  which will transmit the logging data over an encrypted
	  tunnel.</p><p>Local security is also an issue.  Log files are not
	  encrypted during use or after log rotation.  Local users may
	  access log files to gain additional insight into system
	  configuration.  Setting proper permissions on log files is
	  critical.  The built-in log rotator,
	  <span class="application">newsyslog</span>, supports setting
	  permissions on newly created and rotated log files.  Setting
	  log files to mode <code class="literal">600</code> should prevent
	  unwanted access by local users.  Refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">newsyslog.conf</span>(5)</span></a> for additional information.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-configfiles"></a>11.8. Configuration Files</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55469432"></a>11.8.1. <code class="filename">/etc</code>
	Layout</h3></div></div></div><p>There are a number of directories in which configuration
	information is kept.  These include:</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="filename">/etc</code></td><td>Generic system-specific configuration
		information.</td></tr><tr><td><code class="filename">/etc/defaults</code></td><td>Default versions of system configuration
		files.</td></tr><tr><td><code class="filename">/etc/mail</code></td><td>Extra <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></a> configuration and other
		<acronym class="acronym">MTA</acronym> configuration files.</td></tr><tr><td><code class="filename">/etc/ppp</code></td><td>Configuration for both user- and kernel-ppp
		programs.</td></tr><tr><td><code class="filename">/usr/local/etc</code></td><td>Configuration files for installed applications.
		May contain per-application subdirectories.</td></tr><tr><td><code class="filename">/usr/local/etc/rc.d</code></td><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> scripts for installed
		applications.</td></tr><tr><td><code class="filename">/var/db</code></td><td>Automatically generated system-specific database
		files, such as the package database and the
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=locate&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">locate</span>(1)</span></a> database.</td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55488760"></a>11.8.2. Hostnames</h3></div></div></div><a id="idp55489400" class="indexterm"></a><a id="idp55489912" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55490424"></a>11.8.2.1. <code class="filename">/etc/resolv.conf</code></h4></div></div></div><a id="idp55491192" class="indexterm"></a><p>How a FreeBSD system accesses the Internet Domain Name
	  System (<acronym class="acronym">DNS</acronym>) is controlled by
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=resolv.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">resolv.conf</span>(5)</span></a>.</p><p>The most common entries to
	  <code class="filename">/etc/resolv.conf</code> are:</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="literal">nameserver</code></td><td>The <acronym class="acronym">IP</acronym> address of a name
		  server the resolver should query.  The servers are
		  queried in the order listed with a maximum of
		  three.</td></tr><tr><td><code class="literal">search</code></td><td>Search list for hostname lookup.  This is
		  normally determined by the domain of the local
		  hostname.</td></tr><tr><td><code class="literal">domain</code></td><td>The local domain name.</td></tr></tbody></table></div><p>A typical <code class="filename">/etc/resolv.conf</code> looks
	  like this:</p><pre class="programlisting">search example.com
nameserver 147.11.1.11
nameserver 147.11.100.30</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Only one of the <code class="literal">search</code> and
	    <code class="literal">domain</code> options should be used.</p></div><p>When using <acronym class="acronym">DHCP</acronym>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient</span>(8)</span></a>
	  usually rewrites <code class="filename">/etc/resolv.conf</code>
	  with information received from the <acronym class="acronym">DHCP</acronym>
	  server.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55522424"></a>11.8.2.2. <code class="filename">/etc/hosts</code></h4></div></div></div><a id="idp55523192" class="indexterm"></a><p><code class="filename">/etc/hosts</code> is a simple text
	  database which works in conjunction with
	  <acronym class="acronym">DNS</acronym> and
	  <acronym class="acronym">NIS</acronym> to provide host name to
	  <acronym class="acronym">IP</acronym> address mappings.  Entries for local
	  computers connected via a <acronym class="acronym">LAN</acronym> can be
	  added to this file for simplistic naming purposes instead
	  of setting up a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=named&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">named</span>(8)</span></a> server.  Additionally,
	  <code class="filename">/etc/hosts</code> can be used to provide a
	  local record of Internet names, reducing the need to query
	  external <acronym class="acronym">DNS</acronym> servers for commonly
	  accessed names.</p><pre class="programlisting"># <span translate="no" class="phrase">$FreeBSD$</span>
#
#
# Host Database
#
# This file should contain the addresses and aliases for local hosts that
# share this file.  Replace 'my.domain' below with the domainname of your
# machine.
#
# In the presence of the domain name service or NIS, this file may
# not be consulted at all; see /etc/nsswitch.conf for the resolution order.
#
#
::1			localhost localhost.my.domain
127.0.0.1		localhost localhost.my.domain
#
# Imaginary network.
#10.0.0.2		myname.my.domain myname
#10.0.0.3		myfriend.my.domain myfriend
#
# According to RFC 1918, you can use the following IP networks for
# private nets which will never be connected to the Internet:
#
#	10.0.0.0	-   10.255.255.255
#	172.16.0.0	-   172.31.255.255
#	192.168.0.0	-   192.168.255.255
#
# In case you want to be able to connect to the Internet, you need
# real official assigned numbers.  Do not try to invent your own network
# numbers but instead get one from your network provider (if any) or
# from your regional registry (ARIN, APNIC, LACNIC, RIPE NCC, or AfriNIC.)
#</pre><p>The format of <code class="filename">/etc/hosts</code> is as
	  follows:</p><pre class="programlisting">[Internet address] [official hostname] [alias1] [alias2] ...</pre><p>For example:</p><pre class="programlisting">10.0.0.1 myRealHostname.example.com myRealHostname foobar1 foobar2</pre><p>Consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> for more information.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-sysctl"></a>11.9. Tuning with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a></h2></div></div></div><a id="idp55541368" class="indexterm"></a><a id="idp55541880" class="indexterm"></a><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> is used to make changes to a running FreeBSD
      system.  This includes many advanced options of the
      <acronym class="acronym">TCP/IP</acronym> stack and virtual memory system
      that can dramatically improve performance for an experienced
      system administrator.  Over five hundred system variables can
      be read and set using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p><p>At its core, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> serves two functions: to read
      and to modify system settings.</p><p>To view all readable variables:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sysctl -a</code></strong></pre><p>To read a particular variable, specify its name:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sysctl kern.maxproc</code></strong>
kern.maxproc: 1044</pre><p>To set a particular variable, use the
      <em class="replaceable"><code>variable</code></em>=<em class="replaceable"><code>value</code></em>
      syntax:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl kern.maxfiles=5000</code></strong>
kern.maxfiles: 2088 -&gt; 5000</pre><p>Settings of sysctl variables are usually either strings,
      numbers, or booleans, where a boolean is <code class="literal">1</code>
      for yes or <code class="literal">0</code> for no.</p><p>To automatically set some variables each time the machine
      boots, add them to <code class="filename">/etc/sysctl.conf</code>.  For
      more information, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl.conf</span>(5)</span></a> and
      <a class="xref" href="#configtuning-sysctlconf" title="11.9.1. sysctl.conf">Section 11.9.1, &#8220;<code class="filename">sysctl.conf</code>&#8221;</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="configtuning-sysctlconf"></a>11.9.1. <code class="filename">sysctl.conf</code></h3></div></div></div><a id="idp55555192" class="indexterm"></a><a id="idp55555704" class="indexterm"></a><p>The configuration file for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>,
	<code class="filename">/etc/sysctl.conf</code>, looks much like
	<code class="filename">/etc/rc.conf</code>.  Values are set in a
	<code class="literal">variable=value</code> form.  The specified values
	are set after the system goes into multi-user mode.  Not all
	variables are settable in this mode.</p><p>For example, to turn off logging of fatal signal exits
	and prevent users from seeing processes started by other
	users, the following tunables can be set in
	<code class="filename">/etc/sysctl.conf</code>:</p><pre class="programlisting"># Do not log fatal signal exits (e.g., sig 11)
kern.logsigexit=0

# Prevent users from seeing information about processes that
# are being run under another UID.
security.bsd.see_other_uids=0</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sysctl-readonly"></a>11.9.2. <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> Read-only</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>In some cases it may be desirable to modify read-only
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> values, which will require a reboot of the
	system.</p><p>For instance, on some laptop models the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cardbus&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cardbus</span>(4)</span></a>
	device will not probe memory ranges and will fail with errors
	similar to:</p><pre class="screen">cbb0: Could not map register memory
device_probe_and_attach: cbb0 attach returned 12</pre><p>The fix requires the modification of a read-only
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> setting.  Add
	<code class="option">hw.pci.allow_unsupported_io_range=1</code> to
	<code class="filename">/boot/loader.conf</code> and reboot.  Now
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cardbus&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cardbus</span>(4)</span></a> should work properly.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-disk"></a>11.10. Tuning Disks</h2></div></div></div><p>The following section will discuss various tuning
      mechanisms and options which may be applied to disk
      devices.  In many cases, disks with mechanical parts,
      such as <acronym class="acronym">SCSI</acronym> drives, will be the
      bottleneck driving down the overall system performance.  While
      a solution is to install a drive without mechanical parts,
      such as a solid state drive, mechanical drives are not
      going away anytime in the near future.  When tuning disks,
      it is advisable to utilize the features of the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iostat&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iostat</span>(8)</span></a>
      command to test various changes to the system.  This
      command will allow the user to obtain valuable information
      on system <acronym class="acronym">IO</acronym>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55600888"></a>11.10.1. Sysctl Variables</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55601528"></a>11.10.1.1. <code class="varname">vfs.vmiodirenable</code></h4></div></div></div><a id="idp55602296" class="indexterm"></a><p>The <code class="varname">vfs.vmiodirenable</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	  variable
	  may be set to either <code class="literal">0</code> (off) or
	  <code class="literal">1</code> (on).  It is set to
	  <code class="literal">1</code> by default.  This variable controls
	  how directories are cached by the system.  Most directories
	  are small, using just a single fragment (typically 1 K)
	  in the file system and typically 512 bytes in the
	  buffer cache.  With this variable turned off, the buffer
	  cache will only cache a fixed number of directories, even
	  if the system has a huge amount of memory.  When turned on,
	  this <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> allows the buffer cache to use the
	  <acronym class="acronym">VM</acronym> page cache to cache the directories,
	  making all the memory available for caching directories.
	  However, the minimum in-core memory used to cache a
	  directory is the physical page size (typically 4 K)
	  rather than 512  bytes.  Keeping this option enabled
	  is recommended if the system is running any services which
	  manipulate large numbers of files.  Such services can
	  include web caches, large mail systems, and news systems.
	  Keeping this option on will generally not reduce
	  performance, even with the wasted memory, but one should
	  experiment to find out.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55611256"></a>11.10.1.2. <code class="varname">vfs.write_behind</code></h4></div></div></div><a id="idp55612024" class="indexterm"></a><p>The <code class="varname">vfs.write_behind</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	  variable
	  defaults to <code class="literal">1</code> (on).  This tells the file
	  system to issue media writes as full clusters are collected,
	  which typically occurs when writing large sequential files.
	  This avoids saturating the buffer cache with dirty buffers
	  when it would not benefit I/O performance.  However, this
	  may stall processes and under certain circumstances should
	  be turned off.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55614968"></a>11.10.1.3. <code class="varname">vfs.hirunningspace</code></h4></div></div></div><a id="idp55615736" class="indexterm"></a><p>The <code class="varname">vfs.hirunningspace</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	  variable determines how much outstanding write I/O may be
	  queued to disk controllers system-wide at any given
	  instance.  The default is usually sufficient, but on
	  machines with many disks, try bumping it up to four or five
	  <span class="emphasis"><em>megabytes</em></span>.  Setting too high a value
	  which exceeds the buffer cache's write threshold can lead
	  to bad clustering performance.  Do not set this value
	  arbitrarily high as higher write values may add latency to
	  reads occurring at the same time.</p><p>There are various other buffer cache and
	  <acronym class="acronym">VM</acronym> page cache related <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	  values.  Modifying these values is not recommended as the
	  <acronym class="acronym">VM</acronym> system does a good job of
	  automatically tuning itself.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55620600"></a>11.10.1.4. <code class="varname">vm.swap_idle_enabled</code></h4></div></div></div><a id="idp55621368" class="indexterm"></a><p>The <code class="varname">vm.swap_idle_enabled</code>
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable is useful in large multi-user
	  systems with many active login users and lots of idle
	  processes.  Such systems tend to generate continuous
	  pressure on free memory reserves.  Turning this feature on
	  and tweaking the swapout hysteresis (in idle seconds) via
	  <code class="varname">vm.swap_idle_threshold1</code> and
	  <code class="varname">vm.swap_idle_threshold2</code> depresses the
	  priority of memory pages associated with idle processes more
	  quickly then the normal pageout algorithm.  This gives a
	  helping hand to the pageout daemon.  Only turn this option
	  on if needed, because the tradeoff is essentially pre-page
	  memory sooner rather than later which eats more swap and
	  disk bandwidth.  In a small system this option will have a
	  determinable effect, but in a large system that is already
	  doing moderate paging, this option allows the
	  <acronym class="acronym">VM</acronym> system to stage whole processes into
	  and out of memory easily.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55637368"></a>11.10.1.5. <code class="varname">hw.ata.wc</code></h4></div></div></div><a id="idp55638136" class="indexterm"></a><p>Turning off <acronym class="acronym">IDE</acronym> write caching reduces
	  write bandwidth to <acronym class="acronym">IDE</acronym> disks, but may
	  sometimes be necessary due to data consistency issues
	  introduced by hard drive vendors.  The problem is that
	  some <acronym class="acronym">IDE</acronym> drives lie about when a write
	  completes.  With <acronym class="acronym">IDE</acronym> write caching
	  turned on, <acronym class="acronym">IDE</acronym> hard drives write data
	  to disk out of order and will sometimes delay writing some
	  blocks indefinitely when under heavy disk load.  A crash or
	  power failure may cause serious file system corruption.
	  Check the default on the system by observing the
	  <code class="varname">hw.ata.wc</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable.  If
	  <acronym class="acronym">IDE</acronym> write caching is turned off, one can
	  set this read-only variable to
	  <code class="literal">1</code> in
	  <code class="filename">/boot/loader.conf</code> in order to enable
	  it at boot time.</p><p>For more information, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ata&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ata</span>(4)</span></a>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55649016"></a>11.10.1.6. <code class="literal">SCSI_DELAY</code>
	  (<code class="varname">kern.cam.scsi_delay</code>)</h4></div></div></div><a id="idp55650296" class="indexterm"></a><a id="idp55651192" class="indexterm"></a><p>The <code class="literal">SCSI_DELAY</code> kernel configuration
	  option may be used to reduce system boot times.  The
	  defaults are fairly high and can be responsible for
	  <code class="literal">15</code> seconds of delay in the boot process.
	  Reducing it to <code class="literal">5</code> seconds usually works
	  with modern drives.  The
	  <code class="varname">kern.cam.scsi_delay</code> boot time tunable
	  should be used.  The tunable and kernel configuration
	  option accept values in terms of
	  <span class="emphasis"><em>milliseconds</em></span> and
	  <span class="emphasis"><em>not</em></span>
	  <span class="emphasis"><em>seconds</em></span>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="soft-updates"></a>11.10.2. Soft Updates</h3></div></div></div><a id="idp55660792" class="indexterm"></a><a id="idp55661304" class="indexterm"></a><p>To fine-tune a file system, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a>.  This
	program has many different options.  To toggle Soft Updates
	on and off, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -n enable /filesystem</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tunefs -n disable /filesystem</code></strong></pre><p>A file system cannot be modified with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> while
	it is mounted.  A good time to enable Soft Updates is before
	any partitions have been mounted, in single-user mode.</p><p>Soft Updates is recommended for <acronym class="acronym">UFS</acronym>
	file systems as it drastically improves meta-data performance,
	mainly file creation and deletion, through the use of a memory
	cache.  There are two downsides to Soft Updates to be aware
	of.  First, Soft Updates guarantee file system consistency
	in the case of a crash, but could easily be several seconds
	or even a minute behind updating the physical disk.  If the
	system crashes, unwritten data may be lost.  Secondly, Soft
	Updates delay the freeing of file system blocks.  If the
	root file system is almost full, performing a major update,
	such as <code class="command">make installworld</code>, can cause the
	file system to run out of space and the update to fail.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55692152"></a>11.10.2.1. More Details About Soft Updates</h4></div></div></div><a id="idp55692792" class="indexterm"></a><p>Meta-data updates are updates to non-content data like
	  inodes or directories.  There are two traditional approaches
	  to writing a file system's meta-data back to disk.</p><p>Historically, the default behavior was to write out
	  meta-data updates synchronously.  If a directory changed,
	  the system waited until the change was actually written to
	  disk.  The file data buffers (file contents) were passed
	  through the buffer cache and backed up to disk later on
	  asynchronously.  The advantage of this implementation is
	  that it operates safely.  If there is a failure during an
	  update, meta-data is always in a consistent state.  A
	  file is either created completely or not at all.  If the
	  data blocks of a file did not find their way out of the
	  buffer cache onto the disk by the time of the crash,
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> recognizes this and repairs the file system
	  by setting the file length to <code class="literal">0</code>.
	  Additionally, the implementation is clear and simple.  The
	  disadvantage is that meta-data changes are slow.  For
	  example, <code class="command">rm -r</code> touches all the files in a
	  directory sequentially, but each directory change will be
	  written synchronously to the disk.  This includes updates to
	  the directory itself, to the inode table, and possibly to
	  indirect blocks allocated by the file.  Similar
	  considerations apply for unrolling large hierarchies using
	  <code class="command">tar -x</code>.</p><p>The second approach is to use asynchronous meta-data
	  updates.  This is the default for a <acronym class="acronym">UFS</acronym>
	  file system mounted with <code class="command">mount -o async</code>.
	  Since all meta-data updates are also passed through the
	  buffer cache, they will be intermixed with the updates of
	  the file content data.  The advantage of this
	  implementation is there is no need to wait until each
	  meta-data update has been written to disk, so all operations
	  which cause huge amounts of meta-data updates work much
	  faster than in the synchronous case.  This implementation
	  is still clear and simple, so there is a low risk for bugs
	  creeping into the code.  The disadvantage is that there is
	  no guarantee for a consistent state of the file system.
	  If there is a failure during an operation that updated
	  large amounts of meta-data, like a power failure or someone
	  pressing the reset button, the file system will be left
	  in an unpredictable state.  There is no opportunity to
	  examine the state of the file system when the system comes
	  up again as the data blocks of a file could already have
	  been written to the disk while the updates of the inode
	  table or the associated directory were not.  It is
	  impossible to implement a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> which is able to
	  clean up the resulting chaos because the necessary
	  information is not available on the disk.  If the file
	  system has been damaged beyond repair, the only choice
	  is to reformat it and restore from backup.</p><p>The usual solution for this problem is to implement
	  <span class="emphasis"><em>dirty region logging</em></span>, which is also
	  referred to as <span class="emphasis"><em>journaling</em></span>.
	  Meta-data updates are still written synchronously, but only
	  into a small region of the disk.  Later on, they are moved
	  to their proper location.  Because the logging area is a
	  small, contiguous region on the disk, there are no long
	  distances for the disk heads to move, even during heavy
	  operations, so these operations are quicker than synchronous
	  updates.  Additionally, the complexity of the implementation
	  is limited, so the risk of bugs being present is low.  A
	  disadvantage is that all meta-data is written twice, once
	  into the logging region and once to the proper location, so
	  performance <span class="quote">&#8220;<span class="quote">pessimization</span>&#8221;</span> might result.  On
	  the other hand, in case of a crash, all pending meta-data
	  operations can be either quickly rolled back or completed
	  from the logging area after the system comes up again,
	  resulting in a fast file system startup.</p><p>Kirk McKusick, the developer of Berkeley
	  <acronym class="acronym">FFS</acronym>, solved this problem with Soft
	  Updates.  All pending meta-data updates are kept in memory
	  and written out to disk in a sorted sequence
	  (<span class="quote">&#8220;<span class="quote">ordered meta-data updates</span>&#8221;</span>).  This has the
	  effect that, in case of heavy meta-data operations, later
	  updates to an item <span class="quote">&#8220;<span class="quote">catch</span>&#8221;</span> the earlier ones
	  which are still in memory and have not already been written
	  to disk.  All operations are generally performed in memory
	  before the update is written to disk and the data blocks are
	  sorted according to their position so that they will not be
	  on the disk ahead of their meta-data.  If the system
	  crashes, an implicit <span class="quote">&#8220;<span class="quote">log rewind</span>&#8221;</span> causes all
	  operations which were not written to the disk appear as if
	  they never happened.  A consistent file system state is
	  maintained that appears to be the one of 30 to 60 seconds
	  earlier.  The algorithm used guarantees that all resources
	  in use are marked as such in their blocks and inodes.
	  After a crash, the only resource allocation error that
	  occurs is that resources are marked as <span class="quote">&#8220;<span class="quote">used</span>&#8221;</span>
	  which are actually <span class="quote">&#8220;<span class="quote">free</span>&#8221;</span>.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>
	  recognizes this situation, and frees the resources that
	  are no longer used.  It is safe to ignore the dirty state
	  of the file system after a crash by forcibly mounting it
	  with <code class="command">mount -f</code>.  In order to free
	  resources that may be unused, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> needs to be run
	  at a later time.  This is the idea behind the
	  <span class="emphasis"><em>background <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a></em></span>: at system
	  startup time, only a <span class="emphasis"><em>snapshot</em></span> of the
	  file system is recorded and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> is run afterwards.
	  All file systems can then be mounted
	  <span class="quote">&#8220;<span class="quote">dirty</span>&#8221;</span>, so the system startup proceeds in
	  multi-user mode.  Then, background <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> is
	  scheduled for all file systems where this is required, to
	  free resources that may be unused.  File systems that do
	  not use Soft Updates still need the usual foreground
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>.</p><p>The advantage is that meta-data operations are nearly
	  as fast as asynchronous updates and are faster than
	  <span class="emphasis"><em>logging</em></span>, which has to write the
	  meta-data twice.  The disadvantages are the complexity of
	  the code, a higher memory consumption, and some
	  idiosyncrasies.  After a crash, the state of the file
	  system appears to be somewhat <span class="quote">&#8220;<span class="quote">older</span>&#8221;</span>.  In
	  situations where the standard synchronous approach would
	  have caused some zero-length files to remain after the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>, these files do not exist at all with Soft
	  Updates because neither the meta-data nor the file contents
	  have been written to disk.  Disk space is not released until
	  the updates have been written to disk, which may take place
	  some time after running <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rm</span>(1)</span></a>.  This may cause problems
	  when installing large amounts of data on a file system
	  that does not have enough free space to hold all the files
	  twice.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-kernel-limits"></a>11.11. Tuning Kernel Limits</h2></div></div></div><a id="idp55737464" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="file-process-limits"></a>11.11.1. File/Process Limits</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="kern-maxfiles"></a>11.11.1.1. <code class="varname">kern.maxfiles</code></h4></div></div></div><a id="idp55740280" class="indexterm"></a><p>The <code class="varname">kern.maxfiles</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	  variable can be raised or lowered based upon system
	  requirements.  This variable indicates the maximum number
	  of file descriptors on the system.  When the file descriptor
	  table is full, <span class="errorname">file: table is full</span>
	  will show up repeatedly in the system message buffer, which
	  can be viewed using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>.</p><p>Each open file, socket, or fifo uses one file
	  descriptor.  A large-scale production server may easily
	  require many thousands of file descriptors, depending on the
	  kind and number of services running concurrently.</p><p>In older FreeBSD releases, the default value of
	  <code class="varname">kern.maxfiles</code> is derived from
	  <code class="option">maxusers</code> in the kernel configuration file.
	  <code class="varname">kern.maxfiles</code> grows proportionally to the
	  value of <code class="option">maxusers</code>.  When compiling a custom
	  kernel, consider setting this kernel configuration option
	  according to the use of the system.  From this number, the
	  kernel is given most of its pre-defined limits.  Even though
	  a production machine may not have 256 concurrent users, the
	  resources needed may be similar to a high-scale web
	  server.</p><p>The read-only <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable
	  <code class="varname">kern.maxusers</code> is automatically sized at
	  boot based on the amount of memory available in the system,
	  and may be determined at run-time by inspecting the value
	  of <code class="varname">kern.maxusers</code>.  Some systems require
	  larger or smaller values of
	  <code class="varname">kern.maxusers</code> and values of
	  <code class="literal">64</code>, <code class="literal">128</code>, and
	  <code class="literal">256</code> are not uncommon.  Going above
	  <code class="literal">256</code> is not recommended  unless a huge
	  number of file descriptors is needed.  Many of the tunable
	  values set to their defaults by
	  <code class="varname">kern.maxusers</code> may be individually
	  overridden at boot-time or run-time in
	  <code class="filename">/boot/loader.conf</code>.  Refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> and
	  <code class="filename">/boot/defaults/loader.conf</code> for more
	  details and some hints.</p><p>In older releases, the system will auto-tune
	  <code class="literal">maxusers</code> if it is set to
	  <code class="literal">0</code>.
	  <a href="#ftn.idp55752952" class="footnote" id="idp55752952"><sup class="footnote">[2]</sup></a>.  When
	  setting this option, set <code class="literal">maxusers</code> to
	  at least <code class="literal">4</code>, especially if the system
	  runs <span class="application">Xorg</span> or is used to
	  compile software.  The most important table set by
	  <code class="literal">maxusers</code> is the maximum number of
	  processes, which is set to
	  <code class="literal">20 + 16 * maxusers</code>.  If
	  <code class="literal">maxusers</code> is set to <code class="literal">1</code>,
	  there can only be
	  <code class="literal">36</code> simultaneous processes, including
	  the <code class="literal">18</code> or so that the system starts up
	  at boot time and the <code class="literal">15</code> or so used by
	  <span class="application">Xorg</span>.  Even a simple task like
	  reading a manual page will start up nine processes to
	  filter, decompress, and view it.  Setting
	  <code class="literal">maxusers</code> to <code class="literal">64</code> allows
	  up to <code class="literal">1044</code> simultaneous processes, which
	  should be enough for nearly all uses.  If, however, the
	  <span class="errortype">proc table full</span> error is displayed
	  when trying to start another program, or a server is
	  running with a large number of simultaneous users, increase
	  the number and rebuild.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="literal">maxusers</code> does
	    <span class="emphasis"><em>not</em></span> limit the number of users which
	    can log into the machine.  It instead sets various table
	    sizes to reasonable values considering the maximum number
	    of users on the system and how many processes each user
	    will be running.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55770232"></a>11.11.1.2. <code class="varname">kern.ipc.soacceptqueue</code></h4></div></div></div><a id="idp55771000" class="indexterm"></a><p>The <code class="varname">kern.ipc.soacceptqueue</code>
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable limits the size of the listen queue
	  for accepting new <code class="literal">TCP</code> connections.  The
	  default value of <code class="literal">128</code> is typically too low
	  for robust handling of new connections on a heavily loaded
	  web server.  For such environments, it is recommended to
	  increase this value to <code class="literal">1024</code> or higher.  A
	  service such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendmail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></a>, or
	  <span class="application">Apache</span> may itself limit the
	  listen queue size, but will often have a directive in its
	  configuration file to adjust the queue size.  Large listen
	  queues do a better job of avoiding Denial of Service
	  (<acronym class="acronym">DoS</acronym>) attacks.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="nmbclusters"></a>11.11.2. Network Limits</h3></div></div></div><p>The <code class="literal">NMBCLUSTERS</code> kernel configuration
	option dictates the amount of network Mbufs available to the
	system.  A heavily-trafficked server with a low number of
	Mbufs will hinder performance.  Each cluster represents
	approximately 2 K of memory, so a value of
	<code class="literal">1024</code> represents <code class="literal">2</code>
	megabytes of kernel memory reserved for network buffers.  A
	simple calculation can be done to figure out how many are
	needed.  A web server which maxes out at
	<code class="literal">1000</code> simultaneous connections where each
	connection uses a 6 K receive and 16 K send buffer,
	requires approximately 32 MB worth of network buffers
	to cover the web server.  A good rule of thumb is to multiply
	by <code class="literal">2</code>, so
	2x32 MB / 2 KB =
	64 MB / 2 kB =
	<code class="literal">32768</code>.  Values between
	<code class="literal">4096</code> and <code class="literal">32768</code> are
	recommended for machines with greater amounts of memory.
	Never specify an arbitrarily high value for this parameter
	as it could lead to a boot time crash.  To observe network
	cluster usage, use <code class="option">-m</code> with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">netstat</span>(1)</span></a>.</p><p>The <code class="varname">kern.ipc.nmbclusters</code> loader tunable
	should be used to tune this at boot time.  Only older versions
	of FreeBSD will require the use of the
	<code class="literal">NMBCLUSTERS</code> kernel <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">config</span>(8)</span></a>
	option.</p><p>For busy servers that make extensive use of the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendfile</span>(2)</span></a> system call, it may be necessary to increase
	the number of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendfile</span>(2)</span></a> buffers via the
	<code class="literal">NSFBUFS</code> kernel configuration option or by
	setting its value in <code class="filename">/boot/loader.conf</code>
	(see <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> for details).  A common indicator that
	this parameter needs to be adjusted is when processes are seen
	in the <code class="literal">sfbufa</code> state.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	variable <code class="varname">kern.ipc.nsfbufs</code> is read-only.
	This parameter nominally scales with
	<code class="varname">kern.maxusers</code>, however it may be necessary
	to tune accordingly.</p><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">Even though a socket has been marked as non-blocking,
	  calling <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendfile</span>(2)</span></a> on the non-blocking socket may
	  result in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sendfile&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sendfile</span>(2)</span></a> call blocking until enough
	  <code class="literal">struct sf_buf</code>'s are made
	  available.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55812472"></a>11.11.2.1. <code class="varname">net.inet.ip.portrange.*</code></h4></div></div></div><a id="idp55813240" class="indexterm"></a><p>The <code class="varname">net.inet.ip.portrange.*</code>
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variables control the port number ranges
	  automatically bound to <code class="literal">TCP</code> and
	  <code class="literal">UDP</code> sockets.  There are three ranges: a
	  low range, a default range, and a high range.  Most network
	  programs use the default range which is controlled by
	  <code class="varname">net.inet.ip.portrange.first</code> and
	  <code class="varname">net.inet.ip.portrange.last</code>, which default
	  to <code class="literal">1024</code> and <code class="literal">5000</code>,
	  respectively.  Bound port ranges are used for outgoing
	  connections and it is possible to run the system out of
	  ports under certain circumstances.  This most commonly
	  occurs when running a heavily loaded web proxy.  The port
	  range is not an issue when running a server which handles
	  mainly incoming connections, such as a web server, or has
	  a limited number of outgoing connections, such as a mail
	  relay.  For situations where there is a shortage of ports,
	  it is recommended to increase
	  <code class="varname">net.inet.ip.portrange.last</code> modestly.  A
	  value of <code class="literal">10000</code>, <code class="literal">20000</code>
	  or <code class="literal">30000</code> may be reasonable.  Consider
	  firewall effects when changing the port range.  Some
	  firewalls may block large ranges of ports, usually
	  low-numbered ports, and expect systems to use higher ranges
	  of ports for outgoing connections.  For this reason, it
	  is not recommended that the value of
	  <code class="varname">net.inet.ip.portrange.first</code> be
	  lowered.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55299704"></a>11.11.2.2. <code class="literal">TCP</code> Bandwidth Delay Product</h4></div></div></div><a id="idp55300600" class="indexterm"></a><p><code class="literal">TCP</code> bandwidth delay product limiting
	  can be enabled by setting the
	  <code class="varname">net.inet.tcp.inflight.enable</code>
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable to <code class="literal">1</code>.  This
	  instructs the system to attempt to calculate the bandwidth
	  delay product for each connection and limit the amount of
	  data queued to the network to just the amount required to
	  maintain optimum throughput.</p><p>This feature is useful when serving data over modems,
	  Gigabit Ethernet, high speed <code class="literal">WAN</code> links,
	  or any other link with a high bandwidth delay product,
	  especially when also using window scaling or when a large
	  send window has been configured.  When enabling this option,
	  also set <code class="varname">net.inet.tcp.inflight.debug</code> to
	  <code class="literal">0</code> to disable debugging.  For production
	  use, setting <code class="varname">net.inet.tcp.inflight.min</code>
	  to at least <code class="literal">6144</code> may be beneficial.
	  Setting high minimums may effectively disable bandwidth
	  limiting, depending on the link.  The limiting feature
	  reduces the amount of data built up in intermediate route
	  and switch packet queues and reduces the amount of data
	  built up in the local host's interface queue.  With fewer
	  queued packets, interactive connections, especially over
	  slow modems, will operate with lower
	  <span class="emphasis"><em>Round Trip Times</em></span>.  This feature only
	  effects server side data transmission such as uploading.
	  It has no effect on data reception or downloading.</p><p>Adjusting <code class="varname">net.inet.tcp.inflight.stab</code>
	  is <span class="emphasis"><em>not</em></span> recommended.  This parameter
	  defaults to <code class="literal">20</code>, representing 2 maximal
	  packets added to the bandwidth delay product window
	  calculation.  The additional window is required to stabilize
	  the algorithm and improve responsiveness to changing
	  conditions, but it can also result in higher <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>
	  times over slow links, though still much lower than without
	  the inflight algorithm.  In such cases, try reducing this
	  parameter to <code class="literal">15</code>, <code class="literal">10</code>,
	  or <code class="literal">5</code> and reducing
	  <code class="varname">net.inet.tcp.inflight.min</code> to a value such
	  as <code class="literal">3500</code> to get the desired effect.
	  Reducing these parameters should be done as a last resort
	  only.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55823480"></a>11.11.3. Virtual Memory</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55824120"></a>11.11.3.1. <code class="varname">kern.maxvnodes</code></h4></div></div></div><p>A vnode is the internal representation of a file or
	  directory.  Increasing the number of vnodes available to
	  the operating system reduces disk I/O.  Normally, this is
	  handled by the operating system and does not need to be
	  changed.  In some cases where disk I/O is a bottleneck and
	  the system is running out of vnodes, this setting needs
	  to be increased.  The amount of inactive and free
	  <acronym class="acronym">RAM</acronym> will need to be taken into
	  account.</p><p>To see the current number of vnodes in use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl vfs.numvnodes</code></strong>
vfs.numvnodes: 91349</pre><p>To see the maximum vnodes:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl kern.maxvnodes</code></strong>
kern.maxvnodes: 100000</pre><p>If the current vnode usage is near the maximum, try
	  increasing <code class="varname">kern.maxvnodes</code> by a value of
	  <code class="literal">1000</code>.  Keep an eye on the number of
	  <code class="varname">vfs.numvnodes</code>.  If it climbs up to the
	  maximum again, <code class="varname">kern.maxvnodes</code> will need
	  to be increased further.  Otherwise, a shift in memory
	  usage as reported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> should be visible and
	  more memory should be active.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="adding-swap-space"></a>11.12. Adding Swap Space</h2></div></div></div><p>Sometimes a system requires more swap space.  This section
      describes two methods to increase swap space: adding swap to an
      existing partition or new hard drive, and creating a swap file
      on an existing partition.</p><p>For information on how to encrypt swap space, which options
      exist, and why it should be done, refer to <a class="xref" href="#swap-encrypting" title="17.13. Encrypting Swap">Section 17.13, &#8220;Encrypting Swap&#8221;</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="new-drive-swap"></a>11.12.1. Swap on a New Hard Drive or Existing Partition</h3></div></div></div><p>Adding a new hard drive for swap gives better performance
	than using a partition on an existing drive.  Setting up
	partitions and hard drives is explained in <a class="xref" href="#disks-adding" title="17.2. Adding Disks">Section 17.2, &#8220;Adding Disks&#8221;</a> while <a class="xref" href="#configtuning-initial" title="2.6.1. Designing the Partition Layout">Section 2.6.1, &#8220;Designing the Partition Layout&#8221;</a> discusses partition layouts
	and swap partition size considerations.</p><p>Use <code class="command">swapon</code> to add a swap partition to
	the system.  For example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>swapon <em class="replaceable"><code>/dev/ada1s1b</code></em></code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is possible to use any partition not currently
	  mounted, even if it already contains data.  Using
	  <code class="command">swapon</code> on a partition that contains data
	  will overwrite and destroy that data.  Make sure that the
	  partition to be added as swap is really the intended
	  partition before running <code class="command">swapon</code>.</p></div><p>To automatically add this swap partition on boot, add an
	entry to <code class="filename">/etc/fstab</code>:</p><pre class="programlisting"><em class="replaceable"><code>/dev/ada1s1b</code></em>	none	swap	sw	0	0</pre><p>See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> for an explanation of the entries in
	<code class="filename">/etc/fstab</code>.  More information about
	<code class="command">swapon</code> can be found in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=swapon&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">swapon</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="create-swapfile"></a>11.12.2. Creating a Swap File</h3></div></div></div><p>These examples create a 512M swap file called
	<code class="filename">/usr/swap0</code> instead of using a
	partition.</p><p>Using swap files requires that the module needed by
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> has either been built into the kernel or has been
	loaded before swap is enabled.  See
	<a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a> for information about building
	a custom kernel.</p><div class="example"><a id="swapfile-10-and-later"></a><div class="example-title">Example 11.2. Creating a Swap File</div><div class="example-contents"><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create the swap file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=<em class="replaceable"><code>/usr/swap0</code></em> bs=1m count=<em class="replaceable"><code>512</code></em></code></strong></pre></li><li class="step"><p>Set the proper permissions on the new file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 0600 <em class="replaceable"><code>/usr/swap0</code></em></code></strong></pre></li><li class="step"><p>Inform the system about the swap file by adding a
	      line to <code class="filename">/etc/fstab</code>:</p><pre class="programlisting">md99	none	swap	sw,file=/usr/swap0,late	0	0</pre><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> device <code class="filename">md99</code> is
	      used, leaving lower device numbers available for
	      interactive use.</p></li><li class="step"><p>Swap space will be added on system startup.  To add
	      swap space immediately, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=swapon&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">swapon</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>swapon -aL</code></strong></pre></li></ol></div></div></div><br class="example-break" /></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="acpi-overview"></a>11.13. Power and Resource Management</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Hiten</span> <span class="surname">Pandya</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>It is important to utilize hardware resources in an
      efficient manner.  Power and resource management allows the
      operating system to monitor system limits and to possibly
      provide an alert if the system temperature increases
      unexpectedly.  An early specification for providing power
      management was the Advanced Power Management
      (<acronym class="acronym">APM</acronym>) facility.  <acronym class="acronym">APM</acronym>
      controls the power usage of a system based on its activity.
      However, it was difficult and inflexible for operating systems
      to manage the power usage and thermal properties of a system.
      The hardware was managed by the <acronym class="acronym">BIOS</acronym> and the
      user had limited configurability and visibility into the power
      management settings.  The <acronym class="acronym">APM</acronym>
      <acronym class="acronym">BIOS</acronym> is supplied by the vendor and is
      specific to the hardware platform.  An <acronym class="acronym">APM</acronym>
      driver in the operating system mediates access to the
      <acronym class="acronym">APM</acronym> Software Interface, which allows
      management of power levels.</p><p>There are four major problems in <acronym class="acronym">APM</acronym>.
      First, power management is done by the vendor-specific
      <acronym class="acronym">BIOS</acronym>, separate from the operating system.
      For example, the user can set idle-time values for a hard drive
      in the <acronym class="acronym">APM</acronym> <acronym class="acronym">BIOS</acronym> so that,
      when exceeded, the <acronym class="acronym">BIOS</acronym> spins down the hard
      drive without the consent of the operating system.  Second, the
      <acronym class="acronym">APM</acronym> logic is embedded in the
      <acronym class="acronym">BIOS</acronym>, and it operates outside the scope of
      the operating system.  This means that users can only fix
      problems in the <acronym class="acronym">APM</acronym>
      <acronym class="acronym">BIOS</acronym> by flashing a new one into the
      <acronym class="acronym">ROM</acronym>, which is a dangerous procedure with the
      potential to leave the system in an unrecoverable state if it
      fails.  Third, <acronym class="acronym">APM</acronym> is a vendor-specific
      technology, meaning that there is a lot of duplication of
      efforts and bugs found in one vendor's <acronym class="acronym">BIOS</acronym>
      may not be solved in others.  Lastly, the <acronym class="acronym">APM</acronym>
      <acronym class="acronym">BIOS</acronym> did not have enough room to implement a
      sophisticated power policy or one that can adapt well to the
      purpose of the machine.</p><p>The Plug and Play <acronym class="acronym">BIOS</acronym>
      (<acronym class="acronym">PNPBIOS</acronym>) was unreliable in many situations.
      <acronym class="acronym">PNPBIOS</acronym> is 16-bit technology, so the
      operating system has to use 16-bit emulation in order to
      interface with <acronym class="acronym">PNPBIOS</acronym> methods.  FreeBSD
      provides an <acronym class="acronym">APM</acronym> driver as
      <acronym class="acronym">APM</acronym> should still be used for systems
      manufactured at or before the year 2000.  The driver is
      documented in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=apm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">apm</span>(4)</span></a>.</p><a id="idp55940728" class="indexterm"></a><a id="idp55941496" class="indexterm"></a><p>The successor to <acronym class="acronym">APM</acronym> is the Advanced
      Configuration and Power Interface (<acronym class="acronym">ACPI</acronym>).
      <acronym class="acronym">ACPI</acronym> is a standard written by an alliance of
      vendors to provide an interface for hardware resources and power
      management.  It is a key element in <span class="emphasis"><em>Operating
	System-directed configuration and Power Management</em></span>
      as it provides more control and flexibility to the operating
      system.</p><p>This chapter demonstrates how to configure
      <acronym class="acronym">ACPI</acronym> on FreeBSD.  It then offers some tips on
      how to debug <acronym class="acronym">ACPI</acronym> and how to submit a problem
      report containing debugging information so that developers can
      diagnosis and fix <acronym class="acronym">ACPI</acronym> issues.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="acpi-config"></a>11.13.1. Configuring <acronym class="acronym">ACPI</acronym></h3></div></div></div><p>In FreeBSD the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> driver is loaded by default at
	system boot and should <span class="emphasis"><em>not</em></span> be compiled
	into the kernel.  This driver cannot be unloaded after boot
	because the system bus uses it for various hardware
	interactions.  However, if the system is experiencing
	problems, <acronym class="acronym">ACPI</acronym> can be disabled altogether
	by rebooting after setting
	<code class="literal">hint.acpi.0.disabled="1"</code> in
	<code class="filename">/boot/loader.conf</code> or by setting this
	variable at the loader prompt, as described in <a class="xref" href="#boot-loader" title="12.2.3. Stage Three">Section 12.2.3, &#8220;Stage Three&#8221;</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><acronym class="acronym">ACPI</acronym> and <acronym class="acronym">APM</acronym>
	  cannot coexist and should be used separately.  The last one
	  to load will terminate if the driver notices the other is
	  running.</p></div><p><acronym class="acronym">ACPI</acronym> can be used to put the system into
	a sleep mode with <code class="command">acpiconf</code>, the
	<code class="option">-s</code> flag, and a number from
	<code class="literal">1</code> to <code class="literal">5</code>.  Most users only
	need <code class="literal">1</code> (quick suspend to
	<acronym class="acronym">RAM</acronym>) or <code class="literal">3</code> (suspend to
	<acronym class="acronym">RAM</acronym>).  Option <code class="literal">5</code> performs
	a soft-off which is the same as running
	<code class="command">halt -p</code>.</p><p>Other options are available using
	<code class="command">sysctl</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpiconf&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpiconf</span>(8)</span></a> for more information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-comprob"></a>11.13.2. Common Problems</h3></div></div></div><a id="idp55979640" class="indexterm"></a><p><acronym class="acronym">ACPI</acronym> is present in all modern computers
	that conform to the ia32 (x86) and amd64
	(<acronym class="acronym">AMD</acronym>) architectures.  The full standard has
	many features including <acronym class="acronym">CPU</acronym> performance
	management, power planes control, thermal zones, various
	battery systems, embedded controllers, and bus enumeration.
	Most systems implement less than the full standard.  For
	instance, a desktop system usually only implements bus
	enumeration while a laptop might have cooling and battery
	management support as well.  Laptops also have suspend and
	resume, with their own associated complexity.</p><p>An <acronym class="acronym">ACPI</acronym>-compliant system has various
	components.  The <acronym class="acronym">BIOS</acronym> and chipset vendors
	provide various fixed tables, such as <acronym class="acronym">FADT</acronym>,
	in memory that specify things like the <acronym class="acronym">APIC</acronym>
	map (used for <acronym class="acronym">SMP</acronym>), config registers, and
	simple configuration values.  Additionally, a bytecode table,
	the Differentiated System Description Table
	<acronym class="acronym">DSDT</acronym>, specifies a tree-like name space of
	devices and methods.</p><p>The <acronym class="acronym">ACPI</acronym> driver must parse the fixed
	tables, implement an interpreter for the bytecode, and modify
	device drivers and the kernel to accept information from the
	<acronym class="acronym">ACPI</acronym> subsystem.  For FreeBSD, <span class="trademark">Intel</span>® has
	provided an interpreter (<acronym class="acronym">ACPI-CA</acronym>) that is
	shared with <span class="trademark">Linux</span>® and NetBSD.  The path to the
	<acronym class="acronym">ACPI-CA</acronym> source code is
	<code class="filename">src/sys/contrib/dev/acpica</code>.  The glue
	code that allows <acronym class="acronym">ACPI-CA</acronym> to work on FreeBSD is
	in <code class="filename">src/sys/dev/acpica/Osd</code>.  Finally,
	drivers that implement various <acronym class="acronym">ACPI</acronym> devices
	are found in <code class="filename">src/sys/dev/acpica</code>.</p><a id="idp55989496" class="indexterm"></a><p>For <acronym class="acronym">ACPI</acronym> to work correctly, all the
	parts have to work correctly.  Here are some common problems,
	in order of frequency of appearance, and some possible
	workarounds or fixes.  If a fix does not resolve the issue,
	refer to <a class="xref" href="#ACPI-submitdebug" title="11.13.4. Getting and Submitting Debugging Info">Section 11.13.4, &#8220;Getting and Submitting Debugging Info&#8221;</a> for instructions
	on how to submit a bug report.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55991800"></a>11.13.2.1. Mouse Issues</h4></div></div></div><p>In some cases, resuming from a suspend operation will
	  cause the mouse to fail.  A known work around is to add
	  <code class="literal">hint.psm.0.flags="0x3000"</code> to
	  <code class="filename">/boot/loader.conf</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp55993848"></a>11.13.2.2. Suspend/Resume</h4></div></div></div><p><acronym class="acronym">ACPI</acronym> has three suspend to
	  <acronym class="acronym">RAM</acronym> (<acronym class="acronym">STR</acronym>) states,
	  <code class="literal">S1</code>-<code class="literal">S3</code>, and one suspend
	  to disk state (<acronym class="acronym">STD</acronym>), called
	  <code class="literal">S4</code>.  <acronym class="acronym">STD</acronym> can be
	  implemented in two separate ways.  The
	  <code class="literal">S4</code><acronym class="acronym">BIOS</acronym> is a
	  <acronym class="acronym">BIOS</acronym>-assisted suspend to disk and
	  <code class="literal">S4</code><acronym class="acronym">OS</acronym> is implemented
	  entirely by the operating system.  The normal state the
	  system is in when plugged in but not powered up is
	  <span class="quote">&#8220;<span class="quote">soft off</span>&#8221;</span> (<code class="literal">S5</code>).</p><p>Use <code class="command">sysctl hw.acpi</code> to check for the
	  suspend-related items.  These example results are from a
	  Thinkpad:</p><pre class="screen">hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0</pre><p>Use <code class="command">acpiconf -s</code> to test
	  <code class="literal">S3</code>, <code class="literal">S4</code>, and
	  <code class="literal">S5</code>.  An <code class="option">s4bios</code> of one
	  (<code class="literal">1</code>) indicates
	  <code class="literal">S4</code><acronym class="acronym">BIOS</acronym> support instead
	  of <code class="literal">S4</code> operating system support.</p><p>When testing suspend/resume, start with
	  <code class="literal">S1</code>, if supported.  This state is most
	  likely to work since it does not require much driver
	  support.  No one has implemented <code class="literal">S2</code>,
	  which is similar to <code class="literal">S1</code>.  Next, try
	  <code class="literal">S3</code>.  This is the deepest
	  <acronym class="acronym">STR</acronym> state and requires a lot of driver
	  support to properly reinitialize the hardware.</p><p>A common problem with suspend/resume is that many device
	  drivers do not save, restore, or reinitialize their
	  firmware, registers, or device memory properly.  As a first
	  attempt at debugging the problem, try:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl debug.bootverbose=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl debug.acpi.suspend_bounce=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>acpiconf -s 3</code></strong></pre><p>This test emulates the suspend/resume cycle of all
	  device drivers without actually going into
	  <code class="literal">S3</code> state.  In some cases, problems such
	  as losing firmware state, device watchdog time out, and
	  retrying forever, can be captured with this method.  Note
	  that the system will not really enter <code class="literal">S3</code>
	  state, which means devices may not lose power, and many
	  will work fine even if suspend/resume methods are totally
	  missing, unlike real <code class="literal">S3</code> state.</p><p>Harder cases require additional hardware, such as a
	  serial port and cable for debugging through a serial
	  console, a Firewire port and cable for using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dcons&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dcons</span>(4)</span></a>,
	  and kernel debugging skills.</p><p>To help isolate the problem, unload as many drivers as
	  possible.  If it works, narrow down which driver is the
	  problem by loading drivers until it fails again.  Typically,
	  binary drivers like <code class="filename">nvidia.ko</code>, display
	  drivers, and <acronym class="acronym">USB</acronym> will have the most
	  problems while Ethernet interfaces usually work fine.  If
	  drivers can be properly loaded and unloaded, automate this
	  by putting the appropriate commands in
	  <code class="filename">/etc/rc.suspend</code> and
	  <code class="filename">/etc/rc.resume</code>.  Try setting
	  <code class="option">hw.acpi.reset_video</code> to <code class="literal">1</code>
	  if the display is messed up after resume.  Try setting
	  longer or shorter values for
	  <code class="option">hw.acpi.sleep_delay</code> to see if that
	  helps.</p><p>Try loading a recent <span class="trademark">Linux</span>® distribution to see if
	  suspend/resume works on the same hardware.  If it works on
	  <span class="trademark">Linux</span>®, it is likely a FreeBSD driver problem.  Narrowing down
	  which driver causes the problem will assist developers in
	  fixing the problem.  Since the <acronym class="acronym">ACPI</acronym>
	  maintainers rarely maintain other drivers, such as sound
	  or <acronym class="acronym">ATA</acronym>, any driver problems should also
	  be posted to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a> list and mailed to the
	  driver maintainer.  Advanced users can include debugging
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=printf&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">printf</span>(3)</span></a>s in a problematic driver to track down where
	  in its resume function it hangs.</p><p>Finally, try disabling <acronym class="acronym">ACPI</acronym> and
	  enabling <acronym class="acronym">APM</acronym> instead.  If suspend/resume
	  works with <acronym class="acronym">APM</acronym>, stick with
	  <acronym class="acronym">APM</acronym>, especially on older hardware
	  (pre-2000).  It took vendors a while to get
	  <acronym class="acronym">ACPI</acronym> support correct and older hardware
	  is more likely to have <acronym class="acronym">BIOS</acronym> problems with
	  <acronym class="acronym">ACPI</acronym>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp56043128"></a>11.13.2.3. System Hangs</h4></div></div></div><p>Most system hangs are a result of lost interrupts or an
	  interrupt storm.  Chipsets may have problems based on boot,
	  how the <acronym class="acronym">BIOS</acronym> configures interrupts before
	  correctness of the <acronym class="acronym">APIC</acronym>
	  (<acronym class="acronym">MADT</acronym>) table, and routing of the System
	  Control Interrupt (<acronym class="acronym">SCI</acronym>).</p><a id="idp56045688" class="indexterm"></a><p>Interrupt storms can be distinguished from lost
	  interrupts by checking the output of
	  <code class="command">vmstat -i</code> and looking at the line that
	  has <code class="literal">acpi0</code>.  If the counter is increasing
	  at more than a couple per second, there is an interrupt
	  storm.  If the system appears hung, try breaking to
	  <acronym class="acronym">DDB</acronym> (<span class="keycap"><strong>CTRL</strong></span>+<span class="keycap"><strong>ALT</strong></span>+<span class="keycap"><strong>ESC</strong></span> on console) and type
	  <code class="literal">show interrupts</code>.</p><a id="idp56054136" class="indexterm"></a><p>When dealing with interrupt problems, try disabling
	  <acronym class="acronym">APIC</acronym> support with
	  <code class="literal">hint.apic.0.disabled="1"</code> in
	  <code class="filename">/boot/loader.conf</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp56056952"></a>11.13.2.4. Panics</h4></div></div></div><p>Panics are relatively rare for <acronym class="acronym">ACPI</acronym>
	  and are the top priority to be fixed.  The first step is to
	  isolate the steps to reproduce the panic, if possible, and
	  get a backtrace.  Follow the advice for enabling
	  <code class="literal">options DDB</code> and setting up a serial
	  console in <a class="xref" href="#serialconsole-ddb" title="26.6.4. Entering the DDB Debugger from the Serial Line">Section 26.6.4, &#8220;Entering the DDB Debugger from the Serial Line&#8221;</a> or setting
	  up a dump partition.  To get a backtrace in
	  <acronym class="acronym">DDB</acronym>, use <code class="literal">tr</code>.  When
	  handwriting the backtrace, get at least the last five and
	  the top five lines in the trace.</p><p>Then, try to isolate the problem by booting with
	  <acronym class="acronym">ACPI</acronym> disabled.  If that works, isolate
	  the <acronym class="acronym">ACPI</acronym> subsystem by using various
	  values of <code class="option">debug.acpi.disable</code>.  See
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> for some examples.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp56062328"></a>11.13.2.5. System Powers Up After Suspend or Shutdown</h4></div></div></div><p>First, try setting
	  <code class="literal">hw.acpi.disable_on_poweroff="0"</code> in
	  <code class="filename">/boot/loader.conf</code>.  This keeps
	  <acronym class="acronym">ACPI</acronym> from disabling various events during
	  the shutdown process.  Some systems need this value set to
	  <code class="literal">1</code> (the default) for the same reason.
	  This usually fixes the problem of a system powering up
	  spontaneously after a suspend or poweroff.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-aslanddump"></a>11.13.2.6. BIOS Contains Buggy Bytecode</h4></div></div></div><a id="idp56065784" class="indexterm"></a><p>Some <acronym class="acronym">BIOS</acronym> vendors provide incorrect
	  or buggy bytecode.  This is usually manifested by kernel
	  console messages like this:</p><pre class="screen">ACPI-1287: *** Error: Method execution failed [\\_SB_.PCI0.LPC0.FIGD._STA] \\
(Node 0xc3f6d160), AE_NOT_FOUND</pre><p>Often, these problems may be resolved by updating the
	  <acronym class="acronym">BIOS</acronym> to the latest revision.  Most
	  console messages are harmless, but if there are other
	  problems, like the battery status is not working, these
	  messages are a good place to start looking for
	  problems.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp56069496"></a>11.13.3. Overriding the Default <acronym class="acronym">AML</acronym></h3></div></div></div><p>The <acronym class="acronym">BIOS</acronym> bytecode, known as
	<acronym class="acronym">ACPI</acronym> Machine Language
	(<acronym class="acronym">AML</acronym>), is compiled from a source language
	called <acronym class="acronym">ACPI</acronym> Source Language
	(<acronym class="acronym">ASL</acronym>).  The <acronym class="acronym">AML</acronym> is
	found in the table known as the Differentiated System
	Description Table (<acronym class="acronym">DSDT</acronym>).</p><a id="idp56073464" class="indexterm"></a><p>The goal of FreeBSD is for everyone to have working
	<acronym class="acronym">ACPI</acronym> without any user intervention.
	Workarounds are still being developed for common mistakes made
	by <acronym class="acronym">BIOS</acronym>  vendors.  The <span class="trademark">Microsoft</span>®
	interpreter (<code class="filename">acpi.sys</code> and
	<code class="filename">acpiec.sys</code>) does not strictly check for
	adherence to the standard, and thus many
	<acronym class="acronym">BIOS</acronym> vendors who only test
	<acronym class="acronym">ACPI</acronym> under <span class="trademark">Windows</span>® never fix their
	<acronym class="acronym">ASL</acronym>.  FreeBSD developers continue to identify
	and document which non-standard behavior is allowed by
	<span class="trademark">Microsoft</span>®'s interpreter and replicate it so that FreeBSD can
	work without forcing users to fix the
	<acronym class="acronym">ASL</acronym>.</p><p>To help identify buggy behavior and possibly fix it
	manually, a copy can be made of the system's
	<acronym class="acronym">ASL</acronym>.  To copy the system's
	<acronym class="acronym">ASL</acronym> to a specified file name, use
	<code class="command">acpidump</code> with <code class="option">-t</code>, to show
	the contents of the fixed tables, and <code class="option">-d</code>, to
	disassemble the <acronym class="acronym">AML</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>acpidump -td &gt; <em class="replaceable"><code>my.asl</code></em></code></strong></pre><p>Some <acronym class="acronym">AML</acronym> versions assume the user is
	running <span class="trademark">Windows</span>®.  To override this, set
	<code class="literal">hw.acpi.osname=<em class="replaceable"><code>"Windows
	  2009"</code></em></code> in
	<code class="filename">/boot/loader.conf</code>, using the most recent
	<span class="trademark">Windows</span>® version listed in the <acronym class="acronym">ASL</acronym>.</p><p>Other workarounds may require <code class="filename">my.asl</code>
	to be customized.  If this file is edited, compile the new
	<acronym class="acronym">ASL</acronym> using the following command.  Warnings
	can usually be ignored, but errors are bugs that will usually
	prevent <acronym class="acronym">ACPI</acronym> from working correctly.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iasl -f <em class="replaceable"><code>my.asl</code></em></code></strong></pre><p>Including <code class="option">-f</code> forces creation of the
	<acronym class="acronym">AML</acronym>, even if there are errors during
	compilation.  Some errors, such as missing return statements,
	are automatically worked around by the FreeBSD
	interpreter.</p><p>The default output filename for <code class="command">iasl</code> is
	<code class="filename">DSDT.aml</code>.  Load this file instead of the
	<acronym class="acronym">BIOS</acronym>'s buggy copy, which is still present
	in flash memory, by editing
	<code class="filename">/boot/loader.conf</code> as follows:</p><pre class="programlisting">acpi_dsdt_load="YES"
acpi_dsdt_name="/boot/DSDT.aml"</pre><p>Be sure to copy <code class="filename">DSDT.aml</code> to
	<code class="filename">/boot</code>, then reboot the system.  If this
	fixes the problem, send a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> of the old and new
	<acronym class="acronym">ASL</acronym> to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> so that developers can
	work around the buggy behavior in
	<code class="filename">acpica</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-submitdebug"></a>11.13.4. Getting and Submitting Debugging Info</h3></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Nate</span> <span class="surname">Lawson</span></span>. </span></div><div><span class="authorgroup">With contributions from <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Peter</span> <span class="surname">Schultz</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp55681912" class="indexterm"></a><a id="idp55683064" class="indexterm"></a><p>The <acronym class="acronym">ACPI</acronym> driver has a flexible
	debugging facility.  A set of subsystems and the level of
	verbosity can be specified.  The subsystems to debug are
	specified as layers and are broken down into components
	(<code class="literal">ACPI_ALL_COMPONENTS</code>) and
	<acronym class="acronym">ACPI</acronym> hardware support
	(<code class="literal">ACPI_ALL_DRIVERS</code>).  The verbosity of
	debugging output is specified as the level and ranges from
	just report errors (<code class="literal">ACPI_LV_ERROR</code>) to
	everything (<code class="literal">ACPI_LV_VERBOSE</code>).  The level is
	a bitmask so multiple options can be set at once, separated by
	spaces.  In practice, a serial console should be used to log
	the output so it is not lost as the console message buffer
	flushes.  A full list of the individual layers and levels is
	found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>.</p><p>Debugging output is not enabled by default.  To enable it,
	add <code class="literal">options ACPI_DEBUG</code> to the custom kernel
	configuration file if <acronym class="acronym">ACPI</acronym> is compiled into
	the kernel.  Add <code class="literal">ACPI_DEBUG=1</code> to
	<code class="filename">/etc/make.conf</code> to enable it globally.  If
	a module is used instead of a custom kernel, recompile just
	the <code class="filename">acpi.ko</code> module as follows:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/modules/acpi/acpi &amp;&amp; make clean &amp;&amp; make ACPI_DEBUG=1</code></strong></pre><p>Copy the compiled <code class="filename">acpi.ko</code> to
	<code class="filename">/boot/kernel</code> and add the desired level
	and layer to <code class="filename">/boot/loader.conf</code>.  The
	entries in this example enable debug messages for all
	<acronym class="acronym">ACPI</acronym> components and hardware drivers and
	output error messages at the least verbose level:</p><pre class="programlisting">debug.acpi.layer="ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS"
debug.acpi.level="ACPI_LV_ERROR"</pre><p>If the required information is triggered by a specific
	event, such as a suspend and then resume, do not modify
	<code class="filename">/boot/loader.conf</code>.  Instead, use
	<code class="command">sysctl</code> to specify the layer and level after
	booting and preparing the system for the specific event.  The
	variables which can be set using <code class="command">sysctl</code> are
	named the same as the tunables in
	<code class="filename">/boot/loader.conf</code>.</p><a id="idp56108920" class="indexterm"></a><p>Once the debugging information is gathered, it can be sent
	to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> so that it can be used by the FreeBSD
	<acronym class="acronym">ACPI</acronym> maintainers to identify the root cause
	of the problem and to develop a solution.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Before submitting debugging information to this mailing
	  list, ensure the latest <acronym class="acronym">BIOS</acronym> version is
	  installed and, if available, the embedded controller
	  firmware version.</p></div><p>When submitting a problem report, include the following
	information:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Description of the buggy behavior, including system
	    type, model, and anything that causes the bug to appear.
	    Note as accurately as possible when the bug began
	    occurring if it is new.</p></li><li class="listitem"><p>The output of <code class="command">dmesg</code> after running
	    <code class="command">boot -v</code>, including any error messages
	    generated by the bug.</p></li><li class="listitem"><p>The <code class="command">dmesg</code> output from <code class="command">boot
	      -v</code> with <acronym class="acronym">ACPI</acronym> disabled,
	    if disabling <acronym class="acronym">ACPI</acronym> helps to fix the
	    problem.</p></li><li class="listitem"><p>Output from <code class="command">sysctl hw.acpi</code>.  This
	    lists which features the system offers.</p></li><li class="listitem"><p>The <acronym class="acronym">URL</acronym> to a pasted version of the
	    system's <acronym class="acronym">ASL</acronym>.  Do
	    <span class="emphasis"><em>not</em></span> send the <acronym class="acronym">ASL</acronym>
	    directly to the list as it can be very large.  Generate a
	    copy of the <acronym class="acronym">ASL</acronym> by running this
	    command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>acpidump -dt &gt; <em class="replaceable"><code>name</code></em>-<em class="replaceable"><code>system</code></em>.asl</code></strong></pre><p>Substitute the login name for
	    <em class="replaceable"><code>name</code></em> and manufacturer/model for
	    <em class="replaceable"><code>system</code></em>.  For example, use
	    <code class="filename">njl-FooCo6000.asl</code>.</p></li></ul></div><p>Most FreeBSD developers watch the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">FreeBSD-CURRENT mailing list</a>, but one should
	submit problems to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> to be sure it is seen.  Be
	patient when waiting for a response.  If the bug is not
	immediately apparent, submit a bug report.
	When entering a <acronym class="acronym">PR</acronym>,
	include the same information as requested above.  This helps
	developers to track the problem and resolve it.  Do not send a
	<acronym class="acronym">PR</acronym> without emailing <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> first as
	it is likely that the problem has been reported before.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-References"></a>11.13.5. References</h3></div></div></div><p>More information about <acronym class="acronym">ACPI</acronym> may be
	found in the following locations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The FreeBSD <acronym class="acronym">ACPI</acronym> Mailing List Archives
	    (<code class="uri"><a class="uri" href="https://lists.freebsd.org/pipermail/freebsd-acpi/" target="_top">https://lists.freebsd.org/pipermail/freebsd-acpi/</a></code>)</p></li><li class="listitem"><p>The <acronym class="acronym">ACPI</acronym> 2.0 Specification (<code class="uri"><a class="uri" href="http://acpi.info/spec.htm" target="_top">http://acpi.info/spec.htm</a></code>)</p></li><li class="listitem"><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi_thermal&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi_thermal</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpidump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpidump</span>(8)</span></a>,
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iasl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iasl</span>(8)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpidb&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpidb</span>(8)</span></a></p></li></ul></div></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp55752952" class="footnote"><p><a href="#idp55752952" class="para"><sup class="para">[2] </sup></a>The auto-tuning algorithm sets
	      <code class="literal">maxusers</code> equal to the amount of
	      memory in the system, with a minimum of
	      <code class="literal">32</code>, and a maximum of
	      <code class="literal">384</code>.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot"></a>Chapter 12. The FreeBSD Booting Process</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#boot-synopsis">12.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#boot-introduction">12.2. FreeBSD Boot Process</a></span></dt><dt><span class="sect1"><a href="#boot-splash">12.3. Configuring Boot Time Splash Screens</a></span></dt><dt><span class="sect1"><a href="#device-hints">12.4. Device Hints</a></span></dt><dt><span class="sect1"><a href="#boot-shutdown">12.5. Shutdown Sequence</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="boot-synopsis"></a>12.1. Synopsis</h2></div></div></div><a id="idp56143736" class="indexterm"></a><a id="idp56144248" class="indexterm"></a><p>The process of starting a computer and loading the operating
      system is referred to as <span class="quote">&#8220;<span class="quote">the bootstrap process</span>&#8221;</span>,
      or <span class="quote">&#8220;<span class="quote">booting</span>&#8221;</span>.  FreeBSD's boot process provides a great
      deal of flexibility in customizing what happens when the system
      starts, including the ability to select from different operating
      systems installed on the same computer, different versions of
      the same operating system, or a different installed
      kernel.</p><p>This chapter details the configuration options that can be
      set.  It demonstrates how to customize the FreeBSD boot process,
      including everything that happens until the FreeBSD kernel has
      started, probed for devices, and started <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>.  This
      occurs when the text color of the boot messages changes from
      bright white to grey.</p><p>After reading this chapter, you will recognize:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The components of the FreeBSD bootstrap system and how they
	  interact.</p></li><li class="listitem"><p>The options that can be passed to the components in the
	  FreeBSD bootstrap in order to control the boot process.</p></li><li class="listitem"><p>How to configure a customized boot splash screen.</p></li><li class="listitem"><p>The basics of setting device hints.</p></li><li class="listitem"><p>How to boot into single- and multi-user mode and how to
	  properly shut down a FreeBSD system.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">This chapter only describes the boot process for FreeBSD
	running on x86 and amd64 systems.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="boot-introduction"></a>12.2. FreeBSD Boot Process</h2></div></div></div><p>Turning on a computer and starting the operating system
      poses an interesting dilemma.  By definition, the computer does
      not know how to do anything until the operating system is
      started.  This includes running programs from the disk.  If the
      computer can not run a program from the disk without the
      operating system, and the operating system programs are on the
      disk, how is the operating system started?</p><p>This problem parallels one in the book <em class="citetitle">The
	Adventures of Baron Munchausen</em>.  A character had
      fallen part way down a manhole, and pulled himself out by
      grabbing his bootstraps and lifting.  In the early days of
      computing, the term <em class="firstterm">bootstrap</em> was applied
      to the mechanism used to load the operating system.  It has
      since become shortened to <span class="quote">&#8220;<span class="quote">booting</span>&#8221;</span>.</p><a id="idp56155384" class="indexterm"></a><a id="idp56156024" class="indexterm"></a><p>On x86 hardware, the Basic Input/Output System
      (<acronym class="acronym">BIOS</acronym>) is responsible for loading the
      operating system.  The <acronym class="acronym">BIOS</acronym> looks on the hard
      disk for the Master Boot Record (<acronym class="acronym">MBR</acronym>), which
      must be located in a specific place on the disk.  The
      <acronym class="acronym">BIOS</acronym> has enough knowledge to load and run the
      <acronym class="acronym">MBR</acronym>, and assumes that the
      <acronym class="acronym">MBR</acronym> can then carry out the rest of the tasks
      involved in loading the operating system, possibly with the help
      of the <acronym class="acronym">BIOS</acronym>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD provides for booting from both the older
	<acronym class="acronym">MBR</acronym> standard, and the newer GUID Partition
	Table (<acronym class="acronym">GPT</acronym>).  <acronym class="acronym">GPT</acronym>
	partitioning is often found on computers with the Unified
	Extensible Firmware Interface (<acronym class="acronym">UEFI</acronym>).
	However, FreeBSD can boot from <acronym class="acronym">GPT</acronym> partitions
	even on machines with only a legacy <acronym class="acronym">BIOS</acronym>
	with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gptboot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gptboot</span>(8)</span></a>.  Work is under way to provide direct
	<acronym class="acronym">UEFI</acronym> booting.</p></div><a id="idp56180728" class="indexterm"></a><a id="idp56181624" class="indexterm"></a><a id="idp56182136" class="indexterm"></a><p>The code within the <acronym class="acronym">MBR</acronym> is typically
      referred to as a <span class="emphasis"><em>boot manager</em></span>, especially
      when it interacts with the user.  The boot manager usually has
      more code in the first track of the disk or within the file
      system.  Examples of boot managers include the standard FreeBSD
      boot manager <span class="application">boot0</span>, also called
      <span class="application">Boot Easy</span>, and
      <span class="application">Grub</span>, which is used by many <span class="trademark">Linux</span>®
      distributions.</p><p>If only one operating system is installed, the
      <acronym class="acronym">MBR</acronym> searches for the first bootable (active)
      slice on the disk, and then runs the code on that slice to load
      the remainder of the operating system.  When multiple operating
      systems are present, a different boot manager can be installed
      to display a list of operating systems so the user
      can select one to boot.</p><p>The remainder of the FreeBSD bootstrap system is divided into
      three stages.  The first stage knows just enough to get the
      computer into a specific state and run the second stage.  The
      second stage can do a little bit more, before running the third
      stage.  The third stage finishes the task of loading the
      operating system.  The work is split into three stages because
      the <acronym class="acronym">MBR</acronym> puts limits on the size of the
      programs that can be run at stages one and two.  Chaining the
      tasks together allows FreeBSD to provide a more flexible
      loader.</p><a id="idp56187000" class="indexterm"></a><a id="idp56187512" class="indexterm"></a><p>The kernel is then started and begins to probe for devices
      and initialize them for use.  Once the kernel boot process is
      finished, the kernel passes control to the user process
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>, which makes sure the disks are in a usable state,
      starts the user-level resource configuration which mounts file
      systems, sets up network cards to communicate on the network,
      and starts the processes which have been configured to run at
      startup.</p><p>This section describes these stages in more detail and
      demonstrates how to interact with the FreeBSD boot process.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-boot0"></a>12.2.1. The Boot Manager</h3></div></div></div><a id="idp56223736" class="indexterm"></a><a id="idp56224248" class="indexterm"></a><p>The boot manager code in the <acronym class="acronym">MBR</acronym> is
	sometimes referred to as <span class="emphasis"><em>stage zero</em></span> of
	the boot process.  By default, FreeBSD uses the
	<span class="application">boot0</span> boot manager.</p><p>The <acronym class="acronym">MBR</acronym> installed by the FreeBSD installer
	is based on <code class="filename">/boot/boot0</code>.  The size and
	capability of <span class="application">boot0</span> is restricted
	to 446 bytes due to the slice table and
	<code class="literal">0x55AA</code> identifier at the end of the
	<acronym class="acronym">MBR</acronym>.  If <span class="application">boot0</span>
	and multiple operating systems are installed, a message
	similar to this example will be displayed at boot time:</p><div class="example"><a id="boot-boot0-example"></a><div class="example-title">Example 12.1. <code class="filename">boot0</code> Screenshot</div><div class="example-contents"><pre class="screen">F1 Win
F2 FreeBSD

Default: F2</pre></div></div><br class="example-break" /><p>Other operating systems will overwrite an existing
	<acronym class="acronym">MBR</acronym> if they are installed after FreeBSD.  If
	this happens, or to replace the existing
	<acronym class="acronym">MBR</acronym> with the FreeBSD <acronym class="acronym">MBR</acronym>,
	use the following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fdisk -B -b /boot/boot0 <em class="replaceable"><code>device</code></em></code></strong></pre><p>where <em class="replaceable"><code>device</code></em> is the boot disk,
	such as <code class="filename">ad0</code> for the first
	<acronym class="acronym">IDE</acronym> disk, <code class="filename">ad2</code> for the
	first <acronym class="acronym">IDE</acronym> disk on a second
	<acronym class="acronym">IDE</acronym> controller, or <code class="filename">da0</code>
	for the first <acronym class="acronym">SCSI</acronym> disk.  To create a
	custom configuration of the <acronym class="acronym">MBR</acronym>, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">boot0cfg</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-boot1"></a>12.2.2. Stage One and Stage Two</h3></div></div></div><p>Conceptually, the first and second stages are part of the
	same program on the same area of the disk.  Because of space
	constraints, they have been split into two, but are always
	installed together.  They are copied from the combined
	<code class="filename">/boot/boot</code> by the FreeBSD installer or
	<code class="command">bsdlabel</code>.</p><p>These two stages are located outside file systems, in the
	first track of the boot slice, starting with the first sector.
	This is where <span class="application">boot0</span>, or any other
	boot manager, expects to find a program to run which will
	continue the boot process.</p><p>The first stage, <code class="filename">boot1</code>, is very
	simple, since it can only be 512 bytes in size.  It knows just
	enough about the FreeBSD <em class="firstterm">bsdlabel</em>, which
	stores information about the slice, to find and execute
	<code class="filename">boot2</code>.</p><p>Stage two, <code class="filename">boot2</code>, is slightly more
	sophisticated, and understands the FreeBSD file system enough to
	find files.  It can provide a simple interface to choose the
	kernel or loader to run.  It runs
	<span class="application">loader</span>, which is much more
	sophisticated and provides a boot configuration file.  If the
	boot process is interrupted at stage two, the following
	interactive screen is displayed:</p><div class="example"><a id="boot-boot2-example"></a><div class="example-title">Example 12.2. <code class="filename">boot2</code> Screenshot</div><div class="example-contents"><pre class="screen">&gt;&gt; FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:</pre></div></div><br class="example-break" /><p>To replace the installed <code class="filename">boot1</code> and
	<code class="filename">boot2</code>, use <code class="command">bsdlabel</code>,
	where <em class="replaceable"><code>diskslice</code></em> is the disk and
	slice to boot from, such as <code class="filename">ad0s1</code> for the
	first slice on the first <acronym class="acronym">IDE</acronym> disk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -B <em class="replaceable"><code>diskslice</code></em></code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">If just the disk name is used, such as
	  <code class="filename">ad0</code>, <code class="command">bsdlabel</code> will
	  create the disk in <span class="quote">&#8220;<span class="quote">dangerously dedicated
	    mode</span>&#8221;</span>, without slices.  This is probably not the
	  desired action, so double check the
	  <em class="replaceable"><code>diskslice</code></em> before pressing
	  <span class="keycap"><strong>Return</strong></span>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-loader"></a>12.2.3. Stage Three</h3></div></div></div><a id="idp56433144" class="indexterm"></a><p>The <span class="application">loader</span> is the final stage
	of the three-stage bootstrap process.  It is located on the
	file system, usually as
	<code class="filename">/boot/loader</code>.</p><p>The <span class="application">loader</span> is intended as an
	interactive method for configuration, using a built-in command
	set, backed up by a more powerful interpreter which has a more
	complex command set.</p><p>During initialization, <span class="application">loader</span>
	will probe for a console and for disks, and figure out which
	disk it is booting from.  It will set variables accordingly,
	and an interpreter is started where user commands can be
	passed from a script or interactively.</p><a id="idp56436344" class="indexterm"></a><a id="idp56436856" class="indexterm"></a><p>The <span class="application">loader</span> will then read
	<code class="filename">/boot/loader.rc</code>, which by default reads
	in <code class="filename">/boot/defaults/loader.conf</code> which sets
	reasonable defaults for variables and reads
	<code class="filename">/boot/loader.conf</code> for local changes to
	those variables.  <code class="filename">loader.rc</code> then acts on
	these variables, loading whichever modules and kernel are
	selected.</p><p>Finally, by default, <span class="application">loader</span>
	issues a 10 second wait for key presses, and boots the kernel
	if it is not interrupted.  If interrupted, the user is
	presented with a prompt which understands the command set,
	where the user may adjust variables, unload all modules, load
	modules, and then finally boot or reboot.  <a class="xref" href="#boot-loader-commands" title="Table 12.1. Loader Built-In Commands">Table 12.1, &#8220;Loader Built-In Commands&#8221;</a> lists the most commonly
	used <span class="application">loader</span> commands.  For a
	complete discussion of all available commands, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>.</p><div class="table"><a id="boot-loader-commands"></a><div class="table-title">Table 12.1. Loader Built-In Commands</div><div class="table-contents"><table class="table" summary="Loader Built-In Commands" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Variable</th><th>Description</th></tr></thead><tbody><tr><td>autoboot
		<em class="replaceable"><code>seconds</code></em></td><td>Proceeds to boot the kernel if not interrupted
		within the time span given, in seconds.  It displays a
		countdown, and the default time span is 10
		seconds.</td></tr><tr><td>boot
		[<span class="optional"><em class="replaceable"><code>-options</code></em></span>]
		[<span class="optional"><em class="replaceable"><code>kernelname</code></em></span>]</td><td>Immediately proceeds to boot the kernel, with
		any specified options or kernel name.  Providing a
		kernel name on the command-line is only applicable
		after an <code class="command">unload</code> has been issued.
		Otherwise, the previously-loaded kernel will be
		used.  If <span class="emphasis"><em>kernelname</em></span> is not
		qualified, it will be searched under
		<span class="emphasis"><em>/boot/kernel</em></span> and
		<span class="emphasis"><em>/boot/modules</em></span>.</td></tr><tr><td>boot-conf</td><td>Goes through the same automatic configuration of
		modules based on specified variables, most commonly
		<code class="envar">kernel</code>.  This only makes sense if
		<code class="command">unload</code> is used first, before
		changing some variables.</td></tr><tr><td>help
		[<span class="optional"><em class="replaceable"><code>topic</code></em></span>]</td><td>Shows help messages read from
		<code class="filename">/boot/loader.help</code>.  If the topic
		given is <code class="literal">index</code>, the list of
		available topics is displayed.</td></tr><tr><td>include <em class="replaceable"><code>filename</code></em>
		&#8230;</td><td>Reads the specified file and interprets it line
		by line.  An error immediately stops the
		<code class="command">include</code>.</td></tr><tr><td>load [<span class="optional">-t
		  <em class="replaceable"><code>type</code></em></span>]
		<em class="replaceable"><code>filename</code></em></td><td>Loads the kernel, kernel module, or file of the
		type given, with the specified filename.  Any
		arguments after <em class="replaceable"><code>filename</code></em>
		are passed to the file.  If
		<span class="emphasis"><em>filename</em></span> is not qualified, it
		will be searched under
		<span class="emphasis"><em>/boot/kernel</em></span>
		and <span class="emphasis"><em>/boot/modules</em></span>.</td></tr><tr><td>ls [<span class="optional">-l</span>]
		[<span class="optional"><em class="replaceable"><code>path</code></em></span>]</td><td>Displays a listing of files in the given path, or
		the root directory, if the path is not specified.  If
		<code class="option">-l</code> is specified, file sizes will
		also be shown.</td></tr><tr><td>lsdev [<span class="optional">-v</span>]</td><td>Lists all of the devices from which it may be
		possible to load modules.  If <code class="option">-v</code> is
		specified, more details are printed.</td></tr><tr><td>lsmod [<span class="optional">-v</span>]</td><td>Displays loaded modules.  If <code class="option">-v</code>
		is specified, more details are shown.</td></tr><tr><td>more <em class="replaceable"><code>filename</code></em></td><td>Displays the files specified, with a pause at
		each <code class="varname">LINES</code> displayed.</td></tr><tr><td>reboot</td><td>Immediately reboots the system.</td></tr><tr><td>set <em class="replaceable"><code>variable</code></em>, set
		<em class="replaceable"><code>variable</code></em>=<em class="replaceable"><code>value</code></em></td><td>Sets the specified environment variables.</td></tr><tr><td>unload</td><td>Removes all loaded modules.</td></tr></tbody></table></div></div><br class="table-break" /><p>Here are some practical examples of loader usage.  To boot
	the usual kernel in single-user mode
	<a id="idp56481016" class="indexterm"></a>:</p><pre class="screen"><strong class="userinput"><code>boot -s</code></strong></pre><p>To unload the usual kernel and modules and then load the
	previous or another, specified kernel:</p><pre class="screen"><strong class="userinput"><code>unload</code></strong>
<strong class="userinput"><code>load <em class="replaceable"><code>kernel.old</code></em></code></strong></pre><p>Use <code class="filename">kernel.GENERIC</code> to refer to the
	default kernel that comes with an installation, or
	<code class="filename">kernel.old</code>, to refer to the previously
	installed kernel before a system upgrade or before configuring
	a custom kernel.</p><p>Use the following to load the usual modules with another
	kernel:</p><pre class="screen"><strong class="userinput"><code>unload</code></strong>
<strong class="userinput"><code>set kernel="<em class="replaceable"><code>kernel.old</code></em>"</code></strong>
<strong class="userinput"><code>boot-conf</code></strong></pre><p>To load an automated kernel configuration script:</p><pre class="screen"><strong class="userinput"><code>load -t userconfig_script <em class="replaceable"><code>/boot/kernel.conf</code></em></code></strong></pre><a id="idp56504440" class="indexterm"></a></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-init"></a>12.2.4. Last Stage</h3></div></div></div><a id="idp56506488" class="indexterm"></a><p>Once the kernel is loaded by either
	<span class="application">loader</span> or by
	<span class="application">boot2</span>, which bypasses
	<span class="application">loader</span>, it examines any boot flags
	and adjusts its behavior as necessary.  <a class="xref" href="#boot-kernel" title="Table 12.2. Kernel Interaction During Boot">Table 12.2, &#8220;Kernel Interaction During Boot&#8221;</a> lists the commonly used boot flags.
	Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=boot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">boot</span>(8)</span></a> for more information on the other boot
	flags.</p><a id="idp56510456" class="indexterm"></a><div class="table"><a id="boot-kernel"></a><div class="table-title">Table 12.2. Kernel Interaction During Boot</div><div class="table-contents"><table class="table" summary="Kernel Interaction During Boot" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td><code class="option">-a</code></td><td>During kernel initialization, ask for the device
		to mount as the root file system.</td></tr><tr><td><code class="option">-C</code></td><td>Boot the root file system from a
		<acronym class="acronym">CDROM</acronym>.</td></tr><tr><td><code class="option">-s</code></td><td>Boot into single-user mode.</td></tr><tr><td><code class="option">-v</code></td><td>Be more verbose during kernel startup.</td></tr></tbody></table></div></div><br class="table-break" /><p>Once the kernel has finished booting, it passes control to
	the user process <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>, which is located at
	<code class="filename">/sbin/init</code>, or the program path specified
	in the <code class="envar">init_path</code> variable in
	<code class="command">loader</code>.  This is the last stage of the boot
	process.</p><p>The boot sequence makes sure that the file systems
	available on the system are consistent.  If a
	<acronym class="acronym">UFS</acronym> file system is not, and
	<code class="command">fsck</code> cannot fix the inconsistencies,
	<span class="application">init</span> drops the system into
	single-user mode so that the system administrator can resolve
	the problem directly.  Otherwise, the system boots into
	multi-user mode.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-singleuser"></a>12.2.4.1. Single-User Mode</h4></div></div></div><a id="idp56525304" class="indexterm"></a><a id="idp56525816" class="indexterm"></a><p>A user can specify this mode by booting with
	  <code class="option">-s</code> or by setting the
	  <code class="envar">boot_single</code> variable in
	  <span class="application">loader</span>.  It can also be reached
	  by running <code class="command">shutdown now</code> from multi-user
	  mode.  Single-user mode begins with this message:</p><pre class="programlisting">Enter full pathname of shell or RETURN for /bin/sh:</pre><p>If the user presses <span class="keycap"><strong>Enter</strong></span>, the system
	  will enter the default Bourne shell.  To specify a different
	  shell, input the full path to the shell.</p><p>Single-user mode is usually used to repair a system that
	  will not boot due to an inconsistent file system or an error
	  in a boot configuration file.  It can also be used to reset
	  the <code class="systemitem">root</code> password
	  when it is unknown.  These actions are possible as the
	  single-user mode prompt gives full, local access to the
	  system and its configuration files.  There is no networking
	  in this mode.</p><p>While single-user mode is useful for repairing a system,
	  it poses a security risk unless the system is in a
	  physically secure location.  By default, any user who can
	  gain physical access to a system will have full control of
	  that system after booting into single-user mode.</p><p>If the system <code class="literal">console</code> is changed to
	  <code class="literal">insecure</code> in
	  <code class="filename">/etc/ttys</code>, the system will first prompt
	  for the <code class="systemitem">root</code>
	  password before initiating single-user mode.  This adds a
	  measure of security while removing the ability to reset the
	  <code class="systemitem">root</code> password when
	  it is unknown.</p><div class="example"><a id="boot-insecure-console"></a><div class="example-title">Example 12.3. Configuring an Insecure Console in
	    <code class="filename">/etc/ttys</code></div><div class="example-contents"><pre class="programlisting"># name  getty                           type    status          comments
#
# If console is marked "insecure", then init will ask for the root password
# when going to single-user mode.
console none                            unknown off <em class="replaceable"><code>insecure</code></em></pre></div></div><br class="example-break" /><p>An <code class="literal">insecure</code> console means that
	  physical security to the console is considered to be
	  insecure, so only someone who knows the <code class="systemitem">root</code> password may use
	  single-user mode.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-multiuser"></a>12.2.4.2. Multi-User Mode</h4></div></div></div><a id="idp56553848" class="indexterm"></a><p>If <span class="application">init</span> finds the file
	  systems to be in order, or once the user has finished their
	  commands in single-user mode and has typed
	  <code class="command">exit</code> to leave single-user mode, the
	  system enters multi-user mode, in which it starts the
	  resource configuration of the system.</p><a id="idp56555512" class="indexterm"></a><p>The resource configuration system reads in configuration
	  defaults from <code class="filename">/etc/defaults/rc.conf</code> and
	  system-specific details from
	  <code class="filename">/etc/rc.conf</code>.  It then proceeds to
	  mount the system file systems listed in
	  <code class="filename">/etc/fstab</code>.  It starts up networking
	  services, miscellaneous system daemons, then the startup
	  scripts of locally installed packages.</p><p>To learn more about the resource configuration system,
	  refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> and examine the scripts located in
	  <code class="filename">/etc/rc.d</code>.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="boot-splash"></a>12.3. Configuring Boot Time Splash Screens</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Joseph J.</span> <span class="surname">Barbish</span></span>. </span></div></div></div><p>Typically when a FreeBSD system boots, it displays its progress
      as a series of messages at the console.  A boot splash screen
      creates an alternate boot screen that hides all of the boot
      probe and service startup messages.  A few boot loader messages,
      including the boot options menu and a timed wait countdown
      prompt, are displayed at boot time, even when the splash screen
      is enabled.  The display of the splash screen can be turned off
      by hitting any key on the keyboard during the boot
      process.</p><p>There are two basic environments available in FreeBSD.  The
      first is the default legacy virtual console command line
      environment.  After the system finishes booting, a console login
      prompt is presented.  The second environment is a configured
      graphical environment.  Refer to <a class="xref" href="#x11" title="Chapter 5. The X Window System">Chapter 5, <em>The X Window System</em></a> for more
      information on how to install and configure a graphical display
      manager and a graphical login manager.</p><p>Once the system has booted, the splash screen defaults to
      being a screen saver.  After a time period of non-use, the
      splash screen will display and will cycle through steps of
      changing intensity of the image, from bright to very dark and
      over again.  The configuration of the splash screen saver can be
      overridden by adding a <code class="literal">saver=</code> line to
      <code class="filename">/etc/rc.conf</code>.  Several built-in screen
      savers are available and described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=splash&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">splash</span>(4)</span></a>.  The
      <code class="literal">saver=</code> option only applies to virtual
      consoles and has no effect on graphical display managers.</p><p>By installing the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/bsd-splash-changer/pkg-descr">sysutils/bsd-splash-changer</a> package or port,
      a random splash image from a collection will display at boot.
      The splash screen function supports 256-colors in the
      bitmap (<code class="filename">.bmp</code>), ZSoft
      <acronym class="acronym">PCX</acronym> (<code class="filename">.pcx</code>), or
      TheDraw (<code class="filename">.bin</code>) formats.  The
      <code class="filename">.bmp</code>, <code class="filename">.pcx</code>, or
      <code class="filename">.bin</code> image has to be placed on the root
      partition, for example in <code class="filename">/boot</code>.  The
      splash image files must have a resolution of 320 by 200 pixels
      or less in order to work on standard <acronym class="acronym">VGA</acronym>
      adapters.  For the default boot display resolution of 256-colors
      and 320 by 200 pixels or less, add the following lines to
      <code class="filename">/boot/loader.conf</code>.  Replace
      <em class="replaceable"><code>splash.bmp</code></em> with the name of the
      bitmap file to use:</p><pre class="programlisting">splash_bmp_load="YES"
bitmap_load="YES"
bitmap_name="/boot/<em class="replaceable"><code>splash.bmp</code></em>"</pre><p>To use a <acronym class="acronym">PCX</acronym> file instead of a bitmap
      file:</p><pre class="programlisting">splash_pcx_load="YES"
bitmap_load="YES"
bitmap_name="/boot/<em class="replaceable"><code>splash.pcx</code></em>"</pre><p>To instead use ASCII art in the <a class="link" href="https://en.wikipedia.org/wiki/TheDraw" target="_top">https://en.wikipedia.org/wiki/TheDraw</a>
      format:</p><pre class="programlisting">splash_txt="YES"
bitmap_load="YES"
bitmap_name="/boot/<em class="replaceable"><code>splash.bin</code></em>"</pre><p>Other interesting <code class="filename">loader.conf</code> options
      include:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">beastie_disable="YES"</code></span></dt><dd><p>This will stop the boot options menu from being
	    displayed, but the timed wait count down prompt will still
	    be present.  Even with the display of the boot options
	    menu disabled, entering an option selection at the timed
	    wait count down prompt will enact the corresponding boot
	    option.</p></dd><dt><span class="term"><code class="literal">loader_logo="beastie"</code></span></dt><dd><p>This will replace the default words
	    <span class="quote">&#8220;<span class="quote">FreeBSD</span>&#8221;</span>, which are displayed to the right of
	    the boot options menu, with the colored beastie
	    logo.</p></dd></dl></div><p>For more information, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=splash&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">splash</span>(4)</span></a>,
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vga&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vga</span>(4)</span></a>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="device-hints"></a>12.4. Device Hints</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp56607224" class="indexterm"></a><p>During initial system startup, the boot <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> reads
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=device.hints&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">device.hints</span>(5)</span></a>.  This file stores kernel boot information
      known as variables, sometimes referred to as
      <span class="quote">&#8220;<span class="quote">device hints</span>&#8221;</span>.  These <span class="quote">&#8220;<span class="quote">device hints</span>&#8221;</span>
      are used by device drivers for device configuration.</p><p>Device hints may also be specified at the Stage 3 boot
      loader prompt, as demonstrated in <a class="xref" href="#boot-loader" title="12.2.3. Stage Three">Section 12.2.3, &#8220;Stage Three&#8221;</a>.
      Variables can be added using <code class="command">set</code>, removed
      with <code class="command">unset</code>, and viewed
      <code class="command">show</code>.  Variables set in
      <code class="filename">/boot/device.hints</code> can also be overridden.
      Device hints entered at the boot loader are not permanent and
      will not be applied on the next reboot.</p><p>Once the system is booted, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kenv&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kenv</span>(1)</span></a> can be used to dump
      all of the variables.</p><p>The syntax for <code class="filename">/boot/device.hints</code>
      is one variable per line, using the hash
      <span class="quote">&#8220;<span class="quote">#</span>&#8221;</span> as comment markers.  Lines are constructed as
      follows:</p><pre class="screen"><strong class="userinput"><code>hint.driver.unit.keyword="<em class="replaceable"><code>value</code></em>"</code></strong></pre><p>The syntax for the Stage 3 boot loader is:</p><pre class="screen"><strong class="userinput"><code>set hint.driver.unit.keyword=<em class="replaceable"><code>value</code></em></code></strong></pre><p>where <code class="literal">driver</code> is the device driver name,
      <code class="literal">unit</code> is the device driver unit number, and
      <code class="literal">keyword</code> is the hint keyword.  The keyword may
      consist of the following options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">at</code>: specifies the bus which the
	  device is attached to.</p></li><li class="listitem"><p><code class="literal">port</code>: specifies the start address of
	  the <acronym class="acronym">I/O</acronym> to be used.</p></li><li class="listitem"><p><code class="literal">irq</code>: specifies the interrupt request
	  number to be used.</p></li><li class="listitem"><p><code class="literal">drq</code>: specifies the DMA channel
	  number.</p></li><li class="listitem"><p><code class="literal">maddr</code>: specifies the physical memory
	  address occupied by the device.</p></li><li class="listitem"><p><code class="literal">flags</code>: sets various flag bits for the
	  device.</p></li><li class="listitem"><p><code class="literal">disabled</code>: if set to
	  <code class="literal">1</code> the device is disabled.</p></li></ul></div><p>Since device drivers may accept or require more hints not
      listed here, viewing a driver's manual page is recommended.
      For more information, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=device.hints&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">device.hints</span>(5)</span></a>,
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kenv&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kenv</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="boot-shutdown"></a>12.5. Shutdown Sequence</h2></div></div></div><a id="idp56652280" class="indexterm"></a><p>Upon controlled shutdown using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=shutdown&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">shutdown</span>(8)</span></a>,
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a> will attempt to run the script
      <code class="filename">/etc/rc.shutdown</code>, and then proceed to send
      all processes the <code class="literal">TERM</code> signal, and
      subsequently the <code class="literal">KILL</code> signal to any that do
      not terminate in a timely manner.</p><p>To power down a FreeBSD machine on architectures and systems
      that support power management, use

      <code class="command">shutdown -p now</code> to turn the power off
      immediately.  To reboot a FreeBSD system, use
      <code class="command">shutdown -r now</code>.  One must be
      <code class="systemitem">root</code> or a member of
      <code class="systemitem">operator</code> in order to
      run <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=shutdown&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">shutdown</span>(8)</span></a>.  One can also use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=halt&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">halt</span>(8)</span></a> and
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=reboot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">reboot</span>(8)</span></a>.  Refer to their manual pages and to
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=shutdown&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">shutdown</span>(8)</span></a> for more information.</p><p>Modify group membership by referring to
      <a class="xref" href="#users-synopsis" title="3.3. Users and Basic Account Management">Section 3.3, &#8220;Users and Basic Account Management&#8221;</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Power management requires <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> to be loaded as
	a module or statically compiled into a custom kernel.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security"></a>Chapter 13. Security</h2></div><div><span class="authorgroup">Rewritten by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#security-synopsis">13.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#security-intro">13.2. Introduction</a></span></dt><dt><span class="sect1"><a href="#one-time-passwords">13.3. One-time Passwords</a></span></dt><dt><span class="sect1"><a href="#tcpwrappers">13.4. TCP Wrapper</a></span></dt><dt><span class="sect1"><a href="#kerberos5">13.5. <span class="application">Kerberos</span></a></span></dt><dt><span class="sect1"><a href="#openssl">13.6. OpenSSL</a></span></dt><dt><span class="sect1"><a href="#ipsec">13.7. <acronym class="acronym">VPN</acronym> over
	<acronym class="acronym">IPsec</acronym></a></span></dt><dt><span class="sect1"><a href="#openssh">13.8. OpenSSH</a></span></dt><dt><span class="sect1"><a href="#fs-acl">13.9. Access Control Lists</a></span></dt><dt><span class="sect1"><a href="#security-pkg">13.10. Monitoring Third Party Security Issues</a></span></dt><dt><span class="sect1"><a href="#security-advisories">13.11. FreeBSD Security Advisories</a></span></dt><dt><span class="sect1"><a href="#security-accounting">13.12. Process Accounting</a></span></dt><dt><span class="sect1"><a href="#security-resourcelimits">13.13. Resource Limits</a></span></dt><dt><span class="sect1"><a href="#security-sudo">13.14. Shared Administration with Sudo</a></span></dt></dl></div><a id="idp56676472" class="indexterm"></a><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-synopsis"></a>13.1. Synopsis</h2></div></div></div><p>Security, whether physical or virtual, is a topic so broad
      that an entire industry has evolved around it.  Hundreds of
      standard practices have been authored about how to secure
      systems and networks, and as a user of FreeBSD, understanding how
      to protect against attacks and intruders is a must.</p><p>In this chapter, several fundamentals and techniques will be
      discussed.  The FreeBSD system comes with multiple layers of
      security, and many more third party utilities may be added to
      enhance security.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Basic FreeBSD system security concepts.</p></li><li class="listitem"><p>The various crypt mechanisms available in FreeBSD.</p></li><li class="listitem"><p>How to set up one-time password authentication.</p></li><li class="listitem"><p>How to configure <span class="application">TCP Wrapper</span>
	  for use with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>.</p></li><li class="listitem"><p>How to set up <span class="application">Kerberos</span> on
	  FreeBSD.</p></li><li class="listitem"><p>How to configure <acronym class="acronym">IPsec</acronym> and create a
	  <acronym class="acronym">VPN</acronym>.</p></li><li class="listitem"><p>How to configure and use
	  <span class="application">OpenSSH</span> on FreeBSD.</p></li><li class="listitem"><p>How to use file system <acronym class="acronym">ACL</acronym>s.</p></li><li class="listitem"><p>How to use <span class="application">pkg</span> to audit
	  third party software packages installed from the Ports
	  Collection.</p></li><li class="listitem"><p>How to utilize FreeBSD security advisories.</p></li><li class="listitem"><p>What Process Accounting is and how to enable it on
	  FreeBSD.</p></li><li class="listitem"><p>How to control user resources using login classes or the
	  resource limits database.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand basic FreeBSD and Internet concepts.</p></li></ul></div><p>Additional security topics are covered elsewhere in this
      Handbook.  For example, Mandatory Access Control is discussed in
      <a class="xref" href="#mac" title="Chapter 15. Mandatory Access Control">Chapter 15, <em>Mandatory Access Control</em></a> and Internet firewalls are discussed in
      <a class="xref" href="#firewalls" title="Chapter 30. Firewalls">Chapter 30, <em>Firewalls</em></a>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-intro"></a>13.2. Introduction</h2></div></div></div><p>Security is everyone's responsibility.  A weak entry point
      in any system could allow intruders to gain access to critical
      information and cause havoc on an entire network.  One of the
      core principles of information security is the
      <acronym class="acronym">CIA</acronym> triad, which stands for the
      Confidentiality, Integrity, and Availability of information
      systems.</p><p>The <acronym class="acronym">CIA</acronym> triad is a bedrock concept of
      computer security as customers and users expect their data to be
      protected.  For example, a customer expects that their credit
      card information is securely stored (confidentiality), that
      their orders are not changed behind the scenes (integrity), and
      that they have access to their order information at all times
      (availablility).</p><p>To provide <acronym class="acronym">CIA</acronym>, security professionals
      apply a defense in depth strategy.  The idea of defense in depth
      is to add several layers of security to prevent one single layer
      failing and the entire security system collapsing.  For example,
      a system administrator cannot simply turn on a firewall and
      consider the network or system secure.  One must also audit
      accounts, check the integrity of binaries, and ensure malicious
      tools are not installed.  To implement an effective security
      strategy, one must understand threats and how to defend against
      them.</p><p>What is a threat as it pertains to computer security?
      Threats are not limited to remote attackers who attempt to
      access a system without permission from a remote location.
      Threats also include employees, malicious software, unauthorized
      network devices, natural disasters, security vulnerabilities,
      and even competing corporations.</p><p>Systems and networks can be accessed without permission,
      sometimes by accident, or by remote attackers, and in some
      cases, via corporate espionage or former employees.  As a user,
      it is important to prepare for and admit when a mistake has led
      to a security breach and report possible issues to the security
      team.  As an administrator, it is important to know of the
      threats and be prepared to mitigate them.</p><p>When applying security to systems, it is recommended to
      start by securing the basic accounts and system configuration,
      and then to secure the network layer so that it adheres to the
      system policy and the organization's security procedures.  Many
      organizations already have a security policy that covers the
      configuration of technology devices.  The policy should include
      the security configuration of workstations, desktops, mobile
      devices, phones, production servers, and development servers.
      In many cases, standard operating procedures
      (<acronym class="acronym">SOP</acronym>s) already exist.  When in doubt, ask the
      security team.</p><p>The rest of this introduction describes how some of these
      basic security configurations are performed on a FreeBSD system.
      The rest of this chapter describes some specific tools which can
      be used when implementing a security policy on a FreeBSD
      system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-accounts"></a>13.2.1. Preventing Logins</h3></div></div></div><p>In securing a system, a good starting point is an audit of
	accounts.  Ensure that <code class="systemitem">root</code> has a strong password and
	that this password is not shared.  Disable any accounts that
	do not need login access.</p><p>To deny login access to accounts, two methods exist.  The
	first is to lock the account.  This example locks the
	<code class="systemitem">toor</code> account:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw lock <em class="replaceable"><code>toor</code></em></code></strong></pre><p>The second method is to prevent login access by changing
	the shell to <code class="filename">/usr/sbin/nologin</code>.  Only the
	superuser can change the shell for other users:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chsh -s /usr/sbin/nologin <em class="replaceable"><code>toor</code></em></code></strong></pre><p>The <code class="filename">/usr/sbin/nologin</code> shell prevents
	the system from assigning a shell to the user when they
	attempt to login.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-accountmgmt"></a>13.2.2. Permitted Account Escalation</h3></div></div></div><p>In some cases, system administration needs to be shared
	with other users.  FreeBSD has two methods to handle this.  The
	first one, which is not recommended, is a shared root password
	used by members of the <code class="systemitem">wheel</code> group.  With this
	method, a user types <code class="command">su</code> and enters the
	password for <code class="systemitem">wheel</code>
	whenever superuser access is needed.  The user should then
	type <code class="command">exit</code> to leave privileged access after
	finishing the commands that required administrative access.
	To add a user to this group, edit
	<code class="filename">/etc/group</code> and add the user to the end of
	the <code class="literal">wheel</code> entry.  The user must be
	separated by a comma character with no space.</p><p>The second, and recommended, method to permit privilege
	escalation is to install the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/sudo/pkg-descr">security/sudo</a>
	package or port.  This software provides additional auditing,
	more fine-grained user control, and can be configured to lock
	users into running only the specified privileged
	commands.</p><p>After installation, use <code class="command">visudo</code> to edit
	<code class="filename">/usr/local/etc/sudoers</code>.  This example
	creates a new <code class="systemitem">webadmin</code> group, adds the
	<code class="systemitem">trhodes</code> account to
	that group, and configures that group access to restart
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/apache24/pkg-descr">apache24</a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupadd webadmin -M trhodes -g 6000</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>visudo</code></strong>
%webadmin ALL=(ALL) /usr/sbin/service apache24 *</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-passwords"></a>13.2.3. Password Hashes</h3></div></div></div><p>Passwords are a necessary evil of technology.  When they
	must be used, they should be complex and a powerful hash
	mechanism should be used to encrypt the version that is stored
	in the password database.  FreeBSD supports the
	<acronym class="acronym">DES</acronym>, <acronym class="acronym">MD5</acronym>,
	<acronym class="acronym">SHA256</acronym>, <acronym class="acronym">SHA512</acronym>, and
	Blowfish hash algorithms in its <code class="function">crypt()</code>
	library.  The default of <acronym class="acronym">SHA512</acronym> should not
	be changed to a less secure hashing algorithm, but can be
	changed to the more secure Blowfish algorithm.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Blowfish is not part of <acronym class="acronym">AES</acronym> and is
	  not considered compliant with any Federal Information
	  Processing Standards (<acronym class="acronym">FIPS</acronym>).  Its use may
	  not be permitted in some environments.</p></div><p>To determine which hash algorithm is used to encrypt a
	user's password, the superuser can view the hash for the user
	in the FreeBSD password database.  Each hash starts with a symbol
	which indicates the type of hash mechanism used to encrypt the
	password.  If <acronym class="acronym">DES</acronym> is used, there is no
	beginning symbol.  For <acronym class="acronym">MD5</acronym>, the symbol is
	<code class="literal">$</code>.  For <acronym class="acronym">SHA256</acronym> and
	<acronym class="acronym">SHA512</acronym>, the symbol is
	<code class="literal">$6$</code>.  For Blowfish, the symbol is
	<code class="literal">$2a$</code>.  In this example, the password for
	<code class="systemitem">dru</code> is hashed using
	the default <acronym class="acronym">SHA512</acronym> algorithm as the hash
	starts with <code class="literal">$6$</code>.  Note that the encrypted
	hash, not the password itself, is stored in the password
	database:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>grep dru /etc/master.passwd</code></strong>
dru:$6$pzIjSvCAn.PBYQBA$PXpSeWPx3g5kscj3IMiM7tUEUSPmGexxta.8Lt9TGSi2lNQqYGKszsBPuGME0:1001:1001::0:0:dru:/usr/home/dru:/bin/csh</pre><p>The hash mechanism is set in the user's login class.  For
	this example, the user is in the <code class="literal">default</code>
	login class and the hash algorithm is set with this line in
	<code class="filename">/etc/login.conf</code>:</p><pre class="programlisting">        :passwd_format=sha512:\</pre><p>To change the algorithm to Blowfish, modify that line to
	look like this:</p><pre class="programlisting">        :passwd_format=blf:\</pre><p>Then run <code class="command">cap_mkdb /etc/login.conf</code> as
	described in <a class="xref" href="#users-limiting" title="13.13.1. Configuring Login Classes">Section 13.13.1, &#8220;Configuring Login Classes&#8221;</a>.  Note that this
	change will not affect any existing password hashes.  This
	means that all passwords should be re-hashed by asking users
	to run <code class="command">passwd</code> in order to change their
	password.</p><p>For remote logins, two-factor authentication should be
	used.  An example of two-factor authentication is
	<span class="quote">&#8220;<span class="quote">something you have</span>&#8221;</span>, such as a key, and
	<span class="quote">&#8220;<span class="quote">something you know</span>&#8221;</span>, such as the passphrase for
	that key.  Since <span class="application">OpenSSH</span> is part of
	the FreeBSD base system, all network logins should be over an
	encrypted connection and use key-based authentication instead
	of passwords.  For more information, refer to <a class="xref" href="#openssh" title="13.8. OpenSSH">Section 13.8, &#8220;OpenSSH&#8221;</a>.  Kerberos users may need to make
	additional changes to implement
	<span class="application">OpenSSH</span> in their network.  These
	changes are described in <a class="xref" href="#kerberos5" title="13.5. Kerberos">Section 13.5, &#8220;<span class="application">Kerberos</span>&#8221;</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-pwpolicy"></a>13.2.4. Password Policy Enforcement</h3></div></div></div><p>Enforcing a strong password policy for local accounts is a
	fundamental aspect of system security.  In FreeBSD, password
	length, password strength, and password complexity can be
	implemented using built-in Pluggable Authentication Modules
	(<acronym class="acronym">PAM</acronym>).</p><p>This section demonstrates how to configure the minimum and
	maximum password length and the enforcement of mixed
	characters using the <code class="filename">pam_passwdqc.so</code>
	module.  This module is enforced when a user changes their
	password.</p><p>To configure this module, become the superuser and
	uncomment the line containing
	<code class="literal">pam_passwdqc.so</code> in
	<code class="filename">/etc/pam.d/passwd</code>.  Then, edit that line
	to match the password policy:</p><pre class="programlisting">password        requisite       pam_passwdqc.so         <em class="replaceable"><code>min=disabled,disabled,disabled,12,10 similar=deny retry=3</code></em> enforce=users</pre><p>This example sets several requirements for new passwords.
	The <code class="literal">min</code> setting controls the minimum
	password length.  It has five values because this module
	defines five different types of passwords based on their
	complexity.  Complexity is defined by the type of characters
	that must exist in a password, such as letters, numbers,
	symbols, and case.  The types of passwords are described in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pam_passwdqc</span>(8)</span></a>.  In this example, the first three types
	of passwords are disabled, meaning that passwords that meet
	those complexity requirements will not be accepted, regardless
	of their length.    The <code class="literal">12</code> sets a minimum
	password policy of at least twelve characters, if the password
	also contains characters with three types of complexity.  The
	<code class="literal">10</code> sets the password policy to also allow
	passwords of at least ten characters, if the password contains
	characters with four types of complexity.</p><p>The <code class="literal">similar</code> setting denies passwords
	that are similar to the user's previous password.  The
	<code class="literal">retry</code> setting provides a user with three
	opportunities to enter a new password.</p><p>Once this file is saved, a user changing their password
	will see a message similar to the following:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>passwd</code></strong>
Changing local password for trhodes
Old Password:

You can now choose the new password.
A valid password should be a mix of upper and lower case letters,
digits and other characters.  You can use a 12 character long
password with characters from at least 3 of these 4 classes, or
a 10 character long password containing characters from all the
classes.  Characters that form a common pattern are discarded by
the check.
Alternatively, if no one else can see your terminal now, you can
pick this as your password: "trait-useful&amp;knob".
Enter new password:</pre><p>If a password that does not match the policy is entered,
	it will be rejected with a warning and the user will have an
	opportunity to try again, up to the configured number of
	retries.</p><p>Most password policies require passwords to expire after
	so many days.  To set a password age time in FreeBSD, set
	<code class="option">passwordtime</code> for the user's login class in
	<code class="filename">/etc/login.conf</code>.  The
	<code class="literal">default</code> login class contains an
	example:</p><pre class="programlisting">#       :passwordtime=90d:\</pre><p>So, to set an expiry of 90 days for this login class,
	remove the comment symbol (<code class="literal">#</code>), save the
	edit, and run <code class="command">cap_mkdb
	  /etc/login.conf</code>.</p><p>To set the expiration on individual users, pass an
	expiration date or the number of days to expiry and a username
	to <code class="command">pw</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw usermod -p <em class="replaceable"><code>30-apr-2015</code></em> -n <em class="replaceable"><code>trhodes</code></em></code></strong></pre><p>As seen here, an expiration date is set in the form of
	day, month, and year.  For more information, see
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-rkhunter"></a>13.2.5. Detecting Rootkits</h3></div></div></div><p>A <em class="firstterm">rootkit</em> is any unauthorized
	software that attempts to gain <code class="systemitem">root</code> access to a system.  Once
	installed, this malicious software will normally open up
	another avenue of entry for an attacker.  Realistically, once
	a system has been compromised by a rootkit and an
	investigation has been performed, the system should be
	reinstalled from scratch.  There is tremendous risk that even
	the most prudent security or systems engineer will miss
	something an attacker left behind.</p><p>A rootkit does do one thing useful for administrators:
	once detected, it is a sign that a compromise happened at some
	point.  But, these types of applications tend to be very well
	hidden.  This section demonstrates a tool that can be used to
	detect rootkits, <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/rkhunter/pkg-descr">security/rkhunter</a>.</p><p>After installation of this package or port, the system may
	be checked using the following command.  It will produce a lot
	of information and will require some manual pressing of
	<span class="keycap"><strong>ENTER</strong></span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rkhunter -c</code></strong></pre><p>After the process completes, a status message will be
	printed to the screen.  This message will include the amount
	of files checked, suspect files, possible rootkits, and more.
	During the check, some generic security warnings may
	be produced about hidden files, the
	<span class="application">OpenSSH</span> protocol selection, and
	known vulnerable versions of installed software.  These can be
	handled now or after a more detailed analysis has been
	performed.</p><p>Every administrator should know what is running on the
	systems they are responsible for.  Third-party tools like
	<span class="application">rkhunter</span> and
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/lsof/pkg-descr">sysutils/lsof</a>, and native commands such
	as <code class="command">netstat</code> and <code class="command">ps</code>, can
	show a great deal of information on the system.  Take notes on
	what is normal, ask questions when something seems out of
	place, and be paranoid.  While preventing a compromise is
	ideal, detecting a compromise is a must.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ids"></a>13.2.6. Binary Verification</h3></div></div></div><p>Verification of system files and binaries is important
	because it provides the system administration and security
	teams information about system changes.  A software
	application that monitors the system for changes is called an
	Intrusion Detection System (<acronym class="acronym">IDS</acronym>).</p><p>FreeBSD provides native support for a basic
	<acronym class="acronym">IDS</acronym> system.  While the nightly security
	emails will notify an administrator of changes, the
	information is stored locally and there is a chance that a
	malicious user could modify this information in order to hide
	their changes to the system.  As such, it is recommended to
	create a separate set of binary signatures and store them on a
	read-only, root-owned directory or, preferably, on a removable
	<acronym class="acronym">USB</acronym> disk or remote
	<span class="application">rsync</span> server.</p><p>The built-in <code class="command">mtree</code> utility can be used
	to generate a specification of the contents of a directory.  A
	seed, or a numeric constant, is used to generate the
	specification and is required to check that the specification
	has not changed.  This makes it possible to determine if a
	file or binary has been modified.  Since the seed value is
	unknown by an attacker, faking or checking the checksum values
	of files will be difficult to impossible.  The following
	example generates a set of <acronym class="acronym">SHA256</acronym> hashes,
	one for each system binary in <code class="filename">/bin</code>, and
	saves those values to a hidden file in <code class="systemitem">root</code>'s home directory,
	<code class="filename">/root/.bin_chksum_mtree</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mtree -s <em class="replaceable"><code>3483151339707503</code></em> -c -K cksum,sha256digest -p <em class="replaceable"><code>/bin</code></em> &gt; <em class="replaceable"><code>/root/.bin_chksum_mtree</code></em></code></strong>
<code class="prompt">#</code> mtree: /bin checksum: 3427012225</pre><p>The <em class="replaceable"><code>3483151339707503</code></em> represents
	the seed.  This value should be remembered, but not
	shared.</p><p>Viewing <code class="filename">/root/.bin_cksum_mtree</code> should
	yield output similar to the following:</p><pre class="programlisting">#          user: root
#       machine: dreadnaught
#          tree: /bin
#          date: Mon Feb  3 10:19:53 2014

# .
/set type=file uid=0 gid=0 mode=0555 nlink=1 flags=none
.               type=dir mode=0755 nlink=2 size=1024 \
                time=1380277977.000000000
    \133        nlink=2 size=11704 time=1380277977.000000000 \
                cksum=484492447 \
                sha256digest=6207490fbdb5ed1904441fbfa941279055c3e24d3a4049aeb45094596400662a
    cat         size=12096 time=1380277975.000000000 cksum=3909216944 \
                sha256digest=65ea347b9418760b247ab10244f47a7ca2a569c9836d77f074e7a306900c1e69
    chflags     size=8168 time=1380277975.000000000 cksum=3949425175 \
                sha256digest=c99eb6fc1c92cac335c08be004a0a5b4c24a0c0ef3712017b12c89a978b2dac3
    chio        size=18520 time=1380277975.000000000 cksum=2208263309 \
                sha256digest=ddf7c8cb92a58750a675328345560d8cc7fe14fb3ccd3690c34954cbe69fc964
    chmod       size=8640 time=1380277975.000000000 cksum=2214429708 \
                sha256digest=a435972263bf814ad8df082c0752aa2a7bdd8b74ff01431ccbd52ed1e490bbe7</pre><p>The machine's hostname, the date and time the
	specification was created, and the name of the user who
	created the specification are included in this report.  There
	is a checksum, size, time, and <acronym class="acronym">SHA</acronym>256
	digest for each binary in the directory.</p><p>To verify that the binary signatures have not changed,
	compare the current contents of the directory to the
	previously generated specification, and save the results to a
	file.  This command requires the seed that was used to
	generate the original specification:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mtree -s <em class="replaceable"><code>3483151339707503</code></em> -p <em class="replaceable"><code>/bin</code></em> &lt; <em class="replaceable"><code>/root/.bin_chksum_mtree</code></em> &gt;&gt; <em class="replaceable"><code>/root/.bin_chksum_output</code></em></code></strong>
<code class="prompt">#</code> mtree: /bin checksum: 3427012225</pre><p>This should produce the same checksum for
	<code class="filename">/bin</code> that was produced when the
	specification was created.  If no changes have occurred to the
	binaries in this directory, the
	<code class="filename">/root/.bin_chksum_output</code> output file will
	be empty.  To simulate a change, change the date on
	<code class="filename">/bin/cat</code> using <code class="command">touch</code>
	and run the verification command again:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>touch /bin/cat</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mtree -s <em class="replaceable"><code>3483151339707503</code></em> -p <em class="replaceable"><code>/bin</code></em> &lt; <em class="replaceable"><code>/root/.bin_chksum_mtree</code></em> &gt;&gt; <em class="replaceable"><code>/root/.bin_chksum_output</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>more /root/.bin_chksum_output</code></strong>
cat changed
	modification time expected Fri Sep 27 06:32:55 2013 found Mon Feb  3 10:28:43 2014</pre><p>It is recommended to create specifications for the
	directories which contain binaries and configuration files, as
	well as any directories containing sensitive data.  Typically,
	specifications are created for <code class="filename">/bin</code>,
	<code class="filename">/sbin</code>, <code class="filename">/usr/bin</code>,
	<code class="filename">/usr/sbin</code>,
	<code class="filename">/usr/local/bin</code>,
	<code class="filename">/etc</code>, and
	<code class="filename">/usr/local/etc</code>.</p><p>More advanced <acronym class="acronym">IDS</acronym> systems exist, such
	as <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/aide/pkg-descr">security/aide</a>.  In most cases,
	<code class="command">mtree</code> provides the functionality
	administrators need.  It is important to keep the seed value
	and the checksum output hidden from malicious users.  More
	information about <code class="command">mtree</code> can be found in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mtree</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-tuning"></a>13.2.7. System Tuning for Security</h3></div></div></div><p>In FreeBSD, many system features can be tuned using
	<code class="command">sysctl</code>.  A few of the security features
	which can be tuned to prevent Denial of Service
	(<acronym class="acronym">DoS</acronym>) attacks will be covered in this
	section.  More information about using
	<code class="command">sysctl</code>, including how to temporarily change
	values and how to make the changes permanent after testing,
	can be found in <a class="xref" href="#configtuning-sysctl" title="11.9. Tuning with sysctl(8)">Section 11.9, &#8220;Tuning with sysctl(8)&#8221;</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Any time a setting is changed with
	  <code class="command">sysctl</code>, the chance to cause undesired
	  harm is increased, affecting the availability of the system.
	  All changes should be monitored and, if possible, tried on a
	  testing system before being used on a production
	  system.</p></div><p>By default, the FreeBSD kernel boots with a security level of
	<code class="literal">-1</code>.  This is called <span class="quote">&#8220;<span class="quote">insecure
	  mode</span>&#8221;</span> because immutable file flags may be turned off
	and all devices may be read from or written to.  The security
	level will remain at <code class="literal">-1</code> unless it is
	altered through <code class="command">sysctl</code> or by a setting in
	the startup scripts.  The security level may be increased
	during system startup by setting
	<code class="varname">kern_securelevel_enable</code> to
	<code class="literal">YES</code> in <code class="filename">/etc/rc.conf</code>,
	and the value of <code class="varname">kern_securelevel</code> to the
	desired security level.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=security&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">security</span>(7)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>
	for more information on these settings and the available
	security levels.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Increasing the <code class="varname">securelevel</code> can break
	  <span class="application">Xorg</span> and cause other issues.  Be
	  prepared to do some debugging.</p></div><p>The <code class="varname">net.inet.tcp.blackhole</code> and
	<code class="varname">net.inet.udp.blackhole</code> settings can be used
	to drop incoming <acronym class="acronym">SYN</acronym> packets on closed
	ports without sending a return <acronym class="acronym">RST</acronym>
	response.  The default behavior is to return an
	<acronym class="acronym">RST</acronym> to show a port is closed.  Changing the
	default provides some level of protection against ports scans,
	which are used to determine which applications are running on
	a system.  Set <code class="varname">net.inet.tcp.blackhole</code> to
	<code class="literal">2</code> and
	<code class="varname">net.inet.udp.blackhole</code> to
	<code class="literal">1</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=blackhole&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">blackhole</span>(4)</span></a> for more
	information about these settings.</p><p>The <code class="varname">net.inet.icmp.drop_redirect</code> and
	<code class="varname">net.inet.ip.redirect</code> settings help prevent
	against <em class="firstterm">redirect attacks</em>.  A redirect
	attack is a type of <acronym class="acronym">DoS</acronym> which sends mass
	numbers of <acronym class="acronym">ICMP</acronym> type 5 packets.  Since
	these packets are not required, set
	<code class="varname">net.inet.icmp.drop_redirect</code> to
	<code class="literal">1</code> and set
	<code class="varname">net.inet.ip.redirect</code> to
	<code class="literal">0</code>.</p><p>Source routing is a method for detecting and accessing
	non-routable addresses on the internal network.  This should
	be disabled as non-routable addresses are normally not
	routable on purpose.  To disable this feature, set
	<code class="varname">net.inet.ip.sourceroute</code> and
	<code class="varname">net.inet.ip.accept_sourceroute</code> to
	<code class="literal">0</code>.</p><p>When a machine on the network needs to send messages to
	all hosts on a subnet, an <acronym class="acronym">ICMP</acronym> echo request
	message is sent to the broadcast address.  However, there is
	no reason for an external host to perform such an action.  To
	reject all external broadcast requests, set
	<code class="varname">net.inet.icmp.bmcastecho</code> to
	<code class="literal">0</code>.</p><p>Some additional settings are documented in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=security&amp;sektion=7&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">security</span>(7)</span></a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="one-time-passwords"></a>13.3. One-time Passwords</h2></div></div></div><a id="idp56867960" class="indexterm"></a><a id="idp56868472" class="indexterm"></a><p>By default, FreeBSD includes support for One-time Passwords In
      Everything (<acronym class="acronym">OPIE</acronym>).  <acronym class="acronym">OPIE</acronym>
      is designed to prevent replay attacks, in which an attacker
      discovers a user's password and uses it to access a system.
      Since a password is only used once in <acronym class="acronym">OPIE</acronym>, a
      discovered password is of little use to an attacker.
      <acronym class="acronym">OPIE</acronym> uses a secure hash and a
      challenge/response system to manage passwords.  The FreeBSD
      implementation uses the <acronym class="acronym">MD5</acronym> hash by
      default.</p><p><acronym class="acronym">OPIE</acronym> uses three different types of
      passwords.  The first is the usual <span class="trademark">UNIX</span>® or Kerberos password.
      The second is the one-time password which is generated by
      <code class="command">opiekey</code>.  The third type of password is the
      <span class="quote">&#8220;<span class="quote">secret password</span>&#8221;</span> which is used to generate
      one-time passwords.  The secret password has nothing to do with,
      and should be different from, the <span class="trademark">UNIX</span>® password.</p><p>There are two other pieces of data that are important to
      <acronym class="acronym">OPIE</acronym>.  One is the <span class="quote">&#8220;<span class="quote">seed</span>&#8221;</span> or
      <span class="quote">&#8220;<span class="quote">key</span>&#8221;</span>, consisting of two letters and five digits.
      The other is the <span class="quote">&#8220;<span class="quote">iteration count</span>&#8221;</span>, a number
      between 1 and 100.  <acronym class="acronym">OPIE</acronym> creates the one-time
      password by concatenating the seed and the secret password,
      applying the <acronym class="acronym">MD5</acronym> hash as many times as
      specified by the iteration count, and turning the result into
      six short English words which represent the one-time password.
      The authentication system keeps track of the last one-time
      password used, and the user is authenticated if the hash of the
      user-provided password is equal to the previous password.
      Because a one-way hash is used, it is impossible to generate
      future one-time passwords if a successfully used password is
      captured.  The iteration count is decremented after each
      successful login to keep the user and the login program in sync.
      When the iteration count gets down to <code class="literal">1</code>,
      <acronym class="acronym">OPIE</acronym> must be reinitialized.</p><p>There are a few programs involved in this process.  A
      one-time password, or a consecutive list of one-time passwords,
      is generated by passing an iteration count, a seed, and a secret
      password to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a>.  In addition to initializing
      <acronym class="acronym">OPIE</acronym>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiepasswd</span>(1)</span></a> is used to change
      passwords, iteration counts, or seeds.  The relevant credential
      files in <code class="filename">/etc/opiekeys</code> are examined by
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opieinfo&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opieinfo</span>(1)</span></a> which prints out the invoking user's current
      iteration count and seed.</p><p>This section describes four different sorts of operations.
      The first is how to set up one-time-passwords for the first time
      over a secure connection.  The second is how to use
      <code class="command">opiepasswd</code> over an insecure connection.  The
      third is how to log in over an insecure connection.  The fourth
      is how to generate a number of keys which can be written down or
      printed out to use at insecure locations.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp56902648"></a>13.3.1. Initializing <acronym class="acronym">OPIE</acronym></h3></div></div></div><p>To initialize <acronym class="acronym">OPIE</acronym> for the first time,
	run this command from a secure location:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiepasswd -c</code></strong>
Adding unfurl:
Only use this method from the console; NEVER from remote. If you are using
telnet, xterm, or a dial-in, type ^C now or exit with no password.
Then run opiepasswd without the -c parameter.
Using MD5 to compute responses.
Enter new secret pass phrase:
Again new secret pass phrase:

ID unfurl OTP key is 499 to4268
MOS MALL GOAT ARM AVID COED</pre><p>The <code class="option">-c</code> sets console mode which assumes
	that the command is being run from a secure location, such as
	a computer under the user's control or a
	<acronym class="acronym">SSH</acronym> session to a computer under the user's
	control.</p><p>When prompted, enter the secret password which will be
	used to generate the one-time login keys.  This password
	should be difficult to guess and should be different than the
	password which is associated with the user's login account.
	It must be between 10 and 127 characters long.  Remember this
	password.</p><p>The <code class="literal">ID</code> line lists the login name
	(<code class="literal">unfurl</code>), default iteration count
	(<code class="literal">499</code>), and default seed
	(<code class="literal">to4268</code>).  When logging in, the system will
	remember these parameters and display them, meaning that they
	do not have to be memorized.  The last line lists the
	generated one-time password which corresponds to those
	parameters and the secret password.  At the next login, use
	this one-time password.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp56908920"></a>13.3.2. Insecure Connection Initialization</h3></div></div></div><p>To initialize or change the secret password on an
	insecure system, a secure connection is needed to some place
	where <code class="command">opiekey</code> can be run.  This might be a
	shell prompt on a trusted machine.  An iteration count is
	needed, where 100 is probably a good value, and the seed can
	either be specified or the randomly-generated one used.  On
	the insecure connection, the machine being initialized, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiepasswd</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiepasswd</code></strong>

Updating unfurl:
You need the response from an OTP generator.
Old secret pass phrase:
	otp-md5 498 to4268 ext
	Response: GAME GAG WELT OUT DOWN CHAT
New secret pass phrase:
	otp-md5 499 to4269
	Response: LINE PAP MILK NELL BUOY TROY

ID mark OTP key is 499 gr4269
LINE PAP MILK NELL BUOY TROY</pre><p>To accept the default seed, press <span class="keycap"><strong>Return</strong></span>.
	Before entering an access password, move over to the secure
	connection and give it the same parameters:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey 498 to4268</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</pre><p>Switch back over to the insecure connection, and copy the
	generated one-time password over to the relevant
	program.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp56939256"></a>13.3.3. Generating a Single One-time Password</h3></div></div></div><p>After initializing <acronym class="acronym">OPIE</acronym> and logging in,
	a prompt like this will be displayed:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>telnet example.com</code></strong>
Trying 10.0.0.1...
Connected to example.com
Escape character is '^]'.

FreeBSD/i386 (example.com) (ttypa)

login: <strong class="userinput"><code>&lt;username&gt;</code></strong>
otp-md5 498 gr4269 ext
Password: </pre><p>The <acronym class="acronym">OPIE</acronym> prompts provides a useful
	feature.  If <span class="keycap"><strong>Return</strong></span> is pressed at the
	password prompt, the prompt will turn echo on and display
	what is typed.  This can be useful when attempting to type in
	a password by hand from a printout.</p><a id="idp56943352" class="indexterm"></a><a id="idp56943864" class="indexterm"></a><a id="idp56944376" class="indexterm"></a><p>At this point, generate the one-time password to answer
	this login prompt.  This must be done on a trusted system
	where it is safe to run <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a>.  There are versions
	of this command for <span class="trademark">Windows</span>®, <span class="trademark">Mac OS</span>® and FreeBSD.  This command
	needs the iteration count and the seed as command line
	options.  Use cut-and-paste from the login prompt on the
	machine being logged in to.</p><p>On the trusted system:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey 498 to4268</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</pre><p>Once the one-time password is generated, continue to log
	in.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp56948984"></a>13.3.4. Generating Multiple One-time Passwords</h3></div></div></div><p>Sometimes there is no access to a trusted machine or
	secure connection.  In this case, it is possible to use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a> to generate a number of one-time passwords
	beforehand.  For example:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey -n 5 30 zz99999</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Do not use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: <strong class="userinput"><code>&lt;secret password&gt;</code></strong>
26: JOAN BORE FOSS DES NAY QUIT
27: LATE BIAS SLAY FOLK MUCH TRIG
28: SALT TIN ANTI LOON NEAL USE
29: RIO ODIN GO BYE FURY TIC
30: GREW JIVE SAN GIRD BOIL PHI</pre><p>The <code class="option">-n 5</code> requests five keys in sequence,
	and <code class="option">30</code> specifies what the last iteration
	number should be.  Note that these are printed out in
	<span class="emphasis"><em>reverse</em></span> order of use.  The really
	paranoid might want to write the results down by hand;
	otherwise, print the list.  Each line shows both the iteration
	count and the one-time password.  Scratch off the passwords as
	they are used.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp56957944"></a>13.3.5. Restricting Use of <span class="trademark">UNIX</span>® Passwords</h3></div></div></div><p><acronym class="acronym">OPIE</acronym> can restrict the use of <span class="trademark">UNIX</span>®
	passwords based on the IP address of a login session.  The
	relevant file is <code class="filename">/etc/opieaccess</code>, which
	is present by default.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=opieaccess&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">opieaccess</span>(5)</span></a> for more
	information on this file and which security considerations to
	be aware of when using it.</p><p>Here is a sample <code class="filename">opieaccess</code>:</p><pre class="programlisting">permit 192.168.0.0 255.255.0.0</pre><p>This line allows users whose IP source address (which is
	vulnerable to spoofing) matches the specified value and mask,
	to use <span class="trademark">UNIX</span>® passwords at any time.</p><p>If no rules in <code class="filename">opieaccess</code> are
	matched, the default is to deny non-<acronym class="acronym">OPIE</acronym>
	logins.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="tcpwrappers"></a>13.4. TCP Wrapper</h2></div><div><span class="authorgroup">Written
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp56979832" class="indexterm"></a><p><span class="application">TCP Wrapper</span> is a host-based
      access control system which extends the abilities of <a class="xref" href="#network-inetd" title="29.2. The inetd Super-Server">Section 29.2, &#8220;The <span class="application">inetd</span>
      Super-Server&#8221;</a>.  It can be configured to provide
      logging support, return messages, and connection restrictions
      for the server daemons under the control of
      <span class="application">inetd</span>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcpd</span>(8)</span></a> for
      more information about
      <span class="application">TCP Wrapper</span> and its features.</p><p><span class="application">TCP Wrapper</span> should not be
      considered a replacement for a properly configured firewall.
      Instead, <span class="application">TCP Wrapper</span> should be used
      in conjunction with a firewall and other security enhancements
      in order to provide another layer of protection in the
      implementation of a security policy.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp56983928"></a>13.4.1. Initial Configuration</h3></div></div></div><p>To enable <span class="application">TCP Wrapper</span> in FreeBSD,
	add the following lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">inetd_enable="YES"
inetd_flags="-Ww"</pre><p>Then, properly configure
	<code class="filename">/etc/hosts.allow</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Unlike other implementations of
	  <span class="application">TCP Wrapper</span>, the use of
	  <code class="filename">hosts.deny</code> is deprecated in FreeBSD.  All
	  configuration options should be placed in
	  <code class="filename">/etc/hosts.allow</code>.</p></div><p>In the simplest configuration, daemon connection policies
	are set to either permit or block, depending on the options in
	<code class="filename">/etc/hosts.allow</code>.  The default
	configuration in FreeBSD is to allow all connections to the
	daemons started with <span class="application">inetd</span>.</p><p>Basic configuration usually takes the form of
	<code class="literal">daemon : address : action</code>, where
	<code class="literal">daemon</code> is the daemon which
	<span class="application">inetd</span> started,
	<code class="literal">address</code> is a valid hostname,
	<acronym class="acronym">IP</acronym> address, or an IPv6 address enclosed in
	brackets ([ ]), and <code class="literal">action</code> is either
	<code class="literal">allow</code> or <code class="literal">deny</code>.
	<span class="application">TCP Wrapper</span> uses a first rule match
	semantic, meaning that the configuration file is scanned from
	the beginning for a matching rule.  When a match is found, the
	rule is applied and the search process stops.</p><p>For example, to allow <acronym class="acronym">POP</acronym>3 connections
	via the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/qpopper/pkg-descr">mail/qpopper</a> daemon, the following
	lines should be appended to
	<code class="filename">hosts.allow</code>:</p><pre class="programlisting"># This line is required for POP3 connections:
qpopper : ALL : allow</pre><p>Whenever this file is edited, restart
	<span class="application">inetd</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service inetd restart</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57001848"></a>13.4.2. Advanced Configuration</h3></div></div></div><p><span class="application">TCP Wrapper</span> provides advanced
	options to allow more control over the way connections are
	handled.  In some cases, it may be appropriate to return a
	comment to certain hosts or daemon connections.  In other
	cases, a log entry should be recorded or an email sent to the
	administrator.  Other situations may require the use of a
	service for local connections only.  This is all possible
	through the use of configuration options known as wildcards,
	expansion characters, and external command execution.</p><p>Suppose that a situation occurs where a connection should
	be denied yet a reason should be sent to the host who
	attempted to establish that connection.  That action is
	possible with <code class="option">twist</code>.  When a connection
	attempt is made, <code class="option">twist</code> executes a shell
	command or script.  An example exists in
	<code class="filename">hosts.allow</code>:</p><pre class="programlisting"># The rest of the daemons are protected.
ALL : ALL \
	: severity auth.info \
	: twist /bin/echo "You are not welcome to use %d from %h."</pre><p>In this example, the message <span class="quote">&#8220;<span class="quote">You are not allowed to
	  use <em class="replaceable"><code>daemon name</code></em> from
	  <em class="replaceable"><code>hostname</code></em>.</span>&#8221;</span> will be
	returned for any daemon not configured in
	<code class="filename">hosts.allow</code>.  This is useful for sending
	a reply back to the connection initiator right after the
	established connection is dropped.  Any message returned
	<span class="emphasis"><em>must</em></span> be wrapped in quote
	(<code class="literal">"</code>) characters.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">It may be possible to launch a denial of service attack
	  on the server if an attacker floods these daemons with
	  connection requests.</p></div><p>Another possibility is to use <code class="option">spawn</code>.
	Like <code class="option">twist</code>, <code class="option">spawn</code> implicitly
	denies the connection and may be used to run external shell
	commands or scripts.  Unlike <code class="option">twist</code>,
	<code class="option">spawn</code> will not send a reply back to the host
	who established the connection.  For example, consider the
	following configuration:</p><pre class="programlisting"># We do not allow connections from example.com:
ALL : .example.com \
	: spawn (/bin/echo %a from %h attempted to access %d &gt;&gt; \
	  /var/log/connections.log) \
	: deny</pre><p>This will deny all connection attempts from <code class="systemitem">*.example.com</code> and log the
	hostname, <acronym class="acronym">IP</acronym> address, and the daemon to
	which access was attempted to
	<code class="filename">/var/log/connections.log</code>.  This example
	uses the substitution characters <code class="literal">%a</code> and
	<code class="literal">%h</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> for the
	complete list.</p><p>To match every instance of a daemon, domain, or
	<acronym class="acronym">IP</acronym> address, use <code class="literal">ALL</code>.
	Another wildcard is <code class="literal">PARANOID</code> which may be
	used to match any host which provides an <acronym class="acronym">IP</acronym>
	address that may be forged because the <acronym class="acronym">IP</acronym>
	address differs from its resolved hostname.  In this example,
	all connection requests to <span class="application">Sendmail</span>
	which have an <acronym class="acronym">IP</acronym> address that varies from
	its hostname will be denied:</p><pre class="programlisting"># Block possibly spoofed requests to sendmail:
sendmail : PARANOID : deny</pre><div xmlns="" class="caution"><h3 class="admontitle">Caution: </h3><p xmlns="http://www.w3.org/1999/xhtml">Using the <code class="literal">PARANOID</code> wildcard will
	  result in denied connections if the client or server has a
	  broken <acronym class="acronym">DNS</acronym> setup.</p></div><p>To learn more about wildcards and their associated
	functionality, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">When adding new configuration lines, make sure that any
	  unneeded entries for that daemon are commented out in
	  <code class="filename">hosts.allow</code>.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kerberos5"></a>13.5. <span class="application">Kerberos</span></h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tillman</span> <span class="surname">Hodgson</span></span>. </span></div><div><span class="authorgroup">Based on a contribution by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mark</span> <span class="surname">Murray</span></span>. </span></div></div></div><p><span class="application">Kerberos</span> is a network
      authentication protocol which was originally created by the
      Massachusetts Institute of Technology (<acronym class="acronym">MIT</acronym>)
      as a way to securely provide authentication across a potentially
      hostile network.  The <span class="application">Kerberos</span>
      protocol uses strong cryptography so that both a client and
      server can prove their identity without sending any unencrypted
      secrets over the network.  <span class="application">Kerberos</span>
      can be described as an identity-verifying proxy system and as a
      trusted third-party authentication system.  After a user
      authenticates with <span class="application">Kerberos</span>, their
      communications can be encrypted to assure privacy and data
      integrity.</p><p>The only function of <span class="application">Kerberos</span> is
      to provide the secure authentication of users and servers on the
      network.  It does not provide authorization or auditing
      functions.  It is recommended that
      <span class="application">Kerberos</span> be used with other security
      methods which provide authorization and audit services.</p><p>The current version of the protocol is version 5, described
      in <acronym class="acronym">RFC</acronym> 4120.  Several free
      implementations of this protocol are available, covering a wide
      range of operating systems.  <acronym class="acronym">MIT</acronym> continues to
      develop their <span class="application">Kerberos</span> package.  It
      is commonly used in the <acronym class="acronym">US</acronym> as a cryptography
      product, and has historically been subject to
      <acronym class="acronym">US</acronym> export regulations.  In FreeBSD,
      <acronym class="acronym">MIT</acronym> <span class="application">Kerberos</span> is
      available as the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a> package or
      port.  The Heimdal <span class="application">Kerberos</span>
      implementation was explicitly developed outside of the
      <acronym class="acronym">US</acronym> to avoid export regulations.  The Heimdal
      <span class="application">Kerberos</span> distribution is included in
      the base FreeBSD installation, and another distribution with more
      configurable options is available as
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/heimdal/pkg-descr">security/heimdal</a> in the Ports
      Collection.</p><p>In <span class="application">Kerberos</span> users and services
      are identified as <span class="quote">&#8220;<span class="quote">principals</span>&#8221;</span> which are contained
      within an administrative grouping, called a
      <span class="quote">&#8220;<span class="quote">realm</span>&#8221;</span>.  A typical user principal would be of the
      form
      <code class="literal"><em class="replaceable"><code>user</code></em>@<em class="replaceable"><code>REALM</code></em></code>
      (realms are traditionally uppercase).</p><p>This section provides a guide on how to set up
      <span class="application">Kerberos</span> using the Heimdal
      distribution included in FreeBSD.</p><p>For purposes of demonstrating a
      <span class="application">Kerberos</span> installation, the name
      spaces will be as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <acronym class="acronym">DNS</acronym> domain (zone) will be
	  <code class="systemitem">example.org</code>.</p></li><li class="listitem"><p>The <span class="application">Kerberos</span> realm will be
	  <code class="literal">EXAMPLE.ORG</code>.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Use real domain names when setting up
	<span class="application">Kerberos</span>, even if it will run
	internally.  This avoids <acronym class="acronym">DNS</acronym> problems and
	assures inter-operation with other
	<span class="application">Kerberos</span> realms.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57070712"></a>13.5.1. Setting up a Heimdal <acronym class="acronym">KDC</acronym></h3></div></div></div><a id="idp57071608" class="indexterm"></a><p>The Key Distribution Center (<acronym class="acronym">KDC</acronym>) is
	the centralized authentication service that
	<span class="application">Kerberos</span> provides, the
	<span class="quote">&#8220;<span class="quote">trusted third party</span>&#8221;</span> of the system.  It is the
	computer that issues <span class="application">Kerberos</span>
	tickets, which are used for clients to authenticate to
	servers.  Because the <acronym class="acronym">KDC</acronym> is considered
	trusted by all other computers in the
	<span class="application">Kerberos</span> realm, it has heightened
	security concerns.  Direct access to the KDC should be
	limited.</p><p>While running a <acronym class="acronym">KDC</acronym> requires few
	computing resources, a dedicated machine acting only as a
	<acronym class="acronym">KDC</acronym> is recommended for security
	reasons.</p><p>To begin, install the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/heimdal/pkg-descr">security/heimdal</a>
	package as follows:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install heimdal</code></strong></pre><p>Next, update <code class="filename">/etc/rc.conf</code> using
	<code class="command">sysrc</code> as follows:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc kdc_enable=yes</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc kadmind_enable=yes</code></strong></pre><p>Next, edit <code class="filename">/etc/krb5.conf</code> as
	follows:</p><pre class="programlisting">[libdefaults]
    default_realm = <em class="replaceable"><code>EXAMPLE.ORG</code></em>
[realms]
    <em class="replaceable"><code>EXAMPLE.ORG</code></em> = {
	kdc = <em class="replaceable"><code>kerberos.example.org</code></em>
	admin_server = <em class="replaceable"><code>kerberos.example.org</code></em>
    }
[domain_realm]
    <em class="replaceable"><code>.example.org</code></em> = <em class="replaceable"><code>EXAMPLE.ORG</code></em></pre><p>In this example, the <acronym class="acronym">KDC</acronym> will use the
	fully-qualified hostname <code class="systemitem">kerberos.example.org</code>.  The
	hostname of the KDC must be resolvable in the
	<acronym class="acronym">DNS</acronym>.</p><p><span class="application">Kerberos</span> can also use the
	<acronym class="acronym">DNS</acronym> to locate KDCs, instead of a
	<code class="literal">[realms]</code> section in
	<code class="filename">/etc/krb5.conf</code>.  For large organizations
	that have their own <acronym class="acronym">DNS</acronym> servers, the above
	example could be trimmed to:</p><pre class="programlisting">[libdefaults]
      default_realm = <em class="replaceable"><code>EXAMPLE.ORG</code></em>
[domain_realm]
    <em class="replaceable"><code>.example.org</code></em> = <em class="replaceable"><code>EXAMPLE.ORG</code></em></pre><p>With the following lines being included in the
	<code class="systemitem">example.org</code> zone
	file:</p><pre class="programlisting">_kerberos._udp      IN  SRV     01 00 88 <em class="replaceable"><code>kerberos.example.org</code></em>.
_kerberos._tcp      IN  SRV     01 00 88 <em class="replaceable"><code>kerberos.example.org</code></em>.
_kpasswd._udp       IN  SRV     01 00 464 <em class="replaceable"><code>kerberos.example.org</code></em>.
_kerberos-adm._tcp  IN  SRV     01 00 749 <em class="replaceable"><code>kerberos.example.org</code></em>.
_kerberos           IN  TXT     <em class="replaceable"><code>EXAMPLE.ORG</code></em></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In order for clients to be able to find the
	  <span class="application">Kerberos</span> services, they
	  <span class="emphasis"><em>must</em></span> have either
	  a fully configured <code class="filename">/etc/krb5.conf</code> or a
	  minimally configured <code class="filename">/etc/krb5.conf</code>
	  <span class="emphasis"><em>and</em></span> a properly configured
	  <acronym class="acronym">DNS</acronym> server.</p></div><p>Next, create the <span class="application">Kerberos</span>
	database which contains the keys of all principals (users and
	hosts) encrypted with a master password.  It is not required
	to remember this password as it will be stored in
	<code class="filename">/var/heimdal/m-key</code>; it would be
	reasonable to use a 45-character random password for this
	purpose.  To create the master key, run
	<code class="command">kstash</code> and enter a password:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kstash</code></strong>
Master key: <strong class="userinput"><code><em class="replaceable"><code>xxxxxxxxxxxxxxxxxxxxxxx</code></em></code></strong>
Verifying password - Master key: <strong class="userinput"><code><em class="replaceable"><code>xxxxxxxxxxxxxxxxxxxxxxx</code></em></code></strong></pre><p>Once the master key has been created, the database should
	be initialized.  The <span class="application">Kerberos</span>
	administrative tool <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kadmin</span>(8)</span></a> can be used on the KDC in a
	mode that operates directly on the database, without using the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kadmind</span>(8)</span></a> network service, as
	<code class="command">kadmin -l</code>.  This resolves the
	chicken-and-egg problem of trying to connect to the database
	before it is created.  At the <code class="command">kadmin</code>
	prompt, use <code class="command">init</code> to create the realm's
	initial database:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin -l</code></strong>
kadmin&gt; <strong class="userinput"><code>init <em class="replaceable"><code>EXAMPLE.ORG</code></em></code></strong>
Realm max ticket life [unlimited]:</pre><p>Lastly, while still in <code class="command">kadmin</code>, create
	the first principal using <code class="command">add</code>.  Stick to
	the default options for the principal for now, as these can be
	changed later with <code class="command">modify</code>.
	Type <code class="literal">?</code> at the prompt to see the available
	options.</p><pre class="screen">kadmin&gt; <strong class="userinput"><code>add tillman</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Principal expiration time [never]:
Password expiration time [never]:
Attributes []:
Password: <strong class="userinput"><code><em class="replaceable"><code>xxxxxxxx</code></em></code></strong>
Verifying password - Password: <strong class="userinput"><code><em class="replaceable"><code>xxxxxxxx</code></em></code></strong></pre><p>Next, start the <acronym class="acronym">KDC</acronym> services by
	running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service kdc start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service kadmind start</code></strong></pre><p>While there will not be any kerberized daemons running at
	this point, it is possible to confirm that the
	<acronym class="acronym">KDC</acronym> is functioning by obtaining a ticket
	for the principal that was just created:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kinit <em class="replaceable"><code>tillman</code></em></code></strong>
tillman@EXAMPLE.ORG's Password:</pre><p>Confirm that a ticket was successfully obtained using
	<code class="command">klist</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>klist</code></strong>
Credentials cache: FILE:/tmp/krb5cc_1001
	Principal: tillman@EXAMPLE.ORG

  Issued                Expires               Principal
Aug 27 15:37:58 2013  Aug 28 01:37:58 2013  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</pre><p>The temporary ticket can be destroyed when the test is
	finished:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kdestroy</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57140472"></a>13.5.2. Configuring a Server to Use
	<span class="application">Kerberos</span></h3></div></div></div><a id="idp57141368" class="indexterm"></a><p>The first step in configuring a server to use
	<span class="application">Kerberos</span> authentication is to
	ensure that it has the correct configuration in
	<code class="filename">/etc/krb5.conf</code>.  The version from the
	<acronym class="acronym">KDC</acronym> can be used as-is, or it can be
	regenerated on the new system.</p><p>Next, create <code class="filename">/etc/krb5.keytab</code> on the
	server.  This is the main part of <span class="quote">&#8220;<span class="quote">Kerberizing</span>&#8221;</span> a
	service &#8212; it corresponds to generating a secret shared
	between the service and the <acronym class="acronym">KDC</acronym>.  The
	secret is a cryptographic key, stored in a
	<span class="quote">&#8220;<span class="quote">keytab</span>&#8221;</span>.  The keytab contains the server's host
	key, which allows it and the <acronym class="acronym">KDC</acronym> to verify
	each others' identity.  It must be transmitted to the server
	in a secure fashion, as the security of the server can be
	broken if the key is made public.  Typically, the
	<code class="filename">keytab</code> is generated on an administrator's
	trusted machine using <code class="command">kadmin</code>, then securely
	transferred to the server, e.g., with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>; it can also
	be created directly on the server if that is consistent with
	the desired security policy.  It is very important that the
	keytab is transmitted to the server in a secure fashion: if
	the key is known by some other party, that party can
	impersonate any user to the server!  Using
	<code class="command">kadmin</code> on the server directly is
	convenient, because the entry for the host principal in the
	<acronym class="acronym">KDC</acronym> database is also created using
	<code class="command">kadmin</code>.</p><p>Of course, <code class="command">kadmin</code> is a kerberized
	service; a <span class="application">Kerberos</span> ticket is
	needed to authenticate to the network service, but to ensure
	that the user running <code class="command">kadmin</code> is actually
	present (and their session has not been hijacked),
	<code class="command">kadmin</code> will prompt for the password to get
	a fresh ticket.  The principal authenticating to the kadmin
	service must be permitted to use the <code class="command">kadmin</code>
	interface, as specified in
	<code class="filename">/var/heimdal/kadmind.acl</code>.  See the
	section titled <span class="quote">&#8220;<span class="quote">Remote administration</span>&#8221;</span> in
	<code class="command">info heimdal</code> for details on designing
	access control lists.  Instead of enabling remote
	<code class="command">kadmin</code> access, the administrator could
	securely connect to the <acronym class="acronym">KDC</acronym> via the local
	console or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>, and perform administration locally
	using <code class="command">kadmin -l</code>.</p><p>After installing <code class="filename">/etc/krb5.conf</code>,
	use <code class="command">add --random-key</code> in
	<code class="command">kadmin</code>.  This adds the server's host
	principal to the database, but does not extract a copy of the
	host principal key to a keytab.  To generate the keytab, use
	<code class="command">ext</code> to extract the server's host principal
	key to its own keytab:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> add --random-key host/myserver.example.org</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Principal expiration time [never]:
Password expiration time [never]:
Attributes []:
kadmin&gt;<strong class="userinput"><code> ext_keytab <em class="replaceable"><code>host/myserver.example.org</code></em></code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p>Note that <code class="command">ext_keytab</code> stores the
	extracted key in <code class="filename">/etc/krb5.keytab</code> by
	default.  This is good when being run on the server being
	kerberized, but the <code class="command">--keytab
	  <em class="replaceable"><code>path/to/file</code></em></code> argument
	should be used when the keytab is being extracted
	elsewhere:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> ext_keytab --keytab=/tmp/example.keytab <em class="replaceable"><code>host/myserver.example.org</code></em></code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p>The keytab can then be securely copied to the server
	using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a> or a removable media.  Be sure to specify a
	non-default keytab name to avoid inserting unneeded keys into
	the system's keytab.</p><p>At this point, the server can read encrypted messages from
	the <acronym class="acronym">KDC</acronym> using its shared key, stored in
	<code class="filename">krb5.keytab</code>.  It is now ready for the
	<span class="application">Kerberos</span>-using services to be
	enabled.  One of the most common such services is
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a>, which supports
	<span class="application">Kerberos</span> via the
	<acronym class="acronym">GSS-API</acronym>.  In
	<code class="filename">/etc/ssh/sshd_config</code>, add the
	line:</p><pre class="programlisting">GSSAPIAuthentication yes</pre><p>After making this change, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> must be restarted
	for the new configuration to take effect:
	<code class="command">service sshd restart</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57193592"></a>13.5.3. Configuring a Client to Use
	<span class="application">Kerberos</span></h3></div></div></div><a id="idp57194488" class="indexterm"></a><p>As it was for the server, the client requires
	configuration in <code class="filename">/etc/krb5.conf</code>.  Copy
	the file in place (securely) or re-enter it as needed.</p><p>Test the client by using <code class="command">kinit</code>,
	<code class="command">klist</code>, and <code class="command">kdestroy</code> from
	the client to obtain, show, and then delete a ticket for an
	existing principal.  <span class="application">Kerberos</span>
	applications should also be able to connect to
	<span class="application">Kerberos</span> enabled servers.  If that
	does not work but obtaining a ticket does, the problem is
	likely with the server and not with the client or the
	<acronym class="acronym">KDC</acronym>.  In the case of kerberized
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>, <acronym class="acronym">GSS-API</acronym> is disabled by
	default, so test using <code class="command">ssh -o
	  GSSAPIAuthentication=yes
	  <em class="replaceable"><code>hostname</code></em></code>.</p><p>When testing a Kerberized application, try using a packet
	sniffer such as <code class="command">tcpdump</code> to confirm that no
	sensitive information is sent in the clear.</p><p>Various <span class="application">Kerberos</span> client
	applications are available.  With the advent of a bridge so
	that applications using <acronym class="acronym">SASL</acronym> for
	authentication can use <acronym class="acronym">GSS-API</acronym> mechanisms
	as well, large classes of client applications can use
	<span class="application">Kerberos</span> for authentication, from
	Jabber clients to <acronym class="acronym">IMAP</acronym> clients.</p><a id="idp57203960" class="indexterm"></a><a id="idp57204856" class="indexterm"></a><p>Users within a realm typically have their
	<span class="application">Kerberos</span> principal mapped to a
	local user account.  Occasionally, one needs to grant access
	to a local user account to someone who does not have a
	matching <span class="application">Kerberos</span> principal.  For
	example, <code class="systemitem">tillman@EXAMPLE.ORG</code> may need
	access to the local user account <code class="systemitem">webdevelopers</code>.  Other
	principals may also need access to that local account.</p><p>The <code class="filename">.k5login</code> and
	<code class="filename">.k5users</code> files, placed in a user's home
	directory, can be used to solve this problem.  For example, if
	the following <code class="filename">.k5login</code> is placed in the
	home directory of <code class="systemitem">webdevelopers</code>, both principals
	listed will have access to that account without requiring a
	shared password:</p><pre class="programlisting">tillman@example.org
jdoe@example.org</pre><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ksu&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ksu</span>(1)</span></a> for more information about
	<code class="filename">.k5users</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57212024"></a>13.5.4. <acronym class="acronym">MIT</acronym> Differences</h3></div></div></div><p>The major difference between the <acronym class="acronym">MIT</acronym>
	and Heimdal implementations is that <code class="command">kadmin</code>
	has a different, but equivalent, set of commands and uses a
	different protocol.  If the <acronym class="acronym">KDC</acronym> is
	<acronym class="acronym">MIT</acronym>, the Heimdal version of
	<code class="command">kadmin</code> cannot be used to administer the
	<acronym class="acronym">KDC</acronym> remotely, and vice versa.</p><p>Client applications may also use slightly different
	command line options to accomplish the same tasks.  Following
	the instructions at <a class="link" href="http://web.mit.edu/Kerberos/www/" target="_top">http://web.mit.edu/Kerberos/www/</a>
	is recommended.  Be careful of path issues: the
	<acronym class="acronym">MIT</acronym> port installs into
	<code class="filename">/usr/local/</code> by default, and the FreeBSD
	system applications run instead of the
	<acronym class="acronym">MIT</acronym> versions if <code class="envar">PATH</code> lists
	the system directories first.</p><p>When using MIT Kerberos as a <acronym class="acronym">KDC</acronym> on
	FreeBSD, the following edits should also be made to
	<code class="filename">rc.conf</code>:</p><pre class="programlisting">kdc_program="/usr/local/sbin/kdc"
kadmind_program="/usr/local/sbin/kadmind"
kdc_flags=""
kdc_enable="YES"
kadmind_enable="YES"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57219832"></a>13.5.5. <span class="application">Kerberos</span> Tips, Tricks, and
	Troubleshooting</h3></div></div></div><p>When configuring and troubleshooting
	<span class="application">Kerberos</span>, keep the following points
	in mind:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>When using either Heimdal or <acronym class="acronym">MIT</acronym>
	    <span class="application">Kerberos</span> from ports, ensure
	    that the <code class="envar">PATH</code> lists the port's versions of
	    the client applications before the system versions.</p></li><li class="listitem"><p>If all the computers in the realm do not have
	    synchronized time settings, authentication may fail.
	    <a class="xref" href="#network-ntp" title="29.11. Clock Synchronization with NTP">Section 29.11, &#8220;Clock Synchronization with NTP&#8221;</a> describes how to synchronize
	    clocks using <acronym class="acronym">NTP</acronym>.</p></li><li class="listitem"><p>If the hostname is changed, the <code class="systemitem">host/</code> principal must be
	    changed and the keytab updated.  This also applies to
	    special keytab entries like the <code class="systemitem">HTTP/</code> principal used for
	    Apache's <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/mod_auth_kerb/pkg-descr">www/mod_auth_kerb</a>.</p></li><li class="listitem"><p>All hosts in the realm must be both forward and
	    reverse resolvable in <acronym class="acronym">DNS</acronym> or, at a
	    minimum, exist in <code class="filename">/etc/hosts</code>.  CNAMEs
	    will work, but the A and PTR records must be correct and
	    in place.  The error message for unresolvable hosts is not
	    intuitive: <span class="errorname">Kerberos5 refuses authentication
	      because Read req failed: Key table entry not
	      found</span>.</p></li><li class="listitem"><p>Some operating systems that act as clients to the
	    <acronym class="acronym">KDC</acronym> do not set the permissions for
	    <code class="command">ksu</code> to be setuid <code class="systemitem">root</code>.  This means that
	    <code class="command">ksu</code> does not work.  This is a
	    permissions problem, not a <acronym class="acronym">KDC</acronym>
	    error.</p></li><li class="listitem"><p>With <acronym class="acronym">MIT</acronym>
	    <span class="application">Kerberos</span>, to allow a principal
	    to have a ticket life longer than the default lifetime of
	    ten hours, use <code class="command">modify_principal</code> at the
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kadmin</span>(8)</span></a> prompt to change the
	    <code class="literal">maxlife</code> of both the principal in
	    question and the
	    <code class="systemitem">krbtgt</code>
	    principal.  The principal can then use
	    <code class="command">kinit -l</code> to request a ticket with a
	    longer lifetime.</p></li><li class="listitem"><p>When running a packet sniffer on the
	    <acronym class="acronym">KDC</acronym> to aid in troubleshooting while
	    running <code class="command">kinit</code> from a workstation, the
	    Ticket Granting Ticket (<acronym class="acronym">TGT</acronym>) is sent
	    immediately, even before the password is typed.  This is
	    because the <span class="application">Kerberos</span> server
	    freely transmits a <acronym class="acronym">TGT</acronym> to any
	    unauthorized request.  However, every
	    <acronym class="acronym">TGT</acronym> is encrypted in a key derived from
	    the user's password.  When a user types their password, it
	    is not sent to the <acronym class="acronym">KDC</acronym>, it is instead
	    used to decrypt the <acronym class="acronym">TGT</acronym> that
	    <code class="command">kinit</code> already obtained.  If the
	    decryption process results in a valid ticket with a valid
	    time stamp, the user has valid
	    <span class="application">Kerberos</span> credentials.  These
	    credentials include a session key for establishing secure
	    communications with the
	    <span class="application">Kerberos</span> server in the future,
	    as well as the actual <acronym class="acronym">TGT</acronym>, which is
	    encrypted with the <span class="application">Kerberos</span>
	    server's own key.  This second layer of encryption allows
	    the <span class="application">Kerberos</span> server to verify
	    the authenticity of each <acronym class="acronym">TGT</acronym>.</p></li><li class="listitem"><p>Host principals can have a longer ticket lifetime.  If
	    the user principal has a lifetime of a week but the host
	    being connected to has a lifetime of nine hours, the user
	    cache will have an expired host principal and the ticket
	    cache will not work as expected.</p></li><li class="listitem"><p>When setting up <code class="filename">krb5.dict</code> to
	    prevent specific bad passwords from being used as
	    described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kadmind</span>(8)</span></a>, remember that it only
	    applies to principals that have a password policy assigned
	    to them.  The format used in
	    <code class="filename">krb5.dict</code> is one string per line.
	    Creating a symbolic link to
	    <code class="filename">/usr/share/dict/words</code> might be
	    useful.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57291896"></a>13.5.6. Mitigating <span class="application">Kerberos</span>
	Limitations</h3></div></div></div><a id="idp57292920" class="indexterm"></a><p>Since <span class="application">Kerberos</span> is an all or
	nothing approach, every service enabled on the network must
	either be modified to work with
	<span class="application">Kerberos</span> or be otherwise secured
	against network attacks.  This is to prevent user credentials
	from being stolen and re-used.  An example is when
	<span class="application">Kerberos</span> is enabled on all remote
	shells but the non-Kerberized <acronym class="acronym">POP3</acronym> mail
	server sends passwords in plain text.</p><p>The <acronym class="acronym">KDC</acronym> is a single point of failure.
	By design, the <acronym class="acronym">KDC</acronym> must be as secure as its
	master password database.  The <acronym class="acronym">KDC</acronym> should
	have absolutely no other services running on it and should be
	physically secure.  The danger is high because
	<span class="application">Kerberos</span> stores all passwords
	encrypted with the same master key which is stored as a file
	on the <acronym class="acronym">KDC</acronym>.</p><p>A compromised master key is not quite as bad as one might
	fear.  The master key is only used to encrypt the
	<span class="application">Kerberos</span> database and as a seed for
	the random number generator.  As long as access to the
	<acronym class="acronym">KDC</acronym> is secure, an attacker cannot do much
	with the master key.</p><p>If the <acronym class="acronym">KDC</acronym> is unavailable, network
	services are unusable as authentication cannot be performed.
	This can be alleviated with a single master
	<acronym class="acronym">KDC</acronym> and one or more slaves, and with
	careful implementation of secondary or fall-back
	authentication using <acronym class="acronym">PAM</acronym>.</p><p><span class="application">Kerberos</span> allows users, hosts
	and services to authenticate between themselves.  It does not
	have a mechanism to authenticate the
	<acronym class="acronym">KDC</acronym> to the users, hosts, or services.  This
	means that a trojanned <code class="command">kinit</code> could record
	all user names and passwords.  File system integrity checking
	tools like <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/tripwire/pkg-descr">security/tripwire</a> can
	alleviate this.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57307256"></a>13.5.7. Resources and Further Information</h3></div></div></div><a id="idp57307896" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html" target="_top">
	      The <span class="application">Kerberos</span>
	      FAQ</a></p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/dialogue.html" target="_top">Designing
	      an Authentication System: a Dialog in Four
	      Scenes</a></p></li><li class="listitem"><p><a class="link" href="https://www.ietf.org/rfc/rfc4120.txt" target="_top">RFC
	      4120, The <span class="application">Kerberos</span> Network
	      Authentication Service (V5)</a></p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/" target="_top"><acronym class="acronym">MIT</acronym>
	      <span class="application">Kerberos</span> home
	      page</a></p></li><li class="listitem"><p><a class="link" href="https://github.com/heimdal/heimdal/wiki" target="_top">Heimdal
	      <span class="application">Kerberos</span> project wiki
	      page</a></p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="openssl"></a>13.6. OpenSSL</h2></div><div><span class="authorgroup">Written
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp57323384" class="indexterm"></a><p><span class="application">OpenSSL</span> is an open source
      implementation of the <acronym class="acronym">SSL</acronym> and
      <acronym class="acronym">TLS</acronym> protocols.  It provides an encryption
      transport layer on top of the normal communications layer,
      allowing it to be intertwined with many network applications and
      services.</p><p>The version of <span class="application">OpenSSL</span> included
      in FreeBSD supports the Secure Sockets Layer 3.0 (SSLv3)
      and Transport Layer Security 1.0/1.1/1.2 (TLSv1/TLSv1.1/TLSv1.2)
      network security
      protocols and can be used as a general cryptographic
      library.  In FreeBSD 12.0-RELEASE and above, OpenSSL also supports
      Transport Layer Security 1.3 (TLSv1.3).</p><p><span class="application">OpenSSL</span> is often used to encrypt
      authentication of mail clients and to secure web based
      transactions such as credit card payments.  Some ports, such as
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/apache24/pkg-descr">www/apache24</a> and
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/databases/postgresql11-server/pkg-descr">databases/postgresql11-server</a>, include a
      compile option for building with
      <span class="application">OpenSSL</span>.  If selected, the port will
      add support using <span class="application">OpenSSL</span> from the
      base system.  To instead have the port compile against
      <span class="application">OpenSSL</span> from the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/openssl/pkg-descr">security/openssl</a> port, add the following to
      <code class="filename">/etc/make.conf</code>:</p><pre class="programlisting">DEFAULT_VERSIONS+= ssl=openssl</pre><p>Another common use of <span class="application">OpenSSL</span> is
      to provide certificates for use with software applications.
      Certificates can be used to verify the credentials of a company
      or individual.  If a certificate has not been signed by an
      external <em class="firstterm">Certificate Authority</em>
      (<acronym class="acronym">CA</acronym>), such as <a class="link" href="http://www.verisign.com" target="_top">http://www.verisign.com</a>,
      the application that uses the certificate will produce a
      warning.  There is a cost associated with obtaining a signed
      certificate and using a signed certificate is not mandatory as
      certificates can be self-signed.  However, using an external
      authority will prevent warnings and can put users at
      ease.</p><p>This section demonstrates how to create and use certificates
      on a FreeBSD system.  Refer to <a class="xref" href="#ldap-config" title="29.5.2. Configuring an LDAP Server">Section 29.5.2, &#8220;Configuring an <acronym class="acronym">LDAP</acronym> Server&#8221;</a> for an
      example of how to create a <acronym class="acronym">CA</acronym> for signing
      one's own certificates.</p><p>For more information about <acronym class="acronym">SSL</acronym>, read the
      free <a class="link" href="https://www.feistyduck.com/books/openssl-cookbook/" target="_top">OpenSSL
	Cookbook</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57351288"></a>13.6.1. Generating Certificates</h3></div></div></div><a id="idp57351928" class="indexterm"></a><p>To generate a certificate that will be signed by an
	external <acronym class="acronym">CA</acronym>, issue the following command
	and input the information requested at the prompts.  This
	input information will be written to the certificate.  At the
	<code class="literal">Common Name</code> prompt, input the fully
	qualified name for the system that will use the certificate.
	If this name does not match the server, the application
	verifying the certificate will issue a warning to the user,
	rendering the verification provided by the certificate as
	useless.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -nodes -out req.pem -keyout cert.key -sha256 -newkey rsa:2048</code></strong>
Generating a 2048 bit RSA private key
..................+++
.............................................................+++
writing new private key to 'cert.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<strong class="userinput"><code><em class="replaceable"><code>US</code></em></code></strong>
State or Province Name (full name) [Some-State]:<strong class="userinput"><code><em class="replaceable"><code>PA</code></em></code></strong>
Locality Name (eg, city) []:<strong class="userinput"><code><em class="replaceable"><code>Pittsburgh</code></em></code></strong>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<strong class="userinput"><code><em class="replaceable"><code>My Company</code></em></code></strong>
Organizational Unit Name (eg, section) []:<strong class="userinput"><code><em class="replaceable"><code>Systems Administrator</code></em></code></strong>
Common Name (eg, YOUR name) []:<strong class="userinput"><code><em class="replaceable"><code>localhost.example.org</code></em></code></strong>
Email Address []:<strong class="userinput"><code><em class="replaceable"><code>trhodes@FreeBSD.org</code></em></code></strong>

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:<strong class="userinput"><code><em class="replaceable"><code>Another Name</code></em></code></strong></pre><p>Other options, such as the expire time and alternate
	encryption algorithms, are available when creating a
	certificate.  A complete list of options is described in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">openssl</span>(1)</span></a>.</p><p>This command will create two files in the current
	directory.  The certificate request,
	<code class="filename">req.pem</code>, can be sent to a
	<acronym class="acronym">CA</acronym> who will validate the entered
	credentials, sign the request, and return the signed
	certificate.  The second file,
	<code class="filename">cert.key</code>, is the private key for the
	certificate and should be stored in a secure location.  If
	this falls in the hands of others, it can be used to
	impersonate the user or the server.</p><p>Alternately, if a signature from a <acronym class="acronym">CA</acronym>
	is not required, a self-signed certificate can be created.
	First, generate the <acronym class="acronym">RSA</acronym> key:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl genrsa -rand -genkey -out cert.key 2048</code></strong>
0 semi-random bytes loaded
Generating RSA private key, 2048 bit long modulus
.............................................+++
.................................................................................................................+++
e is 65537 (0x10001)</pre><p>Use this key to create a self-signed certificate.
	Follow the usual prompts for creating a certificate:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -x509 -days 365 -key cert.key -out cert.crt -sha256</code></strong>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<strong class="userinput"><code><em class="replaceable"><code>US</code></em></code></strong>
State or Province Name (full name) [Some-State]:<strong class="userinput"><code><em class="replaceable"><code>PA</code></em></code></strong>
Locality Name (eg, city) []:<strong class="userinput"><code><em class="replaceable"><code>Pittsburgh</code></em></code></strong>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<strong class="userinput"><code><em class="replaceable"><code>My Company</code></em></code></strong>
Organizational Unit Name (eg, section) []:<strong class="userinput"><code><em class="replaceable"><code>Systems Administrator</code></em></code></strong>
Common Name (e.g. server FQDN or YOUR name) []:<strong class="userinput"><code><em class="replaceable"><code>localhost.example.org</code></em></code></strong>
Email Address []:<strong class="userinput"><code><em class="replaceable"><code>trhodes@FreeBSD.org</code></em></code></strong></pre><p>This will create two new files in the current directory: a
	private key file
	<code class="filename">cert.key</code>, and the certificate itself,
	<code class="filename">cert.crt</code>.  These should be placed in a
	directory, preferably under <code class="filename">/etc/ssl/</code>,
	which is readable only by <code class="systemitem">root</code>.  Permissions of
	<code class="literal">0700</code> are appropriate for these files and
	can be set using <code class="command">chmod</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57376120"></a>13.6.2. Using Certificates</h3></div></div></div><p>One use for a certificate is to encrypt connections to the
	<span class="application">Sendmail</span> mail server in order to
	prevent the use of clear text authentication.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some mail clients will display an error if the user has
	  not installed a local copy of the certificate.  Refer to the
	  documentation included with the software for more
	  information on certificate installation.</p></div><p>In FreeBSD 10.0-RELEASE and above, it is possible to create a
	self-signed certificate for
	<span class="application">Sendmail</span> automatically.  To enable
	this, add the following lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">sendmail_enable="YES"
sendmail_cert_create="YES"
sendmail_cert_cn="<em class="replaceable"><code>localhost.example.org</code></em>"</pre><p>This will automatically create a self-signed certificate,
	<code class="filename">/etc/mail/certs/host.cert</code>, a signing key,
	<code class="filename">/etc/mail/certs/host.key</code>, and a
	<acronym class="acronym">CA</acronym> certificate,
	<code class="filename">/etc/mail/certs/cacert.pem</code>.  The
	certificate will use the <code class="literal">Common Name</code>
	specified in <code class="option">sendmail_cert_cn</code>.  After saving
	the edits, restart <span class="application">Sendmail</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sendmail restart</code></strong></pre><p>If all went well, there will be no error messages in
	<code class="filename">/var/log/maillog</code>.  For a simple test,
	connect to the mail server's listening port using
	<code class="command">telnet</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>telnet <em class="replaceable"><code>example.com</code></em> 25</code></strong>
Trying 192.0.34.166...
Connected to example.com.
Escape character is '^]'.
220 example.com ESMTP Sendmail 8.14.7/8.14.7; Fri, 18 Apr 2014 11:50:32 -0400 (EDT)
<strong class="userinput"><code>ehlo <em class="replaceable"><code>example.com</code></em></code></strong>
250-example.com Hello example.com [192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
<strong class="userinput"><code>quit</code></strong>
221 2.0.0 example.com closing connection
Connection closed by foreign host.</pre><p>If the <code class="literal">STARTTLS</code> line appears in the
	output, everything is working correctly.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ipsec"></a>13.7. <acronym class="acronym">VPN</acronym> over
	<acronym class="acronym">IPsec</acronym></h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Nik</span> <span class="surname">Clayton</span></span>. </span></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Hiten M.</span> <span class="surname">Pandya</span></span>. </span></div></div></div><a id="idp57413752" class="indexterm"></a><p>Internet Protocol Security (<acronym class="acronym">IPsec</acronym>) is a
      set of protocols which sit on top of the Internet Protocol
      (<acronym class="acronym">IP</acronym>) layer.  It allows two or more hosts to
      communicate in a secure manner by authenticating and encrypting
      each <acronym class="acronym">IP</acronym> packet of a communication session.
      The FreeBSD <acronym class="acronym">IPsec</acronym> network stack is based on the
      <a class="link" href="http://www.kame.net/" target="_top">http://www.kame.net/</a>
      implementation and supports both <acronym class="acronym">IPv4</acronym> and
      <acronym class="acronym">IPv6</acronym> sessions.</p><a id="idp57417976" class="indexterm"></a><a id="idp57419256" class="indexterm"></a><p><acronym class="acronym">IPsec</acronym> is comprised of the following
      sub-protocols:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Encapsulated Security Payload
	    (<acronym class="acronym">ESP</acronym>)</em></span>: this protocol
	  protects the <acronym class="acronym">IP</acronym> packet data from third
	  party interference by encrypting the contents using
	  symmetric cryptography algorithms such as Blowfish and
	  <acronym class="acronym">3DES</acronym>.</p></li><li class="listitem"><p><span class="emphasis"><em>Authentication Header
	    (<acronym class="acronym">AH</acronym>)</em></span>: this protocol
	  protects the <acronym class="acronym">IP</acronym> packet header from third
	  party interference and spoofing by computing a cryptographic
	  checksum and hashing the <acronym class="acronym">IP </acronym> packet
	  header fields with a secure hashing function.  This is then
	  followed by an additional header that contains the hash, to
	  allow the information in the packet to be
	  authenticated.</p></li><li class="listitem"><p><span class="emphasis"><em>IP Payload Compression Protocol
	    (<acronym class="acronym">IPComp</acronym></em></span>): this protocol
	  tries to increase communication performance by compressing
	  the <acronym class="acronym">IP </acronym> payload in order to reduce the
	  amount of data sent.</p></li></ul></div><p>These protocols can either be used together or separately,
      depending on the environment.</p><a id="idp57432184" class="indexterm"></a><a id="idp57433080" class="indexterm"></a><p><acronym class="acronym">IPsec</acronym> supports two modes of operation.
      The first mode, <em class="firstterm">Transport Mode</em>, protects
      communications between two hosts.  The second mode,
      <em class="firstterm">Tunnel Mode</em>, is used to build virtual
      tunnels, commonly known as Virtual Private Networks
      (<acronym class="acronym">VPN</acronym>s).  Consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipsec&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipsec</span>(4)</span></a> for detailed
      information on the <acronym class="acronym">IPsec</acronym> subsystem in
      FreeBSD.</p><p><acronym class="acronym">IPsec</acronym> support is enabled by default on
      FreeBSD 11 and later.  For previous versions of FreeBSD, add
      these options to a custom kernel configuration file and rebuild
      the kernel using the instructions in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>:</p><a id="idp57442296" class="indexterm"></a><pre class="screen">options   IPSEC        #IP security
device    crypto</pre><a id="idp57443832" class="indexterm"></a><p>If <acronym class="acronym">IPsec</acronym> debugging support is desired,
      the following kernel option should also be added:</p><pre class="screen">options   IPSEC_DEBUG  #debug for IP security</pre><p>This rest of this chapter demonstrates the process of
      setting up an <acronym class="acronym">IPsec</acronym> <acronym class="acronym">VPN</acronym>
      between a home network and a corporate network.  In the example
      scenario:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Both sites are connected to the Internet through a
	  gateway that is running FreeBSD.</p></li><li class="listitem"><p>The gateway on each network has at least one external
	  <acronym class="acronym">IP</acronym> address.  In this example, the
	  corporate <acronym class="acronym">LAN</acronym>'s external
	  <acronym class="acronym">IP</acronym> address is <code class="systemitem">172.16.5.4</code> and the home
	  <acronym class="acronym">LAN</acronym>'s external <acronym class="acronym">IP</acronym>
	  address is <code class="systemitem">192.168.1.12</code>.</p></li><li class="listitem"><p>The internal addresses of the two networks can be either
	  public or private <acronym class="acronym">IP</acronym> addresses.  However,
	  the address space must not collide.  For example, both
	  networks cannot use <code class="systemitem">192.168.1.x</code>.  In this
	  example, the corporate <acronym class="acronym">LAN</acronym>'s internal
	  <acronym class="acronym">IP</acronym> address is <code class="systemitem">10.246.38.1</code> and the home
	  <acronym class="acronym">LAN</acronym>'s internal <acronym class="acronym">IP</acronym>
	  address is <code class="systemitem">10.0.0.5</code>.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57456376"></a>13.7.1. Configuring a <acronym class="acronym">VPN</acronym> on FreeBSD</h3></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>To begin, <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/ipsec-tools/pkg-descr">security/ipsec-tools</a> must be
	installed from the Ports Collection.  This software provides a
	number of applications which support the configuration.</p><p>The next requirement is to create two <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gif&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gif</span>(4)</span></a>
	pseudo-devices which will be used to tunnel packets and allow
	both networks to communicate properly.  As <code class="systemitem">root</code>, run the following
	commands, replacing <em class="replaceable"><code>internal</code></em> and
	<em class="replaceable"><code>external</code></em> with the real IP
	addresses of the internal and external interfaces of the two
	gateways:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 <em class="replaceable"><code>internal1 internal2</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 tunnel <em class="replaceable"><code>external1 external2</code></em></code></strong></pre><p>Verify the setup on each gateway, using
	<code class="command">ifconfig</code>.  Here is the output from Gateway
	1:</p><pre class="programlisting">gif0: flags=8051 mtu 1280
tunnel inet 172.16.5.4 --&gt; 192.168.1.12
inet6 fe80::2e0:81ff:fe02:5881%gif0 prefixlen 64 scopeid 0x6
inet 10.246.38.1 --&gt; 10.0.0.5 netmask 0xffffff00</pre><p>Here is the output from Gateway 2:</p><pre class="programlisting">gif0: flags=8051 mtu 1280
tunnel inet 192.168.1.12 --&gt; 172.16.5.4
inet 10.0.0.5 --&gt; 10.246.38.1 netmask 0xffffff00
inet6 fe80::250:bfff:fe3a:c1f%gif0 prefixlen 64 scopeid 0x4</pre><p>Once complete, both internal <acronym class="acronym">IP</acronym>
	addresses should be reachable using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>:</p><pre class="screen">priv-net<code class="prompt">#</code> <strong class="userinput"><code>ping 10.0.0.5</code></strong>
PING 10.0.0.5 (10.0.0.5): 56 data bytes
64 bytes from 10.0.0.5: icmp_seq=0 ttl=64 time=42.786 ms
64 bytes from 10.0.0.5: icmp_seq=1 ttl=64 time=19.255 ms
64 bytes from 10.0.0.5: icmp_seq=2 ttl=64 time=20.440 ms
64 bytes from 10.0.0.5: icmp_seq=3 ttl=64 time=21.036 ms
--- 10.0.0.5 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 19.255/25.879/42.786/9.782 ms</pre><pre class="screen">corp-net<code class="prompt">#</code> <strong class="userinput"><code>ping 10.246.38.1</code></strong>
PING 10.246.38.1 (10.246.38.1): 56 data bytes
64 bytes from 10.246.38.1: icmp_seq=0 ttl=64 time=28.106 ms
64 bytes from 10.246.38.1: icmp_seq=1 ttl=64 time=42.917 ms
64 bytes from 10.246.38.1: icmp_seq=2 ttl=64 time=127.525 ms
64 bytes from 10.246.38.1: icmp_seq=3 ttl=64 time=119.896 ms
64 bytes from 10.246.38.1: icmp_seq=4 ttl=64 time=154.524 ms
--- 10.246.38.1 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 28.106/94.594/154.524/49.814 ms</pre><p>As expected, both sides have the ability to send and
	receive <acronym class="acronym">ICMP</acronym> packets from the privately
	configured addresses.  Next, both gateways must be told how to
	route packets in order to correctly send traffic from either
	network.  The following commands will achieve this
	goal:</p><pre class="screen">corp-net<code class="prompt">#</code> <strong class="userinput"><code>route add <em class="replaceable"><code>10.0.0.0 10.0.0.5 255.255.255.0</code></em></code></strong>
corp-net<code class="prompt">#</code> <strong class="userinput"><code>route add net <em class="replaceable"><code>10.0.0.0: gateway 10.0.0.5</code></em></code></strong></pre><pre class="screen">priv-net<code class="prompt">#</code> <strong class="userinput"><code>route add <em class="replaceable"><code>10.246.38.0 10.246.38.1 255.255.255.0</code></em></code></strong>
priv-net<code class="prompt">#</code> <strong class="userinput"><code>route add host <em class="replaceable"><code>10.246.38.0: gateway 10.246.38.1</code></em></code></strong></pre><p>At this point, internal machines should be reachable from
	each gateway as well as from machines behind the gateways.
	Again, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> to confirm:</p><pre class="screen">corp-net<code class="prompt">#</code> <strong class="userinput"><code>ping 10.0.0.8</code></strong>
PING 10.0.0.8 (10.0.0.8): 56 data bytes
64 bytes from 10.0.0.8: icmp_seq=0 ttl=63 time=92.391 ms
64 bytes from 10.0.0.8: icmp_seq=1 ttl=63 time=21.870 ms
64 bytes from 10.0.0.8: icmp_seq=2 ttl=63 time=198.022 ms
64 bytes from 10.0.0.8: icmp_seq=3 ttl=63 time=22.241 ms
64 bytes from 10.0.0.8: icmp_seq=4 ttl=63 time=174.705 ms
--- 10.0.0.8 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.870/101.846/198.022/74.001 ms</pre><pre class="screen">priv-net<code class="prompt">#</code> <strong class="userinput"><code>ping 10.246.38.107</code></strong>
PING 10.246.38.1 (10.246.38.107): 56 data bytes
64 bytes from 10.246.38.107: icmp_seq=0 ttl=64 time=53.491 ms
64 bytes from 10.246.38.107: icmp_seq=1 ttl=64 time=23.395 ms
64 bytes from 10.246.38.107: icmp_seq=2 ttl=64 time=23.865 ms
64 bytes from 10.246.38.107: icmp_seq=3 ttl=64 time=21.145 ms
64 bytes from 10.246.38.107: icmp_seq=4 ttl=64 time=36.708 ms
--- 10.246.38.107 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.145/31.721/53.491/12.179 ms</pre><p>Setting up the tunnels is the easy part.  Configuring a
	secure link is a more in depth process.  The following
	configuration uses pre-shared (<acronym class="acronym">PSK</acronym>)
	<acronym class="acronym">RSA</acronym> keys.  Other than the
	<acronym class="acronym">IP</acronym> addresses, the
	<code class="filename">/usr/local/etc/racoon/racoon.conf</code> on both
	gateways will be identical and look similar to:</p><pre class="programlisting">path    pre_shared_key  "/usr/local/etc/racoon/psk.txt"; #location of pre-shared key file
log     debug;	#log verbosity setting: set to 'notify' when testing and debugging is complete

padding	# options are not to be changed
{
        maximum_length  20;
        randomize       off;
        strict_check    off;
        exclusive_tail  off;
}

timer	# timing options. change as needed
{
        counter         5;
        interval        20 sec;
        persend         1;
#       natt_keepalive  15 sec;
        phase1          30 sec;
        phase2          15 sec;
}

listen	# address [port] that racoon will listen on
{
        isakmp          172.16.5.4 [500];
        isakmp_natt     172.16.5.4 [4500];
}

remote  192.168.1.12 [500]
{
        exchange_mode   main,aggressive;
        doi             ipsec_doi;
        situation       identity_only;
        my_identifier   address 172.16.5.4;
        peers_identifier        address 192.168.1.12;
        lifetime        time 8 hour;
        passive         off;
        proposal_check  obey;
#       nat_traversal   off;
        generate_policy off;

                        proposal {
                                encryption_algorithm    blowfish;
                                hash_algorithm          md5;
                                authentication_method   pre_shared_key;
                                lifetime time           30 sec;
                                dh_group                1;
                        }
}

sainfo  (address 10.246.38.0/24 any address 10.0.0.0/24 any)	# address $network/$netmask $type address $network/$netmask $type ( $type being any or esp)
{								# $network must be the two internal networks you are joining.
        pfs_group       1;
        lifetime        time    36000 sec;
        encryption_algorithm    blowfish,3des;
        authentication_algorithm        hmac_md5,hmac_sha1;
        compression_algorithm   deflate;
}</pre><p>For descriptions of each available option, refer to the
	manual page for <code class="filename">racoon.conf</code>.</p><p>The Security Policy Database (<acronym class="acronym">SPD</acronym>)
	needs to be configured so that FreeBSD and
	<span class="application">racoon</span> are able to encrypt and
	decrypt network traffic between the hosts.</p><p>This can be achieved with a shell script, similar to the
	following, on the corporate gateway.  This file will be used
	during system initialization and should be saved as
	<code class="filename">/usr/local/etc/racoon/setkey.conf</code>.</p><pre class="programlisting">flush;
spdflush;
# To the home network
spdadd 10.246.38.0/24 10.0.0.0/24 any -P out ipsec esp/tunnel/172.16.5.4-192.168.1.12/use;
spdadd 10.0.0.0/24 10.246.38.0/24 any -P in ipsec esp/tunnel/192.168.1.12-172.16.5.4/use;</pre><p>Once in place, <span class="application">racoon</span> may be
	started on both gateways using the following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf -l /var/log/racoon.log</code></strong></pre><p>The output should be similar to the following:</p><pre class="screen">corp-net<code class="prompt">#</code> <strong class="userinput"><code>/usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf</code></strong>
Foreground mode.
2006-01-30 01:35:47: INFO: begin Identity Protection mode.
2006-01-30 01:35:48: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:35:55: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:36:04: INFO: ISAKMP-SA established 172.16.5.4[500]-192.168.1.12[500] spi:623b9b3bd2492452:7deab82d54ff704a
2006-01-30 01:36:05: INFO: initiate new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=28496098(0x1b2d0e2)
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=47784998(0x2d92426)
2006-01-30 01:36:13: INFO: respond new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=124397467(0x76a279b)
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=175852902(0xa7b4d66)</pre><p>To ensure the tunnel is working properly, switch to
	another console and use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> to view network
	traffic using the following command.  Replace
	<code class="literal">em0</code> with the network interface card as
	required:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tcpdump -i em0 host <em class="replaceable"><code>172.16.5.4 and dst 192.168.1.12</code></em></code></strong></pre><p>Data similar to the following should appear on the
	console.  If not, there is an issue and debugging the
	returned data will be required.</p><pre class="programlisting">01:47:32.021683 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xa)
01:47:33.022442 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xb)
01:47:34.024218 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xc)</pre><p>At this point, both networks should be available and seem
	to be part of the same network.  Most likely both networks are
	protected by a firewall.  To allow traffic to flow between
	them, rules need to be added to pass packets.  For the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> firewall, add the following lines to the firewall
	configuration file:</p><pre class="programlisting">ipfw add 00201 allow log esp from any to any
ipfw add 00202 allow log ah from any to any
ipfw add 00203 allow log ipencap from any to any
ipfw add 00204 allow log udp from any 500 to any</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The rule numbers may need to be altered depending on the
	  current host configuration.</p></div><p>For users of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pf</span>(4)</span></a> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a>, the following
	rules should do the trick:</p><pre class="programlisting">pass in quick proto esp from any to any
pass in quick proto ah from any to any
pass in quick proto ipencap from any to any
pass in quick proto udp from any port = 500 to any port = 500
pass in quick on gif0 from any to any
pass out quick proto esp from any to any
pass out quick proto ah from any to any
pass out quick proto ipencap from any to any
pass out quick proto udp from any port = 500 to any port = 500
pass out quick on gif0 from any to any</pre><p>Finally, to allow the machine to start support for the
	<acronym class="acronym">VPN</acronym> during system initialization, add the
	following lines to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ipsec_enable="YES"
ipsec_program="/usr/local/sbin/setkey"
ipsec_file="/usr/local/etc/racoon/setkey.conf" # allows setting up spd policies on boot
racoon_enable="yes"</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="openssh"></a>13.8. OpenSSH</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><a id="idp57581176" class="indexterm"></a><a id="idp57581688" class="indexterm"></a><p><span class="application">OpenSSH</span> is a set of network
      connectivity tools used to provide secure access to remote
      machines.  Additionally, <acronym class="acronym">TCP/IP</acronym> connections
      can be tunneled or forwarded securely through
      <acronym class="acronym">SSH</acronym> connections.
      <span class="application">OpenSSH</span> encrypts all traffic to
      effectively eliminate eavesdropping, connection hijacking, and
      other network-level attacks.</p><p><span class="application">OpenSSH</span> is maintained by the
      OpenBSD project and is installed by default in FreeBSD.  It is
      compatible with both <acronym class="acronym">SSH</acronym> version 1 and 2
      protocols.</p><p>When data is sent over the network in an unencrypted form,
      network sniffers anywhere in between the client and server can
      steal user/password information or data transferred during the
      session.  <span class="application">OpenSSH</span> offers a variety of
      authentication and encryption methods to prevent this from
      happening.  More information about
      <span class="application">OpenSSH</span> is available from <a class="link" href="http://www.openssh.com/" target="_top">http://www.openssh.com/</a>.</p><p>This section provides an overview of the built-in client
      utilities to securely access other systems and securely transfer
      files from a FreeBSD system.  It then describes how to configure a
      <acronym class="acronym">SSH</acronym> server on a FreeBSD system.  More
      information is available in the man pages mentioned in this
      chapter.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57588472"></a>13.8.1. Using the SSH Client Utilities</h3></div></div></div><a id="idp57589112" class="indexterm"></a><p>To log into a <acronym class="acronym">SSH</acronym> server, use
	<code class="command">ssh</code> and specify a username that exists on
	that server and the <acronym class="acronym">IP</acronym> address or hostname
	of the server.  If this is the first time a connection has
	been made to the specified server, the user will be prompted
	to first verify the server's fingerprint:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ssh <em class="replaceable"><code>user@example.com</code></em></code></strong>
The authenticity of host 'example.com (10.0.0.1)' can't be established.
ECDSA key fingerprint is 25:cc:73:b5:b3:96:75:3d:56:19:49:d2:5c:1f:91:3b.
Are you sure you want to continue connecting (yes/no)? <strong class="userinput"><code>yes</code></strong>
Permanently added 'example.com' (ECDSA) to the list of known hosts.
Password for user@example.com: <strong class="userinput"><code><em class="replaceable"><code>user_password</code></em></code></strong></pre><p><acronym class="acronym">SSH</acronym> utilizes a key fingerprint system
	to verify the authenticity of the server when the client
	connects.  When the user accepts the key's fingerprint by
	typing <code class="literal">yes</code> when connecting for the first
	time, a copy of the key is saved to
	<code class="filename">.ssh/known_hosts</code> in the user's home
	directory.  Future attempts to login are verified against the
	saved key and <code class="command">ssh</code> will display an alert if
	the server's key does not match the saved key.  If this
	occurs, the user should first verify why the key has changed
	before continuing with the connection.</p><p>By default, recent versions of
	<span class="application">OpenSSH</span> only accept
	<acronym class="acronym">SSH</acronym>v2 connections.  By default, the client
	will use version 2 if possible and will fall back to version 1
	if the server does not support version 2.  To force
	<code class="command">ssh</code> to only use the specified protocol,
	include <code class="option">-1</code> or <code class="option">-2</code>.
	Additional options are described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>.</p><a id="idp57602808" class="indexterm"></a><a id="idp57603960" class="indexterm"></a><p>Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a> to securely copy a file to or from a
	remote machine.  This example copies
	<code class="filename">COPYRIGHT</code> on the remote system to a file
	of the same name in the current directory of the local
	system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>scp <em class="replaceable"><code>user@example.com:/COPYRIGHT COPYRIGHT</code></em></code></strong>
Password for user@example.com: <strong class="userinput"><code><em class="replaceable"><code>*******</code></em></code></strong>
COPYRIGHT            100% |*****************************|  4735
00:00
<code class="prompt">#</code></pre><p>Since the fingerprint was already verified for this host,
	the server's key is automatically checked before prompting for
	the user's password.</p><p>The arguments passed to <code class="command">scp</code> are similar
	to <code class="command">cp</code>.  The file or files to copy is the
	first argument and the destination to copy to is the second.
	Since the file is fetched over the network, one or more of the
	file arguments takes the form
	<code class="option">user@host:&lt;path_to_remote_file&gt;</code>.  Be
	aware when copying directories recursively that
	<code class="command">scp</code> uses <code class="option">-r</code>, whereas
	<code class="command">cp</code> uses <code class="option">-R</code>.</p><p>To open an interactive session for copying files, use
	<code class="command">sftp</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sftp</span>(1)</span></a> for a list of
	available commands while in an <code class="command">sftp</code>
	session.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ssh-keygen"></a>13.8.1.1. Key-based Authentication</h4></div></div></div><p>Instead of using passwords, a client can be configured
	  to connect to the remote machine using keys.  To generate
	  <acronym class="acronym">RSA</acronym>
	  authentication keys, use <code class="command">ssh-keygen</code>.  To
	  generate a public and private key pair, specify the type of
	  key and follow the prompts.  It is recommended to protect
	  the keys with a memorable, but hard to guess
	  passphrase.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh-keygen -t rsa</code></strong>
Generating public/private rsa key pair.
Enter file in which to save the key (/home/user/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):  <a id="co-ssh-keygen-passphrase1"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
Enter same passphrase again:                 <a id="co-ssh-keygen-passphrase2"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
Your identification has been saved in /home/user/.ssh/id_rsa.
Your public key has been saved in /home/user/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:54Xm9Uvtv6H4NOo6yjP/YCfODryvUU7yWHzMqeXwhq8 user@host.example.com
The key's randomart image is:
+---[RSA 2048]----+
|                 |
|                 |
|                 |
|        . o..    |
|       .S*+*o    |
|      . O=Oo . . |
|       = Oo= oo..|
|      .oB.* +.oo.|
|       =OE**.o..=|
+----[SHA256]-----+</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ssh-keygen-passphrase1"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Type a passphrase here.  It can contain spaces and
	      symbols.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ssh-keygen-passphrase2"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Retype the passphrase to verify it.</p></td></tr></table></div><p>The private key
	  is stored in <code class="filename">~/.ssh/id_rsa</code>
	  and the public key
	  is stored in <code class="filename">~/.ssh/id_rsa.pub</code>.
	  The
	  <span class="emphasis"><em>public</em></span> key must be copied to
	  <code class="filename">~/.ssh/authorized_keys</code> on the remote
	  machine for key-based authentication to
	  work.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Many users believe that keys are secure by design and
	    will use a key without a passphrase.  This is
	    <span class="emphasis"><em>dangerous</em></span> behavior.  An
	    administrator can verify that a key pair is protected by a
	    passphrase by viewing the private key manually.  If the
	    private key file contains the word
	    <code class="literal">ENCRYPTED</code>, the key owner is using a
	    passphrase.  In addition, to better secure end users,
	    <code class="literal">from</code> may be placed in the public key
	    file.  For example, adding
	    <code class="literal">from="192.168.10.5"</code> in front of the
	    <code class="literal">ssh-rsa</code>
	    prefix will only allow that specific user to log in from
	    that <acronym class="acronym">IP</acronym> address.</p></div><p>The options and files vary with different versions of
	  <span class="application">OpenSSH</span>.
	  To avoid problems, consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a>.</p><p>If a passphrase is used, the user is prompted for
	  the passphrase each time a connection is made to the server.
	  To load <acronym class="acronym">SSH</acronym> keys into memory and remove
	  the need to type the passphrase each time, use
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh-add&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></a>.</p><p>Authentication is handled by
	  <code class="command">ssh-agent</code>, using the private keys that
	  are loaded into it.  <code class="command">ssh-agent</code>
	  can be used to launch another application like a
	  shell or a window manager.</p><p>To use <code class="command">ssh-agent</code> in a shell, start it
	  with a shell as an argument.  Add the identity by
	  running <code class="command">ssh-add</code> and entering the
	  passphrase for the private key.
	  The user will then be able to <code class="command">ssh</code>
	  to any host that has the corresponding public key installed.
	  For example:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh-agent <em class="replaceable"><code>csh</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>ssh-add</code></strong>
Enter passphrase for key '/usr/home/user/.ssh/id_rsa':  <a id="co-ssh-agent-passphrase"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
Identity added: /usr/home/user/.ssh/id_rsa (/usr/home/user/.ssh/id_rsa)
<code class="prompt">%</code></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ssh-agent-passphrase"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Enter the passphrase for the key.</p></td></tr></table></div><p>To use <code class="command">ssh-agent</code> in
	  <span class="application">Xorg</span>, add an entry for it in
	  <code class="filename">~/.xinitrc</code>.  This provides the
	  <code class="command">ssh-agent</code> services to all programs
	  launched in <span class="application">Xorg</span>.  An example
	  <code class="filename">~/.xinitrc</code> might look like this:</p><pre class="programlisting">exec ssh-agent <em class="replaceable"><code>startxfce4</code></em></pre><p>This launches <code class="command">ssh-agent</code>, which in
	  turn launches <span class="application">XFCE</span>, every time
	  <span class="application">Xorg</span> starts.  Once
	  <span class="application">Xorg</span> has been restarted so that
	  the changes can take effect, run <code class="command">ssh-add</code>
	  to load all of the <acronym class="acronym">SSH</acronym> keys.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ssh-tunneling"></a>13.8.1.2. <acronym class="acronym">SSH</acronym> Tunneling</h4></div></div></div><a id="idp57679864" class="indexterm"></a><p><span class="application">OpenSSH</span> has the ability to
	  create a tunnel to encapsulate another protocol in an
	  encrypted session.</p><p>The following command tells <code class="command">ssh</code> to
	  create a tunnel for
	  <span class="application">telnet</span>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>5023:localhost:23 user@foo.example.com</code></em></code></strong>
<code class="prompt">%</code></pre><p>This example uses the following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-2</code></span></dt><dd><p>Forces <code class="command">ssh</code> to use version 2 to
		connect to the server.</p></dd><dt><span class="term"><code class="option">-N</code></span></dt><dd><p>Indicates no command, or tunnel only.  If omitted,
		<code class="command">ssh</code> initiates a normal
		session.</p></dd><dt><span class="term"><code class="option">-f</code></span></dt><dd><p>Forces <code class="command">ssh</code> to run in the
		background.</p></dd><dt><span class="term"><code class="option">-L</code></span></dt><dd><p>Indicates a local tunnel in
		<em class="replaceable"><code>localport:remotehost:remoteport</code></em>
		format.</p></dd><dt><span class="term"><code class="option">user@foo.example.com</code></span></dt><dd><p>The login name to use on the specified remote
		<acronym class="acronym">SSH</acronym> server.</p></dd></dl></div><p>An <acronym class="acronym">SSH</acronym> tunnel works by creating a
	  listen socket on <code class="systemitem">localhost</code> on the
	  specified <code class="literal">localport</code>.  It then forwards
	  any connections received on <code class="literal">localport</code> via
	  the <acronym class="acronym">SSH</acronym> connection to the specified
	  <code class="literal">remotehost:remoteport</code>.  In the example,
	  port <code class="literal">5023</code> on the client is forwarded to
	  port <code class="literal">23</code> on the remote machine.  Since
	  port 23 is used by <span class="application">telnet</span>, this
	  creates an encrypted <span class="application">telnet</span>
	  session through an <acronym class="acronym">SSH</acronym> tunnel.</p><p>This method can be used to wrap any number of insecure
	  <acronym class="acronym">TCP</acronym> protocols such as
	  <acronym class="acronym">SMTP</acronym>, <acronym class="acronym">POP3</acronym>, and
	  <acronym class="acronym">FTP</acronym>, as seen in the following
	  examples.</p><div class="example"><a id="idp57718264"></a><div class="example-title">Example 13.1. Create a Secure Tunnel for
	    <acronym class="acronym">SMTP</acronym></div><div class="example-contents"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>5025:localhost:25 user@mailserver.example.com</code></em></code></strong>
user@mailserver.example.com's password: <strong class="userinput"><code>*****</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>telnet localhost 5025</code></strong>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
220 mailserver.example.com ESMTP</pre><p>This can be used in conjunction with
	    <code class="command">ssh-keygen</code> and additional user accounts
	    to create a more seamless <acronym class="acronym">SSH</acronym> tunneling
	    environment.  Keys can be used in place of typing a
	    password, and the tunnels can be run as a separate
	    user.</p></div></div><br class="example-break" /><div class="example"><a id="idp57722872"></a><div class="example-title">Example 13.2. Secure Access of a <acronym class="acronym">POP3</acronym>
	    Server</div><div class="example-contents"><p>In this example, there is an <acronym class="acronym">SSH</acronym>
	    server that accepts connections from the outside.  On the
	    same network resides a mail server running a
	    <acronym class="acronym">POP3</acronym> server.  To check email in a
	    secure manner, create an <acronym class="acronym">SSH</acronym> connection
	    to the <acronym class="acronym">SSH</acronym> server and tunnel through to
	    the mail server:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>2110:mail.example.com:110 user@ssh-server.example.com</code></em></code></strong>
user@ssh-server.example.com's password: <strong class="userinput"><code>******</code></strong></pre><p>Once the tunnel is up and running, point the email
	    client to send <acronym class="acronym">POP3</acronym> requests to
	    <code class="systemitem">localhost</code> on port 2110.  This
	    connection will be forwarded securely across the tunnel to
	    <code class="systemitem">mail.example.com</code>.</p></div></div><br class="example-break" /><div class="example"><a id="idp57733240"></a><div class="example-title">Example 13.3. Bypassing a Firewall</div><div class="example-contents"><p>Some firewalls
	    filter both incoming and outgoing connections.  For
	    example, a firewall might limit access from remote
	    machines to ports 22 and 80 to only allow
	    <acronym class="acronym">SSH</acronym> and web surfing.  This prevents
	    access to any other service which uses a port other than
	    22 or 80.</p><p>The solution is to create an <acronym class="acronym">SSH</acronym>
	    connection to a machine outside of the network's firewall
	    and use it to tunnel to the desired service:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>8888:music.example.com:8000 user@unfirewalled-system.example.org</code></em></code></strong>
user@unfirewalled-system.example.org's password: <strong class="userinput"><code>*******</code></strong></pre><p>In this example, a streaming Ogg Vorbis client can now
	    be pointed to <code class="systemitem">localhost</code> port
	    8888, which will be forwarded over to
	    <code class="systemitem">music.example.com</code> on port 8000,
	    successfully bypassing the firewall.</p></div></div><br class="example-break" /></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57738616"></a>13.8.2. Enabling the SSH Server</h3></div></div></div><a id="idp57739256" class="indexterm"></a><p>In addition to providing built-in <acronym class="acronym">SSH</acronym>
	client utilities, a FreeBSD system can be configured as an
	<acronym class="acronym">SSH</acronym> server, accepting connections from
	other <acronym class="acronym">SSH</acronym> clients.</p><p>To see if <span class="application">sshd</span> is operating,
	use the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=service&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">service</span>(8)</span></a> command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sshd status</code></strong></pre><p>If the service is not running, add the following line to
	<code class="filename">/etc/rc.conf</code>.</p><pre class="programlisting">sshd_enable="YES"</pre><p>This will start <span class="application">sshd</span>, the
	daemon program for <span class="application">OpenSSH</span>, the
	next time the system boots.  To start it now:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sshd start</code></strong></pre><p>The first time <span class="application">sshd</span> starts on a
	FreeBSD system, the system's host keys will be automatically
	created and the fingerprint will be displayed on the console.
	Provide users with the fingerprint so that they can verify it
	the first time they connect to the server.</p><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> for the list of available options
	when starting <span class="application">sshd</span> and a more
	complete discussion about authentication, the login process,
	and the various configuration files.</p><p>At this point, the <span class="application">sshd</span> should
	be available to all users with a username and password on
	the system.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57750776"></a>13.8.3. SSH Server Security</h3></div></div></div><p>While <span class="application">sshd</span> is the most widely
	used remote administration facility for FreeBSD, brute force
	and drive by attacks are common to any system exposed to
	public networks.  Several additional parameters are available
	to prevent the success of these attacks and will be described
	in this section.</p><p>It is a good idea to limit which users can log into the
	<acronym class="acronym">SSH</acronym> server and from where using the
	<code class="literal">AllowUsers</code> keyword in the
	<span class="application">OpenSSH</span> server configuration file.
	For example, to only allow <code class="systemitem">root</code> to log in from
	<code class="systemitem">192.168.1.32</code>, add
	this line to <code class="filename">/etc/ssh/sshd_config</code>:</p><pre class="programlisting">AllowUsers root@192.168.1.32</pre><p>To allow <code class="systemitem">admin</code>
	to log in from anywhere, list that user without specifying an
	<acronym class="acronym">IP</acronym> address:</p><pre class="programlisting">AllowUsers admin</pre><p>Multiple users should be listed on the same line, like
	so:</p><pre class="programlisting">AllowUsers root@192.168.1.32 admin</pre><p>After making changes to
	<code class="filename">/etc/ssh/sshd_config</code>,
	tell <span class="application">sshd</span> to reload its
	configuration file by running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sshd reload</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">When this keyword is used, it is important to list each
	  user that needs to log into this machine.  Any user that is
	  not specified in that line will be locked out.  Also, the
	  keywords used in the <span class="application">OpenSSH</span>
	  server configuration file are case-sensitive.  If the
	  keyword is not spelled correctly, including its case, it
	  will be ignored.  Always test changes to this file to make
	  sure that the edits are working as expected.  Refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd_config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd_config</span>(5)</span></a> to verify the spelling and use of the
	  available keywords.</p></div><p>In addition, users may be forced to use two factor
	authentication via the use of a public and private key.  When
	required, the user may generate a key pair through the use
	of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a> and send the administrator the public
	key.  This key file will be placed in the
	<code class="filename">authorized_keys</code> as described above in
	the client section.  To force the users to use keys only,
	the following option may be configured:</p><pre class="programlisting">AuthenticationMethods publickey</pre><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Do not confuse <code class="filename">/etc/ssh/sshd_config</code>
	  with <code class="filename">/etc/ssh/ssh_config</code> (note the
	  extra <code class="literal">d</code> in the first filename).  The
	  first file configures the server and the second file
	  configures the client.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh_config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh_config</span>(5)</span></a> for a
	  listing of the available client settings.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="fs-acl"></a>13.9. Access Control Lists</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp57798392" class="indexterm"></a><p>Access Control Lists (<acronym class="acronym">ACL</acronym>s) extend the
      standard <span class="trademark">UNIX</span>® permission model in a <span class="trademark">POSIX</span>®.1e compatible way.
      This permits an administrator to take advantage of a more
      fine-grained permissions model.</p><p>The FreeBSD <code class="filename">GENERIC</code> kernel provides
      <acronym class="acronym">ACL</acronym> support for <acronym class="acronym">UFS</acronym> file
      systems.  Users who prefer to compile a custom kernel must
      include the following option in their custom kernel
      configuration file:</p><pre class="programlisting">options UFS_ACL</pre><p>If this option is not compiled in, a warning message will be
      displayed when attempting to mount a file system with
      <acronym class="acronym">ACL</acronym> support.  <acronym class="acronym">ACL</acronym>s rely on
      extended attributes which are natively supported in
      <acronym class="acronym">UFS2</acronym>.</p><p>This chapter describes how to enable
      <acronym class="acronym">ACL</acronym> support and provides some usage
      examples.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57805432"></a>13.9.1. Enabling <acronym class="acronym">ACL</acronym> Support</h3></div></div></div><p><acronym class="acronym">ACL</acronym>s are enabled by the mount-time
	administrative flag, <code class="option">acls</code>, which may be added
	to <code class="filename">/etc/fstab</code>.  The mount-time flag can
	also be automatically set in a persistent manner using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> to modify a superblock <acronym class="acronym">ACL</acronym>s
	flag in the file system header.  In general, it is preferred
	to use the superblock flag for several reasons:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The superblock flag cannot be changed by a remount
	    using <code class="option">mount -u</code> as it requires a complete
	    <code class="command">umount</code> and fresh
	    <code class="command">mount</code>.  This means that
	    <acronym class="acronym">ACL</acronym>s cannot be enabled on the root file
	    system after boot.  It also means that
	    <acronym class="acronym">ACL</acronym> support on a file system cannot be
	    changed while the system is in use.</p></li><li class="listitem"><p>Setting the superblock flag causes the file system to
	    always be mounted with <acronym class="acronym">ACL</acronym>s enabled,
	    even if there is not an <code class="filename">fstab</code> entry
	    or if the devices re-order.  This prevents accidental
	    mounting of the file system without <acronym class="acronym">ACL</acronym>
	    support.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is desirable to discourage accidental mounting
	  without <acronym class="acronym">ACL</acronym>s enabled because nasty things
	  can happen if <acronym class="acronym">ACL</acronym>s are enabled, then
	  disabled, then re-enabled without flushing the extended
	  attributes.  In general, once <acronym class="acronym">ACL</acronym>s are
	  enabled on a file system, they should not be disabled, as
	  the resulting file protections may not be compatible with
	  those intended by the users of the system, and re-enabling
	  <acronym class="acronym">ACL</acronym>s may re-attach the previous
	  <acronym class="acronym">ACL</acronym>s to files that have since had their
	  permissions changed, resulting in unpredictable
	  behavior.</p></div><p>File systems with <acronym class="acronym">ACL</acronym>s enabled will
	show a plus (<code class="literal">+</code>) sign in their permission
	settings:</p><pre class="programlisting">drwx------  2 robert  robert  512 Dec 27 11:54 private
drwxrwx---+ 2 robert  robert  512 Dec 23 10:57 directory1
drwxrwx---+ 2 robert  robert  512 Dec 22 10:20 directory2
drwxrwx---+ 2 robert  robert  512 Dec 27 11:57 directory3
drwxr-xr-x  2 robert  robert  512 Nov 10 11:54 public_html</pre><p>In this example, <code class="filename">directory1</code>,
	<code class="filename">directory2</code>, and
	<code class="filename">directory3</code> are all taking advantage of
	<acronym class="acronym">ACL</acronym>s, whereas
	<code class="filename">public_html</code> is not.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57825016"></a>13.9.2. Using <acronym class="acronym">ACL</acronym>s</h3></div></div></div><p>File system <acronym class="acronym">ACL</acronym>s can be viewed using
	<code class="command">getfacl</code>.  For instance, to view the
	<acronym class="acronym">ACL</acronym> settings on
	<code class="filename">test</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>getfacl test</code></strong>
	#file:test
	#owner:1001
	#group:1001
	user::rw-
	group::r--
	other::r--</pre><p>To change the <acronym class="acronym">ACL</acronym> settings on this
	file, use <code class="command">setfacl</code>.  To remove all of the
	currently defined <acronym class="acronym">ACL</acronym>s from a file or file
	system, include <code class="option">-k</code>.  However, the preferred
	method is to use <code class="option">-b</code> as it leaves the basic
	fields required for <acronym class="acronym">ACL</acronym>s to work.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>setfacl -k test</code></strong></pre><p>To modify the default <acronym class="acronym">ACL</acronym> entries, use
	<code class="option">-m</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>setfacl -m u:trhodes:rwx,group:web:r--,o::--- test</code></strong></pre><p>In this example, there were no pre-defined entries, as
	they were removed by the previous command.  This command
	restores the default options and assigns the options listed.
	If a user or group is added which does not exist on the
	system, an <span class="errorname">Invalid argument</span> error will
	be displayed.</p><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=getfacl&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">getfacl</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setfacl</span>(1)</span></a> for more
	information about the options available for these
	commands.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-pkg"></a>13.10. Monitoring Third Party Security Issues</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp57848440" class="indexterm"></a><p>In recent years, the security world has made many
      improvements to how vulnerability assessment is handled.  The
      threat of system intrusion increases as third party utilities
      are installed and configured for virtually any operating
      system available today.</p><p>Vulnerability assessment is a key factor in security.
      While FreeBSD releases advisories for the base system, doing so
      for every third party utility is beyond the FreeBSD Project's
      capability.  There is a way to mitigate third party
      vulnerabilities and warn administrators of known security
      issues.  A FreeBSD add on utility known as
      <span class="application">pkg</span> includes options explicitly for
      this purpose.</p><p><span class="application">pkg</span> polls a database for security
      issues.  The database is updated and maintained by the FreeBSD
      Security Team and ports developers.</p><p>Please refer to <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/pkgng-intro.html" target="_top">instructions</a>
      for installing
      <span class="application">pkg</span>.</p><p>Installation provides <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a> configuration files
      for maintaining the <span class="application">pkg</span> audit
      database, and provides a programmatic method of keeping it
      updated.  This functionality is enabled if
      <code class="literal">daily_status_security_pkgaudit_enable</code>
      is set to <code class="literal">YES</code> in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic.conf</span>(5)</span></a>.
      Ensure that daily security run emails, which are sent to
      <code class="systemitem">root</code>'s email account,
      are being read.</p><p>After installation, and to audit third party utilities as
      part of the Ports Collection at any time, an administrator may
      choose to update the database and view known vulnerabilities
      of installed packages by invoking:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg audit -F</code></strong></pre><p><span class="application">pkg</span> displays messages
      any published vulnerabilities in installed packages:</p><pre class="programlisting">Affected package: cups-base-1.1.22.0_1
Type of problem: cups-base -- HPGL buffer overflow vulnerability.
Reference: &lt;https://www.FreeBSD.org/ports/portaudit/40a3bca2-6809-11d9-a9e7-0001020eed82.html&gt;

1 problem(s) in your installed packages found.

You are advised to update or deinstall the affected package(s) immediately.</pre><p>By pointing a web browser to the displayed
      <acronym class="acronym">URL</acronym>, an administrator may obtain more
      information about the vulnerability.  This will include the
      versions affected, by FreeBSD port version, along with other web
      sites which may contain security advisories.</p><p><span class="application">pkg</span> is a powerful utility
      and is extremely useful when coupled with
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-advisories"></a>13.11. FreeBSD Security Advisories</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp57875192" class="indexterm"></a><p>Like many producers of quality operating systems, the FreeBSD
      Project has a security team which is responsible for
      determining the End-of-Life (<acronym class="acronym">EoL</acronym>) date for
      each FreeBSD release and to provide security updates for supported
      releases which have not yet reached their
      <acronym class="acronym">EoL</acronym>.  More information about the FreeBSD
      security team and the supported releases is available on the
      <a class="link" href="../../../../security" target="_top">FreeBSD security
	page</a>.</p><p>One task of the security team is to respond to reported
      security vulnerabilities in the FreeBSD operating system.  Once a
      vulnerability is confirmed, the security team verifies the steps
      necessary to fix the vulnerability and updates the source code
      with the fix.  It then publishes the details as a
      <span class="quote">&#8220;<span class="quote">Security Advisory</span>&#8221;</span>.  Security
      advisories are published on the <a class="link" href="../../../../security/advisories.html" target="_top">FreeBSD
	website</a> and mailed to the
      <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications" target="_top">freebsd-security-notifications</a>, <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security" target="_top">freebsd-security</a>, and
      <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce" target="_top">freebsd-announce</a> mailing lists.</p><p>This section describes the format of a FreeBSD security
      advisory.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57884920"></a>13.11.1. Format of a Security Advisory</h3></div></div></div><p>Here is an example of a FreeBSD security advisory:</p><pre class="programlisting">=============================================================================
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

=============================================================================
FreeBSD-SA-14:04.bind                                       Security Advisory
                                                          The FreeBSD Project

Topic:          BIND remote denial of service vulnerability

Category:       contrib
Module:         bind
Announced:      2014-01-14
Credits:        ISC
Affects:        FreeBSD 8.x and FreeBSD 9.x
Corrected:      2014-01-14 19:38:37 UTC (stable/9, 9.2-STABLE)
                2014-01-14 19:42:28 UTC (releng/9.2, 9.2-RELEASE-p3)
                2014-01-14 19:42:28 UTC (releng/9.1, 9.1-RELEASE-p10)
                2014-01-14 19:38:37 UTC (stable/8, 8.4-STABLE)
                2014-01-14 19:42:28 UTC (releng/8.4, 8.4-RELEASE-p7)
                2014-01-14 19:42:28 UTC (releng/8.3, 8.3-RELEASE-p14)
CVE Name:       CVE-2014-0591

For general information regarding FreeBSD Security Advisories,
including descriptions of the fields above, security branches, and the
following sections, please visit &lt;URL:http://security.FreeBSD.org/&gt;.

I.   Background

BIND 9 is an implementation of the Domain Name System (DNS) protocols.
The named(8) daemon is an Internet Domain Name Server.

II.  Problem Description

Because of a defect in handling queries for NSEC3-signed zones, BIND can
crash with an "INSIST" failure in name.c when processing queries possessing
certain properties.  This issue only affects authoritative nameservers with
at least one NSEC3-signed zone.  Recursive-only servers are not at risk.

III. Impact

An attacker who can send a specially crafted query could cause named(8)
to crash, resulting in a denial of service.

IV.  Workaround

No workaround is available, but systems not running authoritative DNS service
with at least one NSEC3-signed zone using named(8) are not vulnerable.

V.   Solution

Perform one of the following:

1) Upgrade your vulnerable system to a supported FreeBSD stable or
release / security branch (releng) dated after the correction date.

2) To update your vulnerable system via a source code patch:

The following patches have been verified to apply to the applicable
FreeBSD release branches.

a) Download the relevant patch from the location below, and verify the
detached PGP signature using your PGP utility.

[FreeBSD 8.3, 8.4, 9.1, 9.2-RELEASE and 8.4-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-release.patch.asc
# gpg --verify bind-release.patch.asc

[FreeBSD 9.2-STABLE]
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch
# fetch http://security.FreeBSD.org/patches/SA-14:04/bind-stable-9.patch.asc
# gpg --verify bind-stable-9.patch.asc

b) Execute the following commands as root:

# cd /usr/src
# patch &lt; /path/to/patch

Recompile the operating system using buildworld and installworld as
described in &lt;URL:https://www.FreeBSD.org/handbook/makeworld.html&gt;.

Restart the applicable daemons, or reboot the system.

3) To update your vulnerable system via a binary patch:

Systems running a RELEASE version of FreeBSD on the i386 or amd64
platforms can be updated via the freebsd-update(8) utility:

# freebsd-update fetch
# freebsd-update install

VI.  Correction details

The following list contains the correction revision numbers for each
affected branch.

Branch/path                                                      Revision
- -------------------------------------------------------------------------
stable/8/                                                         r260646
releng/8.3/                                                       r260647
releng/8.4/                                                       r260647
stable/9/                                                         r260646
releng/9.1/                                                       r260647
releng/9.2/                                                       r260647
- -------------------------------------------------------------------------

To see which files were modified by a particular revision, run the
following command, replacing NNNNNN with the revision number, on a
machine with Subversion installed:

# svn diff -cNNNNNN --summarize svn://svn.freebsd.org/base

Or visit the following URL, replacing NNNNNN with the revision number:

&lt;URL:https://svnweb.freebsd.org/base?view=revision&amp;revision=NNNNNN&gt;

VII. References

&lt;URL:https://kb.isc.org/article/AA-01078&gt;

&lt;URL:http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0591&gt;

The latest revision of this advisory is available at
&lt;URL:http://security.FreeBSD.org/advisories/FreeBSD-SA-14:04.bind.asc&gt;
-----BEGIN PGP SIGNATURE-----

iQIcBAEBCgAGBQJS1ZTYAAoJEO1n7NZdz2rnOvQP/2/68/s9Cu35PmqNtSZVVxVG
ZSQP5EGWx/lramNf9566iKxOrLRMq/h3XWcC4goVd+gZFrvITJSVOWSa7ntDQ7TO
XcinfRZ/iyiJbs/Rg2wLHc/t5oVSyeouyccqODYFbOwOlk35JjOTMUG1YcX+Zasg
ax8RV+7Zt1QSBkMlOz/myBLXUjlTZ3Xg2FXVsfFQW5/g2CjuHpRSFx1bVNX6ysoG
9DT58EQcYxIS8WfkHRbbXKh9I1nSfZ7/Hky/kTafRdRMrjAgbqFgHkYTYsBZeav5
fYWKGQRJulYfeZQ90yMTvlpF42DjCC3uJYamJnwDIu8OhS1WRBI8fQfr9DRzmRua
OK3BK9hUiScDZOJB6OqeVzUTfe7MAA4/UwrDtTYQ+PqAenv1PK8DZqwXyxA9ThHb
zKO3OwuKOVHJnKvpOcr+eNwo7jbnHlis0oBksj/mrq2P9m2ueF9gzCiq5Ri5Syag
Wssb1HUoMGwqU0roS8+pRpNC8YgsWpsttvUWSZ8u6Vj/FLeHpiV3mYXPVMaKRhVm
067BA2uj4Th1JKtGleox+Em0R7OFbCc/9aWC67wiqI6KRyit9pYiF3npph+7D5Eq
7zPsUdDd+qc+UTiLp3liCRp5w6484wWdhZO6wRtmUgxGjNkxFoNnX8CitzF8AaqO
UWWemqWuz3lAZuORQ9KX
=OQzQ
-----END PGP SIGNATURE-----</pre><p>Every security advisory uses the following format:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Each security advisory is signed by the
	    <acronym class="acronym">PGP</acronym> key of the Security Officer.  The
	    public key for the Security Officer can be verified at
	    <a class="xref" href="#pgpkeys" title="Appendix D. OpenPGP Keys">Appendix D, <em>Open<acronym class="acronym">PGP</acronym> Keys</em></a>.</p></li><li class="listitem"><p>The name of the security advisory always begins with
	    <code class="literal">FreeBSD-SA-</code> (for FreeBSD Security
	    Advisory), followed by the year in two digit format
	    (<code class="literal">14:</code>), followed by the advisory number
	    for that year (<code class="literal">04.</code>), followed by the
	    name of the affected application or subsystem
	    (<code class="literal">bind</code>).  The advisory shown here is the
	    fourth advisory for 2014 and it affects
	    <span class="application">BIND</span>.</p></li><li class="listitem"><p>The <code class="literal">Topic</code> field summarizes the
	    vulnerability.</p></li><li class="listitem"><p>The <code class="literal">Category</code> refers to the
	    affected part of the system which may be one of
	    <code class="literal">core</code>, <code class="literal">contrib</code>, or
	    <code class="literal">ports</code>.  The <code class="literal">core</code>
	    category means that the vulnerability affects a core
	    component of the FreeBSD operating system.  The
	    <code class="literal">contrib</code> category means that the
	    vulnerability affects software included with  FreeBSD,
	    such as <span class="application">BIND</span>.  The
	    <code class="literal">ports</code> category indicates that the
	    vulnerability affects software available through the Ports
	    Collection.</p></li><li class="listitem"><p>The <code class="literal">Module</code> field refers to the
	    component location.  In this example, the
	    <code class="literal">bind</code> module is affected; therefore,
	    this vulnerability affects an application installed with
	    the operating system.</p></li><li class="listitem"><p>The <code class="literal">Announced</code> field reflects the
	    date the security advisory was published.  This means
	    that the security team has verified that the problem
	    exists and that a patch has been committed to the FreeBSD
	    source code repository.</p></li><li class="listitem"><p>The <code class="literal">Credits</code> field gives credit to
	    the individual or organization who noticed the
	    vulnerability and reported it.</p></li><li class="listitem"><p>The <code class="literal">Affects</code> field explains which
	    releases of FreeBSD are affected by this
	    vulnerability.</p></li><li class="listitem"><p>The <code class="literal">Corrected</code> field indicates the
	    date, time, time offset, and releases that were
	    corrected.  The section in parentheses shows each branch
	    for which the fix has been merged, and the version number
	    of the corresponding release from that branch.  The
	    release identifier itself includes the version number
	    and, if appropriate, the patch level.  The patch level is
	    the letter <code class="literal">p</code> followed by a number,
	    indicating the sequence number of the patch, allowing
	    users to track which patches have already been applied to
	    the system.</p></li><li class="listitem"><p>The <code class="literal">CVE Name</code> field lists the
	    advisory number, if one exists, in the public <a class="link" href="http://cve.mitre.org" target="_top">cve.mitre.org</a>
	    security vulnerabilities database.</p></li><li class="listitem"><p>The <code class="literal">Background</code> field provides a
	    description of the affected module.</p></li><li class="listitem"><p>The <code class="literal">Problem Description</code> field
	    explains the vulnerability.  This can include
	    information about the flawed code and how the utility
	    could be maliciously used.</p></li><li class="listitem"><p>The <code class="literal">Impact</code> field describes what
	    type of impact the problem could have on a system.</p></li><li class="listitem"><p>The <code class="literal">Workaround</code> field indicates if
	    a workaround is available to system administrators who
	    cannot immediately patch the system .</p></li><li class="listitem"><p>The <code class="literal">Solution</code> field provides the
	    instructions for patching the affected system.  This is a
	    step by step tested and verified method for getting a
	    system patched and working securely.</p></li><li class="listitem"><p>The <code class="literal">Correction Details</code> field
	    displays each affected Subversion branch with the revision
	    number that contains the corrected code.</p></li><li class="listitem"><p>The <code class="literal">References</code> field offers sources
	    of additional information regarding the
	    vulnerability.</p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-accounting"></a>13.12. Process Accounting</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp57961080" class="indexterm"></a><p>Process accounting is a security method in which an
      administrator may keep track of system resources used and
      their allocation among users, provide for system monitoring,
      and minimally track a user's commands.</p><p>Process accounting has both positive and negative points.
      One of the positives is that an intrusion may be narrowed down
      to the point of entry.  A negative is the amount of logs
      generated by process accounting, and the disk space they may
      require.  This section walks an administrator through the basics
      of process accounting.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If more fine-grained accounting is needed, refer to
	<a class="xref" href="#audit" title="Chapter 16. Security Event Auditing">Chapter 16, <em>Security Event Auditing</em></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp57967864"></a>13.12.1. Enabling and Utilizing Process Accounting</h3></div></div></div><p>Before using process accounting, it must be enabled using
	the following commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc accounting_enable=yes</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service accounting start</code></strong></pre><p>The accounting information is stored in files located in
	<code class="filename">/var/account</code>, which is automatically created,
	if necessary, the first time the accounting service starts.
	These files contain sensitive information, including all the
	commands issued by all users.  Write access to the files is
	limited to <code class="systemitem">root</code>,
	and read access is limited to <code class="systemitem">root</code> and members of the
	<code class="systemitem">wheel</code> group.
	To also prevent	members of <code class="systemitem">wheel</code> from reading the files,
	change the mode of the <code class="filename">/var/account</code>
	directory to allow access only by <code class="systemitem">root</code>.</p><p>Once enabled, accounting will begin to track information
	such as <acronym class="acronym">CPU</acronym> statistics and executed
	commands.  All accounting logs are in a non-human readable
	format which can be viewed using <code class="command">sa</code>.  If
	issued without any options, <code class="command">sa</code> prints
	information relating to the number of per-user calls, the
	total elapsed time in minutes, total <acronym class="acronym">CPU</acronym>
	and user time in minutes, and the average number of
	<acronym class="acronym">I/O</acronym> operations.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sa</span>(8)</span></a> for
	the list of available options which control the output.</p><p>To display the commands issued by users, use
	<code class="command">lastcomm</code>.  For example, this command
	prints out all usage of <code class="command">ls</code> by <code class="systemitem">trhodes</code> on the
	<code class="literal">ttyp1</code> terminal:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lastcomm ls trhodes ttyp1</code></strong></pre><p>Many other useful options exist and are explained in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lastcomm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lastcomm</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=acct&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">acct</span>(5)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sa</span>(8)</span></a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-resourcelimits"></a>13.13. Resource Limits</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp57986040" class="indexterm"></a><p>FreeBSD provides several methods for an administrator to
	limit the amount of system resources an individual may use.
	Disk quotas limit the amount of disk space available to users.
	Quotas are discussed in <a class="xref" href="#quotas" title="17.11. Disk Quotas">Section 17.11, &#8220;Disk Quotas&#8221;</a>.</p><a id="idp57987576" class="indexterm"></a><a id="idp57988344" class="indexterm"></a><a id="idp57989496" class="indexterm"></a><p>Limits to other resources, such as <acronym class="acronym">CPU</acronym>
      and memory, can be set using either a flat file or a command to
      configure a resource limits database.  The traditional method
      defines login classes by editing
      <code class="filename">/etc/login.conf</code>.  While this method is
      still supported, any changes require a multi-step process of
      editing this file, rebuilding the resource database, making
      necessary changes to <code class="filename">/etc/master.passwd</code>,
      and rebuilding the password database.  This can become time
      consuming, depending upon the number of users to
      configure.</p><p><code class="command">rctl</code> can be used to provide a more
      fine-grained method for controlling resource limits.  This
      command supports more than user limits as it can also be used to
      set resource constraints on processes and jails.</p><p>This section demonstrates both methods for controlling
      resources, beginning with the traditional method.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="users-limiting"></a>13.13.1. Configuring Login Classes</h3></div></div></div><a id="idp57993592" class="indexterm"></a><a id="idp57994360" class="indexterm"></a><a id="idp57995512" class="indexterm"></a><p>In the traditional method, login classes and the resource
	limits to apply to a login class are defined in
	<code class="filename">/etc/login.conf</code>.   Each user account can
	be assigned to a login class, where <code class="literal">default</code>
	is the default login class.  Each login class has a set of
	login capabilities associated with it.  A login capability is
	a
	<code class="literal"><em class="replaceable"><code>name</code></em>=<em class="replaceable"><code>value</code></em></code>
	pair, where <em class="replaceable"><code>name</code></em> is a well-known
	identifier and <em class="replaceable"><code>value</code></em> is an
	arbitrary string which is processed accordingly depending on
	the <em class="replaceable"><code>name</code></em>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Whenever <code class="filename">/etc/login.conf</code> is edited,
	  the <code class="filename">/etc/login.conf.db</code> must be updated
	  by executing the following command:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre></div><p>Resource limits differ from the default login capabilities
	in two ways.  First, for every limit, there is a
	<em class="firstterm">soft</em> and <em class="firstterm">hard</em>
	limit.  A soft limit may be adjusted by the user or
	application, but may not be set higher than the hard limit.
	The hard limit may be lowered by the user, but can only be
	raised by the superuser.  Second, most resource limits apply
	per process to a specific user.</p><p><a class="xref" href="#resource-limits" title="Table 13.1. Login Class Resource Limits">Table 13.1, &#8220;Login Class Resource Limits&#8221;</a> lists the most commonly
	used resource limits.  All of the available resource limits
	and capabilities are described in detail in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>.</p><a id="idp58016888" class="indexterm"></a><a id="idp58018040" class="indexterm"></a><a id="idp58019192" class="indexterm"></a><a id="idp58020344" class="indexterm"></a><a id="idp58021496" class="indexterm"></a><a id="idp58022648" class="indexterm"></a><a id="idp58023800" class="indexterm"></a><a id="idp58024952" class="indexterm"></a><a id="idp58026104" class="indexterm"></a><div class="table"><a id="resource-limits"></a><div class="table-title">Table 13.1. Login Class Resource Limits</div><div class="table-contents"><table class="table" summary="Login Class Resource Limits" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Resource Limit</th><th>Description</th></tr></thead><tbody><tr><td>coredumpsize</td><td>The limit on the size of a core file generated by
		a program is subordinate to other limits on disk
		usage, such as <code class="literal">filesize</code> or disk
		quotas.  This limit is often used as a less severe
		method of controlling disk space consumption.  Since
		users do not generate core files and often do not
		delete them, this setting may save them from running
		out of disk space should a large program
		crash.</td></tr><tr><td>cputime</td><td>The maximum amount of <acronym class="acronym">CPU</acronym> time
		a user's process may consume.  Offending processes
		will be killed by the kernel.  This is a limit on
		<acronym class="acronym">CPU</acronym> <span class="emphasis"><em>time</em></span>
		consumed, not the percentage of the
		<acronym class="acronym">CPU</acronym> as displayed in some of the
		fields generated by <code class="command">top</code> and
		<code class="command">ps</code>.</td></tr><tr><td>filesize</td><td>The maximum size of a file the user may own.
		Unlike disk quotas (<a class="xref" href="#quotas" title="17.11. Disk Quotas">Section 17.11, &#8220;Disk Quotas&#8221;</a>), this
		limit is enforced on individual files, not the set of
		all files a user owns.</td></tr><tr><td>maxproc</td><td>The maximum number of foreground and background
		processes a user can run.  This limit may not be
		larger than the system limit specified by
		<code class="varname">kern.maxproc</code>.  Setting this limit
		too small may hinder a user's productivity as some
		tasks, such as compiling a large program, start lots
		of processes.</td></tr><tr><td>memorylocked</td><td>The maximum amount of memory a process may
		request to be locked into main memory using
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mlock&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mlock</span>(2)</span></a>.  Some system-critical programs, such as
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a>, lock into main memory so that if the
		system begins to swap, they do not contribute to disk
		thrashing.</td></tr><tr><td>memoryuse</td><td>The maximum amount of memory a process may
		consume at any given time.  It includes both core
		memory and swap usage.  This is not a catch-all limit
		for restricting memory consumption, but is a good
		start.</td></tr><tr><td>openfiles</td><td>The maximum number of files a process may have
		open.  In FreeBSD, files are used to represent sockets
		and <acronym class="acronym">IPC</acronym> channels, so be careful not
		to set this too low.  The system-wide limit for this
		is defined by
		<code class="varname">kern.maxfiles</code>.</td></tr><tr><td>sbsize</td><td>The limit on the amount of network memory a user
		may consume.  This can be generally used to limit
		network communications.</td></tr><tr><td>stacksize</td><td>The maximum size of a process stack.  This alone
		is not sufficient to limit the amount of memory a
		program may use, so it should be used in conjunction
		with other limits.</td></tr></tbody></table></div></div><br class="table-break" /><p>There are a few other things to remember when setting
	resource limits:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Processes started at system startup by
	    <code class="filename">/etc/rc</code> are assigned to the
	    <code class="literal">daemon</code> login class.</p></li><li class="listitem"><p>Although the default
	    <code class="filename">/etc/login.conf</code> is a good source of
	    reasonable values for most limits, they may not be
	    appropriate for every system.  Setting a limit too high
	    may open the system up to abuse, while setting it too low
	    may put a strain on productivity.</p></li><li class="listitem"><p><span class="application">Xorg</span> takes a lot of
	    resources and encourages users to run more programs
	    simultaneously.</p></li><li class="listitem"><p>Many limits apply to individual processes, not the
	    user as a whole.  For example, setting
	    <code class="varname">openfiles</code> to <code class="literal">50</code>
	    means that each process the user runs may open up to
	    <code class="literal">50</code> files.  The total amount of files a
	    user may open is the value of <code class="literal">openfiles</code>
	    multiplied by the value of <code class="literal">maxproc</code>.
	    This also applies to memory consumption.</p></li></ul></div><p>For further information on resource limits and login
	classes and capabilities in general, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cap_mkdb&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cap_mkdb</span>(1)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=getrlimit&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">getrlimit</span>(2)</span></a>, and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp58081912"></a>13.13.2. Enabling and Configuring Resource Limits</h3></div></div></div><p>The <code class="varname">kern.racct.enable</code> tunable must be
	set to a non-zero value.  Custom kernels require specific
	configuration:</p><pre class="programlisting">options         RACCT
options         RCTL</pre><p>Once the system has rebooted into the new kernel,
	<code class="command">rctl</code> may be used to set rules for the
	system.</p><p>Rule syntax is controlled through the use of a subject,
	subject-id, resource, and action, as seen in this example
	rule:</p><pre class="programlisting">user:trhodes:maxproc:deny=10/user</pre><p>In this rule, the subject is <code class="literal">user</code>, the
	subject-id is <code class="literal">trhodes</code>, the resource,
	<code class="literal">maxproc</code>, is the maximum number of
	processes, and the action is <code class="literal">deny</code>, which
	blocks any new processes from being created.  This means that
	the user, <code class="literal">trhodes</code>, will be constrained to
	no greater than <code class="literal">10</code> processes.  Other
	possible actions include logging to the console, passing a
	notification to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a>, or sending a sigterm to the
	process.</p><p>Some care must be taken when adding rules.  Since this
	user is constrained to <code class="literal">10</code> processes, this
	example will prevent the user from performing other tasks
	after logging in and executing a
	<code class="command">screen</code> session.  Once a resource limit has
	been hit, an error will be printed, as in this example:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>man test</code></strong>
    /usr/bin/man: Cannot fork: Resource temporarily unavailable
eval: Cannot fork: Resource temporarily unavailable</pre><p>As another example, a jail can be prevented from exceeding
	a memory limit.  This rule could be written as:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rctl -a jail:httpd:memoryuse:deny=2G/jail</code></strong></pre><p>Rules will persist across reboots if they have been added
	to <code class="filename">/etc/rctl.conf</code>.  The format is a rule,
	without the preceding command.  For example, the previous rule
	could be added as:</p><pre class="programlisting"># Block jail from using more than 2G memory:
jail:httpd:memoryuse:deny=2G/jail</pre><p>To remove a rule, use <code class="command">rctl</code> to remove it
	from the list:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rctl -r user:trhodes:maxproc:deny=10/user</code></strong></pre><p>A method for removing all rules is documented in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rctl</span>(8)</span></a>.  However, if removing all rules for a single
	user is required, this command may be issued:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rctl -r user:trhodes</code></strong></pre><p>Many other resources exist which can be used to exert
	additional control over various <code class="literal">subjects</code>.
	See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rctl</span>(8)</span></a> to learn about them.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="security-sudo"></a>13.14. Shared Administration with Sudo</h2></div><div><span class="authorgroup">Contributed
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp58118136" class="indexterm"></a><p>System administrators often need the ability to grant
      enhanced permissions to users so they may perform privileged
      tasks.  The idea that team members are provided access
      to a FreeBSD system to perform their specific tasks opens up unique
      challenges to every administrator.  These team members only
      need a subset of access beyond normal end user levels; however,
      they almost always tell management they are unable to
      perform their tasks without superuser access.  Thankfully, there
      is no reason to provide such access to end users because tools
      exist to manage this exact requirement.</p><p>Up to this point, the security chapter has covered
      permitting access to authorized users and attempting to prevent
      unauthorized access.  Another problem arises once authorized
      users have access to the system resources.  In many cases, some
      users may need access to application startup scripts, or a team
      of administrators need to maintain the system.  Traditionally,
      the standard users and groups, file permissions, and even the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> command would manage this access.  And as
      applications required more access, as more users needed to use
      system resources, a better solution was required.  The most used
      application is currently <span class="application">Sudo</span>.</p><p><span class="application">Sudo</span> allows administrators
      to configure more rigid access to system commands
      and provide for some advanced logging features.
      As a tool, it is available from the Ports Collection as
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/sudo/pkg-descr">security/sudo</a> or by use of
      the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg</span>(8)</span></a> utility.  To use the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pkg</span>(8)</span></a> tool:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install sudo</code></strong></pre><p>After the installation is complete, the installed
      <code class="command">visudo</code> will open the configuration file with
      a text editor.  Using <code class="command">visudo</code> is highly
      recommended as it comes with a built in syntax checker to verify
      there are no errors before the file is saved.</p><p>The configuration file is made up of several small sections
      which allow for extensive configuration.  In the following
      example, web application maintainer, user1, needs to start,
      stop, and restart the web application known as
      <em class="replaceable"><code>webservice</code></em>.  To
      grant this user permission to perform these tasks, add
      this line to the end of
      <code class="filename">/usr/local/etc/sudoers</code>:</p><pre class="programlisting">user1   ALL=(ALL)       /usr/sbin/service webservice *</pre><p>The user may now start <em class="replaceable"><code>webservice</code></em>
      using this command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sudo /usr/sbin/service <em class="replaceable"><code>webservice</code></em> start</code></strong></pre><p>While this configuration allows a single user access to the
      <span class="application">webservice</span> service; however, in most
      organizations, there is an entire web team in charge of managing
      the service.  A single line can also give access to an entire
      group.  These steps will create a web group, add a user to this
      group, and allow all members of the group to manage the
      service:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupadd -g 6001 -n webteam</code></strong></pre><p>Using the same <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a> command, the user is added to
      the webteam group:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod -m user1 -n webteam</code></strong></pre><p>Finally, this line in
      <code class="filename">/usr/local/etc/sudoers</code> allows any
      member of the webteam group to manage
      <em class="replaceable"><code>webservice</code></em>:</p><pre class="programlisting">%webteam   ALL=(ALL)       /usr/sbin/service webservice *</pre><p>Unlike <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a>, <span class="application">Sudo</span> only
      requires the end user password.  This adds an advantage where
      users will not need shared passwords, a finding in most security
      audits and just bad all the way around.</p><p>Users permitted to run applications with
      <span class="application">Sudo</span> only enter their own passwords.
      This is more secure and gives better control than <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a>,
      where the <code class="systemitem">root</code>
      password is entered and the user acquires all
      <code class="systemitem">root</code>
      permissions.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Most organizations are moving or have moved toward a two
	factor authentication model.  In these cases, the user may not
	have a password to enter.  <span class="application">Sudo</span>
	provides for these cases with the <code class="literal">NOPASSWD</code>
	variable.  Adding it to the configuration above will allow all
	members of the <em class="replaceable"><code>webteam</code></em> group to
	manage the service without the password requirement:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">%webteam   ALL=(ALL)       NOPASSWD: /usr/sbin/service webservice *</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-sudo-loggin"></a>13.14.1. Logging Output</h3></div></div></div><p>An advantage to implementing
	<span class="application">Sudo</span> is the ability to enable
	session logging.  Using the built in log mechanisms
	and the included <span class="application">sudoreplay</span>
	command, all commands initiated through
	<span class="application">Sudo</span> are logged for later
	verification.  To enable this feature, add a default log
	directory entry, this example uses a user variable.
	Several other log filename conventions exist, consult the
	manual page for <span class="application">sudoreplay</span> for
	additional information.</p><pre class="programlisting">Defaults iolog_dir=/var/log/sudo-io/%{user}</pre><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">This directory will be created automatically after the
	  logging is configured.  It is best to let the system create
	  directory with default permissions just to be safe.  In
	  addition, this entry will also log administrators who use
	  the <span class="application">sudoreplay</span> command.  To
	  change this behavior, read and uncomment the logging options
	  inside <code class="filename">sudoers</code>.</p></div><p>Once this directive has been added to the
	<code class="filename">sudoers</code> file, any user configuration can
	be updated with the request to log access.  In the example
	shown, the updated <em class="replaceable"><code>webteam</code></em> entry
	would have the following additional changes:</p><pre class="programlisting">%webteam ALL=(ALL) NOPASSWD: LOG_INPUT: LOG_OUTPUT: /usr/sbin/service webservice *</pre><p>From this point on, all <em class="replaceable"><code>webteam</code></em>
	members altering the status of the
	<em class="replaceable"><code>webservice</code></em> application
	will be logged.  The list of previous and current sessions
	can be displayed with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sudoreplay -l</code></strong></pre><p>In the output, to replay a specific session, search for
	the <code class="literal">TSID=</code> entry, and pass that to
	<span class="application">sudoreplay</span> with no other options to
	replay the session at normal speed.  For example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sudoreplay user1/00/00/02</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">While sessions are logged, any administrator is able to
	  remove sessions and leave only a question of why they had
	  done so.  It is worthwhile to add a daily check through an
	  intrusion detection system (<acronym class="acronym">IDS</acronym>) or
	  similar software so that other administrators are alerted to
	  manual alterations.</p></div><p>The <code class="command">sudoreplay</code> is extremely extendable.
	Consult the documentation for more information.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails"></a>Chapter 14. Jails</h2></div><div><span class="authorgroup">Contributed
	by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Matteo</span> <span class="surname">Riondato</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#jails-synopsis">14.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#jails-terms">14.2. Terms Related to Jails</a></span></dt><dt><span class="sect1"><a href="#jails-build">14.3. Creating and Controlling Jails</a></span></dt><dt><span class="sect1"><a href="#jails-tuning">14.4. Fine Tuning and Administration</a></span></dt><dt><span class="sect1"><a href="#jails-application">14.5. Updating Multiple Jails</a></span></dt><dt><span class="sect1"><a href="#jails-ezjail">14.6. Managing Jails with
	<span class="application">ezjail</span></a></span></dt></dl></div><a id="idp58193784" class="indexterm"></a><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-synopsis"></a>14.1. Synopsis</h2></div></div></div><p>Since system administration is a difficult task, many tools
      have been developed to make life easier for the administrator.
      These tools often enhance the way systems are installed,
      configured, and maintained.  One of the tools which can be used
      to enhance the security of a FreeBSD system is
      <em class="firstterm">jails</em>.  Jails have been available since
      FreeBSD 4.X and continue to be enhanced in their usefulness,
      performance, reliability, and security.</p><p>Jails build upon the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(2)</span></a> concept, which is used
      to change the root directory of a set of processes.  This
      creates a safe environment, separate from the rest of the
      system.  Processes created in the chrooted environment can not
      access files or resources outside of it.  For that reason,
      compromising a service running in a chrooted environment should
      not allow the attacker to compromise the entire system.
      However, a chroot has several limitations.  It is suited to easy
      tasks which do not require much flexibility or complex, advanced
      features.  Over time, many ways have been found to escape from a
      chrooted environment, making it a less than ideal solution for
      securing services.</p><p>Jails improve on the concept of the traditional chroot
      environment in several ways.  In a traditional chroot
      environment, processes are only limited in the part of the file
      system they can access.  The rest of the system resources,
      system users, running processes, and the networking subsystem
      are shared by the chrooted processes and the processes of the
      host system.  Jails expand this model by virtualizing access to
      the file system, the set of users, and the networking subsystem.
      More fine-grained controls are available for tuning the access
      of a jailed environment.  Jails can be considered as a type of
      operating system-level virtualization.</p><p>A jail is characterized by four elements:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A directory subtree: the starting point from which a
	  jail is entered.  Once inside the jail, a process is not
	  permitted to escape outside of this subtree.</p></li><li class="listitem"><p>A hostname: which will be used by the jail.</p></li><li class="listitem"><p>An <acronym class="acronym">IP</acronym> address: which is assigned to
	  the jail.  The <acronym class="acronym">IP</acronym> address of a jail is
	  often an alias address for an existing network
	  interface.</p></li><li class="listitem"><p>A command: the path name of an executable to run inside
	  the jail.  The path is relative to the root directory of the
	  jail environment.</p></li></ul></div><p>Jails have their own set of users and their own <code class="systemitem">root</code> account which are limited
      to the jail environment.  The <code class="systemitem">root</code> account of a jail is not
      allowed to perform operations to the system outside of the
      associated jail environment.</p><p>This chapter provides an overview of the terminology and
      commands for managing FreeBSD jails.  Jails are a powerful tool for
      both system administrators, and advanced users.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>What a jail is and what purpose it may serve in FreeBSD
	  installations.</p></li><li class="listitem"><p>How to build, start, and stop a jail.</p></li><li class="listitem"><p>The basics of jail administration, both from inside and
	  outside the jail.</p></li></ul></div><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">Jails are a powerful tool, but they are not a security
	panacea.  While it is not possible for a jailed process to
	break out on its own, there are several ways in which an
	unprivileged user outside the jail can cooperate with a
	privileged user inside the jail to obtain elevated privileges
	in the host environment.</p><p xmlns="http://www.w3.org/1999/xhtml">Most of these attacks can be mitigated by ensuring that
	the jail root is not accessible to unprivileged users in the
	host environment.  As a general rule, untrusted users with
	privileged access to a jail should not be given access to the
	host environment.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-terms"></a>14.2. Terms Related to Jails</h2></div></div></div><p>To facilitate better understanding of parts of the FreeBSD
      system related to jails, their internals and the way they
      interact with the rest of FreeBSD, the following terms are used
      further in this chapter:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(8)</span></a> (command)</span></dt><dd><p>Utility, which uses <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(2)</span></a> FreeBSD system call to
	    change the root directory of a process and all its
	    descendants.</p></dd><dt><span class="term"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(2)</span></a> (environment)</span></dt><dd><p>The environment of processes running in a
	    <span class="quote">&#8220;<span class="quote">chroot</span>&#8221;</span>.  This includes resources such as
	    the part of the file system which is visible, user and
	    group IDs which are available, network interfaces and
	    other IPC mechanisms, etc.</p></dd><dt><span class="term"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> (command)</span></dt><dd><p>The system administration utility which allows
	    launching of processes within a jail environment.</p></dd><dt><span class="term">host (system, process, user, etc.)</span></dt><dd><p>The controlling system of a jail environment.  The
	    host system has access to all the hardware resources
	    available, and can control processes both outside of and
	    inside a jail environment.  One of the important
	    differences of the host system from a jail is that the
	    limitations which apply to superuser processes inside a
	    jail are not enforced for processes of the host
	    system.</p></dd><dt><span class="term">hosted (system, process, user, etc.)</span></dt><dd><p>A process, user or other entity, whose access to
	    resources is restricted by a FreeBSD jail.</p></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-build"></a>14.3. Creating and Controlling Jails</h2></div></div></div><p>Some administrators divide jails into the following two
      types: <span class="quote">&#8220;<span class="quote">complete</span>&#8221;</span> jails, which resemble a real FreeBSD
      system, and <span class="quote">&#8220;<span class="quote">service</span>&#8221;</span> jails, dedicated to one
      application or service, possibly running with privileges.  This
      is only a conceptual division and the process of building a jail
      is not affected by it.  When creating a <span class="quote">&#8220;<span class="quote">complete</span>&#8221;</span>
      jail there are two options for the source of the userland: use
      prebuilt binaries (such as those supplied on an install media)
      or build from source.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp58239352"></a>14.3.1. Installing a Jail</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-install-internet"></a>14.3.1.1. To install a Jail from the Internet</h4></div></div></div><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsdinstall&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsdinstall</span>(8)</span></a> tool can be used to fetch and
          install the binaries needed for a jail.  This will walk through
          the picking of a mirror, which distributions will be installed
          into the destination directory, and some basic configuration
          of the jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bsdinstall jail <em class="replaceable"><code>/here/is/the/jail</code></em></code></strong></pre><p>Once the command is complete, the next step is configuring
          the host to run the jail.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-install-iso"></a>14.3.1.2. To install a Jail from an ISO</h4></div></div></div><p>To install the userland from installation media, first
      create the root directory for the jail.  This can be done by
      setting the <code class="varname">DESTDIR</code> variable to the proper
      location.</p><p>Start a shell and define <code class="varname">DESTDIR</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>export DESTDIR=<em class="replaceable"><code>/here/is/the/jail</code></em></code></strong></pre><p>Mount the install media as covered in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>
      when using the install ISO:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t cd9660 /dev/`mdconfig -f cdimage.iso` /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /mnt/usr/freebsd-dist/</code></strong></pre><p>Extract the binaries from the tarballs on the install media
      into the declared destination.  Minimally, only the base set
      needs to be extracted, but a complete install can be performed
      when preferred.</p><p>To install just the base system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tar -xf base.txz -C $DESTDIR</code></strong></pre><p>To install everything except the kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>for set in base ports; do tar -xf $set.txz -C $DESTDIR ; done</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-install-source"></a>14.3.1.3. To build and install a Jail from source</h4></div></div></div><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> manual page explains the procedure for
      building a jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setenv D <em class="replaceable"><code>/here/is/the/jail</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p $D</code></strong>      <a id="jailpath"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong>  <a id="jailbuildworld"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld DESTDIR=$D</code></strong>  <a id="jailinstallworld"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make distribution DESTDIR=$D</code></strong>  <a id="jaildistrib"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t devfs devfs $D/dev</code></strong>   <a id="jaildevfs"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#jailpath"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Selecting a location for a jail is the best starting
	  point.  This is where the jail will physically reside within
	  the file system of the jail's host.  A good choice can be
	  <code class="filename">/usr/jail/<em class="replaceable"><code>jailname</code></em></code>,
	  where <em class="replaceable"><code>jailname</code></em> is the hostname
	  identifying the jail.  Usually, <code class="filename">/usr/</code>
	  has enough space for the jail file system, which for
	  <span class="quote">&#8220;<span class="quote">complete</span>&#8221;</span> jails is, essentially, a replication
	  of every file present in a default installation of the FreeBSD
	  base system.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailbuildworld"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>If you have already rebuilt your userland using
	  <code class="command">make world</code> or
	  <code class="command">make buildworld</code>, you can skip this step
	  and install your existing userland into the new jail.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailinstallworld"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This command will populate the directory subtree chosen
	  as jail's physical location on the file system with the
	  necessary binaries, libraries, manual pages and so
	  on.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildistrib"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="buildtarget">distribution</code> target for
	  <span class="application">make</span> installs every needed
	  configuration file.  In simple words, it installs every
	  installable file of
	  <code class="filename">/usr/src/etc/</code> to the
	  <code class="filename">/etc</code> directory of the
	  jail environment:
	  <code class="filename">$D/etc/</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildevfs"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Mounting the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> file system inside a jail is
	  not required.  On the other hand, any, or almost any
	  application requires access to at least one device,
	  depending on the purpose of the given application.  It is
	  very important to control access to devices from inside a
	  jail, as improper settings could permit an attacker to do
	  nasty things in the jail.  Control over <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> is
	  managed through rulesets which are described in the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs.conf</span>(5)</span></a> manual pages.</p></td></tr></table></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp58292472"></a>14.3.2. Configuring the Host</h3></div></div></div><p>Once a jail is installed, it can be started by using the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> utility.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> utility takes four
      mandatory arguments which are described in the <a class="xref" href="#jails-synopsis" title="14.1. Synopsis">Section 14.1, &#8220;Synopsis&#8221;</a>.  Other arguments may be specified
      too, e.g., to run the jailed process with the credentials of a
      specific user.  The
      <code class="option"><em class="replaceable"><code>command</code></em></code> argument
      depends on the type of the jail; for a
      <span class="emphasis"><em>virtual system</em></span>,
      <code class="filename">/etc/rc</code> is a good choice, since it will
      replicate the startup sequence of a real FreeBSD system.  For a
      <span class="emphasis"><em>service</em></span> jail, it depends on the service or
      application that will run within the jail.</p><p>Jails are often started at boot time and the FreeBSD
      <code class="filename">rc</code> mechanism provides an easy way to do
      this.</p><div class="procedure"><ul class="procedure"><li class="step"><p>Configure jail parameters in
	  <code class="filename">jail.conf</code>:</p><pre class="programlisting"><em class="replaceable"><code>www</code></em> {
    host.hostname = <em class="replaceable"><code>www.example.org</code></em>;           # Hostname
    ip4.addr = <em class="replaceable"><code>192.168.0.10</code></em>;                   # IP address of the jail
    path = "<em class="replaceable"><code>/usr/jail/www</code></em>";                    # Path to the jail
    devfs_ruleset = "<em class="replaceable"><code>www_ruleset</code></em>";             # devfs ruleset
    mount.devfs;                               # Mount devfs inside the jail
    exec.start = "/bin/sh /etc/rc";            # Start command
    exec.stop = "/bin/sh /etc/rc.shutdown";    # Stop command
}</pre><p>Configure jails to start at boot time in
	  <code class="filename">rc.conf</code>:</p><pre class="programlisting">jail_enable="YES"   # Set to NO to disable starting of any jails</pre><p>The default startup of jails configured in
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail.conf</span>(5)</span></a>, will run the <code class="filename">/etc/rc</code>
	  script of the jail, which assumes the jail is a complete
	  virtual system.  For service jails, the default startup
	  command of the jail should be changed, by setting the
	  <code class="varname">exec.start</code>
	  option appropriately.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">For a full list of available options, please see the
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail.conf</span>(5)</span></a> manual page.</p></div></li></ul></div><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=service&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">service</span>(8)</span></a> can be used to start or stop a jail by hand,
      if an entry for it exists in
      <code class="filename">jail.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service jail start <em class="replaceable"><code>www</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service jail stop <em class="replaceable"><code>www</code></em></code></strong></pre><p>Jails can be shut down with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a>.  Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jls&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jls</span>(8)</span></a>
      to identify the jail's <code class="varname">JID</code>, then use
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a> to run the shutdown script in that jail.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>jls</code></strong>
   JID  IP Address      Hostname                      Path
     3  192.168.0.10    www                           /usr/jail/www
<code class="prompt">#</code> <strong class="userinput"><code>jexec <em class="replaceable"><code>3</code></em> /etc/rc.shutdown</code></strong></pre><p>More information about this can be found in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>
      manual page.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-tuning"></a>14.4. Fine Tuning and Administration</h2></div></div></div><p>There are several options which can be set for any jail, and
      various ways of combining a host FreeBSD system with jails, to
      produce higher level applications.  This section
      presents:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Some of the options available for tuning the behavior
	  and security restrictions implemented by a jail
	  installation.</p></li><li class="listitem"><p>Some of the high-level applications for jail management,
	  which are available through the FreeBSD Ports Collection, and
	  can be used to implement overall jail-based
	  solutions.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-tuning-utilities"></a>14.4.1. System Tools for Jail Tuning in FreeBSD</h3></div></div></div><p>Fine tuning of a jail's configuration is mostly done by
	setting <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variables.  A special subtree of sysctl
	exists as a basis for organizing all the relevant options: the
	<code class="varname">security.jail.*</code> hierarchy of FreeBSD kernel
	options.  Here is a list of the main jail-related sysctls,
	complete with their default value.  Names should be
	self-explanatory, but for more information about them, please
	refer to the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> manual
	pages.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">security.jail.set_hostname_allowed:
	      1</code></p></li><li class="listitem"><p><code class="varname">security.jail.socket_unixiproute_only:
	      1</code></p></li><li class="listitem"><p><code class="varname">security.jail.sysvipc_allowed:
	      0</code></p></li><li class="listitem"><p><code class="varname">security.jail.enforce_statfs:
	      2</code></p></li><li class="listitem"><p><code class="varname">security.jail.allow_raw_sockets:
	      0</code></p></li><li class="listitem"><p><code class="varname">security.jail.chflags_allowed:
	      0</code></p></li><li class="listitem"><p><code class="varname">security.jail.jailed: 0</code></p></li></ul></div><p>These variables can be used by the system administrator of
	the <span class="emphasis"><em>host system</em></span> to add or remove some of
	the limitations imposed by default on the <code class="systemitem">root</code> user.  Note that there
	are some limitations which cannot be removed.  The
	<code class="systemitem">root</code> user is not
	allowed to mount or unmount file systems from within a
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.  The <code class="systemitem">root</code> inside a jail may not
	load or unload <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> rulesets, set firewall rules, or
	do many other administrative tasks which require modifications
	of in-kernel data, such as setting the
	<code class="varname">securelevel</code> of the kernel.</p><p>The base system of FreeBSD contains a basic set of tools for
	viewing information about the active jails, and attaching to a
	jail to run administrative commands.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jls&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jls</span>(8)</span></a> and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a> commands are part of the base FreeBSD system, and
	can be used to perform the following simple tasks:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Print a list of active jails and their corresponding
	    jail identifier (<acronym class="acronym">JID</acronym>),
	    <acronym class="acronym">IP</acronym> address, hostname and path.</p></li><li class="listitem"><p>Attach to a running jail, from its host system, and
	    run a command inside the jail or perform administrative
	    tasks inside the jail itself.  This is especially useful
	    when the <code class="systemitem">root</code>
	    user wants to cleanly shut down a jail.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a>
	    utility can also be used to start a shell in a jail to do
	    administration in it; for example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>jexec <em class="replaceable"><code>1</code></em> tcsh</code></strong></pre></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-tuning-admintools"></a>14.4.2. High-Level Administrative Tools in the FreeBSD Ports
	Collection</h3></div></div></div><p>Among the many third-party utilities for jail
	administration, one of the most complete and useful is
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/ezjail/pkg-descr">sysutils/ezjail</a>.  It is a set of scripts
	that contribute to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> management.  Please refer to
	<a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/jails-ezjail.html" target="_top">the
	  handbook section on <span class="application">ezjail</span></a>
	for more information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-updating"></a>14.4.3. Keeping Jails Patched and up to Date</h3></div></div></div><p>Jails should be kept up to date from the host operating
	system as attempting to patch userland from within the jail
	may likely fail as the default behavior in FreeBSD is to
	disallow the use of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a> in a jail which prevents
	the replacement of some files.  It is possible to change this
	behavior but it is recommended to use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a>
	to maintain jails instead.  Use <code class="option">-b</code> to specify
	the path of the jail to be updated.</p><p>To update the jail to the latest patch release of the
	version of FreeBSD it is already running, then execute the
	following commands on the host:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -b <em class="replaceable"><code>/here/is/the/jail</code></em> fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -b <em class="replaceable"><code>/here/is/the/jail</code></em> install</code></strong></pre><p>To upgrade the jail to a new major or minor version,
	first upgrade the host system as described in
	<a class="xref" href="#freebsdupdate-upgrade" title="23.2.3. Performing Major and Minor Version Upgrades">Section 23.2.3, &#8220;Performing Major and Minor Version Upgrades&#8221;</a>. Once the host has been
	upgraded and rebooted, the jail can then be upgraded.
	For example to upgrade from 12.0-RELEASE to 12.1-RELEASE,
	on the host run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -b <em class="replaceable"><code>/here/is/the/jail</code></em> --currently-running <em class="replaceable"><code>12.0-RELEASE</code></em> -r <em class="replaceable"><code>12.1-RELEASE</code></em> upgrade</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -b <em class="replaceable"><code>/here/is/the/jail</code></em> install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service jail restart <em class="replaceable"><code>myjail</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -b <em class="replaceable"><code>/here/is/the/jail</code></em> install</code></strong></pre><p>Then, if it was a major version upgrade, reinstall all
	installed packages and restart the jail again.  This is
	required because the ABI version changes when upgrading
	between major versions of FreeBSD. From the host:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg -j <em class="replaceable"><code>myjail</code></em> upgrade -f</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service jail restart <em class="replaceable"><code>myjail</code></em></code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-application"></a>14.5. Updating Multiple Jails</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Daniel</span> <span class="surname">Gerzo</span></span>. </span></div><div><span class="authorgroup">Based upon an idea presented by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Simon</span> <span class="surname">L. B. Nielsen</span></span>. </span></div><div><span class="authorgroup">And an article written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Ken</span> <span class="surname">Tom</span></span>. </span></div></div></div><p>The management of multiple jails can become problematic
      because every jail has to be rebuilt from scratch whenever it is
      upgraded.  This can be time consuming and tedious if a lot of
      jails are created and manually updated.</p><p>This section demonstrates one method to resolve this issue
      by safely sharing as much as is possible between jails using
      read-only <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_nullfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_nullfs</span>(8)</span></a> mounts, so that updating is
      simpler.  This makes it more attractive to put single services,
      such as <acronym class="acronym">HTTP</acronym>, <acronym class="acronym">DNS</acronym>, and
      <acronym class="acronym">SMTP</acronym>, into individual jails.  Additionally,
      it provides a simple way to add, remove, and upgrade
      jails.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Simpler solutions exist, such as
	<span class="application">ezjail</span>, which provides an easier
	method of administering FreeBSD jails but is less versatile than
	this setup.  <span class="application">ezjail</span> is covered in
	more detail in <a class="xref" href="#jails-ezjail" title="14.6. Managing Jails with ezjail">Section 14.6, &#8220;Managing Jails with
	<span class="application">ezjail</span>&#8221;</a>.</p></div><p>The goals of the setup described in this section are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Create a simple and easy to understand jail structure
	  that does not require running a full installworld on each
	  and every jail.</p></li><li class="listitem"><p>Make it easy to add new jails or remove existing
	  ones.</p></li><li class="listitem"><p>Make it easy to update or upgrade existing jails.</p></li><li class="listitem"><p>Make it possible to run a customized FreeBSD branch.</p></li><li class="listitem"><p>Be paranoid about security, reducing as much as
	  possible the possibility of compromise.</p></li><li class="listitem"><p>Save space and inodes, as much as possible.</p></li></ul></div><p>This design relies on a single, read-only master template
      which is mounted into each jail and one read-write device per
      jail.  A device can be a separate physical disc, a partition, or
      a vnode backed memory device.  This example uses read-write
      <span class="application">nullfs</span> mounts.</p><p>The file system layout is as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The jails are based under the
	  <code class="filename">/home</code> partition.</p></li><li class="listitem"><p>Each jail will be mounted under the
	  <code class="filename">/home/j</code> directory.</p></li><li class="listitem"><p>The template for each jail and the read-only partition
	  for  all of the jails is
	  <code class="filename">/home/j/mroot</code>.</p></li><li class="listitem"><p>A blank directory will be created for each jail under
	  the <code class="filename">/home/j</code> directory.</p></li><li class="listitem"><p>Each jail will have a <code class="filename">/s</code> directory
	  that will be linked to the read-write portion of the
	  system.</p></li><li class="listitem"><p>Each jail will have its own read-write system that is
	  based upon <code class="filename">/home/j/skel</code>.</p></li><li class="listitem"><p>The read-write portion of each jail will be created in
	  <code class="filename">/home/js</code>.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-service-jails-template"></a>14.5.1. Creating the Template</h3></div></div></div><p>This section describes the steps needed to create the
	master template.</p><p>It is recommended to first update the host FreeBSD system to
	the latest -RELEASE branch using the instructions in <a class="xref" href="#makeworld" title="23.5. Updating FreeBSD from Source">Section 23.5, &#8220;Updating FreeBSD from Source&#8221;</a>.  Additionally, this template uses the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cpdup/pkg-descr">sysutils/cpdup</a> package or port and
	<span class="application">portsnap</span> will be used to download
	the FreeBSD Ports Collection.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>First, create a directory structure for the read-only
	    file system which will contain the FreeBSD binaries for the
	    jails.  Then, change directory to the FreeBSD source tree and
	    install the read-only file system to the jail
	    template:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /home/j /home/j/mroot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld DESTDIR=/home/j/mroot</code></strong></pre></li><li class="step"><p>Next, prepare a FreeBSD Ports Collection for the jails as
	    well as a FreeBSD source tree, which is required for
	    <span class="application">mergemaster</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /home/j/mroot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir usr/ports</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>portsnap -p /home/j/mroot/usr/ports fetch extract</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpdup /usr/src /home/j/mroot/usr/src</code></strong></pre></li><li class="step"><p>Create a skeleton for the read-write portion of the
	    system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /home/j/skel /home/j/skel/home /home/j/skel/usr-X11R6 /home/j/skel/distfiles</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv etc /home/j/skel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv usr/local /home/j/skel/usr-local</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv tmp /home/j/skel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv var /home/j/skel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv root /home/j/skel</code></strong></pre></li><li class="step"><p>Use <span class="application">mergemaster</span> to install
	    missing configuration files.  Then, remove the extra
	    directories that <span class="application">mergemaster</span>
	    creates:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mergemaster -t /home/j/skel/var/tmp/temproot -D /home/j/skel -i</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /home/j/skel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -R bin boot lib libexec mnt proc rescue sbin sys usr dev</code></strong></pre></li><li class="step"><p>Now, symlink the read-write file system to the
	    read-only file system.  Ensure that the symlinks are
	    created in the correct <code class="filename">s/</code> locations
	    as the creation of directories in the wrong locations will
	    cause the installation to fail.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /home/j/mroot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir s</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/etc etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/home home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/root root</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s ../s/usr-local usr/local</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s ../s/usr-X11R6 usr/X11R6</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s ../../s/distfiles usr/ports/distfiles</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/tmp tmp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/var var</code></strong></pre></li><li class="step"><p>As a last step, create a generic
	    <code class="filename">/home/j/skel/etc/make.conf</code> containing
	    this line:</p><pre class="programlisting">WRKDIRPREFIX?=  /s/portbuild</pre><p>This makes it possible to compile FreeBSD ports inside
	    each jail.  Remember that the ports directory is part of
	    the read-only system.  The custom path for
	    <code class="literal">WRKDIRPREFIX</code> allows builds to be done
	    in the read-write portion of every jail.</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-service-jails-creating"></a>14.5.2. Creating Jails</h3></div></div></div><p>The jail template can now be used to setup and configure
	the jails in <code class="filename">/etc/rc.conf</code>.  This example
	demonstrates the creation of 3 jails: <code class="literal">NS</code>,
	<code class="literal">MAIL</code> and <code class="literal">WWW</code>.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Add the following lines to
	    <code class="filename">/etc/fstab</code>, so that the read-only
	    template for the jails and the read-write space will be
	    available in the respective jails:</p><pre class="programlisting">/home/j/mroot   /home/j/ns     nullfs  ro  0   0
/home/j/mroot   /home/j/mail   nullfs  ro  0   0
/home/j/mroot   /home/j/www    nullfs  ro  0   0
/home/js/ns     /home/j/ns/s   nullfs  rw  0   0
/home/js/mail   /home/j/mail/s nullfs  rw  0   0
/home/js/www    /home/j/www/s  nullfs  rw  0   0</pre><p>To prevent
	    <span class="application">fsck</span> from checking
	    <span class="application">nullfs</span> mounts during boot and
	    <span class="application">dump</span> from backing up the
	    read-only nullfs mounts of the jails, the last two
	    columns are both set to <code class="literal">0</code>.</p></li><li class="step"><p>Configure the jails in
	    <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">jail_enable="YES"
jail_set_hostname_allow="NO"
jail_list="ns mail www"
jail_ns_hostname="ns.example.org"
jail_ns_ip="192.168.3.17"
jail_ns_rootdir="/usr/home/j/ns"
jail_ns_devfs_enable="YES"
jail_mail_hostname="mail.example.org"
jail_mail_ip="192.168.3.18"
jail_mail_rootdir="/usr/home/j/mail"
jail_mail_devfs_enable="YES"
jail_www_hostname="www.example.org"
jail_www_ip="62.123.43.14"
jail_www_rootdir="/usr/home/j/www"
jail_www_devfs_enable="YES"</pre><p>The
	    <code class="varname">jail_<em class="replaceable"><code>name</code></em>_rootdir</code>
	    variable is set to
	    <code class="filename">/usr/home</code> instead
	    of <code class="filename">/home</code> because
	    the physical path of <code class="filename">/home</code> on a default FreeBSD
	    installation is <code class="filename">/usr/home</code>.  The
	    <code class="varname">jail_<em class="replaceable"><code>name</code></em>_rootdir</code>
	    variable must <span class="emphasis"><em>not</em></span> be set to a path
	    which includes a symbolic link, otherwise the jails will
	    refuse to start.</p></li><li class="step"><p>Create the required mount points for the read-only
	    file system of each jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /home/j/ns /home/j/mail /home/j/www</code></strong></pre></li><li class="step"><p>Install the read-write template into each jail using
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cpdup/pkg-descr">sysutils/cpdup</a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /home/js</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpdup /home/j/skel /home/js/ns</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpdup /home/j/skel /home/js/mail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpdup /home/j/skel /home/js/www</code></strong></pre></li><li class="step"><p>In this phase, the jails are built and prepared to
	    run.  First, mount the required file systems for each
	    jail, and then start them:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -a</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service jail start</code></strong></pre></li></ol></div><p>The jails should be running now.  To check if they have
	started correctly, use <code class="command">jls</code>.  Its output
	should be similar to the following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>jls</code></strong>
   JID  IP Address      Hostname                      Path
     3  192.168.3.17    ns.example.org                /home/j/ns
     2  192.168.3.18    mail.example.org              /home/j/mail
     1  62.123.43.14    www.example.org               /home/j/www</pre><p>At this point, it should be possible to log onto each
	jail, add new users, or configure daemons.  The
	<code class="literal">JID</code> column indicates the jail
	identification number of each running jail.  Use the following
	command to perform administrative tasks in the jail whose
	<acronym class="acronym">JID</acronym> is <code class="literal">3</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>jexec 3 tcsh</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-service-jails-upgrading"></a>14.5.3. Upgrading</h3></div></div></div><p>The design of this setup provides an easy way to upgrade
	existing jails while minimizing their downtime.  Also, it
	provides a way to roll back to the older version should a
	problem occur.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>The first step is to upgrade the host system.  Then,
	    create a new temporary read-only template in
	    <code class="filename">/home/j/mroot2</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /home/j/mroot2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld DESTDIR=/home/j/mroot2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /home/j/mroot2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpdup /usr/src usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir s</code></strong></pre><p>The <code class="buildtarget">installworld</code> creates a
	    few unnecessary directories, which should be
	    removed:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chflags -R 0 var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -R etc var root usr/local tmp</code></strong></pre></li><li class="step"><p>Recreate the read-write symlinks for the master file
	    system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ln -s s/etc etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/root root</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/home home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s ../s/usr-local usr/local</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s ../s/usr-X11R6 usr/X11R6</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/tmp tmp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s s/var var</code></strong></pre></li><li class="step"><p>Next, stop the jails:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service jail stop</code></strong></pre></li><li class="step"><p>Unmount the original file systems as the read-write
	    systems are attached to the read-only system
	    (<code class="filename">/s</code>):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/ns/s</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/ns</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/mail/s</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/mail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/www/s</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /home/j/www</code></strong></pre></li><li class="step"><p>Move the old read-only file system and replace it with
	    the new one.  This will serve as a backup and archive of
	    the old read-only file system should something go wrong.
	    The naming convention used here corresponds to when a new
	    read-only file system has been created.  Move the original
	    FreeBSD Ports Collection over to the new file system to save
	    some space and inodes:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /home/j</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv mroot mroot.20060601</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv mroot2 mroot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv mroot.20060601/usr/ports mroot/usr</code></strong></pre></li><li class="step"><p>At this point the new read-only template is ready, so
	    the only remaining task is to remount the file systems and
	    start the jails:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -a</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service jail start</code></strong></pre></li></ol></div><p>Use <code class="command">jls</code> to check if the jails started
	correctly.  Run <code class="command">mergemaster</code> in each jail to
	update the configuration files.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-ezjail"></a>14.6. Managing Jails with
	<span class="application">ezjail</span></h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div></div></div><p>Creating and managing multiple jails can quickly become
      tedious and error-prone.  Dirk Engling's
      <span class="application">ezjail</span> automates and greatly
      simplifies many jail tasks.  A <span class="emphasis"><em>basejail</em></span> is
      created as a template.  Additional jails use
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_nullfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_nullfs</span>(8)</span></a> to share many of the basejail directories
      without using additional disk space.  Each additional jail takes
      only a few megabytes of disk space before applications are
      installed.  Upgrading the copy of the userland in the basejail
      automatically upgrades all of the other jails.</p><p>Additional benefits and features are described in detail on
      the <span class="application">ezjail</span> web site, <a class="link" href="https://erdgeist.org/arts/software/ezjail/" target="_top">https://erdgeist.org/arts/software/ezjail/</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-install"></a>14.6.1. Installing <span class="application">ezjail</span></h3></div></div></div><p>Installing <span class="application">ezjail</span> consists of
	adding a loopback interface for use in jails, installing the
	port or package, and enabling the service.</p><div class="procedure"><a id="jails-ezjail-install-procedure"></a><ol class="procedure" type="1"><li class="step"><p>To keep jail loopback traffic off the host's loopback
	    network interface <code class="literal">lo0</code>, a second
	    loopback interface is created by adding an entry to
	    <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">cloned_interfaces="lo1"</pre><p>The second loopback interface <code class="literal">lo1</code>
	    will be created when the system starts.  It can also be
	    created manually without a restart:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif cloneup</code></strong>
Created clone interfaces: lo1.</pre><p>Jails can be allowed to use aliases of this secondary
	    loopback interface without interfering with the
	    host.</p><p>Inside a jail, access to the loopback address
	    <code class="systemitem">127.0.0.1</code> is
	    redirected to the first <acronym class="acronym">IP</acronym> address
	    assigned to the jail.  To make the jail loopback
	    correspond with the new <code class="literal">lo1</code> interface,
	    that interface must be specified first in the list of
	    interfaces and <acronym class="acronym">IP</acronym> addresses given when
	    creating a new jail.</p><p>Give each jail a unique loopback address in the
	    <code class="systemitem">127.0.0.0</code><code class="systemitem">/8</code> netblock.</p></li><li class="step"><p>Install
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/ezjail/pkg-descr">sysutils/ezjail</a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/sysutils/ezjail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre></li><li class="step"><p>Enable <span class="application">ezjail</span> by adding
	    this line to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ezjail_enable="YES"</pre></li><li class="step"><p>The service will automatically start on system boot.
	    It can be started immediately for the current
	    session:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service ezjail start</code></strong></pre></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-initialsetup"></a>14.6.2. Initial Setup</h3></div></div></div><p>With <span class="application">ezjail</span> installed, the
	basejail directory structure can be created and populated.
	This step is only needed once on the jail host
	computer.</p><p>In both of these examples, <code class="option">-p</code> causes the
	ports tree to be retrieved with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=portsnap&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">portsnap</span>(8)</span></a> into the
	basejail.  That single copy of the ports directory will be
	shared by all the jails.  Using a separate copy of the ports
	directory for jails isolates them from the host.  The
	<span class="application">ezjail</span> <acronym class="acronym">FAQ</acronym>
	explains in more detail: <a class="link" href="http://erdgeist.org/arts/software/ezjail/#FAQ" target="_top">http://erdgeist.org/arts/software/ezjail/#FAQ</a>.</p><div class="procedure"><a id="jails-ezjail-initialsetup-procedure"></a><ul class="procedure"><li class="step"><ul class="stepalternatives">
	    <li class="step"><p class="title"><strong>To Populate the Jail with FreeBSD-RELEASE</strong></p><p>For a basejail based on the FreeBSD RELEASE matching
		that of the host computer, use
		<code class="command">install</code>.  For example, on a host
		computer running FreeBSD 10-STABLE, the latest
		RELEASE version of FreeBSD -10 will be installed in
		the jail):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin install -p</code></strong></pre></li>

	    <li class="step"><p class="title"><strong>To Populate the Jail with
		<code class="command">installworld</code></strong></p><p>The basejail can be installed from binaries
		created by <code class="buildtarget">buildworld</code> on
		the host with
		<code class="command">ezjail-admin update</code>.</p><p>In this example, FreeBSD 10-STABLE has been
		built from source.  The jail directories are created.
		Then <code class="buildtarget">installworld</code> is
		executed, installing the host's
		<code class="filename">/usr/obj</code> into the
		basejail.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -i -p</code></strong></pre><p>The host's <code class="filename">/usr/src</code> is used
		by default.  A different source directory on the host
		can be specified with <code class="option">-s</code> and a path,
		or set with <code class="varname">ezjail_sourcetree</code> in
		<code class="filename">/usr/local/etc/ezjail.conf</code>.</p></li>
	  </ul></li></ul></div><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">The basejail's ports tree is shared by other jails.
	  However, downloaded distfiles are stored in the jail that
	  downloaded them.  By default, these files are stored in
	  <code class="filename">/var/ports/distfiles</code> within each
	  jail.  <code class="filename">/var/ports</code> inside each jail is
	  also used as a work directory when building ports.</p></div><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <acronym class="acronym">FTP</acronym> protocol is used by default
	  to download packages for the installation of the basejail.
	  Firewall or proxy configurations can prevent or interfere
	  with <acronym class="acronym">FTP</acronym> transfers.  The
	  <acronym class="acronym">HTTP</acronym> protocol works differently and
	  avoids these problems.  It can be chosen by specifying a
	  full <acronym class="acronym">URL</acronym> for a particular download mirror
	  in <code class="filename">/usr/local/etc/ezjail.conf</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">ezjail_ftphost=http://<em class="replaceable"><code>ftp.FreeBSD.org</code></em></pre><p xmlns="http://www.w3.org/1999/xhtml">See <a class="xref" href="#mirrors-ftp" title="A.2. FTP Sites">Section A.2, &#8220;<acronym class="acronym">FTP</acronym> Sites&#8221;</a> for a list of
	  sites.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-create"></a>14.6.3. Creating and Starting a New Jail</h3></div></div></div><p>New jails are created with
	<code class="command">ezjail-admin create</code>.  In these examples,
	the <code class="literal">lo1</code> loopback interface is used as
	described above.</p><div class="procedure"><a id="jails-ezjail-create-steps"></a><div class="procedure-title">Procedure 14.1. Create and Start a New Jail</div><ol class="procedure" type="1"><li class="step"><p>Create the jail, specifying a name and the loopback
	    and network interfaces to use, along with their
	    <acronym class="acronym">IP</acronym> addresses.  In this example, the
	    jail is named <code class="literal">dnsjail</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin create <em class="replaceable"><code>dnsjail</code></em> '<em class="replaceable"><code>lo1|127.0.1.1</code></em>,<em class="replaceable"><code>em0</code></em>|<em class="replaceable"><code>192.168.1.50</code></em>'</code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle"><a xmlns="http://www.w3.org/1999/xhtml" id="jails-ezjail-raw-network-sockets"></a>Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Most network services run in jails without
	      problems.  A few network services, most notably
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>, use
	      <span class="emphasis"><em>raw network sockets</em></span>.  In jails, raw
	      network sockets are disabled by default for security.
	      Services that require them will not work.</p><p xmlns="http://www.w3.org/1999/xhtml">Occasionally, a jail genuinely needs raw sockets.
	      For example, network monitoring applications often use
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> to check the availability of other
	      computers.  When raw network sockets are actually needed
	      in a jail, they can be enabled by editing the
	      <span class="application">ezjail</span>
	      configuration file for the individual jail,
	      <code class="filename">/usr/local/etc/ezjail/<em class="replaceable"><code>jailname</code></em></code>.
	      Modify the <code class="literal">parameters</code>
	      entry:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">export jail_<em class="replaceable"><code>jailname</code></em>_parameters="allow.raw_sockets=1"</pre><p xmlns="http://www.w3.org/1999/xhtml">Do not enable raw network sockets unless services in
	      the jail actually require them.</p></div></li><li class="step"><p>Start the jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin start <em class="replaceable"><code>dnsjail</code></em></code></strong></pre></li><li class="step"><p>Use a console on the jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin console <em class="replaceable"><code>dnsjail</code></em></code></strong></pre></li></ol></div><p>The jail is operating and additional configuration can be
	completed.  Typical settings added at this point
	include:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Set the
	    <code class="systemitem">root</code>
	    Password</strong></p><p>Connect to the jail and set the
	    <code class="systemitem">root</code> user's
	    password:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin console <em class="replaceable"><code>dnsjail</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>passwd</code></strong>
Changing local password for root
New Password:
Retype New Password:</pre></li><li class="step"><p class="title"><strong>Time Zone Configuration</strong></p><p>The jail's time zone can be set with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tzsetup&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tzsetup</span>(8)</span></a>.
	    To avoid spurious error messages, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adjkerntz&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adjkerntz</span>(8)</span></a>
	    entry in <code class="filename">/etc/crontab</code> can be
	    commented or removed.  This job attempts to update the
	    computer's hardware clock with time zone changes, but
	    jails are not allowed to access that hardware.</p></li><li class="step"><p class="title"><strong><acronym class="acronym">DNS</acronym> Servers</strong></p><p>Enter domain name server lines in
	    <code class="filename">/etc/resolv.conf</code> so
	    <acronym class="acronym">DNS</acronym> works in the jail.</p></li><li class="step"><p class="title"><strong>Edit <code class="filename">/etc/hosts</code></strong></p><p>Change the address and add the jail name to the
	    <code class="literal">localhost</code> entries in
	    <code class="filename">/etc/hosts</code>.</p></li><li class="step"><p class="title"><strong>Configure <code class="filename">/etc/rc.conf</code></strong></p><p>Enter configuration settings in
	    <code class="filename">/etc/rc.conf</code>.  This is much like
	    configuring a full computer.  The host name and
	    <acronym class="acronym">IP</acronym> address are not set here.  Those
	    values are already provided by the jail
	    configuration.</p></li></ol></div><p>With the jail configured, the applications for which the
	jail was created can be installed.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some ports must be built with special options to be used
	  in a jail.  For example, both of the network monitoring
	  plugin packages
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/nagios-plugins/pkg-descr">net-mgmt/nagios-plugins</a> and
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/monitoring-plugins/pkg-descr">net-mgmt/monitoring-plugins</a>
	  have a <code class="literal">JAIL</code> option which must be enabled
	  for them to work correctly inside a jail.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-update"></a>14.6.4. Updating Jails</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-update-os"></a>14.6.4.1. Updating the Operating System</h4></div></div></div><p>Because the basejail's copy of the userland is shared by
	  the other jails, updating the basejail automatically updates
	  all of the other jails.  Either source or binary updates can
	  be used.</p><p>To build the world from source on the host, then
	  install it in the basejail, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -b</code></strong></pre><p>If the world has already been compiled on the host,
	  install it in the basejail with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -i</code></strong></pre><p>Binary updates use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a>.  These
	  updates have the same limitations as if
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a> were being run directly.  The most
	  important one is that only -RELEASE versions of FreeBSD are
	  available with this method.</p><p>Update the basejail to the latest patched release of
	  the version of FreeBSD on the host.  For example, updating from
	  RELEASE-p1 to RELEASE-p2.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -u</code></strong></pre><p>To upgrade the basejail to a new version, first
	  upgrade the host system as described in <a class="xref" href="#freebsdupdate-upgrade" title="23.2.3. Performing Major and Minor Version Upgrades">Section 23.2.3, &#8220;Performing Major and Minor Version Upgrades&#8221;</a>.  Once the host has
	  been upgraded and rebooted, the basejail can then be
	  upgraded.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a> has no way of determining
	  which version is currently installed in the basejail, so the
	  original version must be specified.  Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=file&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">file</span>(1)</span></a> to
	  determine the original version in the basejail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>file /usr/jails/basejail/bin/sh</code></strong>
/usr/jails/basejail/bin/sh: ELF 64-bit LSB executable, x86-64, version 1 (FreeBSD), dynamically linked (uses shared libs), for FreeBSD 9.3, stripped</pre><p>Now use this information to perform the upgrade from
	  <code class="literal">9.3-RELEASE</code> to the current version of
	  the host system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -U -s <em class="replaceable"><code>9.3-RELEASE</code></em></code></strong></pre><p>After updating the basejail, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> must
	  be run to update each jail's configuration files.</p><p>How to use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> depends on the purpose
	  and trustworthiness of a jail.  If a jail's services or
	  users are not trusted, then <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> should only
	  be run from within that jail:</p><div class="example"><a id="jails-ezjail-update-mergemaster-untrusted"></a><div class="example-title">Example 14.1. <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> on Untrusted Jail</div><div class="example-contents"><p>Delete the link from the jail's
	    <code class="filename">/usr/src</code> into the basejail and
	    create a new <code class="filename">/usr/src</code> in the jail
	    as a mountpoint.  Mount the host computer's
	    <code class="filename">/usr/src</code> read-only on the jail's
	    new <code class="filename">/usr/src</code> mountpoint:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rm /usr/jails/<em class="replaceable"><code>jailname</code></em>/usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /usr/jails/<em class="replaceable"><code>jailname</code></em>/usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t nullfs -o ro /usr/src /usr/jails/<em class="replaceable"><code>jailname</code></em>/usr/src</code></strong></pre><p>Get a console in the jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin console <em class="replaceable"><code>jailname</code></em></code></strong></pre><p>Inside the jail, run <code class="command">mergemaster</code>.
	    Then exit the jail console:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mergemaster -U</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong></pre><p>Finally, unmount the jail's
	    <code class="filename">/usr/src</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /usr/jails/<em class="replaceable"><code>jailname</code></em>/usr/src</code></strong></pre></div></div><br class="example-break" /><div class="example"><a id="jails-ezjail-update-mergemaster-trusted"></a><div class="example-title">Example 14.2. <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> on Trusted Jail</div><div class="example-contents"><p>If the users and services in a jail are trusted,
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> can be run from the host:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mergemaster -U -D /usr/jails/<em class="replaceable"><code>jailname</code></em></code></strong></pre></div></div><br class="example-break" /><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">After a major version update it is recommended by
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/ezjail/pkg-descr">sysutils/ezjail</a> to make sure your
	    <code class="command">pkg</code> is of the correct version.
	    Therefore enter:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg-static upgrade -f pkg</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">to upgrade or downgrade to the appropriate
	    version.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-update-ports"></a>14.6.4.2. Updating Ports</h4></div></div></div><p>The ports tree in the basejail is shared by the other
	  jails.  Updating that copy of the ports tree gives the other
	  jails the updated version also.</p><p>The basejail ports tree is updated with
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=portsnap&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">portsnap</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin update -P</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-control"></a>14.6.5. Controlling Jails</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-control-stop-start"></a>14.6.5.1. Stopping and Starting Jails</h4></div></div></div><p><span class="application">ezjail</span> automatically starts
	  jails when the computer is started.  Jails can be manually
	  stopped and restarted with <code class="command">stop</code> and
	  <code class="command">start</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin stop <em class="replaceable"><code>sambajail</code></em></code></strong>
Stopping jails: sambajail.</pre><p>By default, jails are started automatically when the
	  host computer starts.  Autostarting can be disabled
	  with <code class="command">config</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin config -r norun <em class="replaceable"><code>seldomjail</code></em></code></strong></pre><p>This takes effect the next time the host computer is
	  started.  A jail that is already running will not be
	  stopped.</p><p>Enabling autostart is very similar:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin config -r run <em class="replaceable"><code>oftenjail</code></em></code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-control-backup"></a>14.6.5.2. Archiving and Restoring Jails</h4></div></div></div><p>Use <code class="command">archive</code> to create a
	  <code class="filename">.tar.gz</code> archive of a jail.  The file
	  name is composed from the name of the jail and the current
	  date.  Archive files are written to the archive directory,
	  <code class="filename">/usr/jails/ezjail_archives</code>.  A
	  different archive directory can be chosen by setting
	  <code class="varname">ezjail_archivedir</code> in the configuration
	  file.</p><p>The archive file can be copied elsewhere as a backup, or
	  an existing jail can be restored from it with
	  <code class="command">restore</code>.  A new jail can be created from
	  the archive, providing a convenient way to clone existing
	  jails.</p><p>Stop and archive a jail named
	  <code class="literal">wwwserver</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin stop <em class="replaceable"><code>wwwserver</code></em></code></strong>
Stopping jails: wwwserver.
<code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin archive <em class="replaceable"><code>wwwserver</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls /usr/jails/ezjail-archives/</code></strong>
wwwserver-201407271153.13.tar.gz</pre><p>Create a new jail named
	  <code class="literal">wwwserver-clone</code> from the archive created
	  in the previous step.  Use the <code class="filename">em1</code>
	  interface and assign a new <acronym class="acronym">IP</acronym> address to
	  avoid conflict with the original:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin create -a /usr/jails/ezjail_archives/wwwserver-201407271153.13.tar.gz <em class="replaceable"><code>wwwserver-clone</code></em> 'lo1|127.0.3.1,em1|192.168.1.51'</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="jails-ezjail-example-bind"></a>14.6.6. Full Example: <span class="application">BIND</span> in a
	Jail</h3></div></div></div><p>Putting the <span class="application">BIND</span>
	<acronym class="acronym">DNS</acronym> server in a jail improves security by
	isolating it.  This example creates a simple caching-only name
	server.</p><div class="itemizedlist"><a id="jails-ezjail-example-bind-assumptions"></a><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The jail will be called
	    <code class="literal">dns1</code>.</p></li><li class="listitem"><p>The jail will use <acronym class="acronym">IP</acronym> address
	    <code class="literal">192.168.1.240</code> on the host's
	    <code class="literal">re0</code> interface.</p></li><li class="listitem"><p>The upstream <acronym class="acronym">ISP</acronym>'s DNS servers are
	    at <code class="literal">10.0.0.62</code> and
	    <code class="literal">10.0.0.61</code>.</p></li><li class="listitem"><p>The basejail has already been created and a ports tree
	    installed as shown in
	    <a class="xref" href="#jails-ezjail-initialsetup" title="14.6.2. Initial Setup">Section 14.6.2, &#8220;Initial Setup&#8221;</a>.</p></li></ul></div><div class="example"><a id="jails-ezjail-example-bind-steps"></a><div class="example-title">Example 14.3. Running BIND in a Jail</div><div class="example-contents"><p>Create a cloned loopback interface by adding a line to
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">cloned_interfaces="lo1"</pre><p>Immediately create the new loopback interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif cloneup</code></strong>
Created clone interfaces: lo1.</pre><p>Create the jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin create dns1 'lo1|127.0.2.1,re0|192.168.1.240'</code></strong></pre><p>Start the jail, connect to a console running on it, and
	  perform some basic configuration:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin start dns1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ezjail-admin console dns1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>passwd</code></strong>
Changing local password for root
New Password:
Retype New Password:
<code class="prompt">#</code> <strong class="userinput"><code>tzsetup</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sed -i .bak -e '/adjkerntz/ s/^/#/' /etc/crontab</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sed -i .bak -e 's/127.0.0.1/127.0.2.1/g; s/localhost.my.domain/dns1.my.domain dns1/' /etc/hosts</code></strong></pre><p>Temporarily set the upstream <acronym class="acronym">DNS</acronym>
	  servers in <code class="filename">/etc/resolv.conf</code> so ports
	  can be downloaded:</p><pre class="programlisting">nameserver 10.0.0.62
nameserver 10.0.0.61</pre><p>Still using the jail console, install
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/dns/bind99/pkg-descr">dns/bind99</a>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -C /usr/ports/dns/bind99 install clean</code></strong></pre><p>Configure the name server by editing
	  <code class="filename">/usr/local/etc/namedb/named.conf</code>.</p><p>Create an Access Control List (<acronym class="acronym">ACL</acronym>)
	  of addresses and networks that are permitted to send
	  <acronym class="acronym">DNS</acronym> queries to this name server.  This
	  section is added just before the <code class="literal">options</code>
	  section already in the file:</p><pre class="programlisting">...
// or cause huge amounts of useless Internet traffic.

acl "trusted" {
	192.168.1.0/24;
	localhost;
	localnets;
};

options {
...</pre><p>Use the jail <acronym class="acronym">IP</acronym> address in the
	  <code class="literal">listen-on</code> setting to accept
	  <acronym class="acronym">DNS</acronym> queries from other computers on the
	  network:</p><pre class="programlisting">	listen-on	{ 192.168.1.240; };</pre><p>A simple caching-only <acronym class="acronym">DNS</acronym> name server
	  is created by changing the <code class="literal">forwarders</code>
	  section.  The original file contains:</p><pre class="programlisting">/*
	forwarders {
		127.0.0.1;
	};
*/</pre><p>Uncomment the section by removing the
	  <code class="literal">/*</code> and <code class="literal">*/</code> lines.
	  Enter the <acronym class="acronym">IP</acronym> addresses of the upstream
	  <acronym class="acronym">DNS</acronym> servers.  Immediately after the
	  <code class="literal">forwarders</code> section, add references to the
	  <code class="literal">trusted</code> <acronym class="acronym">ACL</acronym> defined
	  earlier:</p><pre class="programlisting">	forwarders {
		10.0.0.62;
		10.0.0.61;
	};

	allow-query       { any; };
	allow-recursion   { trusted; };
	allow-query-cache { trusted; };</pre><p>Enable the service in
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">named_enable="YES"</pre><p>Start and test the name server:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service named start</code></strong>
wrote key file "/usr/local/etc/namedb/rndc.key"
Starting named.
<code class="prompt">#</code> <strong class="userinput"><code>/usr/local/bin/dig @192.168.1.240 freebsd.org</code></strong></pre><p>A response that includes</p><pre class="screen">;; Got answer;</pre><p>shows that the new <acronym class="acronym">DNS</acronym> server is
	  working.  A long delay followed by a response
	  including</p><pre class="screen">;; connection timed out; no servers could be reached</pre><p>shows a problem.  Check the configuration settings and
	  make sure any local firewalls allow the new
	  <acronym class="acronym">DNS</acronym> access to the upstream
	  <acronym class="acronym">DNS</acronym> servers.</p><p>The new <acronym class="acronym">DNS</acronym> server can use itself for
	  local name resolution, just like other local computers.  Set
	  the address of the <acronym class="acronym">DNS</acronym> server in the
	  client computer's
	  <code class="filename">/etc/resolv.conf</code>:</p><pre class="programlisting">nameserver 192.168.1.240</pre><p>A local <acronym class="acronym">DHCP</acronym> server can be configured
	  to provide this address for a local <acronym class="acronym">DNS</acronym>
	  server, providing automatic configuration on
	  <acronym class="acronym">DHCP</acronym> clients.</p></div></div><br class="example-break" /></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac"></a>Chapter 15. Mandatory Access Control</h2></div><div><span class="authorgroup">Written
	by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#mac-synopsis">15.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#mac-inline-glossary">15.2. Key Terms</a></span></dt><dt><span class="sect1"><a href="#mac-understandlabel">15.3. Understanding MAC Labels</a></span></dt><dt><span class="sect1"><a href="#mac-planning">15.4. Planning the Security Configuration</a></span></dt><dt><span class="sect1"><a href="#mac-policies">15.5. Available MAC Policies</a></span></dt><dt><span class="sect1"><a href="#mac-userlocked">15.6. User Lock Down</a></span></dt><dt><span class="sect1"><a href="#mac-implementing">15.7. Nagios in a MAC Jail</a></span></dt><dt><span class="sect1"><a href="#mac-troubleshoot">15.8. Troubleshooting the MAC Framework</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-synopsis"></a>15.1. Synopsis</h2></div></div></div><a id="idp58875640" class="indexterm"></a><a id="idp58876152" class="indexterm"></a><p>FreeBSD supports security extensions  based on the
      <span class="trademark">POSIX</span>®.1e draft.  These security mechanisms include file system
      Access Control Lists (<a class="xref" href="#fs-acl" title="13.9. Access Control Lists">Section 13.9, &#8220;Access Control Lists&#8221;</a>) and Mandatory
      Access Control (<acronym class="acronym">MAC</acronym>).  <acronym class="acronym">MAC</acronym>
      allows access control modules to be loaded in order to implement
      security policies.  Some modules provide protections for a
      narrow subset of the system, hardening a particular service.
      Others provide comprehensive labeled security across all
      subjects and objects.  The mandatory part of the definition
      indicates that enforcement of controls is performed by
      administrators and the operating system.  This is in contrast to
      the default security mechanism of Discretionary Access Control
      (<acronym class="acronym">DAC</acronym>) where enforcement is left to the
      discretion of users.</p><p>This chapter focuses on the <acronym class="acronym">MAC</acronym> framework
      and the set of pluggable security policy modules FreeBSD provides
      for enabling various security mechanisms.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The terminology associated with the
	  <acronym class="acronym">MAC</acronym> framework.</p></li><li class="listitem"><p>The capabilities of <acronym class="acronym">MAC</acronym> security
	  policy modules as well as the difference between a labeled
	  and non-labeled policy.</p></li><li class="listitem"><p>The considerations to take into account before
	  configuring a system to use the
	  <acronym class="acronym">MAC</acronym> framework.</p></li><li class="listitem"><p>Which <acronym class="acronym">MAC</acronym> security policy modules
	  are included in FreeBSD and how to configure them.</p></li><li class="listitem"><p>How to implement a more secure environment using the
	  <acronym class="acronym">MAC</acronym> framework.</p></li><li class="listitem"><p>How to test the <acronym class="acronym">MAC</acronym> configuration
	  to ensure the framework has been properly
	  implemented.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand <span class="trademark">UNIX</span>® and FreeBSD basics (<a class="xref" href="#basics" title="Chapter 3. FreeBSD Basics">Chapter 3, <em>FreeBSD Basics</em></a>).</p></li><li class="listitem"><p>Have some familiarity with security and how it pertains
	  to FreeBSD (<a class="xref" href="#security" title="Chapter 13. Security">Chapter 13, <em>Security</em></a>).</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Improper <acronym class="acronym">MAC</acronym> configuration may cause
	loss of system access, aggravation of users, or inability to
	access the features provided by
	<span class="application">Xorg</span>.  More importantly,
	<acronym class="acronym">MAC</acronym> should not be relied upon to completely
	secure a system.  The <acronym class="acronym">MAC</acronym> framework only
	augments an existing security policy.  Without sound security
	practices and regular security checks, the system will never
	be completely secure.</p><p xmlns="http://www.w3.org/1999/xhtml">The examples contained within this chapter are for
	demonstration purposes and the example settings should
	<span class="emphasis"><em>not</em></span> be implemented on a production
	system.  Implementing any security policy takes a good deal of
	understanding, proper design, and thorough testing.</p></div><p>While this chapter covers a broad range of security issues
      relating to the <acronym class="acronym">MAC</acronym> framework, the
      development of new <acronym class="acronym">MAC</acronym> security policy
      modules will not be covered.  A number of security policy
      modules included with the <acronym class="acronym">MAC</acronym> framework have
      specific characteristics which are provided for both testing and
      new module development.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_test&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_test</span>(4)</span></a>,
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_stub&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_stub</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_none&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_none</span>(4)</span></a> for more information on
      these security policy modules and the various mechanisms they
      provide.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-inline-glossary"></a>15.2. Key Terms</h2></div></div></div><p>The following key terms are used when referring to the
      <acronym class="acronym">MAC</acronym> framework:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>compartment</em></span>: a set of programs and
	  data to be partitioned or separated, where users are given
	  explicit access to specific component of a system.  A
	  compartment represents a grouping, such as a work group,
	  department, project, or topic.  Compartments make it
	  possible to implement a need-to-know-basis security
	  policy.</p></li><li class="listitem"><p><span class="emphasis"><em>integrity</em></span>: the level of trust which
	  can be placed on data.  As the integrity of the data is
	  elevated, so does the ability to trust that data.</p></li><li class="listitem"><p><span class="emphasis"><em>level</em></span>: the increased or decreased
	  setting of a security attribute.  As the level increases,
	  its security is considered to elevate as well.</p></li><li class="listitem"><p><span class="emphasis"><em>label</em></span>: a security attribute which
	  can be applied to files, directories, or other items in the
	  system.  It could be considered a confidentiality stamp.
	  When a label is placed on a file, it describes the security
	  properties of that file and will only permit access by
	  files, users, and resources with a similar security setting.
	  The meaning and interpretation of label values depends on
	  the policy configuration.  Some policies treat a label as
	  representing the integrity or secrecy of an object while
	  other policies might use labels to hold rules for
	  access.</p></li><li class="listitem"><p><span class="emphasis"><em>multilabel</em></span>: this property is a file
	  system option which can be set in single-user mode using
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a>, during boot using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a>, or during
	  the creation of a new file system.  This option permits
	  an administrator to apply different <acronym class="acronym">MAC</acronym>
	  labels on different objects.  This option only applies to
	  security policy modules which support labeling.</p></li><li class="listitem"><p><span class="emphasis"><em>single label</em></span>: a policy where the
	  entire file system uses one label to enforce access control
	  over the flow of data.  Whenever <code class="option">multilabel</code>
	  is not set, all files will conform to the same label
	  setting.</p></li><li class="listitem"><p><span class="emphasis"><em>object</em></span>: an entity through which
	  information flows under the direction of a
	  <span class="emphasis"><em>subject</em></span>.  This includes directories,
	  files, fields, screens, keyboards, memory, magnetic storage,
	  printers or any other data storage or moving device.  An
	  object is a data container or a system resource.  Access to
	  an object effectively means access to its data.</p></li><li class="listitem"><p><span class="emphasis"><em>subject</em></span>: any active entity that
	  causes information to flow between
	  <span class="emphasis"><em>objects</em></span> such as a user, user process,
	  or system process.  On FreeBSD, this is almost always a
	  thread acting in a process on behalf of a user.</p></li><li class="listitem"><p><span class="emphasis"><em>policy</em></span>: a collection of rules
	  which defines how objectives are to be achieved.  A policy
	  usually documents how certain items are to be handled.  This
	  chapter considers a policy to be a collection of rules which
	  controls the flow of data and information and defines who
	  has access to that data and information.</p></li><li class="listitem"><p><span class="emphasis"><em>high-watermark</em></span>: this type of
	  policy permits the raising of security levels for the
	  purpose of accessing higher level information.  In most
	  cases, the original level is restored after the process is
	  complete.  Currently, the FreeBSD <acronym class="acronym">MAC</acronym>
	  framework does not include this type of policy.</p></li><li class="listitem"><p><span class="emphasis"><em>low-watermark</em></span>: this type of policy
	  permits lowering security levels for the purpose of
	  accessing information which is less secure.  In most cases,
	  the original security level of the user is restored after
	  the process is complete.  The only security policy module in
	  FreeBSD to use this is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_lomac&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_lomac</span>(4)</span></a>.</p></li><li class="listitem"><p><span class="emphasis"><em>sensitivity</em></span>: usually used when
	  discussing Multilevel Security (<acronym class="acronym">MLS</acronym>).  A
	  sensitivity level describes how important or secret the data
	  should be.  As the sensitivity level increases, so does the
	  importance of the secrecy, or confidentiality, of the
	  data.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-understandlabel"></a>15.3. Understanding MAC Labels</h2></div></div></div><p>A <acronym class="acronym">MAC</acronym> label is a security attribute
      which may be applied to subjects and objects throughout the
      system.  When setting a label, the administrator must
      understand its implications in order to prevent unexpected or
      undesired behavior of the system.  The attributes available on
      an object depend on the loaded policy module, as policy modules
      interpret their attributes in different ways.</p><p>The security label on an object is used as a part of a
      security access control decision by a policy.  With some
      policies, the label contains all of the information necessary
      to make a decision.  In other policies, the labels may be
      processed as part of a larger rule set.</p><p>There are two types of label policies: single label and
      multi label.  By default, the system will use single label.  The
      administrator should be aware of the pros and cons of each in
      order to implement policies which meet the requirements of the
      system's security model.</p><p>A single label security policy only permits one label to be
      used for every subject or object.  Since a single label policy
      enforces one set of access permissions across the entire system,
      it provides lower administration overhead, but decreases the
      flexibility of policies which support labeling.  However, in
      many environments, a single label policy may be all that is
      required.</p><p>A single label policy is somewhat similar to
      <acronym class="acronym">DAC</acronym> as <code class="systemitem">root</code> configures the policies so
      that users are placed in the appropriate categories and access
      levels.  A notable difference is that many policy modules can
      also restrict <code class="systemitem">root</code>.
      Basic control over objects will then be released to the group,
      but <code class="systemitem">root</code> may revoke or
      modify the settings at any time.</p><p>When appropriate, a multi label policy can be set on a
      <acronym class="acronym">UFS</acronym> file system by passing
      <code class="option">multilabel</code> to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a>.  A multi label
      policy permits each subject or object to have its own
      independent <acronym class="acronym">MAC</acronym> label.  The decision to use a
      multi label or single label policy is only required for policies
      which implement the labeling feature, such as
      <code class="literal">biba</code>, <code class="literal">lomac</code>, and
      <code class="literal">mls</code>.  Some policies, such as
      <code class="literal">seeotheruids</code>, <code class="literal">portacl</code> and
      <code class="literal">partition</code>, do not use labels at all.</p><p>Using a multi label policy on a partition and establishing a
      multi label security model can increase administrative overhead
      as everything in that file system has a label.  This includes
      directories, files, and even device nodes.</p><p>The following command will set <code class="option">multilabel</code>
      on the specified <acronym class="acronym">UFS</acronym> file system.  This may
      only be done in single-user mode and is not a requirement for
      the swap file system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -l enable /</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some users have experienced problems with setting the
	<code class="option">multilabel</code> flag on the root partition.  If
	this is the case, please review <a class="xref" href="#mac-troubleshoot" title="15.8. Troubleshooting the MAC Framework">Section 15.8, &#8220;Troubleshooting the MAC Framework&#8221;</a>.</p></div><p>Since the multi label policy is set on a per-file system
      basis, a multi label policy may not be needed if the file system
      layout is well designed.  Consider an example security
      <acronym class="acronym">MAC</acronym> model for a FreeBSD web server.  This
      machine uses the single label, <code class="literal">biba/high</code>, for
      everything in the default file systems.  If the web server needs
      to run at <code class="literal">biba/low</code> to prevent write up
      capabilities, it could be installed to a separate
      <acronym class="acronym">UFS</acronym> <code class="filename">/usr/local</code> file
      system set at <code class="literal">biba/low</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp58963448"></a>15.3.1. Label Configuration</h3></div></div></div><p>Virtually all aspects of label policy module configuration
	will be performed using the base system utilities.  These
	commands provide a simple interface for object or subject
	configuration or the manipulation and verification of
	the configuration.</p><p>All configuration may be done using
	<code class="command">setfmac</code>, which is used to set
	<acronym class="acronym">MAC</acronym> labels on system objects, and
	<code class="command">setpmac</code>, which is used to set the labels on
	system subjects.  For example, to set the
	<code class="literal">biba</code> <acronym class="acronym">MAC</acronym> label to
	<code class="literal">high</code> on <code class="filename">test</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfmac biba/high test</code></strong></pre><p>If the configuration is successful, the prompt will be
	returned without error.  A common error is
	<span class="errorname">Permission denied</span> which usually occurs
	when the label is being set or modified on a restricted
	object.  Other conditions may produce different failures.  For
	instance, the file may not be owned by the user attempting to
	relabel the object, the object may not exist, or the object
	may be read-only.  A mandatory policy will not allow the
	process to relabel the file, maybe because of a property of
	the file, a property of the process, or a property of the
	proposed new label value.  For example, if a user running at
	low integrity tries to change the label of a high integrity
	file, or a user running at low integrity tries to change the
	label of a low integrity file to a high integrity label, these
	operations will fail.</p><p>The system administrator may use
	<code class="command">setpmac</code> to override the policy module's
	settings by assigning a different label to the invoked
	process:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfmac biba/high test</code></strong>
<span class="errorname">Permission denied</span>
<code class="prompt">#</code> <strong class="userinput"><code>setpmac biba/low setfmac biba/high test</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>getfmac test</code></strong>
test: biba/high</pre><p>For currently running processes, such as
	<span class="application">sendmail</span>,
	<code class="command">getpmac</code> is usually used instead.  This
	command takes a process ID (<acronym class="acronym">PID</acronym>) in place
	of a command name.  If users attempt to manipulate a file not
	in their access, subject to the rules of the loaded policy
	modules, the <span class="errorname">Operation not permitted</span>
	error will be displayed.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp58979064"></a>15.3.2. Predefined Labels</h3></div></div></div><p>A few FreeBSD policy modules which support the labeling
	feature offer three predefined labels: <code class="literal">low</code>,
	<code class="literal">equal</code>, and <code class="literal">high</code>,
	where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">low</code> is considered the lowest label
	    setting an object or subject may have.  Setting this on
	    objects or subjects blocks their access to objects or
	    subjects marked high.</p></li><li class="listitem"><p><code class="literal">equal</code> sets the subject or object to
	    be disabled or unaffected and should only be placed on
	    objects considered to be exempt from the policy.</p></li><li class="listitem"><p><code class="literal">high</code> grants an object or subject
	    the highest setting available in the Biba and
	    <acronym class="acronym">MLS</acronym> policy modules.</p></li></ul></div><p>Such policy modules include <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a>,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_mls&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_mls</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_lomac&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_lomac</span>(4)</span></a>.  Each of the predefined
	labels establishes a different information flow directive.
	Refer to the manual page of the module to determine the traits
	of the generic label configurations.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59000184"></a>15.3.3. Numeric Labels</h3></div></div></div><p>The Biba and <acronym class="acronym">MLS</acronym> policy modules support
	a numeric label which may be set to indicate the precise level
	of hierarchical control.  This numeric level is used to
	partition or sort information into different groups of
	classification, only permitting access to that group or a
	higher group level.  For example:</p><pre class="programlisting">biba/10:2+3+6(5:2+3-20:2+3+4+5+6)</pre><p>may be interpreted as <span class="quote">&#8220;<span class="quote">Biba Policy Label/Grade
	  10:Compartments 2, 3 and 6: (grade 5 ...</span>&#8221;</span>)</p><p>In this example, the first grade would be considered the
	effective grade with effective compartments, the second grade
	is the low grade, and the last one is the high grade.  In most
	configurations, such fine-grained settings are not needed as
	they are considered to be advanced configurations.</p><p>System objects only have a current grade and compartment.
	System subjects reflect the range of available rights in the
	system, and network interfaces, where they are used for access
	control.</p><p>The grade and compartments in a subject and object pair
	are used to construct a relationship known as
	<em class="firstterm">dominance</em>, in which a subject dominates
	an object, the object dominates the subject, neither dominates
	the other, or both dominate each other.  The <span class="quote">&#8220;<span class="quote">both
	  dominate</span>&#8221;</span> case occurs when the two labels are equal.
	Due to the information flow nature of Biba, a user has rights
	to a set of compartments that might correspond to projects,
	but objects also have a set of compartments.  Users may have
	to subset their rights using <code class="command">su</code> or
	<code class="command">setpmac</code> in order to access objects in a
	compartment from which they are not restricted.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59009656"></a>15.3.4. User Labels</h3></div></div></div><p>Users are required to have labels so that their files and
	processes properly interact with the security policy defined
	on the system.  This is configured in
	<code class="filename">/etc/login.conf</code> using login classes.
	Every policy module that uses labels will implement the user
	class setting.</p><p>To set the user class default label which will be enforced
	by <acronym class="acronym">MAC</acronym>, add a <code class="option">label</code> entry.
	An example <code class="option">label</code> entry containing every
	policy module is displayed below.  Note that in a real
	configuration, the administrator would never enable every
	policy module.  It is recommended that the rest of this
	chapter be reviewed before any configuration is
	implemented.</p><pre class="programlisting">default:\
	:copyright=/etc/COPYRIGHT:\
	:welcome=/etc/motd:\
	:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
	:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:\
	:manpath=/usr/share/man /usr/local/man:\
	:nologin=/usr/sbin/nologin:\
	:cputime=1h30m:\
	:datasize=8M:\
	:vmemoryuse=100M:\
	:stacksize=2M:\
	:memorylocked=4M:\
	:memoryuse=8M:\
	:filesize=8M:\
	:coredumpsize=8M:\
	:openfiles=24:\
	:maxproc=32:\
	:priority=0:\
	:requirehome:\
	:passwordtime=91d:\
	:umask=022:\
	:ignoretime@:\
	:label=partition/13,mls/5,biba/10(5-15),lomac/10[2]:</pre><p>While users can not modify the default value, they may
	change their label after they login, subject to the
	constraints of the policy.  The example above tells the Biba
	policy that a process's minimum integrity is
	<code class="literal">5</code>, its maximum is <code class="literal">15</code>,
	and the default effective label is <code class="literal">10</code>.  The
	process will run at <code class="literal">10</code> until it chooses to
	change label, perhaps due to the user using
	<code class="command">setpmac</code>, which will be constrained by Biba
	to the configured range.</p><p>After any change to <code class="filename">login.conf</code>, the
	login class capability database must be rebuilt using
	<code class="command">cap_mkdb</code>.</p><p>Many sites have a large number of users requiring
	several different user classes.  In depth planning is
	required as this can become difficult to manage.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59016952"></a>15.3.5. Network Interface Labels</h3></div></div></div><p>Labels may be set on network interfaces to help control
	the flow of data across the network.  Policies using network
	interface labels function in the same way that policies
	function with respect to objects.  Users at high settings in
	Biba, for example, will not be permitted to access network
	interfaces with a label of <code class="literal">low</code>.</p><p>When setting the <acronym class="acronym">MAC</acronym> label on network
	interfaces, <code class="option">maclabel</code> may be passed to
	<code class="command">ifconfig</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bge0 maclabel biba/equal</code></strong></pre><p>This example will set the <acronym class="acronym">MAC</acronym> label of
	<code class="literal">biba/equal</code> on the <code class="literal">bge0</code>
	interface.  When using a setting similar to
	<code class="literal">biba/high(low-high)</code>, the entire label
	should be quoted to prevent an error from being
	returned.</p><p>Each policy module which supports labeling has a tunable
	which may be used to disable the <acronym class="acronym">MAC</acronym> label
	on network interfaces.  Setting the label to
	<code class="option">equal</code> will have a similar effect.  Review
	the output of <code class="command">sysctl</code>, the policy manual
	pages, and the information in the rest of this chapter for
	more information on those tunables.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-planning"></a>15.4. Planning the Security Configuration</h2></div></div></div><p>Before implementing any <acronym class="acronym">MAC</acronym> policies, a
      planning phase is recommended.  During the planning stages, an
      administrator should consider the implementation requirements
      and goals, such as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to classify information and resources available on
	  the target systems.</p></li><li class="listitem"><p>Which information or resources to restrict access to
	  along with the type of restrictions that should be
	  applied.</p></li><li class="listitem"><p>Which <acronym class="acronym">MAC</acronym> modules will be required to
	  achieve this goal.</p></li></ul></div><p>A trial run of the trusted system and its configuration
      should occur <span class="emphasis"><em>before</em></span> a
      <acronym class="acronym">MAC</acronym> implementation is used on production
      systems.  Since different environments have different needs and
      requirements, establishing a complete security profile will
      decrease the need of changes once the system goes live.</p><p>Consider how the <acronym class="acronym">MAC</acronym> framework augments
      the security of the system as a whole.  The various security
      policy modules provided by the <acronym class="acronym">MAC</acronym> framework
      could be used to protect the network and file systems or to
      block users from accessing certain ports and sockets.  Perhaps
      the best use of the policy modules is to load several security
      policy modules at a time in order to provide a
      <acronym class="acronym">MLS</acronym> environment.  This approach differs from
      a hardening policy, which typically hardens elements of a system
      which are used only for specific purposes.  The downside to
      <acronym class="acronym">MLS</acronym> is increased administrative
      overhead.</p><p>The overhead is minimal when compared to the lasting effect
      of a framework which provides the ability to pick and choose
      which policies are required for a specific configuration and
      which keeps performance overhead down.  The reduction of support
      for unneeded policies can increase the overall performance of
      the system as well as offer flexibility of choice.  A good
      implementation would consider the overall security requirements
      and effectively implement the various security policy modules
      offered by the framework.</p><p>A system utilizing <acronym class="acronym">MAC</acronym> guarantees that a
      user will not be permitted to change security attributes at
      will.  All user utilities, programs, and scripts must work
      within the constraints of the access rules provided by the
      selected security policy modules and control of the
      <acronym class="acronym">MAC</acronym> access rules is in the hands of the
      system administrator.</p><p>It is the duty of the system administrator to carefully
      select the correct security policy modules.  For an environment
      that needs to limit access control over the network, the
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_ifoff&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_ifoff</span>(4)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a>
      policy modules make good starting points.  For an environment
      where strict confidentiality of file system objects is required,
      consider the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_mls&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_mls</span>(4)</span></a> policy
      modules.</p><p>Policy decisions could be made based on network
      configuration.  If only certain users should be permitted
      access to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a> policy module is
      a good choice.  In the case of file systems, access to objects
      might be considered confidential to some users, but not to
      others.  As an example, a large development team might be
      broken off into smaller projects where  developers in project A
      might not be permitted to access objects written by developers
      in project B.  Yet both projects might need to access objects
      created by developers in project C.  Using the different
      security policy modules provided by the <acronym class="acronym">MAC</acronym>
      framework, users could be divided into these groups and then
      given access to the appropriate objects.</p><p>Each security policy module has a unique way of dealing with
      the overall security of a system.  Module selection should be
      based on a well thought out security policy which may require
      revision and reimplementation.  Understanding the different
      security policy modules offered by the <acronym class="acronym">MAC</acronym>
      framework will help administrators choose the best policies
      for their situations.</p><p>  The rest of this chapter covers the available modules,
      describes their use and configuration, and in some cases,
      provides insight on applicable situations.</p><div xmlns="" class="caution"><h3 class="admontitle">Caution: </h3><p xmlns="http://www.w3.org/1999/xhtml">Implementing <acronym class="acronym">MAC</acronym> is much like
	implementing a firewall since care must be taken to prevent
	being completely locked out of the system.  The ability to
	revert back to a previous configuration should be considered
	and the implementation of <acronym class="acronym">MAC</acronym> over a remote
	connection should be done with extreme caution.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-policies"></a>15.5. Available MAC Policies</h2></div></div></div><p>The default FreeBSD kernel
      includes <code class="literal">options MAC</code>.  This means that every
      module included with the <acronym class="acronym">MAC</acronym> framework can be
      loaded with <code class="command">kldload</code> as a run-time kernel
      module.  After testing the module, add the module name to
      <code class="filename">/boot/loader.conf</code> so that it will load
      during boot.  Each module also provides a kernel option for
      those administrators who choose to compile their own custom
      kernel.</p><p>FreeBSD includes a group of policies that will cover most
      security requirements.  Each policy is summarized below.  The
      last three policies support integer settings in place of the
      three default labels.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-seeotheruids"></a>15.5.1. The MAC See Other UIDs Policy</h3></div></div></div><a id="idp59071992" class="indexterm"></a><p>Module name:
	<code class="filename">mac_seeotheruids.ko</code></p><p>Kernel configuration line:
	<code class="literal">options MAC_SEEOTHERUIDS</code></p><p>Boot option:
	<code class="literal">mac_seeotheruids_load="YES"</code></p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_seeotheruids&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_seeotheruids</span>(4)</span></a> module extends the
	<code class="varname">security.bsd.see_other_uids</code> and
	<code class="varname">security.bsd.see_other_gids</code>
	<code class="command">sysctl</code> tunables.  This option does not
	require any labels to be set before configuration and can
	operate transparently with other modules.</p><p>After loading the module, the following
	<code class="command">sysctl</code> tunables may be used to control its
	features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">security.mac.seeotheruids.enabled</code>
	    enables the module and implements the default settings
	    which deny users the ability to view processes and sockets
	    owned by other users.</p></li><li class="listitem"><p>
	    <code class="varname">security.mac.seeotheruids.specificgid_enabled</code>
	    allows specified groups to be exempt from this policy.  To
	    exempt specific groups, use the
	    <code class="varname">security.mac.seeotheruids.specificgid=<em class="replaceable"><code>XXX</code></em></code>
	    <code class="command">sysctl</code> tunable, replacing
	    <em class="replaceable"><code>XXX</code></em> with the numeric group ID
	    to be exempted.</p></li><li class="listitem"><p>
	    <code class="varname">security.mac.seeotheruids.primarygroup_enabled</code>
	    is used to exempt specific primary groups from this
	    policy.  When using this tunable,
	    <code class="varname">security.mac.seeotheruids.specificgid_enabled</code>
	    may not be set.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-bsdextended"></a>15.5.2. The MAC BSD Extended Policy</h3></div></div></div><a id="idp59100536" class="indexterm"></a><p>Module name:
	<code class="filename">mac_bsdextended.ko</code></p><p>Kernel configuration line:
	<code class="literal">options MAC_BSDEXTENDED</code></p><p>Boot option:
	<code class="literal">mac_bsdextended_load="YES"</code></p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a> module enforces a file system
	firewall.  It provides an extension to the standard file
	system permissions model, permitting an administrator to
	create a firewall-like ruleset to protect files, utilities,
	and directories in the file system hierarchy.  When access to
	a file system object is attempted, the list of rules is
	iterated until either a matching rule is located or the end is
	reached.  This behavior may be changed using
	<code class="varname">security.mac.bsdextended.firstmatch_enabled</code>.
	Similar to other firewall modules in FreeBSD, a file containing
	the access control rules can be created and read by the system
	at boot time using an <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> variable.</p><p>The rule list may be entered using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ugidfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ugidfw</span>(8)</span></a> which
	has a syntax similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>.  More tools can be
	written by using the functions in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=libugidfw&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">libugidfw</span>(3)</span></a>
	library.</p><p>After the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a> module has been loaded,
	the following command may be used to list the current rule
	configuration:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ugidfw list</code></strong>
0 slots, 0 rules</pre><p>By default, no rules are defined and everything is
	completely accessible.  To create a rule which blocks all
	access by users but leaves <code class="systemitem">root</code> unaffected:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ugidfw add subject not uid root new object not uid root mode n</code></strong></pre><p>While this rule is simple to implement, it is a very bad
	idea as it blocks all users from issuing any commands.  A
	more realistic example blocks <code class="systemitem">user1</code> all access, including
	directory listings, to <code class="systemitem"><em class="replaceable"><code>user2</code></em></code>'s
	home directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ugidfw set 2 subject uid <em class="replaceable"><code>user1</code></em> object uid <em class="replaceable"><code>user2</code></em> mode n</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ugidfw set 3 subject uid <em class="replaceable"><code>user1</code></em> object gid <em class="replaceable"><code>user2</code></em> mode n</code></strong></pre><p>Instead of <code class="systemitem">user1</code>, <code class="option">not
	  uid <em class="replaceable"><code>user2</code></em></code> could be used
	in order to enforce the same access restrictions for all
	users.  However, the <code class="systemitem">root</code> user is unaffected by
	these rules.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Extreme caution should be taken when working with this
	  module as incorrect use could block access to certain
	  parts of the file system.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-ifoff"></a>15.5.3. The MAC Interface Silencing Policy</h3></div></div></div><a id="idp59137400" class="indexterm"></a><p>Module name: <code class="filename">mac_ifoff.ko</code></p><p>Kernel configuration line: <code class="literal">options
	  MAC_IFOFF</code></p><p>Boot option:
	<code class="literal">mac_ifoff_load="YES"</code></p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_ifoff&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_ifoff</span>(4)</span></a> module is used to disable network
	interfaces on the fly and to keep network interfaces from
	being brought up during system boot.  It does not use labels
	and does not depend on any other
	<acronym class="acronym">MAC</acronym> modules.</p><p>Most of this module's control is performed through these
	<code class="command">sysctl</code> tunables:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">security.mac.ifoff.lo_enabled</code>
	    enables or disables all traffic on the loopback,
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lo&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lo</span>(4)</span></a>, interface.</p></li><li class="listitem"><p><code class="varname">security.mac.ifoff.bpfrecv_enabled</code>
	    enables or disables all traffic on the Berkeley Packet
	    Filter interface, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a>.</p></li><li class="listitem"><p><code class="varname">security.mac.ifoff.other_enabled</code>
	    enables or disables traffic on all other
	    interfaces.</p></li></ul></div><p>One of the most common uses of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_ifoff&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_ifoff</span>(4)</span></a> is
	network monitoring in an environment where network traffic
	should not be permitted during the boot sequence.  Another
	use would be to write a script which uses an application such
	as <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/aide/pkg-descr">security/aide</a> to automatically block
	network traffic if it finds new or altered files in protected
	directories.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-portacl"></a>15.5.4. The MAC Port Access Control List Policy</h3></div></div></div><a id="idp59149816" class="indexterm"></a><p>Module name: <code class="filename">mac_portacl.ko</code></p><p>Kernel configuration line:
	<code class="literal">MAC_PORTACL</code></p><p>Boot option:
	<code class="literal">mac_portacl_load="YES"</code></p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a> module is used to limit binding to
	local <acronym class="acronym">TCP</acronym> and <acronym class="acronym">UDP</acronym> ports,
	making it possible to allow non-<code class="systemitem">root</code> users to bind to
	specified privileged ports below 1024.</p><p>Once loaded, this module enables the
	<acronym class="acronym">MAC</acronym> policy on all sockets.  The following
	tunables are available:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">security.mac.portacl.enabled</code>
	    enables or disables the policy completely.</p></li><li class="listitem"><p><code class="varname">security.mac.portacl.port_high</code>
	    sets the highest port number that <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a>
	    protects.</p></li><li class="listitem"><p><code class="varname">security.mac.portacl.suser_exempt</code>,
	    when set to a non-zero value, exempts the <code class="systemitem">root</code> user from this
	    policy.</p></li><li class="listitem"><p><code class="varname">security.mac.portacl.rules</code>
	    specifies the policy as a text string of the form
	    <code class="literal">rule[,rule,...]</code>, with as many rules as
	    needed, and where each rule is of the form
	    <code class="literal">idtype:id:protocol:port</code>.  The
	    <em class="parameter"><code>idtype</code></em> is either
	    <code class="literal">uid</code> or <code class="literal">gid</code>.  The
	    <em class="parameter"><code>protocol</code></em> parameter can be
	    <code class="literal">tcp</code> or <code class="literal">udp</code>.  The
	    <em class="parameter"><code>port</code></em> parameter is the port number
	    to allow the specified user or group to bind to.  Only
	    numeric values can be used for the user ID, group ID,
	    and port parameters.</p></li></ul></div><p>By default, ports below 1024 can only be used by
	privileged processes which run as <code class="systemitem">root</code>.  For <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a>
	to allow non-privileged processes to bind to ports below 1024,
	set the following tunables as
	follows:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.port_high=1023</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet.ip.portrange.reservedlow=0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet.ip.portrange.reservedhigh=0</code></strong></pre><p>To prevent the <code class="systemitem">root</code> user from being affected
	by this policy, set
	<code class="varname">security.mac.portacl.suser_exempt</code> to a
	non-zero value.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.suser_exempt=1</code></strong></pre><p>To allow the <code class="systemitem">www</code>
	user with <acronym class="acronym">UID</acronym> 80 to bind to port 80
	without ever needing <code class="systemitem">root</code> privilege:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.rules=uid:80:tcp:80</code></strong></pre><p>This next example permits the user with the
	<acronym class="acronym">UID</acronym> of 1001 to bind to
	<acronym class="acronym">TCP</acronym> ports 110 (POP3) and 995
	(POP3s):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.rules=uid:1001:tcp:110,uid:1001:tcp:995</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-partition"></a>15.5.5. The MAC Partition Policy</h3></div></div></div><a id="idp59193208" class="indexterm"></a><p>Module name: <code class="filename">mac_partition.ko</code></p><p>Kernel configuration line:
	<code class="literal">options MAC_PARTITION</code></p><p>Boot option:
	<code class="literal">mac_partition_load="YES"</code></p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_partition&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_partition</span>(4)</span></a> policy drops processes into
	specific <span class="quote">&#8220;<span class="quote">partitions</span>&#8221;</span> based on their
	<acronym class="acronym">MAC</acronym> label.  Most configuration for this
	policy is done using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setpmac&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setpmac</span>(8)</span></a>.  One
	<code class="command">sysctl</code> tunable is available for this
	policy:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">security.mac.partition.enabled</code>
	    enables the enforcement of <acronym class="acronym">MAC</acronym> process
	    partitions.</p></li></ul></div><p>When this policy is enabled, users will only be permitted
	to see their processes, and any others within their partition,
	but will not be permitted to work with utilities outside the
	scope of this partition.  For instance, a user in the
	<code class="literal">insecure</code> class will not be permitted to
	access <code class="command">top</code> as well as many other commands
	that must spawn a process.</p><p>This example adds <code class="command">top</code> to the label set
	on users in the <code class="literal">insecure</code> class.  All
	processes spawned by users in the <code class="literal">insecure</code>
	class will stay in the <code class="literal">partition/13</code>
	label.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setpmac partition/13 top</code></strong></pre><p>This command displays the partition label and the process
	list:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ps Zax</code></strong></pre><p>This command displays another user's process partition
	label and that user's currently running processes:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ps -ZU trhodes</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Users can see processes in <code class="systemitem">root</code>'s label unless the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_seeotheruids&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_seeotheruids</span>(4)</span></a> policy is loaded.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-mls"></a>15.5.6. The MAC Multi-Level Security Module</h3></div></div></div><a id="idp59226616" class="indexterm"></a><p>Module name: <code class="filename">mac_mls.ko</code></p><p>Kernel configuration line:
	<code class="literal">options MAC_MLS</code></p><p>Boot option: <code class="literal">mac_mls_load="YES"</code></p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_mls&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_mls</span>(4)</span></a> policy controls access between
	subjects and objects in the system by enforcing a strict
	information flow policy.</p><p>In <acronym class="acronym">MLS</acronym> environments, a
	<span class="quote">&#8220;<span class="quote">clearance</span>&#8221;</span> level is set in the label of each
	subject or object, along with compartments.  Since these
	clearance levels can reach numbers greater than several
	thousand, it would be a daunting task to thoroughly configure
	every subject or object.  To ease this administrative
	overhead, three labels are included in this policy:
	<code class="literal">mls/low</code>, <code class="literal">mls/equal</code>, and
	<code class="literal">mls/high</code>, where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Anything labeled with <code class="literal">mls/low</code> will
	    have a low clearance level and not be permitted to access
	    information of a higher level.  This label also prevents
	    objects of a higher clearance level from writing or
	    passing information to a lower level.</p></li><li class="listitem"><p><code class="literal">mls/equal</code> should be placed on
	    objects which should be exempt from the policy.</p></li><li class="listitem"><p><code class="literal">mls/high</code> is the highest level of
	    clearance possible.  Objects assigned this label will hold
	    dominance over all other objects in the system; however,
	    they will not permit the leaking of information to objects
	    of a lower class.</p></li></ul></div><p><acronym class="acronym">MLS</acronym> provides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A hierarchical security level with a set of
	    non-hierarchical categories.</p></li><li class="listitem"><p>Fixed rules of <code class="literal">no read up, no write
	      down</code>.  This means that a subject can have read
	    access to objects on its own level or below, but not
	    above.  Similarly, a subject can have write access to
	    objects on its own level or above, but not beneath.</p></li><li class="listitem"><p>Secrecy, or the prevention of inappropriate disclosure
	    of data.</p></li><li class="listitem"><p>A basis for the design of systems that concurrently
	    handle data at multiple sensitivity levels without leaking
	    information between secret and confidential.</p></li></ul></div><p>The following <code class="command">sysctl</code> tunables are
	available:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">security.mac.mls.enabled</code> is used to
	    enable or disable the <acronym class="acronym">MLS</acronym>
	    policy.</p></li><li class="listitem"><p><code class="varname">security.mac.mls.ptys_equal</code>
	    labels all <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pty&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pty</span>(4)</span></a> devices as
	    <code class="literal">mls/equal</code> during creation.</p></li><li class="listitem"><p><code class="varname">security.mac.mls.revocation_enabled</code>
	    revokes access to objects after their label changes to a
	    label of a lower grade.</p></li><li class="listitem"><p><code class="varname">security.mac.mls.max_compartments</code>
	    sets the maximum number of compartment levels allowed on a
	    system.</p></li></ul></div><p>To manipulate <acronym class="acronym">MLS</acronym> labels, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setfmac&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setfmac</span>(8)</span></a>.  To assign a label to an object:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfmac mls/5 test</code></strong></pre><p>To get the <acronym class="acronym">MLS</acronym> label for the file
	<code class="filename">test</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>getfmac test</code></strong></pre><p>Another approach is to create a master policy file in
	<code class="filename">/etc/</code> which specifies the
	<acronym class="acronym">MLS</acronym> policy information and to feed that
	file to <code class="command">setfmac</code>.</p><p>When using the <acronym class="acronym">MLS</acronym> policy module, an
	administrator plans to control the flow of sensitive
	information.  The default <code class="literal">block read up block write
	  down</code> sets everything to a low state.  Everything
	is accessible and an administrator slowly augments the
	confidentiality of the information.</p><p>Beyond the three basic label options, an administrator
	may group users and groups as required to block the
	information flow between them.  It might be easier to look at
	the information in clearance levels using descriptive words,
	such as classifications of <code class="literal">Confidential</code>,
	<code class="literal">Secret</code>, and <code class="literal">Top Secret</code>.
	Some administrators instead create different groups based on
	project levels.  Regardless of the classification method, a
	well thought out plan must exist before implementing a
	restrictive policy.</p><p>Some example situations for the <acronym class="acronym">MLS</acronym>
	policy module include an e-commerce web server, a file server
	holding critical company information, and financial
	institution environments.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-biba"></a>15.5.7. The MAC Biba Module</h3></div></div></div><a id="idp59303160" class="indexterm"></a><p>Module name: <code class="filename">mac_biba.ko</code></p><p>Kernel configuration line: <code class="literal">options
	  MAC_BIBA</code></p><p>Boot option: <code class="literal">mac_biba_load="YES"</code></p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a> module loads the
	<acronym class="acronym">MAC</acronym> Biba policy.  This policy is similar to
	the <acronym class="acronym">MLS</acronym> policy with the exception that the
	rules for information flow are slightly reversed.  This is to
	prevent the downward flow of sensitive information whereas the
	<acronym class="acronym">MLS</acronym> policy prevents the upward flow of
	sensitive information.</p><p>In Biba environments, an <span class="quote">&#8220;<span class="quote">integrity</span>&#8221;</span> label is
	set on each subject or object.  These labels are made up of
	hierarchical grades and non-hierarchical components.  As a
	grade ascends, so does its integrity.</p><p>Supported labels are <code class="literal">biba/low</code>,
	<code class="literal">biba/equal</code>, and
	<code class="literal">biba/high</code>, where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">biba/low</code> is considered the lowest
	    integrity an object or subject may have.  Setting this on
	    objects or subjects blocks their write access to objects
	    or subjects marked as <code class="literal">biba/high</code>, but
	    will not prevent read access.</p></li><li class="listitem"><p><code class="literal">biba/equal</code> should only be placed on
	    objects considered to be exempt from the policy.</p></li><li class="listitem"><p><code class="literal">biba/high</code> permits writing to
	    objects set at a lower label, but does not permit reading
	    that object.  It is recommended that this label be
	    placed on objects that affect the integrity of the entire
	    system.</p></li></ul></div><p>Biba provides:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Hierarchical integrity levels with a set of
	    non-hierarchical integrity categories.</p></li><li class="listitem"><p>Fixed rules are <code class="literal">no write up, no read
	      down</code>, the opposite of
	    <acronym class="acronym">MLS</acronym>.  A subject can have write access
	    to objects on its own level or below, but not above.
	    Similarly, a subject can have read access to objects on
	    its own level or above, but not below.</p></li><li class="listitem"><p>Integrity by preventing inappropriate modification of
	    data.</p></li><li class="listitem"><p>Integrity levels instead of <acronym class="acronym">MLS</acronym>
	    sensitivity levels.</p></li></ul></div><p>The following tunables can be used to manipulate the Biba
	policy:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">security.mac.biba.enabled</code> is used
	    to enable or disable enforcement of the Biba policy on the
	    target machine.</p></li><li class="listitem"><p><code class="varname">security.mac.biba.ptys_equal</code> is
	    used to disable the Biba policy on <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pty&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pty</span>(4)</span></a>
	    devices.</p></li><li class="listitem"><p><code class="varname">security.mac.biba.revocation_enabled</code>
	    forces the revocation of access to objects if the label is
	    changed to dominate the subject.</p></li></ul></div><p>To access the Biba policy setting on system objects, use
	<code class="command">setfmac</code> and
	<code class="command">getfmac</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfmac biba/low test</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>getfmac test</code></strong>
test: biba/low</pre><p>Integrity, which is different from sensitivity, is used to
	guarantee that information is not manipulated by untrusted
	parties.  This includes information passed between subjects
	and objects.  It ensures that users will only be able to
	modify or access information they have been given explicit
	access to.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a> security policy module
	permits an administrator to configure which files and programs
	a user may see and invoke while assuring that the programs and
	files are trusted by the system for that user.</p><p>During the initial planning phase, an administrator must
	be prepared to partition users into grades, levels, and areas.
	The system will default to a high label once this policy
	module is enabled, and it is up to the administrator to
	configure the different grades and levels for users.  Instead
	of using clearance levels, a good planning method could
	include topics.  For instance, only allow developers
	modification access to the source code repository, source
	code compiler, and other development utilities.  Other users
	would be grouped into other categories such as testers,
	designers, or end users and would only be permitted read
	access.</p><p>A lower integrity subject is unable to write to a higher
	integrity subject and a higher integrity subject cannot list
	or read a lower integrity object.  Setting a label at the
	lowest possible grade could make it inaccessible to subjects.
	Some prospective environments for this security policy module
	would include a constrained web server, a development and test
	machine, and a source code repository.  A less useful
	implementation would be a personal workstation, a machine used
	as a router, or a network firewall.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-lomac"></a>15.5.8. The MAC Low-watermark Module</h3></div></div></div><a id="idp59083896" class="indexterm"></a><p>Module name: <code class="filename">mac_lomac.ko</code></p><p>Kernel configuration line: <code class="literal">options
	  MAC_LOMAC</code></p><p>Boot option:
	<code class="literal">mac_lomac_load="YES"</code></p><p>Unlike the <acronym class="acronym">MAC</acronym> Biba policy, the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_lomac&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_lomac</span>(4)</span></a> policy permits access to lower integrity
	objects only after decreasing the integrity level to not
	disrupt any integrity rules.</p><p>The Low-watermark integrity policy works almost
	identically to Biba, with the exception of using floating
	labels to support subject demotion via an auxiliary grade
	compartment.  This secondary compartment takes the form
	<code class="literal">[auxgrade]</code>.  When assigning a policy with
	an auxiliary grade, use the syntax
	<code class="literal">lomac/10[2]</code>, where
	<code class="literal">2</code> is the auxiliary grade.</p><p>This policy relies on the ubiquitous labeling of all
	system objects with integrity labels, permitting subjects to
	read from low integrity objects and then downgrading the label
	on the subject to prevent future writes to high integrity
	objects using <code class="literal">[auxgrade]</code>.  The policy may
	provide greater compatibility and require less initial
	configuration than Biba.</p><p>Like the Biba and <acronym class="acronym">MLS</acronym> policies,
	<code class="command">setfmac</code> and <code class="command">setpmac</code>
	are used to place labels on system objects:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfmac /usr/home/trhodes lomac/high[low]</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>getfmac /usr/home/trhodes lomac/high[low]</code></strong></pre><p>The auxiliary grade <code class="literal">low</code> is a feature
	provided only by the <acronym class="acronym">MAC</acronym>
	<acronym class="acronym">LOMAC</acronym> policy.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-userlocked"></a>15.6. User Lock Down</h2></div></div></div><p>This example considers a relatively small storage system
      with fewer than fifty users.  Users will have login
      capabilities and are permitted to store data and access
      resources.</p><p>For this scenario, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a> and
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_seeotheruids&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_seeotheruids</span>(4)</span></a> policy modules could co-exist and block
      access to system objects while hiding user processes.</p><p>Begin by adding the following line to
      <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">mac_seeotheruids_load="YES"</pre><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a> security policy module may be
      activated by adding this line to
      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ugidfw_enable="YES"</pre><p>Default rules stored in
      <code class="filename">/etc/rc.bsdextended</code> will be loaded at
      system initialization.  However, the default entries may need
      modification.  Since this machine is expected only to service
      users, everything may be left commented out except the last
      two lines in order to force the loading of user owned system
      objects by default.</p><p>Add the required users to this machine and reboot.  For
      testing purposes, try logging in as a different user across
      two consoles.  Run <code class="command">ps aux</code> to see if processes
      of other users are visible.  Verify that running <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> on
      another user's home directory fails.</p><p>Do not try to test with the <code class="systemitem">root</code> user unless the specific
      <code class="command">sysctl</code>s have been modified to block super
      user access.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">When a new user is added, their <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_bsdextended&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_bsdextended</span>(4)</span></a>
	rule will not be in the ruleset list.  To update the ruleset
	quickly, unload the security policy module and reload it again
	using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldunload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldunload</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-implementing"></a>15.7. Nagios in a MAC Jail</h2></div></div></div><a id="idp59383544" class="indexterm"></a><p>This section demonstrates the steps that are needed to
      implement the <span class="application">Nagios</span> network
      monitoring system in a <acronym class="acronym">MAC</acronym> environment.  This
      is meant as an example which still requires the administrator to
      test that the implemented policy meets the security requirements
      of the network before using in a production environment.</p><p>This example requires <code class="option">multilabel</code> to be set
      on each file system.  It also assumes that
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/nagios-plugins/pkg-descr">net-mgmt/nagios-plugins</a>,
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/nagios/pkg-descr">net-mgmt/nagios</a>, and
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/apache22/pkg-descr">www/apache22</a> are all installed, configured,
      and working correctly before attempting the integration into the
      <acronym class="acronym">MAC</acronym> framework.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59387768"></a>15.7.1. Create an Insecure User Class</h3></div></div></div><p>Begin the procedure by adding the following user class
	to <code class="filename">/etc/login.conf</code>:</p><pre class="programlisting">insecure:\
:copyright=/etc/COPYRIGHT:\
:welcome=/etc/motd:\
:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin
:manpath=/usr/share/man /usr/local/man:\
:nologin=/usr/sbin/nologin:\
:cputime=1h30m:\
:datasize=8M:\
:vmemoryuse=100M:\
:stacksize=2M:\
:memorylocked=4M:\
:memoryuse=8M:\
:filesize=8M:\
:coredumpsize=8M:\
:openfiles=24:\
:maxproc=32:\
:priority=0:\
:requirehome:\
:passwordtime=91d:\
:umask=022:\
:ignoretime@:\
:label=biba/10(10-10):</pre><p>Then, add the following line to the default user class
	section:</p><pre class="programlisting">:label=biba/high:</pre><p>Save the edits and issue the following command to rebuild
	the database:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59395832"></a>15.7.2. Configure Users</h3></div></div></div><p>Set the <code class="systemitem">root</code>
	user to the default class using:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw usermod root -L default</code></strong></pre><p>All user accounts that are not <code class="systemitem">root</code> will now require a login
	class.  The login class is required, otherwise users will be
	refused access to common commands.  The following
	<code class="command">sh</code> script should do the trick:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>for x in `awk -F: '($3 &gt;= 1001) &amp;&amp; ($3 != 65534) { print $1 }' \</code></strong>
	<strong class="userinput"><code>/etc/passwd`; do pw usermod $x -L default; done;</code></strong></pre><p>Next, drop the <code class="systemitem">nagios</code> and <code class="systemitem">www</code> accounts into the insecure
	class:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw usermod nagios -L insecure</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pw usermod www -L insecure</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59416312"></a>15.7.3. Create the Contexts File</h3></div></div></div><p>A contexts file should now be created as
	  <code class="filename">/etc/policy.contexts</code>:</p><pre class="programlisting"># This is the default BIBA policy for this system.

# System:
/var/run(/.*)?			biba/equal

/dev/(/.*)?			biba/equal

/var				biba/equal
/var/spool(/.*)?		biba/equal

/var/log(/.*)?			biba/equal

/tmp(/.*)?			biba/equal
/var/tmp(/.*)?			biba/equal

/var/spool/mqueue		biba/equal
/var/spool/clientmqueue		biba/equal

# For Nagios:
/usr/local/etc/nagios(/.*)?	biba/10

/var/spool/nagios(/.*)?		biba/10

# For apache
/usr/local/etc/apache(/.*)?	biba/10</pre><p>This policy enforces security by setting restrictions on
	the flow of information.  In this specific configuration,
	users, including <code class="systemitem">root</code>, should never be
	allowed to access <span class="application">Nagios</span>.
	Configuration files and processes that are a part of
	<span class="application">Nagios</span> will be completely self
	contained or jailed.</p><p>This file will be read after running
	<code class="command">setfsmac</code> on every file system.  This
	example sets the policy on the root file system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfsmac -ef /etc/policy.contexts /</code></strong></pre><p>Next, add these edits to the main section of
	<code class="filename">/etc/mac.conf</code>:</p><pre class="programlisting">default_labels file ?biba
default_labels ifnet ?biba
default_labels process ?biba
default_labels socket ?biba</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59422712"></a>15.7.4. Loader Configuration</h3></div></div></div><p>To finish the configuration, add the following lines to
	<code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">mac_biba_load="YES"
mac_seeotheruids_load="YES"
security.mac.biba.trust_all_interfaces=1</pre><p>And the following line to the network card configuration
	stored in <code class="filename">/etc/rc.conf</code>.  If the primary
	network configuration is done via <acronym class="acronym">DHCP</acronym>,
	this may need to be configured manually after every system
	boot:</p><pre class="programlisting">maclabel biba/equal</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59426168"></a>15.7.5. Testing the Configuration</h3></div></div></div><a id="idp59426808" class="indexterm"></a><p>First, ensure that the web server and
	<span class="application">Nagios</span> will not be started on
	system initialization and reboot.  Ensure that <code class="systemitem">root</code> cannot access any of the
	files in the <span class="application">Nagios</span> configuration
	directory.  If <code class="systemitem">root</code>
	can list the contents of
	<code class="filename">/var/spool/nagios</code>, something is wrong.
	Instead, a <span class="quote">&#8220;<span class="quote">permission denied</span>&#8221;</span> error should be
	returned.</p><p>If all seems well, <span class="application">Nagios</span>,
	<span class="application">Apache</span>, and
	<span class="application">Sendmail</span> can now be started:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /etc/mail &amp;&amp; make stop &amp;&amp; \
setpmac biba/equal make start &amp;&amp; setpmac biba/10\(10-10\) apachectl start &amp;&amp; \
setpmac biba/10\(10-10\) /usr/local/etc/rc.d/nagios.sh forcestart</code></strong></pre><p>Double check to ensure that everything is working
	properly.  If not, check the log files for error messages.  If
	needed, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> to disable the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a>
	security policy module and try starting everything again as
	usual.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <code class="systemitem">root</code> user
	  can still change the security enforcement and edit its
	  configuration files.  The following command will permit the
	  degradation of the security policy to a lower grade for a
	  newly spawned shell:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setpmac biba/10 csh</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">To block this from happening, force the user into a
	  range using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>.  If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=setpmac&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">setpmac</span>(8)</span></a> attempts
	  to run a command outside of the compartment's range, an
	  error will be returned and the command will not be executed.
	  In this case, set root to
	  <code class="literal">biba/high(high-high)</code>.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-troubleshoot"></a>15.8. Troubleshooting the MAC Framework</h2></div></div></div><a id="idp59444600" class="indexterm"></a><p>This section discusses common configuration errors and how
      to resolve them.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">The <code class="option">multilabel</code> flag does not stay
	  enabled on the root (<code class="filename">/</code>)
	  partition:</span></dt><dd><p>The following steps may resolve this transient
	    error:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Edit <code class="filename">/etc/fstab</code> and set the
		root partition to <code class="option">ro</code> for
		read-only.</p></li><li class="step"><p>Reboot into single user mode.</p></li><li class="step"><p>Run <code class="command">tunefs</code> <code class="option">-l
		  enable</code> on <code class="filename">/</code>.</p></li><li class="step"><p>Reboot the system.</p></li><li class="step"><p>Run <code class="command">mount</code> <code class="option">-urw</code>
		<code class="filename">/</code> and change the
		<code class="option">ro</code> back to <code class="option">rw</code> in
		<code class="filename">/etc/fstab</code> and reboot the system
		again.</p></li><li class="step"><p>Double-check the output from
		<code class="command">mount</code> to ensure that
		<code class="option">multilabel</code> has been properly set on
		the root file system.</p></li></ol></div></dd><dt><span class="term">After establishing a secure environment with
	  <acronym class="acronym">MAC</acronym>, <span class="application">Xorg</span> no
	  longer starts:</span></dt><dd><p>This could be caused by the <acronym class="acronym">MAC</acronym>
	    <code class="literal">partition</code> policy or by a mislabeling
	    in one of the <acronym class="acronym">MAC</acronym> labeling policies.
	    To debug, try the following:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Check the error message.  If the user is in the
		<code class="literal">insecure</code> class, the
		<code class="literal">partition</code> policy may be the
		culprit.  Try setting the user's class back to the
		<code class="literal">default</code> class and rebuild the
		database with <code class="command">cap_mkdb</code>.  If this
		does not alleviate the problem, go to step two.</p></li><li class="step"><p>Double-check that the label policies are set
		correctly for the user,
		<span class="application">Xorg</span>, and the
		<code class="filename">/dev</code> entries.</p></li><li class="step"><p>If neither of these resolve the problem, send the
		error message and a description of the environment to
		the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">FreeBSD general questions mailing list</a>.</p></li></ol></div></dd><dt><span class="term">The <span class="errorname">_secure_path: unable to stat
	    .login_conf</span> error appears:</span></dt><dd><p>This error can appear when a user attempts to switch
	    from the <code class="systemitem">root</code>
	    user to another user in the system.  This message
	    usually occurs when the user has a higher label setting
	    than that of the user they are attempting to become.
	    For instance, if <code class="systemitem">joe</code> has a default label
	    of <code class="option">biba/low</code> and <code class="systemitem">root</code> has a label of
	    <code class="option">biba/high</code>, <code class="systemitem">root</code> cannot view
	    <code class="systemitem">joe</code>'s home
	    directory.  This will happen whether or not <code class="systemitem">root</code> has used
	    <code class="command">su</code> to become <code class="systemitem">joe</code> as the Biba
	    integrity model will not permit <code class="systemitem">root</code> to view objects set
	    at a lower integrity level.</p></dd><dt><span class="term">The system no longer recognizes <code class="systemitem">root</code>:</span></dt><dd><p>When this occurs, <code class="command">whoami</code> returns
	    <code class="literal">0</code> and <code class="command">su</code> returns
	    <span class="errorname">who are you?</span>.</p><p>This can happen if a labeling policy has been
	    disabled by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> or the policy module was
	    unloaded.  If the policy is disabled, the login
	    capabilities database needs to be reconfigured.  Double
	    check <code class="filename">/etc/login.conf</code> to ensure
	    that all <code class="option">label</code> options have been
	    removed and rebuild the database with
	    <code class="command">cap_mkdb</code>.</p><p>This may also happen if a policy restricts access to
	    <code class="filename">master.passwd</code>.  This is usually
	    caused by an administrator altering the file under a
	    label which conflicts with the general policy being used
	    by the system.  In these cases, the user information
	    would be read by the system and access would be blocked
	    as the file has inherited the new label.  Disable the
	    policy using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> and everything should return
	    to normal.</p></dd></dl></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit"></a>Chapter 16. Security Event Auditing</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Robert</span> <span class="surname">Watson</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#audit-synopsis">16.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#audit-inline-glossary">16.2. Key Terms</a></span></dt><dt><span class="sect1"><a href="#audit-config">16.3. Audit Configuration</a></span></dt><dt><span class="sect1"><a href="#audit-administration">16.4. Working with Audit Trails</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-synopsis"></a>16.1. Synopsis</h2></div></div></div><a id="idp59529720" class="indexterm"></a><a id="idp59530232" class="indexterm"></a><p>The FreeBSD operating system includes support for security
      event auditing.  Event auditing supports reliable, fine-grained,
      and configurable logging of a variety of security-relevant
      system events, including logins, configuration changes, and file
      and network access.  These log records can be invaluable for
      live system monitoring, intrusion detection, and postmortem
      analysis.  FreeBSD implements <span class="trademark">Sun</span>&#8482;'s published Basic Security
      Module (<acronym class="acronym">BSM</acronym>) Application Programming
      Interface (<acronym class="acronym">API</acronym>) and file format, and is
      interoperable with the <span class="trademark">Solaris</span>&#8482; and <span class="trademark">Mac OS</span>® X audit
      implementations.</p><p>This chapter focuses on the installation and configuration
      of event auditing.  It explains audit policies and provides an
      example audit configuration.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>What event auditing is and how it works.</p></li><li class="listitem"><p>How to configure event auditing on FreeBSD for users and
	  processes.</p></li><li class="listitem"><p>How to review the audit trail using the audit reduction
	  and review tools.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand <span class="trademark">UNIX</span>® and FreeBSD basics
	  (<a class="xref" href="#basics" title="Chapter 3. FreeBSD Basics">Chapter 3, <em>FreeBSD Basics</em></a>).</p></li><li class="listitem"><p>Be familiar with the basics of kernel
	  configuration/compilation (<a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>).</p></li><li class="listitem"><p>Have some familiarity with security and how it pertains
	  to FreeBSD (<a class="xref" href="#security" title="Chapter 13. Security">Chapter 13, <em>Security</em></a>).</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">The audit facility has some known limitations.  Not all
	security-relevant system events are auditable and some login
	mechanisms, such as <span class="application">Xorg</span>-based
	display managers and third-party daemons, do not properly
	configure auditing for user login sessions.</p><p xmlns="http://www.w3.org/1999/xhtml">The security event auditing facility is able to generate
	very detailed logs of system activity.  On a busy system,
	trail file data can be very large when configured for high
	detail, exceeding gigabytes a week in some configurations.
	Administrators should take into account the disk space
	requirements associated with high volume audit configurations.
	For example, it may be desirable to dedicate a file system to
	<code class="filename">/var/audit</code> so that other file systems are
	not affected if the audit file system becomes full.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-inline-glossary"></a>16.2. Key Terms</h2></div></div></div><p>The following terms are related to security event
      auditing:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>event</em></span>: an auditable event is any
	  event that can be logged using the audit subsystem.
	  Examples of security-relevant events include the creation of
	  a file, the building of a network connection, or a user
	  logging in.  Events are either <span class="quote">&#8220;<span class="quote">attributable</span>&#8221;</span>,
	  meaning that they can be traced to an authenticated user, or
	  <span class="quote">&#8220;<span class="quote">non-attributable</span>&#8221;</span>.  Examples of
	  non-attributable events are any events that occur before
	  authentication in the login process, such as bad password
	  attempts.</p></li><li class="listitem"><p><span class="emphasis"><em>class</em></span>: a named set of related
	  events which are used in selection expressions.  Commonly
	  used classes of events include <span class="quote">&#8220;<span class="quote">file creation</span>&#8221;</span>
	  (fc), <span class="quote">&#8220;<span class="quote">exec</span>&#8221;</span> (ex), and
	  <span class="quote">&#8220;<span class="quote">login_logout</span>&#8221;</span> (lo).</p></li><li class="listitem"><p><span class="emphasis"><em>record</em></span>: an audit log entry
	  describing a security event.  Records contain a record
	  event type, information on the subject (user) performing the
	  action, date and time information, information on any
	  objects or arguments, and a success or failure
	  condition.</p></li><li class="listitem"><p><span class="emphasis"><em>trail</em></span>: a log file consisting of a
	  series of audit records describing security events.  Trails
	  are in roughly chronological order with respect to the time
	  events completed.  Only authorized processes are allowed to
	  commit records to the audit trail.</p></li><li class="listitem"><p><span class="emphasis"><em>selection expression</em></span>: a string
	  containing a list of prefixes and audit event class names
	  used to match events.</p></li><li class="listitem"><p><span class="emphasis"><em>preselection</em></span>: the process by which
	  the system identifies which events are of interest to the
	  administrator.  The preselection configuration uses a series
	  of selection expressions to identify which classes of events
	  to audit for which users, as well as global settings that
	  apply to both authenticated and unauthenticated
	  processes.</p></li><li class="listitem"><p><span class="emphasis"><em>reduction</em></span>: the process by which
	  records from existing audit trails are selected for
	  preservation, printing, or analysis.  Likewise, the process
	  by which undesired audit records are removed from the audit
	  trail.  Using reduction, administrators can implement
	  policies for the preservation of audit data.  For example,
	  detailed audit trails might be kept for one month, but after
	  that, trails might be reduced in order to preserve only
	  login information for archival purposes.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-config"></a>16.3. Audit Configuration</h2></div></div></div><p>User space support for event auditing is installed as part
      of the base FreeBSD operating system.  Kernel support is available
      in the <code class="filename">GENERIC</code> kernel by default,
      and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> can be enabled
      by adding the following line to
      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">auditd_enable="YES"</pre><p>Then, start the audit daemon:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service auditd start</code></strong></pre><p>Users who prefer to compile a custom kernel must include the
      following line in their custom kernel configuration file:</p><pre class="programlisting">options	AUDIT</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59568376"></a>16.3.1. Event Selection Expressions</h3></div></div></div><p>Selection expressions are used in a number of places in
	the audit configuration to determine which events should be
	audited.  Expressions contain a list of event classes to
	match.  Selection expressions are evaluated from left to
	right, and two expressions are combined by appending one onto
	the other.</p><p><a class="xref" href="#event-selection" title="Table 16.1. Default Audit Event Classes">Table 16.1, &#8220;Default Audit Event Classes&#8221;</a> summarizes the default
	audit event classes:</p><div class="table"><a id="event-selection"></a><div class="table-title">Table 16.1. Default Audit Event Classes</div><div class="table-contents"><table class="table" summary="Default Audit Event Classes" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Class Name</th><th>Description</th><th>Action</th></tr></thead><tbody><tr><td>all</td><td>all</td><td>Match all event classes.</td></tr><tr><td>aa</td><td>authentication and authorization</td><td> </td></tr><tr><td>ad</td><td>administrative</td><td>Administrative actions performed on the system as
		a whole.</td></tr><tr><td>ap</td><td>application</td><td>Application defined action.</td></tr><tr><td>cl</td><td>file close</td><td>Audit calls to the
		<code class="function">close</code> system call.</td></tr><tr><td>ex</td><td>exec</td><td>Audit program execution.  Auditing of command
		line arguments and environmental variables is
		controlled via <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=audit_control&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">audit_control</span>(5)</span></a> using the
		<code class="literal">argv</code> and <code class="literal">envv</code>
		parameters to the <code class="literal">policy</code>
		setting.</td></tr><tr><td>fa</td><td>file attribute access</td><td>Audit the access of object attributes such as
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=stat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">stat</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pathconf&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pathconf</span>(2)</span></a>.</td></tr><tr><td>fc</td><td>file create</td><td>Audit events where a file is created as a
		result.</td></tr><tr><td>fd</td><td>file delete</td><td>Audit events where file deletion occurs.</td></tr><tr><td>fm</td><td>file attribute modify</td><td>Audit events  where file attribute modification
		occurs, such as by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chown&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chown</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a>, and
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=flock&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">flock</span>(2)</span></a>.</td></tr><tr><td>fr</td><td>file read</td><td>Audit events in which data is read or files are
		opened for reading.</td></tr><tr><td>fw</td><td>file write</td><td>Audit events in which data is written or files
		are written or modified.</td></tr><tr><td>io</td><td>ioctl</td><td>Audit use of the <code class="function">ioctl</code>
		system call.</td></tr><tr><td>ip</td><td>ipc</td><td>Audit various forms of Inter-Process
		Communication, including POSIX pipes and System V
		<acronym class="acronym">IPC</acronym> operations.</td></tr><tr><td>lo</td><td>login_logout</td><td>Audit <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=login&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">login</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=logout&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">logout</span>(1)</span></a>
		events.</td></tr><tr><td>na</td><td>non attributable</td><td>Audit non-attributable events.</td></tr><tr><td>no</td><td>invalid class</td><td>Match no audit events.</td></tr><tr><td>nt</td><td>network</td><td>Audit events related to network actions such as
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=connect&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">connect</span>(2)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=accept&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">accept</span>(2)</span></a>.</td></tr><tr><td>ot</td><td>other</td><td>Audit miscellaneous events.</td></tr><tr><td>pc</td><td>process</td><td>Audit process operations such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=exec&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">exec</span>(3)</span></a> and
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=exit&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">exit</span>(3)</span></a>.</td></tr></tbody></table></div></div><br class="table-break" /><p>These audit event classes may be customized by modifying
	the <code class="filename">audit_class</code> and
	<code class="filename">audit_event</code> configuration files.</p><p>Each audit event class may be combined with a prefix
	indicating whether successful/failed operations are matched,
	and whether the entry is adding or removing matching for the
	class and type.  <a class="xref" href="#event-prefixes" title="Table 16.2. Prefixes for Audit Event Classes">Table 16.2, &#8220;Prefixes for Audit Event Classes&#8221;</a> summarizes
	the available prefixes:</p><div class="table"><a id="event-prefixes"></a><div class="table-title">Table 16.2. Prefixes for Audit Event Classes</div><div class="table-contents"><table class="table" summary="Prefixes for Audit Event Classes" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Prefix</th><th>Action</th></tr></thead><tbody><tr><td>+</td><td>Audit successful events in this class.</td></tr><tr><td>-</td><td>Audit failed events in this class.</td></tr><tr><td>^</td><td>Audit neither successful nor failed events in
		this class.</td></tr><tr><td>^+</td><td>Do not audit successful events in this
		class.</td></tr><tr><td>^-</td><td>Do not audit failed events in this class.</td></tr></tbody></table></div></div><br class="table-break" /><p>If no prefix is present, both successful and failed
	instances of the event will be audited.</p><p>The following example selection string selects both
	successful and failed login/logout events, but only successful
	execution events:</p><pre class="programlisting">lo,+ex</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59653240"></a>16.3.2. Configuration Files</h3></div></div></div><p>The following configuration files for security event
	auditing are found in
	<code class="filename">/etc/security</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">audit_class</code>: contains the
	    definitions of the audit classes.</p></li><li class="listitem"><p><code class="filename">audit_control</code>: controls aspects
	    of the audit subsystem, such as default audit classes,
	    minimum disk space to leave on the audit log volume, and
	    maximum audit trail size.</p></li><li class="listitem"><p><code class="filename">audit_event</code>: textual names and
	    descriptions of system audit events and a list of which
	    classes each event is in.</p></li><li class="listitem"><p><code class="filename">audit_user</code>: user-specific audit
	    requirements to be combined with the global defaults at
	    login.</p></li><li class="listitem"><p><code class="filename">audit_warn</code>: a customizable shell
	    script used by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> to generate warning messages
	    in exceptional situations, such as when space for audit
	    records is running low or when the audit trail file has
	    been rotated.</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Audit configuration files should be edited and
	  maintained carefully, as errors in configuration may result
	  in improper logging of events.</p></div><p>In most cases, administrators will only need to modify
	<code class="filename">audit_control</code> and
	<code class="filename">audit_user</code>.  The first file controls
	system-wide audit properties and policies and the second file
	may be used to fine-tune auditing by user.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit-auditcontrol"></a>16.3.2.1. The <code class="filename">audit_control</code> File</h4></div></div></div><p>A number of defaults for the audit subsystem are
	  specified in <code class="filename">audit_control</code>:</p><pre class="programlisting">dir:/var/audit
dist:off
flags:lo,aa
minfree:5
naflags:lo,aa
policy:cnt,argv
filesz:2M
expire-after:10M</pre><p>The <code class="option">dir</code> entry is used to set one or
	  more directories where audit logs will be stored.  If more
	  than one directory entry appears, they will be used in order
	  as they fill.  It is common to configure audit so that audit
	  logs are stored on a dedicated file system, in order to
	  prevent interference between the audit subsystem and other
	  subsystems if the file system fills.</p><p>If the <code class="option">dist</code> field is set to
	  <code class="literal">on</code> or <code class="literal">yes</code>, hard links
	  will be created to all trail files in
	  <code class="filename">/var/audit/dist</code>.</p><p>The <code class="option">flags</code> field sets the system-wide
	  default preselection mask for attributable events.  In the
	  example above, successful and failed login/logout events as
	  well as authentication and authorization are audited for all
	  users.</p><p>The <code class="option">minfree</code> entry defines the minimum
	  percentage of free space for the file system where the audit
	  trail is stored.</p><p>The <code class="option">naflags</code> entry specifies audit
	  classes to be audited for non-attributed events, such as the
	  login/logout process and authentication and
	  authorization.</p><p>The <code class="option">policy</code> entry specifies a
	  comma-separated list of policy flags controlling various
	  aspects of audit behavior.  The <code class="literal">cnt</code>
	  indicates that the system should continue running despite an
	  auditing failure (this flag is highly recommended).  The
	  other flag, <code class="literal">argv</code>, causes command line
	  arguments to the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> system call to be audited as
	  part of command execution.</p><p>The <code class="option">filesz</code> entry specifies the maximum
	  size for an audit trail before automatically terminating and
	  rotating the trail file.  A value of <code class="literal">0</code>
	  disables automatic log rotation.  If the requested file size
	  is below the minimum of 512k, it will be ignored and a log
	  message will be generated.</p><p>The <code class="option">expire-after</code> field specifies when
	  audit log files will expire and be removed.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit-audituser"></a>16.3.2.2. The <code class="filename">audit_user</code> File</h4></div></div></div><p>The administrator can specify further audit requirements
	  for specific users in <code class="filename">audit_user</code>.
	  Each line configures auditing for a user via two fields:
	  the <code class="literal">alwaysaudit</code> field specifies a set of
	  events that should always be audited for the user, and the
	  <code class="literal">neveraudit</code> field specifies a set of
	  events that should never be audited for the user.</p><p>The following example entries audit login/logout events
	  and successful command execution for <code class="systemitem">root</code> and file creation and
	  successful command execution for <code class="systemitem">www</code>.  If used with the
	  default <code class="filename">audit_control</code>, the
	  <code class="literal">lo</code> entry for <code class="systemitem">root</code> is redundant, and
	  login/logout events will also be audited for <code class="systemitem">www</code>.</p><pre class="programlisting">root:lo,+ex:no
www:fc,+ex:no</pre></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-administration"></a>16.4. Working with Audit Trails</h2></div></div></div><p>Since audit trails are stored in the <acronym class="acronym">BSM</acronym>
      binary format, several built-in tools are available to modify or
      convert these trails to text.  To convert trail files to a
      simple text format, use <code class="command">praudit</code>.  To reduce
      the audit trail file for analysis, archiving, or printing
      purposes, use <code class="command">auditreduce</code>.  This utility
      supports a variety of selection parameters, including event
      type, event class, user, date or time of the event, and the file
      path or object acted on.</p><p>For example, to dump the entire contents of a specified
      audit log in plain text:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>praudit /var/audit/<em class="replaceable"><code>AUDITFILE</code></em></code></strong></pre><p>Where <em class="replaceable"><code>AUDITFILE</code></em> is the audit log
      to dump.</p><p>Audit trails consist of a series of audit records made up of
      tokens, which <code class="command">praudit</code> prints sequentially,
      one per line.  Each token is of a specific type, such as
      <code class="literal">header</code> (an audit record header) or
      <code class="literal">path</code> (a file path from a name lookup).  The
      following is an example of an
      <code class="literal">execve</code> event:</p><pre class="programlisting">header,133,10,execve(2),0,Mon Sep 25 15:58:03 2006, + 384 msec
exec arg,finger,doug
path,/usr/bin/finger
attribute,555,root,wheel,90,24918,104944
subject,robert,root,wheel,root,wheel,38439,38032,42086,128.232.9.100
return,success,0
trailer,133</pre><p>This audit represents a successful
      <code class="literal">execve</code> call, in which the command
      <code class="literal">finger doug</code> has been run.  The
      <code class="literal">exec arg</code> token contains the processed command
      line presented by the shell to the kernel.  The
      <code class="literal">path</code> token holds the path to the executable
      as looked up by the kernel.  The <code class="literal">attribute</code>
      token describes the binary and includes the file mode.  The
      <code class="literal">subject</code> token stores the audit user ID,
      effective user ID and group ID, real user ID and group ID,
      process ID, session ID, port ID, and login address.  Notice that
      the audit user ID and real user ID differ as the user
      <code class="systemitem">robert</code> switched to the
      <code class="systemitem">root</code> account before
      running this command, but it is audited using the original
      authenticated user.  The <code class="literal">return</code> token
      indicates the successful execution and the
      <code class="literal">trailer</code> concludes the record.</p><p><acronym class="acronym">XML</acronym> output format is also supported and
      can be selected by including <code class="option">-x</code>.</p><p>Since audit logs may be very large, a subset of records can
      be selected using <code class="command">auditreduce</code>.  This example
      selects all audit records produced for the user
      <code class="systemitem">trhodes</code> stored in
      <code class="filename">AUDITFILE</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>auditreduce -u <em class="replaceable"><code>trhodes</code></em> /var/audit/<em class="replaceable"><code>AUDITFILE</code></em> | praudit</code></strong></pre><p>Members of the <code class="systemitem">audit</code> group have permission to
      read audit trails in <code class="filename">/var/audit</code>.  By
      default, this group is empty, so only the <code class="systemitem">root</code> user can read audit trails.
      Users may be added to the <code class="systemitem">audit</code> group in order to
      delegate audit review rights.  As the ability to track audit log
      contents provides significant insight into the behavior of users
      and processes, it is recommended that the delegation of audit
      review rights be performed with caution.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59744504"></a>16.4.1. Live Monitoring Using Audit Pipes</h3></div></div></div><p>Audit pipes are cloning pseudo-devices which allow
	applications to tap the live audit record stream.  This is
	primarily of interest to authors of intrusion detection and
	system monitoring applications.  However, the audit pipe
	device is a convenient way for the administrator to allow live
	monitoring without running into problems with audit trail file
	ownership or log rotation interrupting the event stream.  To
	track the live audit event stream:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>praudit /dev/auditpipe</code></strong></pre><p>By default, audit pipe device nodes are accessible only to
	the <code class="systemitem">root</code> user.  To
	make them accessible to the members of the <code class="systemitem">audit</code> group, add a
	<code class="literal">devfs</code> rule to
	<code class="filename">/etc/devfs.rules</code>:</p><pre class="programlisting">add path 'auditpipe*' mode 0440 group audit</pre><p>See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs.rules</span>(5)</span></a> for more information on
	configuring the devfs file system.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is easy to produce audit event feedback cycles, in
	  which the viewing of each audit event results in the
	  generation of more audit events.  For example, if all
	  network <acronym class="acronym">I/O</acronym> is audited, and
	  <code class="command">praudit</code> is run from an
	  <acronym class="acronym">SSH</acronym> session, a continuous stream of audit
	  events will be generated at a high rate, as each event being
	  printed will generate another event.  For this reason, it is
	  advisable to run <code class="command">praudit</code> on an audit pipe
	  device from sessions without fine-grained
	  <acronym class="acronym">I/O</acronym> auditing.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59752952"></a>16.4.2. Rotating and Compressing Audit Trail Files</h3></div></div></div><p>Audit trails are written to by the kernel and
	managed by the audit daemon, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a>.
	Administrators should not attempt to use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">newsyslog.conf</span>(5)</span></a> or other tools to directly rotate
	audit logs.  Instead, <code class="command">audit</code> should
	be used to shut down auditing, reconfigure the audit system,
	and perform log rotation.  The following command causes the
	audit daemon to create a new audit log and signal the kernel
	to switch to using the new log.  The old log will be
	terminated and renamed, at which point it may then be
	manipulated by the administrator:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>audit -n</code></strong></pre><p>If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> is not currently running, this command
	will fail and an error message will be produced.</p><p>Adding the following line to
	<code class="filename">/etc/crontab</code> will schedule this rotation
	every twelve hours:</p><pre class="programlisting">0     */12       *       *       *       root    /usr/sbin/audit -n</pre><p>The change will take effect once
	<code class="filename">/etc/crontab</code> is saved.</p><p>Automatic rotation of the audit trail file based on file
	size is possible using <code class="option">filesz</code> in
	<code class="filename">audit_control</code> as described in <a class="xref" href="#audit-auditcontrol" title="16.3.2.1. The audit_control File">Section 16.3.2.1, &#8220;The <code class="filename">audit_control</code> File&#8221;</a>.</p><p>As audit trail files can become very large, it is often
	desirable to compress or otherwise archive trails once they
	have been closed by the audit daemon.  The
	<code class="filename">audit_warn</code> script can be used to perform
	customized operations for a variety of audit-related events,
	including the clean termination of audit trails when they are
	rotated.  For example, the following may be added to
	<code class="filename">/etc/security/audit_warn</code> to compress
	audit trails on close:</p><pre class="programlisting">#
# Compress audit trail files on close.
#
if [ "$1" = closefile ]; then
        gzip -9 $2
fi</pre><p>Other archiving activities might include copying trail
	files to a centralized server, deleting old trail files, or
	reducing the audit trail to remove unneeded records.  This
	script will be run only when audit trail files are cleanly
	terminated, so will not be run on trails left unterminated
	following an improper shutdown.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks"></a>Chapter 17. Storage</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#disks-synopsis">17.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#disks-adding">17.2. Adding Disks</a></span></dt><dt><span class="sect1"><a href="#disks-growing">17.3. Resizing and Growing Disks</a></span></dt><dt><span class="sect1"><a href="#usb-disks">17.4. <acronym class="acronym">USB</acronym> Storage Devices</a></span></dt><dt><span class="sect1"><a href="#creating-cds">17.5. Creating and Using <acronym class="acronym">CD</acronym> Media</a></span></dt><dt><span class="sect1"><a href="#creating-dvds">17.6. Creating and Using <acronym class="acronym">DVD</acronym> Media</a></span></dt><dt><span class="sect1"><a href="#floppies">17.7. Creating and Using Floppy Disks</a></span></dt><dt><span class="sect1"><a href="#backup-basics">17.8. Backup Basics</a></span></dt><dt><span class="sect1"><a href="#disks-virtual">17.9. Memory Disks</a></span></dt><dt><span class="sect1"><a href="#snapshots">17.10. File System Snapshots</a></span></dt><dt><span class="sect1"><a href="#quotas">17.11. Disk Quotas</a></span></dt><dt><span class="sect1"><a href="#disks-encrypting">17.12. Encrypting Disk Partitions</a></span></dt><dt><span class="sect1"><a href="#swap-encrypting">17.13. Encrypting Swap</a></span></dt><dt><span class="sect1"><a href="#disks-hast">17.14. Highly Available Storage
	(<acronym class="acronym">HAST</acronym>)</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-synopsis"></a>17.1. Synopsis</h2></div></div></div><p>This chapter covers the use of disks and storage media in
      FreeBSD.  This includes <acronym class="acronym">SCSI</acronym> and
      <acronym class="acronym">IDE</acronym> disks, <acronym class="acronym">CD</acronym> and
      <acronym class="acronym">DVD</acronym> media, memory-backed disks, and
      <acronym class="acronym">USB</acronym> storage devices.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to add additional hard disks to a FreeBSD
	  system.</p></li><li class="listitem"><p>How to grow the size of a disk's partition on
	  FreeBSD.</p></li><li class="listitem"><p>How to configure FreeBSD to use <acronym class="acronym">USB</acronym>
	  storage devices.</p></li><li class="listitem"><p>How to use <acronym class="acronym">CD</acronym> and
	  <acronym class="acronym">DVD</acronym> media on a FreeBSD system.</p></li><li class="listitem"><p>How to use the backup programs available under
	  FreeBSD.</p></li><li class="listitem"><p>How to set up memory disks.</p></li><li class="listitem"><p>What file system snapshots are and how to use them
	  efficiently.</p></li><li class="listitem"><p>How to use quotas to limit disk space usage.</p></li><li class="listitem"><p>How to encrypt disks and swap to secure them against
	  attackers.</p></li><li class="listitem"><p>How to configure a highly available storage
	  network.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Know how to <a class="link" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">configure and
	    install a new FreeBSD kernel</a>.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-adding"></a>17.2. Adding Disks</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">David</span> <span class="surname">O'Brien</span></span>. </span></div></div></div><a id="idp59799544" class="indexterm"></a><p>This section describes how to add a new
      <acronym class="acronym">SATA</acronym> disk to a machine that currently only
      has a single drive.  First, turn off the computer and install
      the drive in the computer following the instructions of the
      computer, controller, and drive manufacturers.  Reboot the
      system and become
      <code class="systemitem">root</code>.</p><p>Inspect <code class="filename">/var/run/dmesg.boot</code> to ensure
      the new disk was found.  In this example, the newly added
      <acronym class="acronym">SATA</acronym> drive will appear as
      <code class="filename">ada1</code>.</p><a id="idp59803512" class="indexterm"></a><a id="idp59804024" class="indexterm"></a><p>For this example, a single large partition will be created
      on the new disk.  The <a class="link" href="http://en.wikipedia.org/wiki/GUID_Partition_Table" target="_top">
	<acronym class="acronym">GPT</acronym></a> partitioning scheme will be
      used in preference to the older and less versatile
      <acronym class="acronym">MBR</acronym> scheme.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If the disk to be added is not blank, old partition
	information can be removed with
	<code class="command">gpart delete</code>.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a> for
	details.</p></div><p>The partition scheme is created, and then a single partition
      is added.  To improve performance on newer disks with larger
      hardware block sizes, the partition is aligned to one megabyte
      boundaries:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart create -s GPT ada1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs -a 1M ada1</code></strong></pre><p>Depending on use, several smaller partitions may be desired.
      See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a> for options to create partitions smaller than
      a whole disk.</p><p>The disk partition information can be viewed with
      <code class="command">gpart show</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>gpart show ada1</code></strong>
=&gt;        34  1465146988  ada1  GPT  (699G)
          34        2014        - free -  (1.0M)
        2048  1465143296     1  freebsd-ufs  (699G)
  1465145344        1678        - free -  (839K)</pre><p>A file system is created in the new partition on the new disk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/ada1p1</code></strong></pre><p>An empty directory is created as a
      <span class="emphasis"><em>mountpoint</em></span>, a location for mounting the new
      disk in the original disk's file system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /newdisk</code></strong></pre><p>Finally, an entry is added to
      <code class="filename">/etc/fstab</code> so the new disk will be mounted
      automatically at startup:</p><pre class="programlisting">/dev/ada1p1	/newdisk	ufs	rw	2	2</pre><p>The new disk can be mounted manually, without restarting the
      system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /newdisk</code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-growing"></a>17.3. Resizing and Growing Disks</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>. </span></div></div></div><a id="idp59826424" class="indexterm"></a><p>A disk's capacity can increase without any changes to the
      data already present.  This happens commonly with virtual
      machines, when the virtual disk turns out to be too small and is
      enlarged.  Sometimes a disk image is written to a
      <acronym class="acronym">USB</acronym> memory stick, but does not use the full
      capacity.  Here we describe how to resize or
      <span class="emphasis"><em>grow</em></span> disk contents to take advantage of
      increased capacity.</p><p>Determine the device name of the disk to be resized by
      inspecting <code class="filename">/var/run/dmesg.boot</code>.  In this
      example, there is only one <acronym class="acronym">SATA</acronym> disk in the
      system, so the drive will appear as
      <code class="filename">ada0</code>.</p><a id="idp59846648" class="indexterm"></a><a id="idp59847160" class="indexterm"></a><p>List the partitions on the disk to see the current
      configuration:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart show <em class="replaceable"><code>ada0</code></em></code></strong>
=&gt;      34  83886013  ada0  GPT  (48G) [CORRUPT]
        34       128     1  freebsd-boot  (64k)
       162  79691648     2  freebsd-ufs  (38G)
  79691810   4194236     3  freebsd-swap  (2G)
  83886046         1        - free -  (512B)</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If the disk was formatted with the <a class="link" href="http://en.wikipedia.org/wiki/GUID_Partition_Table" target="_top">
	<acronym class="acronym">GPT</acronym></a> partitioning scheme, it may show
	as <span class="quote">&#8220;<span class="quote">corrupted</span>&#8221;</span> because the <acronym class="acronym">GPT</acronym>
	backup partition table is no longer at the end of the
	drive.  Fix the backup
	partition table with
	<code class="command">gpart</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart recover <em class="replaceable"><code>ada0</code></em></code></strong>
ada0 recovered</pre></div><p>Now the additional space on the disk is available for
      use by a new partition, or an existing partition can be
      expanded:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart show <em class="replaceable"><code>ada0</code></em></code></strong>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   79691648     2  freebsd-ufs  (38G)
   79691810    4194236     3  freebsd-swap  (2G)
   83886046   18513921        - free -  (8.8G)</pre><p>Partitions can only be resized into contiguous free space.
      Here, the last partition on the disk is the swap partition, but
      the second partition is the one that needs to be resized.  Swap
      partitions only contain temporary data, so it can safely be
      unmounted, deleted, and then recreate the third partition after
      resizing the second partition.</p><p>Disable the swap partition:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>swapoff <em class="replaceable"><code>/dev/ada0p3</code></em></code></strong></pre><p>Delete the third partition, specified by the
      <code class="option">-i</code> flag, from the disk
      <em class="replaceable"><code>ada0</code></em>.</p><pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>gpart delete -i <em class="replaceable"><code>3</code></em> <em class="replaceable"><code>ada0</code></em></code></strong>
ada0p3 deleted
<code class="prompt">#</code> <strong class="userinput"><code>gpart show <em class="replaceable"><code>ada0</code></em></code></strong>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   79691648     2  freebsd-ufs  (38G)
   79691810   22708157        - free -  (10G)</pre><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">There is risk of data loss when modifying the partition
	table of a mounted file system.  It is best to perform the
	following steps on an unmounted file system while running from
	a live <acronym class="acronym">CD-ROM</acronym> or <acronym class="acronym">USB</acronym>
	device.  However, if absolutely necessary, a mounted file
	system can be  resized after disabling GEOM safety
	features:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl kern.geom.debugflags=16</code></strong></pre></div><p>Resize the partition, leaving room to recreate a swap
      partition of the desired size.  The partition to resize is
      specified with <code class="option">-i</code>, and the new desired size
      with <code class="option">-s</code>.  Optionally, alignment of the
      partition is controlled with <code class="option">-a</code>.  This only
      modifies the size of the partition.  The file system in the
      partition will be expanded in a separate step.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart resize -i <em class="replaceable"><code>2</code></em> -s <em class="replaceable"><code>47G</code></em> -a 4k <em class="replaceable"><code>ada0</code></em></code></strong>
ada0p2 resized
<code class="prompt">#</code> <strong class="userinput"><code>gpart show <em class="replaceable"><code>ada0</code></em></code></strong>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   98566144     2  freebsd-ufs  (47G)
   98566306    3833661        - free -  (1.8G)</pre><p>Recreate the swap partition and activate it.  If no size
      is specified with <code class="option">-s</code>, all remaining space is
      used:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-swap -a 4k <em class="replaceable"><code>ada0</code></em></code></strong>
ada0p3 added
<code class="prompt">#</code> <strong class="userinput"><code>gpart show <em class="replaceable"><code>ada0</code></em></code></strong>
=&gt;       34  102399933  ada0  GPT  (48G)
         34        128     1  freebsd-boot  (64k)
        162   98566144     2  freebsd-ufs  (47G)
   98566306    3833661     3  freebsd-swap  (1.8G)
<code class="prompt">#</code> <strong class="userinput"><code>swapon <em class="replaceable"><code>/dev/ada0p3</code></em></code></strong></pre><p>Grow the <acronym class="acronym">UFS</acronym> file system to use the new
      capacity of the resized partition:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growfs <em class="replaceable"><code>/dev/ada0p2</code></em></code></strong>
Device is mounted read-write; resizing will result in temporary write suspension for /.
It's strongly recommended to make a backup before growing the file system.
OK to grow file system on /dev/ada0p2, mounted on /, from 38GB to 47GB? [Yes/No] <strong class="userinput"><code>Yes</code></strong>
super-block backups (for fsck -b #) at:
 80781312, 82063552, 83345792, 84628032, 85910272, 87192512, 88474752,
 89756992, 91039232, 92321472, 93603712, 94885952, 96168192, 97450432</pre><p>If the file system is <acronym class="acronym">ZFS</acronym>, the resize is
      triggered by running the <code class="option">online</code> subcommand with
      <code class="option">-e</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool online -e <em class="replaceable"><code>zroot</code></em> <em class="replaceable"><code>/dev/ada0p2</code></em></code></strong></pre><p>Both the partition and the file system on it have now been
      resized to use the newly-available disk space.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-disks"></a>17.4. <acronym class="acronym">USB</acronym> Storage Devices</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp59906680" class="indexterm"></a><p>Many external storage solutions, such as hard drives,
      <acronym class="acronym">USB</acronym> thumbdrives, and <acronym class="acronym">CD</acronym>
      and <acronym class="acronym">DVD</acronym> burners, use the Universal Serial Bus
      (<acronym class="acronym">USB</acronym>).  FreeBSD provides support for
      <acronym class="acronym">USB</acronym> 1.x, 2.0, and 3.0 devices.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><acronym class="acronym">USB</acronym> 3.0 support is not compatible with
	some hardware, including Haswell (Lynx point) chipsets.  If
	FreeBSD boots with a <span class="errorname">failed with error 19</span>
	message, disable xHCI/USB3 in the system
	<acronym class="acronym">BIOS</acronym>.</p></div><p>Support for <acronym class="acronym">USB</acronym> storage devices is built
      into the <code class="filename">GENERIC</code> kernel.  For a custom
      kernel, be sure that the following lines are present in the
      kernel configuration file:</p><pre class="programlisting">device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da
device cd	# needed for CD and DVD burners</pre><p>FreeBSD uses the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a> driver which uses the
      <acronym class="acronym">SCSI</acronym> subsystem to access
      <acronym class="acronym">USB</acronym> storage devices.  Since any
      <acronym class="acronym">USB</acronym> device will be seen as a
      <acronym class="acronym">SCSI</acronym> device by the system, if the
      <acronym class="acronym">USB</acronym> device is a <acronym class="acronym">CD</acronym> or
      <acronym class="acronym">DVD</acronym> burner, do <span class="emphasis"><em>not</em></span>
      include <code class="option">device atapicam</code> in a custom kernel
      configuration file.</p><p>The rest of this section demonstrates how to verify that a
      <acronym class="acronym">USB</acronym> storage device is recognized by FreeBSD and
      how to configure the device so that it can be used.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59923192"></a>17.4.1. Device Configuration</h3></div></div></div><p>To test the <acronym class="acronym">USB</acronym> configuration, plug in
	the <acronym class="acronym">USB</acronym> device.  Use
	<code class="command">dmesg</code> to confirm that the drive appears in
	the system message buffer.  It should look something like
	this:</p><pre class="screen">umass0: &lt;STECH Simple Drive, class 0/0, rev 2.00/1.04, addr 3&gt; on usbus0
umass0:  SCSI over Bulk-Only; quirks = 0x0100
umass0:4:0:-1: Attached to scbus4
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; Fixed Direct Access SCSI-4 device
da0: Serial Number WD-WXE508CAN263
da0: 40.000MB/s transfers
da0: 152627MB (312581808 512 byte sectors: 255H 63S/T 19457C)
da0: quirks=0x2&lt;NO_6_BYTE&gt;</pre><p>The brand, device node (<code class="filename">da0</code>), speed,
	and size will differ according to the device.</p><p>Since the <acronym class="acronym">USB</acronym> device is seen as a
	<acronym class="acronym">SCSI</acronym> one, <code class="command">camcontrol</code> can
	be used to list the <acronym class="acronym">USB</acronym> storage devices
	attached to the system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol devlist</code></strong>
&lt;STECH Simple Drive 1.04&gt;          at scbus4 target 0 lun 0 (pass3,da0)</pre><p>Alternately, <code class="command">usbconfig</code> can be used to
	list the device.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usbconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usbconfig</span>(8)</span></a> for more
	information about this command.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>usbconfig</code></strong>
ugen0.3: &lt;Simple Drive STECH&gt; at usbus0, cfg=0 md=HOST spd=HIGH (480Mbps) pwr=ON (2mA)</pre><p>If the device has not been formatted, refer to <a class="xref" href="#disks-adding" title="17.2. Adding Disks">Section 17.2, &#8220;Adding Disks&#8221;</a> for instructions on how to format
	and create partitions on the <acronym class="acronym">USB</acronym> drive.  If
	the drive comes with a file system, it can be mounted by
	<code class="systemitem">root</code> using the
	instructions in <a class="xref" href="#mount-unmount" title="3.7. Mounting and Unmounting File Systems">Section 3.7, &#8220;Mounting and Unmounting File Systems&#8221;</a>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Allowing untrusted users to mount arbitrary media, by
	  enabling <code class="varname">vfs.usermount</code> as described
	  below, should not be considered safe from a security point
	  of view.  Most file systems were not built to safeguard
	  against malicious devices.</p></div><p>To make the device mountable as a normal user, one
	solution is to make all users of the device a member of the
	<code class="systemitem">operator</code> group
	using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>.  Next, ensure that <code class="systemitem">operator</code> is able to read and
	write the device by adding these lines to
	<code class="filename">/etc/devfs.rules</code>:</p><pre class="programlisting">[localrules=5]
add path 'da*' mode 0660 group operator</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If internal <acronym class="acronym">SCSI</acronym> disks are also
	  installed in the system, change the second line as
	  follows:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">add path 'da[<em class="replaceable"><code>3</code></em>-9]*' mode 0660 group operator</pre><p xmlns="http://www.w3.org/1999/xhtml">This will exclude the first three
	  <acronym class="acronym">SCSI</acronym> disks (<code class="filename">da0</code> to
	  <code class="filename">da2</code>)from belonging to the <code class="systemitem">operator</code> group.  Replace
	  <em class="replaceable"><code>3</code></em> with the number of internal
	  <acronym class="acronym">SCSI</acronym> disks.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devfs.rules</span>(5)</span></a>
	  for more information about this file.</p></div><p>Next, enable the ruleset in
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">devfs_system_ruleset="localrules"</pre><p>Then, instruct the system to allow regular users to mount
	file systems by adding the following line to
	<code class="filename">/etc/sysctl.conf</code>:</p><pre class="programlisting">vfs.usermount=1</pre><p>Since this only takes effect after the next reboot, use
	<code class="command">sysctl</code> to set this variable now:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl vfs.usermount=1</code></strong>
vfs.usermount: 0 -&gt; 1</pre><p>The final step is to create a directory where the file
	system is to be mounted.  This directory needs to be owned by
	the user that is to mount the file system.  One way to do that
	is for <code class="systemitem">root</code> to
	create a subdirectory owned by that user as <code class="filename">/mnt/<em class="replaceable"><code>username</code></em></code>.
	In the following example, replace
	<em class="replaceable"><code>username</code></em> with the login name of the
	user and <em class="replaceable"><code>usergroup</code></em> with the user's
	primary group:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /mnt/<em class="replaceable"><code>username</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown <em class="replaceable"><code>username</code></em>:<em class="replaceable"><code>usergroup</code></em> /mnt/<em class="replaceable"><code>username</code></em></code></strong></pre><p>Suppose a <acronym class="acronym">USB</acronym> thumbdrive is plugged in,
	and a device <code class="filename">/dev/da0s1</code> appears.  If the
	device is formatted with a <acronym class="acronym">FAT</acronym> file system,
	the user can mount it using:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mount -t msdosfs -o -m=644,-M=755 /dev/da0s1 /mnt/<em class="replaceable"><code>username</code></em></code></strong></pre><p>Before the device can be unplugged, it
	<span class="emphasis"><em>must</em></span> be unmounted first:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>umount /mnt/<em class="replaceable"><code>username</code></em></code></strong></pre><p>After device removal, the system message buffer will show
	messages similar to the following:</p><pre class="screen">umass0: at uhub3, port 2, addr 3 (disconnected)
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; s/n WD-WXE508CAN263          detached
(da0:umass-sim0:0:0:0): Periph destroyed</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp59979256"></a>17.4.2. Automounting Removable Media</h3></div></div></div><p><acronym class="acronym">USB</acronym> devices can be automatically
	mounted by uncommenting this line in
	<code class="filename">/etc/auto_master</code>:</p><pre class="screen">/media		-media		-nosuid</pre><p>Then add these lines to
	<code class="filename">/etc/devd.conf</code>:</p><pre class="screen">notify 100 {
	match "system" "GEOM";
	match "subsystem" "DEV";
	action "/usr/sbin/automount -c";
};</pre><p>Reload the configuration if <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a>
	and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> are already running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service automount restart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service devd restart</code></strong></pre><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> can be set to start at boot by adding this
	line to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">autofs_enable="YES"</pre><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> requires <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> to be enabled, as it
	is by default.</p><p>Start the services immediately with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service automount start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service automountd start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service autounmountd start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service devd start</code></strong></pre><p>Each file system that can be automatically mounted appears
	as a directory in <code class="filename">/media/</code>.  The directory
	is named after the file system label.  If the label is
	missing, the directory is named after the device node.</p><p>The file system is transparently mounted on the first
	access, and unmounted after a period of inactivity.
	Automounted drives can also be unmounted manually:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>automount -fu</code></strong></pre><p>This mechanism is typically used for memory cards and
	<acronym class="acronym">USB</acronym> memory sticks.  It can be used with
	any block device, including optical drives or
	<acronym class="acronym">iSCSI</acronym> <acronym class="acronym">LUN</acronym>s.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="creating-cds"></a>17.5. Creating and Using <acronym class="acronym">CD</acronym> Media</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mike</span> <span class="surname">Meyer</span></span>. </span></div></div></div><a id="idp59996792" class="indexterm"></a><p>Compact Disc (<acronym class="acronym">CD</acronym>) media provide a number
      of features that differentiate them from conventional disks.
      They are designed so that they can be read continuously without
      delays to move the head between tracks.  While
      <acronym class="acronym">CD</acronym> media do have tracks, these refer to a
      section of data to be read continuously, and not a physical
      property of the disk.  The <acronym class="acronym">ISO</acronym> 9660 file
      system was designed to deal with these differences.</p><a id="idp60003832" class="indexterm"></a><a id="idp60004600" class="indexterm"></a><a id="idp60018040" class="indexterm"></a><p>The FreeBSD Ports Collection provides several utilities for
      burning and duplicating audio and data <acronym class="acronym">CD</acronym>s.
      This chapter demonstrates the use of several command line
      utilities.  For <acronym class="acronym">CD</acronym> burning software with a
      graphical utility, consider installing the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/xcdroast/pkg-descr">sysutils/xcdroast</a> or
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/k3b/pkg-descr">sysutils/k3b</a> packages or ports.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="atapicam"></a>17.5.1. Supported Devices</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp60029048" class="indexterm"></a><p>The <code class="filename">GENERIC</code> kernel provides support
	for <acronym class="acronym">SCSI</acronym>,  <acronym class="acronym">USB</acronym>, and
	<acronym class="acronym">ATAPI</acronym> <acronym class="acronym">CD</acronym> readers and
	burners.  If a custom kernel is used, the options that need to
	be present in the kernel configuration file vary by the type
	of device.</p><p>For a <acronym class="acronym">SCSI</acronym> burner, make sure these
	options are present:</p><pre class="programlisting">device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</pre><p>For a <acronym class="acronym">USB</acronym> burner, make sure these
	options are present:</p><pre class="programlisting">device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da</pre><p>For an <acronym class="acronym">ATAPI</acronym> burner, make sure these
	options are present:</p><pre class="programlisting">device ata	# Legacy ATA/SATA controllers
device scbus	# SCSI bus (required for ATA/SCSI)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">On FreeBSD versions prior to 10.x, this line is also
	  needed in the kernel configuration file if the burner is an
	  <acronym class="acronym">ATAPI</acronym> device:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">device atapicam</pre><p xmlns="http://www.w3.org/1999/xhtml">Alternately, this driver can be loaded at boot time by
	  adding the following line to
	  <code class="filename">/boot/loader.conf</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">atapicam_load="YES"</pre><p xmlns="http://www.w3.org/1999/xhtml">This will require a reboot of the system as this driver
	  can only be loaded at boot time.</p></div><p>To verify that FreeBSD recognizes the device, run
	<code class="command">dmesg</code> and look for an entry for the device.
	On systems prior to 10.x, the device name in the first line of
	the output will be <code class="filename">acd0</code> instead of
	<code class="filename">cd0</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>dmesg | grep cd</code></strong>
cd0 at ahcich1 bus 0 scbus1 target 0 lun 0
cd0: &lt;HL-DT-ST DVDRAM GU70N LT20&gt; Removable CD-ROM SCSI-0 device
cd0: Serial Number M3OD3S34152
cd0: 150.000MB/s transfers (SATA 1.x, UDMA6, ATAPI 12bytes, PIO 8192bytes)
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="cdrecord"></a>17.5.2. Burning a <acronym class="acronym">CD</acronym></h3></div></div></div><p>In FreeBSD, <code class="command">cdrecord</code> can be used to burn
	<acronym class="acronym">CD</acronym>s.  This command is installed with the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a> package or port.</p><p>While <code class="command">cdrecord</code> has many options, basic
	usage is simple.  Specify the name of the
	<acronym class="acronym">ISO</acronym> file to burn and, if the system has
	multiple burner devices, specify the name of the device to
	use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cdrecord <em class="replaceable"><code>dev=device</code></em> <em class="replaceable"><code>imagefile.iso</code></em></code></strong></pre><p>To determine the device name of the burner, use
	<code class="option">-scanbus</code> which might produce results like
	this:</p><a id="idp60064632" class="indexterm"></a><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cdrecord -scanbus</code></strong>
ProDVD-ProBD-Clone 3.00 (amd64-unknown-freebsd10.0) Copyright (C) 1995-2010 Jörg Schilling
Using libscg version 'schily-0.9'
scsibus0:
        0,0,0     0) 'SEAGATE ' 'ST39236LW       ' '0004' Disk
        0,1,0     1) 'SEAGATE ' 'ST39173W        ' '5958' Disk
        0,2,0     2) *
        0,3,0     3) 'iomega  ' 'jaz 1GB         ' 'J.86' Removable Disk
        0,4,0     4) 'NEC     ' 'CD-ROM DRIVE:466' '1.26' Removable CD-ROM
        0,5,0     5) *
        0,6,0     6) *
        0,7,0     7) *
scsibus1:
        1,0,0   100) *
        1,1,0   101) *
        1,2,0   102) *
        1,3,0   103) *
        1,4,0   104) *
        1,5,0   105) 'YAMAHA  ' 'CRW4260         ' '1.0q' Removable CD-ROM
        1,6,0   106) 'ARTEC   ' 'AM12S           ' '1.06' Scanner
        1,7,0   107) *</pre><p>Locate the entry for the <acronym class="acronym">CD</acronym> burner and
	use the three numbers separated by commas as the value for
	<code class="option">dev</code>.  In this case, the Yamaha burner device
	is <code class="literal">1,5,0</code>, so the appropriate input to
	specify that device is <code class="option">dev=1,5,0</code>.  Refer to
	the manual page for <code class="command">cdrecord</code> for other ways
	to specify this value and for information on writing audio
	tracks and controlling the write speed.</p><p>Alternately, run the following command to get the device
	address of the burner:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol devlist</code></strong>
&lt;MATSHITA CDRW/DVD UJDA740 1.00&gt;   at scbus1 target 0 lun 0 (cd0,pass0)</pre><p>Use the numeric values for <code class="literal">scbus</code>,
	<code class="literal">target</code>, and <code class="literal">lun</code>.  For
	this example, <code class="literal">1,0,0</code> is the device name to
	use.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mkisofs"></a>17.5.3. Writing Data to an <acronym class="acronym">ISO</acronym> File
	System</h3></div></div></div><p>In order to produce a data <acronym class="acronym">CD</acronym>, the data
	files that are going to make up the tracks on the
	<acronym class="acronym">CD</acronym> must be prepared before they can be
	burned to the <acronym class="acronym">CD</acronym>.  In FreeBSD,
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a> installs
	<code class="command">mkisofs</code>, which can be used to produce an
	<acronym class="acronym">ISO</acronym> 9660 file system that is an image of a
	directory tree within a <span class="trademark">UNIX</span>® file system.  The simplest
	usage is to specify the name of the <acronym class="acronym">ISO</acronym>
	file to create and the path to the files to place into the
	<acronym class="acronym">ISO</acronym> 9660 file system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkisofs -o <em class="replaceable"><code>imagefile.iso</code></em> <em class="replaceable"><code>/path/to/tree</code></em></code></strong></pre><a id="idp60083704" class="indexterm"></a><p>This command maps the file names in the specified path to
	names that fit the limitations of the standard
	<acronym class="acronym">ISO</acronym> 9660 file system, and will exclude
	files that do not meet the standard for <acronym class="acronym">ISO</acronym>
	file systems.</p><a id="idp60086008" class="indexterm"></a><p>A number of options are available to overcome the
	restrictions imposed by the standard.  In particular,
	<code class="option">-R</code> enables the Rock Ridge extensions common
	to <span class="trademark">UNIX</span>® systems and <code class="option">-J</code> enables Joliet
	extensions used by <span class="trademark">Microsoft</span>® systems.</p><p>For <acronym class="acronym">CD</acronym>s that are going to be used only
	on FreeBSD systems, <code class="option">-U</code> can be used to disable
	all filename restrictions.  When used with
	<code class="option">-R</code>, it produces a file system image that is
	identical to the specified FreeBSD tree, even if it violates the
	<acronym class="acronym">ISO</acronym> 9660 standard.</p><a id="idp60095352" class="indexterm"></a><p>The last option of general use is <code class="option">-b</code>.
	This is used to specify the location of a boot image for use
	in producing an <span class="quote">&#8220;<span class="quote">El Torito</span>&#8221;</span> bootable
	<acronym class="acronym">CD</acronym>.  This option takes an argument which is
	the path to a boot image from the top of the tree being
	written to the <acronym class="acronym">CD</acronym>.  By default,
	<code class="command">mkisofs</code> creates an <acronym class="acronym">ISO</acronym>
	image in <span class="quote">&#8220;<span class="quote">floppy disk emulation</span>&#8221;</span> mode, and thus
	expects the boot image to be exactly 1200, 1440 or
	2880 KB in size.  Some boot loaders, like the one used by
	the FreeBSD distribution media, do not use emulation mode.  In
	this case, <code class="option">-no-emul-boot</code> should be used.  So,
	if <code class="filename">/tmp/myboot</code> holds a bootable FreeBSD
	system with the boot image in
	<code class="filename">/tmp/myboot/boot/cdboot</code>, this command
	would produce
	<code class="filename">/tmp/bootable.iso</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkisofs -R -no-emul-boot -b boot/cdboot -o /tmp/bootable.iso /tmp/myboot</code></strong></pre><p>The resulting <acronym class="acronym">ISO</acronym> image can be mounted
	as a memory disk with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -f /tmp/bootable.iso -u 0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t cd9660 /dev/md0 /mnt</code></strong></pre><p>One can then verify that <code class="filename">/mnt</code> and
	<code class="filename">/tmp/myboot</code> are identical.</p><p>There are many other options available for
	<code class="command">mkisofs</code> to fine-tune its behavior.  Refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a> for details.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is possible to copy a data <acronym class="acronym">CD</acronym> to
	  an image file that is functionally equivalent to the image
	  file created with <code class="command">mkisofs</code>.  To do so, use
	  <code class="filename">dd</code> with the device name as the input
	  file and the name of the <acronym class="acronym">ISO</acronym> to create as
	  the output file:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/<em class="replaceable"><code>cd0</code></em> of=<em class="replaceable"><code>file.iso</code></em> bs=2048</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">The resulting image file can be burned to
	  <acronym class="acronym">CD</acronym> as described in <a class="xref" href="#cdrecord" title="17.5.2. Burning a CD">Section 17.5.2, &#8220;Burning a <acronym class="acronym">CD</acronym>&#8221;</a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mounting-cd"></a>17.5.4. Using Data <acronym class="acronym">CD</acronym>s</h3></div></div></div><p>Once an <acronym class="acronym">ISO</acronym> has been burned to a
	<acronym class="acronym">CD</acronym>, it can be mounted by specifying the
	file system type, the name of the device containing the
	<acronym class="acronym">CD</acronym>, and an existing mount point:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t cd9660 <em class="replaceable"><code>/dev/cd0</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre><p>Since <code class="command">mount</code> assumes that a file system
	is of type <code class="literal">ufs</code>, a <span class="errorname">Incorrect
	  super block</span> error will occur if <code class="literal">-t
	  cd9660</code> is not included when mounting a data
	<acronym class="acronym">CD</acronym>.</p><p>While any data <acronym class="acronym">CD</acronym> can be mounted this
	way, disks with certain <acronym class="acronym">ISO</acronym> 9660 extensions
	might behave oddly.  For example, Joliet disks store all
	filenames in two-byte Unicode characters.  If some non-English
	characters show up as question marks, specify the local
	charset with <code class="option">-C</code>.  For more information, refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_cd9660&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_cd9660</span>(8)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In order to do this character conversion with the help
	  of <code class="option">-C</code>, the kernel requires the
	  <code class="filename">cd9660_iconv.ko</code> module to be loaded.
	  This can be done either by adding this line to
	  <code class="filename">loader.conf</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">cd9660_iconv_load="YES"</pre><p xmlns="http://www.w3.org/1999/xhtml">and then rebooting the machine, or by directly loading
	  the module with <code class="command">kldload</code>.</p></div><p>Occasionally, <span class="errorname">Device not configured</span>
	will be displayed when trying to mount a data
	<acronym class="acronym">CD</acronym>.  This usually means that the
	<acronym class="acronym">CD</acronym> drive has not detected a disk in
	the tray, or that the drive is not visible on the bus.  It
	can take a couple of seconds for a <acronym class="acronym">CD</acronym>
	drive to detect media, so be
	patient.</p><p>Sometimes, a <acronym class="acronym">SCSI</acronym>
	<acronym class="acronym">CD</acronym> drive may be missed because it did not
	have enough time to answer the bus reset.  To resolve this,
	a custom kernel can be created which increases the default
	<acronym class="acronym">SCSI</acronym> delay.  Add the following option to
	the custom kernel configuration file and rebuild the kernel
	using the instructions in <a class="xref" href="#kernelconfig-building" title="8.5. Building and Installing a Custom Kernel">Section 8.5, &#8220;Building and Installing a Custom Kernel&#8221;</a>:</p><pre class="programlisting">options SCSI_DELAY=15000</pre><p>This tells the <acronym class="acronym">SCSI</acronym> bus to pause 15
	seconds during boot, to give the <acronym class="acronym">CD</acronym>
	drive every possible chance to answer the bus reset.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is possible to burn a file directly to
	  <acronym class="acronym">CD</acronym>, without creating an
	  <acronym class="acronym">ISO</acronym> 9660 file system.  This is known as
	  burning a raw data <acronym class="acronym">CD</acronym> and some people do
	  this for backup purposes.</p><p xmlns="http://www.w3.org/1999/xhtml">This type of disk can not be mounted as a normal data
	  <acronym class="acronym">CD</acronym>.  In order to retrieve the data burned
	  to such a <acronym class="acronym">CD</acronym>, the data must be read from
	  the raw device node.  For example, this command will extract
	  a compressed tar file located on the second
	  <acronym class="acronym">CD</acronym> device into the current working
	  directory:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tar xzvf /dev/<em class="replaceable"><code>cd1</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">  In order to mount a data <acronym class="acronym">CD</acronym>, the
	  data must be written using
	  <code class="command">mkisofs</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="duplicating-audiocds"></a>17.5.5. Duplicating Audio <acronym class="acronym">CD</acronym>s</h3></div></div></div><p>To duplicate an audio <acronym class="acronym">CD</acronym>, extract the
	audio data from the <acronym class="acronym">CD</acronym> to a series of
	files, then write these files to a blank
	<acronym class="acronym">CD</acronym>.</p><p><a class="xref" href="#using-cdrecord" title="Procedure 17.1. Duplicating an Audio CD">Procedure 17.1, &#8220;Duplicating an Audio <acronym class="acronym">CD</acronym>&#8221;</a> describes how to
	duplicate and burn an audio <acronym class="acronym">CD</acronym>.  If the
	FreeBSD version is less than 10.0 and the device is
	<acronym class="acronym">ATAPI</acronym>, the <code class="option">atapicam</code> module
	must be first loaded using the instructions in <a class="xref" href="#atapicam" title="17.5.1. Supported Devices">Section 17.5.1, &#8220;Supported Devices&#8221;</a>.</p><div class="procedure"><a id="using-cdrecord"></a><div class="procedure-title">Procedure 17.1. Duplicating an Audio <acronym class="acronym">CD</acronym></div><ol class="procedure" type="1"><li class="step"><p>The <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a> package or
	    port installs <code class="command">cdda2wav</code>.  This command
	    can be used to extract all of the audio tracks, with each
	    track written to a separate <acronym class="acronym">WAV</acronym> file in
	    the current working directory:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cdda2wav -vall -B -Owav</code></strong></pre><p>A device name does not need to be specified if there
	    is only one <acronym class="acronym">CD</acronym> device on the system.
	    Refer to the <code class="command">cdda2wav</code> manual page for
	    instructions on how to specify a device and to learn more
	    about the other options available for this command.</p></li><li class="step"><p>Use <code class="command">cdrecord</code> to write the
	    <code class="filename">.wav</code> files:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cdrecord -v dev=<em class="replaceable"><code>2,0</code></em> -dao -useinfo  *.wav</code></strong></pre><p>Make sure that <em class="replaceable"><code>2,0</code></em> is set
	    appropriately, as described in <a class="xref" href="#cdrecord" title="17.5.2. Burning a CD">Section 17.5.2, &#8220;Burning a <acronym class="acronym">CD</acronym>&#8221;</a>.</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="creating-dvds"></a>17.6. Creating and Using <acronym class="acronym">DVD</acronym> Media</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div><div><span class="authorgroup">With inputs from <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Andy</span> <span class="surname">Polyakov</span></span>. </span></div></div></div><a id="idp60197624" class="indexterm"></a><p>Compared to the <acronym class="acronym">CD</acronym>, the
      <acronym class="acronym">DVD</acronym> is the next generation of optical media
      storage technology.  The <acronym class="acronym">DVD</acronym> can hold more
      data than any <acronym class="acronym">CD</acronym> and is the standard for
      video publishing.</p><p>Five physical recordable formats can be defined for a
      recordable <acronym class="acronym">DVD</acronym>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>DVD-R: This was the first <acronym class="acronym">DVD</acronym>
	  recordable format available.  The DVD-R standard is defined
	  by the <a class="link" href="http://www.dvdforum.org/forum.shtml" target="_top"><acronym class="acronym">DVD</acronym>
	    Forum</a>.  This format is write once.</p></li><li class="listitem"><p><acronym class="acronym">DVD-RW</acronym>: This is the rewritable
	  version of the DVD-R standard.  A
	  <acronym class="acronym">DVD-RW</acronym> can be rewritten about 1000
	  times.</p></li><li class="listitem"><p><acronym class="acronym">DVD-RAM</acronym>: This is a rewritable format
	  which can be seen as a removable hard drive.  However, this
	  media is not compatible with most
	  <acronym class="acronym">DVD-ROM</acronym> drives and DVD-Video players as
	  only a few <acronym class="acronym">DVD</acronym> writers support the
	  <acronym class="acronym">DVD-RAM</acronym> format.  Refer to <a class="xref" href="#creating-dvd-ram" title="17.6.8. Using a DVD-RAM">Section 17.6.8, &#8220;Using a <acronym class="acronym">DVD-RAM</acronym>&#8221;</a> for more information on
	  <acronym class="acronym">DVD-RAM</acronym> use.</p></li><li class="listitem"><p><acronym class="acronym">DVD+RW</acronym>: This is a rewritable format
	  defined by the <a class="link" href="https://en.wikipedia.org/wiki/DVD%2BRW_Alliance" target="_top">
	    <acronym class="acronym">DVD+RW</acronym> Alliance</a>.  A
	  <acronym class="acronym">DVD+RW</acronym> can be rewritten about 1000
	    times.</p></li><li class="listitem"><p>DVD+R: This format is the write once variation of the
	  <acronym class="acronym">DVD+RW</acronym> format.</p></li></ul></div><p>A single layer recordable <acronym class="acronym">DVD</acronym> can hold up
      to 4,700,000,000 bytes which is actually 4.38 GB or
      4485 MB as 1 kilobyte is 1024 bytes.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">A distinction must be made between the physical media and
	the application.  For example, a DVD-Video is a specific file
	layout that can be written on any recordable
	<acronym class="acronym">DVD</acronym> physical media such as DVD-R, DVD+R, or
	<acronym class="acronym">DVD-RW</acronym>.  Before choosing the type of media,
	ensure that both the burner and the DVD-Video player are
	compatible with the media under consideration.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60218104"></a>17.6.1. Configuration</h3></div></div></div><p>To perform <acronym class="acronym">DVD</acronym> recording, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a>.  This command is part of the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/dvd+rw-tools/pkg-descr">sysutils/dvd+rw-tools</a> utilities which
	support all <acronym class="acronym">DVD</acronym> media types.</p><p>These tools use the <acronym class="acronym">SCSI</acronym> subsystem to
	access the devices, therefore <a class="link" href="#atapicam" title="17.5.1. Supported Devices">ATAPI/CAM support</a> must be loaded
	or statically compiled into the kernel.  This support is not
	needed if the burner uses the <acronym class="acronym">USB</acronym>
	interface.  Refer to <a class="xref" href="#usb-disks" title="17.4. USB Storage Devices">Section 17.4, &#8220;<acronym class="acronym">USB</acronym> Storage Devices&#8221;</a> for more
	details on <acronym class="acronym">USB</acronym> device configuration.</p><p>DMA access must also be enabled for
	<acronym class="acronym">ATAPI</acronym> devices, by adding the following line
	to <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">hw.ata.atapi_dma="1"</pre><p>Before attempting to use
	<span class="application">dvd+rw-tools</span>, consult the <a class="link" href="http://fy.chalmers.se/~appro/linux/DVD+RW/hcn.html" target="_top">Hardware
	  Compatibility Notes</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">For a graphical user interface, consider using
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/k3b/pkg-descr">sysutils/k3b</a> which provides a user
	  friendly interface to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> and many other
	  burning tools.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60236792"></a>17.6.2. Burning Data <acronym class="acronym">DVD</acronym>s</h3></div></div></div><p>Since <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> is a front-end to <a class="link" href="#mkisofs" title="17.5.3. Writing Data to an ISO File System">mkisofs</a>, it will invoke
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a> to create the file system layout and perform
	the write on the <acronym class="acronym">DVD</acronym>.  This means that an
	image of the data does not need to be created before the
	burning process.</p><p>To burn to a DVD+R or a DVD-R the data in
	<code class="filename">/path/to/data</code>, use the following
	command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -dvd-compat -Z <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/data</code></em></code></strong></pre><p>In this example, <code class="option">-J -R</code> is passed to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a>  to create an ISO 9660 file system with Joliet
	and Rock Ridge extensions.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a> for more
	details.</p><p>For the initial session recording, <code class="option">-Z</code> is
	used for both single and multiple sessions.  Replace
	<em class="replaceable"><code>/dev/cd0</code></em>, with the name of the
	<acronym class="acronym">DVD</acronym> device.  Using
	<code class="option">-dvd-compat</code> indicates that the disk will be
	closed and that the recording will be unappendable.  This
	should also provide better media compatibility with
	<acronym class="acronym">DVD-ROM</acronym> drives.</p><p>To burn a pre-mastered image, such as
	<em class="replaceable"><code>imagefile.iso</code></em>, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -dvd-compat -Z <em class="replaceable"><code>/dev/cd0</code></em>=<em class="replaceable"><code>imagefile.iso</code></em></code></strong></pre><p>The write speed should be detected and automatically set
	according to the media and the drive being used.  To force the
	write speed, use  <code class="option">-speed=</code>.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> for example usage.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In order to support working files larger than 4.38GB, an
	  UDF/ISO-9660 hybrid file system must be created by passing
	  <code class="option">-udf -iso-level 3</code> to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a> and
	  all related programs, such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a>.  This is
	  required only when creating an ISO image file or when
	  writing files directly to a disk.  Since a disk created this
	  way must be mounted as an UDF file system with
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_udf&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_udf</span>(8)</span></a>, it will be usable only on an UDF aware
	  operating system.  Otherwise it will look as if it contains
	  corrupted files.</p><p xmlns="http://www.w3.org/1999/xhtml">To create this type of ISO file:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mkisofs -R -J -udf -iso-level 3 -o <em class="replaceable"><code>imagefile.iso</code></em> <em class="replaceable"><code>/path/to/data</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">To burn files directly to a disk:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -dvd-compat -udf -iso-level 3 -Z <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/data</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">When an ISO image already contains large files, no
	  additional options are required for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> to
	  burn that image on a disk.</p><p xmlns="http://www.w3.org/1999/xhtml">Be sure to use an up-to-date version of
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a>, which contains
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a>, as an older version may not contain large
	  files support.  If the latest version does not work, install
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools-devel/pkg-descr">sysutils/cdrtools-devel</a> and read its
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60280568"></a>17.6.3. Burning a <acronym class="acronym">DVD</acronym>-Video</h3></div></div></div><a id="idp60281592" class="indexterm"></a><p>A DVD-Video is a specific file layout based on the ISO
	9660 and micro-UDF (M-UDF) specifications.  Since DVD-Video
	presents a specific data structure hierarchy, a particular
	program such as <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/multimedia/dvdauthor/pkg-descr">multimedia/dvdauthor</a> is
	needed to author the <acronym class="acronym">DVD</acronym>.</p><p>If an image of the DVD-Video file system already exists,
	it can be burned in the same way as any other image.  If
	<code class="command">dvdauthor</code> was used to make the
	<acronym class="acronym">DVD</acronym> and the result is in
	<code class="filename">/path/to/video</code>, the following command
	should be used to burn the DVD-Video:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -Z <em class="replaceable"><code>/dev/cd0</code></em> -dvd-video <em class="replaceable"><code>/path/to/video</code></em></code></strong></pre><p><code class="option">-dvd-video</code> is passed to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a>
	to instruct it to create a DVD-Video file system layout.
	This option implies the <code class="option">-dvd-compat</code>
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> option.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60298360"></a>17.6.4. Using a <acronym class="acronym">DVD+RW</acronym></h3></div></div></div><a id="idp60299256" class="indexterm"></a><p>Unlike CD-RW, a virgin <acronym class="acronym">DVD+RW</acronym> needs to
	be formatted before first use.  It is
	<span class="emphasis"><em>recommended</em></span> to let <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> take
	care of this automatically whenever appropriate.  However, it
	is possible to use <code class="command">dvd+rw-format</code> to format
	the <acronym class="acronym">DVD+RW</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dvd+rw-format <em class="replaceable"><code>/dev/cd0</code></em></code></strong></pre><p>Only perform this operation once and keep in mind that
	only virgin <acronym class="acronym">DVD+RW</acronym> medias need to be
	formatted.  Once formatted, the <acronym class="acronym">DVD+RW</acronym> can
	be burned as usual.</p><p>To burn a totally new file system and not just append some
	data onto a <acronym class="acronym">DVD+RW</acronym>, the media does not need
	to be blanked first.  Instead, write over the previous
	recording like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -Z <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/newdata</code></em></code></strong></pre><p>The <acronym class="acronym">DVD+RW</acronym> format supports appending
	data to a previous recording.  This operation consists of
	merging a new session to the existing one as it is not
	considered to be multi-session writing.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a>
	will <span class="emphasis"><em>grow</em></span> the ISO 9660 file system
	present on the media.</p><p>For example, to append data to a
	<acronym class="acronym">DVD+RW</acronym>, use the following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -M <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/nextdata</code></em></code></strong></pre><p>The same <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mkisofs</span>(8)</span></a> options used to burn the
	initial session should be used during next writes.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Use <code class="option">-dvd-compat</code> for better media
	  compatibility with <acronym class="acronym">DVD-ROM</acronym> drives.  When
	  using <acronym class="acronym">DVD+RW</acronym>, this option will not
	  prevent the addition of data.</p></div><p>To blank the media, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -Z <em class="replaceable"><code>/dev/cd0</code></em>=<em class="replaceable"><code>/dev/zero</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60338168"></a>17.6.5. Using a <acronym class="acronym">DVD-RW</acronym></h3></div></div></div><a id="idp60339064" class="indexterm"></a><p>A <acronym class="acronym">DVD-RW</acronym> accepts two disc formats:
	incremental sequential and restricted overwrite.  By default,
	<acronym class="acronym">DVD-RW</acronym> discs are in sequential
	format.</p><p>A virgin <acronym class="acronym">DVD-RW</acronym> can be directly written
	without being formatted.  However, a non-virgin
	<acronym class="acronym">DVD-RW</acronym> in sequential format needs to be
	blanked before writing a new initial session.</p><p>To blank a <acronym class="acronym">DVD-RW</acronym> in sequential
	mode:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dvd+rw-format -blank=full <em class="replaceable"><code>/dev/cd0</code></em></code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">A full blanking using <code class="option">-blank=full</code> will
	  take about one hour on a 1x media.  A fast blanking can be
	  performed using <code class="option">-blank</code>, if the
	  <acronym class="acronym">DVD-RW</acronym> will be recorded in Disk-At-Once
	  (DAO) mode.  To burn the <acronym class="acronym">DVD-RW</acronym> in DAO
	  mode, use the command:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -use-the-force-luke=dao -Z <em class="replaceable"><code>/dev/cd0</code></em>=<em class="replaceable"><code>imagefile.iso</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Since <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a> automatically attempts to detect
	  fast blanked media and engage DAO write,
	  <code class="option">-use-the-force-luke=dao</code> should not be
	  required.</p><p xmlns="http://www.w3.org/1999/xhtml">One should instead use restricted overwrite mode with
	  any <acronym class="acronym">DVD-RW</acronym> as this format is more
	  flexible than the default of incremental sequential.</p></div><p>To write data on a sequential <acronym class="acronym">DVD-RW</acronym>,
	use the same instructions as for the other
	<acronym class="acronym">DVD</acronym> formats:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -Z <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/data</code></em></code></strong></pre><p>To append some data to a previous recording, use
	<code class="option">-M</code> with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a>.  However, if data
	is appended on a <acronym class="acronym">DVD-RW</acronym> in incremental
	sequential mode, a new session will be created on the disc and
	the result will be a multi-session disc.</p><p>A <acronym class="acronym">DVD-RW</acronym> in restricted overwrite format
	does not need to be blanked before a new initial session.
	Instead, overwrite the disc with <code class="option">-Z</code>.  It is
	also possible to grow an existing ISO 9660 file system written
	on the disc with <code class="option">-M</code>.  The result will be a
	one-session <acronym class="acronym">DVD</acronym>.</p><p>To put a <acronym class="acronym">DVD-RW</acronym> in restricted overwrite
	format, the following command must be used:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dvd+rw-format <em class="replaceable"><code>/dev/cd0</code></em></code></strong></pre><p>To change back to sequential format, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dvd+rw-format -blank=full <em class="replaceable"><code>/dev/cd0</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60386040"></a>17.6.6. Multi-Session</h3></div></div></div><p>Few <acronym class="acronym">DVD-ROM</acronym> drives support
	multi-session DVDs and most of the time only read the first
	session.  DVD+R, DVD-R and <acronym class="acronym">DVD-RW</acronym> in
	sequential format can accept multiple sessions.  The notion
	of multiple sessions does not exist for the
	<acronym class="acronym">DVD+RW</acronym> and the <acronym class="acronym">DVD-RW</acronym>
	restricted overwrite formats.</p><p>Using the following command after an initial non-closed
	session on a DVD+R, DVD-R, or <acronym class="acronym">DVD-RW</acronym> in
	sequential format, will add a new session to the disc:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>growisofs -M <em class="replaceable"><code>/dev/cd0</code></em> -J -R <em class="replaceable"><code>/path/to/nextdata</code></em></code></strong></pre><p>Using this command with a <acronym class="acronym">DVD+RW</acronym> or a
	<acronym class="acronym">DVD-RW</acronym> in restricted overwrite mode will
	append data while merging the new session to the existing one.
	The result will be a single-session disc.  Use this method to
	add data after an initial write on these types of
	media.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Since some space on the media is used between each
	  session to mark the end and start of sessions, one should
	  add sessions with a large amount of data to optimize media
	  space.  The number of sessions is limited to 154 for a
	  DVD+R, about 2000 for a DVD-R, and 127 for a DVD+R Double
	  Layer.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60397048"></a>17.6.7. For More Information</h3></div></div></div><p>To obtain more information about a <acronym class="acronym">DVD</acronym>,
	use <code class="command">dvd+rw-mediainfo
	  <em class="replaceable"><code>/dev/cd0</code></em></code> while the
	disc in the specified drive.</p><p>More information about
	<span class="application">dvd+rw-tools</span> can be found in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">growisofs</span>(1)</span></a>, on the <a class="link" href="http://fy.chalmers.se/~appro/linux/DVD+RW/" target="_top">dvd+rw-tools
	  web site</a>, and in the <a class="link" href="http://lists.debian.org/cdwrite/" target="_top">cdwrite
	  mailing list</a> archives.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">When creating a problem report related to the use of
	  <span class="application">dvd+rw-tools</span>, always include the
	  output of <code class="command">dvd+rw-mediainfo</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="creating-dvd-ram"></a>17.6.8. Using a <acronym class="acronym">DVD-RAM</acronym></h3></div></div></div><a id="idp60404472" class="indexterm"></a><p><acronym class="acronym">DVD-RAM</acronym> writers can use either a
	<acronym class="acronym">SCSI</acronym> or <acronym class="acronym">ATAPI</acronym> interface.
	For <acronym class="acronym">ATAPI</acronym> devices, DMA access has to be
	enabled by adding the following line to
	<code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">hw.ata.atapi_dma="1"</pre><p>A <acronym class="acronym">DVD-RAM</acronym> can be seen as a removable
	hard drive.  Like any other hard drive, the
	<acronym class="acronym">DVD-RAM</acronym> must be formatted before it can be
	used.  In this example, the whole disk space will be formatted
	with a standard UFS2 file system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=<em class="replaceable"><code>/dev/acd0</code></em> bs=2k count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -Bw <em class="replaceable"><code>acd0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs <em class="replaceable"><code>/dev/acd0</code></em></code></strong></pre><p>The <acronym class="acronym">DVD</acronym> device,
	<code class="filename">acd0</code>, must be changed according to the
	configuration.</p><p>Once the <acronym class="acronym">DVD-RAM</acronym> has been formatted, it
	can be mounted as a normal hard drive:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount <em class="replaceable"><code>/dev/acd0</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre><p>Once mounted, the <acronym class="acronym">DVD-RAM</acronym> will be both
	readable and writeable.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="floppies"></a>17.7. Creating and Using Floppy Disks</h2></div></div></div><p>This section explains how to format a 3.5 inch floppy disk
      in FreeBSD.</p><div class="procedure"><a id="idp60422904"></a><div class="procedure-title">Procedure 17.2. Steps to Format a Floppy</div><p>A floppy disk needs to be low-level formatted before it
	can be used.  This is usually done by the vendor, but
	formatting is a good way to check media integrity.  To
	low-level format the floppy disk on FreeBSD, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fdformat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fdformat</span>(1)</span></a>.  When using this utility, make note of any
	error messages, as these can help determine if the disk is
	good or bad.</p><ol class="procedure" type="1"><li class="step"><p>To format the floppy, insert a new 3.5 inch floppy disk
	  into the first floppy drive and issue:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/sbin/fdformat -f 1440 /dev/fd0</code></strong></pre></li><li class="step"><p>After low-level formatting the disk, create a disk label
	  as it is needed by the system to determine the size of the
	  disk and its geometry.  The supported geometry values are
	  listed in <code class="filename">/etc/disktab</code>.</p><p>To write the disk label, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/bsdlabel -B -w /dev/fd0 fd1440</code></strong></pre></li><li class="step"><p>The floppy is now ready to be high-level formatted with
	  a file system.  The floppy's file system can be either UFS
	  or FAT, where FAT is generally a better choice for
	  floppies.</p><p>To format the floppy with FAT, issue:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/newfs_msdos /dev/fd0</code></strong></pre></li></ol></div><p>The disk is now ready for use.  To use the floppy, mount it
      with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_msdosfs</span>(8)</span></a>.  One can also install and use
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/mtools/pkg-descr">emulators/mtools</a> from the Ports
      Collection.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="backup-basics"></a>17.8. Backup Basics</h2></div></div></div><p>Implementing a backup plan is essential in order to have the
      ability to recover from disk failure, accidental file deletion,
      random file corruption, or complete machine destruction,
      including destruction of on-site backups.</p><p>The backup type and schedule will vary, depending upon the
      importance of the data, the granularity needed for file
      restores, and the amount of acceptable downtime.  Some possible
      backup techniques include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Archives of the whole system, backed up onto permanent,
	  off-site media.  This provides protection against all of the
	  problems listed above, but is slow and inconvenient to
	  restore from, especially for non-privileged users.</p></li><li class="listitem"><p>File system snapshots, which are useful for restoring
	  deleted files or previous versions of files.</p></li><li class="listitem"><p>Copies of whole file systems or disks which are
	  synchronized with another system on the network using a
	  scheduled <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/rsync/pkg-descr">net/rsync</a>.</p></li><li class="listitem"><p>Hardware or software <acronym class="acronym">RAID</acronym>, which
	  minimizes or avoids downtime when a disk fails.</p></li></ul></div><p>Typically, a mix of backup techniques is used.  For
      example, one could create a schedule to automate a weekly, full
      system backup that is stored off-site and to supplement this
      backup with hourly ZFS snapshots.  In addition, one could make a
      manual backup of individual directories or files before making
      file edits or deletions.</p><p>This section describes some of the utilities which can be
      used to create and manage backups on a FreeBSD system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60448760"></a>17.8.1. File System Backups</h3></div></div></div><a id="idp60449400" class="indexterm"></a><a id="idp60450552" class="indexterm"></a><a id="idp60451448" class="indexterm"></a><p>The traditional <span class="trademark">UNIX</span>® programs for backing up a file
	system are <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a>, which creates the backup, and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></a>, which restores the backup.  These utilities
	work at the disk block level, below the abstractions of the
	files, links, and directories that are created by file
	systems.  Unlike other backup software,
	<code class="command">dump</code> backs up an entire file system and is
	unable to backup only part of a file system or a directory
	tree that spans multiple file systems.  Instead of writing
	files and directories, <code class="command">dump</code> writes the raw
	data blocks that comprise files and directories.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If <code class="command">dump</code> is used on the root
	  directory, it will not back up <code class="filename">/home</code>,
	  <code class="filename">/usr</code> or many other directories since
	  these are typically mount points for other file systems or
	  symbolic links into those file systems.</p></div><p>When used to restore data, <code class="command">restore</code>
	stores temporary files in <code class="filename">/tmp/</code> by
	default.  When using a recovery disk with a small
	<code class="filename">/tmp</code>, set <code class="envar">TMPDIR</code> to a
	directory with more free space in order for the restore to
	succeed.</p><p>When using <code class="command">dump</code>, be aware that some
	quirks remain from its early days in Version 6 of
	AT&amp;T <span class="trademark">UNIX</span>®,circa 1975.  The default parameters assume a
	backup to a 9-track tape, rather than to another type of media
	or to the high-density tapes available today.  These defaults
	must be overridden on the command line.</p><a id="idp60464760" class="indexterm"></a><p>It is possible to backup a file system across the network
	to a another system or to a tape drive attached to another
	computer.  While the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rdump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rdump</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rrestore&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rrestore</span>(8)</span></a>
	utilities can be used for this purpose, they are not
	considered to be secure.</p><p>Instead, one can use <code class="command">dump</code> and
	<code class="command">restore</code> in a more secure fashion over an
	<acronym class="acronym">SSH</acronym> connection.  This example creates a
	full, compressed backup of <code class="filename">/usr</code> and sends
	the backup file to the specified host over a
	<acronym class="acronym">SSH</acronym> connection.</p><div class="example"><a id="idp60469880"></a><div class="example-title">Example 17.1. Using <code class="command">dump</code> over
	  <span class="application">ssh</span></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \
          targetuser@targetmachine.example.com dd of=/mybigfiles/dump-usr-l0.gz</code></strong></pre></div></div><br class="example-break" /><p>This example sets <code class="envar">RSH</code> in order to write the
	backup to a tape drive on a remote system over a
	<acronym class="acronym">SSH</acronym> connection:</p><div class="example"><a id="idp60473336"></a><div class="example-title">Example 17.2. Using <code class="command">dump</code> over
	  <span class="application">ssh</span> with <code class="envar">RSH</code>
	  Set</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>env RSH=/usr/bin/ssh /sbin/dump -0uan -f targetuser@targetmachine.example.com:/dev/sa0 /usr</code></strong></pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60476280"></a>17.8.2. Directory Backups</h3></div></div></div><a id="idp60476920" class="indexterm"></a><p>Several built-in utilities are available for backing up
	and restoring specified files and directories as
	needed.</p><p>A good choice for making a backup of all of the files in a
	directory is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a>.  This utility dates back to Version
	6 of AT&amp;T <span class="trademark">UNIX</span>® and by default assumes a recursive backup
	to a local tape  device.  Switches can be used to instead
	specify the name of a backup file.</p><a id="idp60480376" class="indexterm"></a><p>This example creates a compressed backup of the current
	directory and saves it to
	<code class="filename">/tmp/mybackup.tgz</code>.  When creating a
	backup file, make sure that the backup is not saved to the
	same directory that is being backed up.</p><div class="example"><a id="idp60481912"></a><div class="example-title">Example 17.3. Backing Up the Current Directory with
	  <code class="command">tar</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tar czvf <em class="replaceable"><code>/tmp/mybackup.tgz</code></em> . </code></strong></pre></div></div><br class="example-break" /><p>To restore the entire backup, <code class="command">cd</code> into
	the directory to restore into and specify the name of the
	backup.  Note that this will overwrite any newer versions of
	files in the restore directory.  When in doubt, restore to a
	temporary directory or specify the name of the file within the
	backup to restore.</p><div class="example"><a id="idp60501368"></a><div class="example-title">Example 17.4. Restoring Up the Current Directory with
	  <code class="command">tar</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tar xzvf <em class="replaceable"><code>/tmp/mybackup.tgz</code></em></code></strong></pre></div></div><br class="example-break" /><p>There are dozens of available switches which are described
	in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a>.  This utility also supports the use of exclude
	patterns to specify which files should not be included when
	backing up the specified directory or restoring files from a
	backup.</p><a id="idp60504696" class="indexterm"></a><p>To create a backup using a specified list of files and
	directories, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a> is a good choice.  Unlike
	<code class="command">tar</code>, <code class="command">cpio</code> does not know
	how to walk the directory tree and it must be provided the
	list of files to backup.</p><p>For example, a list of files can be created using
	<code class="command">ls</code> or <code class="command">find</code>.  This
	example creates a recursive listing of the current directory
	which is then piped to  <code class="command">cpio</code> in order to
	create an output backup file named
	<code class="filename">/tmp/mybackup.cpio</code>.</p><div class="example"><a id="idp60509816"></a><div class="example-title">Example 17.5. Using <code class="command">ls</code> and <code class="command">cpio</code>
	  to Make a Recursive Backup of the Current Directory</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls -R | cpio -ovF <em class="replaceable"><code>/tmp/mybackup.cpio</code></em></code></strong></pre></div></div><br class="example-break" /><a id="idp60512504" class="indexterm"></a><a id="idp60513784" class="indexterm"></a><a id="idp60514424" class="indexterm"></a><a id="idp60514936" class="indexterm"></a><p>A backup utility which tries to bridge the features
	provided by <code class="command">tar</code> and <code class="command">cpio</code>
	is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pax&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pax</span>(1)</span></a>.  Over the years, the various versions of
	<code class="command">tar</code> and <code class="command">cpio</code> became
	slightly incompatible.  <span class="trademark">POSIX</span>® created <code class="command">pax</code>
	which attempts to read and write many of the various
	<code class="command">cpio</code> and <code class="command">tar</code> formats,
	plus new formats of its own.</p><p>The <code class="command">pax</code> equivalent to the previous
	examples would be:</p><div class="example"><a id="idp60524664"></a><div class="example-title">Example 17.6. Backing Up the Current Directory with
	  <code class="command">pax</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pax -wf <em class="replaceable"><code>/tmp/mybackup.pax</code></em> .</code></strong></pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="backups-tapebackups"></a>17.8.3. Using Data Tapes for Backups</h3></div></div></div><a id="idp60527864" class="indexterm"></a><p>While tape technology has continued to evolve, modern
	backup systems tend to combine off-site backups with local
	removable media.  FreeBSD supports any tape drive that uses
	<acronym class="acronym">SCSI</acronym>, such as <acronym class="acronym">LTO</acronym> or
	<acronym class="acronym">DAT</acronym>.  There is limited support for
	<acronym class="acronym">SATA</acronym> and <acronym class="acronym">USB</acronym> tape
	drives.</p><p>For <acronym class="acronym">SCSI</acronym> tape devices, FreeBSD uses the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sa&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sa</span>(4)</span></a> driver and the <code class="filename">/dev/sa0</code>,
	<code class="filename">/dev/nsa0</code>, and
	<code class="filename">/dev/esa0</code> devices.  The physical device
	name is <code class="filename">/dev/sa0</code>.  When
	<code class="filename">/dev/nsa0</code> is used, the backup application
	will not rewind the tape after writing a file, which allows
	writing more than one file to a tape.  Using
	<code class="filename">/dev/esa0</code> ejects the tape after the
	device is closed.</p><p>In FreeBSD, <code class="command">mt</code> is used to control
	operations of the tape drive, such as seeking through files on
	a tape or writing tape control marks to the tape.  For
	example, the first three files on a tape can be preserved by
	skipping past them before writing a new file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mt -f /dev/nsa0 fsf 3</code></strong></pre><p>This utility supports many operations.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mt&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mt</span>(1)</span></a> for details.</p><p>To write a single file to tape using
	<code class="command">tar</code>, specify the name of the tape device
	and the file to backup:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tar cvf /dev/sa0 <em class="replaceable"><code>file</code></em></code></strong></pre><p>To recover files from a <code class="command">tar</code> archive
	on tape into the current directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tar xvf /dev/sa0</code></strong></pre><p>To backup a <acronym class="acronym">UFS</acronym> file system, use
	<code class="command">dump</code>.  This examples backs up
	<code class="filename">/usr</code> without rewinding the tape when
	finished:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dump -0aL -b64 -f /dev/nsa0 /usr</code></strong></pre><p>To interactively restore files from a
	<code class="command">dump</code> file on tape into the current
	directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>restore -i -f /dev/nsa0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="backups-programs-amanda"></a>17.8.4. Third-Party Backup Utilities</h3></div></div></div><a id="idp60554104" class="indexterm"></a><p>The FreeBSD Ports Collection provides many third-party
	utilities which can be used to schedule the creation of
	backups, simplify tape backup, and make backups easier and
	more convenient.  Many of these applications are client/server
	based and can be used to automate the backups of a single
	system or all of the computers in a network.</p><p>Popular utilities include
	<span class="application">Amanda</span>,
	<span class="application">Bacula</span>,
	<span class="application">rsync</span>, and
	<span class="application">duplicity</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60557304"></a>17.8.5. Emergency Recovery</h3></div></div></div><p>In addition to regular backups, it is recommended to
	perform the following steps as part of an emergency
	preparedness plan.</p><a id="idp60570744" class="indexterm"></a><p>Create a print copy of the output of the following
	commands:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="command">gpart show</code></p></li><li class="listitem"><p><code class="command">more /etc/fstab</code></p></li><li class="listitem"><p><code class="command">dmesg</code></p></li></ul></div><a id="idp60574968" class="indexterm"></a><p>Store this printout and a copy of the installation media
	in a secure location.  Should an emergency restore be
	needed, boot into the installation media and select
	<code class="literal">Live CD</code> to access a rescue shell.  This
	rescue mode can be used to view the current state of the
	system, and if needed, to  reformat disks and restore data
	from backups.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The installation media for
	  FreeBSD/i386 11.2-RELEASE does not
	  include a rescue shell.  For this version, instead
	  download and burn a Livefs <acronym class="acronym">CD</acronym> image from
	  <code class="uri"><a class="uri" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/11.2/FreeBSD-11.2-RELEASE-i386-livefs.iso" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/11.2/FreeBSD-11.2-RELEASE-i386-livefs.iso</a></code>.</p></div><p>Next, test the rescue shell and the backups.  Make notes
	of the procedure.  Store these notes with the media, the
	printouts, and the backups.  These notes may prevent the
	inadvertent destruction of the backups while under the stress
	of performing an emergency recovery.</p><p>For an added measure of security, store the latest backup
	at a remote location which is physically separated from the
	computers and disk drives by a significant distance.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-virtual"></a>17.9. Memory Disks</h2></div><div><span class="authorgroup">Reorganized and enhanced by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><p>In addition to physical disks, FreeBSD also supports the
      creation and use of memory disks.  One possible use for a
      memory disk is to access the contents of an
      <acronym class="acronym">ISO</acronym> file system without the overhead of first
      burning it to a <acronym class="acronym">CD</acronym> or <acronym class="acronym">DVD</acronym>,
      then mounting the <acronym class="acronym">CD/DVD</acronym> media.</p><p>In FreeBSD, the  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> driver is used to provide support
      for memory disks.  The <code class="filename">GENERIC</code> kernel
      includes this driver.  When using a custom kernel configuration
      file, ensure it includes this line:</p><pre class="programlisting">device md</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-mdconfig"></a>17.9.1. Attaching and Detaching Existing Images</h3></div></div></div><a id="idp60603768" class="indexterm"></a><p>To mount an existing file system image, use
	<code class="command">mdconfig</code> to specify the name of the
	<acronym class="acronym">ISO</acronym> file and a free unit number.  Then,
	refer to that unit number to mount it on an existing mount
	point.  Once mounted, the files in the <acronym class="acronym">ISO</acronym>
	will appear in the mount point.  This example attaches
	<em class="replaceable"><code>diskimage.iso</code></em> to the memory device
	<code class="filename">/dev/md0</code> then mounts that memory device
	on <code class="filename">/mnt</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -f <em class="replaceable"><code>diskimage.iso</code></em> -u <em class="replaceable"><code>0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t cd9660 /dev/md<em class="replaceable"><code>0</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre><p>Notice that <code class="option">-t cd9660</code> was used to mount
	an ISO format.  If a unit number is not specified with
	<code class="option">-u</code>, <code class="command">mdconfig</code> will
	automatically allocate an unused memory device and output
	the name of the allocated unit, such as
	<code class="filename">md4</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> for more
	details about this command and its options.</p><a id="idp60613240" class="indexterm"></a><p>When a memory disk is no longer in use, its resources
	should be released back to the system.  First, unmount the
	file system, then use <code class="command">mdconfig</code> to detach
	the disk from the system and release its resources.  To
	continue this example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mdconfig -d -u <em class="replaceable"><code>0</code></em></code></strong></pre><p>To determine if any memory disks are still attached to the
	system, type <code class="command">mdconfig -l</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-md-freebsd5"></a>17.9.2. Creating a File- or Memory-Backed Memory Disk</h3></div></div></div><a id="idp60618744" class="indexterm"></a><p>FreeBSD also supports memory disks where the storage to use
	is allocated from either a hard disk or an area of memory.
	The first method is commonly referred to as a file-backed file
	system and the second method as a memory-backed file system.
	Both types can be created using
	<code class="command">mdconfig</code>.</p><p>To create a new memory-backed file system, specify a type
	of <code class="literal">swap</code> and the size of the memory disk to
	create.  Then, format the memory disk with a file system and
	mount as usual.  This example creates a 5M memory disk on unit
	<code class="literal">1</code>.  That memory disk is then formatted with
	the <acronym class="acronym">UFS</acronym> file system before it is
	mounted:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t swap -s <em class="replaceable"><code>5</code></em>m -u <em class="replaceable"><code>1</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U md<em class="replaceable"><code>1</code></em></code></strong>
/dev/md1: 5.0MB (10240 sectors) block size 16384, fragment size 2048
        using 4 cylinder groups of 1.27MB, 81 blks, 192 inodes.
        with soft updates
super-block backups (for fsck -b #) at:
 160, 2752, 5344, 7936
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/md<em class="replaceable"><code>1</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df <em class="replaceable"><code>/mnt</code></em></code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4718    4  4338     0%    /mnt</pre><p>To create a new file-backed memory disk, first allocate an
	area of disk to use.  This example creates an empty 5MB file
	named <code class="filename">newimage</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=<em class="replaceable"><code>newimage</code></em> bs=1k count=<em class="replaceable"><code>5</code></em>k</code></strong>
5120+0 records in
5120+0 records out</pre><p>Next, attach that file to a memory disk, label the memory
	disk and format it with the <acronym class="acronym">UFS</acronym> file
	system, mount the memory disk, and verify the size of the
	file-backed disk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -f <em class="replaceable"><code>newimage</code></em> -u <em class="replaceable"><code>0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -w md<em class="replaceable"><code>0</code></em> auto</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U md<em class="replaceable"><code>0</code></em>a</code></strong>
/dev/md0a: 5.0MB (10224 sectors) block size 16384, fragment size 2048
        using 4 cylinder groups of 1.25MB, 80 blks, 192 inodes.
super-block backups (for fsck -b #) at:
 160, 2720, 5280, 7840
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/md<em class="replaceable"><code>0</code></em>a <em class="replaceable"><code>/mnt</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df <em class="replaceable"><code>/mnt</code></em></code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0a       4710    4  4330     0%    /mnt</pre><p>It takes several commands to create a file- or
	memory-backed file system using <code class="command">mdconfig</code>.
	FreeBSD also comes with <code class="command">mdmfs</code> which
	automatically configures a memory disk, formats it with the
	<acronym class="acronym">UFS</acronym> file system, and mounts it.  For
	example, after creating <em class="replaceable"><code>newimage</code></em>
	with <code class="command">dd</code>, this one command is equivalent to
	running the <code class="command">bsdlabel</code>,
	<code class="command">newfs</code>, and <code class="command">mount</code>
	commands shown above:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdmfs -F <em class="replaceable"><code>newimage</code></em> -s <em class="replaceable"><code>5</code></em>m md<em class="replaceable"><code>0</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre><p>To instead create a new memory-based memory disk with
	<code class="command">mdmfs</code>, use this one command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdmfs -s <em class="replaceable"><code>5</code></em>m md<em class="replaceable"><code>1</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre><p>If the unit number is not specified,
	<code class="command">mdmfs</code> will automatically select an unused
	memory device.  For more details about
	<code class="command">mdmfs</code>, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="snapshots"></a>17.10. File System Snapshots</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp60675704" class="indexterm"></a><p>FreeBSD offers a feature in conjunction with
      <a class="link" href="#soft-updates" title="11.10.2. Soft Updates">Soft Updates</a>: file system
      snapshots.</p><p>UFS snapshots allow a user to create images of specified
      file systems, and treat them as a file.  Snapshot files must be
      created in the file system that the action is performed on, and
      a user may create no more than 20 snapshots per file system.
      Active snapshots are recorded in the superblock so they are
      persistent across unmount and remount operations along with
      system reboots.  When a snapshot is no longer required, it can
      be removed using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rm&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rm</span>(1)</span></a>.  While snapshots may be removed in
      any order, all the used space may not be acquired because
      another snapshot will possibly claim some of the released
      blocks.</p><p>The un-alterable <code class="option">snapshot</code> file flag is set
      by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mksnap_ffs</span>(8)</span></a> after initial creation of a snapshot file.
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=unlink&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">unlink</span>(1)</span></a> makes an exception for snapshot files since it
      allows them to be removed.</p><p>Snapshots are created using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.  To place a
      snapshot of <code class="filename">/var</code> in the
      file <code class="filename">/var/snapshot/snap</code>, use the following
      command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -u -o snapshot /var/snapshot/snap /var</code></strong></pre><p>Alternatively, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mksnap_ffs</span>(8)</span></a> to create the
      snapshot:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mksnap_ffs /var /var/snapshot/snap</code></strong></pre><p>One can find snapshot files on a file system, such as
      <code class="filename">/var</code>, using
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=find&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">find</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>find /var -flags snapshot</code></strong></pre><p>Once a snapshot has been created, it has several
      uses:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Some administrators will use a snapshot file for backup
	  purposes, because the snapshot can be transferred to
	  <acronym class="acronym">CD</acronym>s or tape.</p></li><li class="listitem"><p>The file system integrity checker, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>, may be
	  run on the snapshot.  Assuming that the file system was
	  clean when it was mounted, this should always provide a
	  clean and unchanging result.</p></li><li class="listitem"><p>Running <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> on the snapshot will produce a dump
	  file that is consistent with the file system and the
	  timestamp of the snapshot.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> can also take a
	  snapshot, create a dump image, and then remove the snapshot
	  in one command by using <code class="option">-L</code>.</p></li><li class="listitem"><p>The snapshot can be mounted as a frozen image of the
	  file system.  To <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> the snapshot
	  <code class="filename">/var/snapshot/snap</code> run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -o readonly -f /var/snapshot/snap -u 4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -r /dev/md4 /mnt</code></strong></pre></li></ul></div><p>The frozen <code class="filename">/var</code> is now available
      through <code class="filename">/mnt</code>.  Everything will initially be
      in the same state it was during the snapshot creation time.  The
      only exception is that any earlier snapshots will appear as zero
      length files.  To unmount the snapshot, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mdconfig -d -u 4</code></strong></pre><p>For more information about <code class="option">softupdates</code> and
      file system snapshots, including technical papers, visit
      Marshall Kirk McKusick's website at <code class="uri"><a class="uri" href="http://www.mckusick.com/" target="_top">http://www.mckusick.com/</a></code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="quotas"></a>17.11. Disk Quotas</h2></div></div></div><a id="idp60719864" class="indexterm"></a><a id="idp60721016" class="indexterm"></a><p>Disk quotas can be used to limit the amount of disk space or
      the number of files a user or members of a group may allocate on
      a per-file system basis.  This prevents one user or group of
      users from consuming all of the available disk space.</p><p>This section describes how to configure disk quotas for the
      <acronym class="acronym">UFS</acronym> file system.  To configure quotas on the
      <acronym class="acronym">ZFS</acronym> file system, refer to <a class="xref" href="#zfs-zfs-quota" title="19.4.8. Dataset, User, and Group Quotas">Section 19.4.8, &#8220;Dataset, User, and Group Quotas&#8221;</a></p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60727416"></a>17.11.1. Enabling Disk Quotas</h3></div></div></div><p>To determine if the FreeBSD kernel provides support for disk
	quotas:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sysctl kern.features.ufs_quota</code></strong>
kern.features.ufs_quota: 1</pre><p>In this example, the <code class="literal">1</code> indicates quota
	support.  If the value is instead <code class="literal">0</code>, add
	the following line to a custom kernel configuration file and
	rebuild the kernel using the instructions in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>:</p><pre class="programlisting">options QUOTA</pre><p>Next, enable disk quotas in
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">quota_enable="YES"</pre><a id="idp60732664" class="indexterm"></a><p>Normally on bootup, the quota integrity of each file
	system is checked by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>.  This program insures
	that the data in the quota database properly reflects the data
	on the file system.  This is a time consuming process that
	will significantly affect the time the system takes to boot.
	To skip this step, add this variable to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">check_quotas="NO"</pre><p>Finally, edit <code class="filename">/etc/fstab</code> to enable
	disk quotas on a per-file system basis.  To enable per-user
	quotas on a file system, add <code class="option">userquota</code> to the
	options field in the <code class="filename">/etc/fstab</code> entry for
	the file system to enable quotas on.  For example:</p><pre class="programlisting">/dev/da1s2g   /home    ufs rw,userquota 1 2</pre><p>To enable group quotas, use <code class="option">groupquota</code>
	instead.  To enable both user and group quotas, separate the
	options with a comma:</p><pre class="programlisting">/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</pre><p>By default, quota files are stored in the root directory
	of the file system as <code class="filename">quota.user</code> and
	<code class="filename">quota.group</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> for
	more information.  Specifying an alternate location for the
	quota files is not recommended.</p><p>Once the configuration is complete, reboot the system and
	<code class="filename">/etc/rc</code> will automatically run the
	appropriate commands to create the initial quota files for all
	of the quotas enabled in
	<code class="filename">/etc/fstab</code>.</p><p>In the normal course of operations, there should be no
	need to manually run <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=quotaon&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">quotaon</span>(8)</span></a>, or
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=quotaoff&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">quotaoff</span>(8)</span></a>.  However, one should read these manual pages
	to be familiar with their operation.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60748920"></a>17.11.2. Setting Quota Limits</h3></div></div></div><a id="idp60749560" class="indexterm"></a><p>To
	verify that quotas are enabled, run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>quota -v</code></strong></pre><p>There should be a one line summary of disk usage and
	current quota limits for each file system that quotas are
	enabled on.</p><p>The system is now ready to be assigned quota limits with
	<code class="command">edquota</code>.</p><p>Several options are available to enforce limits on the
	amount of disk space a user or group may allocate, and how
	many files they may create.  Allocations can be limited based
	on disk space (block quotas), number of files (inode quotas),
	or a combination of both.  Each limit is further broken down
	into two categories: hard and soft limits.</p><a id="idp60753656" class="indexterm"></a><p>A hard limit may not be exceeded.  Once a user reaches a
	hard limit, no further allocations can be made on that file
	system by that user.  For example, if the user has a hard
	limit of 500 kbytes on a file system and is currently using
	490 kbytes, the user can only allocate an additional 10
	kbytes.  Attempting to allocate an additional 11 kbytes will
	fail.</p><a id="idp60754552" class="indexterm"></a><p>Soft limits can be exceeded for a limited amount of time,
	known as the grace period, which is one week by default.  If a
	user stays over their limit longer than the grace period, the
	soft limit turns into a hard limit and no further allocations
	are allowed.  When the user drops back below the soft limit,
	the grace period is reset.</p><p>In the following example, the quota for the <code class="systemitem">test</code> account is being edited.
	When <code class="command">edquota</code> is invoked, the editor
	specified by <code class="envar">EDITOR</code> is opened in order to edit
	the quota limits.  The default editor is set to
	<span class="application">vi</span>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>edquota -u test</code></strong>
Quotas for user test:
/usr: kbytes in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: kbytes in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</pre><p>There are normally two lines for each file system that has
	quotas enabled.  One line represents the block limits and the
	other represents the inode limits.  Change the value to modify
	the quota limit.  For example, to raise the block limit on
	<code class="filename">/usr</code> to a soft limit of
	<code class="literal">500</code> and a hard limit of
	<code class="literal">600</code>, change the values in that line as
	follows:</p><pre class="programlisting">/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</pre><p>The new quota limits take effect upon exiting the
	editor.</p><p>Sometimes it is desirable to set quota limits on a range
	of users.  This can be done by first assigning the desired
	quota limit to a user.  Then, use <code class="option">-p</code> to
	duplicate that quota to a specified range of user IDs
	(<acronym class="acronym">UID</acronym>s).  The following command will
	duplicate those quota limits for <acronym class="acronym">UID</acronym>s
	<code class="literal">10,000</code> through
	<code class="literal">19,999</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>edquota -p test 10000-19999</code></strong></pre><p>For more information, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60806264"></a>17.11.3. Checking Quota Limits and Disk Usage</h3></div></div></div><a id="idp60806904" class="indexterm"></a><p>To check individual user or group quotas and disk usage,
	use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a>.  A user may only examine their own quota
	and the quota of a group they are a member of.  Only the
	superuser may view all user and group quotas.  To get a
	summary of all quotas and disk usage for file systems with
	quotas enabled, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=repquota&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></a>.</p><p>Normally, file systems that the user is not using any disk
	space on will not show in the output of
	<code class="command">quota</code>, even if the user has a quota limit
	assigned for that file system.  Use <code class="option">-v</code> to
	display those file systems.  The following is sample output
	from <code class="command">quota -v</code> for a user that has quota
	limits on two file systems.</p><pre class="programlisting">Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</pre><a id="idp60811896" class="indexterm"></a><p>In this example, the user is currently 15 kbytes over the
	soft limit of 50 kbytes on <code class="filename">/usr</code> and has 5
	days of grace period left.  The asterisk <code class="literal">*</code>
	indicates that the user is currently over the quota
	limit.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60813688"></a>17.11.4. Quotas over NFS</h3></div></div></div><a id="idp60814328" class="indexterm"></a><p>Quotas are enforced by the quota subsystem on the
	<acronym class="acronym">NFS</acronym> server.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rpc.rquotad&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rpc.rquotad</span>(8)</span></a> daemon
	makes quota information available to <code class="command">quota</code>
	on <acronym class="acronym">NFS</acronym> clients, allowing users on those
	machines to see their quota statistics.</p><p>On the <acronym class="acronym">NFS</acronym> server, enable
	<code class="command">rpc.rquotad</code> by removing the
	<code class="literal">#</code> from this line in
	<code class="filename">/etc/inetd.conf</code>:</p><pre class="programlisting">rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</pre><p>Then, restart <code class="command">inetd</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service inetd restart</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-encrypting"></a>17.12. Encrypting Disk Partitions</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Lucky</span> <span class="surname">Green</span></span>. </span></div></div></div><a id="idp60830072" class="indexterm"></a><p>FreeBSD offers excellent online protections against
      unauthorized data access.  File permissions and <a class="link" href="#mac" title="Chapter 15. Mandatory Access Control">Mandatory Access Control</a> (MAC) help
      prevent unauthorized users from accessing data while the
      operating system is active and the computer is powered up.
      However, the permissions enforced by the operating system are
      irrelevant if an attacker has physical access to a computer and
      can move the computer's hard drive to another system to copy and
      analyze the data.</p><p>Regardless of how an attacker may have come into possession
      of a hard drive or powered-down computer, the
      <acronym class="acronym">GEOM</acronym>-based cryptographic subsystems built
      into FreeBSD are able to protect the data on the computer's file
      systems against even highly-motivated attackers with significant
      resources.  Unlike encryption methods that encrypt individual
      files, the built-in <code class="command">gbde</code> and
      <code class="command">geli</code> utilities can be used to transparently
      encrypt entire file systems.  No cleartext ever touches the hard
      drive's platter.</p><p>This chapter demonstrates how to create an encrypted file
      system on FreeBSD.  It first demonstrates the process using
      <code class="command">gbde</code> and then demonstrates the same example
      using <code class="command">geli</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60834936"></a>17.12.1. Disk Encryption with
	<span class="application">gbde</span></h3></div></div></div><p>The objective of the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gbde</span>(4)</span></a> facility is to provide a
	formidable challenge for an attacker to gain access to the
	contents of a <span class="emphasis"><em>cold</em></span> storage device.
	However, if the computer is compromised while up and running
	and the storage device is actively attached, or the attacker
	has access to a valid passphrase, it offers no protection to
	the contents of the storage device.  Thus, it is important to
	provide physical security while the system is running and to
	protect the passphrase used by the encryption
	mechanism.</p><p>This facility provides several barriers to protect the
	data stored in each disk sector.  It encrypts the contents of
	a disk sector using 128-bit <acronym class="acronym">AES</acronym> in
	<acronym class="acronym">CBC</acronym> mode.  Each sector on the disk is
	encrypted with a different <acronym class="acronym">AES</acronym> key.  For
	more information on the cryptographic design, including how
	the sector keys are derived from the user-supplied passphrase,
	refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gbde</span>(4)</span></a>.</p><p>FreeBSD provides a kernel module for
	<span class="application">gbde</span> which can be loaded with this
	command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload geom_bde</code></strong></pre><p>If using a custom kernel configuration file, ensure it
	contains this line:</p><p><code class="literal">options GEOM_BDE</code></p><p>The following example demonstrates adding a new hard drive
	to a system that will hold a single encrypted partition that
	will be mounted as <code class="filename">/private</code>.</p><div class="procedure"><a id="idp60859384"></a><div class="procedure-title">Procedure 17.3. Encrypting a Partition with
	  <span class="application">gbde</span></div><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Add the New Hard Drive</strong></p><p>Install the new drive to the system as explained in
	    <a class="xref" href="#disks-adding" title="17.2. Adding Disks">Section 17.2, &#8220;Adding Disks&#8221;</a>.  For the purposes of this
	    example, a new hard drive partition has been added as
	    <code class="filename">/dev/ad4s1c</code> and
	    <code class="filename">/dev/ad0s1<em class="replaceable"><code>*</code></em></code>
	    represents the existing standard FreeBSD partitions.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/ad*</code></strong>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</pre></li><li class="step"><p class="title"><strong>Create a Directory to Hold <code class="command">gbde</code>
	    Lock Files</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /etc/gbde</code></strong></pre><p>The <span class="application">gbde</span> lock file
	    contains information that <span class="application">gbde</span>
	    requires to access encrypted partitions.  Without access
	    to the lock file, <span class="application">gbde</span> will not
	    be able to decrypt the data contained in the encrypted
	    partition without significant manual intervention which is
	    not supported by the software.  Each encrypted partition
	    uses a separate lock file.</p></li><li class="step"><p class="title"><strong>Initialize the <code class="command">gbde</code>
	    Partition</strong></p><p>A <span class="application">gbde</span> partition must be
	    initialized before it can be used.  This initialization
	    needs to be performed only once.  This command will open
	    the default editor, in order to set various configuration
	    options in a template.  For use with the
	    <acronym class="acronym">UFS</acronym> file system, set the sector_size to
	    2048:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c.lock</code></strong>
# <span translate="no" class="phrase">$FreeBSD: src/sbin/gbde/template.txt,v 1.1.36.1 2009/08/03 08:13:06 kensmith Exp $</span>
#
# Sector size is the smallest unit of data which can be read or written.
# Making it too small decreases performance and decreases available space.
# Making it too large may prevent filesystems from working.  512 is the
# minimum and always safe.  For UFS, use the fragment size
#
sector_size	=	2048
[...]</pre><p>Once the edit is saved, the user will be asked twice
	    to type the passphrase used to secure the data.  The
	    passphrase must be the same both times.  The ability of
	    <span class="application">gbde</span> to protect data depends
	    entirely on the quality of the passphrase.  For tips on
	    how to select a secure passphrase that is easy to
	    remember, see <a class="link" href="http://world.std.com/~reinhold/diceware.html" target="_top">http://world.std.com/~reinhold/diceware.htm</a>.</p><p>This initialization creates a lock file for the
	    <span class="application">gbde</span> partition.  In this
	    example, it is stored as
	    <code class="filename">/etc/gbde/ad4s1c.lock</code>.  Lock files
	    must end in <span class="quote">&#8220;<span class="quote">.lock</span>&#8221;</span> in order to be correctly
	    detected by the <code class="filename">/etc/rc.d/gbde</code> start
	    up script.</p><div xmlns="" class="caution"><h3 class="admontitle">Caution: </h3><p xmlns="http://www.w3.org/1999/xhtml">Lock files <span class="emphasis"><em>must</em></span> be backed up
	      together with the contents of any encrypted partitions.
	      Without the lock file, the legitimate owner will be
	      unable to access the data on the encrypted
	      partition.</p></div></li><li class="step"><p class="title"><strong>Attach the Encrypted Partition to the
	    Kernel</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c.lock</code></strong></pre><p>This command will prompt to input the passphrase that
	    was selected during the initialization of the encrypted
	    partition.  The new encrypted device will appear in
	    <code class="filename">/dev</code> as
	    <code class="filename">/dev/device_name.bde</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/ad*</code></strong>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</pre></li><li class="step"><p class="title"><strong>Create a File System on the Encrypted
	    Device</strong></p><p>Once the encrypted device has been attached to the
	    kernel, a file system can be created on the device.  This
	    example creates a <acronym class="acronym">UFS</acronym> file system with
	    soft updates enabled.  Be sure to specify the partition
	    which has a
	    <code class="filename"><em class="replaceable"><code>*</code></em>.bde</code>
	    extension:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/ad4s1c.bde</code></strong></pre></li><li class="step"><p class="title"><strong>Mount the Encrypted Partition</strong></p><p>Create a mount point and mount the encrypted file
	    system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /private</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/ad4s1c.bde /private</code></strong></pre></li><li class="step"><p class="title"><strong>Verify That the Encrypted File System is
	    Available</strong></p><p>The encrypted file system should now be visible and
	    available for use:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>df -H</code></strong>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</pre></li></ol></div><p>After each boot, any encrypted file systems must be
	manually re-attached to the kernel, checked for errors, and
	mounted, before the file systems can be used.  To configure
	these steps, add the following lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">gbde_autoattach_all="YES"
gbde_devices="<em class="replaceable"><code>ad4s1c</code></em>"
gbde_lockdir="/etc/gbde"</pre><p>This requires that the passphrase be entered at the
	console at boot time.  After typing the correct passphrase,
	the encrypted partition will be mounted automatically.
	Additional <span class="application">gbde</span> boot options are
	available and listed in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">sysinstall</span> is incompatible
	  with <span class="application">gbde</span>-encrypted devices.  All
	  <code class="filename">*.bde</code> devices must be detached from the
	  kernel before starting <span class="application">sysinstall</span>
	  or it will crash during its initial probing for devices.  To
	  detach the encrypted device used in the example, use the
	  following command:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde detach /dev/<em class="replaceable"><code>ad4s1c</code></em></code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-encrypting-geli"></a>17.12.2. Disk Encryption with <code class="command">geli</code></h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Daniel</span> <span class="surname">Gerzo</span></span>. </span></div></div></div><p>An alternative cryptographic <acronym class="acronym">GEOM</acronym> class
	is available using <code class="command">geli</code>.  This control
	utility adds some features and uses a different scheme for
	doing cryptographic work.  It provides the following
	features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Utilizes the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crypto&amp;sektion=9&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crypto</span>(9)</span></a> framework and
	    automatically uses cryptographic hardware when it is
	    available.</p></li><li class="listitem"><p>Supports multiple cryptographic algorithms such as
	    <acronym class="acronym">AES</acronym>, Blowfish, and
	    <acronym class="acronym">3DES</acronym>.</p></li><li class="listitem"><p>Allows the root partition to be encrypted.  The
	    passphrase used to access the encrypted root partition
	    will be requested during system boot.</p></li><li class="listitem"><p>Allows the use of two independent keys.</p></li><li class="listitem"><p>It is fast as it performs simple sector-to-sector
	    encryption.</p></li><li class="listitem"><p>Allows backup and restore of master keys.  If a user
	    destroys their keys, it is still possible to get access to
	    the data by restoring keys from the backup.</p></li><li class="listitem"><p>Allows a disk to attach with a random, one-time key
	    which is useful for swap partitions and temporary file
	    systems.</p></li></ul></div><p>More features and usage examples can be found in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a>.</p><p>The following example describes how to generate a key file
	which will be used as part of the master key for the encrypted
	provider mounted under <code class="filename">/private</code>.  The key
	file will provide some random data used to encrypt the master
	key.  The master key will also be protected by a passphrase.
	The provider's sector size will be 4kB.  The example describes
	how to attach to the <code class="command">geli</code> provider, create
	a file system on it, mount it, work with it, and finally, how
	to detach it.</p><div class="procedure"><a id="idp60933624"></a><div class="procedure-title">Procedure 17.4. Encrypting a Partition with
	  <code class="command">geli</code></div><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Load <code class="command">geli</code> Support</strong></p><p>Support for <code class="command">geli</code> is available as a
	    loadable kernel module.  To configure the system to
	    automatically load the module at boot time, add the
	    following line to
	    <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">geom_eli_load="YES"</pre><p>To load the kernel module now:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload geom_eli</code></strong></pre><p>For a custom kernel, ensure the kernel configuration
	    file contains these lines:</p><pre class="programlisting">options GEOM_ELI
device crypto</pre></li><li class="step"><p class="title"><strong>Generate the Master Key</strong></p><p>The following commands generate a master key that all
	    data will be encrypted with.  This key can never be changed.
	    Rather than using it directly, it is encrypted with one
	    or more user keys.  The user keys are made up of an
	    optional combination of random bytes from a file,
	    <code class="filename">/root/da2.key</code>, and/or a passphrase.
	    In this case, the data source for the key file is
	    <code class="filename">/dev/random</code>. This command also
	    configures the sector size of the provider
	    (<code class="filename">/dev/da2.eli</code>) as 4kB, for better
	    performance:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/root/da2.key bs=64 count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>geli init -K /root/da2.key -s 4096 /dev/da2</code></strong>
Enter new passphrase:
Reenter new passphrase:</pre><p>It is not mandatory to use both a passphrase and a key
	    file as either method of securing the master key can be
	    used in isolation.</p><p>If the key file is given as <span class="quote">&#8220;<span class="quote">-</span>&#8221;</span>, standard
	    input will be used.  For example, this command generates
	    three key files:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat keyfile1 keyfile2 keyfile3 | geli init -K - /dev/da2</code></strong></pre></li><li class="step"><p class="title"><strong>Attach the Provider with the Generated Key</strong></p><p>To attach the provider, specify the key file, the name
	    of the disk, and the passphrase:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>geli attach -k /root/da2.key /dev/da2</code></strong>
Enter passphrase:</pre><p>This creates a new device with an
	    <code class="filename">.eli</code> extension:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/da2*</code></strong>
/dev/da2  /dev/da2.eli</pre></li><li class="step"><p class="title"><strong>Create the New File System</strong></p><p>Next, format the device with the
	    <acronym class="acronym">UFS</acronym> file system and mount it on an
	    existing mount point:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/dev/da2.eli bs=1m</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da2.eli</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/da2.eli <em class="replaceable"><code>/private</code></em></code></strong></pre><p>The encrypted file system should now be available for
	    use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>df -H</code></strong>
Filesystem     Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a    248M    89M   139M    38%    /
/devfs         1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f    7.7G   2.3G   4.9G    32%    /usr
/dev/ad0s1d    989M   1.5M   909M     0%    /tmp
/dev/ad0s1e    3.9G   1.3G   2.3G    35%    /var
/dev/da2.eli   150G   4.1K   138G     0%    /private</pre></li></ol></div><p>Once the work on the encrypted partition is done, and the
	<code class="filename">/private</code> partition is no longer needed,
	it is prudent to put the device into cold storage by
	unmounting and detaching the <code class="command">geli</code> encrypted
	partition from the kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /private</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>geli detach da2.eli</code></strong></pre><p>A <code class="filename">rc.d</code> script is provided to
	simplify the mounting of <code class="command">geli</code>-encrypted
	devices at boot time.  For this example, add these lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">geli_devices="<em class="replaceable"><code>da2</code></em>"
geli_da2_flags="-k /root/<em class="replaceable"><code>da2.key</code></em>"</pre><p>This configures <code class="filename">/dev/da2</code> as a
	<code class="command">geli</code> provider with a master key of
	<code class="filename">/root/da2.key</code>.  The system will
	automatically detach the provider from the kernel before the
	system shuts down.  During the startup process, the script
	will prompt for the passphrase before attaching the provider.
	Other kernel messages might be shown before and after the
	password prompt.  If the boot process seems to stall, look
	carefully for the password prompt among the other messages.
	Once the correct passphrase is entered, the provider is
	attached.  The file system is then mounted, typically by an
	entry in <code class="filename">/etc/fstab</code>.  Refer to <a class="xref" href="#mount-unmount" title="3.7. Mounting and Unmounting File Systems">Section 3.7, &#8220;Mounting and Unmounting File Systems&#8221;</a> for instructions on how to
	configure a file system to mount at boot time.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="swap-encrypting"></a>17.13. Encrypting Swap</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Christian</span> <span class="surname">Brueffer</span></span>. </span></div></div></div><a id="idp60987256" class="indexterm"></a><p>Like the encryption of disk partitions, encryption of swap
      space is used to protect sensitive information.  Consider an
      application that deals with passwords.  As long as these
      passwords stay in physical memory, they are not written to disk
      and will be cleared after a reboot.  However, if FreeBSD starts
      swapping out memory pages to free space, the passwords may be
      written to the disk unencrypted.  Encrypting swap space can be a
      solution for this scenario.</p><p>This section demonstrates how to configure an encrypted
      swap partition using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> encryption.
      It assumes that
      <code class="filename">/dev/ada0s1b</code> is the swap partition.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp60991096"></a>17.13.1. Configuring Encrypted Swap</h3></div></div></div><p>Swap partitions are not encrypted by default and should be
	cleared of any sensitive data before continuing.  To overwrite
	the current swap partition with random garbage, execute the
	following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/dev/<em class="replaceable"><code>ada0s1b</code></em> bs=1m</code></strong></pre><p>To encrypt the swap partition using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a>, add the
	<code class="literal">.bde</code> suffix to the swap line in
	<code class="filename">/etc/fstab</code>:</p><pre class="programlisting"># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.bde	none		swap	sw		0	0</pre><p>To instead encrypt the swap partition using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a>,
	use the
	<code class="literal">.eli</code> suffix:</p><pre class="programlisting"># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw		0	0</pre><p>By default, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> uses the <acronym class="acronym">AES</acronym>
	algorithm with a key length of 128 bits.  Normally the default
	settings will suffice.  If desired, these defaults can be
	altered in the options field in
	<code class="filename">/etc/fstab</code>.  The possible flags
	are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">aalgo</span></dt><dd><p>Data integrity verification algorithm used to ensure
	      that the encrypted data has not been tampered with.  See
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> for a list of supported algorithms.</p></dd><dt><span class="term">ealgo</span></dt><dd><p>Encryption algorithm used to protect the data.  See
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> for a list of supported algorithms.</p></dd><dt><span class="term">keylen</span></dt><dd><p>The length of the key used for the encryption
	      algorithm.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> for the key lengths that
	      are supported by each encryption algorithm.</p></dd><dt><span class="term">sectorsize</span></dt><dd><p>The size of the blocks data is broken into before
	      it is encrypted.  Larger sector sizes increase
	      performance at the cost of higher storage
	      overhead.  The recommended size is 4096 bytes.</p></dd></dl></div><p>This example configures an encrypted swap partition using
	the Blowfish algorithm with a key length of 128 bits and a
	sectorsize of 4 kilobytes:</p><pre class="programlisting"># Device		Mountpoint	FStype	Options				Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw,ealgo=blowfish,keylen=128,sectorsize=4096	0	0</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61017720"></a>17.13.2. Encrypted Swap Verification</h3></div></div></div><p>Once the system has rebooted, proper operation of the
	encrypted swap can be verified using
	<code class="command">swapinfo</code>.</p><p>If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> is being used:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>swapinfo</code></strong>
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.bde   542720        0   542720     0%</pre><p>If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> is being used:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>swapinfo</code></strong>
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.eli   542720        0   542720     0%</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-hast"></a>17.14. Highly Available Storage
	(<acronym class="acronym">HAST</acronym>)</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Daniel</span> <span class="surname">Gerzo</span></span>. </span></div><div><span class="authorgroup">With inputs from <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Freddie</span> <span class="surname">Cash</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Pawel Jakub</span> <span class="surname">Dawidek</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Michael W.</span> <span class="surname">Lucas</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Viktor</span> <span class="surname">Petersson</span></span>. </span></div></div></div><a id="idp61034488" class="indexterm"></a><p>High availability is one of the main requirements in
      serious business applications and highly-available storage is a
      key component in such environments.  In FreeBSD, the Highly
      Available STorage (<acronym class="acronym">HAST</acronym>) framework allows
      transparent storage of the same data across several physically
      separated machines connected by a <acronym class="acronym">TCP/IP</acronym>
      network.  <acronym class="acronym">HAST</acronym> can be understood as a
      network-based RAID1 (mirror), and is similar to the DRBD®
      storage system used in the GNU/<span class="trademark">Linux</span>® platform.  In combination
      with other high-availability features of FreeBSD like
      <acronym class="acronym">CARP</acronym>, <acronym class="acronym">HAST</acronym> makes it
      possible to build a highly-available storage cluster that is
      resistant to hardware failures.</p><p>The following are the main features of
      <acronym class="acronym">HAST</acronym>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Can be used to mask <acronym class="acronym">I/O</acronym> errors on
	  local hard drives.</p></li><li class="listitem"><p>File system agnostic as it works with any file system
	  supported by FreeBSD.</p></li><li class="listitem"><p>Efficient and quick resynchronization as only the blocks
	  that were modified during the downtime of a node are
	  synchronized.</p></li><li class="listitem"><p>Can be used in an already deployed environment to add
	  additional redundancy.</p></li><li class="listitem"><p>Together with <acronym class="acronym">CARP</acronym>,
	  <span class="application">Heartbeat</span>, or other tools, it can
	  be used to build a robust and durable storage system.</p></li></ul></div><p>After reading this section, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>What <acronym class="acronym">HAST</acronym> is, how it works, and
	  which features it provides.</p></li><li class="listitem"><p>How to set up and use <acronym class="acronym">HAST</acronym> on
	  FreeBSD.</p></li><li class="listitem"><p>How to integrate <acronym class="acronym">CARP</acronym> and
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> to build a robust storage system.</p></li></ul></div><p>Before reading this section, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand <span class="trademark">UNIX</span>® and FreeBSD basics (<a class="xref" href="#basics" title="Chapter 3. FreeBSD Basics">Chapter 3, <em>FreeBSD Basics</em></a>).</p></li><li class="listitem"><p>Know how to configure network
	  interfaces and other core FreeBSD subsystems (<a class="xref" href="#config-tuning" title="Chapter 11. Configuration and Tuning">Chapter 11, <em>Configuration and Tuning</em></a>).</p></li><li class="listitem"><p>Have a good understanding of FreeBSD
	  networking (<a class="xref" href="#network-communication" title="Part IV. Network Communication">Part IV, &#8220;Network Communication&#8221;</a>).</p></li></ul></div><p>The <acronym class="acronym">HAST</acronym> project was sponsored by The
      FreeBSD Foundation with support from <a class="link" href="http://www.omc.net/" target="_top">http://www.omc.net/</a>
      and <a class="link" href="http://www.transip.nl/" target="_top">http://www.transip.nl/</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61077112"></a>17.14.1. HAST Operation</h3></div></div></div><p><acronym class="acronym">HAST</acronym> provides synchronous block-level
	replication between two physical machines: the
	<span class="emphasis"><em>primary</em></span>, also known as the
	<span class="emphasis"><em>master</em></span> node, and the
	<span class="emphasis"><em>secondary</em></span>, or <span class="emphasis"><em>slave</em></span>
	node.  These two machines together are referred to as a
	cluster.</p><p>Since <acronym class="acronym">HAST</acronym> works in a primary-secondary
	configuration, it allows only one of the cluster nodes to be
	active at any given time.  The primary node, also called
	<span class="emphasis"><em>active</em></span>, is the one which will handle all
	the <acronym class="acronym">I/O</acronym> requests to
	<acronym class="acronym">HAST</acronym>-managed devices.  The secondary node
	is automatically synchronized from the primary node.</p><p>The physical components of the <acronym class="acronym">HAST</acronym>
	system are the local disk on primary node, and the disk on the
	remote, secondary node.</p><p><acronym class="acronym">HAST</acronym> operates synchronously on a block
	level, making it transparent to file systems and applications.
	<acronym class="acronym">HAST</acronym> provides regular GEOM providers in
	<code class="filename">/dev/hast/</code> for use by other tools or
	applications.  There is no difference between using
	<acronym class="acronym">HAST</acronym>-provided devices and raw disks or
	partitions.</p><p>Each write, delete, or flush operation is sent to both the
	local disk and to the remote disk over
	<acronym class="acronym">TCP/IP</acronym>.  Each read operation is served from
	the local disk, unless the local disk is not up-to-date or an
	<acronym class="acronym">I/O</acronym> error occurs.  In such cases, the read
	operation is sent to the secondary node.</p><p><acronym class="acronym">HAST</acronym> tries to provide fast failure
	recovery.  For this reason, it is important to reduce
	synchronization time after a node's outage.  To provide fast
	synchronization, <acronym class="acronym">HAST</acronym> manages an on-disk
	bitmap of dirty extents and only synchronizes those during a
	regular synchronization, with an exception of the initial
	sync.</p><p>There are many ways to handle synchronization.
	<acronym class="acronym">HAST</acronym> implements several replication modes
	to handle different synchronization methods:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>memsync</em></span>: This mode reports a
	    write operation as completed when the local write
	    operation is finished and when the remote node
	    acknowledges data arrival, but before actually storing the
	    data.  The data on the remote node will be stored directly
	    after sending the acknowledgement.  This mode is intended
	    to reduce latency, but still provides good reliability.
	    This mode is the default.</p></li><li class="listitem"><p><span class="emphasis"><em>fullsync</em></span>: This mode reports a
	    write operation as completed when both the local write and
	    the remote write complete.  This is the safest and the
	    slowest replication mode.</p></li><li class="listitem"><p><span class="emphasis"><em>async</em></span>: This mode reports a write
	    operation as completed when the local write completes.
	    This is the fastest and the most dangerous replication
	    mode.  It should only be used when replicating to a
	    distant node where latency is too high for other
	    modes.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61103224"></a>17.14.2. HAST Configuration</h3></div></div></div><p>The <acronym class="acronym">HAST</acronym> framework consists of several
	components:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hastd</span>(8)</span></a> daemon which provides data
	    synchronization.  When this daemon is started, it will
	    automatically load <code class="varname">geom_gate.ko</code>.</p></li><li class="listitem"><p>The userland management utility,
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hastctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hastctl</span>(8)</span></a>.</p></li><li class="listitem"><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hast.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hast.conf</span>(5)</span></a> configuration file.  This file
	    must exist before starting
	    <span class="application">hastd</span>.</p></li></ul></div><p>Users who prefer to statically build
	<code class="literal">GEOM_GATE</code> support into the kernel should
	add this line to the custom kernel configuration file, then
	rebuild the kernel using the instructions in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>:</p><pre class="programlisting">options	GEOM_GATE</pre><p>The following example describes how to configure two nodes
	in master-slave/primary-secondary operation using
	<acronym class="acronym">HAST</acronym> to replicate the data between the two.
	The nodes will be called <code class="literal">hasta</code>, with an
	<acronym class="acronym">IP</acronym> address of
	<code class="literal">172.16.0.1</code>, and <code class="literal">hastb</code>,
	with an <acronym class="acronym">IP</acronym> address of
	<code class="literal">172.16.0.2</code>.  Both nodes will have a
	dedicated hard drive <code class="filename">/dev/ad6</code> of the same
	size for <acronym class="acronym">HAST</acronym> operation.  The
	<acronym class="acronym">HAST</acronym> pool, sometimes referred to as a
	resource or the <acronym class="acronym">GEOM</acronym> provider in <code class="filename">/dev/hast/</code>, will be called
	<code class="literal">test</code>.</p><p>Configuration of <acronym class="acronym">HAST</acronym> is done using
	<code class="filename">/etc/hast.conf</code>.  This file should be
	identical on both nodes.  The simplest configuration
	is:</p><pre class="programlisting">resource <em class="replaceable"><code>test</code></em> {
	on <em class="replaceable"><code>hasta</code></em> {
		local <em class="replaceable"><code>/dev/ad6</code></em>
		remote <em class="replaceable"><code>172.16.0.2</code></em>
	}
	on <em class="replaceable"><code>hastb</code></em> {
		local <em class="replaceable"><code>/dev/ad6</code></em>
		remote <em class="replaceable"><code>172.16.0.1</code></em>
	}
}</pre><p>For more advanced configuration, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hast.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hast.conf</span>(5)</span></a>.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is also possible to use host names in the
	  <code class="literal">remote</code> statements if the hosts are
	  resolvable and defined either in
	  <code class="filename">/etc/hosts</code> or in the local
	  <acronym class="acronym">DNS</acronym>.</p></div><p>Once the configuration exists on both nodes, the
	<acronym class="acronym">HAST</acronym> pool can be created.  Run these
	commands on both nodes to place the initial metadata onto the
	local disk and to start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hastd</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hastctl create <em class="replaceable"><code>test</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service hastd onestart</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is <span class="emphasis"><em>not</em></span> possible to use
	  <acronym class="acronym">GEOM</acronym>
	  providers with an existing file system or to convert an
	  existing storage to a <acronym class="acronym">HAST</acronym>-managed pool.
	  This procedure needs to store some metadata on the provider
	  and there will not be enough required space available on an
	  existing provider.</p></div><p>A HAST node's <code class="literal">primary</code> or
	<code class="literal">secondary</code> role is selected by an
	administrator, or software like
	<span class="application">Heartbeat</span>, using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hastctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hastctl</span>(8)</span></a>.
	On the primary node, <code class="literal">hasta</code>, issue this
	command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hastctl role primary <em class="replaceable"><code>test</code></em></code></strong></pre><p>Run this command on the secondary node,
	<code class="literal">hastb</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hastctl role secondary <em class="replaceable"><code>test</code></em></code></strong></pre><p>Verify the result by running <code class="command">hastctl</code> on
	each node:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hastctl status <em class="replaceable"><code>test</code></em></code></strong></pre><p>Check the <code class="literal">status</code> line in the output.
	If it says <code class="literal">degraded</code>, something is wrong
	with the configuration file.  It should say
	<code class="literal">complete</code> on each node, meaning that the
	synchronization between the nodes has started.  The
	synchronization completes when <code class="command">hastctl
	  status</code> reports 0 bytes of <code class="literal">dirty</code>
	extents.</p><p>The next step is to create a file system on the
	<acronym class="acronym">GEOM</acronym> provider and mount it.  This must be
	done on the <code class="literal">primary</code> node.  Creating the
	file system can take a few minutes, depending on the size of
	the hard drive.  This example creates a <acronym class="acronym">UFS</acronym>
	file system on <code class="filename">/dev/hast/test</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/hast/<em class="replaceable"><code>test</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /hast/<em class="replaceable"><code>test</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/hast/<em class="replaceable"><code>test</code></em> <em class="replaceable"><code>/hast/test</code></em></code></strong></pre><p>Once the <acronym class="acronym">HAST</acronym> framework is configured
	properly, the final step is to make sure that
	<acronym class="acronym">HAST</acronym> is started automatically during
	system boot.  Add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">hastd_enable="YES"</pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61172472"></a>17.14.2.1. Failover Configuration</h4></div></div></div><p>The goal of this example is to build a robust storage
	  system which is resistant to the failure of any given node.
	  If the primary node fails, the secondary node is there to
	  take over seamlessly, check and mount the file system, and
	  continue to work without missing a single bit of
	  data.</p><p>To accomplish this task, the Common Address Redundancy
	  Protocol (<acronym class="acronym">CARP</acronym>) is used to provide for
	  automatic failover at the <acronym class="acronym">IP</acronym> layer.
	  <acronym class="acronym">CARP</acronym> allows multiple hosts on the same
	  network segment to share an <acronym class="acronym">IP</acronym> address.
	  Set up <acronym class="acronym">CARP</acronym> on both nodes of the cluster
	  according to the documentation available in <a class="xref" href="#carp" title="31.10. Common Address Redundancy Protocol (CARP)">Section 31.10, &#8220;Common Address Redundancy Protocol
	(<acronym class="acronym">CARP</acronym>)&#8221;</a>.  In this example, each node will have
	  its own management <acronym class="acronym">IP</acronym> address and a
	  shared <acronym class="acronym">IP</acronym> address of
	  <em class="replaceable"><code>172.16.0.254</code></em>.  The primary
	  <acronym class="acronym">HAST</acronym> node of the cluster must be the
	  master <acronym class="acronym">CARP</acronym> node.</p><p>The <acronym class="acronym">HAST</acronym> pool created in the previous
	  section is now ready to be exported to the other hosts on
	  the network.  This can be accomplished by exporting it
	  through <acronym class="acronym">NFS</acronym> or
	  <span class="application">Samba</span>, using the shared
	  <acronym class="acronym">IP</acronym> address
	  <em class="replaceable"><code>172.16.0.254</code></em>.  The only problem
	  which remains unresolved is an automatic failover should the
	  primary node fail.</p><p>In the event of <acronym class="acronym">CARP</acronym> interfaces going
	  up or down, the FreeBSD operating system generates a
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> event, making it possible to watch for state
	  changes on the <acronym class="acronym">CARP</acronym> interfaces.  A state
	  change on the <acronym class="acronym">CARP</acronym> interface is an
	  indication that one of the nodes failed or came back online.
	  These state change events make it possible to run a script
	  which will automatically handle the HAST failover.</p><p>To catch state changes on the
	  <acronym class="acronym">CARP</acronym> interfaces, add this configuration
	  to <code class="filename">/etc/devd.conf</code> on each node:</p><pre class="programlisting">notify 30 {
	match "system" "IFNET";
	match "subsystem" "carp0";
	match "type" "LINK_UP";
	action "/usr/local/sbin/carp-hast-switch master";
};

notify 30 {
	match "system" "IFNET";
	match "subsystem" "carp0";
	match "type" "LINK_DOWN";
	action "/usr/local/sbin/carp-hast-switch slave";
};</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If the systems are running FreeBSD 10 or higher,
	    replace <code class="filename">carp0</code> with the name of the
	    <acronym class="acronym">CARP</acronym>-configured interface.</p></div><p>Restart <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> on both nodes to put the new
	  configuration into effect:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service devd restart</code></strong></pre><p>When the specified interface state changes by going up
	  or down , the system generates a notification, allowing the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> subsystem to run the specified automatic
	  failover script,
	  <code class="filename">/usr/local/sbin/carp-hast-switch</code>.
	  For further clarification about this configuration, refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd.conf</span>(5)</span></a>.</p><p>Here is an example of an automated failover
	  script:</p><pre class="programlisting">#!/bin/sh

# Original script by Freddie Cash &lt;fjwcash@gmail.com&gt;
# Modified by Michael W. Lucas &lt;mwlucas@BlackHelicopters.org&gt;
# and Viktor Petersson &lt;vpetersson@wireload.net&gt;

# The names of the HAST resources, as listed in /etc/hast.conf
resources="<em class="replaceable"><code>test</code></em>"

# delay in mounting HAST resource after becoming master
# make your best guess
delay=3

# logging
log="local0.debug"
name="carp-hast"

# end of user configurable stuff

case "$1" in
	master)
		logger -p $log -t $name "Switching to primary provider for ${resources}."
		sleep ${delay}

		# Wait for any "hastd secondary" processes to stop
		for disk in ${resources}; do
			while $( pgrep -lf "hastd: ${disk} \(secondary\)" &gt; /dev/null 2&gt;&amp;1 ); do
				sleep 1
			done

			# Switch role for each disk
			hastctl role primary ${disk}
			if [ $? -ne 0 ]; then
				logger -p $log -t $name "Unable to change role to primary for resource ${disk}."
				exit 1
			fi
		done

		# Wait for the /dev/hast/* devices to appear
		for disk in ${resources}; do
			for I in $( jot 60 ); do
				[ -c "/dev/hast/${disk}" ] &amp;&amp; break
				sleep 0.5
			done

			if [ ! -c "/dev/hast/${disk}" ]; then
				logger -p $log -t $name "GEOM provider /dev/hast/${disk} did not appear."
				exit 1
			fi
		done

		logger -p $log -t $name "Role for HAST resources ${resources} switched to primary."


		logger -p $log -t $name "Mounting disks."
		for disk in ${resources}; do
			mkdir -p /hast/${disk}
			fsck -p -y -t ufs /dev/hast/${disk}
			mount /dev/hast/${disk} /hast/${disk}
		done

	;;

	slave)
		logger -p $log -t $name "Switching to secondary provider for ${resources}."

		# Switch roles for the HAST resources
		for disk in ${resources}; do
			if ! mount | grep -q "^/dev/hast/${disk} on "
			then
			else
				umount -f /hast/${disk}
			fi
			sleep $delay
			hastctl role secondary ${disk} 2&gt;&amp;1
			if [ $? -ne 0 ]; then
				logger -p $log -t $name "Unable to switch role to secondary for resource ${disk}."
				exit 1
			fi
			logger -p $log -t $name "Role switched to secondary for resource ${disk}."
		done
	;;
esac</pre><p>In a nutshell, the script takes these actions when a
	  node becomes master:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Promotes the <acronym class="acronym">HAST</acronym> pool to
	      primary on the other node.</p></li><li class="listitem"><p>Checks the file system under the
	      <acronym class="acronym">HAST</acronym> pool.</p></li><li class="listitem"><p>Mounts the pool.</p></li></ul></div><p>When a node becomes secondary:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Unmounts the <acronym class="acronym">HAST</acronym> pool.</p></li><li class="listitem"><p>Degrades the <acronym class="acronym">HAST</acronym> pool to
	      secondary.</p></li></ul></div><div xmlns="" class="caution"><h3 class="admontitle">Caution: </h3><p xmlns="http://www.w3.org/1999/xhtml">This is just an example script which serves as a proof
	    of concept.  It does not handle all the possible scenarios
	    and can be extended or altered in any way, for example, to
	    start or stop required services.</p></div><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">For this example, a standard <acronym class="acronym">UFS</acronym>
	    file system was used.  To reduce the time needed for
	    recovery, a journal-enabled <acronym class="acronym">UFS</acronym> or
	    <acronym class="acronym">ZFS</acronym> file system can be used
	    instead.</p></div><p>More detailed information with additional examples can
	  be found at <a class="link" href="http://wiki.FreeBSD.org/HAST" target="_top">http://wiki.FreeBSD.org/HAST</a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61198200"></a>17.14.3. Troubleshooting</h3></div></div></div><p><acronym class="acronym">HAST</acronym> should generally work without
	issues.  However, as with any other software product, there
	may be times when it does not work as supposed.  The sources
	of the problems may be different, but the rule of thumb is to
	ensure that the time is synchronized between the nodes of the
	cluster.</p><p>When troubleshooting <acronym class="acronym">HAST</acronym>, the
	debugging level of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hastd</span>(8)</span></a> should be increased by
	starting <code class="command">hastd</code> with <code class="literal">-d</code>.
	This argument may be specified multiple times to further
	increase the debugging level.  Consider also using
	<code class="literal">-F</code>, which starts <code class="command">hastd</code>
	in the foreground.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-hast-sb"></a>17.14.3.1. Recovering from the Split-brain Condition</h4></div></div></div><p><em class="firstterm">Split-brain</em> occurs when the nodes
	  of the cluster are unable to communicate with each other,
	  and both are configured as primary.  This is a dangerous
	  condition because it allows both nodes to make incompatible
	  changes to the data.  This problem must be corrected
	  manually by the system administrator.</p><p>The administrator must either decide which node has more
	  important changes, or perform the merge manually.  Then, let
	  <acronym class="acronym">HAST</acronym> perform full synchronization of the
	  node which has the broken data.  To do this, issue these
	  commands on the node which needs to be
	  resynchronized:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hastctl role init <em class="replaceable"><code>test</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>hastctl create <em class="replaceable"><code>test</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>hastctl role secondary <em class="replaceable"><code>test</code></em></code></strong></pre></div></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom"></a>Chapter 18. GEOM: Modular Disk Transformation Framework</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#geom-synopsis">18.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#geom-striping">18.2. RAID0 - Striping</a></span></dt><dt><span class="sect1"><a href="#geom-mirror">18.3. RAID1 - Mirroring</a></span></dt><dt><span class="sect1"><a href="#geom-raid3">18.4. <acronym class="acronym">RAID</acronym>3 - Byte-level Striping with
	Dedicated Parity</a></span></dt><dt><span class="sect1"><a href="#geom-graid">18.5. Software <acronym class="acronym">RAID</acronym> Devices</a></span></dt><dt><span class="sect1"><a href="#geom-ggate">18.6. <acronym class="acronym">GEOM</acronym> Gate Network</a></span></dt><dt><span class="sect1"><a href="#geom-glabel">18.7. Labeling Disk Devices</a></span></dt><dt><span class="sect1"><a href="#geom-gjournal">18.8. UFS Journaling Through <acronym class="acronym">GEOM</acronym></a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-synopsis"></a>18.1. Synopsis</h2></div></div></div><a id="idp61262456" class="indexterm"></a><a id="idp61263352" class="indexterm"></a><p>In FreeBSD, the <acronym class="acronym">GEOM</acronym> framework permits
      access and control to classes, such as Master Boot Records and
      <acronym class="acronym">BSD</acronym> labels, through the use of providers, or
      the disk devices in <code class="filename">/dev</code>.  By supporting
      various software <acronym class="acronym">RAID</acronym> configurations,
      <acronym class="acronym">GEOM</acronym> transparently provides access  to the
      operating system and operating system utilities.</p><p>This chapter covers the use of disks under the
      <acronym class="acronym">GEOM</acronym> framework in FreeBSD.  This includes the
      major <acronym class="acronym">RAID</acronym> control utilities which use the
      framework for configuration.  This chapter is not a definitive
      guide to <acronym class="acronym">RAID</acronym> configurations and only
      <acronym class="acronym">GEOM</acronym>-supported <acronym class="acronym">RAID</acronym>
      classifications are discussed.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>What type of <acronym class="acronym">RAID</acronym> support is
	  available through <acronym class="acronym">GEOM</acronym>.</p></li><li class="listitem"><p>How to use the base utilities to configure, maintain,
	  and manipulate the various <acronym class="acronym">RAID</acronym>
	  levels.</p></li><li class="listitem"><p>How to mirror, stripe, encrypt, and remotely connect
	  disk devices through <acronym class="acronym">GEOM</acronym>.</p></li><li class="listitem"><p>How to troubleshoot disks attached to the
	  <acronym class="acronym">GEOM</acronym> framework.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand how FreeBSD treats disk devices (<a class="xref" href="#disks" title="Chapter 17. Storage">Chapter 17, <em>Storage</em></a>).</p></li><li class="listitem"><p>Know how to configure and install a new kernel (<a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>).</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-striping"></a>18.2. RAID0 - Striping</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div></div></div><a id="idp61299960" class="indexterm"></a><a id="idp61300856" class="indexterm"></a><p>Striping combines several disk drives into a single volume.
      Striping can be performed through the use of hardware
      <acronym class="acronym">RAID</acronym> controllers.  The
      <acronym class="acronym">GEOM</acronym> disk subsystem provides software support
      for disk striping, also known as <acronym class="acronym">RAID0</acronym>,
      without the need for a <acronym class="acronym">RAID</acronym> disk
      controller.</p><p>In <acronym class="acronym">RAID0</acronym>, data is split into blocks that
      are written across all the drives in the array.  As seen in the
      following illustration, instead of having to wait on the system
      to write 256k to one disk, <acronym class="acronym">RAID0</acronym> can
      simultaneously write 64k to each of the four disks in the array,
      offering superior <acronym class="acronym">I/O</acronym> performance.  This
      performance can be enhanced further by using multiple disk
      controllers.</p><div class="mediaobject" align="center"><img src="geom/striping.png" align="middle" alt="Disk Striping Illustration" /></div><p>Each disk in a <acronym class="acronym">RAID0</acronym> stripe must be of
      the same size, since <acronym class="acronym">I/O</acronym> requests are
      interleaved to read or write to multiple disks in
      parallel.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><acronym class="acronym">RAID0</acronym> does <span class="emphasis"><em>not</em></span>
	provide any redundancy.  This means that if one disk in the
	array fails, all of the data on the disks is lost.  If the
	data is important, implement a backup strategy that regularly
	saves backups to a remote system or device.</p></div><p>The process for creating a software,
      <acronym class="acronym">GEOM</acronym>-based <acronym class="acronym">RAID0</acronym> on a FreeBSD
      system using commodity disks is as follows.  Once the stripe is
      created, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gstripe&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gstripe</span>(8)</span></a> for more information on how
      to control an existing stripe.</p><div class="procedure"><a id="idp61315832"></a><div class="procedure-title">Procedure 18.1. Creating a Stripe of Unformatted <acronym class="acronym">ATA</acronym>
	Disks</div><ol class="procedure" type="1"><li class="step"><p>Load the <code class="filename">geom_stripe.ko</code>
	  module:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload geom_stripe</code></strong></pre></li><li class="step"><p>Ensure that a suitable mount point exists.  If this
	  volume will become a root partition, then temporarily use
	  another mount point such as
	  <code class="filename">/mnt</code>.</p></li><li class="step"><p>Determine the device names for the disks which will
	  be striped, and create the new stripe device.  For example,
	  to stripe two unused and unpartitioned
	  <acronym class="acronym">ATA</acronym> disks with device names of
	  <code class="filename">/dev/ad2</code> and
	  <code class="filename">/dev/ad3</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gstripe label -v st0 /dev/ad2 /dev/ad3</code></strong>
Metadata value stored on /dev/ad2.
Metadata value stored on /dev/ad3.
Done.</pre></li><li class="step"><p>Write a standard label, also known as a partition table,
	  on the new volume and install the default bootstrap
	  code:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -wB /dev/stripe/st0</code></strong></pre></li><li class="step"><p>This process should create two other devices in
	  <code class="filename">/dev/stripe</code> in addition to
	  <code class="filename">st0</code>.  Those include
	  <code class="filename">st0a</code> and <code class="filename">st0c</code>.  At
	  this point, a <acronym class="acronym">UFS</acronym> file system can be
	  created on <code class="filename">st0a</code> using
	  <code class="command">newfs</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/stripe/st0a</code></strong></pre><p>Many numbers will glide across the screen, and after a
	  few seconds, the process will be complete.  The volume has
	  been created and is ready to be mounted.</p></li><li class="step"><p>To manually mount the created disk stripe:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/stripe/st0a /mnt</code></strong></pre></li><li class="step"><p>To mount this striped file system automatically during
	  the boot process, place the volume information in
	  <code class="filename">/etc/fstab</code>.  In this example, a
	  permanent mount point, named <code class="filename">stripe</code>, is
	  created:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /stripe</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo "/dev/stripe/st0a /stripe ufs rw 2 2" \</code></strong>
<strong class="userinput"><code>&gt;&gt; /etc/fstab</code></strong></pre></li><li class="step"><p>The <code class="filename">geom_stripe.ko</code> module must also
	  be automatically loaded during system initialization, by
	  adding a line to
	  <code class="filename">/boot/loader.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'geom_stripe_load="YES"' &gt;&gt; /boot/loader.conf</code></strong></pre></li></ol></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-mirror"></a>18.3. RAID1 - Mirroring</h2></div></div></div><a id="idp61371000" class="indexterm"></a><a id="idp61371896" class="indexterm"></a><a id="idp61372664" class="indexterm"></a><p><acronym class="acronym">RAID1</acronym>, or
      <span class="emphasis"><em>mirroring</em></span>, is the technique of writing
      the same data to more than one disk drive.  Mirrors are usually
      used to guard against data loss due to drive failure.  Each
      drive in a mirror contains an identical copy of the data.  When
      an individual drive fails, the mirror continues to work,
      providing data from the drives that are still functioning.  The
      computer keeps running, and the administrator has time to
      replace the failed drive without user interruption.</p><p>Two common situations are illustrated in these examples.
      The first creates a mirror out of two new drives and uses it as
      a replacement for an existing single drive.  The second example
      creates a mirror on a single new drive, copies the old drive's
      data to it, then inserts the old drive into the mirror.  While
      this procedure is slightly more complicated, it only requires
      one new drive.</p><p>Traditionally, the two drives in a mirror are identical in
      model and capacity, but <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> does not require that.
      Mirrors created with dissimilar drives will have a capacity
      equal to that of the smallest drive in the mirror.  Extra space
      on larger drives will be unused.  Drives inserted into the
      mirror later must have at least as much capacity as the smallest
      drive already in the mirror.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">The mirroring procedures shown here are non-destructive,
	but as with any major disk operation, make a full backup
	first.</p></div><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">While <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> is used in these procedures
	to copy file systems, it does not work on file systems with
	soft updates journaling.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> for information
	on detecting and disabling soft updates journaling.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-mirror-metadata"></a>18.3.1. Metadata Issues</h3></div></div></div><p>Many disk systems store metadata at the end of each disk.
	Old metadata should be erased before reusing the disk for a
	mirror.  Most problems are caused by two particular types of
	leftover metadata: <acronym class="acronym">GPT</acronym> partition tables and
	old metadata from a previous mirror.</p><p><acronym class="acronym">GPT</acronym> metadata can be erased with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a>.  This example erases both primary and backup
	<acronym class="acronym">GPT</acronym> partition tables from disk
	<code class="filename">ada8</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart destroy -F ada8</code></strong></pre><p>A disk can be removed from an active mirror and the
	metadata erased in one step using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a>.  Here, the
	example disk <code class="filename">ada8</code> is removed from the
	active mirror <code class="filename">gm4</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror remove gm4 ada8</code></strong></pre><p>If the mirror is not running, but old mirror metadata is
	still on the disk, use <code class="command">gmirror clear</code> to
	remove it:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror clear ada8</code></strong></pre><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> stores one block of metadata at the end of
	the disk.  Because <acronym class="acronym">GPT</acronym> partition schemes
	also store metadata at the end of the disk, mirroring entire
	<acronym class="acronym">GPT</acronym> disks with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> is not
	recommended.  <acronym class="acronym">MBR</acronym> partitioning is used here
	because it only stores a partition table at the start of the
	disk and does not conflict with the mirror metadata.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-mirror-two-new-disks"></a>18.3.2. Creating a Mirror with Two New Disks</h3></div></div></div><p>In this example, FreeBSD has already been installed on a
	single disk, <code class="filename">ada0</code>.  Two new disks,
	<code class="filename">ada1</code> and <code class="filename">ada2</code>, have
	been connected to the system.  A new mirror will be created on
	these two disks and used to replace the old single
	disk.</p><p>The <code class="filename">geom_mirror.ko</code> kernel module must
	either be built into the kernel or loaded at boot- or
	run-time.  Manually load the kernel module now:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror load</code></strong></pre><p>Create the mirror with the two new drives:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror label -v gm0 /dev/ada1 /dev/ada2</code></strong></pre><p><code class="filename">gm0</code> is a user-chosen device name
	assigned to the new mirror.  After the mirror has been
	started, this device name appears in
	<code class="filename">/dev/mirror/</code>.</p><p><acronym class="acronym">MBR</acronym> and
	<span class="application">bsdlabel</span> partition tables can now
	be created on the mirror with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a>.  This example
	uses a traditional file system layout, with partitions for
	<code class="filename">/</code>, swap, <code class="filename">/var</code>,
	<code class="filename">/tmp</code>, and <code class="filename">/usr</code>.  A
	single <code class="filename">/</code> and a swap partition
	will also work.</p><p>Partitions on the mirror do not have to be the same size
	as those on the existing disk, but they must be large enough
	to hold all the data already present on
	<code class="filename">ada0</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart create -s MBR mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd -a 4k mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart show mirror/gm0</code></strong>
=&gt;       63  156301423  mirror/gm0  MBR  (74G)
         63         63                    - free -  (31k)
        126  156301299                 1  freebsd  (74G)
  156301425         61                    - free -  (30k)</pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart create -s BSD mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs  -a 4k -s 2g mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-swap -a 4k -s 4g mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs  -a 4k -s 2g mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs  -a 4k -s 1g mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs  -a 4k       mirror/gm0s1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart show mirror/gm0s1</code></strong>
=&gt;        0  156301299  mirror/gm0s1  BSD  (74G)
          0          2                      - free -  (1.0k)
          2    4194304                   1  freebsd-ufs  (2.0G)
    4194306    8388608                   2  freebsd-swap  (4.0G)
   12582914    4194304                   4  freebsd-ufs  (2.0G)
   16777218    2097152                   5  freebsd-ufs  (1.0G)
   18874370  137426928                   6  freebsd-ufs  (65G)
  156301298          1                      - free -  (512B)</pre><p>Make the mirror bootable by installing bootcode in the
	<acronym class="acronym">MBR</acronym> and bsdlabel and setting the active
	slice:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/mbr mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart set -a active -i 1 mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/boot mirror/gm0s1</code></strong></pre><p>Format the file systems on the new mirror, enabling
	soft-updates.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1a</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1d</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1f</code></strong></pre><p>File systems from the original <code class="filename">ada0</code>
	disk can now be copied onto the mirror with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></a>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1a /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - / | (cd /mnt &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1d /mnt/var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1e /mnt/tmp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1f /mnt/usr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /var | (cd /mnt/var &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /tmp | (cd /mnt/tmp &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /usr | (cd /mnt/usr &amp;&amp; restore -rf -)</code></strong></pre><p>Edit <code class="filename">/mnt/etc/fstab</code> to point to
	the new mirror file systems:</p><pre class="programlisting"># Device		Mountpoint	FStype	Options	Dump	Pass#
/dev/mirror/gm0s1a	/		ufs	rw	1	1
/dev/mirror/gm0s1b	none		swap	sw	0	0
/dev/mirror/gm0s1d	/var		ufs	rw	2	2
/dev/mirror/gm0s1e	/tmp		ufs	rw	2	2
/dev/mirror/gm0s1f	/usr		ufs	rw	2	2</pre><p>If the <code class="filename">geom_mirror.ko</code> kernel module
	has not been built into the kernel,
	<code class="filename">/mnt/boot/loader.conf</code> is edited to load
	the module at boot:</p><pre class="programlisting">geom_mirror_load="YES"</pre><p>Reboot the system to test the new mirror and verify that
	all data has been copied.  The <acronym class="acronym">BIOS</acronym> will
	see the mirror as two individual drives rather than a mirror.
	Because the drives are identical, it does not matter which is
	selected to boot.</p><p>See <a class="xref" href="#gmirror-troubleshooting" title="18.3.4. Troubleshooting">Section 18.3.4, &#8220;Troubleshooting&#8221;</a> if there are
	problems booting.  Powering down and disconnecting the
	original <code class="filename">ada0</code> disk will allow it to be
	kept as an offline backup.</p><p>In use, the mirror will behave just like the original
	single drive.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-mirror-existing-drive"></a>18.3.3. Creating a Mirror with an Existing Drive</h3></div></div></div><p>In this example, FreeBSD has already been installed on a
	single disk, <code class="filename">ada0</code>.  A new disk,
	<code class="filename">ada1</code>, has been connected to the system.
	A one-disk mirror will be created on the new disk, the
	existing system copied onto it, and then the old disk will be
	inserted into the mirror.  This slightly complex procedure is
	required because <code class="command">gmirror</code> needs to put a
	512-byte block of metadata at the end of each disk, and the
	existing <code class="filename">ada0</code> has usually had all of its
	space already allocated.</p><p>Load the <code class="filename">geom_mirror.ko</code> kernel
	module:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror load</code></strong></pre><p>Check the media size of the original disk with
	<code class="command">diskinfo</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>diskinfo -v ada0 | head -n3</code></strong>
/dev/ada0
	512             # sectorsize
	1000204821504   # mediasize in bytes (931G)</pre><p>Create a mirror on the new disk.  To make certain that the
	mirror capacity is not any larger than the original
	<code class="filename">ada0</code> drive, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gnop&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gnop</span>(8)</span></a> is used to
	create a fake drive of the exact same size.  This drive does
	not store any data, but is used only to limit the size of the
	mirror.  When <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> creates the mirror, it will
	restrict the capacity to the size of
	<code class="filename">gzero.nop</code>, even if the new
	<code class="filename">ada1</code> drive has more space.  Note that the
	<em class="replaceable"><code>1000204821504</code></em> in the second line is
	equal to <code class="filename">ada0</code>'s media size as shown by
	<code class="command">diskinfo</code> above.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>geom zero load</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gnop create -s 1000204821504 gzero</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gmirror label -v gm0 gzero.nop ada1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gmirror forget gm0</code></strong></pre><p>Since <code class="filename">gzero.nop</code> does not store any
	data, the mirror does not see it as connected.  The mirror is
	told to <span class="quote">&#8220;<span class="quote">forget</span>&#8221;</span> unconnected components, removing
	references to <code class="filename">gzero.nop</code>.  The result is a
	mirror device containing only a single disk,
	<code class="filename">ada1</code>.</p><p>After creating <code class="filename">gm0</code>, view the
	partition table on <code class="filename">ada0</code>.  This output is
	from a 1 TB drive.  If there is some unallocated space at
	the end of the drive, the contents may be copied directly from
	<code class="filename">ada0</code> to the new mirror.</p><p>However, if the output shows that all of the space on the
	disk is allocated, as in the following listing, there is no
	space available for the 512-byte mirror metadata at the end of
	the disk.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart show ada0</code></strong>
=&gt;        63  1953525105        ada0  MBR  (931G)
          63  1953525105           1  freebsd  [active]  (931G)</pre><p>In this case, the partition table must be edited to reduce
	the capacity by one sector on <code class="filename">mirror/gm0</code>.
	The procedure will be explained later.</p><p>In either case, partition tables on the primary disk
	should be first copied using <code class="command">gpart backup</code>
	and <code class="command">gpart restore</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart backup ada0 &gt; table.ada0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart backup ada0s1 &gt; table.ada0s1</code></strong></pre><p>These commands create two files,
	<code class="filename">table.ada0</code> and
	<code class="filename">table.ada0s1</code>.  This example is from a
	1 TB drive:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat table.ada0</code></strong>
MBR 4
1 freebsd         63 1953525105   [active]</pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat table.ada0s1</code></strong>
BSD 8
1  freebsd-ufs          0    4194304
2 freebsd-swap    4194304   33554432
4  freebsd-ufs   37748736   50331648
5  freebsd-ufs   88080384   41943040
6  freebsd-ufs  130023424  838860800
7  freebsd-ufs  968884224  984640881</pre><p>If no free space is shown at the end of the disk, the size
	of both the slice and the last partition must be reduced by
	one sector.  Edit the two files, reducing the size of both the
	slice and last partition by one.  These are the last numbers
	in each listing.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat table.ada0</code></strong>
MBR 4
1 freebsd         63 <span class="emphasis"><em>1953525104</em></span>   [active]</pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat table.ada0s1</code></strong>
BSD 8
1  freebsd-ufs          0    4194304
2 freebsd-swap    4194304   33554432
4  freebsd-ufs   37748736   50331648
5  freebsd-ufs   88080384   41943040
6  freebsd-ufs  130023424  838860800
7  freebsd-ufs  968884224  <span class="emphasis"><em>984640880</em></span></pre><p>If at least one sector was unallocated at the end of the
	disk, these two files can be used without modification.</p><p>Now restore the partition table into
	<code class="filename">mirror/gm0</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart restore mirror/gm0 &lt; table.ada0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart restore mirror/gm0s1 &lt; table.ada0s1</code></strong></pre><p>Check the partition table with
	<code class="command">gpart show</code>.  This example has
	<code class="filename">gm0s1a</code> for <code class="filename">/</code>,
	<code class="filename">gm0s1d</code> for <code class="filename">/var</code>,
	<code class="filename">gm0s1e</code> for <code class="filename">/usr</code>,
	<code class="filename">gm0s1f</code> for <code class="filename">/data1</code>,
	and <code class="filename">gm0s1g</code> for
	<code class="filename">/data2</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart show mirror/gm0</code></strong>
=&gt;        63  1953525104  mirror/gm0  MBR  (931G)
          63  1953525042           1  freebsd  [active]  (931G)
  1953525105          62              - free -  (31k)

<code class="prompt">#</code> <strong class="userinput"><code>gpart show mirror/gm0s1</code></strong>
=&gt;         0  1953525042  mirror/gm0s1  BSD  (931G)
           0     2097152             1  freebsd-ufs  (1.0G)
     2097152    16777216             2  freebsd-swap  (8.0G)
    18874368    41943040             4  freebsd-ufs  (20G)
    60817408    20971520             5  freebsd-ufs  (10G)
    81788928   629145600             6  freebsd-ufs  (300G)
   710934528  1242590514             7  freebsd-ufs  (592G)
  1953525042          63                - free -  (31k)</pre><p>Both the slice and the last partition must have at least
	one free block at the end of the disk.</p><p>Create file systems on these new partitions.  The number
	of partitions will vary to match the original disk,
	<code class="filename">ada0</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1a</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1d</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1f</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U /dev/mirror/gm0s1g</code></strong></pre><p>Make the mirror bootable by installing bootcode in the
	<acronym class="acronym">MBR</acronym> and bsdlabel and setting the active
	slice:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/mbr mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart set -a active -i 1 mirror/gm0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/boot mirror/gm0s1</code></strong></pre><p>Adjust <code class="filename">/etc/fstab</code> to use the new
	partitions on the mirror.  Back up this file first by copying
	it to <code class="filename">/etc/fstab.orig</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /etc/fstab /etc/fstab.orig</code></strong></pre><p>Edit <code class="filename">/etc/fstab</code>, replacing
	<code class="filename">/dev/ada0</code> with
	<code class="filename">mirror/gm0</code>.</p><pre class="programlisting"># Device		Mountpoint	FStype	Options	Dump	Pass#
/dev/mirror/gm0s1a	/		ufs	rw	1	1
/dev/mirror/gm0s1b	none		swap	sw	0	0
/dev/mirror/gm0s1d	/var		ufs	rw	2	2
/dev/mirror/gm0s1e	/usr		ufs	rw	2	2
/dev/mirror/gm0s1f	/data1		ufs	rw	2	2
/dev/mirror/gm0s1g	/data2		ufs	rw	2	2</pre><p>If the <code class="filename">geom_mirror.ko</code> kernel module
	has not been built into the kernel, edit
	<code class="filename">/boot/loader.conf</code> to load it at
	boot:</p><pre class="programlisting">geom_mirror_load="YES"</pre><p>File systems from the original disk can now be copied onto
	the mirror with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></a>.  Each file
	system dumped with <code class="command">dump -L</code> will create a
	snapshot first, which can take some time.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1a /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /    | (cd /mnt &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1d /mnt/var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1e /mnt/usr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1f /mnt/data1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1g /mnt/data2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /usr | (cd /mnt/usr &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /var | (cd /mnt/var &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /data1 | (cd /mnt/data1 &amp;&amp; restore -rf -)</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dump -C16 -b64 -0aL -f - /data2 | (cd /mnt/data2 &amp;&amp; restore -rf -)</code></strong></pre><p>Restart the system, booting from
	<code class="filename">ada1</code>.  If everything is working, the
	system will boot from <code class="filename">mirror/gm0</code>, which
	now contains the same data as <code class="filename">ada0</code> had
	previously.  See <a class="xref" href="#gmirror-troubleshooting" title="18.3.4. Troubleshooting">Section 18.3.4, &#8220;Troubleshooting&#8221;</a> if
	there are problems booting.</p><p>At this point, the mirror still consists of only the
	single <code class="filename">ada1</code> disk.</p><p>After booting from <code class="filename">mirror/gm0</code>
	successfully, the final step is inserting
	<code class="filename">ada0</code> into the mirror.</p><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">When <code class="filename">ada0</code> is inserted into the
	  mirror, its former contents will be overwritten by data from
	  the mirror.  Make certain that
	  <code class="filename">mirror/gm0</code> has the same contents as
	  <code class="filename">ada0</code> before adding
	  <code class="filename">ada0</code> to the mirror.  If the contents
	  previously copied by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></a> are
	  not identical to what was on <code class="filename">ada0</code>,
	  revert <code class="filename">/etc/fstab</code> to mount the file
	  systems on <code class="filename">ada0</code>, reboot, and start the
	  whole procedure again.</p></div><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror insert gm0 ada0</code></strong>
GEOM_MIRROR: Device gm0: rebuilding provider ada0</pre><p>Synchronization between the two disks will start
	immediately.  Use <code class="command">gmirror status</code> to view
	the progress.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror status</code></strong>
      Name    Status  Components
mirror/gm0  DEGRADED  ada1 (ACTIVE)
                      ada0 (SYNCHRONIZING, 64%)</pre><p>After a while, synchronization will finish.</p><pre class="screen">GEOM_MIRROR: Device gm0: rebuilding provider ada0 finished.
<code class="prompt">#</code> <strong class="userinput"><code>gmirror status</code></strong>
      Name    Status  Components
mirror/gm0  COMPLETE  ada1 (ACTIVE)
                      ada0 (ACTIVE)</pre><p><code class="filename">mirror/gm0</code> now consists
	of the two disks <code class="filename">ada0</code> and
	<code class="filename">ada1</code>, and the contents are automatically
	synchronized with each other.  In use,
	<code class="filename">mirror/gm0</code> will behave just like the
	original single drive.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="gmirror-troubleshooting"></a>18.3.4. Troubleshooting</h3></div></div></div><p>If the system no longer boots, <acronym class="acronym">BIOS</acronym>
	settings may have to be changed to boot from one of the new
	mirrored drives.  Either mirror drive can be used for booting,
	as they contain identical data.</p><p>If the boot stops with this message, something is wrong
	with the mirror device:</p><pre class="screen">Mounting from ufs:/dev/mirror/gm0s1a failed with error 19.

Loader variables:
  vfs.root.mountfrom=ufs:/dev/mirror/gm0s1a
  vfs.root.mountfrom.options=rw

Manual root filesystem specification:
  &lt;fstype&gt;:&lt;device&gt; [options]
      Mount &lt;device&gt; using filesystem &lt;fstype&gt;
      and with the specified (optional) option list.

    eg. ufs:/dev/da0s1a
        zfs:tank
        cd9660:/dev/acd0 ro
          (which is equivalent to: mount -t cd9660 -o ro /dev/acd0 /)

  ?               List valid disk boot devices
  .               Yield 1 second (for background tasks)
  &lt;empty line&gt;    Abort manual input

mountroot&gt;</pre><p>Forgetting to load the <code class="filename">geom_mirror.ko</code>
	module in <code class="filename">/boot/loader.conf</code> can cause
	this problem.  To fix it, boot from a FreeBSD
	installation media and choose <code class="literal">Shell</code> at the
	first prompt.  Then load the mirror module and mount the
	mirror device:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror load</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/mirror/gm0s1a /mnt</code></strong></pre><p>Edit <code class="filename">/mnt/boot/loader.conf</code>, adding a
	line to load the mirror module:</p><pre class="programlisting">geom_mirror_load="YES"</pre><p>Save the file and reboot.</p><p>Other problems that cause <span class="errorname">error 19</span>
	require more effort to fix.  Although the system should boot
	from <code class="filename">ada0</code>, another prompt to select a
	shell will appear if <code class="filename">/etc/fstab</code> is
	incorrect.  Enter <code class="literal">ufs:/dev/ada0s1a</code> at the
	boot loader prompt and press <span class="keycap"><strong>Enter</strong></span>.  Undo the
	edits in <code class="filename">/etc/fstab</code> then mount the file
	systems from the original disk (<code class="filename">ada0</code>)
	instead of the mirror.  Reboot the system and try the
	procedure again.</p><pre class="screen">Enter full pathname of shell or RETURN for /bin/sh:
<code class="prompt">#</code> <strong class="userinput"><code>cp /etc/fstab.orig /etc/fstab</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>reboot</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61618552"></a>18.3.5. Recovering from Disk Failure</h3></div></div></div><p>The benefit of disk mirroring is that an individual disk
	can fail without causing the mirror to lose any data.  In the
	above example, if <code class="filename">ada0</code> fails, the mirror
	will continue to work, providing data from the remaining
	working drive, <code class="filename">ada1</code>.</p><p>To replace the failed drive, shut down the system and
	physically replace the failed drive with a new drive of equal
	or greater capacity.  Manufacturers use somewhat arbitrary
	values when rating drives in gigabytes, and the only way to
	really be sure is to compare the total count of sectors shown
	by <code class="command">diskinfo -v</code>.  A drive with larger
	capacity than the mirror will work, although the extra space
	on the new drive will not be used.</p><p>After the computer is powered back up, the mirror will be
	running in a <span class="quote">&#8220;<span class="quote">degraded</span>&#8221;</span> mode with only one drive.
	The mirror is told to forget drives that are not currently
	connected:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror forget gm0</code></strong></pre><p>Any old metadata should be cleared from the replacement
	disk using the instructions in
	<a class="xref" href="#geom-mirror-metadata" title="18.3.1. Metadata Issues">Section 18.3.1, &#8220;Metadata Issues&#8221;</a>.  Then the replacement
	disk, <code class="filename">ada4</code> for this example, is inserted
	into the mirror:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror insert gm0 /dev/ada4</code></strong></pre><p>Resynchronization begins when the new drive is inserted
	into the mirror.  This process of copying mirror data to a new
	drive can take a while.  Performance of the mirror will be
	greatly reduced during the copy, so inserting new drives is
	best done when there is low demand on the computer.</p><p>Progress can be monitored with <code class="command">gmirror
	  status</code>, which shows drives that are being
	synchronized and the percentage of completion.  During
	resynchronization, the status will be
	<code class="computeroutput">DEGRADED</code>, changing to
	<code class="computeroutput">COMPLETE</code> when the process is
	finished.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-raid3"></a>18.4. <acronym class="acronym">RAID</acronym>3 - Byte-level Striping with
	Dedicated Parity</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mark</span> <span class="surname">Gladman</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Daniel</span> <span class="surname">Gerzo</span></span>. </span></div><div><span class="authorgroup">Based on documentation by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div></div></div><a id="idp61648504" class="indexterm"></a><a id="idp61649400" class="indexterm"></a><p><acronym class="acronym">RAID</acronym>3 is a method used to combine several
      disk drives into a single volume with a dedicated parity disk.
      In a <acronym class="acronym">RAID</acronym>3 system, data is split up into a
      number of bytes that are written across all the drives in the
      array except for one disk which acts as a dedicated parity disk.
      This means that disk reads from a <acronym class="acronym">RAID</acronym>3
      implementation access all disks in the array.  Performance can
      be enhanced by using multiple disk controllers.  The
      <acronym class="acronym">RAID</acronym>3 array provides a fault tolerance of 1
      drive, while providing a capacity of 1 - 1/n times the total
      capacity of all drives in the array, where n is the number of
      hard drives in the array.  Such a configuration is mostly
      suitable for storing data of larger sizes such as multimedia
      files.</p><p>At least 3 physical hard drives are required to build a
      <acronym class="acronym">RAID</acronym>3 array.  Each disk must be of the same
      size, since <acronym class="acronym">I/O</acronym> requests are interleaved to
      read or write to multiple disks in parallel.  Also, due to the
      nature of <acronym class="acronym">RAID</acronym>3, the number of drives must be
      equal to 3, 5, 9, 17, and so on, or 2^n + 1.</p><p>This section demonstrates how to create a software
      <acronym class="acronym">RAID</acronym>3 on a FreeBSD system.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">While it is theoretically possible to boot from a
	<acronym class="acronym">RAID</acronym>3 array on FreeBSD, that configuration is
	uncommon and is not advised.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61659768"></a>18.4.1. Creating a Dedicated <acronym class="acronym">RAID</acronym>3
	Array</h3></div></div></div><p>In FreeBSD, support for <acronym class="acronym">RAID</acronym>3 is
	implemented by the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid3&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid3</span>(8)</span></a> <acronym class="acronym">GEOM</acronym>
	class.  Creating a dedicated <acronym class="acronym">RAID</acronym>3 array on
	FreeBSD requires the following steps.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>First, load the <code class="filename">geom_raid3.ko</code>
	    kernel module by issuing one of the following
	    commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid3 load</code></strong></pre><p>or:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload geom_raid3</code></strong></pre></li><li class="step"><p>Ensure that a suitable mount point exists.  This
	    command creates a new directory to use as the mount
	    point:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir <em class="replaceable"><code>/multimedia</code></em></code></strong></pre></li><li class="step"><p>Determine the device names for the disks which will be
	    added to the array, and create the new
	    <acronym class="acronym">RAID</acronym>3 device.  The final device listed
	    will act as the dedicated parity disk.  This example uses
	    three unpartitioned <acronym class="acronym">ATA</acronym> drives:
	    <code class="filename"><em class="replaceable"><code>ada1</code></em></code> and
	    <code class="filename"><em class="replaceable"><code>ada2</code></em></code> for
	    data, and
	    <code class="filename"><em class="replaceable"><code>ada3</code></em></code> for
	    parity.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid3 label -v gr0 /dev/ada1 /dev/ada2 /dev/ada3</code></strong>
Metadata value stored on /dev/ada1.
Metadata value stored on /dev/ada2.
Metadata value stored on /dev/ada3.
Done.</pre></li><li class="step"><p>Partition the newly created <code class="filename">gr0</code>
	    device and put a <acronym class="acronym">UFS</acronym> file system on
	    it:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart create -s GPT /dev/raid3/gr0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart add -t freebsd-ufs /dev/raid3/gr0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -j /dev/raid3/gr0p1</code></strong></pre><p>Many numbers will glide across the screen, and after a
	    bit of time, the process will be complete.  The volume has
	    been created and is ready to be mounted:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/raid3/gr0p1 /multimedia/</code></strong></pre><p>The <acronym class="acronym">RAID</acronym>3 array is now ready to
	    use.</p></li></ol></div><p>Additional configuration is needed to retain this setup
	across system reboots.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>The <code class="filename">geom_raid3.ko</code> module must be
	    loaded before the array can be mounted.  To automatically
	    load the kernel module during system initialization, add
	    the following line to
	    <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">geom_raid3_load="YES"</pre></li><li class="step"><p>The following volume information must be added to
	    <code class="filename">/etc/fstab</code> in order to
	    automatically mount the array's file system during the
	    system boot process:</p><pre class="programlisting">/dev/raid3/gr0p1	/multimedia	ufs	rw	2	2</pre></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-graid"></a>18.5. Software <acronym class="acronym">RAID</acronym> Devices</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div></div></div><a id="idp61679352" class="indexterm"></a><a id="idp61680248" class="indexterm"></a><p>Some motherboards and expansion cards add some simple
      hardware, usually just a <acronym class="acronym">ROM</acronym>, that allows the
      computer to boot from a <acronym class="acronym">RAID</acronym> array.  After
      booting, access to the <acronym class="acronym">RAID</acronym> array is handled
      by software running on the computer's main processor.  This
      <span class="quote">&#8220;<span class="quote">hardware-assisted software
	<acronym class="acronym">RAID</acronym></span>&#8221;</span> gives <acronym class="acronym">RAID</acronym>
      arrays that are not dependent on any particular operating
      system, and which are functional even before an operating system
      is loaded.</p><p>Several levels of <acronym class="acronym">RAID</acronym> are supported,
      depending on the hardware in use.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> for a
      complete list.</p><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> requires the <code class="filename">geom_raid.ko</code>
      kernel module, which is included in the
      <code class="filename">GENERIC</code> kernel starting with FreeBSD 9.1.
      If needed, it can be loaded manually with
      <code class="command">graid load</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-creating"></a>18.5.1. Creating an Array</h3></div></div></div><p>Software <acronym class="acronym">RAID</acronym> devices often have a menu
	that can be entered by pressing special keys when the computer
	is booting.  The menu can be used to create and delete
	<acronym class="acronym">RAID</acronym> arrays.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> can also create
	arrays directly from the command line.</p><p><code class="command">graid label</code> is used to create a new
	array.  The motherboard used for this example has an Intel
	software <acronym class="acronym">RAID</acronym> chipset, so the Intel
	metadata format is specified.  The new array is given a label
	of <code class="filename">gm0</code>, it is a mirror
	(<acronym class="acronym">RAID1</acronym>), and uses drives
	<code class="filename">ada0</code> and
	<code class="filename">ada1</code>.</p><div xmlns="" class="caution"><h3 class="admontitle">Caution: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some space on the drives will be overwritten when they
	  are made into a new array.  Back up existing data
	  first!</p></div><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid label Intel gm0 RAID1 ada0 ada1</code></strong>
GEOM_RAID: Intel-a29ea104: Array Intel-a29ea104 created.
GEOM_RAID: Intel-a29ea104: Disk ada0 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:0-ada0 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Array started.
GEOM_RAID: Intel-a29ea104: Volume gm0 state changed from STARTING to OPTIMAL.
Intel-a29ea104 created
GEOM_RAID: Intel-a29ea104: Provider raid/r0 for volume gm0 created.</pre><p>A status check shows the new mirror is ready for
	use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid status</code></strong>
   Name   Status  Components
raid/r0  OPTIMAL  ada0 (ACTIVE (ACTIVE))
                  ada1 (ACTIVE (ACTIVE))</pre><p>The array device appears in
	<code class="filename">/dev/raid/</code>.  The first array is called
	<code class="filename">r0</code>.  Additional arrays, if present, will
	be <code class="filename">r1</code>, <code class="filename">r2</code>, and so
	on.</p><p>The <acronym class="acronym">BIOS</acronym> menu on some of these devices
	can create arrays with special characters in their names.  To
	avoid problems with those special characters, arrays are given
	simple numbered names like <code class="filename">r0</code>.  To show
	the actual labels, like <code class="filename">gm0</code> in the
	example above, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl kern.geom.raid.name_format=1</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-volumes"></a>18.5.2. Multiple Volumes</h3></div></div></div><p>Some software <acronym class="acronym">RAID</acronym> devices support
	more than one <span class="emphasis"><em>volume</em></span> on an array.
	Volumes work like partitions, allowing space on the physical
	drives to be split and used in different ways.  For example,
	Intel software <acronym class="acronym">RAID</acronym> devices support two
	volumes.  This example creates a 40 G mirror for safely
	storing the operating system, followed by a 20 G
	<acronym class="acronym">RAID0</acronym> (stripe) volume for fast temporary
	storage:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid label -S 40G Intel gm0 RAID1 ada0 ada1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>graid add -S 20G gm0 RAID0</code></strong></pre><p>Volumes appear as additional
	<code class="filename">r<em class="replaceable"><code>X</code></em></code> entries
	in <code class="filename">/dev/raid/</code>.  An array with two volumes
	will show <code class="filename">r0</code> and
	<code class="filename">r1</code>.</p><p>See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> for the number of volumes supported by
	different software <acronym class="acronym">RAID</acronym> devices.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-converting"></a>18.5.3. Converting a Single Drive to a Mirror</h3></div></div></div><p>Under certain specific conditions, it is possible to
	convert an existing single drive to a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> array
	without reformatting.  To avoid data loss during the
	conversion, the existing drive must meet these minimum
	requirements:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The drive must be partitioned with the
	    <acronym class="acronym">MBR</acronym> partitioning scheme.
	    <acronym class="acronym">GPT</acronym> or other partitioning schemes with
	    metadata at the end of the drive will be overwritten and
	    corrupted by the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> metadata.</p></li><li class="listitem"><p>There must be enough unpartitioned and unused space at
	    the end of the drive to hold the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> metadata.
	    This metadata varies in size, but the largest occupies
	    64 M, so at least that much free space is
	    recommended.</p></li></ul></div><p>If the drive meets these requirements, start by making a
	full backup.  Then create a single-drive mirror with that
	drive:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid label Intel gm0 RAID1 ada0 NONE</code></strong></pre><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> metadata was written to the end of the drive
	in the unused space.  A second drive can now be inserted into
	the mirror:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid insert raid/r0 ada1</code></strong></pre><p>Data from the original drive will immediately begin to be
	copied to the second drive.  The mirror will operate in
	degraded status until the copy is complete.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-inserting"></a>18.5.4. Inserting New Drives into the Array</h3></div></div></div><p>Drives can be inserted into an array as replacements for
	drives that have failed or are missing.  If there are no
	failed or missing drives, the new drive becomes a spare.  For
	example, inserting a new drive into a working two-drive mirror
	results in a two-drive mirror with one spare drive, not a
	three-drive mirror.</p><p>In the example mirror array, data immediately begins to be
	copied to the newly-inserted drive.  Any existing information
	on the new drive will be overwritten.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid insert raid/r0 ada1</code></strong>
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from NONE to ACTIVE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NONE to NEW.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 state changed from NEW to REBUILD.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-ada1 rebuild start at 0.</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-removing"></a>18.5.5. Removing Drives from the Array</h3></div></div></div><p>Individual drives can be permanently removed from a
	from an array and their metadata erased:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid remove raid/r0 ada1</code></strong>
GEOM_RAID: Intel-a29ea104: Disk ada1 state changed from ACTIVE to OFFLINE.
GEOM_RAID: Intel-a29ea104: Subdisk gm0:1-[unknown] state changed from ACTIVE to NONE.
GEOM_RAID: Intel-a29ea104: Volume gm0 state changed from OPTIMAL to DEGRADED.</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-stopping"></a>18.5.6. Stopping the Array</h3></div></div></div><p>An array can be stopped without removing metadata from the
	drives.  The array will be restarted when the system is
	booted.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid stop raid/r0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-status"></a>18.5.7. Checking Array Status</h3></div></div></div><p>Array status can be checked at any time.  After a drive
	was added to the mirror in the example above, data is being
	copied from the original drive to the new drive:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid status</code></strong>
   Name    Status  Components
raid/r0  DEGRADED  ada0 (ACTIVE (ACTIVE))
                   ada1 (ACTIVE (REBUILD 28%))</pre><p>Some types of arrays, like <code class="literal">RAID0</code> or
	<code class="literal">CONCAT</code>, may not be shown in the status
	report if disks have failed.  To see these partially-failed
	arrays, add <code class="option">-ga</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid status -ga</code></strong>
          Name  Status  Components
Intel-e2d07d9a  BROKEN  ada6 (ACTIVE (ACTIVE))</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-deleting"></a>18.5.8. Deleting Arrays</h3></div></div></div><p>Arrays are destroyed by deleting all of the volumes from
	them.  When the last volume present is deleted, the array is
	stopped and metadata is removed from the drives:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid delete raid/r0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="geom-graid-unexpected"></a>18.5.9. Deleting Unexpected Arrays</h3></div></div></div><p>Drives may unexpectedly contain <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> metadata,
	either from previous use or manufacturer testing.
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> will detect these drives and create an array,
	interfering with access to the individual drive.  To remove
	the unwanted metadata:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Boot the system.  At the boot menu, select
	    <code class="literal">2</code> for the loader prompt.  Enter:</p><pre class="screen">OK <strong class="userinput"><code>set kern.geom.raid.enable=0</code></strong>
OK <strong class="userinput"><code>boot</code></strong></pre><p>The system will boot with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a>
	    disabled.</p></li><li class="step"><p>Back up all data on the affected drive.</p></li><li class="step"><p>As a workaround, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> array detection
	    can be disabled by adding</p><pre class="programlisting">kern.geom.raid.enable=0</pre><p>to <code class="filename">/boot/loader.conf</code>.</p><p>To permanently remove the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=graid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">graid</span>(8)</span></a> metadata
	    from the affected drive, boot a FreeBSD installation
	    <acronym class="acronym">CD-ROM</acronym> or memory stick, and select
	    <code class="literal">Shell</code>.  Use <code class="command">status</code>
	    to find the name of the array, typically
	    <code class="literal">raid/r0</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid status</code></strong>
   Name   Status  Components
raid/r0  OPTIMAL  ada0 (ACTIVE (ACTIVE))
                  ada1 (ACTIVE (ACTIVE))</pre><p>Delete the volume by name:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>graid delete raid/r0</code></strong></pre><p>If there is more than one volume shown, repeat the
	    process for each volume.  After the last array has been
	    deleted, the volume will be destroyed.</p><p>Reboot and verify data, restoring from backup if
	    necessary.  After the metadata has been removed, the
	    <code class="literal">kern.geom.raid.enable=0</code> entry in
	    <code class="filename">/boot/loader.conf</code> can also be
	    removed.</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-ggate"></a>18.6. <acronym class="acronym">GEOM</acronym> Gate Network</h2></div></div></div><p><acronym class="acronym">GEOM</acronym> provides a simple mechanism for
      providing remote access to devices such as disks,
      <acronym class="acronym">CD</acronym>s, and file systems through the use of the
      <acronym class="acronym">GEOM</acronym> Gate network daemon,
      <span class="application">ggated</span>.  The system with the device
      runs the server daemon which handles requests made by clients
      using <span class="application">ggatec</span>.  The devices should not
      contain any sensitive data as the connection between the client
      and the server is not encrypted.</p><p>Similar to <acronym class="acronym">NFS</acronym>, which is discussed in
      <a class="xref" href="#network-nfs" title="29.3. Network File System (NFS)">Section 29.3, &#8220;Network File System (NFS)&#8221;</a>, <span class="application">ggated</span>
      is configured using an exports file.  This file specifies which
      systems are permitted to access the exported resources and what
      level of access they are offered.  For example, to give the
      client <code class="systemitem">192.168.1.5</code>
      read and write access to the fourth slice on the first
      <acronym class="acronym">SCSI</acronym> disk, create
      <code class="filename">/etc/gg.exports</code> with this line:</p><pre class="programlisting">192.168.1.5 RW /dev/da0s4d</pre><p>Before exporting the device, ensure it is not currently
      mounted.  Then, start <span class="application">ggated</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ggated</code></strong></pre><p>Several options are available for specifying an alternate
      listening port or changing the default location of the exports
      file.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ggated&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ggated</span>(8)</span></a> for details.</p><p>To access the exported device on the client machine, first
      use <code class="command">ggatec</code> to specify the
      <acronym class="acronym">IP</acronym> address of the server and the device name
      of the exported device.  If successful, this command will
      display a <code class="literal">ggate</code> device name to mount.  Mount
      that specified device name on a free mount point.  This example
      connects to the <code class="filename">/dev/da0s4d</code> partition on
      <code class="literal">192.168.1.1</code>, then mounts
      <code class="filename">/dev/ggate0</code> on
      <code class="filename">/mnt</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ggatec create -o rw 192.168.1.1 /dev/da0s4d</code></strong>
ggate0
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/ggate0 /mnt</code></strong></pre><p>The device on the server may now be accessed through
      <code class="filename">/mnt</code> on the client.  For more details about
      <code class="command">ggatec</code> and a few usage examples, refer to
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ggatec&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ggatec</span>(8)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The mount will fail if the device is currently mounted on
	either the server or any other client on the network.  If
	simultaneous access is needed to network resources, use
	<acronym class="acronym">NFS</acronym> instead.</p></div><p>When the device is no longer needed, unmount it with
      <code class="command">umount</code> so that the resource is available to
      other clients.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-glabel"></a>18.7. Labeling Disk Devices</h2></div></div></div><a id="idp61864312" class="indexterm"></a><a id="idp61865208" class="indexterm"></a><p>During system initialization, the FreeBSD kernel creates
      device nodes as devices are found.  This method of probing for
      devices raises some issues.  For instance, what if a new disk
      device is added via <acronym class="acronym">USB</acronym>?  It is likely that
      a flash device may be handed the device name of
      <code class="filename">da0</code> and the original
      <code class="filename">da0</code> shifted to
      <code class="filename">da1</code>.  This will cause issues mounting
      file systems if they are listed in
      <code class="filename">/etc/fstab</code> which may also prevent the
      system from booting.</p><p>One solution is to chain <acronym class="acronym">SCSI</acronym> devices
      in order so a new device added to the <acronym class="acronym">SCSI</acronym>
      card will be issued unused device numbers.  But what about
      <acronym class="acronym">USB</acronym> devices which may replace the primary
      <acronym class="acronym">SCSI</acronym> disk?  This happens because
      <acronym class="acronym">USB</acronym> devices are usually probed before the
      <acronym class="acronym">SCSI</acronym> card.  One solution is to only insert
      these devices after the system has been booted.  Another method
      is to use only a single <acronym class="acronym">ATA</acronym> drive and never
      list the <acronym class="acronym">SCSI</acronym> devices in
      <code class="filename">/etc/fstab</code>.</p><p>A better solution is to use <code class="command">glabel</code> to
      label the disk devices and use the labels in
      <code class="filename">/etc/fstab</code>.  Because
      <code class="command">glabel</code> stores the label in the last sector of
      a given provider, the label will remain persistent across
      reboots.  By using this label as a device, the file system may
      always be mounted regardless of what device node it is accessed
      through.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="command">glabel</code> can create both transient and
	permanent labels.  Only permanent labels are consistent across
	reboots.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=glabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">glabel</span>(8)</span></a> for more information on the
	differences between labels.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61875576"></a>18.7.1. Label Types and Examples</h3></div></div></div><p>Permanent labels can be a generic or a file system label.
	Permanent file system labels can be created with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a>.  These types of labels are
	created in a sub-directory of <code class="filename">/dev</code>, and
	will be named according to the file system type.  For example,
	<acronym class="acronym">UFS</acronym>2 file system labels will be created in
	<code class="filename">/dev/ufs</code>.  Generic permanent labels can
	be created with <code class="command">glabel label</code>.  These are
	not file system specific and will be created in
	<code class="filename">/dev/label</code>.</p><p>Temporary labels are destroyed at the next reboot.  These
	labels are created in <code class="filename">/dev/label</code> and are
	suited to experimentation.  A temporary label can be created
	using <code class="command">glabel create</code>.</p><p>To create a permanent label for a
	<acronym class="acronym">UFS</acronym>2 file system without destroying any
	data, issue the following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -L <em class="replaceable"><code>home</code></em> <em class="replaceable"><code>/dev/da3</code></em></code></strong></pre><p>A label should now exist in <code class="filename">/dev/ufs</code>
	which may be added to <code class="filename">/etc/fstab</code>:</p><pre class="programlisting">/dev/ufs/home		/home            ufs     rw              2      2</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The file system must not be mounted while attempting
	  to run <code class="command">tunefs</code>.</p></div><p>Now the file system may be mounted:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /home</code></strong></pre><p>From this point on, so long as the
	<code class="filename">geom_label.ko</code> kernel module is loaded at
	boot with <code class="filename">/boot/loader.conf</code> or the
	<code class="literal">GEOM_LABEL</code> kernel option is present,
	the device node may change without any ill effect on the
	system.</p><p>File systems may also be created with a default label
	by using the <code class="option">-L</code> flag with
	<code class="command">newfs</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a> for
	more information.</p><p>The following command can be used to destroy the
	label:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>glabel destroy home</code></strong></pre><p>The following example shows how to label the partitions of
	a boot disk.</p><div class="example"><a id="idp61897080"></a><div class="example-title">Example 18.1. Labeling Partitions on the Boot Disk</div><div class="example-contents"><p>By permanently labeling the partitions on the boot disk,
	  the system should be able to continue to boot normally, even
	  if the disk is moved to another controller or transferred to
	  a different system.  For this example, it is assumed that a
	  single <acronym class="acronym">ATA</acronym> disk is used, which is
	  currently recognized by the system as
	  <code class="filename">ad0</code>.  It is also assumed that the
	  standard FreeBSD partition scheme is used, with
	  <code class="filename">/</code>,
	  <code class="filename">/var</code>,
	  <code class="filename">/usr</code> and
	  <code class="filename">/tmp</code>, as
	  well as a swap partition.</p><p>Reboot the system, and at the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> prompt,
	  press <span class="keycap"><strong>4</strong></span> to boot into single user mode.
	  Then enter the following commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>glabel label rootfs /dev/ad0s1a</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1a is label/rootfs
<code class="prompt">#</code> <strong class="userinput"><code>glabel label var /dev/ad0s1d</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1d is label/var
<code class="prompt">#</code> <strong class="userinput"><code>glabel label usr /dev/ad0s1f</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1f is label/usr
<code class="prompt">#</code> <strong class="userinput"><code>glabel label tmp /dev/ad0s1e</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1e is label/tmp
<code class="prompt">#</code> <strong class="userinput"><code>glabel label swap /dev/ad0s1b</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1b is label/swap
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong></pre><p>The system will continue with multi-user boot.  After
	  the boot completes, edit <code class="filename">/etc/fstab</code> and
	  replace the conventional device names, with their respective
	  labels.  The final <code class="filename">/etc/fstab</code> will
	  look like this:</p><pre class="programlisting"># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/label/swap         none            swap    sw              0       0
/dev/label/rootfs       /               ufs     rw              1       1
/dev/label/tmp          /tmp            ufs     rw              2       2
/dev/label/usr          /usr            ufs     rw              2       2
/dev/label/var          /var            ufs     rw              2       2</pre><p>The system can now be rebooted.  If everything went
	  well, it will come up normally and <code class="command">mount</code>
	  will show:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/label/rootfs on / (ufs, local)
devfs on /dev (devfs, local)
/dev/label/tmp on /tmp (ufs, local, soft-updates)
/dev/label/usr on /usr (ufs, local, soft-updates)
/dev/label/var on /var (ufs, local, soft-updates)</pre></div></div><br class="example-break" /><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=glabel&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">glabel</span>(8)</span></a> class
	supports a label type for <acronym class="acronym">UFS</acronym> file
	systems, based on the unique file system id,
	<code class="literal">ufsid</code>.  These labels may be found in
	<code class="filename">/dev/ufsid</code> and are
	created automatically during system startup.  It is possible
	to use <code class="literal">ufsid</code> labels to mount partitions
	using <code class="filename">/etc/fstab</code>.  Use <code class="command">glabel
	  status</code> to receive a list of file systems and their
	corresponding <code class="literal">ufsid</code> labels:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>glabel status</code></strong>
                  Name  Status  Components
ufsid/486b6fc38d330916     N/A  ad4s1d
ufsid/486b6fc16926168e     N/A  ad4s1f</pre><p>In the above example, <code class="filename">ad4s1d</code>
	represents <code class="filename">/var</code>,
	while <code class="filename">ad4s1f</code> represents
	<code class="filename">/usr</code>.
	Using the <code class="literal">ufsid</code> values shown, these
	partitions may now be mounted with the following entries in
	<code class="filename">/etc/fstab</code>:</p><pre class="programlisting">/dev/ufsid/486b6fc38d330916        /var        ufs        rw        2      2
/dev/ufsid/486b6fc16926168e        /usr        ufs        rw        2      2</pre><p>Any partitions with <code class="literal">ufsid</code> labels can be
	mounted in this way, eliminating the need to manually create
	permanent labels, while still enjoying the benefits of device
	name independent mounting.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-gjournal"></a>18.8. UFS Journaling Through <acronym class="acronym">GEOM</acronym></h2></div></div></div><a id="idp61928440" class="indexterm"></a><a id="idp61929336" class="indexterm"></a><p>Support for journals on
      <acronym class="acronym">UFS</acronym> file systems is available on FreeBSD.  The
      implementation is provided through the <acronym class="acronym">GEOM</acronym>
      subsystem and is configured using <code class="command">gjournal</code>.
      Unlike other file system journaling implementations, the
      <code class="command">gjournal</code> method is block based and not
      implemented as part of the file system.  It is a
      <acronym class="acronym">GEOM</acronym> extension.</p><p>Journaling stores a log of file system transactions, such as
      changes that make up a complete disk write operation, before
      meta-data and file writes are committed to the disk.  This
      transaction log can later be replayed to redo file system
      transactions, preventing file system inconsistencies.</p><p>This method provides another mechanism to protect against
      data loss and inconsistencies of the file system.  Unlike Soft
      Updates, which tracks and enforces meta-data updates, and
      snapshots, which create an image of the file system, a log is
      stored in disk space specifically for this task.  For better
      performance, the journal may be stored on another disk.  In this
      configuration, the journal provider or storage device should be
      listed after the device to enable journaling on.</p><p>The <code class="filename">GENERIC</code> kernel provides support for
      <code class="command">gjournal</code>.  To automatically load the
      <code class="filename">geom_journal.ko</code> kernel module at boot time,
      add the following line to
      <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">geom_journal_load="YES"</pre><p>If a custom kernel is used, ensure the following line is in
      the kernel configuration file:</p><pre class="programlisting">options	GEOM_JOURNAL</pre><p>Once the module is loaded, a journal can be created on a new
      file system using the following steps.  In this example,
      <code class="filename">da4</code> is a new <acronym class="acronym">SCSI</acronym>
      disk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal load</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gjournal label /dev/<em class="replaceable"><code>da4</code></em></code></strong></pre><p>This will load the module and create a
      <code class="filename">/dev/da4.journal</code> device node on
      <code class="filename">/dev/da4</code>.</p><p>A <acronym class="acronym">UFS</acronym> file system may now be created on
      the journaled device, then mounted on an existing mount
      point:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -O 2 -J /dev/<em class="replaceable"><code>da4</code></em>.journal</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/<em class="replaceable"><code>da4</code></em>.journal <em class="replaceable"><code>/mnt</code></em></code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In the case of several slices, a journal will be created
	for each individual slice.  For instance, if
	<code class="filename">ad4s1</code> and <code class="filename">ad4s2</code> are
	both slices, then <code class="command">gjournal</code> will create
	<code class="filename">ad4s1.journal</code> and
	<code class="filename">ad4s2.journal</code>.</p></div><p>Journaling may also be enabled on current file systems by
      using <code class="command">tunefs</code>.  However,
      <span class="emphasis"><em>always</em></span> make a backup before attempting to
      alter an existing file system.  In most cases,
      <code class="command">gjournal</code> will fail if it is unable to create
      the journal, but this does not protect against data loss
      incurred as a result of misusing <code class="command">tunefs</code>.
      Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gjournal&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gjournal</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> for more
      information about these commands.</p><p>It is possible to journal the boot disk of a FreeBSD system.
      Refer to the article <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/gjournal-desktop" target="_top">Implementing UFS
	Journaling on a Desktop PC</a> for detailed
      instructions.</p></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs"></a>Chapter 19. The Z File System (<acronym class="acronym">ZFS</acronym>)</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Benedict</span> <span class="surname">Reuschling</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Warren</span> <span class="surname">Block</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#zfs-differences">19.1. What Makes <acronym class="acronym">ZFS</acronym> Different</a></span></dt><dt><span class="sect1"><a href="#zfs-quickstart">19.2. Quick Start Guide</a></span></dt><dt><span class="sect1"><a href="#zfs-zpool">19.3. <code class="command">zpool</code> Administration</a></span></dt><dt><span class="sect1"><a href="#zfs-zfs">19.4. <code class="command">zfs</code> Administration</a></span></dt><dt><span class="sect1"><a href="#zfs-zfs-allow">19.5. Delegated Administration</a></span></dt><dt><span class="sect1"><a href="#zfs-advanced">19.6. Advanced Topics</a></span></dt><dt><span class="sect1"><a href="#zfs-links">19.7. Additional Resources</a></span></dt><dt><span class="sect1"><a href="#zfs-term">19.8. <acronym class="acronym">ZFS</acronym> Features and Terminology</a></span></dt></dl></div><p>The <span class="emphasis"><em>Z File System</em></span>, or
    <acronym class="acronym">ZFS</acronym>, is an advanced file system designed to
    overcome many of the major problems found in previous
    designs.</p><p>Originally developed at <span class="trademark">Sun</span>&#8482;, ongoing open source
    <acronym class="acronym">ZFS</acronym> development has moved to the <a class="link" href="http://open-zfs.org" target="_top">OpenZFS Project</a>.</p><p><acronym class="acronym">ZFS</acronym> has three major design goals:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Data integrity: All data includes a
	<a class="link" href="#zfs-term-checksum">checksum</a> of the data.
	When data is written, the checksum is calculated and written
	along with it.  When that data is later read back, the
	checksum is calculated again.  If the checksums do not match,
	a data error has been detected.  <acronym class="acronym">ZFS</acronym> will
	attempt to automatically correct errors when data redundancy
	is available.</p></li><li class="listitem"><p>Pooled storage: physical storage devices are added to a
	pool, and storage space is allocated from that shared pool.
	Space is available to all file systems, and can be increased
	by adding new storage devices to the pool.</p></li><li class="listitem"><p>Performance: multiple caching mechanisms provide increased
	performance.  <a class="link" href="#zfs-term-arc">ARC</a> is an
	advanced memory-based read cache.  A second level of
	disk-based read cache can be added with
	<a class="link" href="#zfs-term-l2arc">L2ARC</a>, and disk-based
	synchronous write cache is available with
	<a class="link" href="#zfs-term-zil">ZIL</a>.</p></li></ul></div><p>A complete list of features and terminology is shown in
    <a class="xref" href="#zfs-term" title="19.8. ZFS Features and Terminology">Section 19.8, &#8220;<acronym class="acronym">ZFS</acronym> Features and Terminology&#8221;</a>.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-differences"></a>19.1. What Makes <acronym class="acronym">ZFS</acronym> Different</h2></div></div></div><p><acronym class="acronym">ZFS</acronym> is significantly different from any
      previous file system because it is more than just a file system.
      Combining the traditionally separate roles of volume manager and
      file system provides <acronym class="acronym">ZFS</acronym> with unique
      advantages.  The file system is now aware of the underlying
      structure of the disks.  Traditional file systems could only be
      created on a single disk at a time.  If there were two disks
      then two separate file systems would have to be created.  In a
      traditional hardware <acronym class="acronym">RAID</acronym> configuration, this
      problem was avoided by presenting the operating system with a
      single logical disk made up of the space provided by a number of
      physical disks, on top of which the operating system placed a
      file system.  Even in the case of software
      <acronym class="acronym">RAID</acronym> solutions like those provided by
      <acronym class="acronym">GEOM</acronym>, the <acronym class="acronym">UFS</acronym> file system
      living on top of the <acronym class="acronym">RAID</acronym> transform believed
      that it was dealing with a single device.
      <acronym class="acronym">ZFS</acronym>'s combination of the volume manager and
      the file system solves this and allows the creation of many file
      systems all sharing a pool of available storage.  One of the
      biggest advantages to <acronym class="acronym">ZFS</acronym>'s awareness of the
      physical layout of the disks is that existing file systems can
      be grown automatically when additional disks are added to the
      pool.  This new space is then made available to all of the file
      systems.  <acronym class="acronym">ZFS</acronym> also has a number of different
      properties that can be applied to each file system, giving many
      advantages to creating a number of different file systems and
      datasets rather than a single monolithic file system.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-quickstart"></a>19.2. Quick Start Guide</h2></div></div></div><p>There is a startup mechanism that allows FreeBSD to mount
      <acronym class="acronym">ZFS</acronym> pools during system initialization.  To
      enable it, add this line to
      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">zfs_enable="YES"</pre><p>Then start the service:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service zfs start</code></strong></pre><p>The examples in this section assume three
      <acronym class="acronym">SCSI</acronym> disks with the device names
      <code class="filename"><em class="replaceable"><code>da0</code></em></code>,
      <code class="filename"><em class="replaceable"><code>da1</code></em></code>, and
      <code class="filename"><em class="replaceable"><code>da2</code></em></code>.  Users
      of <acronym class="acronym">SATA</acronym> hardware should instead use
      <code class="filename"><em class="replaceable"><code>ada</code></em></code> device
      names.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-quickstart-single-disk-pool"></a>19.2.1. Single Disk Pool</h3></div></div></div><p>To create a simple, non-redundant pool using a single
	disk device:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create <em class="replaceable"><code>example</code></em> <em class="replaceable"><code>/dev/da0</code></em></code></strong></pre><p>To view the new pool, review the output of
	<code class="command">df</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235230  1628718    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032846 48737598     2%    /usr
example      17547136       0 17547136     0%    /example</pre><p>This output shows that the <code class="literal">example</code> pool
	has been created and mounted.  It is now accessible as a file
	system.  Files can be created on it and users can browse
	it:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /example</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>touch testfile</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls -al</code></strong>
total 4
drwxr-xr-x   2 root  wheel    3 Aug 29 23:15 .
drwxr-xr-x  21 root  wheel  512 Aug 29 23:12 ..
-rw-r--r--   1 root  wheel    0 Aug 29 23:15 testfile</pre><p>However, this pool is not taking advantage of any
	<acronym class="acronym">ZFS</acronym> features.  To create a dataset on this
	pool with compression enabled:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip example/compressed</code></strong></pre><p>The <code class="literal">example/compressed</code> dataset is now a
	<acronym class="acronym">ZFS</acronym> compressed file system.  Try copying
	some large files to
	<code class="filename">/example/compressed</code>.</p><p>Compression can be disabled with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=off example/compressed</code></strong></pre><p>To unmount a file system, use
	<code class="command">zfs umount</code> and then verify with
	<code class="command">df</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs umount example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235232  1628716    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032864 48737580     2%    /usr
example      17547008       0 17547008     0%    /example</pre><p>To re-mount the file system to make it accessible again,
	use <code class="command">zfs mount</code> and verify with
	<code class="command">df</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs mount example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed</pre><p>The pool and file system may also be observed by viewing
	the output from <code class="command">mount</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
example on /example (zfs, local)
example/compressed on /example/compressed (zfs, local)</pre><p>After creation, <acronym class="acronym">ZFS</acronym> datasets can be
	used like any file systems.  However, many other features are
	available which can be set on a per-dataset basis.  In the
	example below, a new file system called
	<code class="literal">data</code> is created.  Important files will be
	stored here, so it is configured to keep two copies of each
	data block:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create example/data</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set copies=2 example/data</code></strong></pre><p>It is now possible to see the data and space utilization
	by issuing <code class="command">df</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed
example/data        17547008       0 17547008     0%    /example/data</pre><p>Notice that each file system on the pool has the same
	amount of available space.  This is the reason for using
	<code class="command">df</code> in these examples, to show that the file
	systems use only the amount of space they need and all draw
	from the same pool.  <acronym class="acronym">ZFS</acronym> eliminates
	concepts such as volumes and partitions, and allows multiple
	file systems to occupy the same pool.</p><p>To destroy the file systems and then destroy the pool as
	it is no longer needed:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs destroy example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs destroy example/data</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool destroy example</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-quickstart-raid-z"></a>19.2.2. RAID-Z</h3></div></div></div><p>Disks fail.  One method of avoiding data loss from disk
	failure is to implement <acronym class="acronym">RAID</acronym>.
	<acronym class="acronym">ZFS</acronym> supports this feature in its pool
	design.  <acronym class="acronym">RAID-Z</acronym> pools require three or more
	disks but provide more usable space than mirrored
	pools.</p><p>This example creates a <acronym class="acronym">RAID-Z</acronym> pool,
	specifying the disks to add to the pool:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create storage raidz da0 da1 da2</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="trademark">Sun</span>&#8482; recommends that the number of devices used in a
	  <acronym class="acronym">RAID</acronym>-Z configuration be between three and
	  nine.  For environments requiring a single pool consisting
	  of 10 disks or more, consider breaking it up into smaller
	  <acronym class="acronym">RAID-Z</acronym> groups.  If only two disks are
	  available and redundancy is a requirement, consider using a
	  <acronym class="acronym">ZFS</acronym> mirror.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> for
	  more details.</p></div><p>The previous example created the
	<code class="literal">storage</code> zpool.  This example makes a new
	file system called <code class="literal">home</code> in that
	pool:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create storage/home</code></strong></pre><p>Compression and keeping extra copies of directories
	and files can be enabled:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set copies=2 storage/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip storage/home</code></strong></pre><p>To make this the new home directory for users, copy the
	user data to this directory and create the appropriate
	symbolic links:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp -rp /home/* /storage/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf /home /usr/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /storage/home /home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /storage/home /usr/home</code></strong></pre><p>Users data is now stored on the freshly-created
	<code class="filename">/storage/home</code>.  Test by adding a new user
	and logging in as that user.</p><p>Try creating a file system snapshot which can be rolled
	back later:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot storage/home@08-30-08</code></strong></pre><p>Snapshots can only be made of a full file system, not a
	single directory or file.</p><p>The <code class="literal">@</code> character is a delimiter between
	the file system name or the volume name.  If an important
	directory has been accidentally deleted, the file system can
	be backed up, then rolled back to an earlier snapshot when the
	directory still existed:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs rollback storage/home@08-30-08</code></strong></pre><p>To list all available snapshots, run
	<code class="command">ls</code> in the file system's
	<code class="filename">.zfs/snapshot</code> directory.  For example, to
	see the previously taken snapshot:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /storage/home/.zfs/snapshot</code></strong></pre><p>It is possible to write a script to perform regular
	snapshots on user data.  However, over time, snapshots can
	consume a great deal of disk space.  The previous snapshot can
	be removed using the command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs destroy storage/home@08-30-08</code></strong></pre><p>After testing, <code class="filename">/storage/home</code> can be
	made the real <code class="filename">/home</code> using this
	command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set mountpoint=/home storage/home</code></strong></pre><p>Run <code class="command">df</code> and <code class="command">mount</code> to
	confirm that the system now treats the file system as the real
	<code class="filename">/home</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
storage on /storage (zfs, local)
storage/home on /home (zfs, local)
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem   1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a    2026030  235240  1628708    13%    /
devfs                1       1        0   100%    /dev
/dev/ad0s1d   54098308 1032826 48737618     2%    /usr
storage       26320512       0 26320512     0%    /storage
storage/home  26320512       0 26320512     0%    /home</pre><p>This completes the <acronym class="acronym">RAID-Z</acronym>
	configuration.  Daily status updates about the file systems
	created can be generated as part of the nightly
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a> runs.  Add this line to
	<code class="filename">/etc/periodic.conf</code>:</p><pre class="programlisting">daily_status_zfs_enable="YES"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-quickstart-recovering-raid-z"></a>19.2.3. Recovering <acronym class="acronym">RAID-Z</acronym></h3></div></div></div><p>Every software <acronym class="acronym">RAID</acronym> has a method of
	monitoring its <code class="literal">state</code>.  The status of
	<acronym class="acronym">RAID-Z</acronym> devices may be viewed with this
	command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status -x</code></strong></pre><p>If all pools are
	<a class="link" href="#zfs-term-online">Online</a> and everything
	is normal, the message shows:</p><pre class="screen">all pools are healthy</pre><p>If there is an issue, perhaps a disk is in the
	<a class="link" href="#zfs-term-offline">Offline</a> state, the
	pool state will look similar to:</p><pre class="screen">  pool: storage
 state: DEGRADED
status: One or more devices has been taken offline by the administrator.
	Sufficient replicas exist for the pool to continue functioning in a
	degraded state.
action: Online the device using 'zpool online' or replace the device with
	'zpool replace'.
 scrub: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	storage     DEGRADED     0     0     0
	  raidz1    DEGRADED     0     0     0
	    da0     ONLINE       0     0     0
	    da1     OFFLINE      0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>This indicates that the device was previously taken
	offline by the administrator with this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool offline storage da1</code></strong></pre><p>Now the system can be powered down to replace
	<code class="filename">da1</code>.  When the system is back online,
	the failed disk can replaced in the pool:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool replace storage da1</code></strong></pre><p>From here, the status may be checked again, this time
	without <code class="option">-x</code> so that all pools are
	shown:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status storage</code></strong>
 pool: storage
 state: ONLINE
 scrub: resilver completed with 0 errors on Sat Aug 30 19:44:11 2008
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>In this example, everything is normal.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-quickstart-data-verification"></a>19.2.4. Data Verification</h3></div></div></div><p><acronym class="acronym">ZFS</acronym> uses checksums to verify the
	integrity of stored data.  These are enabled automatically
	upon creation of file systems.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Checksums can be disabled, but it is
	  <span class="emphasis"><em>not</em></span> recommended!  Checksums take very
	  little storage space and provide data integrity.  Many
	  <acronym class="acronym">ZFS</acronym> features will not work properly with
	  checksums disabled.  There is no noticeable performance gain
	  from disabling these checksums.</p></div><p>Checksum verification is known as
	<span class="emphasis"><em>scrubbing</em></span>.  Verify the data integrity of
	the <code class="literal">storage</code> pool with this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool scrub storage</code></strong></pre><p>The duration of a scrub depends on the amount of data
	stored.  Larger amounts of data will take proportionally
	longer to verify.  Scrubs are very <acronym class="acronym">I/O</acronym>
	intensive, and only one scrub is allowed to run at a time.
	After the scrub completes, the status can be viewed with
	<code class="command">status</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status storage</code></strong>
 pool: storage
 state: ONLINE
 scrub: scrub completed with 0 errors on Sat Jan 26 19:57:37 2013
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>The completion date of the last scrub operation is
	displayed to help track when another scrub is required.
	Routine scrubs help protect data from silent corruption and
	ensure the integrity of the pool.</p><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zfs</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> for other
	<acronym class="acronym">ZFS</acronym> options.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-zpool"></a>19.3. <code class="command">zpool</code> Administration</h2></div></div></div><p><acronym class="acronym">ZFS</acronym> administration is divided between two
      main utilities.  The <code class="command">zpool</code> utility controls
      the operation of the pool and deals with adding, removing,
      replacing, and managing disks.  The
      <a class="link" href="#zfs-zfs" title="19.4. zfs Administration"><code class="command">zfs</code></a> utility
      deals with creating, destroying, and managing datasets,
      both <a class="link" href="#zfs-term-filesystem">file systems</a> and
      <a class="link" href="#zfs-term-volume">volumes</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-create"></a>19.3.1. Creating and Destroying Storage Pools</h3></div></div></div><p>Creating a <acronym class="acronym">ZFS</acronym> storage pool
	(<span class="emphasis"><em>zpool</em></span>) involves making a number of
	decisions that are relatively permanent because the structure
	of the pool cannot be changed after the pool has been created.
	The most important decision is what types of vdevs into which
	to group the physical disks.  See the list of
	<a class="link" href="#zfs-term-vdev">vdev types</a> for details
	about the possible options.  After the pool has been created,
	most vdev types do not allow additional disks to be added to
	the vdev.  The exceptions are mirrors, which allow additional
	disks to be added to the vdev, and stripes, which can be
	upgraded to mirrors by attaching an additional disk to the
	vdev.  Although additional vdevs can be added to expand a
	pool, the layout of the pool cannot be changed after pool
	creation.  Instead, the data must be backed up and the
	pool destroyed and recreated.</p><p>Create a simple mirror pool:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create <em class="replaceable"><code>mypool</code></em> mirror <em class="replaceable"><code>/dev/ada1</code></em> <em class="replaceable"><code>/dev/ada2</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada1    ONLINE       0     0     0
            ada2    ONLINE       0     0     0

errors: No known data errors</pre><p>Multiple vdevs can be created at once.  Specify multiple
	groups of disks separated by the vdev type keyword,
	<code class="literal">mirror</code> in this example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create <em class="replaceable"><code>mypool</code></em> mirror <em class="replaceable"><code>/dev/ada1</code></em> <em class="replaceable"><code>/dev/ada2</code></em> mirror <em class="replaceable"><code>/dev/ada3</code></em> <em class="replaceable"><code>/dev/ada4</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada1    ONLINE       0     0     0
            ada2    ONLINE       0     0     0
          mirror-1  ONLINE       0     0     0
            ada3    ONLINE       0     0     0
            ada4    ONLINE       0     0     0

errors: No known data errors</pre><p>Pools can also be constructed using partitions rather than
	whole disks.  Putting <acronym class="acronym">ZFS</acronym> in a separate
	partition allows the same disk to have other partitions for
	other purposes.  In particular, partitions with bootcode and
	file systems needed for booting can be added.  This allows
	booting from disks that are also members of a pool.  There is
	no performance penalty on FreeBSD when using a partition rather
	than a whole disk.  Using partitions also allows the
	administrator to <span class="emphasis"><em>under-provision</em></span> the
	disks, using less than the full capacity.  If a future
	replacement disk of the same nominal size as the original
	actually has a slightly smaller capacity, the smaller
	partition will still fit, and the replacement disk can still
	be used.</p><p>Create a
	<a class="link" href="#zfs-term-vdev-raidz">RAID-Z2</a> pool using
	partitions:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create <em class="replaceable"><code>mypool</code></em> raidz2 <em class="replaceable"><code>/dev/ada0p3</code></em> <em class="replaceable"><code>/dev/ada1p3</code></em> <em class="replaceable"><code>/dev/ada2p3</code></em> <em class="replaceable"><code>/dev/ada3p3</code></em> <em class="replaceable"><code>/dev/ada4p3</code></em> <em class="replaceable"><code>/dev/ada5p3</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</pre><p>A pool that is no longer needed can be destroyed so that
	the disks can be reused.  Destroying a pool involves first
	unmounting all of the datasets in that pool.  If the datasets
	are in use, the unmount operation will fail and the pool will
	not be destroyed.  The destruction of the pool can be forced
	with <code class="option">-f</code>, but this can cause undefined
	behavior in applications which had open files on those
	datasets.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-attach"></a>19.3.2. Adding and Removing Devices</h3></div></div></div><p>There are two cases for adding disks to a zpool: attaching
	a disk to an existing vdev with
	<code class="command">zpool attach</code>, or adding vdevs to the pool
	with <code class="command">zpool add</code>.  Only some
	<a class="link" href="#zfs-term-vdev">vdev types</a> allow disks to
	be added to the vdev after creation.</p><p>A pool created with a single disk lacks redundancy.
	Corruption can be detected but
	not repaired, because there is no other copy of the data.

	The <a class="link" href="#zfs-term-copies">copies</a> property may
	be able to recover from a small failure such as a bad sector,
	but does not provide the same level of protection as mirroring
	or <acronym class="acronym">RAID-Z</acronym>.  Starting with a pool consisting
	of a single disk vdev, <code class="command">zpool attach</code> can be
	used to add an additional disk to the vdev, creating a mirror.
	<code class="command">zpool attach</code> can also be used to add
	additional disks to a mirror group, increasing redundancy and
	read performance.  If the disks being used for the pool are
	partitioned, replicate the layout of the first disk on to the
	second, <code class="command">gpart backup</code> and
	<code class="command">gpart restore</code> can be used to make this
	process easier.</p><p>Upgrade the single disk (stripe) vdev
	<em class="replaceable"><code>ada0p3</code></em> to a mirror by attaching
	<em class="replaceable"><code>ada1p3</code></em>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          ada0p3    ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool attach <em class="replaceable"><code>mypool</code></em> <em class="replaceable"><code>ada0p3</code></em> <em class="replaceable"><code>ada1p3</code></em></code></strong>
Make sure to wait until resilver is done before rebooting.

If you boot from pool 'mypool', you may need to update
boot code on newly attached disk 'ada1p3'.

Assuming you use GPT partitioning and 'da0' is your new boot disk
you may use the following command:

        gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <em class="replaceable"><code>ada1</code></em></code></strong>
bootcode written to ada1
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
status: One or more devices is currently being resilvered.  The pool will
        continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
  scan: resilver in progress since Fri May 30 08:19:19 2014
        527M scanned out of 781M at 47.9M/s, 0h0m to go
        527M resilvered, 67.53% done
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0  (resilvering)

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Fri May 30 08:15:58 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors</pre><p>When adding disks to the existing vdev is not an option,
	as for <acronym class="acronym">RAID-Z</acronym>, an alternative method is to
	add another vdev to the pool.  Additional vdevs provide higher
	performance, distributing writes across the vdevs.  Each vdev
	is responsible for providing its own redundancy.  It is
	possible, but discouraged, to mix vdev types, like
	<code class="literal">mirror</code> and <code class="literal">RAID-Z</code>.
	Adding a non-redundant vdev to a pool containing mirror or
	<acronym class="acronym">RAID-Z</acronym> vdevs risks the data on the entire
	pool.  Writes are distributed, so the failure of the
	non-redundant disk will result in the loss of a fraction of
	every block that has been written to the pool.</p><p>Data is striped across each of the vdevs.  For example,
	with two mirror vdevs, this is effectively a
	<acronym class="acronym">RAID</acronym> 10 that stripes writes across two sets
	of mirrors.  Space is allocated so that each vdev reaches 100%
	full at the same time.  There is a performance penalty if the
	vdevs have different amounts of free space, as a
	disproportionate amount of the data is written to the less
	full vdev.</p><p>When attaching additional devices to a boot pool, remember
	to update the bootcode.</p><p>Attach a second mirror group (<code class="filename">ada2p3</code>
	and <code class="filename">ada3p3</code>) to the existing
	mirror:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Fri May 30 08:19:35 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool add <em class="replaceable"><code>mypool</code></em> mirror <em class="replaceable"><code>ada2p3</code></em> <em class="replaceable"><code>ada3p3</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <em class="replaceable"><code>ada2</code></em></code></strong>
bootcode written to ada2
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <em class="replaceable"><code>ada3</code></em></code></strong>
bootcode written to ada3
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
          mirror-1  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0

errors: No known data errors</pre><p>Currently, vdevs cannot be removed from a pool, and disks
	can only be removed from a mirror if there is enough remaining
	redundancy.  If only one disk in a mirror group remains, it
	ceases to be a mirror and reverts to being a stripe, risking
	the entire pool if that remaining disk fails.</p><p>Remove a disk from a three-way mirror group:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool detach <em class="replaceable"><code>mypool</code></em> <em class="replaceable"><code>ada2p3</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 0h0m with 0 errors on Fri May 30 08:29:51 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-status"></a>19.3.3. Checking the Status of a Pool</h3></div></div></div><p>Pool status is important.  If a drive goes offline or a
	read, write, or checksum error is detected, the corresponding
	error count increases.  The <code class="command">status</code> output
	shows the configuration and status of each device in the pool
	and the status of the entire pool.  Actions that need to be
	taken and details about the last <a class="link" href="#zfs-zpool-scrub" title="19.3.7. Scrubbing a Pool"><code class="command">scrub</code></a>
	are also shown.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: scrub repaired 0 in 2h25m with 0 errors on Sat Sep 14 04:25:50 2013
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-clear"></a>19.3.4. Clearing Errors</h3></div></div></div><p>When an error is detected, the read, write, or checksum
	counts are incremented.  The error message can be cleared and
	the counts reset with <code class="command">zpool clear
	  <em class="replaceable"><code>mypool</code></em></code>.  Clearing the
	error state can be important for automated scripts that alert
	the administrator when the pool encounters an error.  Further
	errors may not be reported if the old errors are not
	cleared.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-replace"></a>19.3.5. Replacing a Functioning Device</h3></div></div></div><p>There are a number of situations where it may be
	desirable to replace one disk with a different disk.  When
	replacing a working disk, the process keeps the old disk
	online during the replacement.  The pool never enters a
	<a class="link" href="#zfs-term-degraded">degraded</a> state,
	reducing the risk of data loss.
	<code class="command">zpool replace</code> copies all of the data from
	the old disk to the new one.  After the operation completes,
	the old disk is disconnected from the vdev.  If the new disk
	is larger than the old disk, it may be possible to grow the
	zpool, using the new space.  See <a class="link" href="#zfs-zpool-online" title="19.3.9. Growing a Pool">Growing a Pool</a>.</p><p>Replace a functioning device in the pool:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool replace <em class="replaceable"><code>mypool</code></em> <em class="replaceable"><code>ada1p3</code></em> <em class="replaceable"><code>ada2p3</code></em></code></strong>
Make sure to wait until resilver is done before rebooting.

If you boot from pool 'zroot', you may need to update
boot code on newly attached disk 'ada2p3'.

Assuming you use GPT partitioning and 'da0' is your new boot disk
you may use the following command:

        gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0
<code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 <em class="replaceable"><code>ada2</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
status: One or more devices is currently being resilvered.  The pool will
        continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
  scan: resilver in progress since Mon Jun  2 14:21:35 2014
        604M scanned out of 781M at 46.5M/s, 0h0m to go
        604M resilvered, 77.39% done
config:

        NAME             STATE     READ WRITE CKSUM
        mypool           ONLINE       0     0     0
          mirror-0       ONLINE       0     0     0
            ada0p3       ONLINE       0     0     0
            replacing-1  ONLINE       0     0     0
              ada1p3     ONLINE       0     0     0
              ada2p3     ONLINE       0     0     0  (resilvering)

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Mon Jun  2 14:21:52 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-resilver"></a>19.3.6. Dealing with Failed Devices</h3></div></div></div><p>When a disk in a pool fails, the vdev to which the disk
	belongs enters the
	<a class="link" href="#zfs-term-degraded">degraded</a> state.  All
	of the data is still available, but performance may be reduced
	because missing data must be calculated from the available
	redundancy.  To restore the vdev to a fully functional state,
	the failed physical device must be replaced.
	<acronym class="acronym">ZFS</acronym> is then instructed to begin the
	<a class="link" href="#zfs-term-resilver">resilver</a> operation.
	Data that was on the failed device is recalculated from
	available redundancy and written to the replacement device.
	After completion, the vdev returns to
	<a class="link" href="#zfs-term-online">online</a> status.</p><p>If the vdev does not have any redundancy, or if multiple
	devices have failed and there is not enough redundancy to
	compensate, the pool enters the
	<a class="link" href="#zfs-term-faulted">faulted</a> state.  If a
	sufficient number of devices cannot be reconnected to the
	pool, the pool becomes inoperative and data must be restored
	from backups.</p><p>When replacing a failed disk, the name of the failed disk
	is replaced with the <acronym class="acronym">GUID</acronym> of the device.
	A new device name parameter for
	<code class="command">zpool replace</code> is not required if the
	replacement device has the same device name.</p><p>Replace a failed disk using
	<code class="command">zpool replace</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: DEGRADED
status: One or more devices could not be opened.  Sufficient replicas exist for
        the pool to continue functioning in a degraded state.
action: Attach the missing device and online it using 'zpool online'.
   see: http://illumos.org/msg/ZFS-8000-2Q
  scan: none requested
config:

        NAME                    STATE     READ WRITE CKSUM
        mypool                  DEGRADED     0     0     0
          mirror-0              DEGRADED     0     0     0
            ada0p3              ONLINE       0     0     0
            316502962686821739  UNAVAIL      0     0     0  was /dev/ada1p3

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool replace <em class="replaceable"><code>mypool</code></em> <em class="replaceable"><code>316502962686821739</code></em> <em class="replaceable"><code>ada2p3</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: DEGRADED
status: One or more devices is currently being resilvered.  The pool will
        continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
  scan: resilver in progress since Mon Jun  2 14:52:21 2014
        641M scanned out of 781M at 49.3M/s, 0h0m to go
        640M resilvered, 82.04% done
config:

        NAME                        STATE     READ WRITE CKSUM
        mypool                      DEGRADED     0     0     0
          mirror-0                  DEGRADED     0     0     0
            ada0p3                  ONLINE       0     0     0
            replacing-1             UNAVAIL      0     0     0
              15732067398082357289  UNAVAIL      0     0     0  was /dev/ada1p3/old
              ada2p3                ONLINE       0     0     0  (resilvering)

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: resilvered 781M in 0h0m with 0 errors on Mon Jun  2 14:52:38 2014
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0

errors: No known data errors</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-scrub"></a>19.3.7. Scrubbing a Pool</h3></div></div></div><p>It is recommended that pools be
	<a class="link" href="#zfs-term-scrub">scrubbed</a> regularly,
	ideally at least once every month.  The
	<code class="command">scrub</code> operation is very disk-intensive and
	will reduce performance while running.  Avoid high-demand
	periods when scheduling <code class="command">scrub</code> or use <a class="link" href="#zfs-advanced-tuning-scrub_delay"><code class="varname">vfs.zfs.scrub_delay</code></a>
	to adjust the relative priority of the
	<code class="command">scrub</code> to prevent it interfering with other
	workloads.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool scrub <em class="replaceable"><code>mypool</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
  scan: scrub in progress since Wed Feb 19 20:52:54 2014
        116G scanned out of 8.60T at 649M/s, 3h48m to go
        0 repaired, 1.32% done
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          raidz2-0  ONLINE       0     0     0
            ada0p3  ONLINE       0     0     0
            ada1p3  ONLINE       0     0     0
            ada2p3  ONLINE       0     0     0
            ada3p3  ONLINE       0     0     0
            ada4p3  ONLINE       0     0     0
            ada5p3  ONLINE       0     0     0

errors: No known data errors</pre><p>In the event that a scrub operation needs to be cancelled,
	issue <code class="command">zpool scrub -s
	  <em class="replaceable"><code>mypool</code></em></code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-selfheal"></a>19.3.8. Self-Healing</h3></div></div></div><p>The checksums stored with data blocks enable the file
	system to <span class="emphasis"><em>self-heal</em></span>.  This feature will
	automatically repair data whose checksum does not match the
	one recorded on another device that is part of the storage
	pool.  For example, a mirror with two disks where one drive is
	starting to malfunction and cannot properly store the data any
	more.  This is even worse when the data has not been accessed
	for a long time, as with long term archive storage.
	Traditional file systems need to run algorithms that check and
	repair the data like <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>.  These commands take time,
	and in severe cases, an administrator has to manually decide
	which repair operation must be performed.  When
	<acronym class="acronym">ZFS</acronym> detects a data block with a checksum
	that does not match, it tries to read the data from the mirror
	disk.  If that disk can provide the correct data, it will not
	only give that data to the application requesting it, but also
	correct the wrong data on the disk that had the bad checksum.
	This happens without any interaction from a system
	administrator during normal pool operation.</p><p>The next example demonstrates this self-healing behavior.
	A mirrored pool of disks <code class="filename">/dev/ada0</code> and
	<code class="filename">/dev/ada1</code> is created.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create <em class="replaceable"><code>healer</code></em> mirror <em class="replaceable"><code>/dev/ada0</code></em> <em class="replaceable"><code>/dev/ada1</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status <em class="replaceable"><code>healer</code></em></code></strong>
  pool: healer
 state: ONLINE
  scan: none requested
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME     SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
healer   960M  92.5K   960M         -         -     0%    0%  1.00x  ONLINE  -</pre><p>Some important data that to be protected from data errors
	using the self-healing feature is copied to the pool.  A
	checksum of the pool is created for later comparison.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /some/important/data /healer</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME     SIZE  ALLOC   FREE    CAP  DEDUP  HEALTH  ALTROOT
healer   960M  67.7M   892M     7%  1.00x  ONLINE  -
<code class="prompt">#</code> <strong class="userinput"><code>sha1 /healer &gt; checksum.txt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cat checksum.txt</code></strong>
SHA1 (/healer) = 2753eff56d77d9a536ece6694bf0a82740344d1f</pre><p>Data corruption is simulated by writing random data to the
	beginning of one of the disks in the mirror.  To prevent
	<acronym class="acronym">ZFS</acronym> from healing the data as soon as it is
	detected, the pool is exported before the corruption and
	imported again afterwards.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">This is a dangerous operation that can destroy vital
	  data.  It is shown here for demonstrational purposes only
	  and should not be attempted during normal operation of a
	  storage pool.  Nor should this intentional corruption
	  example be run on any disk with a different file system on
	  it.  Do not use any other disk device names other than the
	  ones that are part of the pool.  Make certain that proper
	  backups of the pool are created before running the
	  command!</p></div><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool export <em class="replaceable"><code>healer</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/dev/ada1 bs=1m count=200</code></strong>
200+0 records in
200+0 records out
209715200 bytes transferred in 62.992162 secs (3329227 bytes/sec)
<code class="prompt">#</code> <strong class="userinput"><code>zpool import healer</code></strong></pre><p>The pool status shows that one device has experienced an
	error.  Note that applications reading data from the pool did
	not receive any incorrect data.  <acronym class="acronym">ZFS</acronym>
	provided data from the <code class="filename">ada0</code> device with
	the correct checksums.  The device with the wrong checksum can
	be found easily as the <code class="literal">CKSUM</code> column
	contains a nonzero value.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status <em class="replaceable"><code>healer</code></em></code></strong>
    pool: healer
   state: ONLINE
  status: One or more devices has experienced an unrecoverable error.  An
          attempt was made to correct the error.  Applications are unaffected.
  action: Determine if the device needs to be replaced, and clear the errors
          using 'zpool clear' or replace the device with 'zpool replace'.
     see: http://illumos.org/msg/ZFS-8000-4J
    scan: none requested
  config:

      NAME        STATE     READ WRITE CKSUM
      healer      ONLINE       0     0     0
        mirror-0  ONLINE       0     0     0
         ada0     ONLINE       0     0     0
         ada1     ONLINE       0     0     1

errors: No known data errors</pre><p>The error was detected and handled by using the redundancy
	present in the unaffected <code class="filename">ada0</code> mirror
	disk.  A checksum comparison with the original one will reveal
	whether the pool is consistent again.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sha1 /healer &gt;&gt; checksum.txt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cat checksum.txt</code></strong>
SHA1 (/healer) = 2753eff56d77d9a536ece6694bf0a82740344d1f
SHA1 (/healer) = 2753eff56d77d9a536ece6694bf0a82740344d1f</pre><p>The two checksums that were generated before and after the
	intentional tampering with the pool data still match.  This
	shows how <acronym class="acronym">ZFS</acronym> is capable of detecting and
	correcting any errors automatically when the checksums differ.
	Note that this is only possible when there is enough
	redundancy present in the pool.  A pool consisting of a single
	device has no self-healing capabilities.  That is also the
	reason why checksums are so important in
	<acronym class="acronym">ZFS</acronym> and should not be disabled for any
	reason.  No <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> or similar file system consistency
	check program is required to detect and correct this and the
	pool was still available during the time there was a problem.
	A scrub operation is now required to overwrite the corrupted
	data on <code class="filename">ada1</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool scrub <em class="replaceable"><code>healer</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status <em class="replaceable"><code>healer</code></em></code></strong>
  pool: healer
 state: ONLINE
status: One or more devices has experienced an unrecoverable error.  An
            attempt was made to correct the error.  Applications are unaffected.
action: Determine if the device needs to be replaced, and clear the errors
            using 'zpool clear' or replace the device with 'zpool replace'.
   see: http://illumos.org/msg/ZFS-8000-4J
  scan: scrub in progress since Mon Dec 10 12:23:30 2012
        10.4M scanned out of 67.0M at 267K/s, 0h3m to go
        9.63M repaired, 15.56% done
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0   627  (repairing)

errors: No known data errors</pre><p>The scrub operation reads data from
	<code class="filename">ada0</code> and rewrites any data with an
	incorrect checksum on <code class="filename">ada1</code>.  This is
	indicated by the <code class="literal">(repairing)</code> output from
	<code class="command">zpool status</code>.  After the operation is
	complete, the pool status changes to:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status <em class="replaceable"><code>healer</code></em></code></strong>
  pool: healer
 state: ONLINE
status: One or more devices has experienced an unrecoverable error.  An
        attempt was made to correct the error.  Applications are unaffected.
action: Determine if the device needs to be replaced, and clear the errors
             using 'zpool clear' or replace the device with 'zpool replace'.
   see: http://illumos.org/msg/ZFS-8000-4J
  scan: scrub repaired 66.5M in 0h2m with 0 errors on Mon Dec 10 12:26:25 2012
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0 2.72K

errors: No known data errors</pre><p>After the scrub operation completes and all the data
	has been synchronized from <code class="filename">ada0</code> to
	<code class="filename">ada1</code>, the error messages can be
	<a class="link" href="#zfs-zpool-clear" title="19.3.4. Clearing Errors">cleared</a> from the pool
	status by running <code class="command">zpool clear</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool clear <em class="replaceable"><code>healer</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool status <em class="replaceable"><code>healer</code></em></code></strong>
  pool: healer
 state: ONLINE
  scan: scrub repaired 66.5M in 0h2m with 0 errors on Mon Dec 10 12:26:25 2012
config:

    NAME        STATE     READ WRITE CKSUM
    healer      ONLINE       0     0     0
      mirror-0  ONLINE       0     0     0
       ada0     ONLINE       0     0     0
       ada1     ONLINE       0     0     0

errors: No known data errors</pre><p>The pool is now back to a fully working state and all the
	errors have been cleared.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-online"></a>19.3.9. Growing a Pool</h3></div></div></div><p>The usable size of a redundant pool is limited by the
	capacity of the smallest device in each vdev.  The smallest
	device can be replaced with a larger device.  After completing
	a <a class="link" href="#zfs-zpool-replace" title="19.3.5. Replacing a Functioning Device">replace</a> or
	<a class="link" href="#zfs-term-resilver">resilver</a> operation,
	the pool can grow to use the capacity of the new device.  For
	example, consider a mirror of a 1 TB drive and a
	2 TB drive.  The usable space is 1 TB.  When the
	1 TB drive is replaced with another 2 TB drive, the
	resilvering process copies the existing data onto the new
	drive.  Because
	both of the devices now have 2 TB capacity, the mirror's
	available space can be grown to 2 TB.</p><p>Expansion is triggered by using
	<code class="command">zpool online -e</code> on each device.  After
	expansion of all devices, the additional space becomes
	available to the pool.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-import"></a>19.3.10. Importing and Exporting Pools</h3></div></div></div><p>Pools are <span class="emphasis"><em>exported</em></span> before moving them
	to another system.  All datasets are unmounted, and each
	device is marked as exported but still locked so it cannot be
	used by other disk subsystems.  This allows pools to be
	<span class="emphasis"><em>imported</em></span> on other machines, other
	operating systems that support <acronym class="acronym">ZFS</acronym>, and
	even different hardware architectures (with some caveats, see
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a>).  When a dataset has open files,
	<code class="command">zpool export -f</code> can be used to force the
	export of a pool.  Use this with caution.  The datasets are
	forcibly unmounted, potentially resulting in unexpected
	behavior by the applications which had open files on those
	datasets.</p><p>Export a pool that is not in use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool export mypool</code></strong></pre><p>Importing a pool automatically mounts the datasets.  This
	may not be the desired behavior, and can be prevented with
	<code class="command">zpool import -N</code>.
	<code class="command">zpool import -o</code> sets temporary properties
	for this import only.
	<code class="command">zpool import altroot=</code> allows importing a
	pool with a base mount point instead of the root of the file
	system.  If the pool was last used on a different system and
	was not properly exported, an import might have to be forced
	with <code class="command">zpool import -f</code>.
	<code class="command">zpool import -a</code> imports all pools that do
	not appear to be in use by another system.</p><p>List all available pools for import:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool import</code></strong>
   pool: mypool
     id: 9930174748043525076
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

        mypool      ONLINE
          ada2p3    ONLINE</pre><p>Import the pool with an alternative root directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool import -o altroot=<em class="replaceable"><code>/mnt</code></em> <em class="replaceable"><code>mypool</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
zfs list
NAME                 USED  AVAIL  REFER  MOUNTPOINT
mypool               110K  47.0G    31K  /mnt/mypool</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-upgrade"></a>19.3.11. Upgrading a Storage Pool</h3></div></div></div><p>After upgrading FreeBSD, or if a pool has been imported from
	a system using an older version of <acronym class="acronym">ZFS</acronym>, the
	pool can be manually upgraded to the latest version of
	<acronym class="acronym">ZFS</acronym> to support newer features.  Consider
	whether the pool may ever need to be imported on an older
	system before upgrading.  Upgrading is a one-way process.
	Older pools can be upgraded, but pools with newer features
	cannot be downgraded.</p><p>Upgrade a v28 pool to support
	<code class="literal">Feature Flags</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
status: The pool is formatted using a legacy on-disk format.  The pool can
        still be used, but some features are unavailable.
action: Upgrade the pool using 'zpool upgrade'.  Once this is done, the
        pool will no longer be accessible on software that does not support feat
        flags.
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
	    ada0    ONLINE       0     0     0
	    ada1    ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool upgrade</code></strong>
This system supports ZFS pool feature flags.

The following pools are formatted with legacy version numbers and can
be upgraded to use feature flags.  After being upgraded, these pools
will no longer be accessible by software that does not support feature
flags.

VER  POOL
---  ------------
28   mypool

Use 'zpool upgrade -v' for a list of available legacy versions.
Every feature flags pool has all supported features enabled.
<code class="prompt">#</code> <strong class="userinput"><code>zpool upgrade mypool</code></strong>
This system supports ZFS pool feature flags.

Successfully upgraded 'mypool' from version 28 to feature flags.
Enabled the following features on 'mypool':
  async_destroy
  empty_bpobj
  lz4_compress
  multi_vdev_crash_dump</pre><p>The newer features of <acronym class="acronym">ZFS</acronym> will not be
	available until <code class="command">zpool upgrade</code> has
	completed.  <code class="command">zpool upgrade -v</code> can be used to
	see what new features will be provided by upgrading, as well
	as which features are already supported.</p><p>Upgrade a pool to support additional feature flags:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status</code></strong>
  pool: mypool
 state: ONLINE
status: Some supported features are not enabled on the pool. The pool can
        still be used, but some features are unavailable.
action: Enable all features using 'zpool upgrade'. Once this is done,
        the pool may no longer be accessible by software that does not support
        the features. See zpool-features(7) for details.
  scan: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        mypool      ONLINE       0     0     0
          mirror-0  ONLINE       0     0     0
	    ada0    ONLINE       0     0     0
	    ada1    ONLINE       0     0     0

errors: No known data errors
<code class="prompt">#</code> <strong class="userinput"><code>zpool upgrade</code></strong>
This system supports ZFS pool feature flags.

All pools are formatted using feature flags.


Some supported features are not enabled on the following pools. Once a
feature is enabled the pool may become incompatible with software
that does not support the feature. See zpool-features(7) for details.

POOL  FEATURE
---------------
zstore
      multi_vdev_crash_dump
      spacemap_histogram
      enabled_txg
      hole_birth
      extensible_dataset
      bookmarks
      filesystem_limits
<code class="prompt">#</code> <strong class="userinput"><code>zpool upgrade mypool</code></strong>
This system supports ZFS pool feature flags.

Enabled the following features on 'mypool':
  spacemap_histogram
  enabled_txg
  hole_birth
  extensible_dataset
  bookmarks
  filesystem_limits</pre><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">The boot code on systems that boot from a pool must be
	  updated to support the new pool version.  Use
	  <code class="command">gpart bootcode</code> on the partition that
	  contains the boot code.  There are two types of bootcode
	  available, depending on way the system boots:
	  <acronym class="acronym">GPT</acronym> (the most common option) and
	  <acronym class="acronym">EFI</acronym> (for more modern systems).</p><p xmlns="http://www.w3.org/1999/xhtml">For legacy boot using GPT, use the following
	  command:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i <em class="replaceable"><code>1</code></em> <em class="replaceable"><code>ada1</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">For systems using EFI to boot, execute the following
	  command:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gpart bootcode -p /boot/boot1.efifat -i <em class="replaceable"><code>1</code></em> <em class="replaceable"><code>ada1</code></em></code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Apply the bootcode to all bootable disks in the pool.
	  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gpart</span>(8)</span></a> for more information.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-history"></a>19.3.12. Displaying Recorded Pool History</h3></div></div></div><p>Commands that modify the pool are recorded.  Recorded
	actions include the creation of datasets, changing properties,
	or replacement of a disk.  This history is useful for
	reviewing how a pool was created and which user performed a
	specific action and when.  History is not kept in a log file,
	but is part of the pool itself.  The command to review this
	history is aptly named
	<code class="command">zpool history</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool history</code></strong>
History for 'tank':
2013-02-26.23:02:35 zpool create tank mirror /dev/ada0 /dev/ada1
2013-02-27.18:50:58 zfs set atime=off tank
2013-02-27.18:51:09 zfs set checksum=fletcher4 tank
2013-02-27.18:51:18 zfs create tank/backup</pre><p>The output shows <code class="command">zpool</code> and
	<code class="command">zfs</code> commands that were executed on the pool
	along with a timestamp.  Only commands that alter the pool in
	some way are recorded.  Commands like
	<code class="command">zfs list</code> are not included.  When no pool
	name is specified, the history of all pools is
	displayed.</p><p><code class="command">zpool history</code> can show even more
	information when the options <code class="option">-i</code> or
	<code class="option">-l</code> are provided.  <code class="option">-i</code>
	displays user-initiated events as well as internally logged
	<acronym class="acronym">ZFS</acronym> events.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool history -i</code></strong>
History for 'tank':
2013-02-26.23:02:35 [internal pool create txg:5] pool spa 28; zfs spa 28; zpl 5;uts  9.1-RELEASE 901000 amd64
2013-02-27.18:50:53 [internal property set txg:50] atime=0 dataset = 21
2013-02-27.18:50:58 zfs set atime=off tank
2013-02-27.18:51:04 [internal property set txg:53] checksum=7 dataset = 21
2013-02-27.18:51:09 zfs set checksum=fletcher4 tank
2013-02-27.18:51:13 [internal create txg:55] dataset = 39
2013-02-27.18:51:18 zfs create tank/backup</pre><p>More details can be shown by adding <code class="option">-l</code>.
	History records are shown in a long format, including
	information like the name of the user who issued the command
	and the hostname on which the change was made.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool history -l</code></strong>
History for 'tank':
2013-02-26.23:02:35 zpool create tank mirror /dev/ada0 /dev/ada1 [user 0 (root) on :global]
2013-02-27.18:50:58 zfs set atime=off tank [user 0 (root) on myzfsbox:global]
2013-02-27.18:51:09 zfs set checksum=fletcher4 tank [user 0 (root) on myzfsbox:global]
2013-02-27.18:51:18 zfs create tank/backup [user 0 (root) on myzfsbox:global]</pre><p>The output shows that the
	<code class="systemitem">root</code> user created
	the mirrored pool with disks
	<code class="filename">/dev/ada0</code> and
	<code class="filename">/dev/ada1</code>.  The hostname
	<code class="systemitem">myzfsbox</code> is also
	shown in the commands after the pool's creation.  The hostname
	display becomes important when the pool is exported from one
	system and imported on another.  The commands that are issued
	on the other system can clearly be distinguished by the
	hostname that is recorded for each command.</p><p>Both options to <code class="command">zpool history</code> can be
	combined to give the most detailed information possible for
	any given pool.  Pool history provides valuable information
	when tracking down the actions that were performed or when
	more detailed output is needed for debugging.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-iostat"></a>19.3.13. Performance Monitoring</h3></div></div></div><p>A built-in monitoring system can display pool
	<acronym class="acronym">I/O</acronym> statistics in real time.  It shows the
	amount of free and used space on the pool, how many read and
	write operations are being performed per second, and how much
	<acronym class="acronym">I/O</acronym> bandwidth is currently being utilized.
	By default, all pools in the system are monitored and
	displayed.  A pool name can be provided to limit monitoring to
	just that pool.  A basic example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool iostat</code></strong>
               capacity     operations    bandwidth
pool        alloc   free   read  write   read  write
----------  -----  -----  -----  -----  -----  -----
data         288G  1.53T      2     11  11.3K  57.1K</pre><p>To continuously monitor <acronym class="acronym">I/O</acronym> activity, a
	number can be specified as the last parameter, indicating a
	interval in seconds to wait between updates.  The next
	statistic line is printed after each interval.  Press
	<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> to stop this continuous monitoring.
	Alternatively, give a second number on the command line after
	the interval to specify the total number of statistics to
	display.</p><p>Even more detailed <acronym class="acronym">I/O</acronym> statistics can
	be displayed with <code class="option">-v</code>.  Each device in the
	pool is shown with a statistics line.  This is useful in
	seeing how many read and write operations are being performed
	on each device, and can help determine if any individual
	device is slowing down the pool.  This example shows a
	mirrored pool with two devices:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool iostat -v </code></strong>
                            capacity     operations    bandwidth
pool                     alloc   free   read  write   read  write
-----------------------  -----  -----  -----  -----  -----  -----
data                      288G  1.53T      2     12  9.23K  61.5K
  mirror                  288G  1.53T      2     12  9.23K  61.5K
    ada1                     -      -      0      4  5.61K  61.7K
    ada2                     -      -      1      4  5.04K  61.7K
-----------------------  -----  -----  -----  -----  -----  -----</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zpool-split"></a>19.3.14. Splitting a Storage Pool</h3></div></div></div><p>A pool consisting of one or more mirror vdevs can be split
	into two pools.  Unless otherwise specified, the last member
	of each mirror is detached and used to create a new pool
	containing the same data.  The operation should first be
	attempted with <code class="option">-n</code>.  The details of the
	proposed operation are displayed without it actually being
	performed.  This helps confirm that the operation will do what
	the user intends.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-zfs"></a>19.4. <code class="command">zfs</code> Administration</h2></div></div></div><p>The <code class="command">zfs</code> utility is responsible for
      creating, destroying, and managing all <acronym class="acronym">ZFS</acronym>
      datasets that exist within a pool.  The pool is managed using
      <a class="link" href="#zfs-zpool" title="19.3. zpool Administration"><code class="command">zpool</code></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-create"></a>19.4.1. Creating and Destroying Datasets</h3></div></div></div><p>Unlike traditional disks and volume managers, space in
	<acronym class="acronym">ZFS</acronym> is <span class="emphasis"><em>not</em></span>
	preallocated.  With traditional file systems, after all of the
	space is partitioned and assigned, there is no way to add an
	additional file system without adding a new disk.  With
	<acronym class="acronym">ZFS</acronym>, new file systems can be created at any
	time.  Each <a class="link" href="#zfs-term-dataset"><span class="emphasis"><em>dataset</em></span></a>
	has properties including features like compression,
	deduplication, caching, and quotas, as well as other useful
	properties like readonly, case sensitivity, network file
	sharing, and a mount point.  Datasets can be nested inside
	each other, and child datasets will inherit properties from
	their parents.  Each dataset can be administered,
	<a class="link" href="#zfs-zfs-allow" title="19.5. Delegated Administration">delegated</a>,
	<a class="link" href="#zfs-zfs-send" title="19.4.7. Replication">replicated</a>,
	<a class="link" href="#zfs-zfs-snapshot" title="19.4.5. Managing Snapshots">snapshotted</a>,
	<a class="link" href="#zfs-zfs-jail" title="19.4.12. ZFS and Jails">jailed</a>, and destroyed as a
	unit.  There are many advantages to creating a separate
	dataset for each different type or set of files.  The only
	drawbacks to having an extremely large number of datasets is
	that some commands like <code class="command">zfs list</code> will be
	slower, and the mounting of hundreds or even thousands of
	datasets can slow the FreeBSD boot process.</p><p>Create a new dataset and enable <a class="link" href="#zfs-term-compression-lz4">LZ4
	  compression</a> on it:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                781M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.20M  93.2G   608K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/tmp        152K  93.2G   152K  /var/tmp
<code class="prompt">#</code> <strong class="userinput"><code>zfs create -o compress=lz4 <em class="replaceable"><code>mypool/usr/mydataset</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 781M  93.2G   144K  none
mypool/ROOT            777M  93.2G   144K  none
mypool/ROOT/default    777M  93.2G   777M  /
mypool/tmp             176K  93.2G   176K  /tmp
mypool/usr             704K  93.2G   144K  /usr
mypool/usr/home        184K  93.2G   184K  /usr/home
mypool/usr/mydataset  87.5K  93.2G  87.5K  /usr/mydataset
mypool/usr/ports       144K  93.2G   144K  /usr/ports
mypool/usr/src         144K  93.2G   144K  /usr/src
mypool/var            1.20M  93.2G   610K  /var
mypool/var/crash       148K  93.2G   148K  /var/crash
mypool/var/log         178K  93.2G   178K  /var/log
mypool/var/mail        144K  93.2G   144K  /var/mail
mypool/var/tmp         152K  93.2G   152K  /var/tmp</pre><p>Destroying a dataset is much quicker than deleting all
	of the files that reside on the dataset, as it does not
	involve scanning all of the files and updating all of the
	corresponding metadata.</p><p>Destroy the previously-created dataset:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 880M  93.1G   144K  none
mypool/ROOT            777M  93.1G   144K  none
mypool/ROOT/default    777M  93.1G   777M  /
mypool/tmp             176K  93.1G   176K  /tmp
mypool/usr             101M  93.1G   144K  /usr
mypool/usr/home        184K  93.1G   184K  /usr/home
mypool/usr/mydataset   100M  93.1G   100M  /usr/mydataset
mypool/usr/ports       144K  93.1G   144K  /usr/ports
mypool/usr/src         144K  93.1G   144K  /usr/src
mypool/var            1.20M  93.1G   610K  /var
mypool/var/crash       148K  93.1G   148K  /var/crash
mypool/var/log         178K  93.1G   178K  /var/log
mypool/var/mail        144K  93.1G   144K  /var/mail
mypool/var/tmp         152K  93.1G   152K  /var/tmp
<code class="prompt">#</code> <strong class="userinput"><code>zfs destroy <em class="replaceable"><code>mypool/usr/mydataset</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                781M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.21M  93.2G   612K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/tmp        152K  93.2G   152K  /var/tmp</pre><p>In modern versions of <acronym class="acronym">ZFS</acronym>,
	<code class="command">zfs destroy</code> is asynchronous, and the free
	space might take several minutes to appear in the pool.  Use
	<code class="command">zpool get freeing
	  <em class="replaceable"><code>poolname</code></em></code> to see the
	<code class="literal">freeing</code> property, indicating how many
	datasets are having their blocks freed in the background.
	If there are child datasets, like
	<a class="link" href="#zfs-term-snapshot">snapshots</a> or other
	datasets, then the parent cannot be destroyed.  To destroy a
	dataset and all of its children, use <code class="option">-r</code> to
	recursively destroy the dataset and all of its children.
	Use <code class="option">-n</code> <code class="option">-v</code> to list datasets
	and snapshots that would be destroyed by this operation, but
	do not actually destroy anything.  Space that would be
	reclaimed by destruction of snapshots is also shown.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-volume"></a>19.4.2. Creating and Destroying Volumes</h3></div></div></div><p>A volume is a special type of dataset.  Rather than being
	mounted as a file system, it is exposed as a block device
	under
	<code class="filename">/dev/zvol/<em class="replaceable"><code>poolname</code></em>/<em class="replaceable"><code>dataset</code></em></code>.
	This allows the volume to be used for other file systems, to
	back the disks of a virtual machine, or to be exported using
	protocols like <acronym class="acronym">iSCSI</acronym> or
	<acronym class="acronym">HAST</acronym>.</p><p>A volume can be formatted with any file system, or used
	without a file system to store raw data.  To the user, a
	volume appears to be a regular disk.  Putting ordinary file
	systems on these <span class="emphasis"><em>zvols</em></span> provides features
	that ordinary disks or file systems do not normally have.  For
	example, using the compression property on a 250 MB
	volume allows creation of a compressed <acronym class="acronym">FAT</acronym>
	file system.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create -V 250m -o compression=on tank/fat32</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list tank</code></strong>
NAME USED AVAIL REFER MOUNTPOINT
tank 258M  670M   31K /tank
<code class="prompt">#</code> <strong class="userinput"><code>newfs_msdos -F32 /dev/zvol/tank/fat32</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t msdosfs /dev/zvol/tank/fat32 /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df -h /mnt | grep fat32</code></strong>
Filesystem           Size Used Avail Capacity Mounted on
/dev/zvol/tank/fat32 249M  24k  249M     0%   /mnt
<code class="prompt">#</code> <strong class="userinput"><code>mount | grep fat32</code></strong>
/dev/zvol/tank/fat32 on /mnt (msdosfs, local)</pre><p>Destroying a volume is much the same as destroying a
	regular file system dataset.  The operation is nearly
	instantaneous, but it may take several minutes for the free
	space to be reclaimed in the background.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-rename"></a>19.4.3. Renaming a Dataset</h3></div></div></div><p>The name of a dataset can be changed with
	<code class="command">zfs rename</code>.  The parent of a dataset can
	also be changed with this command.  Renaming a dataset to be
	under a different parent dataset will change the value of
	those properties that are inherited from the parent dataset.
	When a dataset is renamed, it is unmounted and then remounted
	in the new location (which is inherited from the new parent
	dataset).  This behavior can be prevented with
	<code class="option">-u</code>.</p><p>Rename a dataset and move it to be under a different
	parent dataset:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                   USED  AVAIL  REFER  MOUNTPOINT
mypool                 780M  93.2G   144K  none
mypool/ROOT            777M  93.2G   144K  none
mypool/ROOT/default    777M  93.2G   777M  /
mypool/tmp             176K  93.2G   176K  /tmp
mypool/usr             704K  93.2G   144K  /usr
mypool/usr/home        184K  93.2G   184K  /usr/home
mypool/usr/mydataset  87.5K  93.2G  87.5K  /usr/mydataset
mypool/usr/ports       144K  93.2G   144K  /usr/ports
mypool/usr/src         144K  93.2G   144K  /usr/src
mypool/var            1.21M  93.2G   614K  /var
mypool/var/crash       148K  93.2G   148K  /var/crash
mypool/var/log         178K  93.2G   178K  /var/log
mypool/var/mail        144K  93.2G   144K  /var/mail
mypool/var/tmp         152K  93.2G   152K  /var/tmp
<code class="prompt">#</code> <strong class="userinput"><code>zfs rename <em class="replaceable"><code>mypool/usr/mydataset</code></em> <em class="replaceable"><code>mypool/var/newname</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                  USED  AVAIL  REFER  MOUNTPOINT
mypool                780M  93.2G   144K  none
mypool/ROOT           777M  93.2G   144K  none
mypool/ROOT/default   777M  93.2G   777M  /
mypool/tmp            176K  93.2G   176K  /tmp
mypool/usr            616K  93.2G   144K  /usr
mypool/usr/home       184K  93.2G   184K  /usr/home
mypool/usr/ports      144K  93.2G   144K  /usr/ports
mypool/usr/src        144K  93.2G   144K  /usr/src
mypool/var           1.29M  93.2G   614K  /var
mypool/var/crash      148K  93.2G   148K  /var/crash
mypool/var/log        178K  93.2G   178K  /var/log
mypool/var/mail       144K  93.2G   144K  /var/mail
mypool/var/newname   87.5K  93.2G  87.5K  /var/newname
mypool/var/tmp        152K  93.2G   152K  /var/tmp</pre><p>Snapshots can also be renamed like this.  Due to the
	nature of snapshots, they cannot be renamed into a different
	parent dataset.  To rename a recursive snapshot, specify
	<code class="option">-r</code>, and all snapshots with the same name in
	child datasets with also be renamed.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                                USED  AVAIL  REFER  MOUNTPOINT
mypool/var/newname@first_snapshot      0      -  87.5K  -
<code class="prompt">#</code> <strong class="userinput"><code>zfs rename <em class="replaceable"><code>mypool/var/newname@first_snapshot</code></em> <em class="replaceable"><code>new_snapshot_name</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/newname@new_snapshot_name      0      -  87.5K  -</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-set"></a>19.4.4. Setting Dataset Properties</h3></div></div></div><p>Each <acronym class="acronym">ZFS</acronym> dataset has a number of
	properties that control its behavior.  Most properties are
	automatically inherited from the parent dataset, but can be
	overridden locally.  Set a property on a dataset with
	<code class="command">zfs set
	  <em class="replaceable"><code>property</code></em>=<em class="replaceable"><code>value</code></em>
	  <em class="replaceable"><code>dataset</code></em></code>.  Most
	properties have a limited set of valid values,
	<code class="command">zfs get</code> will display each possible property
	and valid values.  Most properties can be reverted to their
	inherited values using <code class="command">zfs inherit</code>.</p><p>User-defined properties can also be set.  They become part
	of the dataset configuration and can be used to provide
	additional information about the dataset or its contents.  To
	distinguish these custom properties from the ones supplied as
	part of <acronym class="acronym">ZFS</acronym>, a colon (<code class="literal">:</code>)
	is used to create a custom namespace for the property.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set <em class="replaceable"><code>custom</code></em>:<em class="replaceable"><code>costcenter</code></em>=<em class="replaceable"><code>1234</code></em> <em class="replaceable"><code>tank</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs get <em class="replaceable"><code>custom</code></em>:<em class="replaceable"><code>costcenter</code></em> <em class="replaceable"><code>tank</code></em></code></strong>
NAME PROPERTY           VALUE SOURCE
tank custom:costcenter  1234  local</pre><p>To remove a custom property, use
	<code class="command">zfs inherit</code> with <code class="option">-r</code>.  If
	the custom property is not defined in any of the parent
	datasets, it will be removed completely (although the changes
	are still recorded in the pool's history).</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs inherit -r <em class="replaceable"><code>custom</code></em>:<em class="replaceable"><code>costcenter</code></em> <em class="replaceable"><code>tank</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs get <em class="replaceable"><code>custom</code></em>:<em class="replaceable"><code>costcenter</code></em> <em class="replaceable"><code>tank</code></em></code></strong>
NAME    PROPERTY           VALUE              SOURCE
tank    custom:costcenter  -                  -
<code class="prompt">#</code> <strong class="userinput"><code>zfs get all <em class="replaceable"><code>tank</code></em> | grep <em class="replaceable"><code>custom</code></em>:<em class="replaceable"><code>costcenter</code></em></code></strong>
<code class="prompt">#</code></pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-set-share"></a>19.4.4.1. Getting and Setting Share Properties</h4></div></div></div><p>Two commonly used and useful dataset properties are the
	<acronym class="acronym">NFS</acronym> and <acronym class="acronym">SMB</acronym> share
	options.  Setting these define if and how
	<acronym class="acronym">ZFS</acronym> datasets may be shared on the network.
	At present, only setting sharing via <acronym class="acronym">NFS</acronym> is
	supported on FreeBSD.  To get the current status of
	a share, enter:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs get sharenfs <em class="replaceable"><code>mypool/usr/home</code></em></code></strong>
NAME             PROPERTY  VALUE    SOURCE
mypool/usr/home  sharenfs  on       local
<code class="prompt">#</code> <strong class="userinput"><code>zfs get sharesmb <em class="replaceable"><code>mypool/usr/home</code></em></code></strong>
NAME             PROPERTY  VALUE    SOURCE
mypool/usr/home  sharesmb  off      local</pre><p>To enable sharing of a dataset, enter:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code> zfs set sharenfs=on <em class="replaceable"><code>mypool/usr/home</code></em></code></strong></pre><p>It is also possible to set additional options for sharing
      datasets through <acronym class="acronym">NFS</acronym>, such as
      <code class="option">-alldirs</code>, <code class="option">-maproot</code> and
      <code class="option">-network</code>.  To set additional options to a
      dataset shared through NFS, enter:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code> zfs set sharenfs="-alldirs,-maproot=<em class="replaceable"><code>root</code></em>,-network=<em class="replaceable"><code>192.168.1.0/24</code></em>" <em class="replaceable"><code>mypool/usr/home</code></em></code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-snapshot"></a>19.4.5. Managing Snapshots</h3></div></div></div><p><a class="link" href="#zfs-term-snapshot">Snapshots</a> are one
	of the most powerful features of <acronym class="acronym">ZFS</acronym>.  A
	snapshot provides a read-only, point-in-time copy of the
	dataset.  With Copy-On-Write (<acronym class="acronym">COW</acronym>),
	snapshots can be created quickly by preserving the older
	version of the data on disk.  If no snapshots exist, space is
	reclaimed for future use when data is rewritten or deleted.
	Snapshots preserve disk space by recording only the
	differences between the current dataset and a previous
	version.  Snapshots are allowed only on whole datasets, not on
	individual files or directories.  When a snapshot is created
	from a dataset, everything contained in it is duplicated.
	This includes the file system properties, files, directories,
	permissions, and so on.  Snapshots use no additional space
	when they are first created, only consuming space as the
	blocks they reference are changed.  Recursive snapshots taken
	with <code class="option">-r</code> create a snapshot with the same name
	on the dataset and all of its children, providing a consistent
	moment-in-time snapshot of all of the file systems.  This can
	be important when an application has files on multiple
	datasets that are related or dependent upon each other.
	Without snapshots, a backup would have copies of the files
	from different points in time.</p><p>Snapshots in <acronym class="acronym">ZFS</acronym> provide a variety of
	features that even other file systems with snapshot
	functionality lack.  A typical example of snapshot use is to
	have a quick way of backing up the current state of the file
	system when a risky action like a software installation or a
	system upgrade is performed.  If the action fails, the
	snapshot can be rolled back and the system has the same state
	as when the snapshot was created.  If the upgrade was
	successful, the snapshot can be deleted to free up space.
	Without snapshots, a failed upgrade often requires a restore
	from backup, which is tedious, time consuming, and may require
	downtime during which the system cannot be used.  Snapshots
	can be rolled back quickly, even while the system is running
	in normal operation, with little or no downtime.  The time
	savings are enormous with multi-terabyte storage systems and
	the time required to copy the data from backup.  Snapshots are
	not a replacement for a complete backup of a pool, but can be
	used as a quick and easy way to store a copy of the dataset at
	a specific point in time.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-snapshot-creation"></a>19.4.5.1. Creating Snapshots</h4></div></div></div><p>Snapshots are created  with <code class="command">zfs snapshot
	    <em class="replaceable"><code>dataset</code></em>@<em class="replaceable"><code>snapshotname</code></em></code>.
	  Adding <code class="option">-r</code> creates a snapshot recursively,
	  with the same name on all child datasets.</p><p>Create a recursive snapshot of the entire pool:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -t all</code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool                                 780M  93.2G   144K  none
mypool/ROOT                            777M  93.2G   144K  none
mypool/ROOT/default                    777M  93.2G   777M  /
mypool/tmp                             176K  93.2G   176K  /tmp
mypool/usr                             616K  93.2G   144K  /usr
mypool/usr/home                        184K  93.2G   184K  /usr/home
mypool/usr/ports                       144K  93.2G   144K  /usr/ports
mypool/usr/src                         144K  93.2G   144K  /usr/src
mypool/var                            1.29M  93.2G   616K  /var
mypool/var/crash                       148K  93.2G   148K  /var/crash
mypool/var/log                         178K  93.2G   178K  /var/log
mypool/var/mail                        144K  93.2G   144K  /var/mail
mypool/var/newname                    87.5K  93.2G  87.5K  /var/newname
mypool/var/newname@new_snapshot_name      0      -  87.5K  -
mypool/var/tmp                         152K  93.2G   152K  /var/tmp
<code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot -r <em class="replaceable"><code>mypool@my_recursive_snapshot</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                                        USED  AVAIL  REFER  MOUNTPOINT
mypool@my_recursive_snapshot                   0      -   144K  -
mypool/ROOT@my_recursive_snapshot              0      -   144K  -
mypool/ROOT/default@my_recursive_snapshot      0      -   777M  -
mypool/tmp@my_recursive_snapshot               0      -   176K  -
mypool/usr@my_recursive_snapshot               0      -   144K  -
mypool/usr/home@my_recursive_snapshot          0      -   184K  -
mypool/usr/ports@my_recursive_snapshot         0      -   144K  -
mypool/usr/src@my_recursive_snapshot           0      -   144K  -
mypool/var@my_recursive_snapshot               0      -   616K  -
mypool/var/crash@my_recursive_snapshot         0      -   148K  -
mypool/var/log@my_recursive_snapshot           0      -   178K  -
mypool/var/mail@my_recursive_snapshot          0      -   144K  -
mypool/var/newname@new_snapshot_name           0      -  87.5K  -
mypool/var/newname@my_recursive_snapshot       0      -  87.5K  -
mypool/var/tmp@my_recursive_snapshot           0      -   152K  -</pre><p>Snapshots are not shown by a normal
	  <code class="command">zfs list</code> operation.  To list snapshots,
	  <code class="option">-t snapshot</code> is appended to
	  <code class="command">zfs list</code>.  <code class="option">-t all</code>
	  displays both file systems and snapshots.</p><p>Snapshots are not mounted directly, so no path is shown in
	  the <code class="literal">MOUNTPOINT</code> column.  There is no
	  mention of available disk space in the
	  <code class="literal">AVAIL</code> column, as snapshots cannot be
	  written to after they are created.  Compare the snapshot
	  to the original dataset from which it was created:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt all <em class="replaceable"><code>mypool/usr/home</code></em></code></strong>
NAME                                    USED  AVAIL  REFER  MOUNTPOINT
mypool/usr/home                         184K  93.2G   184K  /usr/home
mypool/usr/home@my_recursive_snapshot      0      -   184K  -</pre><p>Displaying both the dataset and the snapshot together
	  reveals how snapshots work in
	  <a class="link" href="#zfs-term-cow">COW</a> fashion.  They save
	  only the changes (<span class="emphasis"><em>delta</em></span>) that were made
	  and not the complete file system contents all over again.
	  This means that snapshots take little space when few changes
	  are made.  Space usage can be made even more apparent by
	  copying a file to the dataset, then making a second
	  snapshot:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp <em class="replaceable"><code>/etc/passwd</code></em> <em class="replaceable"><code>/var/tmp</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot <em class="replaceable"><code>mypool/var/tmp</code></em>@<em class="replaceable"><code>after_cp</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt all <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         206K  93.2G   118K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp                   0      -   118K  -</pre><p>The second snapshot contains only the changes to the
	  dataset after the copy operation.  This yields enormous
	  space savings.  Notice that the size of the snapshot
	  <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em>
	  also changed in the <code class="literal">USED</code>
	  column to indicate the changes between itself and the
	  snapshot taken afterwards.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-snapshot-diff"></a>19.4.5.2. Comparing Snapshots</h4></div></div></div><p>ZFS provides a built-in command to compare the
	  differences in content between two snapshots.  This is
	  helpful when many snapshots were taken over time and the
	  user wants to see how the file system has changed over time.
	  For example, <code class="command">zfs diff</code> lets a user find
	  the latest snapshot that still contains a file that was
	  accidentally deleted.  Doing this for the two snapshots that
	  were created in the previous section yields this
	  output:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt all <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         206K  93.2G   118K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp                   0      -   118K  -
<code class="prompt">#</code> <strong class="userinput"><code>zfs diff <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em></code></strong>
M       /var/tmp/
+       /var/tmp/passwd</pre><p>The command lists the changes between the specified
	  snapshot (in this case
	  <code class="literal"><em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em></code>)
	  and the live file system.  The first column shows the
	  type of change:</p><div class="informaltable"><table class="informaltable" width="100%" border="1"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">+</td><td valign="top">The path or file was added.</td></tr><tr><td valign="top">-</td><td valign="top">The path or file was deleted.</td></tr><tr><td valign="top">M</td><td valign="top">The path or file was modified.</td></tr><tr><td valign="top">R</td><td valign="top">The path or file was renamed.</td></tr></tbody></table></div><p>Comparing the output with the table, it becomes clear
	  that <code class="filename"><em class="replaceable"><code>passwd</code></em></code>
	  was added after the snapshot
	  <code class="literal"><em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em></code>
	  was created.  This also resulted in a modification to the
	  parent directory mounted at
	  <code class="literal"><em class="replaceable"><code>/var/tmp</code></em></code>.</p><p>Comparing two snapshots is helpful when using the
	  <acronym class="acronym">ZFS</acronym> replication feature to transfer a
	  dataset to a different host for backup purposes.</p><p>Compare two snapshots by providing the full dataset name
	  and snapshot name of both datasets:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /var/tmp/passwd /var/tmp/passwd.copy</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot <em class="replaceable"><code>mypool/var/tmp@diff_snapshot</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs diff <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em> <em class="replaceable"><code>mypool/var/tmp@diff_snapshot</code></em></code></strong>
M       /var/tmp/
+       /var/tmp/passwd
+       /var/tmp/passwd.copy
<code class="prompt">#</code> <strong class="userinput"><code>zfs diff <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em> <em class="replaceable"><code>mypool/var/tmp@after_cp</code></em></code></strong>
M       /var/tmp/
+       /var/tmp/passwd</pre><p>A backup administrator can compare two snapshots
	  received from the sending host and determine the actual
	  changes in the dataset.  See the
	  <a class="link" href="#zfs-zfs-send" title="19.4.7. Replication">Replication</a> section for
	  more information.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-snapshot-rollback"></a>19.4.5.3. Snapshot Rollback</h4></div></div></div><p>When at least one snapshot is available, it can be
	  rolled back to at any time.  Most of the time this is the
	  case when the current state of the dataset is no longer
	  required and an older version is preferred.  Scenarios such
	  as local development tests have gone wrong, botched system
	  updates hampering the system's overall functionality, or the
	  requirement to restore accidentally deleted files or
	  directories are all too common occurrences.  Luckily,
	  rolling back a snapshot is just as easy as typing
	  <code class="command">zfs rollback
	    <em class="replaceable"><code>snapshotname</code></em></code>.
	  Depending on how many changes are involved, the operation
	  will finish in a certain amount of time.  During that time,
	  the dataset always remains in a consistent state, much like
	  a database that conforms to ACID principles is performing a
	  rollback.  This is happening while the dataset is live and
	  accessible without requiring a downtime.  Once the snapshot
	  has been rolled back, the dataset has the same state as it
	  had when the snapshot was originally taken.  All other data
	  in that dataset that was not part of the snapshot is
	  discarded.  Taking a snapshot of the current state of the
	  dataset before rolling back to a previous one is a good idea
	  when some data is required later.  This way, the user can
	  roll back and forth between snapshots without losing data
	  that is still valuable.</p><p>In the first example, a snapshot is rolled back because
	  of a careless <code class="command">rm</code> operation that removes
	  too much data than was intended.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt all <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp                         262K  93.2G   120K  /var/tmp
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp               53.5K      -   118K  -
mypool/var/tmp@diff_snapshot              0      -   120K  -
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp</code></strong>
passwd          passwd.copy     vi.recover
<code class="prompt">#</code> <strong class="userinput"><code>rm /var/tmp/passwd*</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp</code></strong>
vi.recover</pre><p>At this point, the user realized that too many files
	  were deleted and wants them back.  <acronym class="acronym">ZFS</acronym>
	  provides an easy way to get them back using rollbacks, but
	  only when snapshots of important data are performed on a
	  regular basis.  To get the files back and start over from
	  the last snapshot, issue the command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs rollback <em class="replaceable"><code>mypool/var/tmp@diff_snapshot</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp</code></strong>
passwd          passwd.copy     vi.recover</pre><p>The rollback operation restored the dataset to the state
	  of the last snapshot.  It is also possible to roll back to a
	  snapshot that was taken much earlier and has other snapshots
	  that were created after it.  When trying to do this,
	  <acronym class="acronym">ZFS</acronym> will issue this warning:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt snapshot <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
AME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp@my_recursive_snapshot    88K      -   152K  -
mypool/var/tmp@after_cp               53.5K      -   118K  -
mypool/var/tmp@diff_snapshot              0      -   120K  -
<code class="prompt">#</code> <strong class="userinput"><code>zfs rollback <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em></code></strong>
cannot rollback to 'mypool/var/tmp@my_recursive_snapshot': more recent snapshots exist
use '-r' to force deletion of the following snapshots:
mypool/var/tmp@after_cp
mypool/var/tmp@diff_snapshot</pre><p>This warning means that snapshots exist between the
	  current state of the dataset and the snapshot to which the
	  user wants to roll back.  To complete the rollback, these
	  snapshots must be deleted.  <acronym class="acronym">ZFS</acronym> cannot
	  track all the changes between different states of the
	  dataset, because snapshots are read-only.
	  <acronym class="acronym">ZFS</acronym> will not delete the affected
	  snapshots unless the user specifies <code class="option">-r</code> to
	  indicate that this is the desired action.  If that is the
	  intention, and the consequences of losing all intermediate
	  snapshots is understood, the command can be issued:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs rollback -r <em class="replaceable"><code>mypool/var/tmp@my_recursive_snapshot</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt snapshot <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
NAME                                   USED  AVAIL  REFER  MOUNTPOINT
mypool/var/tmp@my_recursive_snapshot     8K      -   152K  -
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp</code></strong>
vi.recover</pre><p>The output from <code class="command">zfs list -t snapshot</code>
	  confirms that the intermediate snapshots
	  were removed as a result of
	  <code class="command">zfs rollback -r</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-snapshot-snapdir"></a>19.4.5.4. Restoring Individual Files from Snapshots</h4></div></div></div><p>Snapshots are mounted in a hidden directory under the
	  parent dataset:
	  <code class="filename">.zfs/snapshots/<em class="replaceable"><code>snapshotname</code></em></code>.
	  By default, these directories will not be displayed even
	  when a standard <code class="command">ls -a</code> is issued.
	  Although the directory is not displayed, it is there
	  nevertheless and can be accessed like any normal directory.
	  The property named <code class="literal">snapdir</code> controls
	  whether these hidden directories show up in a directory
	  listing.  Setting the property to <code class="literal">visible</code>
	  allows them to appear in the output of <code class="command">ls</code>
	  and other commands that deal with directory contents.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs get snapdir <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
NAME            PROPERTY  VALUE    SOURCE
mypool/var/tmp  snapdir   hidden   default
<code class="prompt">#</code> <strong class="userinput"><code>ls -a /var/tmp</code></strong>
.               ..              passwd          vi.recover
<code class="prompt">#</code> <strong class="userinput"><code>zfs set snapdir=visible <em class="replaceable"><code>mypool/var/tmp</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls -a /var/tmp</code></strong>
.               ..              .zfs            passwd          vi.recover</pre><p>Individual files can easily be restored to a previous
	  state by copying them from the snapshot back to the parent
	  dataset.  The directory structure below
	  <code class="filename">.zfs/snapshot</code> has a directory named
	  exactly like the snapshots taken earlier to make it easier
	  to identify them.  In the next example, it is assumed that a
	  file is to be restored from the hidden
	  <code class="filename">.zfs</code> directory by copying it from the
	  snapshot that contained the latest version of the
	  file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rm /var/tmp/passwd</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls -a /var/tmp</code></strong>
.               ..              .zfs            vi.recover
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp/.zfs/snapshot</code></strong>
after_cp                my_recursive_snapshot
<code class="prompt">#</code> <strong class="userinput"><code>ls /var/tmp/.zfs/snapshot/<em class="replaceable"><code>after_cp</code></em></code></strong>
passwd          vi.recover
<code class="prompt">#</code> <strong class="userinput"><code>cp /var/tmp/.zfs/snapshot/<em class="replaceable"><code>after_cp/passwd</code></em> <em class="replaceable"><code>/var/tmp</code></em></code></strong></pre><p>When <code class="command">ls .zfs/snapshot</code> was issued, the
	  <code class="literal">snapdir</code> property might have been set to
	  hidden, but it would still be possible to list the contents
	  of that directory.  It is up to the administrator to decide
	  whether these directories will be displayed.  It is possible
	  to display these for certain datasets and prevent it for
	  others.  Copying files or directories from this hidden
	  <code class="filename">.zfs/snapshot</code> is simple enough.  Trying
	  it the other way around results in this error:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp <em class="replaceable"><code>/etc/rc.conf</code></em> /var/tmp/.zfs/snapshot/<em class="replaceable"><code>after_cp/</code></em></code></strong>
cp: /var/tmp/.zfs/snapshot/after_cp/rc.conf: Read-only file system</pre><p>The error reminds the user that snapshots are read-only
	  and cannot be changed after creation.  Files cannot be
	  copied into or removed from snapshot directories because
	  that would change the state of the dataset they
	  represent.</p><p>Snapshots consume space based on how much the parent
	  file system has changed since the time of the snapshot.  The
	  <code class="literal">written</code> property of a snapshot tracks how
	  much space is being used by the snapshot.</p><p>Snapshots are destroyed and the space reclaimed with
	  <code class="command">zfs destroy
	    <em class="replaceable"><code>dataset</code></em>@<em class="replaceable"><code>snapshot</code></em></code>.
	  Adding <code class="option">-r</code> recursively removes all snapshots
	  with the same name under the parent dataset.  Adding
	  <code class="option">-n -v</code> to the command displays a list of the
	  snapshots that would be deleted and an estimate of how much
	  space would be reclaimed without performing the actual
	  destroy operation.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-clones"></a>19.4.6. Managing Clones</h3></div></div></div><p>A clone is a copy of a snapshot that is treated more like
	a regular dataset.  Unlike a snapshot, a clone is not read
	only, is mounted, and can have its own properties.  Once a
	clone has been created using <code class="command">zfs clone</code>, the
	snapshot it was created from cannot be destroyed.  The
	child/parent relationship between the clone and the snapshot
	can be reversed using <code class="command">zfs promote</code>.  After a
	clone has been promoted, the snapshot becomes a child of the
	clone, rather than of the original parent dataset.  This will
	change how the space is accounted, but not actually change the
	amount of space consumed.  The clone can be mounted at any
	point within the <acronym class="acronym">ZFS</acronym> file system hierarchy,
	not just below the original location of the snapshot.</p><p>To demonstrate the clone feature, this example dataset is
	used:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs list -rt all <em class="replaceable"><code>camino/home/joe</code></em></code></strong>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
camino/home/joe         108K   1.3G    87K  /usr/home/joe
camino/home/joe@plans    21K      -  85.5K  -
camino/home/joe@backup    0K      -    87K  -</pre><p>A typical use for clones is to experiment with a specific
	dataset while keeping the snapshot around to fall back to in
	case something goes wrong.  Since snapshots cannot be
	changed, a read/write clone of a snapshot is created.  After
	the desired result is achieved in the clone, the clone can be
	promoted to a dataset and the old file system removed.  This
	is not strictly necessary, as the clone and dataset can
	coexist without problems.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs clone <em class="replaceable"><code>camino/home/joe</code></em>@<em class="replaceable"><code>backup</code></em> <em class="replaceable"><code>camino/home/joenew</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls /usr/home/joe*</code></strong>
/usr/home/joe:
backup.txz     plans.txt

/usr/home/joenew:
backup.txz     plans.txt
<code class="prompt">#</code> <strong class="userinput"><code>df -h /usr/home</code></strong>
Filesystem          Size    Used   Avail Capacity  Mounted on
usr/home/joe        1.3G     31k    1.3G     0%    /usr/home/joe
usr/home/joenew     1.3G     31k    1.3G     0%    /usr/home/joenew</pre><p>After a clone is created it is an exact copy of the state
	the dataset was in when the snapshot was taken.  The clone can
	now be changed independently from its originating dataset.
	The only connection between the two is the snapshot.
	<acronym class="acronym">ZFS</acronym> records this connection in the property
	<code class="literal">origin</code>.  Once the dependency between the
	snapshot and the clone has been removed by promoting the clone
	using <code class="command">zfs promote</code>, the
	<code class="literal">origin</code> of the clone is removed as it is now
	an independent dataset.  This example demonstrates it:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs get origin <em class="replaceable"><code>camino/home/joenew</code></em></code></strong>
NAME                  PROPERTY  VALUE                     SOURCE
camino/home/joenew    origin    camino/home/joe@backup    -
<code class="prompt">#</code> <strong class="userinput"><code>zfs promote <em class="replaceable"><code>camino/home/joenew</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs get origin <em class="replaceable"><code>camino/home/joenew</code></em></code></strong>
NAME                  PROPERTY  VALUE   SOURCE
camino/home/joenew    origin    -       -</pre><p>After making some changes like copying
	<code class="filename">loader.conf</code> to the promoted clone, for
	example, the old directory becomes obsolete in this case.
	Instead, the promoted clone can replace it.  This can be
	achieved by two consecutive commands: <code class="command">zfs
	  destroy</code> on the old dataset and <code class="command">zfs
	  rename</code> on the clone to name it like the old
	dataset (it could also get an entirely different name).</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp <em class="replaceable"><code>/boot/defaults/loader.conf</code></em> <em class="replaceable"><code>/usr/home/joenew</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs destroy -f <em class="replaceable"><code>camino/home/joe</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs rename <em class="replaceable"><code>camino/home/joenew</code></em> <em class="replaceable"><code>camino/home/joe</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls /usr/home/joe</code></strong>
backup.txz     loader.conf     plans.txt
<code class="prompt">#</code> <strong class="userinput"><code>df -h <em class="replaceable"><code>/usr/home</code></em></code></strong>
Filesystem          Size    Used   Avail Capacity  Mounted on
usr/home/joe        1.3G    128k    1.3G     0%    /usr/home/joe</pre><p>The cloned snapshot is now handled like an ordinary
	dataset.  It contains all the data from the original snapshot
	plus the files that were added to it like
	<code class="filename">loader.conf</code>.  Clones can be used in
	different scenarios to provide useful features to ZFS users.
	For example, jails could be provided as snapshots containing
	different sets of installed applications.  Users can clone
	these snapshots and add their own applications as they see
	fit.  Once they are satisfied with the changes, the clones can
	be promoted to full datasets and provided to end users to work
	with like they would with a real dataset.  This saves time and
	administrative overhead when providing these jails.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-send"></a>19.4.7. Replication</h3></div></div></div><p>Keeping data on a single pool in one location exposes
	it to risks like theft and natural or human disasters.  Making
	regular backups of the entire pool is vital.
	<acronym class="acronym">ZFS</acronym> provides a built-in serialization
	feature that can send a stream representation of the data to
	standard output.  Using this technique, it is possible to not
	only store the data on another pool connected to the local
	system, but also to send it over a network to another system.
	Snapshots are the basis for this replication (see the section
	on <a class="link" href="#zfs-zfs-snapshot" title="19.4.5. Managing Snapshots"><acronym class="acronym">ZFS</acronym>
	  snapshots</a>).  The commands used for replicating data
	are <code class="command">zfs send</code> and
	<code class="command">zfs receive</code>.</p><p>These examples demonstrate <acronym class="acronym">ZFS</acronym>
	replication with these two pools:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
backup  960M    77K   896M         -         -     0%    0%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%    4%  1.00x  ONLINE  -</pre><p>The pool named <em class="replaceable"><code>mypool</code></em> is the
	primary pool where data is written to and read from on a
	regular basis.  A second pool,
	<em class="replaceable"><code>backup</code></em> is used as a standby in case
	the primary pool becomes unavailable.  Note that this
	fail-over is not done automatically by <acronym class="acronym">ZFS</acronym>,
	but must be manually done by a system administrator when
	needed.  A snapshot is used to provide a consistent version of
	the file system to be replicated.  Once a snapshot of
	<em class="replaceable"><code>mypool</code></em> has been created, it can be
	copied to the <em class="replaceable"><code>backup</code></em> pool.  Only
	snapshots can be replicated.  Changes made since the most
	recent snapshot will not be included.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>backup1</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
mypool@backup1             0      -  43.6M  -</pre><p>Now that a snapshot exists, <code class="command">zfs send</code>
	can be used to create a stream representing the contents of
	the snapshot.  This stream can be stored as a file or received
	by another pool.  The stream is written to standard output,
	but must be redirected to a file or pipe or an error is
	produced:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs send <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>backup1</code></em></code></strong>
Error: Stream can not be written to a terminal.
You must redirect standard output.</pre><p>To back up a dataset with <code class="command">zfs send</code>,
	redirect to a file located on the mounted backup pool.  Ensure
	that the pool has enough free space to accommodate the size of
	the snapshot being sent, which means all of the data contained
	in the snapshot, not just the changes from the previous
	snapshot.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs send <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>backup1</code></em> &gt; <em class="replaceable"><code>/backup/backup1</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT
backup  960M  63.7M   896M         -         -     0%     6%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%     4%  1.00x  ONLINE  -</pre><p>The <code class="command">zfs send</code> transferred all the data
	in the snapshot called <em class="replaceable"><code>backup1</code></em> to
	the pool named <em class="replaceable"><code>backup</code></em>.  Creating
	and sending these snapshots can be done automatically with a
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> job.</p><p>Instead of storing the backups as archive files,
	<acronym class="acronym">ZFS</acronym> can receive them as a live file system,
	allowing the backed up data to be accessed directly.  To get
	to the actual data contained in those streams,
	<code class="command">zfs receive</code> is used to transform the
	streams back into files and directories.  The example below
	combines <code class="command">zfs send</code> and
	<code class="command">zfs receive</code> using a pipe to copy the data
	from one pool to another.  The data can be used directly on
	the receiving pool after the transfer is complete.  A dataset
	can only be replicated to an empty dataset.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>replica1</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs send -v <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>replica1</code></em> | zfs receive <em class="replaceable"><code>backup/mypool</code></em></code></strong>
send from @ to mypool@replica1 estimated size is 50.1M
total estimated size is 50.1M
TIME        SENT   SNAPSHOT

<code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT
backup  960M  63.7M   896M         -         -     0%     6%  1.00x  ONLINE  -
mypool  984M  43.7M   940M         -         -     0%     4%  1.00x  ONLINE  -</pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-send-incremental"></a>19.4.7.1. Incremental Backups</h4></div></div></div><p><code class="command">zfs send</code> can also determine the
	  difference between two snapshots and send only the
	  differences between the two.  This saves disk space and
	  transfer time.  For example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>replica2</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                    USED  AVAIL  REFER  MOUNTPOINT
mypool@replica1         5.72M      -  43.6M  -
mypool@replica2             0      -  44.1M  -
<code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG   CAP  DEDUP  HEALTH  ALTROOT
backup  960M  61.7M   898M         -         -     0%    6%  1.00x  ONLINE  -
mypool  960M  50.2M   910M         -         -     0%    5%  1.00x  ONLINE  -</pre><p>A second snapshot called
	  <em class="replaceable"><code>replica2</code></em> was created.  This
	  second snapshot contains only the changes that were made to
	  the file system between now and the previous snapshot,
	  <em class="replaceable"><code>replica1</code></em>.  Using
	  <code class="command">zfs send -i</code> and indicating the pair of
	  snapshots generates an incremental replica stream containing
	  only the data that has changed.  This can only succeed if
	  the initial snapshot already exists on the receiving
	  side.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs send -v -i <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>replica1</code></em> <em class="replaceable"><code>mypool</code></em>@<em class="replaceable"><code>replica2</code></em> | zfs receive <em class="replaceable"><code>/backup/mypool</code></em></code></strong>
send from @replica1 to mypool@replica2 estimated size is 5.02M
total estimated size is 5.02M
TIME        SENT   SNAPSHOT

<code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME    SIZE  ALLOC   FREE   CKPOINT  EXPANDSZ   FRAG  CAP  DEDUP  HEALTH  ALTROOT
backup  960M  80.8M   879M         -         -     0%   8%  1.00x  ONLINE  -
mypool  960M  50.2M   910M         -         -     0%   5%  1.00x  ONLINE  -

<code class="prompt">#</code> <strong class="userinput"><code>zfs list</code></strong>
NAME                         USED  AVAIL  REFER  MOUNTPOINT
backup                      55.4M   240G   152K  /backup
backup/mypool               55.3M   240G  55.2M  /backup/mypool
mypool                      55.6M  11.6G  55.0M  /mypool

<code class="prompt">#</code> <strong class="userinput"><code>zfs list -t snapshot</code></strong>
NAME                                         USED  AVAIL  REFER  MOUNTPOINT
backup/mypool@replica1                       104K      -  50.2M  -
backup/mypool@replica2                          0      -  55.2M  -
mypool@replica1                             29.9K      -  50.0M  -
mypool@replica2                                 0      -  55.0M  -</pre><p>The incremental stream was successfully transferred.
	  Only the data that had changed was replicated, rather than
	  the entirety of <em class="replaceable"><code>replica1</code></em>.  Only
	  the differences were sent, which took much less time to
	  transfer and saved disk space by not copying the complete
	  pool each time.  This is useful when having to rely on slow
	  networks or when costs per transferred byte must be
	  considered.</p><p>A new file system,
	  <em class="replaceable"><code>backup/mypool</code></em>, is available with
	  all of the files and data from the pool
	  <em class="replaceable"><code>mypool</code></em>.  If <code class="option">-P</code>
	  is specified, the properties of the dataset will be copied,
	  including compression settings, quotas, and mount points.
	  When <code class="option">-R</code> is specified, all child datasets of
	  the indicated dataset will be copied, along with all of
	  their properties.  Sending and receiving can be automated so
	  that regular backups are created on the second pool.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-send-ssh"></a>19.4.7.2. Sending Encrypted Backups over
	  <span class="application">SSH</span></h4></div></div></div><p>Sending streams over the network is a good way to keep a
	  remote backup, but it does come with a drawback.  Data sent
	  over the network link is not encrypted, allowing anyone to
	  intercept and transform the streams back into data without
	  the knowledge of the sending user.  This is undesirable,
	  especially when sending the streams over the internet to a
	  remote host.  <span class="application">SSH</span> can be used to
	  securely encrypt data send over a network connection.  Since
	  <acronym class="acronym">ZFS</acronym> only requires the stream to be
	  redirected from standard output, it is relatively easy to
	  pipe it through <span class="application">SSH</span>.  To keep the
	  contents of the file system encrypted in transit and on the
	  remote system, consider using <a class="link" href="https://wiki.freebsd.org/PEFS" target="_top">PEFS</a>.</p><p>A few settings and security precautions must be
	  completed first.  Only the necessary steps required for the
	  <code class="command">zfs send</code> operation are shown here.  For
	  more information on <span class="application">SSH</span>, see
	  <a class="xref" href="#openssh" title="13.8. OpenSSH">Section 13.8, &#8220;OpenSSH&#8221;</a>.</p><p>This configuration is required:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Passwordless <span class="application">SSH</span> access
	      between sending and receiving host using
	      <span class="application">SSH</span> keys</p></li><li class="listitem"><p>Normally, the privileges of the
	      <code class="systemitem">root</code> user are
	      needed to send and receive streams.  This requires
	      logging in to the receiving system as
	      <code class="systemitem">root</code>.
	      However, logging in as
	      <code class="systemitem">root</code> is
	      disabled by default for security reasons.  The
	      <a class="link" href="#zfs-zfs-allow" title="19.5. Delegated Administration">ZFS Delegation</a>
	      system can be used to allow a
	      non-<code class="systemitem">root</code> user
	      on each system to perform the respective send and
	      receive operations.</p></li><li class="listitem"><p>On the sending system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs allow -u someuser send,snapshot <em class="replaceable"><code>mypool</code></em></code></strong></pre></li><li class="listitem"><p>To mount the pool, the unprivileged user must own
	      the directory, and regular users must be allowed to
	      mount file systems.  On the receiving system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl vfs.usermount=1</code></strong>
vfs.usermount: 0 -&gt; 1
<code class="prompt">#</code> <strong class="userinput"><code>echo vfs.usermount=1 &gt;&gt; /etc/sysctl.conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs create <em class="replaceable"><code>recvpool/backup</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs allow -u <em class="replaceable"><code>someuser</code></em> create,mount,receive <em class="replaceable"><code>recvpool/backup</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown <em class="replaceable"><code>someuser</code></em> <em class="replaceable"><code>/recvpool/backup</code></em></code></strong></pre></li></ul></div><p>The unprivileged user now has the ability to receive and
	  mount datasets, and the <em class="replaceable"><code>home</code></em>
	  dataset can be replicated to the remote system:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>zfs snapshot -r <em class="replaceable"><code>mypool/home</code></em>@<em class="replaceable"><code>monday</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>zfs send -R <em class="replaceable"><code>mypool/home</code></em>@<em class="replaceable"><code>monday</code></em> | ssh <em class="replaceable"><code>someuser@backuphost</code></em> zfs recv -dvu <em class="replaceable"><code>recvpool/backup</code></em></code></strong></pre><p>A recursive snapshot called
	  <em class="replaceable"><code>monday</code></em> is made of the file system
	  dataset <em class="replaceable"><code>home</code></em> that resides on the
	  pool <em class="replaceable"><code>mypool</code></em>.  Then it is sent
	  with <code class="command">zfs send -R</code> to include the dataset,
	  all child datasets, snapshots, clones, and settings in the
	  stream.  The output is piped to the waiting
	  <code class="command">zfs receive</code> on the remote host
	  <em class="replaceable"><code>backuphost</code></em> through
	  <span class="application">SSH</span>.  Using a fully qualified
	  domain name or IP address is recommended.  The receiving
	  machine writes the data to the
	  <em class="replaceable"><code>backup</code></em> dataset on the
	  <em class="replaceable"><code>recvpool</code></em> pool.  Adding
	  <code class="option">-d</code> to <code class="command">zfs recv</code>
	  overwrites the name of the pool on the receiving side with
	  the name of the snapshot.  <code class="option">-u</code> causes the
	  file systems to not be mounted on the receiving side.  When
	  <code class="option">-v</code> is included, more detail about the
	  transfer is shown, including elapsed time and the amount of
	  data transferred.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-quota"></a>19.4.8. Dataset, User, and Group Quotas</h3></div></div></div><p><a class="link" href="#zfs-term-quota">Dataset quotas</a> are
	used to restrict the amount of space that can be consumed
	by a particular dataset.
	<a class="link" href="#zfs-term-refquota">Reference Quotas</a> work
	in very much the same way, but only count the space
	used by the dataset itself, excluding snapshots and child
	datasets.  Similarly,
	<a class="link" href="#zfs-term-userquota">user</a> and
	<a class="link" href="#zfs-term-groupquota">group</a> quotas can be
	used to prevent users or groups from using all of the
	space in the pool or dataset.</p><p>The following examples assume that the users already
	exist in the system.  Before adding a user to the system,
	make sure to create their home dataset first and set the
	<code class="option">mountpoint</code> to
	<code class="literal">/home/<em class="replaceable"><code>bob</code></em></code>.
	Then, create the user and make the home directory point to
	the dataset's <code class="option">mountpoint</code> location.  This will
	properly set owner and group permissions without shadowing any
	pre-existing home directory paths that might exist.</p><p>To enforce a dataset quota of 10 GB for
	<code class="filename">storage/home/bob</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set quota=10G storage/home/bob</code></strong></pre><p>To enforce a reference quota of 10 GB for
	<code class="filename">storage/home/bob</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set refquota=10G storage/home/bob</code></strong></pre><p>To remove a quota of 10 GB for
	<code class="filename">storage/home/bob</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set quota=none storage/home/bob</code></strong></pre><p>The general format is
	<code class="literal">userquota@<em class="replaceable"><code>user</code></em>=<em class="replaceable"><code>size</code></em></code>,
	and the user's name must be in one of these formats:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><acronym class="acronym">POSIX</acronym> compatible name such as
	    <em class="replaceable"><code>joe</code></em>.</p></li><li class="listitem"><p><acronym class="acronym">POSIX</acronym> numeric ID such as
	    <em class="replaceable"><code>789</code></em>.</p></li><li class="listitem"><p><acronym class="acronym">SID</acronym> name
	    such as
	    <em class="replaceable"><code>joe.bloggs@example.com</code></em>.</p></li><li class="listitem"><p><acronym class="acronym">SID</acronym>
	    numeric ID such as
	    <em class="replaceable"><code>S-1-123-456-789</code></em>.</p></li></ul></div><p>For example, to enforce a user quota of 50 GB for the
	user named <em class="replaceable"><code>joe</code></em>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set userquota@joe=50G</code></strong></pre><p>To remove any quota:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set userquota@joe=none</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">User quota properties are not displayed by
	  <code class="command">zfs get all</code>.
	  Non-<code class="systemitem">root</code> users can
	  only see their own quotas unless they have been granted the
	  <code class="literal">userquota</code> privilege.  Users with this
	  privilege are able to view and set everyone's quota.</p></div><p>The general format for setting a group quota is:
	<code class="literal">groupquota@<em class="replaceable"><code>group</code></em>=<em class="replaceable"><code>size</code></em></code>.</p><p>To set the quota for the group
	<em class="replaceable"><code>firstgroup</code></em> to 50 GB,
	use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set groupquota@firstgroup=50G</code></strong></pre><p>To remove the quota for the group
	<em class="replaceable"><code>firstgroup</code></em>, or to make sure that
	one is not set, instead use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set groupquota@firstgroup=none</code></strong></pre><p>As with the user quota property,
	non-<code class="systemitem">root</code> users can
	only see the quotas associated with the groups to which they
	belong.  However,
	<code class="systemitem">root</code> or a user with
	the <code class="literal">groupquota</code> privilege can view and set
	all quotas for all groups.</p><p>To display the amount of space used by each user on
	a file system or snapshot along with any quotas, use
	<code class="command">zfs userspace</code>.  For group information, use
	<code class="command">zfs groupspace</code>.  For more information about
	supported options or how to display only specific options,
	refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=zfs&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">zfs</span>(1)</span></a>.</p><p>Users with sufficient privileges, and
	<code class="systemitem">root</code>, can list the
	quota for <code class="filename">storage/home/bob</code> using:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs get quota storage/home/bob</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-reservation"></a>19.4.9. Reservations</h3></div></div></div><p><a class="link" href="#zfs-term-reservation">Reservations</a>
	guarantee a minimum amount of space will always be available
	on a dataset.  The reserved space will not be available to any
	other dataset.  This feature can be especially useful to
	ensure that free space is available for an important dataset
	or log files.</p><p>The general format of the <code class="literal">reservation</code>
	property is
	<code class="literal">reservation=<em class="replaceable"><code>size</code></em></code>,
	so to set a reservation of 10 GB on
	<code class="filename">storage/home/bob</code>, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set reservation=10G storage/home/bob</code></strong></pre><p>To clear any reservation:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set reservation=none storage/home/bob</code></strong></pre><p>The same principle can be applied to the
	<code class="literal">refreservation</code> property for setting a
	<a class="link" href="#zfs-term-refreservation">Reference
	  Reservation</a>, with the general format
	<code class="literal">refreservation=<em class="replaceable"><code>size</code></em></code>.</p><p>This command shows any reservations or refreservations
	that exist on <code class="filename">storage/home/bob</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs get reservation storage/home/bob</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs get refreservation storage/home/bob</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-compression"></a>19.4.10. Compression</h3></div></div></div><p><acronym class="acronym">ZFS</acronym> provides transparent compression.
	Compressing data at the block level as it is written not only
	saves space, but can also increase disk throughput.  If data
	is compressed by 25%, but the compressed data is written to
	the disk at the same rate as the uncompressed version,
	resulting in an effective write speed of 125%.  Compression
	can also be a great alternative to
	<a class="link" href="#zfs-zfs-deduplication" title="19.4.11. Deduplication">Deduplication</a>
	because it does not require additional memory.</p><p><acronym class="acronym">ZFS</acronym> offers several different
	compression algorithms, each with different trade-offs.  With
	the introduction of <acronym class="acronym">LZ4</acronym> compression in
	<acronym class="acronym">ZFS</acronym> v5000, it is possible to enable
	compression for the entire pool without the large performance
	trade-off of other algorithms.  The biggest advantage to
	<acronym class="acronym">LZ4</acronym> is the <span class="emphasis"><em>early abort</em></span>
	feature.  If <acronym class="acronym">LZ4</acronym> does not achieve at least
	12.5% compression in the first part of the data, the block is
	written uncompressed to avoid wasting CPU cycles trying to
	compress data that is either already compressed or
	uncompressible.  For details about the different compression
	algorithms available in <acronym class="acronym">ZFS</acronym>, see the
	<a class="link" href="#zfs-term-compression">Compression</a> entry
	in the terminology section.</p><p>The administrator can monitor the effectiveness of
	compression using a number of dataset properties.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs get used,compressratio,compression,logicalused <em class="replaceable"><code>mypool/compressed_dataset</code></em></code></strong>
NAME        PROPERTY          VALUE     SOURCE
mypool/compressed_dataset  used              449G      -
mypool/compressed_dataset  compressratio     1.11x     -
mypool/compressed_dataset  compression       lz4       local
mypool/compressed_dataset  logicalused       496G      -</pre><p>The dataset is currently using 449 GB of space (the
	used property).  Without compression, it would have taken
	496 GB of space (the <code class="literal">logicalused</code>
	property).  This results in the 1.11:1 compression
	ratio.</p><p>Compression can have an unexpected side effect when
	combined with
	<a class="link" href="#zfs-term-userquota">User Quotas</a>.
	User quotas restrict how much space a user can consume on a
	dataset, but the measurements are based on how much space is
	used <span class="emphasis"><em>after compression</em></span>.  So if a user has
	a quota of 10 GB, and writes 10 GB of compressible
	data, they will still be able to store additional data.  If
	they later update a file, say a database, with more or less
	compressible data, the amount of space available to them will
	change.  This can result in the odd situation where a user did
	not increase the actual amount of data (the
	<code class="literal">logicalused</code> property), but the change in
	compression caused them to reach their quota limit.</p><p>Compression can have a similar unexpected interaction with
	backups.  Quotas are often used to limit how much data can be
	stored to ensure there is sufficient backup space available.
	However since quotas do not consider compression, more data
	may be written than would fit with uncompressed
	backups.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-deduplication"></a>19.4.11. Deduplication</h3></div></div></div><p>When enabled,
	<a class="link" href="#zfs-term-deduplication">deduplication</a>
	uses the checksum of each block to detect duplicate blocks.
	When a new block is a duplicate of an existing block,
	<acronym class="acronym">ZFS</acronym> writes an additional reference to the
	existing data instead of the whole duplicate block.
	Tremendous space savings are possible if the data contains
	many duplicated files or repeated information.  Be warned:
	deduplication requires an extremely large amount of memory,
	and most of the space savings can be had without the extra
	cost by enabling compression instead.</p><p>To activate deduplication, set the
	<code class="literal">dedup</code> property on the target pool:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set dedup=on <em class="replaceable"><code>pool</code></em></code></strong></pre><p>Only new data being written to the pool will be
	deduplicated.  Data that has already been written to the pool
	will not be deduplicated merely by activating this option.  A
	pool with a freshly activated deduplication property will look
	like this example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME  SIZE ALLOC  FREE   CKPOINT  EXPANDSZ   FRAG   CAP   DEDUP   HEALTH   ALTROOT
pool 2.84G 2.19M 2.83G         -         -     0%    0%   1.00x   ONLINE   -</pre><p>The <code class="literal">DEDUP</code> column shows the actual rate
	of deduplication for the pool.  A value of
	<code class="literal">1.00x</code> shows that data has not been
	deduplicated yet.  In the next example, the ports tree is
	copied three times into different directories on the
	deduplicated pool created above.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>for d in dir1 dir2 dir3; do</code></strong>
&gt; <strong class="userinput"><code>mkdir $d &amp;&amp; cp -R /usr/ports $d &amp;</code></strong>
&gt; <strong class="userinput"><code>done</code></strong></pre><p>Redundant data is detected and deduplicated:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool list</code></strong>
NAME SIZE  ALLOC  FREE   CKPOINT  EXPANDSZ   FRAG  CAP   DEDUP   HEALTH   ALTROOT
pool 2.84G 20.9M 2.82G         -         -     0%   0%   3.00x   ONLINE   -</pre><p>The <code class="literal">DEDUP</code> column shows a factor of
	<code class="literal">3.00x</code>.  Multiple copies of the ports tree
	data was detected and deduplicated, using only a third of the
	space.  The potential for space savings can be enormous, but
	comes at the cost of having enough memory to keep track of the
	deduplicated blocks.</p><p>Deduplication is not always beneficial, especially when
	the data on a pool is not redundant.
	<acronym class="acronym">ZFS</acronym> can show potential space savings by
	simulating deduplication on an existing pool:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zdb -S <em class="replaceable"><code>pool</code></em></code></strong>
Simulated DDT histogram:

bucket              allocated                       referenced
______   ______________________________   ______________________________
refcnt   blocks   LSIZE   PSIZE   DSIZE   blocks   LSIZE   PSIZE   DSIZE
------   ------   -----   -----   -----   ------   -----   -----   -----
     1    2.58M    289G    264G    264G    2.58M    289G    264G    264G
     2     206K   12.6G   10.4G   10.4G     430K   26.4G   21.6G   21.6G
     4    37.6K    692M    276M    276M     170K   3.04G   1.26G   1.26G
     8    2.18K   45.2M   19.4M   19.4M    20.0K    425M    176M    176M
    16      174   2.83M   1.20M   1.20M    3.33K   48.4M   20.4M   20.4M
    32       40   2.17M    222K    222K    1.70K   97.2M   9.91M   9.91M
    64        9     56K   10.5K   10.5K      865   4.96M    948K    948K
   128        2   9.50K      2K      2K      419   2.11M    438K    438K
   256        5   61.5K     12K     12K    1.90K   23.0M   4.47M   4.47M
    1K        2      1K      1K      1K    2.98K   1.49M   1.49M   1.49M
 Total    2.82M    303G    275G    275G    3.20M    319G    287G    287G

dedup = 1.05, compress = 1.11, copies = 1.00, dedup * compress / copies = 1.16</pre><p>After <code class="command">zdb -S</code> finishes analyzing the
	pool, it shows the space reduction ratio that would be
	achieved by activating deduplication.  In this case,
	<code class="literal">1.16</code> is a very poor space saving ratio that
	is mostly provided by compression.  Activating deduplication
	on this pool would not save any significant amount of space,
	and is not worth the amount of memory required to enable
	deduplication.  Using the formula
	<span class="emphasis"><em>ratio = dedup * compress / copies</em></span>,
	system administrators can plan the storage allocation,
	deciding whether the workload will contain enough duplicate
	blocks to justify the memory requirements.  If the data is
	reasonably compressible, the space savings may be very good.
	Enabling compression first is recommended, and compression can
	also provide greatly increased performance.  Only enable
	deduplication in cases where the additional savings will be
	considerable and there is sufficient memory for the <a class="link" href="#zfs-term-deduplication"><acronym class="acronym">DDT</acronym></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-jail"></a>19.4.12. <acronym class="acronym">ZFS</acronym> and Jails</h3></div></div></div><p><code class="command">zfs jail</code> and the corresponding
	<code class="literal">jailed</code> property are used to delegate a
	<acronym class="acronym">ZFS</acronym> dataset to a
	<a class="link" href="#jails" title="Chapter 14. Jails">Jail</a>.
	<code class="command">zfs jail <em class="replaceable"><code>jailid</code></em></code>
	attaches a dataset to the specified jail, and
	<code class="command">zfs unjail</code> detaches it.  For the dataset to
	be controlled from within a jail, the
	<code class="literal">jailed</code> property must be set.  Once a
	dataset is jailed, it can no longer be mounted on the
	host because it may have mount points that would compromise
	the security of the host.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-zfs-allow"></a>19.5. Delegated Administration</h2></div></div></div><p>A comprehensive permission delegation system allows
      unprivileged users to perform <acronym class="acronym">ZFS</acronym>
      administration functions.  For example, if each user's home
      directory is a dataset, users can be given permission to create
      and destroy snapshots of their home directories.  A backup user
      can be given permission to use replication features.  A usage
      statistics script can be allowed to run with access only to the
      space utilization data for all users.  It is even possible to
      delegate the ability to delegate permissions.  Permission
      delegation is possible for each subcommand and most
      properties.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-allow-create"></a>19.5.1. Delegating Dataset Creation</h3></div></div></div><p><code class="command">zfs allow
	  <em class="replaceable"><code>someuser</code></em> create
	  <em class="replaceable"><code>mydataset</code></em></code> gives the
	specified user permission to create child datasets under the
	selected parent dataset.  There is a caveat: creating a new
	dataset involves mounting it.  That requires setting the
	FreeBSD <code class="literal">vfs.usermount</code> <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> to
	<code class="literal">1</code> to allow non-root users to mount a
	file system.  There is another restriction aimed at preventing
	abuse: non-<code class="systemitem">root</code>
	users must own the mountpoint where the file system is to be
	mounted.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-zfs-allow-allow"></a>19.5.2. Delegating Permission Delegation</h3></div></div></div><p><code class="command">zfs allow
	  <em class="replaceable"><code>someuser</code></em> allow
	  <em class="replaceable"><code>mydataset</code></em></code> gives the
	specified user the ability to assign any permission they have
	on the target dataset, or its children, to other users.  If a
	user has the <code class="literal">snapshot</code> permission and the
	<code class="literal">allow</code> permission, that user can then grant
	the <code class="literal">snapshot</code> permission to other
	users.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-advanced"></a>19.6. Advanced Topics</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-advanced-tuning"></a>19.6.1. Tuning</h3></div></div></div><p>There are a number of tunables that can be adjusted to
	make <acronym class="acronym">ZFS</acronym> perform best for different
	workloads.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a id="zfs-advanced-tuning-arc_max"></a><span class="emphasis"><em><code class="varname">vfs.zfs.arc_max</code></em></span>
	    - Maximum size of the <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>.
	    The default is all <acronym class="acronym">RAM</acronym> but 1 GB,
	    or 5/8 of all <acronym class="acronym">RAM</acronym>, whichever is more.
	    However, a lower value should be used if the system will
	    be running any other daemons or processes that may require
	    memory.  This value can be adjusted at runtime with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> and can be set in
	    <code class="filename">/boot/loader.conf</code> or
	    <code class="filename">/etc/sysctl.conf</code>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-arc_meta_limit"></a><span class="emphasis"><em><code class="varname">vfs.zfs.arc_meta_limit</code></em></span>
	    - Limit the portion of the
	    <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>
	    that can be used to store metadata.  The default is one
	    fourth of <code class="varname">vfs.zfs.arc_max</code>.  Increasing
	    this value will improve performance if the workload
	    involves operations on a large number of files and
	    directories, or frequent metadata operations, at the cost
	    of less file data fitting in the <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>.
	    This value can be adjusted at runtime with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	    and can be set in
	    <code class="filename">/boot/loader.conf</code> or
	    <code class="filename">/etc/sysctl.conf</code>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-arc_min"></a><span class="emphasis"><em><code class="varname">vfs.zfs.arc_min</code></em></span>
	    - Minimum size of the <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>.
	    The default is one half of
	    <code class="varname">vfs.zfs.arc_meta_limit</code>.  Adjust this
	    value to prevent other applications from pressuring out
	    the entire <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>.
	    This value can be adjusted at runtime with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	    and can be set in
	    <code class="filename">/boot/loader.conf</code> or
	    <code class="filename">/etc/sysctl.conf</code>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-vdev-cache-size"></a><span class="emphasis"><em><code class="varname">vfs.zfs.vdev.cache.size</code></em></span>
	    - A preallocated amount of memory reserved as a cache for
	    each device in the pool.  The total amount of memory used
	    will be this value multiplied by the number of devices.
	    This value can only be adjusted at boot time, and is set
	    in <code class="filename">/boot/loader.conf</code>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-min-auto-ashift"></a><span class="emphasis"><em><code class="varname">vfs.zfs.min_auto_ashift</code></em></span>
	    - Minimum <code class="varname">ashift</code> (sector size) that
	    will be used automatically at pool creation time.  The
	    value is a power of two.  The default value of
	    <code class="literal">9</code> represents
	    <code class="literal">2^9 = 512</code>, a sector size of 512 bytes.
	    To avoid <span class="emphasis"><em>write amplification</em></span> and get
	    the best performance, set this value to the largest sector
	    size used by a device in the pool.</p><p>Many drives have 4 KB sectors.  Using the default
	    <code class="varname">ashift</code> of <code class="literal">9</code> with
	    these drives results in write amplification on these
	    devices.  Data that could be contained in a single
	    4 KB write must instead be written in eight 512-byte
	    writes.  <acronym class="acronym">ZFS</acronym> tries to read the native
	    sector size from all devices when creating a pool, but
	    many drives with 4 KB sectors report that their
	    sectors are 512 bytes for compatibility.  Setting
	    <code class="varname">vfs.zfs.min_auto_ashift</code> to
	    <code class="literal">12</code> (<code class="literal">2^12 = 4096</code>)
	    before creating a pool forces <acronym class="acronym">ZFS</acronym> to
	    use 4 KB blocks for best performance on these
	    drives.</p><p>Forcing 4 KB blocks is also useful on pools where
	    disk upgrades are planned.  Future disks are likely to use
	    4 KB sectors, and <code class="varname">ashift</code> values
	    cannot be changed after a pool is created.</p><p>In some specific cases, the smaller 512-byte block
	    size might be preferable.  When used with 512-byte disks
	    for databases, or as storage for virtual machines, less
	    data is transferred during small random reads.  This can
	    provide better performance, especially when using a
	    smaller <acronym class="acronym">ZFS</acronym> record size.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-prefetch_disable"></a><span class="emphasis"><em><code class="varname">vfs.zfs.prefetch_disable</code></em></span>
	    - Disable prefetch.  A value of <code class="literal">0</code> is
	    enabled and <code class="literal">1</code> is disabled.  The default
	    is <code class="literal">0</code>, unless the system has less than
	    4 GB of <acronym class="acronym">RAM</acronym>.  Prefetch works by
	    reading larger blocks than were requested into the
	    <a class="link" href="#zfs-term-arc"><acronym class="acronym">ARC</acronym></a>
	    in hopes that the data will be needed soon.  If the
	    workload has a large number of random reads, disabling
	    prefetch may actually improve performance by reducing
	    unnecessary reads.  This value can be adjusted at any time
	    with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-vdev-trim_on_init"></a><span class="emphasis"><em><code class="varname">vfs.zfs.vdev.trim_on_init</code></em></span>
	    - Control whether new devices added to the pool have the
	    <code class="literal">TRIM</code> command run on them.  This ensures
	    the best performance and longevity for
	    <acronym class="acronym">SSD</acronym>s, but takes extra time.  If the
	    device has already been secure erased, disabling this
	    setting will make the addition of the new device faster.
	    This value can be adjusted at any time with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-vdev-max_pending"></a><span class="emphasis"><em><code class="varname">vfs.zfs.vdev.max_pending</code></em></span>
	    - Limit the number of pending I/O requests per device.
	    A higher value will keep the device command queue full
	    and may give higher throughput.  A lower value will reduce
	    latency.  This value can be adjusted at any time with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-top_maxinflight"></a><span class="emphasis"><em><code class="varname">vfs.zfs.top_maxinflight</code></em></span>
	    - Maxmimum number of outstanding I/Os per top-level
	    <a class="link" href="#zfs-term-vdev">vdev</a>.  Limits the
	    depth of the command queue to prevent high latency.  The
	    limit is per top-level vdev, meaning the limit applies to
	    each <a class="link" href="#zfs-term-vdev-mirror">mirror</a>,
	    <a class="link" href="#zfs-term-vdev-raidz">RAID-Z</a>, or
	    other vdev independently.  This value can be adjusted at
	    any time with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-l2arc_write_max"></a><span class="emphasis"><em><code class="varname">vfs.zfs.l2arc_write_max</code></em></span>
	    - Limit the amount of data written to the <a class="link" href="#zfs-term-l2arc"><acronym class="acronym">L2ARC</acronym></a>
	    per second.  This tunable is designed to extend the
	    longevity of <acronym class="acronym">SSD</acronym>s by limiting the
	    amount of data written to the device.  This value can be
	    adjusted at any time with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-l2arc_write_boost"></a><span class="emphasis"><em><code class="varname">vfs.zfs.l2arc_write_boost</code></em></span>
	    - The value of this tunable is added to <a class="link" href="#zfs-advanced-tuning-l2arc_write_max"><code class="varname">vfs.zfs.l2arc_write_max</code></a>
	    and increases the write speed to the
	    <acronym class="acronym">SSD</acronym> until the first block is evicted
	    from the <a class="link" href="#zfs-term-l2arc"><acronym class="acronym">L2ARC</acronym></a>.
	    This <span class="quote">&#8220;<span class="quote">Turbo Warmup Phase</span>&#8221;</span> is designed to
	    reduce the performance loss from an empty <a class="link" href="#zfs-term-l2arc"><acronym class="acronym">L2ARC</acronym></a>
	    after a reboot.  This value can be adjusted at any time
	    with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-scrub_delay"></a><span class="emphasis"><em><code class="varname">vfs.zfs.scrub_delay</code></em></span>
	    - Number of ticks to delay between each I/O during a
	    <a class="link" href="#zfs-term-scrub"><code class="command">scrub</code></a>.
	    To ensure that a <code class="command">scrub</code> does not
	    interfere with the normal operation of the pool, if any
	    other <acronym class="acronym">I/O</acronym> is happening the
	    <code class="command">scrub</code> will delay between each command.
	    This value controls the limit on the total
	    <acronym class="acronym">IOPS</acronym> (I/Os Per Second) generated by the
	    <code class="command">scrub</code>.  The granularity of the setting
	    is determined by the value of <code class="varname">kern.hz</code>
	    which defaults to 1000 ticks per second.  This setting may
	    be changed, resulting in a different effective
	    <acronym class="acronym">IOPS</acronym> limit.  The default value is
	    <code class="literal">4</code>, resulting in a limit of:
	    1000 ticks/sec / 4 =
	    250 <acronym class="acronym">IOPS</acronym>.  Using a value of
	    <em class="replaceable"><code>20</code></em> would give a limit of:
	    1000 ticks/sec / 20 =
	    50 <acronym class="acronym">IOPS</acronym>.  The speed of
	    <code class="command">scrub</code> is only limited when there has
	    been recent activity on the pool, as determined by <a class="link" href="#zfs-advanced-tuning-scan_idle"><code class="varname">vfs.zfs.scan_idle</code></a>.
	    This value can be adjusted at any time with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-resilver_delay"></a><span class="emphasis"><em><code class="varname">vfs.zfs.resilver_delay</code></em></span>
	    - Number of milliseconds of delay inserted between
	    each I/O during a
	    <a class="link" href="#zfs-term-resilver">resilver</a>.  To
	    ensure that a resilver does not interfere with the normal
	    operation of the pool, if any other I/O is happening the
	    resilver will delay between each command.  This value
	    controls the limit of total <acronym class="acronym">IOPS</acronym> (I/Os
	    Per Second) generated by the resilver.  The granularity of
	    the setting is determined by the value of
	    <code class="varname">kern.hz</code> which defaults to 1000 ticks
	    per second.  This setting may be changed, resulting in a
	    different effective <acronym class="acronym">IOPS</acronym> limit.  The
	    default value is 2, resulting in a limit of:
	    1000 ticks/sec / 2 =
	    500 <acronym class="acronym">IOPS</acronym>.  Returning the pool to
	    an <a class="link" href="#zfs-term-online">Online</a> state may
	    be more important if another device failing could
	    <a class="link" href="#zfs-term-faulted">Fault</a> the pool,
	    causing data loss.  A value of 0 will give the resilver
	    operation the same priority as other operations, speeding
	    the healing process.  The speed of resilver is only
	    limited when there has been other recent activity on the
	    pool, as determined by <a class="link" href="#zfs-advanced-tuning-scan_idle"><code class="varname">vfs.zfs.scan_idle</code></a>.
	    This value can be adjusted at any time with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-scan_idle"></a><span class="emphasis"><em><code class="varname">vfs.zfs.scan_idle</code></em></span>
	    - Number of milliseconds since the last operation before
	    the pool is considered idle.  When the pool is idle the
	    rate limiting for <a class="link" href="#zfs-term-scrub"><code class="command">scrub</code></a>
	    and
	    <a class="link" href="#zfs-term-resilver">resilver</a> are
	    disabled.  This value can be adjusted at any time with
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li><li class="listitem"><p><a id="zfs-advanced-tuning-txg-timeout"></a><span class="emphasis"><em><code class="varname">vfs.zfs.txg.timeout</code></em></span>
	    - Maximum number of seconds between
	    <a class="link" href="#zfs-term-txg">transaction group</a>s.
	    The current transaction group will be written to the pool
	    and a fresh transaction group started if this amount of
	    time has elapsed since the previous transaction group.  A
	    transaction group my be triggered earlier if enough data
	    is written.  The default value is 5 seconds.  A larger
	    value may improve read performance by delaying
	    asynchronous writes, but this may cause uneven performance
	    when the transaction group is written.  This value can be
	    adjusted at any time with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zfs-advanced-i386"></a>19.6.2. <acronym class="acronym">ZFS</acronym> on i386</h3></div></div></div><p>Some of the features provided by <acronym class="acronym">ZFS</acronym>
	are memory intensive, and may require tuning for maximum
	efficiency on systems with limited
	<acronym class="acronym">RAM</acronym>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63121400"></a>19.6.2.1. Memory</h4></div></div></div><p>As a bare minimum, the total system memory should be at
	  least one gigabyte.  The amount of recommended
	  <acronym class="acronym">RAM</acronym> depends upon the size of the pool and
	  which <acronym class="acronym">ZFS</acronym> features are used.  A general
	  rule of thumb is 1 GB of RAM for every 1 TB of
	  storage.  If the deduplication feature is used, a general
	  rule of thumb is 5 GB of RAM per TB of storage to be
	  deduplicated.  While some users successfully use
	  <acronym class="acronym">ZFS</acronym> with less <acronym class="acronym">RAM</acronym>,
	  systems under heavy load may panic due to memory exhaustion.
	  Further tuning may be required for systems with less than
	  the recommended RAM requirements.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63124088"></a>19.6.2.2. Kernel Configuration</h4></div></div></div><p>Due to the address space limitations of the
	  <span class="trademark">i386</span>&#8482; platform, <acronym class="acronym">ZFS</acronym> users on the
	  <span class="trademark">i386</span>&#8482; architecture must add this option to a
	  custom kernel configuration file, rebuild the kernel, and
	  reboot:</p><pre class="programlisting">options        KVA_PAGES=512</pre><p>This expands the kernel address space, allowing
	  the <code class="varname">vm.kvm_size</code> tunable to be pushed
	  beyond the currently imposed limit of 1 GB, or the
	  limit of 2 GB for <acronym class="acronym">PAE</acronym>.  To find the
	  most suitable value for this option, divide the desired
	  address space in megabytes by four.  In this example, it
	  is <code class="literal">512</code> for 2 GB.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63128312"></a>19.6.2.3. Loader Tunables</h4></div></div></div><p>The <code class="filename">kmem</code> address space can be
	  increased on all FreeBSD architectures.  On a test system with
	  1 GB of physical memory, success was achieved with
	  these options added to
	  <code class="filename">/boot/loader.conf</code>, and the system
	  restarted:</p><pre class="programlisting">vm.kmem_size="330M"
vm.kmem_size_max="330M"
vfs.zfs.arc_max="40M"
vfs.zfs.vdev.cache.size="5M"</pre><p>For a more detailed list of recommendations for
	  <acronym class="acronym">ZFS</acronym>-related tuning, see <a class="link" href="https://wiki.freebsd.org/ZFSTuningGuide" target="_top">https://wiki.freebsd.org/ZFSTuningGuide</a>.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-links"></a>19.7. Additional Resources</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://open-zfs.org" target="_top">OpenZFS</a></p></li><li class="listitem"><p><a class="link" href="https://wiki.freebsd.org/ZFSTuningGuide" target="_top">FreeBSD
	    Wiki - <acronym class="acronym">ZFS</acronym> Tuning</a></p></li><li class="listitem"><p><a class="link" href="http://docs.oracle.com/cd/E19253-01/819-5461/index.html" target="_top">Oracle
	    Solaris <acronym class="acronym">ZFS</acronym> Administration
	    Guide</a></p></li><li class="listitem"><p><a class="link" href="https://calomel.org/zfs_raid_speed_capacity.html" target="_top">Calomel
	    Blog - <acronym class="acronym">ZFS</acronym> Raidz Performance, Capacity
	    and Integrity</a></p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="zfs-term"></a>19.8. <acronym class="acronym">ZFS</acronym> Features and Terminology</h2></div></div></div><p><acronym class="acronym">ZFS</acronym> is a fundamentally different file
      system because it is more than just a file system.
      <acronym class="acronym">ZFS</acronym> combines the roles of file system and
      volume manager, enabling additional storage devices to be added
      to a live system and having the new space available on all of
      the existing file systems in that pool immediately.  By
      combining the traditionally separate roles,
      <acronym class="acronym">ZFS</acronym> is able to overcome previous limitations
      that prevented <acronym class="acronym">RAID</acronym> groups being able to
      grow.  Each top level device in a pool is called a
      <span class="emphasis"><em>vdev</em></span>, which can be a simple disk or a
      <acronym class="acronym">RAID</acronym> transformation such as a mirror or
      <acronym class="acronym">RAID-Z</acronym> array.  <acronym class="acronym">ZFS</acronym> file
      systems (called <span class="emphasis"><em>datasets</em></span>) each have access
      to the combined free space of the entire pool.  As blocks are
      allocated from the pool, the space available to each file system
      decreases.  This approach avoids the common pitfall with
      extensive partitioning where free space becomes fragmented
      across the partitions.</p><div class="informaltable"><table class="informaltable" width="100%" border="1"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top"><a id="zfs-term-pool"></a>pool</td><td valign="top">A storage <span class="emphasis"><em>pool</em></span> is the most
	      basic building block of <acronym class="acronym">ZFS</acronym>.  A pool
	      is made up of one or more vdevs, the underlying devices
	      that store the data.  A pool is then used to create one
	      or more file systems (datasets) or block devices
	      (volumes).  These datasets and volumes share the pool of
	      remaining free space.  Each pool is uniquely identified
	      by a name and a <acronym class="acronym">GUID</acronym>.  The features
	      available are determined by the <acronym class="acronym">ZFS</acronym>
	      version number on the pool.</td></tr><tr><td valign="top"><a id="zfs-term-vdev"></a>vdev Types</td><td valign="top">A pool is made up of one or more vdevs, which
	      themselves can be a single disk or a group of disks, in
	      the case of a <acronym class="acronym">RAID</acronym> transform.  When
	      multiple vdevs are used, <acronym class="acronym">ZFS</acronym> spreads
	      data across the vdevs to increase performance and
	      maximize usable space.

	      <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a id="zfs-term-vdev-disk"></a><span class="emphasis"><em>Disk</em></span>
		    - The most basic type of vdev is a standard block
		    device.  This can be an entire disk (such as
		    <code class="filename"><em class="replaceable"><code>/dev/ada0</code></em></code>
		    or
		    <code class="filename"><em class="replaceable"><code>/dev/da0</code></em></code>)
		    or a partition
		    (<code class="filename"><em class="replaceable"><code>/dev/ada0p3</code></em></code>).
		    On FreeBSD, there is no performance penalty for using
		    a partition rather than the entire disk.  This
		    differs from recommendations made by the Solaris
		    documentation.</p><div xmlns="" class="caution"><h3 class="admontitle">Caution: </h3><p xmlns="http://www.w3.org/1999/xhtml">Using an entire disk as part of a bootable
		      pool is strongly discouraged, as this may render
		      the pool unbootable.  Likewise, you should not
		      use an entire disk as part of a mirror or
		      <acronym class="acronym">RAID-Z</acronym> vdev.  These are
		      because it it impossible to reliably determine
		      the size of an unpartitioned disk at boot time
		      and because there's no place to put in boot
		      code.</p></div></li><li class="listitem"><p><a id="zfs-term-vdev-file"></a><span class="emphasis"><em>File</em></span>
		    - In addition to disks, <acronym class="acronym">ZFS</acronym>
		    pools can be backed by regular files, this is
		    especially useful for testing and experimentation.
		    Use the full path to the file as the device path
		    in <code class="command">zpool create</code>.  All vdevs
		    must be at least 128 MB in size.</p></li><li class="listitem"><p><a id="zfs-term-vdev-mirror"></a><span class="emphasis"><em>Mirror</em></span>
		    - When creating a mirror, specify the
		    <code class="literal">mirror</code> keyword followed by the
		    list of member devices for the mirror.  A mirror
		    consists of two or more devices, all data will be
		    written to all member devices.  A mirror vdev will
		    only hold as much data as its smallest member.  A
		    mirror vdev can withstand the failure of all but
		    one of its members without losing any data.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">A regular single disk vdev can be upgraded
		      to a mirror vdev at any time with
		      <code class="command">zpool
			<a class="link" href="#zfs-zpool-attach" title="19.3.2. Adding and Removing Devices">attach</a></code>.</p></div></li><li class="listitem"><p><a id="zfs-term-vdev-raidz"></a><span class="emphasis"><em><acronym class="acronym">RAID-Z</acronym></em></span>
		    - <acronym class="acronym">ZFS</acronym> implements
		    <acronym class="acronym">RAID-Z</acronym>, a variation on standard
		    <acronym class="acronym">RAID-5</acronym> that offers better
		    distribution of parity and eliminates the
		    <span class="quote">&#8220;<span class="quote"><acronym class="acronym">RAID-5</acronym> write
		    hole</span>&#8221;</span> in which the data and parity
		    information become inconsistent after an
		    unexpected restart.  <acronym class="acronym">ZFS</acronym>
		    supports three levels of <acronym class="acronym">RAID-Z</acronym>
		    which provide varying levels of redundancy in
		    exchange for decreasing levels of usable storage.
		    The types are named <acronym class="acronym">RAID-Z1</acronym>
		    through <acronym class="acronym">RAID-Z3</acronym> based on the
		    number of parity devices in the array and the
		    number of disks which can fail while the pool
		    remains operational.</p><p>In a <acronym class="acronym">RAID-Z1</acronym> configuration
		    with four disks, each 1 TB, usable storage is
		    3 TB and the pool will still be able to
		    operate in degraded mode with one faulted disk.
		    If an additional disk goes offline before the
		    faulted disk is replaced and resilvered, all data
		    in the pool can be lost.</p><p>In a <acronym class="acronym">RAID-Z3</acronym> configuration
		    with eight disks of 1 TB, the volume will
		    provide 5 TB of usable space and still be
		    able to operate with three faulted disks.  <span class="trademark">Sun</span>&#8482;
		    recommends no more than nine disks in a single
		    vdev.  If the configuration has more disks, it is
		    recommended to divide them into separate vdevs and
		    the pool data will be striped across them.</p><p>A configuration of two
		    <acronym class="acronym">RAID-Z2</acronym> vdevs consisting of 8
		    disks each would create something similar to a
		    <acronym class="acronym">RAID-60</acronym> array.  A
		    <acronym class="acronym">RAID-Z</acronym> group's storage capacity
		    is approximately the size of the smallest disk
		    multiplied by the number of non-parity disks.
		    Four 1 TB disks in <acronym class="acronym">RAID-Z1</acronym>
		    has an effective size of approximately 3 TB,
		    and an array of eight 1 TB disks in
		    <acronym class="acronym">RAID-Z3</acronym> will yield 5 TB of
		    usable space.</p></li><li class="listitem"><p><a id="zfs-term-vdev-spare"></a><span class="emphasis"><em>Spare</em></span>
		    - <acronym class="acronym">ZFS</acronym> has a special pseudo-vdev
		    type for keeping track of available hot spares.
		    Note that installed hot spares are not deployed
		    automatically; they must manually be configured to
		    replace the failed device using
		    <code class="command">zfs replace</code>.</p></li><li class="listitem"><p><a id="zfs-term-vdev-log"></a><span class="emphasis"><em>Log</em></span>
		    - <acronym class="acronym">ZFS</acronym> Log Devices, also known
		    as <acronym class="acronym">ZFS</acronym> Intent Log (<a class="link" href="#zfs-term-zil"><acronym class="acronym">ZIL</acronym></a>)
		    move the intent log from the regular pool devices
		    to a dedicated device, typically an
		    <acronym class="acronym">SSD</acronym>.  Having a dedicated log
		    device can significantly improve the performance
		    of applications with a high volume of synchronous
		    writes, especially databases.  Log devices can be
		    mirrored, but <acronym class="acronym">RAID-Z</acronym> is not
		    supported.  If multiple log devices are used,
		    writes will be load balanced across them.</p></li><li class="listitem"><p><a id="zfs-term-vdev-cache"></a><span class="emphasis"><em>Cache</em></span>
		    - Adding a cache vdev to a pool will add the
		    storage of the cache to the <a class="link" href="#zfs-term-l2arc"><acronym class="acronym">L2ARC</acronym></a>.
		    Cache devices cannot be mirrored.  Since a cache
		    device only stores additional copies of existing
		    data, there is no risk of data loss.</p></li></ul></div></td></tr><tr><td valign="top"><a id="zfs-term-txg"></a>Transaction Group
	      (<acronym class="acronym">TXG</acronym>)</td><td valign="top">Transaction Groups are the way changed blocks are
	      grouped together and eventually written to the pool.
	      Transaction groups are the atomic unit that
	      <acronym class="acronym">ZFS</acronym> uses to assert consistency.  Each
	      transaction group is assigned a unique 64-bit
	      consecutive identifier.  There can be up to three active
	      transaction groups at a time, one in each of these three
	      states:

	      <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Open</em></span> - When a new
		    transaction group is created, it is in the open
		    state, and accepts new writes.  There is always
		    a transaction group in the open state, however the
		    transaction group may refuse new writes if it has
		    reached a limit.  Once the open transaction group
		    has reached a limit, or the <a class="link" href="#zfs-advanced-tuning-txg-timeout"><code class="varname">vfs.zfs.txg.timeout</code></a>
		    has been reached, the transaction group advances
		    to the next state.</p></li><li class="listitem"><p><span class="emphasis"><em>Quiescing</em></span> - A short state
		    that allows any pending operations to finish while
		    not blocking the creation of a new open
		    transaction group.  Once all of the transactions
		    in the group have completed, the transaction group
		    advances to the final state.</p></li><li class="listitem"><p><span class="emphasis"><em>Syncing</em></span> - All of the data
		    in the transaction group is written to stable
		    storage.  This process will in turn modify other
		    data, such as metadata and space maps, that will
		    also need to be written to stable storage.  The
		    process of syncing involves multiple passes.  The
		    first, all of the changed data blocks, is the
		    biggest, followed by the metadata, which may take
		    multiple passes to complete.  Since allocating
		    space for the data blocks generates new metadata,
		    the syncing state cannot finish until a pass
		    completes that does not allocate any additional
		    space.  The syncing state is also where
		    <span class="emphasis"><em>synctasks</em></span> are completed.
		    Synctasks are administrative operations, such as
		    creating or destroying snapshots and datasets,
		    that modify the uberblock are completed.  Once the
		    sync state is complete, the transaction group in
		    the quiescing state is advanced to the syncing
		    state.</p></li></ul></div>

	      All administrative functions, such as <a class="link" href="#zfs-term-snapshot"><code class="command">snapshot</code></a>
	      are written as part of the transaction group.  When a
	      synctask is created, it is added to the currently open
	      transaction group, and that group is advanced as quickly
	      as possible to the syncing state to reduce the
	      latency of administrative commands.</td></tr><tr><td valign="top"><a id="zfs-term-arc"></a>Adaptive Replacement
	      Cache (<acronym class="acronym">ARC</acronym>)</td><td valign="top"><acronym class="acronym">ZFS</acronym> uses an Adaptive Replacement
	      Cache (<acronym class="acronym">ARC</acronym>), rather than a more
	      traditional Least Recently Used (<acronym class="acronym">LRU</acronym>)
	      cache.  An <acronym class="acronym">LRU</acronym> cache is a simple list
	      of items in the cache, sorted by when each object was
	      most recently used.  New items are added to the top of
	      the list.  When the cache is full, items from the
	      bottom of the list are evicted to make room for more
	      active objects.  An <acronym class="acronym">ARC</acronym> consists of
	      four lists; the Most Recently Used
	      (<acronym class="acronym">MRU</acronym>) and Most Frequently Used
	      (<acronym class="acronym">MFU</acronym>) objects, plus a ghost list for
	      each.  These ghost lists track recently evicted objects
	      to prevent them from being added back to the cache.
	      This increases the cache hit ratio by avoiding objects
	      that have a history of only being used occasionally.
	      Another advantage of using both an
	      <acronym class="acronym">MRU</acronym> and <acronym class="acronym">MFU</acronym> is
	      that scanning an entire file system would normally evict
	      all data from an <acronym class="acronym">MRU</acronym> or
	      <acronym class="acronym">LRU</acronym> cache in favor of this freshly
	      accessed content.  With <acronym class="acronym">ZFS</acronym>, there is
	      also an <acronym class="acronym">MFU</acronym> that only tracks the most
	      frequently used objects, and the cache of the most
	      commonly accessed blocks remains.</td></tr><tr><td valign="top"><a id="zfs-term-l2arc"></a><acronym class="acronym">L2ARC</acronym></td><td valign="top"><acronym class="acronym">L2ARC</acronym> is the second level
	      of the <acronym class="acronym">ZFS</acronym> caching system.  The
	      primary <acronym class="acronym">ARC</acronym> is stored in
	      <acronym class="acronym">RAM</acronym>.  Since the amount of
	      available <acronym class="acronym">RAM</acronym> is often limited,
	      <acronym class="acronym">ZFS</acronym> can also use
	      <a class="link" href="#zfs-term-vdev-cache">cache vdevs</a>.
	      Solid State Disks (<acronym class="acronym">SSD</acronym>s) are often
	      used as these cache devices due to their higher speed
	      and lower latency compared to traditional spinning
	      disks.  <acronym class="acronym">L2ARC</acronym> is entirely optional,
	      but having one will significantly increase read speeds
	      for files that are cached on the <acronym class="acronym">SSD</acronym>
	      instead of having to be read from the regular disks.
	      <acronym class="acronym">L2ARC</acronym> can also speed up <a class="link" href="#zfs-term-deduplication">deduplication</a>
	      because a <acronym class="acronym">DDT</acronym> that does not fit in
	      <acronym class="acronym">RAM</acronym> but does fit in the
	      <acronym class="acronym">L2ARC</acronym> will be much faster than a
	      <acronym class="acronym">DDT</acronym> that must be read from disk.  The
	      rate at which data is added to the cache devices is
	      limited to prevent prematurely wearing out
	      <acronym class="acronym">SSD</acronym>s with too many writes.  Until the
	      cache is full (the first block has been evicted to make
	      room), writing to the <acronym class="acronym">L2ARC</acronym> is
	      limited to the sum of the write limit and the boost
	      limit, and afterwards limited to the write limit.  A
	      pair of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> values control these rate limits.
	      <a class="link" href="#zfs-advanced-tuning-l2arc_write_max"><code class="varname">vfs.zfs.l2arc_write_max</code></a>
	      controls how many bytes are written to the cache per
	      second, while <a class="link" href="#zfs-advanced-tuning-l2arc_write_boost"><code class="varname">vfs.zfs.l2arc_write_boost</code></a>
	      adds to this limit during the
	      <span class="quote">&#8220;<span class="quote">Turbo Warmup Phase</span>&#8221;</span> (Write Boost).</td></tr><tr><td valign="top"><a id="zfs-term-zil"></a><acronym class="acronym">ZIL</acronym></td><td valign="top"><acronym class="acronym">ZIL</acronym> accelerates synchronous
	      transactions by using storage devices like
	      <acronym class="acronym">SSD</acronym>s that are faster than those used
	      in the main storage pool.  When an application requests
	      a synchronous write (a guarantee that the data has been
	      safely stored to disk rather than merely cached to be
	      written later), the data is written to the faster
	      <acronym class="acronym">ZIL</acronym> storage, then later flushed out
	      to the regular disks.  This greatly reduces latency and
	      improves performance.  Only synchronous workloads like
	      databases will benefit from a <acronym class="acronym">ZIL</acronym>.
	      Regular asynchronous writes such as copying files will
	      not use the <acronym class="acronym">ZIL</acronym> at all.</td></tr><tr><td valign="top"><a id="zfs-term-cow"></a>Copy-On-Write</td><td valign="top">Unlike a traditional file system, when data is
	      overwritten on <acronym class="acronym">ZFS</acronym>, the new data is
	      written to a different block rather than overwriting the
	      old data in place.  Only when this write is complete is
	      the metadata then updated to point to the new location.
	      In the event of a shorn write (a system crash or power
	      loss in the middle of writing a file), the entire
	      original contents of the file are still available and
	      the incomplete write is discarded.  This also means that
	      <acronym class="acronym">ZFS</acronym> does not require a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>
	      after an unexpected shutdown.</td></tr><tr><td valign="top"><a id="zfs-term-dataset"></a>Dataset</td><td valign="top"><span class="emphasis"><em>Dataset</em></span> is the generic term
	      for a <acronym class="acronym">ZFS</acronym> file system, volume,
	      snapshot or clone.  Each dataset has a unique name in
	      the format
	      <em class="replaceable"><code>poolname/path@snapshot</code></em>.
	      The root of the pool is technically a dataset as well.
	      Child datasets are named hierarchically like
	      directories.  For example,
	      <em class="replaceable"><code>mypool/home</code></em>, the home
	      dataset, is a child of <em class="replaceable"><code>mypool</code></em>
	      and inherits properties from it.  This can be expanded
	      further by creating
	      <em class="replaceable"><code>mypool/home/user</code></em>.  This
	      grandchild dataset will inherit properties from the
	      parent and grandparent.  Properties on a child can be
	      set to override the defaults inherited from the parents
	      and grandparents.  Administration of datasets and their
	      children can be
	      <a class="link" href="#zfs-zfs-allow" title="19.5. Delegated Administration">delegated</a>.</td></tr><tr><td valign="top"><a id="zfs-term-filesystem"></a>File system</td><td valign="top">A <acronym class="acronym">ZFS</acronym> dataset is most often used
	      as a file system.  Like most other file systems, a
	      <acronym class="acronym">ZFS</acronym> file system is mounted somewhere
	      in the systems directory hierarchy and contains files
	      and directories of its own with permissions, flags, and
	      other metadata.</td></tr><tr><td valign="top"><a id="zfs-term-volume"></a>Volume</td><td valign="top">In additional to regular file system datasets,
	      <acronym class="acronym">ZFS</acronym> can also create volumes, which
	      are block devices.  Volumes have many of the same
	      features, including copy-on-write, snapshots, clones,
	      and checksumming.  Volumes can be useful for running
	      other file system formats on top of
	      <acronym class="acronym">ZFS</acronym>, such as <acronym class="acronym">UFS</acronym>
	      virtualization, or exporting <acronym class="acronym">iSCSI</acronym>
	      extents.</td></tr><tr><td valign="top"><a id="zfs-term-snapshot"></a>Snapshot</td><td valign="top">The
	      <a class="link" href="#zfs-term-cow">copy-on-write</a>
	      (<acronym class="acronym">COW</acronym>) design of
	      <acronym class="acronym">ZFS</acronym> allows for nearly instantaneous,
	      consistent snapshots with arbitrary names.  After taking
	      a snapshot of a dataset, or a recursive snapshot of a
	      parent dataset that will include all child datasets, new
	      data is written to new blocks, but the old blocks are
	      not reclaimed as free space.  The snapshot contains
	      the original version of the file system, and the live
	      file system contains any changes made since the snapshot
	      was taken.  No additional space is used.  As new data is
	      written to the live file system, new blocks are
	      allocated to store this data.  The apparent size of the
	      snapshot will grow as the blocks are no longer used in
	      the live file system, but only in the snapshot.  These
	      snapshots can be mounted read only to allow for the
	      recovery of previous versions of files.  It is also
	      possible to
	      <a class="link" href="#zfs-zfs-snapshot" title="19.4.5. Managing Snapshots">rollback</a> a live
	      file system to a specific snapshot, undoing any changes
	      that took place after the snapshot was taken.  Each
	      block in the pool has a reference counter which keeps
	      track of how many snapshots, clones, datasets, or
	      volumes make use of that block.  As files and snapshots
	      are deleted, the reference count is decremented.  When a
	      block is no longer referenced, it is reclaimed as free
	      space.  Snapshots can also be marked with a
	      <a class="link" href="#zfs-zfs-snapshot" title="19.4.5. Managing Snapshots">hold</a>.  When a
	      snapshot is held, any attempt to destroy it will return
	      an <code class="literal">EBUSY</code> error.  Each snapshot can
	      have multiple holds, each with a unique name.  The
	      <a class="link" href="#zfs-zfs-snapshot" title="19.4.5. Managing Snapshots">release</a> command
	      removes the hold so the snapshot can deleted.  Snapshots
	      can be taken on volumes, but they can only be cloned or
	      rolled back, not mounted independently.</td></tr><tr><td valign="top"><a id="zfs-term-clone"></a>Clone</td><td valign="top">Snapshots can also be cloned.  A clone is a
	      writable version of a snapshot, allowing the file system
	      to be forked as a new dataset.  As with a snapshot, a
	      clone initially consumes no additional space.  As
	      new data is written to a clone and new blocks are
	      allocated, the apparent size of the clone grows.  When
	      blocks are overwritten in the cloned file system or
	      volume, the reference count on the previous block is
	      decremented.  The snapshot upon which a clone is based
	      cannot be deleted because the clone depends on it.  The
	      snapshot is the parent, and the clone is the child.
	      Clones can be <span class="emphasis"><em>promoted</em></span>, reversing
	      this dependency and making the clone the parent and the
	      previous parent the child.  This operation requires no
	      additional space.  Because the amount of space used by
	      the parent and child is reversed, existing quotas and
	      reservations might be affected.</td></tr><tr><td valign="top"><a id="zfs-term-checksum"></a>Checksum</td><td valign="top">Every block that is allocated is also checksummed.
	      The checksum algorithm used is a per-dataset property,
	      see <a class="link" href="#zfs-zfs-set" title="19.4.4. Setting Dataset Properties"><code class="command">set</code></a>.
	      The checksum of each block is transparently validated as
	      it is read, allowing <acronym class="acronym">ZFS</acronym> to detect
	      silent corruption.  If the data that is read does not
	      match the expected checksum, <acronym class="acronym">ZFS</acronym> will
	      attempt to recover the data from any available
	      redundancy, like mirrors or <acronym class="acronym">RAID-Z</acronym>).
	      Validation of all checksums can be triggered with <a class="link" href="#zfs-term-scrub"><code class="command">scrub</code></a>.
	      Checksum algorithms include:

	      <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">fletcher2</code></p></li><li class="listitem"><p><code class="literal">fletcher4</code></p></li><li class="listitem"><p><code class="literal">sha256</code></p></li></ul></div>

	      The <code class="literal">fletcher</code> algorithms are faster,
	      but <code class="literal">sha256</code> is a strong cryptographic
	      hash and has a much lower chance of collisions at the
	      cost of some performance.  Checksums can be disabled,
	      but it is not recommended.</td></tr><tr><td valign="top"><a id="zfs-term-compression"></a>Compression</td><td valign="top">Each dataset has a compression property, which
	      defaults to off.  This property can be set to one of a
	      number of compression algorithms.  This will cause all
	      new data that is written to the dataset to be
	      compressed.  Beyond a reduction in space used, read and
	      write throughput often increases because fewer blocks
	      are read or written.

	      <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a id="zfs-term-compression-lz4"></a><span class="emphasis"><em><acronym class="acronym">LZ4</acronym></em></span> -
		    Added in <acronym class="acronym">ZFS</acronym> pool version
		    5000 (feature flags), <acronym class="acronym">LZ4</acronym> is
		    now the recommended compression algorithm.
		    <acronym class="acronym">LZ4</acronym> compresses approximately
		    50% faster than <acronym class="acronym">LZJB</acronym> when
		    operating on compressible data, and is over three
		    times faster when operating on uncompressible
		    data.  <acronym class="acronym">LZ4</acronym> also decompresses
		    approximately 80% faster than
		    <acronym class="acronym">LZJB</acronym>.  On modern
		    <acronym class="acronym">CPU</acronym>s, <acronym class="acronym">LZ4</acronym>
		    can often compress at over 500 MB/s, and
		    decompress at over 1.5 GB/s (per single CPU
		    core).</p></li><li class="listitem"><p><a id="zfs-term-compression-lzjb"></a><span class="emphasis"><em><acronym class="acronym">LZJB</acronym></em></span> -
		    The default compression algorithm.  Created by
		    Jeff Bonwick (one of the original creators of
		    <acronym class="acronym">ZFS</acronym>).  <acronym class="acronym">LZJB</acronym>
		    offers good compression with less
		    <acronym class="acronym">CPU</acronym> overhead compared to
		    <acronym class="acronym">GZIP</acronym>.  In the future, the
		    default compression algorithm will likely change
		    to <acronym class="acronym">LZ4</acronym>.</p></li><li class="listitem"><p><a id="zfs-term-compression-gzip"></a><span class="emphasis"><em><acronym class="acronym">GZIP</acronym></em></span> -
		    A popular stream compression algorithm available
		    in <acronym class="acronym">ZFS</acronym>.  One of the main
		    advantages of using <acronym class="acronym">GZIP</acronym> is its
		    configurable level of compression.  When setting
		    the <code class="literal">compress</code> property, the
		    administrator can choose the level of compression,
		    ranging from <code class="literal">gzip1</code>, the lowest
		    level of compression, to <code class="literal">gzip9</code>,
		    the highest level of compression.  This gives the
		    administrator control over how much
		    <acronym class="acronym">CPU</acronym> time to trade for saved
		    disk space.</p></li><li class="listitem"><p><a id="zfs-term-compression-zle"></a><span class="emphasis"><em><acronym class="acronym">ZLE</acronym></em></span> -
		    Zero Length Encoding is a special compression
		    algorithm that only compresses continuous runs of
		    zeros.  This compression algorithm is only useful
		    when the dataset contains large blocks of
		    zeros.</p></li></ul></div></td></tr><tr><td valign="top"><a id="zfs-term-copies"></a>Copies</td><td valign="top">When set to a value greater than 1, the
	      <code class="literal">copies</code> property instructs
	      <acronym class="acronym">ZFS</acronym> to maintain multiple copies of
	      each block in the
	      <a class="link" href="#zfs-term-filesystem">File System</a>
	      or
	      <a class="link" href="#zfs-term-volume">Volume</a>.  Setting
	      this property on important datasets provides additional
	      redundancy from which to recover a block that does not
	      match its checksum.  In pools without redundancy, the
	      copies feature is the only form of redundancy.  The
	      copies feature can recover from a single bad sector or
	      other forms of minor corruption, but it does not protect
	      the pool from the loss of an entire disk.</td></tr><tr><td valign="top"><a id="zfs-term-deduplication"></a>Deduplication</td><td valign="top">Checksums make it possible to detect duplicate
	      blocks of data as they are written.  With deduplication,
	      the reference count of an existing, identical block is
	      increased, saving storage space.  To detect duplicate
	      blocks, a deduplication table (<acronym class="acronym">DDT</acronym>)
	      is kept in memory.  The table contains a list of unique
	      checksums, the location of those blocks, and a reference
	      count.  When new data is written, the checksum is
	      calculated and compared to the list.  If a match is
	      found, the existing block is used.  The
	      <acronym class="acronym">SHA256</acronym> checksum algorithm is used
	      with deduplication to provide a secure cryptographic
	      hash.  Deduplication is tunable.  If
	      <code class="literal">dedup</code> is <code class="literal">on</code>, then
	      a matching checksum is assumed to mean that the data is
	      identical.  If <code class="literal">dedup</code> is set to
	      <code class="literal">verify</code>, then the data in the two
	      blocks will be checked byte-for-byte to ensure it is
	      actually identical.  If the data is not identical, the
	      hash collision will be noted and the two blocks will be
	      stored separately.  Because <acronym class="acronym">DDT</acronym> must
	      store the hash of each unique block, it consumes a very
	      large amount of memory.  A general rule of thumb is
	      5-6 GB of ram per 1 TB of deduplicated data).
	      In situations where it is not practical to have enough
	      <acronym class="acronym">RAM</acronym> to keep the entire
	      <acronym class="acronym">DDT</acronym> in memory, performance will
	      suffer greatly as the <acronym class="acronym">DDT</acronym> must be
	      read from disk before each new block is written.
	      Deduplication can use <acronym class="acronym">L2ARC</acronym> to store
	      the <acronym class="acronym">DDT</acronym>, providing a middle ground
	      between fast system memory and slower disks.  Consider
	      using compression instead, which often provides nearly
	      as much space savings without the additional memory
	      requirement.</td></tr><tr><td valign="top"><a id="zfs-term-scrub"></a>Scrub</td><td valign="top">Instead of a consistency check like <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>,
	      <acronym class="acronym">ZFS</acronym> has <code class="command">scrub</code>.
	      <code class="command">scrub</code> reads all data blocks stored on
	      the pool and verifies their checksums against the known
	      good checksums stored in the metadata.  A periodic check
	      of all the data stored on the pool ensures the recovery
	      of any corrupted blocks before they are needed.  A scrub
	      is not required after an unclean shutdown, but is
	      recommended at least once every three months.  The
	      checksum of each block is verified as blocks are read
	      during normal use, but a scrub makes certain that even
	      infrequently used blocks are checked for silent
	      corruption.  Data security is improved, especially in
	      archival storage situations.  The relative priority of
	      <code class="command">scrub</code> can be adjusted with <a class="link" href="#zfs-advanced-tuning-scrub_delay"><code class="varname">vfs.zfs.scrub_delay</code></a>
	      to prevent the scrub from degrading the performance of
	      other workloads on the pool.</td></tr><tr><td valign="top"><a id="zfs-term-quota"></a>Dataset Quota</td><td valign="top"><acronym class="acronym">ZFS</acronym> provides very fast and
	      accurate dataset, user, and group space accounting in
	      addition to quotas and space reservations.  This gives
	      the administrator fine grained control over how space is
	      allocated and allows space to be reserved for critical
	      file systems.

	      <p><acronym class="acronym">ZFS</acronym> supports different types of
		quotas: the dataset quota, the <a class="link" href="#zfs-term-refquota">reference
		  quota (<acronym class="acronym">refquota</acronym>)</a>, the
		<a class="link" href="#zfs-term-userquota">user
		  quota</a>, and the
		<a class="link" href="#zfs-term-groupquota">group
		  quota</a>.</p>

	      <p>Quotas limit the amount of space that a dataset
		and all of its descendants, including snapshots of the
		dataset, child datasets, and the snapshots of those
		datasets, can consume.</p>

	      <div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Quotas cannot be set on volumes, as the
		  <code class="literal">volsize</code> property acts as an
		  implicit quota.</p></div></td></tr><tr><td valign="top"><a id="zfs-term-refquota"></a>Reference
	      Quota</td><td valign="top">A reference quota limits the amount of space a
	      dataset can consume by enforcing a hard limit.  However,
	      this hard limit includes only space that the dataset
	      references and does not include space used by
	      descendants, such as file systems or snapshots.</td></tr><tr><td valign="top"><a id="zfs-term-userquota"></a>User
	      Quota</td><td valign="top">User quotas are useful to limit the amount of space
	      that can be used by the specified user.</td></tr><tr><td valign="top"><a id="zfs-term-groupquota"></a>Group
	      Quota</td><td valign="top">The group quota limits the amount of space that a
	      specified group can consume.</td></tr><tr><td valign="top"><a id="zfs-term-reservation"></a>Dataset
	      Reservation</td><td valign="top">The <code class="literal">reservation</code> property makes
	      it possible to guarantee a minimum amount of space for a
	      specific dataset and its descendants.  If a 10 GB
	      reservation is set on
	      <code class="filename">storage/home/bob</code>, and another
	      dataset tries to use all of the free space, at least
	      10 GB of space is reserved for this dataset.  If a
	      snapshot is taken of
	      <code class="filename">storage/home/bob</code>, the space used by
	      that snapshot is counted against the reservation.  The
	      <a class="link" href="#zfs-term-refreservation"><code class="literal">refreservation</code></a>
	      property works in a similar way, but it
	      <span class="emphasis"><em>excludes</em></span> descendants like
	      snapshots.

	      <p>Reservations of any sort are useful in many
		situations, such as planning and testing the
		suitability of disk space allocation in a new system,
		or ensuring that enough space is available on file
		systems for audio logs or system recovery procedures
		and files.</p>
	    </td></tr><tr><td valign="top"><a id="zfs-term-refreservation"></a>Reference
	      Reservation</td><td valign="top">The <code class="literal">refreservation</code> property
	      makes it possible to guarantee a minimum amount of
	      space for the use of a specific dataset
	      <span class="emphasis"><em>excluding</em></span> its descendants.  This
	      means that if a 10 GB reservation is set on
	      <code class="filename">storage/home/bob</code>, and another
	      dataset tries to use all of the free space, at least
	      10 GB of space is reserved for this dataset.  In
	      contrast to a regular
	      <a class="link" href="#zfs-term-reservation">reservation</a>,
	      space used by snapshots and descendant datasets is not
	      counted against the reservation.  For example, if a
	      snapshot is taken of
	      <code class="filename">storage/home/bob</code>, enough disk space
	      must exist outside of the
	      <code class="literal">refreservation</code> amount for the
	      operation to succeed.  Descendants of the main data set
	      are not counted in the <code class="literal">refreservation</code>
	      amount and so do not encroach on the space set.</td></tr><tr><td valign="top"><a id="zfs-term-resilver"></a>Resilver</td><td valign="top">When a disk fails and is replaced, the new disk
	      must be filled with the data that was lost.  The process
	      of using the parity information distributed across the
	      remaining drives to calculate and write the missing data
	      to the new drive is called
	      <span class="emphasis"><em>resilvering</em></span>.</td></tr><tr><td valign="top"><a id="zfs-term-online"></a>Online</td><td valign="top">A pool or vdev in the <code class="literal">Online</code>
	      state has all of its member devices connected and fully
	      operational.  Individual devices in the
	      <code class="literal">Online</code> state are functioning
	      normally.</td></tr><tr><td valign="top"><a id="zfs-term-offline"></a>Offline</td><td valign="top">Individual devices can be put in an
	      <code class="literal">Offline</code> state by the administrator if
	      there is sufficient redundancy to avoid putting the pool
	      or vdev into a
	      <a class="link" href="#zfs-term-faulted">Faulted</a> state.
	      An administrator may choose to offline a disk in
	      preparation for replacing it, or to make it easier to
	      identify.</td></tr><tr><td valign="top"><a id="zfs-term-degraded"></a>Degraded</td><td valign="top">A pool or vdev in the <code class="literal">Degraded</code>
	      state has one or more disks that have been disconnected
	      or have failed.  The pool is still usable, but if
	      additional devices fail, the pool could become
	      unrecoverable.  Reconnecting the missing devices or
	      replacing the failed disks will return the pool to an
	      <a class="link" href="#zfs-term-online">Online</a> state
	      after the reconnected or new device has completed the
	      <a class="link" href="#zfs-term-resilver">Resilver</a>
	      process.</td></tr><tr><td valign="top"><a id="zfs-term-faulted"></a>Faulted</td><td valign="top">A pool or vdev in the <code class="literal">Faulted</code>
	      state is no longer operational.  The data on it can no
	      longer be accessed.  A pool or vdev enters the
	      <code class="literal">Faulted</code> state when the number of
	      missing or failed devices exceeds the level of
	      redundancy in the vdev.  If missing devices can be
	      reconnected, the pool will return to a
	      <a class="link" href="#zfs-term-online">Online</a> state.  If
	      there is insufficient redundancy to compensate for the
	      number of failed disks, then the contents of the pool
	      are lost and must be restored from backups.</td></tr></tbody></table></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="filesystems"></a>Chapter 20. Other File Systems</h2></div><div><span class="authorgroup">Written
	by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#filesystems-synopsis">20.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#filesystems-linux">20.2. <span class="trademark">Linux</span>® File Systems</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filesystems-synopsis"></a>20.1. Synopsis</h2></div></div></div><a id="idp63419896" class="indexterm"></a><a id="idp63420408" class="indexterm"></a><p>File systems are an integral part of any operating system.
      They allow users to upload and store files, provide access to
      data, and make hard drives useful.  Different operating systems
      differ in their native file system.  Traditionally, the native
      FreeBSD file system has been the Unix File System
      <acronym class="acronym">UFS</acronym> which has been modernized as
      <acronym class="acronym">UFS2</acronym>.  Since FreeBSD 7.0, the Z File System
      (<acronym class="acronym">ZFS</acronym>) is also available as a native file
      system.  See <a class="xref" href="#zfs" title="Chapter 19. The Z File System (ZFS)">Chapter 19, <em>The Z File System (<acronym class="acronym">ZFS</acronym>)</em></a> for more information.</p><p>In addition to its native file systems, FreeBSD supports a
      multitude of other file systems so that data from other
      operating systems can be accessed locally, such as data stored
      on locally attached <acronym class="acronym">USB</acronym> storage devices,
      flash drives, and hard disks.  This includes support for the
      <span class="trademark">Linux</span>® Extended File System (<acronym class="acronym">EXT</acronym>).</p><p>There are different levels of FreeBSD support for the various
      file systems.  Some require a kernel module to be loaded and
      others may require a toolset to be installed.  Some non-native
      file system support is full read-write while others are
      read-only.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The difference between native and supported file
	  systems.</p></li><li class="listitem"><p>Which file systems are supported by FreeBSD.</p></li><li class="listitem"><p>How to enable, configure, access, and make use of
	  non-native file systems.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand <span class="trademark">UNIX</span>® and
	  <a class="link" href="#basics" title="Chapter 3. FreeBSD Basics">FreeBSD basics</a>.</p></li><li class="listitem"><p>Be familiar with the basics of <a class="link" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">kernel configuration and
	    compilation</a>.</p></li><li class="listitem"><p>Feel comfortable <a class="link" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">installing
	    software</a> in FreeBSD.</p></li><li class="listitem"><p>Have some familiarity with <a class="link" href="#disks" title="Chapter 17. Storage">disks</a>, storage, and device names in
	  FreeBSD.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filesystems-linux"></a>20.2. <span class="trademark">Linux</span>® File Systems</h2></div></div></div><p>FreeBSD provides built-in support for several <span class="trademark">Linux</span>® file
      systems.  This section demonstrates how to load support for and
      how to mount the supported <span class="trademark">Linux</span>® file systems.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63445880"></a>20.2.1. <acronym class="acronym">ext2</acronym></h3></div></div></div><p>Kernel support for ext2 file systems has
	been available since FreeBSD 2.2.  In FreeBSD 8.x and
	earlier, the code is licensed under the
	<acronym class="acronym">GPL</acronym>.  Since FreeBSD 9.0, the code has
	been rewritten and is now <acronym class="acronym">BSD</acronym>
	licensed.</p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ext2fs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ext2fs</span>(5)</span></a> driver allows the FreeBSD kernel to both
	read and write to ext2 file systems.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">This driver can also be used to access ext3 and ext4
	  file systems.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ext2fs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ext2fs</span>(5)</span></a> filesystem has full read
	  and write support for ext4 as of FreeBSD 12.0-RELEASE.
	  Additionally, extended attributes and ACLs are also
	  supported, while journalling and encryption are not.
	  Starting with FreeBSD 12.1-RELEASE, a DTrace provider will
	  be available as well.  Prior versions of FreeBSD can access
	  ext4 in read and write mode using
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/fusefs-ext2/pkg-descr">sysutils/fusefs-ext2</a>.</p></div><p>To access an ext file system, first
	load the kernel loadable module:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload ext2fs</code></strong></pre><p>Then, mount the ext volume by specifying its FreeBSD
	partition name and an existing mount point.  This example
	mounts <code class="filename">/dev/ad1s1</code> on
	<code class="filename">/mnt</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t ext2fs <em class="replaceable"><code>/dev/ad1s1</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization"></a>Chapter 21. Virtualization</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div><div><span class="authorgroup">bhyve section by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>. </span></div><div><span class="authorgroup">Xen section by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Benedict</span> <span class="surname">Reuschling</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#virtualization-synopsis">21.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-parallels">21.2. FreeBSD as a Guest on <span class="application">Parallels</span> for
      <span class="trademark">Mac OS</span>® X</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-virtualpc">21.3. FreeBSD as a Guest on <span class="application">Virtual PC</span>
      for <span class="trademark">Windows</span>®</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-vmware">21.4. FreeBSD as a Guest on <span class="application">VMware Fusion</span>
      for <span class="trademark">Mac OS</span>®</a></span></dt><dt><span class="sect1"><a href="#virtualization-guest-virtualbox">21.5. FreeBSD as a Guest on <span class="trademark">VirtualBox</span>&#8482;</a></span></dt><dt><span class="sect1"><a href="#virtualization-host-virtualbox">21.6. FreeBSD as a Host with <span class="trademark">VirtualBox</span>&#8482;</a></span></dt><dt><span class="sect1"><a href="#virtualization-host-bhyve">21.7. FreeBSD as a Host with
      <span class="application">bhyve</span></a></span></dt><dt><span class="sect1"><a href="#virtualization-host-xen">21.8. FreeBSD as a <span class="trademark">Xen</span>&#8482;-Host</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-synopsis"></a>21.1. Synopsis</h2></div></div></div><p>Virtualization software allows multiple operating systems to
      run simultaneously on the same computer.  Such software systems
      for <acronym class="acronym">PC</acronym>s often involve a host operating system
      which runs the virtualization software and supports any number
      of guest operating systems.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The difference between a host operating system and a
	  guest operating system.</p></li><li class="listitem"><p>How to install FreeBSD on an <span class="trademark">Intel</span>®-based <span class="trademark">Apple</span>®
	  <span class="trademark">Mac</span>® computer.</p></li><li class="listitem"><p>How to install FreeBSD on <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® with
	  <span class="application">Virtual PC</span>.</p></li><li class="listitem"><p>How to install FreeBSD as a guest in
	  <span class="application">bhyve</span>.</p></li><li class="listitem"><p>How to tune a FreeBSD system for best performance under
	  virtualization.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand the <a class="link" href="#basics" title="Chapter 3. FreeBSD Basics">basics of <span class="trademark">UNIX</span>®
	    and FreeBSD</a>.</p></li><li class="listitem"><p>Know how to <a class="link" href="#bsdinstall" title="Chapter 2. Installing FreeBSD">install
	    FreeBSD</a>.</p></li><li class="listitem"><p>Know how to <a class="link" href="#advanced-networking" title="Chapter 31. Advanced Networking">set up a
	    network connection</a>.</p></li><li class="listitem"><p>Know how to <a class="link" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">install additional
	    third-party software</a>.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-guest-parallels"></a>21.2. FreeBSD as a Guest on <span class="application">Parallels</span> for
      <span class="trademark">Mac OS</span>® X</h2></div></div></div><p><span class="application">Parallels Desktop</span> for <span class="trademark">Mac</span>® is
      a commercial software product available for <span class="trademark">Intel</span>® based
      <span class="trademark">Apple</span>® <span class="trademark">Mac</span>® computers running <span class="trademark">Mac OS</span>® 10.4.6 or higher.  FreeBSD
      is a fully supported guest operating system.  Once
      <span class="application">Parallels</span> has been installed on
      <span class="trademark">Mac OS</span>® X, the user must configure a virtual machine and then
      install the desired guest operating system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-parallels-install"></a>21.2.1. Installing FreeBSD on Parallels/<span class="trademark">Mac OS</span>® X</h3></div></div></div><p>The first step in installing FreeBSD on
	<span class="application">Parallels</span> is to create a new
	virtual machine for installing FreeBSD.  Select
	<span class="guimenuitem">FreeBSD</span> as the
	<span class="guimenu">Guest OS Type</span> when prompted:</p><div class="mediaobject"><img src="virtualization/parallels-freebsd1.png" /></div><p>Choose a reasonable amount of disk and memory
	depending on the plans for this virtual FreeBSD instance.
	4GB of disk space and 512MB of RAM work well for most uses
	of FreeBSD under <span class="application">Parallels</span>:</p><div class="mediaobject"><img src="virtualization/parallels-freebsd2.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd3.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd4.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd5.png" /></div><p>Select the type of networking and a network
	interface:</p><div class="mediaobject"><img src="virtualization/parallels-freebsd6.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd7.png" /></div><p>Save and finish the configuration:</p><div class="mediaobject"><img src="virtualization/parallels-freebsd8.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd9.png" /></div><p>After the FreeBSD virtual machine has been created, FreeBSD
	can be installed on it.  This is best done with an official
	FreeBSD <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> or with an
	<acronym class="acronym">ISO</acronym> image downloaded from an official
	<acronym class="acronym">FTP</acronym> site.  Copy the appropriate
	<acronym class="acronym">ISO</acronym> image to the local <span class="trademark">Mac</span>® filesystem or
	insert a <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> in the
	<span class="trademark">Mac</span>®'s <acronym class="acronym">CD-ROM</acronym> drive.  Click on the disc
	icon in the bottom right corner of the FreeBSD
	<span class="application">Parallels</span> window.  This will bring
	up a window that can be used to associate the
	<acronym class="acronym">CD-ROM</acronym> drive in the virtual machine with
	the <acronym class="acronym">ISO</acronym> file on disk or with the real
	<acronym class="acronym">CD-ROM</acronym> drive.</p><div class="mediaobject"><img src="virtualization/parallels-freebsd11.png" /></div><p>Once this association with the <acronym class="acronym">CD-ROM</acronym>
	source has been made, reboot the FreeBSD virtual machine by
	clicking the reboot icon.
	<span class="application">Parallels</span> will reboot with a
	special <acronym class="acronym">BIOS</acronym> that first checks if there is
	a <acronym class="acronym">CD-ROM</acronym>.</p><div class="mediaobject"><img src="virtualization/parallels-freebsd10.png" /></div><p>In this case it will find the FreeBSD installation media and
	begin a normal FreeBSD installation.  Perform the installation,
	but do not attempt to configure
	<span class="application">Xorg</span> at this time.</p><div class="mediaobject"><img src="virtualization/parallels-freebsd12.png" /></div><p>When the installation is finished, reboot into the newly
	installed FreeBSD virtual machine.</p><div class="mediaobject"><img src="virtualization/parallels-freebsd13.png" /></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-parallels-configure"></a>21.2.2. Configuring FreeBSD on
	<span class="application">Parallels</span></h3></div></div></div><p>After FreeBSD has been successfully installed on <span class="trademark">Mac OS</span>® X
	with <span class="application">Parallels</span>, there are a number
	of configuration steps that can be taken to optimize the
	system for virtualized operation.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Set Boot Loader Variables</strong></p><p>The most important step is to reduce the
	    <code class="option">kern.hz</code> tunable to reduce the CPU
	    utilization of FreeBSD under the
	    <span class="application">Parallels</span> environment.  This is
	    accomplished by adding the following line to
	    <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">kern.hz=100</pre><p>Without this setting, an idle FreeBSD
	    <span class="application">Parallels</span> guest will use
	    roughly 15% of the CPU of a single processor <span class="trademark">iMac</span>®.
	    After this change the usage will be closer to 5%.</p></li><li class="step"><p class="title"><strong>Create a New Kernel Configuration File</strong></p><p>All of the SCSI, FireWire, and USB device drivers
	    can be removed from a custom kernel configuration file.
	    <span class="application">Parallels</span> provides a virtual
	    network adapter used by the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ed&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ed</span>(4)</span></a> driver, so all
	    network devices except for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ed&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ed</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=miibus&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">miibus</span>(4)</span></a>
	    can be removed from the kernel.</p></li><li class="step"><p class="title"><strong>Configure Networking</strong></p><p>The most basic networking setup uses DHCP to connect
	    the virtual machine to the same local area network as the
	    host <span class="trademark">Mac</span>®.  This can be accomplished by adding
	    <code class="literal">ifconfig_ed0="DHCP"</code> to
	    <code class="filename">/etc/rc.conf</code>.  More advanced
	    networking setups are described in
	    <a class="xref" href="#advanced-networking" title="Chapter 31. Advanced Networking">Chapter 31, <em>Advanced Networking</em></a>.</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-guest-virtualpc"></a>21.3. FreeBSD as a Guest on <span class="application">Virtual PC</span>
      for <span class="trademark">Windows</span>®</h2></div></div></div><p><span class="application">Virtual PC</span> for <span class="trademark">Windows</span>® is a
      <span class="trademark">Microsoft</span>® software product available for free download.  See
      this website for the <a class="link" href="http://www.microsoft.com/windows/downloads/virtualpc/sysreq.mspx" target="_top">system
	requirements</a>.  Once
      <span class="application">Virtual PC</span> has been installed on
      <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>®, the user can configure a virtual machine
      and then install the desired guest operating system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-virtualpc-install"></a>21.3.1. Installing FreeBSD on
	<span class="application">Virtual PC</span></h3></div></div></div><p>The first step in installing FreeBSD on
	<span class="application">Virtual PC</span> is to create a new
	virtual machine for installing FreeBSD.  Select
	<span class="guimenuitem">Create a virtual machine</span> when
	prompted:</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd1.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd2.png" /></div><p>Select <span class="guimenuitem">Other</span> as the
	<span class="guimenuitem">Operating system</span> when
	prompted:</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd3.png" /></div><p>Then, choose a reasonable amount of disk and memory
	depending on the plans for this virtual FreeBSD instance.
	4GB of disk space and 512MB of RAM work well for most uses
	of FreeBSD under <span class="application">Virtual PC</span>:</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd4.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd5.png" /></div><p>Save and finish the configuration:</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd6.png" /></div><p>Select the FreeBSD virtual machine and click
	<span class="guimenu">Settings</span>, then set the type of networking
	and a network interface:</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd7.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd8.png" /></div><p>After the FreeBSD virtual machine has been created, FreeBSD can
	be installed on it.  This is best done with an official FreeBSD
	<acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> or with an
	<acronym class="acronym">ISO</acronym> image downloaded from an official
	<acronym class="acronym">FTP</acronym> site.  Copy the appropriate
	<acronym class="acronym">ISO</acronym> image to the local <span class="trademark">Windows</span>® filesystem
	or insert a <acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> in
	the <acronym class="acronym">CD</acronym> drive, then double click on the FreeBSD
	virtual machine to boot.  Then, click <span class="guimenu">CD</span>
	and choose <span class="guimenu">Capture ISO Image...</span> on the
	<span class="application">Virtual PC</span> window.  This will bring
	up a window where the <acronym class="acronym">CD-ROM</acronym> drive in the
	virtual machine can be associated with an
	<acronym class="acronym">ISO</acronym> file on disk or with the real
	<acronym class="acronym">CD-ROM</acronym> drive.</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd9.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd10.png" /></div><p>Once this association with the <acronym class="acronym">CD-ROM</acronym>
	source has been made, reboot the FreeBSD virtual machine by
	clicking <span class="guimenu">Action</span> and
	<span class="guimenu">Reset</span>.
	<span class="application">Virtual PC</span> will reboot with a
	special <acronym class="acronym">BIOS</acronym> that first checks for a
	<acronym class="acronym">CD-ROM</acronym>.</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd11.png" /></div><p>In this case it will find the FreeBSD installation media
	and begin a normal FreeBSD installation.  Continue with the
	installation, but do not attempt to configure
	<span class="application">Xorg</span> at this time.</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd12.png" /></div><p>When the installation is finished, remember to eject the
	<acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> or release the
	<acronym class="acronym">ISO</acronym> image.  Finally, reboot into the newly
	installed FreeBSD virtual machine.</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd13.png" /></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-virtualpc-configure"></a>21.3.2. Configuring FreeBSD on <span class="application">Virtual
	  PC</span></h3></div></div></div><p>After FreeBSD has been successfully installed on
	<span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® with
	<span class="application">Virtual PC</span>, there are a number of
	configuration steps that can be taken to optimize the system
	for virtualized operation.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Set Boot Loader Variables</strong></p><p>The most important step is to reduce the
	    <code class="option">kern.hz</code> tunable to reduce the CPU
	    utilization of FreeBSD under the
	    <span class="application">Virtual PC</span> environment.  This
	    is accomplished by adding the following line to
	    <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">kern.hz=100</pre><p>Without this setting, an idle FreeBSD
	    <span class="application">Virtual PC</span> guest OS will
	    use roughly 40% of the CPU of a single processor
	    computer.  After this change, the usage will be
	    closer to 3%.</p></li><li class="step"><p class="title"><strong>Create a New Kernel Configuration File</strong></p><p>All of the SCSI, FireWire, and USB device drivers can
	    be removed from a custom kernel configuration file.
	    <span class="application">Virtual PC</span> provides a virtual
	    network adapter used by the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=de&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">de</span>(4)</span></a> driver, so all
	    network devices except for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=de&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">de</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=miibus&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">miibus</span>(4)</span></a>
	    can be removed from the kernel.</p></li><li class="step"><p class="title"><strong>Configure Networking</strong></p><p>The most basic networking setup uses DHCP to connect
	    the virtual machine to the same local area network as the
	    <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® host.  This can be accomplished by
	    adding <code class="literal">ifconfig_de0="DHCP"</code> to
	    <code class="filename">/etc/rc.conf</code>.  More advanced
	    networking setups are described in
	    <a class="xref" href="#advanced-networking" title="Chapter 31. Advanced Networking">Chapter 31, <em>Advanced Networking</em></a>.</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-guest-vmware"></a>21.4. FreeBSD as a Guest on <span class="application">VMware Fusion</span>
      for <span class="trademark">Mac OS</span>®</h2></div></div></div><p><span class="application">VMware Fusion</span> for <span class="trademark">Mac</span>® is a
      commercial software product available for <span class="trademark">Intel</span>® based <span class="trademark">Apple</span>®
      <span class="trademark">Mac</span>® computers running <span class="trademark">Mac OS</span>® 10.4.9 or higher.  FreeBSD is a
      fully supported guest operating system.  Once
      <span class="application">VMware Fusion</span> has been installed on
      <span class="trademark">Mac OS</span>® X, the user can configure a virtual machine and then
      install the desired guest operating system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-vmware-install"></a>21.4.1. Installing FreeBSD on
	<span class="application">VMware Fusion</span></h3></div></div></div><p>The first step is to start
	<span class="application">VMware Fusion</span> which will load the
	Virtual Machine Library.  Click <span class="guimenuitem">New</span>
	to create the virtual machine:</p><div class="mediaobject"><img src="virtualization/vmware-freebsd01.png" /></div><p>This will load the New Virtual Machine Assistant.  Click
	<span class="guimenuitem">Continue</span> to proceed:</p><div class="mediaobject"><img src="virtualization/vmware-freebsd02.png" /></div><p>Select <span class="guimenuitem">Other</span> as the
	<span class="guimenuitem">Operating System</span> and either
	<span class="guimenuitem">FreeBSD</span> or
	<span class="guimenuitem">FreeBSD 64-bit</span>, as the
	<span class="guimenu">Version</span> when prompted:</p><div class="mediaobject"><img src="virtualization/vmware-freebsd03.png" /></div><p>Choose the name of the virtual machine and the directory
	where it should be saved:</p><div class="mediaobject"><img src="virtualization/vmware-freebsd04.png" /></div><p>Choose the size of the Virtual Hard Disk for the virtual
	machine:</p><div class="mediaobject"><img src="virtualization/vmware-freebsd05.png" /></div><p>Choose the method to install the virtual machine, either
	from an <acronym class="acronym">ISO</acronym> image or from a
	<acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym>:</p><div class="mediaobject"><img src="virtualization/vmware-freebsd06.png" /></div><p>Click <span class="guimenuitem">Finish</span> and the virtual
	machine will boot:</p><div class="mediaobject"><img src="virtualization/vmware-freebsd07.png" /></div><p>Install FreeBSD as usual:</p><div class="mediaobject"><img src="virtualization/vmware-freebsd08.png" /></div><p>Once the install is complete, the settings of the virtual
	machine can be modified, such as memory usage:</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The System Hardware settings of the virtual machine
	  cannot be modified while the virtual machine is
	  running.</p></div><div class="mediaobject"><img src="virtualization/vmware-freebsd09.png" /></div><p>The number of CPUs the virtual machine will have access
	to:</p><div class="mediaobject"><img src="virtualization/vmware-freebsd10.png" /></div><p>The status of the <acronym class="acronym">CD-ROM</acronym> device.
	Normally the
	<acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym>/<acronym class="acronym">ISO</acronym>
	is disconnected from the virtual machine when it is no longer
	needed.</p><div class="mediaobject"><img src="virtualization/vmware-freebsd11.png" /></div><p>The last thing to change is how the virtual machine will
	connect to the network.  To allow connections to the virtual
	machine from other machines besides the host, choose
	<span class="guimenuitem">Connect directly to the physical network
	  (Bridged)</span>.  Otherwise,
	<span class="guimenuitem">Share the host's internet connection
	  (NAT)</span> is preferred so that the virtual machine
	can have access to the Internet, but the network cannot access
	the virtual machine.</p><div class="mediaobject"><img src="virtualization/vmware-freebsd12.png" /></div><p>After modifying the settings, boot the newly installed
	FreeBSD virtual machine.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-vmware-configure"></a>21.4.2. Configuring FreeBSD on <span class="application">VMware
	  Fusion</span></h3></div></div></div><p>After FreeBSD has been successfully installed on <span class="trademark">Mac OS</span>® X
	with <span class="application">VMware Fusion</span>, there are a
	number of configuration steps that can be taken to optimize
	the system for virtualized operation.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Set Boot Loader Variables</strong></p><p>The most important step is to reduce the
	    <code class="option">kern.hz</code> tunable to reduce the CPU
	    utilization of FreeBSD under the
	    <span class="application">VMware Fusion</span> environment.
	    This is accomplished by adding the following line to
	    <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">kern.hz=100</pre><p>Without this setting, an idle FreeBSD
	    <span class="application">VMware Fusion</span> guest will use
	    roughly 15% of the CPU of a single processor <span class="trademark">iMac</span>®.
	    After this change, the usage will be closer to 5%.</p></li><li class="step"><p class="title"><strong>Create a New Kernel Configuration File</strong></p><p>All of the FireWire, and USB device drivers can be
	    removed from a custom kernel configuration file.
	    <span class="application">VMware Fusion</span> provides a
	    virtual network adapter used by the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=em&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">em</span>(4)</span></a> driver, so
	    all network devices except for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=em&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">em</span>(4)</span></a> can be removed
	    from the kernel.</p></li><li class="step"><p class="title"><strong>Configure Networking</strong></p><p>The most basic networking setup uses DHCP to connect
	    the virtual machine to the same local area network as the
	    host <span class="trademark">Mac</span>®.  This can be accomplished by adding
	    <code class="literal">ifconfig_em0="DHCP"</code> to
	    <code class="filename">/etc/rc.conf</code>.  More advanced
	    networking setups are described in
	    <a class="xref" href="#advanced-networking" title="Chapter 31. Advanced Networking">Chapter 31, <em>Advanced Networking</em></a>.</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-guest-virtualbox"></a>21.5. FreeBSD as a Guest on <span class="trademark">VirtualBox</span>&#8482;</h2></div></div></div><p>FreeBSD works well as a guest in
      <span class="application"><span class="trademark">VirtualBox</span>&#8482;</span>.  The virtualization
      software is available for most common operating systems,
      including FreeBSD itself.</p><p>The <span class="application"><span class="trademark">VirtualBox</span>&#8482;</span> guest additions
      provide support for:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Clipboard sharing.</p></li><li class="listitem"><p>Mouse pointer integration.</p></li><li class="listitem"><p>Host time synchronization.</p></li><li class="listitem"><p>Window scaling.</p></li><li class="listitem"><p>Seamless mode.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">These commands are run in the FreeBSD guest.</p></div><p>First, install the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/virtualbox-ose-additions/pkg-descr">emulators/virtualbox-ose-additions</a> package
      or port in the FreeBSD guest.  This will install the port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/emulators/virtualbox-ose-additions &amp;&amp; make install clean</code></strong></pre><p>Add these lines to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">vboxguest_enable="YES"
vboxservice_enable="YES"</pre><p>If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> is used, disable host
      time synchronization:</p><pre class="programlisting">vboxservice_flags="--disable-timesync"</pre><p><span class="application">Xorg</span> will automatically recognize
      the <code class="literal">vboxvideo</code> driver.  It can also be
      manually entered in
      <code class="filename">/etc/X11/xorg.conf</code>:</p><pre class="programlisting">Section "Device"
	Identifier "Card0"
	Driver "vboxvideo"
	VendorName "InnoTek Systemberatung GmbH"
	BoardName "VirtualBox Graphics Adapter"
EndSection</pre><p>To use the <code class="literal">vboxmouse</code> driver, adjust the
      mouse section in <code class="filename">/etc/X11/xorg.conf</code>:</p><pre class="programlisting">Section "InputDevice"
	Identifier "Mouse0"
	Driver "vboxmouse"
EndSection</pre><p><acronym class="acronym">HAL</acronym> users should create the following
      <code class="filename">/usr/local/etc/hal/fdi/policy/90-vboxguest.fdi</code>
      or copy it from
      <code class="filename">/usr/local/share/hal/fdi/policy/10osvendor/90-vboxguest.fdi</code>:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!--
# Sun VirtualBox
# Hal driver description for the vboxmouse driver
# $Id: chapter.xml,v 1.33 2012-03-17 04:53:52 eadler Exp $

	Copyright (C) 2008-2009 Sun Microsystems, Inc.

	This file is part of VirtualBox Open Source Edition (OSE, as
	available from http://www.virtualbox.org. This file is free software;
	you can redistribute it and/or modify it under the terms of the GNU
	General Public License (GPL) as published by the Free Software
	Foundation, in version 2 as it comes in the "COPYING" file of the
	VirtualBox OSE distribution. VirtualBox OSE is distributed in the
	hope that it will be useful, but WITHOUT ANY WARRANTY of any kind.

	Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa
	Clara, CA 95054 USA or visit http://www.sun.com if you need
	additional information or have any questions.
--&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.subsystem" string="pci"&gt;
      &lt;match key="info.product" string="VirtualBox guest Service"&gt;
        &lt;append key="info.capabilities" type="strlist"&gt;input&lt;/append&gt;
	&lt;append key="info.capabilities" type="strlist"&gt;input.mouse&lt;/append&gt;
        &lt;merge key="input.x11_driver" type="string"&gt;vboxmouse&lt;/merge&gt;
	&lt;merge key="input.device" type="string"&gt;/dev/vboxguest&lt;/merge&gt;
      &lt;/match&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</pre><p>Shared folders for file transfers between host and VM are
      accessible by mounting them using
      <code class="literal">mount_vboxvfs</code>.  A shared folder can be created
      on the host using the VirtualBox GUI or via
      <code class="command">vboxmanage</code>.  For example, to create a shared
      folder called <em class="replaceable"><code>myshare</code></em> under
      <code class="filename"><em class="replaceable"><code>/mnt/bsdboxshare</code></em></code>
      for the VM named <em class="replaceable"><code>BSDBox</code></em>, run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>vboxmanage sharedfolder add '<em class="replaceable"><code>BSDBox</code></em>' --name <em class="replaceable"><code>myshare</code></em> --hostpath <em class="replaceable"><code>/mnt/bsdboxshare</code></em></code></strong></pre><p>Note that the shared folder name must not contain spaces.
      Mount the shared folder from within the guest system like
      this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount_vboxvfs -w <em class="replaceable"><code>myshare</code></em> <em class="replaceable"><code>/mnt</code></em></code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-host-virtualbox"></a>21.6. FreeBSD as a Host with <span class="trademark">VirtualBox</span>&#8482;</h2></div></div></div><p><span class="application"><span class="trademark">VirtualBox</span>&#8482;</span> is an actively
      developed, complete virtualization package, that is available
      for most operating systems including <span class="trademark">Windows</span>®, <span class="trademark">Mac OS</span>®, <span class="trademark">Linux</span>®
      and FreeBSD.  It is equally capable of running <span class="trademark">Windows</span>® or
      <span class="trademark">UNIX</span>®-like guests.  It is released as open source software, but
      with closed-source components available in a separate extension
      pack.  These components include support for USB 2.0 devices.
      More information may be found on the <a class="link" href="http://www.virtualbox.org/wiki/Downloads" target="_top"><span class="quote">&#8220;<span class="quote">Downloads</span>&#8221;</span>
	page of the <span class="application"><span class="trademark">VirtualBox</span>&#8482;</span>
	wiki</a>.  Currently, these extensions are not available
      for FreeBSD.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-virtualbox-install"></a>21.6.1. Installing <span class="trademark">VirtualBox</span>&#8482;</h3></div></div></div><p><span class="application"><span class="trademark">VirtualBox</span>&#8482;</span> is available as a
	FreeBSD package or port in
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/virtualbox-ose/pkg-descr">emulators/virtualbox-ose</a>.  The port can be
	installed using these commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/emulators/virtualbox-ose</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>One useful option in the port's configuration menu is the
	<code class="literal">GuestAdditions</code> suite of programs.  These
	provide a number of useful features in guest operating
	systems, like mouse pointer integration (allowing the mouse to
	be shared between host and guest without the need to press a
	special keyboard shortcut to switch) and faster video
	rendering, especially in <span class="trademark">Windows</span>® guests.  The guest
	additions are available in the <span class="guimenu">Devices</span>
	menu, after the installation of the guest is finished.</p><p>A few configuration changes are needed before
	<span class="application"><span class="trademark">VirtualBox</span>&#8482;</span> is started for the
	first time.  The port installs a kernel module in
	<code class="filename">/boot/modules</code> which
	must be loaded into the running kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload vboxdrv</code></strong></pre><p>To ensure the module is always loaded after a reboot,
	add this line to
	<code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">vboxdrv_load="YES"</pre><p>To use the kernel modules that allow bridged or host-only
	networking, add this line to
	<code class="filename">/etc/rc.conf</code> and reboot the
	computer:</p><pre class="programlisting">vboxnet_enable="YES"</pre><p>The <code class="systemitem">vboxusers</code>
	group is created during installation of
	<span class="application"><span class="trademark">VirtualBox</span>&#8482;</span>.  All users that need
	access to <span class="application"><span class="trademark">VirtualBox</span>&#8482;</span> will have to
	be added as members of this group.  <code class="command">pw</code> can
	be used to add new members:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod vboxusers -m <em class="replaceable"><code>yourusername</code></em></code></strong></pre><p>The default permissions for
	<code class="filename">/dev/vboxnetctl</code> are restrictive and need
	to be changed for bridged networking:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chown root:vboxusers /dev/vboxnetctl</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 0660 /dev/vboxnetctl</code></strong></pre><p>To make this permissions change permanent, add these
	lines to <code class="filename">/etc/devfs.conf</code>:</p><pre class="programlisting">own     vboxnetctl root:vboxusers
perm    vboxnetctl 0660</pre><p>To launch <span class="application"><span class="trademark">VirtualBox</span>&#8482;</span>,
	type from a <span class="application">Xorg</span> session:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>VirtualBox</code></strong></pre><p>For more information on configuring and using
	<span class="application"><span class="trademark">VirtualBox</span>&#8482;</span>, refer to the
	<a class="link" href="http://www.virtualbox.org" target="_top">official
	  website</a>.  For FreeBSD-specific information and
	troubleshooting instructions, refer to the <a class="link" href="http://wiki.FreeBSD.org/VirtualBox" target="_top">relevant
	  page in the FreeBSD wiki</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-virtualbox-usb-support"></a>21.6.2. <span class="trademark">VirtualBox</span>&#8482; USB Support</h3></div></div></div><p><span class="application"><span class="trademark">VirtualBox</span>&#8482;</span> can be configured
	to pass <acronym class="acronym">USB</acronym> devices through to the guest
	operating system.  The host controller of the OSE version is
	limited to emulating <acronym class="acronym">USB</acronym> 1.1 devices until
	the extension pack supporting <acronym class="acronym">USB</acronym> 2.0 and
	3.0 devices becomes available on FreeBSD.</p><p>For <span class="application"><span class="trademark">VirtualBox</span>&#8482;</span> to be aware of
	<acronym class="acronym">USB</acronym> devices attached to the machine, the
	user needs to be a member of the <code class="systemitem">operator</code> group.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod operator -m <em class="replaceable"><code>yourusername</code></em></code></strong></pre><p>Then, add the following to
       <code class="filename">/etc/devfs.rules</code>, or create this file if
       it does not exist yet:</p><pre class="programlisting">[system=10]
add path 'usb/*' mode 0660 group operator</pre><p>To load these new rules, add the following to
       <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">devfs_system_ruleset="system"</pre><p>Then, restart devfs:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service devfs restart</code></strong></pre><p>Restart the login session and
	<span class="application"><span class="trademark">VirtualBox</span>&#8482;</span> for these changes to
	take effect, and create <acronym class="acronym">USB</acronym> filters as
	necessary.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-virtualbox-host-dvd-cd-access"></a>21.6.3. <span class="trademark">VirtualBox</span>&#8482; Host
	<acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> Access</h3></div></div></div><p>Access to the host
	<acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> drives from
	guests is achieved through the sharing of the physical drives.
	Within <span class="trademark">VirtualBox</span>&#8482;, this is set up from the Storage window in
	the Settings of the virtual machine.  If needed, create an
	empty <acronym class="acronym">IDE</acronym>
	<acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> device first.
	Then choose the Host Drive from the popup menu for the virtual
	<acronym class="acronym">CD</acronym>/<acronym class="acronym">DVD</acronym> drive selection.
	A checkbox labeled <code class="literal">Passthrough</code> will appear.
	This allows the virtual machine to use the hardware directly.
	For example, audio <acronym class="acronym">CD</acronym>s or the burner will
	only function if this option is selected.</p><p><acronym class="acronym">HAL</acronym> needs to run for
	<span class="application"><span class="trademark">VirtualBox</span>&#8482;</span>
	<acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> functions to
	work, so enable it in <code class="filename">/etc/rc.conf</code> and
	start it if it is not already running:</p><pre class="programlisting">hald_enable="YES"</pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service hald start</code></strong></pre><p>In order for users to be able to use
	<span class="application"><span class="trademark">VirtualBox</span>&#8482;</span>
	<acronym class="acronym">DVD</acronym>/<acronym class="acronym">CD</acronym> functions, they
	need access to <code class="filename">/dev/xpt0</code>,
	<code class="filename">/dev/cd<em class="replaceable"><code>N</code></em></code>, and
	<code class="filename">/dev/pass<em class="replaceable"><code>N</code></em></code>.
	This is usually achieved by making the user a member of
	<code class="systemitem">operator</code>.
	Permissions to these devices have to be corrected by adding
	these lines to <code class="filename">/etc/devfs.conf</code>:</p><pre class="programlisting">perm cd* 0660
perm xpt0 0660
perm pass* 0660</pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service devfs restart</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-host-bhyve"></a>21.7. FreeBSD as a Host with
      <span class="application">bhyve</span></h2></div></div></div><p>The <span class="application">bhyve</span>
      <acronym class="acronym">BSD</acronym>-licensed hypervisor became part of the
      base system with FreeBSD 10.0-RELEASE.  This hypervisor supports a
      number of guests, including FreeBSD, OpenBSD, and many <span class="trademark">Linux</span>®
      distributions.  By default, <span class="application">bhyve</span>
      provides access to serial console and does not emulate a
      graphical console.  Virtualization offload features of newer
      <acronym class="acronym">CPU</acronym>s are used to avoid the legacy methods of
      translating instructions and manually managing memory
      mappings.</p><p>The <span class="application">bhyve</span> design requires a
      processor that supports <span class="trademark">Intel</span>® Extended Page Tables
      (<acronym class="acronym">EPT</acronym>) or <span class="trademark">AMD</span>® Rapid Virtualization Indexing
      (<acronym class="acronym">RVI</acronym>) or Nested Page Tables
      (<acronym class="acronym">NPT</acronym>).  Hosting <span class="trademark">Linux</span>® guests or FreeBSD guests
      with more than one <acronym class="acronym">vCPU</acronym> requires
      <acronym class="acronym">VMX</acronym> unrestricted mode support
      (<acronym class="acronym">UG</acronym>).  Most newer processors, specifically
      the <span class="trademark">Intel</span>® <span class="trademark">Core</span>&#8482; i3/i5/i7 and <span class="trademark">Intel</span>® <span class="trademark">Xeon</span>&#8482;
      E3/E5/E7, support these features.  <acronym class="acronym">UG</acronym> support
      was introduced with Intel's Westmere micro-architecture.  For a
      complete list of <span class="trademark">Intel</span>® processors that support
      <acronym class="acronym">EPT</acronym>, refer to <a class="link" href="https://ark.intel.com/content/www/us/en/ark/search/featurefilter.html?productType=873&amp;0_ExtendedPageTables=True" target="_top">https://ark.intel.com/content/www/us/en/ark/search/featurefilter.html?productType=873&amp;0_ExtendedPageTables=True</a>.
      <acronym class="acronym">RVI</acronym> is found on the third generation and
      later of the <span class="trademark">AMD Opteron</span>&#8482; (Barcelona) processors.  The easiest
      way to tell if a processor supports
      <span class="application">bhyve</span> is to run
      <code class="command">dmesg</code> or look in
      <code class="filename">/var/run/dmesg.boot</code> for the
      <code class="literal">POPCNT</code> processor feature flag on the
      <code class="literal">Features2</code> line for <span class="trademark">AMD</span>® processors or
      <code class="literal">EPT</code> and <code class="literal">UG</code> on the
      <code class="literal">VT-x</code> line for <span class="trademark">Intel</span>® processors.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-prep"></a>21.7.1. Preparing the Host</h3></div></div></div><p>The first step to creating a virtual machine in
	<span class="application">bhyve</span> is configuring the host
	system.  First, load the <span class="application">bhyve</span>
	kernel module:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload vmm</code></strong></pre><p>Then, create a <code class="filename">tap</code> interface for the
	network device in the virtual machine to attach to.  In order
	for the network device to participate in the network, also
	create a bridge interface containing the
	<code class="filename">tap</code> interface and the physical interface
	as members.  In this example, the physical interface is
	<em class="replaceable"><code>igb0</code></em>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>tap0</code></em> create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.link.tap.up_on_open=1</code></strong>
net.link.tap.up_on_open: 0 -&gt; 1
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>bridge0</code></em> create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>bridge0</code></em> addm <em class="replaceable"><code>igb0</code></em> addm <em class="replaceable"><code>tap0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>bridge0</code></em> up</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-freebsd"></a>21.7.2. Creating a FreeBSD Guest</h3></div></div></div><p>Create a file to use as the virtual disk for the guest
	machine.  Specify the size and name of the virtual
	disk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>truncate -s <em class="replaceable"><code>16G</code></em> <em class="replaceable"><code>guest.img</code></em></code></strong></pre><p>Download an installation image of FreeBSD to install:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fetch <em class="replaceable"><code>ftp://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/10.3/FreeBSD-10.3-RELEASE-amd64-bootonly.iso</code></em></code></strong>
FreeBSD-10.3-RELEASE-amd64-bootonly.iso       100% of  230 MB  570 kBps 06m17s</pre><p>FreeBSD comes with an example script for running a virtual
	machine in <span class="application">bhyve</span>.  The script will
	start the virtual machine and run it in a loop, so it will
	automatically restart if it crashes.  The script takes a
	number of options to control the configuration of the machine:
	<code class="option">-c</code> controls the number of virtual CPUs,
	<code class="option">-m</code> limits the amount of memory available to
	the guest, <code class="option">-t</code> defines which
	<code class="filename">tap</code> device to use, <code class="option">-d</code>
	indicates which disk image to use, <code class="option">-i</code> tells
	<span class="application">bhyve</span> to boot from the
	<acronym class="acronym">CD</acronym> image instead of the disk, and
	<code class="option">-I</code> defines which <acronym class="acronym">CD</acronym> image
	to use.  The last parameter is the name of the virtual
	machine, used to track the running machines.  This example
	starts the virtual machine in installation mode:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /usr/share/examples/bhyve/vmrun.sh -c <em class="replaceable"><code>1</code></em> -m <em class="replaceable"><code>1024M</code></em> -t <em class="replaceable"><code>tap0</code></em> -d <em class="replaceable"><code>guest.img</code></em> -i -I <em class="replaceable"><code>FreeBSD-10.3-RELEASE-amd64-bootonly.iso</code></em> <em class="replaceable"><code>guestname</code></em></code></strong></pre><p>The virtual machine will boot and start the installer.
	After installing a system in the virtual machine, when the
	system asks about dropping in to a shell at the end of the
	installation, choose <span class="guibutton">Yes</span>.</p><p>Reboot the virtual machine.  While rebooting the virtual
	machine causes <span class="application">bhyve</span> to exit, the
	<code class="filename">vmrun.sh</code> script runs
	<code class="command">bhyve</code> in a loop and will automatically
	restart it.  When this happens, choose the reboot option from
	the boot loader menu in order to escape the loop.  Now the
	guest can be started from the virtual disk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /usr/share/examples/bhyve/vmrun.sh -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> -t <em class="replaceable"><code>tap0</code></em> -d <em class="replaceable"><code>guest.img</code></em> <em class="replaceable"><code>guestname</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-linux"></a>21.7.3. Creating a <span class="trademark">Linux</span>® Guest</h3></div></div></div><p>In order to boot operating systems other than FreeBSD, the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/grub2-bhyve/pkg-descr">sysutils/grub2-bhyve</a> port must be first
	installed.</p><p>Next, create a file to use as the virtual disk for the
	guest machine:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>truncate -s <em class="replaceable"><code>16G</code></em> <em class="replaceable"><code>linux.img</code></em></code></strong></pre><p>Starting a virtual machine with
	<span class="application">bhyve</span> is a two step process.  First
	a kernel must be loaded, then the guest can be started.  The
	<span class="trademark">Linux</span>® kernel is loaded with
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/grub2-bhyve/pkg-descr">sysutils/grub2-bhyve</a>.  Create a
	<code class="filename">device.map</code> that
	<span class="application">grub</span> will use to map the virtual
	devices to the files on the host system:</p><pre class="programlisting">(hd0) ./linux.img
(cd0) ./somelinux.iso</pre><p>Use <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/grub2-bhyve/pkg-descr">sysutils/grub2-bhyve</a> to load the
	<span class="trademark">Linux</span>® kernel from the <acronym class="acronym">ISO</acronym> image:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>grub-bhyve -m device.map -r cd0 -M <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong></pre><p>This will start grub.  If the installation
	<acronym class="acronym">CD</acronym> contains a
	<code class="filename">grub.cfg</code>, a menu will be displayed.
	If not, the <code class="literal">vmlinuz</code> and
	<code class="literal">initrd</code> files must be located and loaded
	manually:</p><pre class="screen">grub&gt; <strong class="userinput"><code>ls</code></strong>
(hd0) (cd0) (cd0,msdos1) (host)
grub&gt; <strong class="userinput"><code>ls (cd0)/isolinux</code></strong>
boot.cat boot.msg grub.conf initrd.img isolinux.bin isolinux.cfg memtest
splash.jpg TRANS.TBL vesamenu.c32 vmlinuz
grub&gt; <strong class="userinput"><code>linux (cd0)/isolinux/vmlinuz</code></strong>
grub&gt; <strong class="userinput"><code>initrd (cd0)/isolinux/initrd.img</code></strong>
grub&gt; <strong class="userinput"><code>boot</code></strong></pre><p>Now that the <span class="trademark">Linux</span>® kernel is loaded, the guest can be
	started:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<em class="replaceable"><code>tap0</code></em> -s 3:0,virtio-blk,<em class="replaceable"><code>./linux.img</code></em> \
    -s 4:0,ahci-cd,<em class="replaceable"><code>./somelinux.iso</code></em> -l com1,stdio -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong></pre><p>The system will boot and start the installer.  After
	installing a system in the virtual machine, reboot the virtual
	machine.  This will cause <span class="application">bhyve</span> to
	exit.  The instance of the virtual machine needs to be
	destroyed before it can be started again:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bhyvectl --destroy --vm=<em class="replaceable"><code>linuxguest</code></em></code></strong></pre><p>Now the guest can be started directly from the virtual
	disk.  Load the kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>grub-bhyve -m device.map -r hd0,msdos1 -M <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong>
grub&gt; <strong class="userinput"><code>ls</code></strong>
(hd0) (hd0,msdos2) (hd0,msdos1) (cd0) (cd0,msdos1) (host)
(lvm/VolGroup-lv_swap) (lvm/VolGroup-lv_root)
grub&gt; <strong class="userinput"><code>ls (hd0,msdos1)/</code></strong>
lost+found/ grub/ efi/ System.map-2.6.32-431.el6.x86_64 config-2.6.32-431.el6.x
86_64 symvers-2.6.32-431.el6.x86_64.gz vmlinuz-2.6.32-431.el6.x86_64
initramfs-2.6.32-431.el6.x86_64.img
grub&gt; <strong class="userinput"><code>linux (hd0,msdos1)/vmlinuz-2.6.32-431.el6.x86_64 root=/dev/mapper/VolGroup-lv_root</code></strong>
grub&gt; <strong class="userinput"><code>initrd (hd0,msdos1)/initramfs-2.6.32-431.el6.x86_64.img</code></strong>
grub&gt; <strong class="userinput"><code>boot</code></strong></pre><p>Boot the virtual machine:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<em class="replaceable"><code>tap0</code></em> \
    -s 3:0,virtio-blk,<em class="replaceable"><code>./linux.img</code></em> -l com1,stdio -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong></pre><p><span class="trademark">Linux</span>® will now boot in the virtual machine and
	eventually present you with the login prompt.  Login and use
	the virtual machine.  When you are finished, reboot the
	virtual machine to exit <span class="application">bhyve</span>.
	Destroy the virtual machine instance:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bhyvectl --destroy --vm=<em class="replaceable"><code>linuxguest</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-uefi"></a>21.7.4. Booting <span class="application">bhyve</span> Virtual Machines
	with <acronym class="acronym">UEFI</acronym> Firmware</h3></div></div></div><p>In addition to <span class="application">bhyveload</span> and
	<span class="application">grub-bhyve</span>, the
	<span class="application">bhyve</span> hypervisor can also boot
	virtual machines using the <acronym class="acronym">UEFI</acronym> userspace
	firmware.  This option may support guest operating systems
	that are not supported by the other loaders.</p><p>In order to make use of the <acronym class="acronym">UEFI</acronym>
	support in <span class="application">bhyve</span>, first obtain the
	<acronym class="acronym">UEFI</acronym> firmware images.  This can be done by
	installing <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/bhyve-firmware/pkg-descr">sysutils/bhyve-firmware</a> port or
	package.</p><p>With the firmware in place, add the flags <code class="option">-l
	  bootrom,<em class="replaceable"><code>/path/to/firmware</code></em></code>
	to your <span class="application">bhyve</span> command line.  The
	actual <span class="application">bhyve</span> command may look like
	this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -AHP -s 0:0,hostbridge -s 1:0,lpc \
-s 2:0,virtio-net,<em class="replaceable"><code>tap1</code></em> -s 3:0,virtio-blk,<em class="replaceable"><code>./disk.img</code></em> \
-s 4:0,ahci-cd,<em class="replaceable"><code>./install.iso</code></em> -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> \
-l bootrom,<em class="replaceable"><code>/usr/local/share/uefi-firmware/BHYVE_UEFI.fd</code></em> \
<em class="replaceable"><code>guest</code></em></code></strong></pre><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/bhyve-firmware/pkg-descr">sysutils/bhyve-firmware</a> also contains a
	<acronym class="acronym">CSM</acronym>-enabled firmware, to boot guests with
	no <acronym class="acronym">UEFI</acronym> support in legacy
	<acronym class="acronym">BIOS</acronym> mode:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -AHP -s 0:0,hostbridge -s 1:0,lpc \
-s 2:0,virtio-net,<em class="replaceable"><code>tap1</code></em> -s 3:0,virtio-blk,<em class="replaceable"><code>./disk.img</code></em> \
-s 4:0,ahci-cd,<em class="replaceable"><code>./install.iso</code></em> -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> \
-l bootrom,<em class="replaceable"><code>/usr/local/share/uefi-firmware/BHYVE_UEFI_CSM.fd</code></em> \
<em class="replaceable"><code>guest</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-framebuffer"></a>21.7.5. Graphical <acronym class="acronym">UEFI</acronym> Framebuffer for
	<span class="application">bhyve</span> Guests</h3></div></div></div><p>The <acronym class="acronym">UEFI</acronym> firmware support is
	particularly useful with predominantly graphical guest
	operating systems such as Microsoft <span class="trademark">Windows</span>®.</p><p>Support for the UEFI-GOP framebuffer may also be enabled
	with the <code class="option">-s
	  29,fbuf,tcp=<em class="replaceable"><code>0.0.0.0:5900</code></em></code>
	flags.  The framebuffer resolution may be configured with
	<code class="option">w=<em class="replaceable"><code>800</code></em></code> and
	<code class="option">h=<em class="replaceable"><code>600</code></em></code>, and
	<span class="application">bhyve</span> can be instructed to wait for
	a <acronym class="acronym">VNC</acronym> connection before booting the guest
	by adding <code class="option">wait</code>.  The framebuffer may be
	accessed from the host or over the network via the
	<acronym class="acronym">VNC</acronym> protocol.  Additionally, <code class="option">-s
	  30,xhci,tablet</code> can be added to achieve precise mouse
	cursor synchronization with the host.</p><p>The resulting <span class="application">bhyve</span> command
	would look like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -AHP -s 0:0,hostbridge -s 31:0,lpc \
-s 2:0,virtio-net,<em class="replaceable"><code>tap1</code></em> -s 3:0,virtio-blk,<em class="replaceable"><code>./disk.img</code></em> \
-s 4:0,ahci-cd,<em class="replaceable"><code>./install.iso</code></em> -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> \
-s 29,fbuf,tcp=<em class="replaceable"><code>0.0.0.0:5900</code></em>,w=<em class="replaceable"><code>800</code></em>,h=<em class="replaceable"><code>600</code></em>,wait \
-s 30,xhci,tablet \
-l bootrom,<em class="replaceable"><code>/usr/local/share/uefi-firmware/BHYVE_UEFI.fd</code></em> \
<em class="replaceable"><code>guest</code></em></code></strong></pre><p>Note, in BIOS emulation mode, the framebuffer will cease
	receiving updates once control is passed from firmware to
	guest operating system.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-zfs"></a>21.7.6. Using <acronym class="acronym">ZFS</acronym> with
	<span class="application">bhyve</span> Guests</h3></div></div></div><p>If <acronym class="acronym">ZFS</acronym> is available on the host
	machine, using <acronym class="acronym">ZFS</acronym> volumes
	instead of disk image files can provide significant
	performance benefits for the guest <acronym class="acronym">VMs</acronym>.  A
	<acronym class="acronym">ZFS</acronym> volume can be created by:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create -V<em class="replaceable"><code>16G</code></em> -o volmode=dev <em class="replaceable"><code>zroot/linuxdisk0</code></em></code></strong></pre><p>When starting the <acronym class="acronym">VM</acronym>, specify the
	<acronym class="acronym">ZFS</acronym> volume as the disk drive:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<em class="replaceable"><code>tap0</code></em> -s3:0,virtio-blk,<em class="replaceable"><code>/dev/zvol/zroot/linuxdisk0</code></em> \
    -l com1,<em class="replaceable"><code>stdio</code></em> -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-nmdm"></a>21.7.7. Virtual Machine Consoles</h3></div></div></div><p>It is advantageous to wrap the
	<span class="application">bhyve</span> console in a session
	management tool such as <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/tmux/pkg-descr">sysutils/tmux</a> or
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/screen/pkg-descr">sysutils/screen</a> in order to detach and
	reattach to the console.  It is also possible to have the
	console of <span class="application">bhyve</span> be a null modem
	device that can be accessed with <code class="command">cu</code>.  To do
	this, load the <code class="filename">nmdm</code> kernel module and
	replace <code class="option">-l com1,stdio</code> with
	<code class="option">-l com1,/dev/nmdm0A</code>.  The
	<code class="filename">/dev/nmdm</code> devices are created
	automatically as needed, where each is a pair, corresponding
	to the two ends of the null modem cable
	(<code class="filename">/dev/nmdm0A</code> and
	<code class="filename">/dev/nmdm0B</code>).  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=nmdm&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">nmdm</span>(4)</span></a> for more
	information.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload nmdm</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,<em class="replaceable"><code>tap0</code></em> -s 3:0,virtio-blk,<em class="replaceable"><code>./linux.img</code></em> \
    -l com1,<em class="replaceable"><code>/dev/nmdm0A</code></em> -c <em class="replaceable"><code>4</code></em> -m <em class="replaceable"><code>1024M</code></em> <em class="replaceable"><code>linuxguest</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cu -l <em class="replaceable"><code>/dev/nmdm0B</code></em></code></strong>
Connected

Ubuntu 13.10 handbook ttyS0

handbook login:</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-managing"></a>21.7.8. Managing Virtual Machines</h3></div></div></div><p>A device node is created in <code class="filename">/dev/vmm</code> for each virtual
	machine.  This allows the administrator to easily see a list
	of the running virtual machines:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls -al /dev/vmm</code></strong>
total 1
dr-xr-xr-x   2 root  wheel    512 Mar 17 12:19 ./
dr-xr-xr-x  14 root  wheel    512 Mar 17 06:38 ../
crw-------   1 root  wheel  0x1a2 Mar 17 12:20 guestname
crw-------   1 root  wheel  0x19f Mar 17 12:19 linuxguest
crw-------   1 root  wheel  0x1a1 Mar 17 12:19 otherguest</pre><p>A specified virtual machine can be destroyed using
	<code class="command">bhyvectl</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bhyvectl --destroy --vm=<em class="replaceable"><code>guestname</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-bhyve-onboot"></a>21.7.9. Persistent Configuration</h3></div></div></div><p>In order to configure the system to start
	<span class="application">bhyve</span> guests at boot time, the
	following configurations must be made in the specified
	files:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong><code class="filename">/etc/sysctl.conf</code></strong></p><pre class="programlisting">net.link.tap.up_on_open=1</pre></li><li class="step"><p class="title"><strong><code class="filename">/etc/rc.conf</code></strong></p><pre class="programlisting">cloned_interfaces="<em class="replaceable"><code>bridge0</code></em> <em class="replaceable"><code>tap0</code></em>"
ifconfig_bridge0="addm <em class="replaceable"><code>igb0</code></em> addm <em class="replaceable"><code>tap0</code></em>"
kld_list="nmdm vmm"</pre></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-host-xen"></a>21.8. FreeBSD as a <span class="trademark">Xen</span>&#8482;-Host</h2></div></div></div><p><span class="application">Xen</span> is a GPLv2-licensed <a class="link" href="https://en.wikipedia.org/wiki/Hypervisor#Classification" target="_top">type
	1 hypervisor</a> for <span class="trademark">Intel</span>® and <span class="trademark">ARM</span>® architectures.  FreeBSD
      has included <span class="trademark">i386</span>&#8482; and <span class="trademark">AMD</span>® 64-Bit <a class="link" href="https://wiki.xenproject.org/wiki/DomU" target="_top">DomU</a>
      and <a class="link" href="https://en.wikipedia.org/wiki/Amazon_Elastic_Compute_Cloud" target="_top">Amazon
	EC2</a> unprivileged domain (virtual machine) support since
      FreeBSD 8.0 and includes Dom0 control domain (host) support in
      FreeBSD 11.0.  Support for para-virtualized (PV) domains has
      been removed from FreeBSD 11 in favor of hardware virtualized
      (HVM) domains, which provides better performance.</p><p><span class="trademark">Xen</span>&#8482; is a bare-metal hypervisor, which means that it is the
      first program loaded after the BIOS. A special privileged guest
      called the Domain-0 (<code class="literal">Dom0</code> for short) is then
      started.  The Dom0 uses its special privileges to directly
      access the underlying physical hardware, making it a
      high-performance solution.  It is able to access the disk
      controllers and network adapters directly.  The <span class="trademark">Xen</span>&#8482; management
      tools to manage and control the <span class="trademark">Xen</span>&#8482; hypervisor are also used
      by the Dom0 to create, list, and destroy VMs.  Dom0 provides
      virtual disks and networking for unprivileged domains, often
      called <code class="literal">DomU</code>.  <span class="trademark">Xen</span>&#8482; Dom0 can be compared to
      the service console of other hypervisor solutions, while the
      DomU is where individual guest VMs are run.</p><p><span class="trademark">Xen</span>&#8482; can migrate VMs between different <span class="trademark">Xen</span>&#8482; servers.  When
      the two xen hosts share the same underlying storage, the
      migration can be done without having to shut the VM down first.
      Instead, the migration is performed live while the DomU is
      running and there is no need to restart it or plan a downtime.
      This is useful in maintenance scenarios or upgrade windows to
      ensure that the services provided by the DomU are still
      provided.  Many more features of <span class="trademark">Xen</span>&#8482; are listed on the <a class="link" href="https://wiki.xenproject.org/wiki/Category:Overview" target="_top">Xen
	Wiki Overview page</a>.  Note that not all features are
      supported on FreeBSD yet.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-requirements"></a>21.8.1. Hardware Requirements for <span class="trademark">Xen</span>&#8482; Dom0</h3></div></div></div><p>To run the <span class="trademark">Xen</span>&#8482; hypervisor on a host, certain hardware
	functionality is required.  Hardware virtualized domains
	require Extended Page Table (<a class="link" href="http://en.wikipedia.org/wiki/Extended_Page_Table" target="_top">EPT</a>)
	and Input/Output Memory Management Unit (<a class="link" href="http://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware" target="_top">IOMMU</a>)
	support in the host processor.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In order to run a FreeBSD <span class="trademark">Xen</span>&#8482; Dom0 the box must be
	  booted using legacy boot (BIOS).</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-dom0-setup"></a>21.8.2. <span class="trademark">Xen</span>&#8482; Dom0 Control Domain Setup</h3></div></div></div><p>Users of FreeBSD 11 should install the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/xen-kernel47/pkg-descr">emulators/xen-kernel47</a> and
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/xen-tools47/pkg-descr">sysutils/xen-tools47</a> packages that are
	based on Xen version 4.7.  Systems running on FreeBSD-12.0 or
	newer can use Xen 4.11 provided by
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/emulators/xen-kernel411/pkg-descr">emulators/xen-kernel411</a> and
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/xen-tools411/pkg-descr">sysutils/xen-tools411</a>, respectively.</p><p>Configuration files must be edited to prepare the host
	for the Dom0 integration after the Xen packages are installed.
	An entry to <code class="filename">/etc/sysctl.conf</code> disables the
	limit on how many pages of memory are allowed to be wired.
	Otherwise, DomU VMs with higher memory requirements will not
	run.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'vm.max_wired=-1' &gt;&gt; /etc/sysctl.conf</code></strong></pre><p>Another memory-related setting involves changing
	<code class="filename">/etc/login.conf</code>, setting the
	<code class="literal">memorylocked</code> option to
	<code class="literal">unlimited</code>.  Otherwise, creating DomU
	domains may fail with <span class="errorname">Cannot allocate
	  memory</span> errors.  After making the change to
	<code class="filename">/etc/login.conf</code>, run
	<code class="command">cap_mkdb</code> to update the capability database.
	See <a class="xref" href="#security-resourcelimits" title="13.13. Resource Limits">Section 13.13, &#8220;Resource Limits&#8221;</a> for
	details.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sed -i '' -e 's/memorylocked=64K/memorylocked=unlimited/' /etc/login.conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre><p>Add an entry for the <span class="trademark">Xen</span>&#8482; console to
	<code class="filename">/etc/ttys</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'xc0     "/usr/libexec/getty Pc"         xterm   onifconsole  secure' &gt;&gt; /etc/ttys</code></strong></pre><p>Selecting a <span class="trademark">Xen</span>&#8482; kernel in
	<code class="filename">/boot/loader.conf</code> activates the Dom0.
	<span class="trademark">Xen</span>&#8482; also requires resources like CPU and memory from the
	host machine for itself and other DomU domains.  How much CPU
	and memory depends on the individual requirements and hardware
	capabilities.  In this example, 8 GB of memory and 4
	virtual CPUs are made available for the Dom0. The serial
	console is also activated and logging options are
	defined.</p><p>The following command is used for Xen 4.7 packages:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf hw.pci.mcfg=0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf if_tap_load="YES"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf xen_kernel="/boot/xen"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf xen_cmdline="dom0_mem=<em class="replaceable"><code>8192M</code></em> dom0_max_vcpus=<em class="replaceable"><code>4</code></em> dom0pvh=1 console=com1,vga com1=115200,8n1 guest_loglvl=all loglvl=all"</code></strong></pre><p>For Xen versions 4.11 and higher, the following command
	should be used instead:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf if_tap_load="YES"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf xen_kernel="/boot/xen"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf xen_cmdline="dom0_mem=<em class="replaceable"><code>8192M</code></em> dom0_max_vcpus=<em class="replaceable"><code>4</code></em> dom0=pvh console=com1,vga com1=115200,8n1 guest_loglvl=all loglvl=all"</code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Log files that <span class="trademark">Xen</span>&#8482; creates for the DomU VMs
	    are stored in <code class="filename">/var/log/xen</code>.  Please
	    be sure to check the contents of that directory if
	    experiencing issues.</p></div><p>Activate the xencommons service during system
	  startup:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc xencommons_enable=yes</code></strong></pre><p>These settings are enough to start a Dom0-enabled
	  system.  However, it lacks network functionality for the
	  DomU machines.  To fix that, define a bridged interface with
	  the main NIC of the system which the DomU VMs can use to
	  connect to the network.  Replace
	  <em class="replaceable"><code>em0</code></em> with the host network
	  interface name.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc cloned_interfaces="bridge0"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc ifconfig_bridge0="addm <em class="replaceable"><code>em0</code></em> SYNCDHCP"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc ifconfig_<em class="replaceable"><code>em0</code></em>="up"</code></strong></pre><p>Restart the host to load the <span class="trademark">Xen</span>&#8482; kernel and start the
	  Dom0.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>reboot</code></strong></pre><p>After successfully booting the <span class="trademark">Xen</span>&#8482; kernel and logging
	  into the system again, the <span class="trademark">Xen</span>&#8482; management tool
	  <code class="command">xl</code> is used to show information about the
	  domains.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>xl list</code></strong>
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0  8192     4     r-----     962.0</pre><p>The output confirms that the Dom0 (called
	  <code class="literal">Domain-0</code>) has the ID <code class="literal">0</code>
	  and is running.  It also has the memory and virtual CPUs
	  that were defined in <code class="filename">/boot/loader.conf</code>
	  earlier.  More information can be found in the <a class="link" href="https://www.xenproject.org/help/documentation.html" target="_top"><span class="trademark">Xen</span>&#8482;
	    Documentation</a>.  DomU guest VMs can now be
	  created.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-domu-setup"></a>21.8.3. <span class="trademark">Xen</span>&#8482; DomU Guest VM Configuration</h3></div></div></div><p>Unprivileged domains consist of a configuration file and
	  virtual or physical hard disks.  Virtual disk storage for
	  the DomU can be files created by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=truncate&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">truncate</span>(1)</span></a> or ZFS
	  volumes as described in <a class="xref" href="#zfs-zfs-volume" title="19.4.2. Creating and Destroying Volumes">Section 19.4.2, &#8220;Creating and Destroying Volumes&#8221;</a>.
	  In this example, a 20 GB volume is used.  A VM is
	  created with the ZFS volume, a FreeBSD ISO image, 1 GB of
	  RAM and two virtual CPUs.  The ISO installation file is
	  retrieved with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fetch&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fetch</span>(1)</span></a> and saved locally in a file
	  called <code class="filename">freebsd.iso</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fetch <em class="replaceable"><code>ftp://ftp.freebsd.org/pub/FreeBSD/releases/ISO-IMAGES/<em class="replaceable"><code>12.0</code></em>/FreeBSD-<em class="replaceable"><code>12.0</code></em>-RELEASE-amd64-bootonly.iso</code></em> -o <em class="replaceable"><code>freebsd.iso</code></em></code></strong></pre><p>A ZFS volume of 20 GB called
	<code class="filename">xendisk0</code> is created to serve as the disk
	space for the VM.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create -V20G -o volmode=dev zroot/xendisk0</code></strong></pre><p>The new DomU guest VM is defined in a file.  Some specific
	definitions like name, keymap, and VNC connection details are
	also defined.  The following <code class="filename">freebsd.cfg</code>
	contains a minimum DomU configuration for this example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat freebsd.cfg</code></strong>
builder = "hvm" <a id="co-xen-builder"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
name = "freebsd" <a id="co-xen-name"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
memory = 1024 <a id="co-xen-memory"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
vcpus = 2 <a id="co-xen-vcpus"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
vif = [ 'mac=00:16:3E:74:34:32,bridge=bridge0' ] <a id="co-xen-vif"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
disk = [
'/dev/zvol/tank/xendisk0,raw,hda,rw', <a id="co-xen-disk"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
'/root/freebsd.iso,raw,hdc:cdrom,r' <a id="co-xen-cdrom"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
  ]
vnc = 1 <a id="co-xen-vnc"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
vnclisten = "0.0.0.0"
serial = "pty"
usbdevice = "tablet"</pre><p>These lines are explained in more detail:</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-builder"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This defines what kind of virtualization to use.
	    <code class="literal">hvm</code> refers to hardware-assisted
	    virtualization or hardware virtual machine.  Guest
	    operating systems can run unmodified on CPUs with
	    virtualization extensions, providing nearly the same
	    performance as running on physical hardware.
	    <code class="literal">generic</code> is the default value and
	    creates a PV domain.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-name"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Name of this virtual machine to distinguish it from
	    others running on the same Dom0.  Required.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-memory"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Quantity of RAM in megabytes to make available to the
	    VM.  This amount is subtracted from the hypervisor's total
	    available memory, not the memory of the Dom0.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-vcpus"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Number of virtual CPUs available to the guest VM.  For
	    best performance, do not create guests with more virtual
	    CPUs than the number of physical CPUs on the host.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-vif"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Virtual network adapter.  This is the bridge connected
	    to the network interface of the host.  The
	    <code class="literal">mac</code> parameter is the MAC address set on
	    the virtual network interface.  This parameter is
	    optional, if no MAC is provided <span class="trademark">Xen</span>&#8482; will generate a
	    random one.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-disk"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Full path to the disk, file, or ZFS volume of the disk
	    storage for this VM.  Options and multiple disk
	    definitions are separated by commas.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-cdrom"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Defines the Boot medium from which the initial
	    operating system is installed.  In this example, it is the
	    ISO imaged downloaded earlier.  Consult the <span class="trademark">Xen</span>&#8482;
	    documentation for other kinds of devices and options to
	    set.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-xen-vnc"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Options controlling VNC connectivity to the serial
	    console of the DomU.  In order, these are: active VNC
	    support, define IP address on which to listen, device node
	    for the serial console, and the input method for precise
	    positioning of the mouse and other input methods.
	    <code class="literal">keymap</code> defines which keymap to use, and
	    is <code class="literal">english</code> by default.</p></td></tr></table></div><p>After the file has been created with all the necessary
	options, the DomU is created by passing it to <code class="command">xl
	  create</code> as a parameter.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>xl create freebsd.cfg</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Each time the Dom0 is restarted, the configuration file
	  must be passed to <code class="command">xl create</code> again to
	  re-create the DomU.  By default, only the Dom0 is created
	  after a reboot, not the individual VMs.  The VMs can
	  continue where they left off as they stored the operating
	  system on the virtual disk.  The virtual machine
	  configuration can change over time (for example, when adding
	  more memory).  The virtual machine configuration files must
	  be properly backed up and kept available to be able to
	  re-create the guest VM when needed.</p></div><p>The output of <code class="command">xl list</code> confirms that the
	DomU has been created.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>xl list</code></strong>
Name                                        ID   Mem VCPUs      State   Time(s)
Domain-0                                     0  8192     4     r-----  1653.4
freebsd                                      1  1024     1     -b----   663.9</pre><p>To begin the installation of the base operating system,
	start the VNC client, directing it to the main network address
	of the host or to the IP address defined on the
	<code class="literal">vnclisten</code> line of
	<code class="filename">freebsd.cfg</code>.  After the operating system
	has been installed, shut down the DomU and disconnect the VNC
	viewer.  Edit <code class="filename">freebsd.cfg</code>, removing the
	line with the <code class="literal">cdrom</code> definition or
	commenting it out by inserting a <code class="literal">#</code>
	character at the beginning of the line.  To load this new
	configuration, it is necessary to remove the old DomU with
	<code class="command">xl destroy</code>, passing either the name or the
	id as the parameter.  Afterwards, recreate it using the
	modified <code class="filename">freebsd.cfg</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>xl destroy freebsd</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>xl create freebsd.cfg</code></strong></pre><p>The machine can then be accessed again using the VNC
	viewer.  This time, it will boot from the virtual disk where
	the operating system has been installed and can be used as a
	virtual machine.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-troubleshooting"></a>21.8.4. Troubleshooting</h3></div></div></div><p>This section contains basic information in order to help
	troubleshoot issues found when using FreeBSD as a <span class="trademark">Xen</span>&#8482; host or
	guest.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-troubleshooting-host"></a>21.8.4.1. Host Boot Troubleshooting</h4></div></div></div><p>Please note that the following troubleshooting tips
	  are intended for <span class="trademark">Xen</span>&#8482; 4.11 or newer.  If you are still
	  using <span class="trademark">Xen</span>&#8482; 4.7 and having issues consider migrating to
	  a newer version of <span class="trademark">Xen</span>&#8482;.</p><p>In order to troubleshoot host boot issues you will
	  likely need a serial cable, or a debug USB cable.  Verbose
	  <span class="trademark">Xen</span>&#8482; boot output can be obtained by adding options to the
	  <code class="literal">xen_cmdline</code> option found in
	  <code class="filename">loader.conf</code>.  A couple of relevant
	  debug options are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">iommu=debug</code>: can be used to print
	      additional diagnostic information about the
	      iommu.</p></li><li class="listitem"><p><code class="literal">dom0=verbose</code>: can be used to
	      print additional diagnostic information about the
	      dom0 build process.</p></li><li class="listitem"><p><code class="literal">sync_console</code>: flag to force
	      synchronous console output.  Useful for debugging to
	      avoid losing messages due to rate limiting.
	      Never use this option in production environments since
	      it can allow malicious guests to perform DoS attacks
	      against <span class="trademark">Xen</span>&#8482; using the console.</p></li></ul></div><p>FreeBSD should also be booted in verbose mode in order
	  to identify any issues.  To activate verbose booting, run
	  this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc -f /boot/loader.conf boot_verbose="YES"</code></strong></pre><p>If none of these options help solving the problem,
	  please send the serial boot log to
	  <code class="email">&lt;<a xmlns="" class="email" href="mailto:freebsd-xen@FreeBSD.org">freebsd-xen@FreeBSD.org</a>&gt;</code> and
	  <code class="email">&lt;<a xmlns="" class="email" href="mailto:xen-devel@lists.xenproject.org">xen-devel@lists.xenproject.org</a>&gt;</code>
	  for further analysis.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-host-xen-troubleshooting-guest"></a>21.8.4.2. Guest Creation Troubleshooting</h4></div></div></div><p>Issues can also arise when creating guests, the
	  following attempts to provide some help for those trying
	  to diagnose guest creation issues.</p><p>The most common cause of guest creation failures is the
	  <code class="literal">xl</code> command spitting some error and
	  exiting with a return code different than 0.  If the error
	  provided is not enough to help identify the issue, more
	  verbose output can also be obtained from
	  <code class="literal">xl</code> by using the <code class="literal">v</code>
	  option repeatedly.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>xl -vvv create freebsd.cfg</code></strong>
Parsing config from freebsd.cfg
libxl: debug: libxl_create.c:1693:do_domain_create: Domain 0:ao 0x800d750a0: create: how=0x0 callback=0x0 poller=0x800d6f0f0
libxl: debug: libxl_device.c:397:libxl__device_disk_set_backend: Disk vdev=xvda spec.backend=unknown
libxl: debug: libxl_device.c:432:libxl__device_disk_set_backend: Disk vdev=xvda, using backend phy
libxl: debug: libxl_create.c:1018:initiate_domain_create: Domain 1:running bootloader
libxl: debug: libxl_bootloader.c:328:libxl__bootloader_run: Domain 1:not a PV/PVH domain, skipping bootloader
libxl: debug: libxl_event.c:689:libxl__ev_xswatch_deregister: watch w=0x800d96b98: deregister unregistered
domainbuilder: detail: xc_dom_allocate: cmdline="", features=""
domainbuilder: detail: xc_dom_kernel_file: filename="/usr/local/lib/xen/boot/hvmloader"
domainbuilder: detail: xc_dom_malloc_filemap    : 326 kB
libxl: debug: libxl_dom.c:988:libxl__load_hvm_firmware_module: Loading BIOS: /usr/local/share/seabios/bios.bin
...</pre><p>If the verbose output does not help diagnose the issue
	  there are also QEMU and <span class="trademark">Xen</span>&#8482; toolstack logs in
	  <code class="filename">/var/log/xen</code>.  Note that the name of
	  the domain is appended to the log name, so if the domain
	  is named <code class="literal">freebsd</code> you should find a
	  <code class="filename">/var/log/xen/xl-freebsd.log</code> and likely
	  a <code class="filename">/var/log/xen/qemu-dm-freebsd.log</code>.
	  Both log files can contain useful information for debugging.
	  If none of this helps solve the issue, please send the
	  description of the issue you are facing and as much
	  information as possible to
	  <code class="email">&lt;<a xmlns="" class="email" href="mailto:freebsd-xen@FreeBSD.org">freebsd-xen@FreeBSD.org</a>&gt;</code> and
	  <code class="email">&lt;<a xmlns="" class="email" href="mailto:xen-devel@lists.xenproject.org">xen-devel@lists.xenproject.org</a>&gt;</code> in order to
	  get help.</p></div></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="l10n"></a>Chapter 22. Localization -
      <acronym class="acronym">i18n</acronym>/<acronym class="acronym">L10n</acronym> Usage and
      Setup</h2></div><div><span class="authorgroup">Contributed
	by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Andrey</span> <span class="surname">Chernov</span></span>. </span></div><div><span class="authorgroup">Rewritten
	by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Michael
	C.</span> <span class="surname">Wu</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#l10n-synopsis">22.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#using-localization">22.2. Using Localization</a></span></dt><dt><span class="sect1"><a href="#l10n-compiling">22.3. Finding <acronym class="acronym">i18n</acronym> Applications</a></span></dt><dt><span class="sect1"><a href="#lang-setup">22.4. Locale Configuration for Specific Languages</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="l10n-synopsis"></a>22.1. Synopsis</h2></div></div></div><p>FreeBSD is a distributed project with users and contributors
      located all over the world.  As such, FreeBSD supports localization
      into many languages, allowing users to view, input, or process
      data in non-English languages.  One can choose from most of the
      major languages, including, but not limited to:  Chinese,
      German, Japanese, Korean, French, Russian, and
      Vietnamese.</p><a id="idp64229368" class="indexterm"></a><a id="idp64230520" class="indexterm"></a><p>The term internationalization has been shortened to
      <acronym class="acronym">i18n</acronym>, which represents the number of letters
      between the first and the last letters of
      <code class="literal">internationalization</code>.
      <acronym class="acronym">L10n</acronym> uses the same naming scheme, but from
      <code class="literal">localization</code>.  The
      <acronym class="acronym">i18n</acronym>/<acronym class="acronym">L10n</acronym> methods,
      protocols, and applications allow users to use languages of
      their choice.</p><p>This chapter discusses the internationalization and
      localization features of FreeBSD.  After reading this chapter, you
      will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How locale names are constructed.</p></li><li class="listitem"><p>How to set the locale for a login shell.</p></li><li class="listitem"><p>How to configure the console for non-English
	  languages.</p></li><li class="listitem"><p>How to configure <span class="application">Xorg</span> for
	  different languages.</p></li><li class="listitem"><p>How to find <acronym class="acronym">i18n</acronym>-compliant
	  applications.</p></li><li class="listitem"><p>Where to find more information for configuring specific
	  languages.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Know how to <a class="link" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">install
	  additional third-party
	  applications</a>.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-localization"></a>22.2. Using Localization</h2></div></div></div><a id="idp64254840" class="indexterm"></a><p>Localization settings are based on three components:
      the language code, country code, and encoding.  Locale names are
      constructed from these parts as follows:</p><pre class="programlisting"><em class="replaceable"><code>LanguageCode</code></em>_<em class="replaceable"><code>CountryCode</code></em>.<em class="replaceable"><code>Encoding</code></em></pre><a id="idp63740920" class="indexterm"></a><a id="idp63741432" class="indexterm"></a><p>The <em class="replaceable"><code>LanguageCode</code></em> and
	<em class="replaceable"><code>CountryCode</code></em> are used to determine
	the country and the specific language variation.  <a class="xref" href="#locale-lang-country" title="Table 22.1. Common Language and Country Codes">Table 22.1, &#8220;Common Language and Country Codes&#8221;</a> provides some examples of
	<em class="replaceable"><code>LanguageCode</code></em>_<em class="replaceable"><code>CountryCode</code></em>:</p><div class="table"><a id="locale-lang-country"></a><div class="table-title">Table 22.1. Common Language and Country Codes</div><div class="table-contents"><table class="table" summary="Common Language and Country Codes" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>LanguageCode_Country Code</th><th>Description</th></tr></thead><tbody><tr><td>en_US</td><td>English, United States</td></tr><tr><td>ru_RU</td><td>Russian, Russia</td></tr><tr><td>zh_TW</td><td>Traditional Chinese, Taiwan</td></tr></tbody></table></div></div><br class="table-break" /><p>A complete listing of available locales can be found by
	typing:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>locale -a | more</code></strong></pre><p>To determine the current locale setting:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>locale</code></strong></pre><a id="idp64282232" class="indexterm"></a><a id="idp64282744" class="indexterm"></a><p>Language specific character sets, such as ISO8859-1,
	ISO8859-15, KOI8-R, and CP437, are described in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=multibyte&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">multibyte</span>(3)</span></a>.  The active list of character sets can be
	found at the <a class="link" href="http://www.iana.org/assignments/character-sets" target="_top">IANA
	  Registry</a>.</p><p>Some languages, such as Chinese or Japanese, cannot be
	represented using <acronym class="acronym">ASCII</acronym> characters and
	require an extended language encoding using either wide or
	multibyte characters.  Examples of wide or multibyte encodings
	include EUC and Big5.  Older applications may mistake these
	encodings for control characters while newer applications
	usually recognize these characters.  Depending on the
	implementation, users may be required to compile an
	application with wide or multibyte character support, or to
	configure it correctly.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD uses Xorg-compatible locale encodings.</p></div><p>The rest of this section describes the various methods for
	configuring the locale on a FreeBSD system.  The next section
	will discuss the considerations for finding and compiling
	applications with <acronym class="acronym">i18n</acronym> support.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="setting-locale"></a>22.2.1. Setting Locale for Login Shell</h3></div></div></div><p>Locale settings are configured either in a user's
	<code class="filename">~/.login_conf</code>
	or in the startup file of the user's shell:
	<code class="filename">~/.profile</code>,
	<code class="filename">~/.bashrc</code>, or
	<code class="filename">~/.cshrc</code>.</p><p>Two environment
	variables should be set:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="envar">LANG</code>, which sets the locale<a id="idp64291320" class="indexterm"></a></p></li><li class="listitem"><a id="idp64292344" class="indexterm"></a><p><code class="envar">MM_CHARSET</code>, which sets the
	    <acronym class="acronym">MIME</acronym> character set used by
	    applications</p></li></ul></div><p>In addition to the user's shell configuration, these
	variables should also be set for specific application
	configuration and <span class="application">Xorg</span>
	configuration.</p><a id="idp64295032" class="indexterm"></a><a id="idp64295544" class="indexterm"></a><p>Two methods are available for making the needed variable
	assignments: the <a class="link" href="#login-class" title="22.2.1.1. Login Classes Method">login
	  class</a> method, which is the recommended method, and
	the <a class="link" href="#startup-file" title="22.2.1.2. Shell Startup File Method">startup file</a> method.
	The next two sections demonstrate how to use both
	methods.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="login-class"></a>22.2.1.1. Login Classes Method</h4></div></div></div><p>This first method is the recommended method as it
	  assigns the required environment variables for locale name
	  and <acronym class="acronym">MIME</acronym> character sets for every
	  possible shell.  This setup can either be performed by each
	  user or it can be configured for all users by the
	  superuser.</p><p>This minimal example sets both variables for Latin-1
	  encoding in the <code class="filename">.login_conf</code> of an
	  individual user's home directory:</p><pre class="programlisting">me:\
	:charset=ISO-8859-1:\
	:lang=de_DE.ISO8859-1:</pre><a id="idp64304376" class="indexterm"></a><p>Here is an example of a user's
	  <code class="filename">~/.login_conf</code> that sets the variables
	  for Traditional Chinese in BIG-5 encoding.  More variables
	  are needed because some applications do not correctly
	  respect locale variables for Chinese, Japanese, and
	  Korean:</p><pre class="programlisting">#Users who do not wish to use monetary units or time formats
#of Taiwan can manually change each variable
me:\
	:lang=zh_TW.Big5:\
	:setenv=LC_ALL=zh_TW.Big5,LC_COLLATE=zh_TW.Big5,LC_CTYPE=zh_TW.Big5,LC_MESSAGES=zh_TW.Big5,LC_MONETARY=zh_TW.Big5,LC_NUMERIC=zh_TW.Big5,LC_TIME=zh_TW.Big5:\
	:charset=big5:\
	:xmodifiers="@im=gcin": #Set gcin as the XIM Input Server</pre><p>Alternately, the superuser can configure all users of
	  the system for localization.  The following variables in
	  <code class="filename">/etc/login.conf</code> are used to set the
	  locale and <acronym class="acronym">MIME</acronym> character set:</p><pre class="programlisting"><em class="replaceable"><code>language_name</code></em>|<em class="replaceable"><code>Account Type Description</code></em>:\
	:charset=<em class="replaceable"><code>MIME_charset</code></em>:\
	:lang=<em class="replaceable"><code>locale_name</code></em>:\
	:tc=default:</pre><p>So, the previous Latin-1 example would look like
	  this:</p><pre class="programlisting">german|German Users Accounts:\
	:charset=ISO-8859-1:\
	:lang=de_DE.ISO8859-1:\
	:tc=default:</pre><p>See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a> for more details about these
	  variables.  Note that it already contains pre-defined
	  <em class="replaceable"><code>russian</code></em> class.</p><p>Whenever <code class="filename">/etc/login.conf</code> is edited,
	  remember to execute the following command to update the
	  capability database:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">For an end user, the <code class="command">cap_mkdb</code> command will
	    need to be run on their <code class="filename">~/.login_conf</code> for
	    any changes to take effect.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64327288"></a>22.2.1.1.1. Utilities Which Change Login Classes</h5></div></div></div><a id="idp64327928" class="indexterm"></a><p>In addition to manually editing
	    <code class="filename">/etc/login.conf</code>, several utilities
	    are available for setting the locale for newly created
	    users.</p><p>When using <code class="command">vipw</code> to add new users,
	    specify the <em class="replaceable"><code>language</code></em> to set the
	    locale:</p><pre class="programlisting">user:password:1111:11:<em class="replaceable"><code>language</code></em>:0:0:User Name:/home/user:/bin/sh</pre><a id="idp64331512" class="indexterm"></a><a id="idp64332408" class="indexterm"></a><p>When using <code class="command">adduser</code> to add new
	    users, the default language can be pre-configured for all
	    new users or specified for an individual user.</p><p>If all new users use the same language, set
	    <code class="literal">defaultclass=<em class="replaceable"><code>language</code></em></code> in
	    <code class="filename">/etc/adduser.conf</code>.</p><p>To override this setting when creating a user, either
	    input the required locale at this prompt:</p><pre class="screen"><code class="prompt">Enter login class: default []:</code></pre><p>or specify the locale to set when invoking
	    <code class="command">adduser</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>adduser -class <em class="replaceable"><code>language</code></em></code></strong></pre><a id="idp64338040" class="indexterm"></a><p>If <code class="command">pw</code> is used to add new users,
	    specify the locale as follows:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw useradd <em class="replaceable"><code>user_name</code></em> -L <em class="replaceable"><code>language</code></em></code></strong></pre><p>To change the login class of an existing user,
	    <code class="command">chpass</code> can be used.  Invoke it as
	    superuser and provide the username to edit as the
	    argument.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chpass <em class="replaceable"><code>user_name</code></em></code></strong></pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="startup-file"></a>22.2.1.2. Shell Startup File Method</h4></div></div></div><p>This second method is not recommended as each shell
	    that is used requires manual configuration, where each
	    shell has a different configuration file and differing
	    syntax.  As an example, to set the German language for the
	    <code class="command">sh</code> shell, these lines could be added to
	    <code class="filename">~/.profile</code> to set the shell for that
	    user only.  These lines could also be added to
	    <code class="filename">/etc/profile</code> or
	    <code class="filename">/usr/share/skel/dot.profile</code> to set
	    that shell for all users:</p><pre class="programlisting"><code class="envar">LANG</code>=de_DE.ISO8859-1; export <code class="envar">LANG</code>
<code class="envar">MM_CHARSET</code>=ISO-8859-1; export <code class="envar">MM_CHARSET</code></pre><p>However, the name of the configuration file and the
	    syntax used differs for the <code class="command">csh</code> shell.
	    These are the equivalent settings for
	    <code class="filename">~/.csh.login</code>,
	    <code class="filename">/etc/csh.login</code>, or
	    <code class="filename">/usr/share/skel/dot.login</code>:</p><pre class="programlisting">setenv <code class="envar">LANG</code> de_DE.ISO8859-1
setenv <code class="envar">MM_CHARSET</code> ISO-8859-1</pre><p>To complicate matters, the syntax needed to configure
	    <span class="application">Xorg</span> in
	    <code class="filename">~/.xinitrc</code> also depends upon the
	    shell.  The first example is for the <code class="command">sh</code>
	    shell and the second is for the <code class="command">csh</code>
	    shell:</p><pre class="programlisting"><code class="envar">LANG</code>=de_DE.ISO8859-1; export <code class="envar">LANG</code></pre><pre class="programlisting">setenv <code class="envar">LANG</code> de_DE.ISO8859-1</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="setting-console"></a>22.2.2. Console Setup</h3></div></div></div><p>Several localized fonts are available for the console.  To
	see a listing of available fonts, type
	<code class="command">ls /usr/share/syscons/fonts</code>.  To configure
	the console font, specify the
	<em class="replaceable"><code>font_name</code></em>,
	without the <code class="filename">.fnt</code> suffix, in
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">font8x16=<em class="replaceable"><code>font_name</code></em>
font8x14=<em class="replaceable"><code>font_name</code></em>
font8x8=<em class="replaceable"><code>font_name</code></em></pre><a id="idp64366968" class="indexterm"></a><a id="idp64367480" class="indexterm"></a><p>The keymap and screenmap  can be set by adding the
	following to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">scrnmap=<em class="replaceable"><code>screenmap_name</code></em>
keymap=<em class="replaceable"><code>keymap_name</code></em>
keychange="<em class="replaceable"><code>fkey_number sequence</code></em>"</pre><p>To see the list of available screenmaps, type
	<code class="command">ls /usr/share/syscons/scrnmaps</code>.  Do not
	include the <code class="filename">.scm</code> suffix when specifying
	<em class="replaceable"><code>screenmap_name</code></em>.  A screenmap with a
	corresponding mapped font is usually needed as a workaround
	for expanding bit 8 to bit 9 on a VGA adapter's font character
	matrix so that letters are moved out of the pseudographics
	area if the screen font uses a bit 8 column.</p><p>To see the list of available keymaps, type
	<code class="command">ls /usr/share/syscons/keymaps</code>.  When
	specifying the <em class="replaceable"><code>keymap_name</code></em>, do not
	include the <code class="filename">.kbd</code> suffix.  To test
	keymaps without rebooting,
	use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kbdmap&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kbdmap</span>(1)</span></a>.</p><p>The <code class="literal">keychange</code> entry is usually needed
	to program function keys to match the selected terminal type
	because function key sequences cannot be defined in the
	keymap.</p><p>Next, set the correct console terminal type in
	<code class="filename">/etc/ttys</code> for all virtual terminal
	entries.  <a class="xref" href="#locale-charset" title="Table 22.2. Defined Terminal Types for Character Sets">Table 22.2, &#8220;Defined Terminal Types for Character Sets&#8221;</a> summarizes the
	available terminal types.:</p><div class="table"><a id="locale-charset"></a><div class="table-title">Table 22.2. Defined Terminal Types for Character Sets</div><div class="table-contents"><table class="table" summary="Defined Terminal Types for Character Sets" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Character Set</th><th>Terminal Type</th></tr></thead><tbody><tr><td>ISO8859-1 or ISO8859-15</td><td><code class="literal">cons25l1</code></td></tr><tr><td>ISO8859-2</td><td><code class="literal">cons25l2</code></td></tr><tr><td>ISO8859-7</td><td><code class="literal">cons25l7</code></td></tr><tr><td>KOI8-R</td><td><code class="literal">cons25r</code></td></tr><tr><td>KOI8-U</td><td><code class="literal">cons25u</code></td></tr><tr><td>CP437 (VGA default)</td><td><code class="literal">cons25</code></td></tr><tr><td>US-ASCII</td><td><code class="literal">cons25w</code></td></tr></tbody></table></div></div><br class="table-break" /><a id="idp64409080" class="indexterm"></a><p>For languages with wide or multibyte characters, install a
	console for that language from the FreeBSD Ports Collection.  The
	available ports are summarized in <a class="xref" href="#locale-console" title="Table 22.3. Available Console from Ports Collection">Table 22.3, &#8220;Available Console from Ports Collection&#8221;</a>.  Once installed, refer to the
	port's <code class="filename">pkg-message</code> or man pages for
	configuration and usage instructions.</p><div class="table"><a id="locale-console"></a><div class="table-title">Table 22.3. Available Console from Ports Collection</div><div class="table-contents"><table class="table" summary="Available Console from Ports Collection" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Language</th><th>Port Location</th></tr></thead><tbody><tr><td>Traditional Chinese (BIG-5)</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/big5con/pkg-descr">chinese/big5con</a></td></tr><tr><td>Chinese/Japanese/Korean</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/cce/pkg-descr">chinese/cce</a></td></tr><tr><td>Chinese/Japanese/Korean</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/zhcon/pkg-descr">chinese/zhcon</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/kon2/pkg-descr">chinese/kon2</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/kon2-14dot/pkg-descr">japanese/kon2-14dot</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/kon2-16dot/pkg-descr">japanese/kon2-16dot</a></td></tr></tbody></table></div></div><br class="table-break" /><p>If <span class="application">moused</span> is enabled in
	<code class="filename">/etc/rc.conf</code>, additional configuration
	may be required.  By default, the mouse cursor of the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syscons&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syscons</span>(4)</span></a> driver occupies the
	<code class="literal">0xd0</code>-<code class="literal">0xd3</code> range in the
	character set.  If the language uses this range, move the
	cursor's range by adding the
	following line to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">mousechar_start=3</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64065656"></a>22.2.3. Xorg Setup</h3></div></div></div><p><a class="xref" href="#x11" title="Chapter 5. The X Window System">Chapter 5, <em>The X Window System</em></a> describes how to install and
	configure <span class="application">Xorg</span>.  When configuring
	<span class="application">Xorg</span> for localization, additional
	fonts and input methods are available from the FreeBSD Ports
	Collection.  Application specific <acronym class="acronym">i18n</acronym>
	settings such as fonts and menus can be tuned in
	<code class="filename">~/.Xresources</code> and should allow users to
	view their selected language in graphical application
	menus.</p><a id="idp64211960" class="indexterm"></a><p>The X Input Method (<acronym class="acronym">XIM</acronym>) protocol is an
	<span class="application">Xorg</span> standard for  inputting
	non-English characters.  <a class="xref" href="#locale-xim" title="Table 22.4. Available Input Methods">Table 22.4, &#8220;Available Input Methods&#8221;</a>
	summarizes the input method applications which are available
	in the FreeBSD Ports Collection.  Additional Fcitx and Uim
	applications are also available.</p><div class="table"><a id="locale-xim"></a><div class="table-title">Table 22.4. Available Input Methods</div><div class="table-contents"><table class="table" summary="Available Input Methods" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Language</th><th>Input Method</th></tr></thead><tbody><tr><td>Chinese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/gcin/pkg-descr">chinese/gcin</a></td></tr><tr><td>Chinese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/ibus-chewing/pkg-descr">chinese/ibus-chewing</a></td></tr><tr><td>Chinese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/ibus-pinyin/pkg-descr">chinese/ibus-pinyin</a></td></tr><tr><td>Chinese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/oxim/pkg-descr">chinese/oxim</a></td></tr><tr><td>Chinese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/scim-fcitx/pkg-descr">chinese/scim-fcitx</a></td></tr><tr><td>Chinese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/scim-pinyin/pkg-descr">chinese/scim-pinyin</a></td></tr><tr><td>Chinese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/chinese/scim-tables/pkg-descr">chinese/scim-tables</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/ibus-anthy/pkg-descr">japanese/ibus-anthy</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/ibus-mozc/pkg-descr">japanese/ibus-mozc</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/ibus-skk/pkg-descr">japanese/ibus-skk</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/im-ja/pkg-descr">japanese/im-ja</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/kinput2/pkg-descr">japanese/kinput2</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-anthy/pkg-descr">japanese/scim-anthy</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-canna/pkg-descr">japanese/scim-canna</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-honoka/pkg-descr">japanese/scim-honoka</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-honoka-plugin-romkan/pkg-descr">japanese/scim-honoka-plugin-romkan</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-honoka-plugin-wnn/pkg-descr">japanese/scim-honoka-plugin-wnn</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-prime/pkg-descr">japanese/scim-prime</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-skk/pkg-descr">japanese/scim-skk</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-tables/pkg-descr">japanese/scim-tables</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-tomoe/pkg-descr">japanese/scim-tomoe</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/scim-uim/pkg-descr">japanese/scim-uim</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/skkinput/pkg-descr">japanese/skkinput</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/skkinput3/pkg-descr">japanese/skkinput3</a></td></tr><tr><td>Japanese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/japanese/uim-anthy/pkg-descr">japanese/uim-anthy</a></td></tr><tr><td>Korean</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/korean/ibus-hangul/pkg-descr">korean/ibus-hangul</a></td></tr><tr><td>Korean</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/korean/imhangul/pkg-descr">korean/imhangul</a></td></tr><tr><td>Korean</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/korean/nabi/pkg-descr">korean/nabi</a></td></tr><tr><td>Korean</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/korean/scim-hangul/pkg-descr">korean/scim-hangul</a></td></tr><tr><td>Korean</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/korean/scim-tables/pkg-descr">korean/scim-tables</a></td></tr><tr><td>Vietnamese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/vietnamese/xvnkb/pkg-descr">vietnamese/xvnkb</a></td></tr><tr><td>Vietnamese</td><td><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/vietnamese/x-unikey/pkg-descr">vietnamese/x-unikey</a></td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="l10n-compiling"></a>22.3. Finding <acronym class="acronym">i18n</acronym> Applications</h2></div></div></div><p><acronym class="acronym">i18n</acronym> applications are programmed using
      <acronym class="acronym">i18n</acronym> kits under libraries.  These allow
      developers to write a simple file and translate displayed menus
      and texts to each language.</p><p>The <a class="link" href="../../../../ports/index.html" target="_top">FreeBSD
	Ports Collection</a> contains many applications with
      built-in support for wide or multibyte characters for several
      languages.  Such applications include <code class="literal">i18n</code> in
      their names for easy identification.  However, they do not
      always support the language needed.</p><p>Some applications can be compiled with the specific
      charset.  This is usually done in the port's
      <code class="filename">Makefile</code> or by passing a value to
      <span class="application">configure</span>.  Refer to the
      <acronym class="acronym">i18n</acronym> documentation in the respective FreeBSD
      port's source for more information on how to determine the
      needed <span class="application">configure</span> value  or the port's
      <code class="filename">Makefile</code> to determine which compile options
      to use when building the port.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="lang-setup"></a>22.4. Locale Configuration for Specific Languages</h2></div></div></div><p>This section provides configuration examples for localizing
      a FreeBSD system for the Russian language.  It then provides some
      additional resources for localizing other languages.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ru-localize"></a>22.4.1. Russian Language (KOI8-R Encoding)</h3></div><div><span class="authorgroup">Originally
	    contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Andrey</span> <span class="surname">Chernov</span></span>. </span></div></div></div><a id="idp64555640" class="indexterm"></a><p>This section shows the specific settings needed to
	localize a FreeBSD system for the Russian language.  Refer to
	<a class="link" href="#using-localization" title="22.2. Using Localization">Using Localization</a>
	for a more complete description of each type of
	setting.</p><p>To set this locale for the login shell, add the following
	lines to each user's
	<code class="filename">~/.login_conf</code>:</p><pre class="programlisting">me:My Account:\
	:charset=KOI8-R:\
	:lang=ru_RU.KOI8-R:</pre><p>To configure the console, add the following lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">keymap="ru.koi8-r"
scrnmap="koi8-r2cp866"
font8x16="cp866b-8x16"
font8x14="cp866-8x14"
font8x8="cp866-8x8"
mousechar_start=3</pre><p>For each <code class="literal">ttyv</code> entry in
	<code class="filename">/etc/ttys</code>, use
	<code class="literal">cons25r</code> as the terminal type.</p><a id="idp64561784" class="indexterm"></a><p>To configure printing, a special output filter is needed
	to convert from KOI8-R to CP866 since most printers with
	Russian characters come with hardware code page CP866.  FreeBSD
	includes a default filter for this purpose,
	<code class="filename">/usr/libexec/lpr/ru/koi2alt</code>.  To use this
	filter, add this entry to
	<code class="filename">/etc/printcap</code>:</p><pre class="programlisting">lp|Russian local line printer:\
	:sh:of=/usr/libexec/lpr/ru/koi2alt:\
	:lp=/dev/lpt0:sd=/var/spool/output/lpd:lf=/var/log/lpd-errs:</pre><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=printcap&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">printcap</span>(5)</span></a> for a more detailed
	explanation.</p><p>To configure support for Russian filenames in mounted
	<span class="trademark">MS-DOS</span>® file systems, include <code class="option">-L</code> and the
	locale name when adding an entry to
	<code class="filename">/etc/fstab</code>:</p><pre class="programlisting">/dev/ad0s2      /dos/c  msdos   rw,-Lru_RU.KOI8-R 0 0</pre><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_msdosfs</span>(8)</span></a> for more details.</p><p>To configure Russian fonts for
	<span class="application">Xorg</span>, install the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/x11-fonts/xorg-fonts-cyrillic/pkg-descr">x11-fonts/xorg-fonts-cyrillic</a> package.
	Then, check the <code class="literal">"Files"</code> section in
	<code class="filename">/etc/X11/xorg.conf</code>.  The following line
	must be added <span class="emphasis"><em>before</em></span> any other
	<code class="literal">FontPath</code> entries:</p><pre class="programlisting">FontPath   "/usr/local/lib/X11/fonts/cyrillic"</pre><p>Additional Cyrillic fonts are available in the Ports
	Collection.</p><p>To activate a Russian keyboard, add the following to the
	<code class="literal">"Keyboard"</code> section of
	<code class="filename">/etc/xorg.conf</code>:</p><pre class="programlisting">Option "XkbLayout"   "us,ru"
Option "XkbOptions"  "grp:toggle"</pre><p>Make sure that <code class="literal">XkbDisable</code> is
	commented out in that file.</p><p>For <code class="literal">grp:toggle</code> use
	<span class="keycap"><strong>Right Alt</strong></span>, for
	<code class="literal">grp:ctrl_shift_toggle</code> use <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Shift</strong></span>.
	For <code class="literal">grp:caps_toggle</code> use
	<span class="keycap"><strong>CapsLock</strong></span>.  The old
	<span class="keycap"><strong>CapsLock</strong></span> function is still available in LAT
	mode only using <span class="keycap"><strong>Shift</strong></span>+<span class="keycap"><strong>CapsLock</strong></span>.
	<code class="literal">grp:caps_toggle</code> does not work in
	<span class="application">Xorg</span> for some unknown
	reason.</p><p>If the keyboard has <span class="quote">&#8220;<span class="quote"><span class="trademark">Windows</span>®</span>&#8221;</span> keys, and
	some non-alphabetical keys are mapped incorrectly, add the
	following line to <code class="filename">/etc/xorg.conf</code>:</p><pre class="programlisting">Option "XkbVariant" ",winkeys"</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The Russian XKB keyboard may not work with
	  non-localized applications.  Minimally localized
	  applications should call a <code class="function">XtSetLanguageProc
	    (NULL, NULL, NULL);</code> function early in the
	  program.</p></div><p>See <code class="uri"><a class="uri" href="http://koi8.pp.ru/xwin.html" target="_top">http://koi8.pp.ru/xwin.html</a></code>
	for more instructions on localizing
	<span class="application">Xorg</span> applications.  For more
	general information about KOI8-R encoding, refer to <code class="uri"><a class="uri" href="http://koi8.pp.ru/" target="_top">http://koi8.pp.ru/</a></code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64596472"></a>22.4.2. Additional Language-Specific Resources</h3></div></div></div><p>This section lists some additional resources for
	configuring other locales.</p><a id="idp64613880" class="indexterm"></a><a id="idp64615032" class="indexterm"></a><a id="idp64616184" class="indexterm"></a><a id="idp64617336" class="indexterm"></a><a id="idp64618488" class="indexterm"></a><div class="variablelist"><dl class="variablelist"><dt><span class="term">Traditional Chinese for Taiwan</span></dt><dd><p>The FreeBSD-Taiwan Project has a Chinese HOWTO for FreeBSD
	      at <code class="uri"><a class="uri" href="http://netlab.cse.yzu.edu.tw/~statue/freebsd/zh-tut/" target="_top">http://netlab.cse.yzu.edu.tw/~statue/freebsd/zh-tut/</a></code>.</p></dd><dt><span class="term">Greek Language Localization</span></dt><dd><p>A complete article on Greek support in FreeBSD
	      is available <a class="link" href="../../../../doc/el_GR.ISO8859-7/articles/greek-language-support/index.html" target="_top">here</a>,
	      in Greek only, as part of the official FreeBSD Greek
	      documentation.</p></dd><dt><span class="term">Japanese and Korean Language Localization</span></dt><dd><p>For Japanese, refer to <code class="uri"><a class="uri" href="http://www.jp.FreeBSD.org/" target="_top">http://www.jp.FreeBSD.org/</a></code>,
	      and for Korean, refer to <code class="uri"><a class="uri" href="http://www.kr.FreeBSD.org/" target="_top">http://www.kr.FreeBSD.org/</a></code>.</p></dd><dt><span class="term">Non-English FreeBSD Documentation</span></dt><dd><p>Some FreeBSD contributors have translated parts of the
	      FreeBSD documentation to other languages.  They are
	      available through links on the <a class="link" href="../../../../index.html" target="_top">FreeBSD web
		site</a> or in
	      <code class="filename">/usr/share/doc</code>.</p></dd></dl></div></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-upgrading"></a>Chapter 23. Updating and Upgrading FreeBSD</h2></div><div><span class="authorgroup">Restructured, reorganized, and parts updated
	  by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jim</span> <span class="surname">Mock</span></span>. </span></div><div><span class="authorgroup">Original work by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jordan</span> <span class="surname">Hubbard</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Poul-Henning</span> <span class="surname">Kamp</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">John</span> <span class="surname">Polstra</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Nik</span> <span class="surname">Clayton</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#updating-upgrading-synopsis">23.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#updating-upgrading-freebsdupdate">23.2. FreeBSD Update</a></span></dt><dt><span class="sect1"><a href="#updating-upgrading-documentation">23.3. Updating the Documentation Set</a></span></dt><dt><span class="sect1"><a href="#current-stable">23.4. Tracking a Development Branch</a></span></dt><dt><span class="sect1"><a href="#makeworld">23.5. Updating FreeBSD from Source</a></span></dt><dt><span class="sect1"><a href="#small-lan">23.6. Tracking for Multiple Machines</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="updating-upgrading-synopsis"></a>23.1. Synopsis</h2></div></div></div><p>FreeBSD is under constant development between releases.  Some
      people prefer to use the officially released versions, while
      others prefer to keep in sync with the latest developments.
      However, even official releases are often updated with security
      and other critical fixes.  Regardless of the version used, FreeBSD
      provides all the necessary tools to keep the system updated, and
      allows for easy upgrades between versions.  This chapter
      describes how to track the development system and the basic
      tools for keeping a FreeBSD system up-to-date.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to keep a FreeBSD system up-to-date with
	  <span class="application">freebsd-update</span> or
	  <span class="application">Subversion</span>.</p></li><li class="listitem"><p>How to compare the state of an installed system against
	  a known pristine copy.</p></li><li class="listitem"><p>How to keep the installed documentation up-to-date with
	  <span class="application">Subversion</span> or documentation
	  ports.</p></li><li class="listitem"><p>The difference between the two development
	  branches: FreeBSD-STABLE and FreeBSD-CURRENT.</p></li><li class="listitem"><p>How to rebuild and reinstall the entire base
	  system.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Properly set up the network connection
	  (<a class="xref" href="#advanced-networking" title="Chapter 31. Advanced Networking">Chapter 31, <em>Advanced Networking</em></a>).</p></li><li class="listitem"><p>Know how to install additional third-party
	  software (<a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a>).</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Throughout this chapter, <code class="command">svnlite</code> is used to
	obtain and update FreeBSD sources.  Optionally, the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/devel/subversion/pkg-descr">devel/subversion</a> port or
	package may be used.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="updating-upgrading-freebsdupdate"></a>23.2. FreeBSD Update</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Based on notes provided by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Colin</span> <span class="surname">Percival</span></span>. </span></div></div></div><a id="idp64666360" class="indexterm"></a><a id="idp64667128" class="indexterm"></a><p>Applying security patches in a timely manner and upgrading
      to a newer release of an operating system are important aspects
      of ongoing system administration.  FreeBSD includes a utility
      called <code class="command">freebsd-update</code> which can be used to
      perform both these tasks.</p><p>This utility supports binary security and errata updates to
      FreeBSD, without the need to manually compile and install the patch
      or a  new kernel.  Binary updates are available for all
      architectures and releases currently supported by the security
      team.  The list of supported releases and their estimated
      end-of-life dates are listed at <code class="uri"><a class="uri" href="https://www.FreeBSD.org/security/" target="_top">https://www.FreeBSD.org/security/</a></code>.</p><p>This utility also supports operating system upgrades to
      minor point releases as well as upgrades to another release
      branch.  Before upgrading to a new release, review its release
      announcement as it contains important information pertinent to
      the release.  Release announcements are available from <code class="uri"><a class="uri" href="https://www.FreeBSD.org/releases/" target="_top">https://www.FreeBSD.org/releases/</a></code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If a <code class="command">crontab</code> utilizing the features of
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a> exists, it must be disabled before
	upgrading the operating system.</p></div><p>This section describes the configuration file used by
      <code class="command">freebsd-update</code>, demonstrates how to apply a
      security patch and how to upgrade to a minor or major operating
      system release, and discusses some of the considerations when
      upgrading the operating system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-config-file"></a>23.2.1. The Configuration File</h3></div></div></div><p>The default configuration file for
	<code class="command">freebsd-update</code> works as-is.  Some users may
	wish to tweak the default configuration in
	<code class="filename">/etc/freebsd-update.conf</code>, allowing
	better control of the process.  The comments in this file
	explain the available options, but the following may require a
	bit more explanation:</p><pre class="programlisting"># Components of the base system which should be kept updated.
Components world kernel</pre><p>This parameter controls which parts of FreeBSD will be kept
	up-to-date.  The default is to update the entire base system
	and the kernel.  Individual components can instead be
	specified, such as <code class="literal">src/base</code> or
	<code class="literal">src/sys</code>.  However, the best option is to
	leave this at the default as changing it to include specific
	items requires every needed item to be listed.  Over time,
	this could have disastrous consequences as source code and
	binaries may become out of sync.</p><pre class="programlisting"># Paths which start with anything matching an entry in an IgnorePaths
# statement will be ignored.
IgnorePaths /boot/kernel/linker.hints</pre><p>To leave specified directories, such as
	<code class="filename">/bin</code> or <code class="filename">/sbin</code>,
	untouched during the update process, add their paths to this
	statement.  This option may be used to prevent
	<code class="command">freebsd-update</code> from overwriting local
	modifications.</p><pre class="programlisting"># Paths which start with anything matching an entry in an UpdateIfUnmodified
# statement will only be updated if the contents of the file have not been
# modified by the user (unless changes are merged; see below).
UpdateIfUnmodified /etc/ /var/ /root/ /.cshrc /.profile</pre><p>This option will only update unmodified configuration
	files in the specified directories.  Any changes made by the
	user will prevent the automatic updating of these files.
	There is another option,
	<code class="literal">KeepModifiedMetadata</code>, which will instruct
	<code class="command">freebsd-update</code> to save the changes during
	the merge.</p><pre class="programlisting"># When upgrading to a new FreeBSD release, files which match MergeChanges
# will have any local changes merged into the version from the new release.
MergeChanges /etc/ /var/named/etc/ /boot/device.hints</pre><p>List of directories with configuration files that
	<code class="command">freebsd-update</code> should attempt to merge.
	The file merge process is a series of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> patches
	similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a>, but with fewer options.
	Merges are either accepted, open an editor, or cause
	<code class="command">freebsd-update</code> to abort.  When in doubt,
	backup <code class="filename">/etc</code> and just accept the merges.
	See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> for more information about
	<code class="command">mergemaster</code>.</p><pre class="programlisting"># Directory in which to store downloaded updates and temporary
# files used by FreeBSD Update.
# WorkDir /var/db/freebsd-update</pre><p>This directory is where all patches and temporary files
	are placed.  In cases where the user is doing a version
	upgrade, this location should have at least a gigabyte of disk
	space available.</p><pre class="programlisting"># When upgrading between releases, should the list of Components be
# read strictly (StrictComponents yes) or merely as a list of components
# which *might* be installed of which FreeBSD Update should figure out
# which actually are installed and upgrade those (StrictComponents no)?
# StrictComponents no</pre><p>When this option is set to <code class="literal">yes</code>,
	<code class="command">freebsd-update</code> will assume that the
	<code class="literal">Components</code> list is complete and will not
	attempt to make changes outside of the list.  Effectively,
	<code class="command">freebsd-update</code> will attempt to update
	every file which belongs to the <code class="literal">Components</code>
	list.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-security-patches"></a>23.2.2. Applying Security Patches</h3></div></div></div><p>The process of applying FreeBSD security patches has been
	simplified, allowing an administrator to keep a system fully
	patched using <code class="command">freebsd-update</code>.  More
	information about FreeBSD security advisories can be found in
	<a class="xref" href="#security-advisories" title="13.11. FreeBSD Security Advisories">Section 13.11, &#8220;FreeBSD Security Advisories&#8221;</a>.</p><p>FreeBSD security patches may be downloaded and installed
	using the following commands.  The first command will
	determine if any outstanding patches are available, and if so,
	will list the files that will be modifed if the patches are
	applied.  The second command will apply the patches.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p>If the update applies any kernel patches, the system will
	need a reboot in order to boot into the patched kernel.  If
	the patch was applied to any running binaries, the affected
	applications should be restarted so that the patched version
	of the binary is used.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Usually, the user needs to be prepared to reboot the
	  system.  To know if a reboot is required by a kernel update,
	  execute the commands <code class="command">freebsd-version -k</code>
	  and <code class="command">uname -r</code> and if it differs a reboot
	  is required.</p></div><p>The system can be configured to automatically check for
	updates once every day by adding this entry to
	<code class="filename">/etc/crontab</code>:</p><pre class="programlisting">@daily                                  root    freebsd-update cron</pre><p>If patches exist, they will automatically be downloaded
	but will not be applied.  The <code class="systemitem">root</code> user will be sent an
	email so that the patches may be reviewed and manually
	installed with
	<code class="command">freebsd-update install</code>.</p><p>If anything goes wrong, <code class="command">freebsd-update</code>
	has the ability to roll back the last set of changes with the
	following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update rollback</code></strong>
Uninstalling updates... done.</pre><p>Again, the system should be restarted if the kernel or any
	kernel modules were modified and any affected binaries should
	be restarted.</p><p>Only the <code class="filename">GENERIC</code> kernel can be
	automatically updated by <code class="command">freebsd-update</code>.
	If a custom kernel is installed, it will have to be rebuilt
	and reinstalled after <code class="command">freebsd-update</code>
	finishes installing the updates.  The default kernel name
	is <span class="emphasis"><em>GENERIC</em></span>.  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a> command
	may be used to verify its installation.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Always keep a copy of the <code class="filename">GENERIC</code>
	  kernel in <code class="filename">/boot/GENERIC</code>.  It will be
	  helpful in diagnosing a variety of problems and in
	  performing version upgrades.  Refer to <a class="xref" href="#freebsd-update-custom-kernel-9x" title="23.2.3.1. Custom Kernels with FreeBSD 9.X and Later">Section 23.2.3.1, &#8220;Custom Kernels with FreeBSD 9.X and Later&#8221;</a> for
	  instructions on how to get a copy of the
	  <code class="filename">GENERIC</code> kernel.</p></div><p>Unless the default configuration in
	<code class="filename">/etc/freebsd-update.conf</code> has been
	changed, <code class="command">freebsd-update</code> will install the
	updated kernel sources along with the rest of the updates.
	Rebuilding and reinstalling a new custom kernel can then be
	performed in the usual way.</p><p>The updates distributed by
	<code class="command">freebsd-update</code> do not always involve the
	kernel.  It is not necessary to rebuild a custom kernel if the
	kernel sources have not been modified by
	<code class="command">freebsd-update install</code>.  However,
	<code class="command">freebsd-update</code> will always update
	<code class="filename">/usr/src/sys/conf/newvers.sh</code>.  The
	current patch level, as indicated by the <code class="literal">-p</code>
	number reported by <code class="command">uname -r</code>, is obtained
	from this file.  Rebuilding a custom kernel, even if nothing
	else changed, allows <code class="command">uname</code> to accurately
	report the current patch level of the system.  This is
	particularly helpful when maintaining multiple systems, as it
	allows for a quick assessment of the updates installed in each
	one.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-upgrade"></a>23.2.3. Performing Major and Minor Version Upgrades</h3></div></div></div><p>Upgrades from one minor version of FreeBSD to another, like
	from FreeBSD 9.0 to FreeBSD 9.1, are called
	<em class="firstterm">minor version</em> upgrades.
	<em class="firstterm">Major version</em> upgrades occur when FreeBSD
	is upgraded from one major version to another, like from
	FreeBSD 9.X to FreeBSD 10.X.  Both types of upgrades can
	be performed by providing <code class="command">freebsd-update</code>
	with a release version target.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If the system is running a custom kernel, make sure that
	  a copy of the <code class="filename">GENERIC</code> kernel exists in
	  <code class="filename">/boot/GENERIC</code> before starting the
	  upgrade.  Refer to <a class="xref" href="#freebsd-update-custom-kernel-9x" title="23.2.3.1. Custom Kernels with FreeBSD 9.X and Later">Section 23.2.3.1, &#8220;Custom Kernels with FreeBSD 9.X and Later&#8221;</a> for
	  instructions on how to get a copy of the
	  <code class="filename">GENERIC</code> kernel.</p></div><p>The following command, when run on a FreeBSD 9.0 system,
	will upgrade it to FreeBSD 9.1:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -r 9.1-RELEASE upgrade</code></strong></pre><p>After the command has been received,
	<code class="command">freebsd-update</code> will evaluate the
	configuration file and current system in an attempt to gather
	the information necessary to perform the upgrade.  A screen
	listing will display which components have and have not been
	detected.  For example:</p><pre class="screen">Looking up update.FreeBSD.org mirrors... 1 mirrors found.
Fetching metadata signature for 9.0-RELEASE from update1.FreeBSD.org... done.
Fetching metadata index... done.
Inspecting system... done.

The following components of FreeBSD seem to be installed:
kernel/smp src/base src/bin src/contrib src/crypto src/etc src/games
src/gnu src/include src/krb5 src/lib src/libexec src/release src/rescue
src/sbin src/secure src/share src/sys src/tools src/ubin src/usbin
world/base world/info world/lib32 world/manpages

The following components of FreeBSD do not seem to be installed:
kernel/generic world/catpages world/dict world/doc world/games
world/proflibs

Does this look reasonable (y/n)? <strong class="userinput"><code>y</code></strong></pre><p>At this point, <code class="command">freebsd-update</code> will
	attempt to download all files required for the upgrade.  In
	some cases, the user may be prompted with questions regarding
	what to install or how to proceed.</p><p>When using a custom kernel, the above step will produce a
	warning similar to the following:</p><pre class="screen">WARNING: This system is running a "<em class="replaceable"><code>MYKERNEL</code></em>" kernel, which is not a
kernel configuration distributed as part of FreeBSD 9.0-RELEASE.
This kernel will not be updated: you MUST update the kernel manually
before running "/usr/sbin/freebsd-update install"</pre><p>This warning may be safely ignored at this point.  The
	updated <code class="filename">GENERIC</code> kernel will be used as an
	intermediate step in the upgrade process.</p><p>Once all the patches have been downloaded to the local
	system, they will be applied.  This process may take a while,
	depending on the speed and workload of the machine.
	Configuration files will then be merged.  The merging process
	requires some user intervention as a file may be merged or an
	editor may appear on screen for a manual merge.  The results
	of every successful merge will be shown to the user as the
	process continues.  A failed or ignored merge will cause the
	process to abort.  Users may wish to make a backup of
	<code class="filename">/etc</code> and manually merge important files,
	such as <code class="filename">master.passwd</code> or
	<code class="filename">group</code> at a later time.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The system is not being altered yet as all patching and
	  merging is happening in another directory.  Once all patches
	  have been applied successfully, all configuration files have
	  been merged and it seems the process will go smoothly, the
	  changes can be committed to disk by the user using the
	  following command:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre></div><p>The kernel and kernel modules will be patched first.  If
	the system is running with a custom kernel, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=nextboot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">nextboot</span>(8)</span></a> to set the kernel for the next boot to the
	updated <code class="filename">/boot/GENERIC</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nextboot -k GENERIC</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Before rebooting with the <code class="filename">GENERIC</code>
	  kernel, make sure it contains all the drivers required for
	  the system to boot properly and connect to the network, if
	  the machine being updated is accessed remotely.  In
	  particular, if the running custom kernel contains built-in
	  functionality usually provided by kernel modules, make sure
	  to temporarily load these modules into the
	  <code class="filename">GENERIC</code> kernel using the
	  <code class="filename">/boot/loader.conf</code> facility.  It is
	  recommended to disable non-essential services as well as any
	  disk and network mounts until the upgrade process is
	  complete.</p></div><p>The machine should now be restarted with the updated
	kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre><p>Once the system has come back online, restart
	<code class="command">freebsd-update</code> using the following command.
	Since the state of the process has been saved,
	<code class="command">freebsd-update</code> will not start from the
	beginning, but will instead move on to the next phase and
	remove all old shared libraries and object files.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Depending upon whether any library version numbers were
	  bumped, there may only be two install phases instead of
	  three.</p></div><p>The upgrade is now complete.  If this was a major version
	upgrade, reinstall all ports and packages as described in
	<a class="xref" href="#freebsdupdate-portsrebuild" title="23.2.3.2. Upgrading Packages After a Major Version Upgrade">Section 23.2.3.2, &#8220;Upgrading Packages After a Major Version
	  Upgrade&#8221;</a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsd-update-custom-kernel-9x"></a>23.2.3.1. Custom Kernels with FreeBSD 9.X and Later</h4></div></div></div><p>Before using <code class="command">freebsd-update</code>, ensure
	  that a copy of the <code class="filename">GENERIC</code> kernel
	  exists in <code class="filename">/boot/GENERIC</code>.  If a custom
	  kernel has only been built once, the kernel in
	  <code class="filename">/boot/kernel.old</code> is the
	  <code class="literal">GENERIC</code> kernel.  Simply rename this
	  directory to <code class="filename">/boot/kernel</code>.</p><p>If a custom kernel has been built more than once or if
	  it is unknown how many times the custom kernel has been
	  built, obtain a copy of the <code class="literal">GENERIC</code>
	  kernel that matches the current version of the operating
	  system.  If physical access to the system is available, a
	  copy of the <code class="literal">GENERIC</code> kernel can be
	  installed from the installation media:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /cdrom</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /cdrom/usr/freebsd-dist</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar -C/ -xvf kernel.txz boot/kernel/kernel</code></strong></pre><p>Alternately, the <code class="literal">GENERIC</code> kernel may
	  be rebuilt and installed from source:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make kernel __MAKE_CONF=/dev/null SRCCONF=/dev/null</code></strong></pre><p>For this kernel to be identified as the
	  <code class="literal">GENERIC</code> kernel by
	  <code class="command">freebsd-update</code>, the
	  <code class="filename">GENERIC</code> configuration file must not
	  have been modified in any way.  It is also suggested that
	  the kernel is built without any other special
	  options.</p><p>Rebooting into the <code class="filename">GENERIC</code> kernel
	  is not required as <code class="command">freebsd-update</code> only
	  needs <code class="filename">/boot/GENERIC</code> to exist.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-portsrebuild"></a>23.2.3.2. Upgrading Packages After a Major Version
	  Upgrade</h4></div></div></div><p>Generally, installed applications will continue to work
	  without problems after minor version upgrades.  Major
	  versions use different Application Binary Interfaces
	  (<acronym class="acronym">ABI</acronym>s), which will break most
	  third-party applications.  After a major version upgrade,
	  all installed packages and ports need to be upgraded.
	  Packages can be upgraded using <code class="command">pkg
	    upgrade</code>.  To upgrade installed ports, use a
	  utility such as
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a>.</p><p>A forced upgrade of all installed packages will replace
	  the packages with fresh versions from the repository even if
	  the version number has not increased.  This is required
	  because of the ABI version change when upgrading between
	  major versions of FreeBSD.  The forced upgrade can be
	  accomplished by performing:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg-static upgrade -f</code></strong></pre><p>A rebuild of all installed applications can be
	  accomplished with this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -af</code></strong></pre><p>This command will display the configuration screens for
	  each application that has configurable options and wait for
	  the user to interact with those screens.  To prevent this
	  behavior, and use only the default options, include
	  <code class="option">-G</code> in the above command.</p><p>Once the software upgrades are complete, finish the
	  upgrade process with a final call to
	  <code class="command">freebsd-update</code> in order to tie up all the
	  loose ends in the upgrade process:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p>If the <code class="filename">GENERIC</code> kernel was
	  temporarily used, this is the time to build and install a
	  new custom kernel using the instructions in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>.</p><p>Reboot the machine into the new FreeBSD version.  The
	  upgrade process is now complete.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-system-comparison"></a>23.2.4. System State Comparison</h3></div></div></div><p>The state of the installed FreeBSD version against a known
	good copy can be tested using
	<code class="command">freebsd-update IDS</code>.  This command evaluates
	the current version of system utilities, libraries, and
	configuration files and can be used as a built-in Intrusion
	Detection System (<acronym class="acronym">IDS</acronym>).</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">This command is not a replacement for a real
	  <acronym class="acronym">IDS</acronym> such as
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/snort/pkg-descr">security/snort</a>.  As
	  <code class="command">freebsd-update</code> stores data on disk, the
	  possibility of tampering is evident.  While this possibility
	  may be reduced using <code class="varname">kern.securelevel</code> and
	  by storing the <code class="command">freebsd-update</code> data on a
	  read-only file system when not in use, a better solution
	  would be to compare the system against a secure disk, such
	  as a <acronym class="acronym">DVD</acronym> or securely stored external
	  <acronym class="acronym">USB</acronym> disk device.  An alternative method
	  for providing <acronym class="acronym">IDS</acronym> functionality using a
	  built-in utility is described in <a class="xref" href="#security-ids" title="13.2.6. Binary Verification">Section 13.2.6, &#8220;Binary Verification&#8221;</a></p></div><p>To begin the comparison, specify the output file to save
	the results to:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update IDS &gt;&gt; outfile.ids</code></strong></pre><p>The system will now be inspected and a lengthy listing of
	files, along with the <acronym class="acronym">SHA256</acronym> hash values
	for both the known value in the release and the current
	installation, will be sent to the specified output
	file.</p><p>The entries in the listing are extremely long, but the
	output format may be easily parsed.  For instance, to obtain a
	list of all files which differ from those in the release,
	issue the following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat outfile.ids | awk '{ print $1 }' | more</code></strong>
/etc/master.passwd
/etc/motd
/etc/passwd
/etc/pf.conf</pre><p>This sample output has been truncated as many more files
	exist.  Some files have natural modifications.  For example,
	<code class="filename">/etc/passwd</code> will be modified if users
	have been added to the system.  Kernel modules may differ as
	<code class="command">freebsd-update</code> may have updated them.  To
	exclude specific files or directories, add them to the
	<code class="literal">IDSIgnorePaths</code> option in
	<code class="filename">/etc/freebsd-update.conf</code>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="updating-upgrading-documentation"></a>23.3. Updating the Documentation Set</h2></div></div></div><a id="idp64876536" class="indexterm"></a><a id="idp64877048" class="indexterm"></a><p>Documentation is an integral part of the FreeBSD operating
      system.  While an up-to-date version of the FreeBSD documentation
      is always available on the FreeBSD web site (<a class="link" href="../../../../doc/" target="_top">https://www.freebsd.org/doc/</a>),
      it can be handy to have an up-to-date, local copy of the FreeBSD
      website, handbooks, <acronym class="acronym">FAQ</acronym>, and articles.</p><p>This section describes how to use either source or the FreeBSD
      Ports Collection to keep a local copy of the FreeBSD documentation
      up-to-date.</p><p>For information on editing and submitting corrections to the
      documentation, refer to the FreeBSD Documentation Project Primer
      for New Contributors (<a class="link" href="../../../../doc/en_US.ISO8859-1/books/fdp-primer" target="_top">https://www.freebsd.org/doc/en_US.ISO8859-1/books/fdp-primer/</a>).</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-installed-documentation"></a>23.3.1. Updating Documentation from Source</h3></div></div></div><p>Rebuilding the FreeBSD documentation from source requires a
	collection of tools which are not part of the FreeBSD base
	system.  The required tools can be installed from the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/textproc/docproj/pkg-descr">textproc/docproj</a> package or port developed
	by the FreeBSD Documentation Project.</p><p>Once installed, use <span class="application">svnlite</span> to
	fetch a clean copy of the documentation source:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svnlite checkout https://svn.FreeBSD.org/doc/head /usr/doc</code></strong></pre><p>The initial download of the documentation sources may take
	a while.  Let it run until it completes.</p><p>Future updates of the documentation sources may be fetched
	by running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svnlite update /usr/doc</code></strong></pre><p>Once an up-to-date snapshot of the documentation sources
	has been fetched to <code class="filename">/usr/doc</code>, everything
	is ready for an update of the installed documentation.</p><p>A full update of all available languages may be performed
	by typing:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/doc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>If an update of only a specific language is desired,
	<code class="command">make</code> can be invoked in a language-specific
	subdirectory of
	<code class="filename">/usr/doc</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/doc/en_US.ISO8859-1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>An alternative way of updating the documentation is to run
	this command from <code class="filename">/usr/doc</code> or the desired
	language-specific subdirectory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make update</code></strong></pre><p>The output formats that will be installed may be specified
	by setting <code class="varname">FORMATS</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/doc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make FORMATS='html html-split' install clean</code></strong></pre><p>Several options are available to ease the process of
	updating only parts of the documentation, or the build of
	specific translations.  These options can be set either as
	system-wide options in <code class="filename">/etc/make.conf</code>, or
	as command-line options passed to
	<code class="command">make</code>.</p><p>The options include:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="varname">DOC_LANG</code></span></dt><dd><p>The list of languages and encodings to build and
	      install, such as <code class="literal">en_US.ISO8859-1</code> for
	      English documentation.</p></dd><dt><span class="term"><code class="varname">FORMATS</code></span></dt><dd><p>A single format or a list of output formats to be
	      built.  Currently, <code class="literal">html</code>,
	      <code class="literal">html-split</code>, <code class="literal">txt</code>,
	      <code class="literal">ps</code>, and <code class="literal">pdf</code> are
	      supported.</p></dd><dt><span class="term"><code class="varname">DOCDIR</code></span></dt><dd><p>Where to install the documentation.  It defaults to
	      <code class="filename">/usr/share/doc</code>.</p></dd></dl></div><p>For more <code class="command">make</code> variables supported as
	system-wide options in FreeBSD, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="doc-ports-install-package"></a>23.3.2. Updating Documentation from Ports</h3></div><div><span class="authorgroup">Based on the work of <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp64922360" class="indexterm"></a><a id="idp64923128" class="indexterm"></a><p>The previous section presented a method for updating the
	FreeBSD documentation from sources.  This section describes an
	alternative method which uses the Ports Collection and makes
	it possible to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Install pre-built packages of the documentation,
	    without having to locally build anything or install the
	    documentation toolchain.</p></li><li class="listitem"><p>Build the documentation sources through the ports
	    framework, making the checkout and build steps a bit
	    easier.</p></li></ul></div><p>This method of updating the FreeBSD documentation is
	supported by a set of documentation ports and packages which
	are updated by the Documentation Engineering Team <code class="email">&lt;<a xmlns="" class="email" href="mailto:doceng@FreeBSD.org">doceng@FreeBSD.org</a>&gt;</code> on a monthly basis.  These are
	listed in the FreeBSD Ports Collection, under the docs
	category (<a class="link" href="http://www.freshports.org/docs/" target="_top">http://www.freshports.org/docs/</a>).</p><p>Organization of the documentation ports is as
	follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/misc/freebsd-doc-en/pkg-descr">misc/freebsd-doc-en</a> package or
	    port installs all of the English documentation.</p></li><li class="listitem"><p>The <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/misc/freebsd-doc-all/pkg-descr">misc/freebsd-doc-all</a>
	    meta-package or port installs all documentation in all
	    available languages.</p></li><li class="listitem"><p>There is a package and port for each translation, such
	    as <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/misc/freebsd-doc-hu/pkg-descr">misc/freebsd-doc-hu</a> for the
	    Hungarian documentation.</p></li></ul></div><p>When binary packages are used, the FreeBSD documentation will
	be installed in all available formats for the given language.
	For example, the following command will install the latest
	package of the Hungarian documentation:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install hu-freebsd-doc</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Packages use a format that differs from the
	  corresponding port's name:
	  <code class="literal"><em class="replaceable"><code>lang</code></em>-freebsd-doc</code>,
	  where <em class="replaceable"><code>lang</code></em> is the short format of
	  the language code, such as <code class="literal">hu</code> for
	  Hungarian, or <code class="literal">zh_cn</code> for Simplified
	  Chinese.</p></div><p>To specify the format of the documentation, build the port
	instead of installing the package.  For example, to build and
	install the English documentation:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/misc/freebsd-doc-en</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>The port provides a configuration menu where the format to
	build and install can be specified.  By default, split
	<acronym class="acronym">HTML</acronym>, similar to the format used on <code class="uri"><a class="uri" href="http://www.FreeBSD.org" target="_top">http://www.FreeBSD.org</a></code>,
	and <acronym class="acronym">PDF</acronym> are selected.</p><p>Alternately, several <code class="command">make</code> options can
	be specified when building a documentation port,
	including:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="varname">WITH_HTML</code></span></dt><dd><p>Builds the HTML format with a single HTML file per
	      document.  The formatted documentation is saved to a
	      file called <code class="filename">article.html</code>, or
	      <code class="filename">book.html</code>.</p></dd><dt><span class="term"><code class="varname">WITH_PDF</code></span></dt><dd><p>The formatted documentation is saved to a file
	      called <code class="filename">article.pdf</code> or
	      <code class="filename">book.pdf</code>.</p></dd><dt><span class="term"><code class="varname">DOCBASE</code></span></dt><dd><p>Specifies where to install the documentation.  It
	      defaults to
	      <code class="filename">/usr/local/share/doc/freebsd</code>.</p></dd></dl></div><p>This example uses variables to install the Hungarian
	documentation as a <acronym class="acronym">PDF</acronym> in the specified
	directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/misc/freebsd-doc-hu</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make -DWITH_PDF DOCBASE=share/doc/freebsd/hu install clean</code></strong></pre><p>Documentation packages or ports can be updated using the
	instructions in <a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a>.  For example, the
	following command updates the installed Hungarian
	documentation using <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a>
	by using packages only:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -PP hu-freebsd-doc</code></strong></pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="current-stable"></a>23.4. Tracking a Development Branch</h2></div></div></div><a id="idp64945272" class="indexterm"></a><a id="idp64945784" class="indexterm"></a><p>FreeBSD has two development branches: FreeBSD-CURRENT and
      FreeBSD-STABLE.</p><p>This section provides an explanation of each branch and its
      intended audience, as well as how to keep a system up-to-date
      with each respective branch.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="current"></a>23.4.1. Using FreeBSD-CURRENT</h3></div></div></div><p>FreeBSD-CURRENT is the <span class="quote">&#8220;<span class="quote">bleeding edge</span>&#8221;</span> of FreeBSD
	development and  FreeBSD-CURRENT users are expected to have a
	high degree of technical skill.  Less technical users who wish
	to track a development branch should track FreeBSD-STABLE
	instead.</p><p>FreeBSD-CURRENT is the very latest source code for FreeBSD and
	includes works in progress, experimental changes, and
	transitional mechanisms that might or might not be present in
	the next official release.  While many FreeBSD developers compile
	the FreeBSD-CURRENT source code daily, there are short periods of
	time when the source may not be buildable.  These problems are
	resolved as quickly as possible, but whether or not
	FreeBSD-CURRENT brings disaster or new functionality can be a
	matter of when the source code was synced.</p><p>FreeBSD-CURRENT is made available for three primary interest
	groups:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Members of the FreeBSD community who are actively
	    working on some part of the source tree.</p></li><li class="listitem"><p>Members of the FreeBSD community who are active testers.
	    They are willing to spend time solving problems, making
	    topical suggestions on changes and the general direction
	    of FreeBSD, and submitting patches.</p></li><li class="listitem"><p>Users who wish to keep an eye on things, use the
	    current source for reference purposes, or make the
	    occasional comment or code contribution.</p></li></ol></div><p>FreeBSD-CURRENT should <span class="emphasis"><em>not</em></span> be
	considered a fast-track to getting new features before the
	next release as pre-release features are not yet fully tested
	and most likely contain bugs.  It is not a quick way of
	getting bug fixes as any given commit is just as likely to
	introduce new bugs as to fix existing ones.  FreeBSD-CURRENT is
	not in any way <span class="quote">&#8220;<span class="quote">officially supported</span>&#8221;</span>.</p><a id="idp64981880" class="indexterm"></a><p>To track FreeBSD-CURRENT:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Join the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a> and the
	    <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-head" target="_top">svn-src-head</a> lists.  This is
	    <span class="emphasis"><em>essential</em></span> in order to see the
	    comments that people are making about the current state
	    of the system and to receive important bulletins about
	    the current state of FreeBSD-CURRENT.</p><p>The <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-head" target="_top">svn-src-head</a> list records the commit log
	    entry for each change as it is made, along with any
	    pertinent information on possible side effects.</p><p>To join these lists, go to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo" target="_top">http://lists.FreeBSD.org/mailman/listinfo</a>,
	    click on the list to subscribe to, and follow the
	    instructions.  In order to track changes to the whole
	    source tree, not just the changes to FreeBSD-CURRENT,
	    subscribe to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-all" target="_top">svn-src-all</a> list.</p></li><li class="listitem"><p>Synchronize with the FreeBSD-CURRENT sources.  Typically,
	    <a class="link" href="#svn" title="A.3. Using Subversion">svnlite</a> is used to check out the
	    -CURRENT code from the <code class="literal">head</code> branch of
	    one of the Subversion mirror sites listed in
	    <a class="xref" href="#svn-mirrors" title="A.3.6. Subversion Mirror Sites">Section A.3.6, &#8220;<span class="application">Subversion</span> Mirror
	Sites&#8221;</a>.</p></li><li class="listitem"><p>Due to the size of the repository, some users choose
	    to only synchronize the sections of source that interest
	    them  or which they are contributing patches to.  However,
	    users that plan to compile the operating system from
	    source must download <span class="emphasis"><em>all</em></span> of
	    FreeBSD-CURRENT, not just selected portions.</p><p>Before compiling FreeBSD-CURRENT
	    <a id="idp65003768" class="indexterm"></a>, read <code class="filename">/usr/src/Makefile</code>
	    very carefully and follow the instructions in
	    <a class="xref" href="#makeworld" title="23.5. Updating FreeBSD from Source">Section 23.5, &#8220;Updating FreeBSD from Source&#8221;</a>.
	    Read the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">FreeBSD-CURRENT mailing list</a> and
	    <code class="filename">/usr/src/UPDATING</code> to stay
	    up-to-date on other bootstrapping procedures that
	    sometimes become necessary on the road to the next
	    release.</p></li><li class="listitem"><p>Be active! FreeBSD-CURRENT users are encouraged to
	    submit their suggestions for enhancements or bug fixes.
	    Suggestions with accompanying code are always
	    welcome.</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="stable"></a>23.4.2. Using FreeBSD-STABLE</h3></div></div></div><p>FreeBSD-STABLE is the development branch from which major
	releases are made.  Changes go into this branch at a slower
	pace and with the general assumption that they have first been
	tested in FreeBSD-CURRENT.  This is <span class="emphasis"><em>still</em></span> a
	development branch and, at any given time, the sources for
	FreeBSD-STABLE may or may not be suitable for general use.  It is
	simply another engineering development track, not a resource
	for end-users.  Users who do not have the resources to perform
	testing should instead run the most recent release of
	FreeBSD.</p><p>Those interested in tracking or contributing to the FreeBSD
	development process, especially as it relates to the next
	release of FreeBSD, should consider following FreeBSD-STABLE.</p><p>While the FreeBSD-STABLE branch should compile and run at all
	times, this cannot be guaranteed.  Since more people run
	FreeBSD-STABLE than FreeBSD-CURRENT, it is inevitable that bugs and
	corner cases will sometimes be found in FreeBSD-STABLE that were
	not apparent in FreeBSD-CURRENT.  For this reason, one should not
	blindly track FreeBSD-STABLE.  It is particularly important
	<span class="emphasis"><em>not</em></span> to update any production servers to
	FreeBSD-STABLE without thoroughly testing the code in a
	development or testing environment.</p><p>To track FreeBSD-STABLE:</p><a id="idp65031416" class="indexterm"></a><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Join the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable" target="_top">freebsd-stable</a> list in order to stay
	    informed of build dependencies that may appear in
	    FreeBSD-STABLE or any other issues requiring special
	    attention.  Developers will also make announcements in
	    this mailing list when they are contemplating some
	    controversial fix or update, giving the users a chance to
	    respond if they have any issues to raise concerning the
	    proposed change.</p><p>Join the relevant <span class="application">svn</span> list
	    for the branch being tracked.  For example, users
	    tracking the 9-STABLE branch should join the
	    <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-9" target="_top">svn-src-stable-9</a> list.  This list records the
	    commit log entry for each change as it is made, along
	    with any pertinent information on possible
	    side effects.</p><p>To join these lists, go to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo" target="_top">http://lists.FreeBSD.org/mailman/listinfo</a>,
	    click on the list to subscribe to, and follow the
	    instructions.  In order to track changes for the whole
	    source tree, subscribe to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-all" target="_top">svn-src-all</a>.</p></li><li class="listitem"><p>To install a new FreeBSD-STABLE system, install the most
	    recent FreeBSD-STABLE release from the <a class="link" href="#mirrors" title="Appendix A. Obtaining FreeBSD">FreeBSD mirror sites</a> or use a
	    monthly snapshot built from FreeBSD-STABLE.  Refer to <a class="link" href="../../../../snapshots/" target="_top">www.freebsd.org/snapshots</a>
	    for more information about snapshots.</p><p>To compile or upgrade to an existing FreeBSD system to
	    FreeBSD-STABLE, use <a class="link" href="#svn" title="A.3. Using Subversion">svn</a>
	      <a id="idp65039352" class="indexterm"></a> to check out the source for the desired
	    branch.  Branch names, such as
	    <code class="literal">stable/9</code>, are listed at <a class="link" href="../../../../releng/" target="_top">www.freebsd.org/releng</a>.</p></li><li class="listitem"><p>Before compiling or upgrading to FreeBSD-STABLE
	    <a id="idp65041784" class="indexterm"></a>, read <code class="filename">/usr/src/Makefile</code>
	    carefully and follow the instructions in <a class="xref" href="#makeworld" title="23.5. Updating FreeBSD from Source">Section 23.5, &#8220;Updating FreeBSD from Source&#8221;</a>.  Read the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable" target="_top">FreeBSD-STABLE mailing list</a> and
	    <code class="filename">/usr/src/UPDATING</code> to keep up-to-date
	    on other bootstrapping procedures that sometimes become
	    necessary on the road to the next release.</p></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makeworld"></a>23.5. Updating FreeBSD from Source</h2></div></div></div><p>Updating FreeBSD by compiling from source offers several
      advantages over binary updates.  Code can be built with options
      to take advantage of specific hardware.  Parts of the base
      system can be built with non-default settings, or left out
      entirely where they are not needed or desired.  The build
      process takes longer to update a system than just installing
      binary updates, but allows complete customization to produce
      a tailored version of FreeBSD.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-quick-start"></a>23.5.1. Quick Start</h3></div></div></div><p>This is a quick reference for the typical steps used to
	update FreeBSD by building from source.  Later sections describe
	the process in more detail.</p><div class="procedure"><ul class="procedure"><li class="step"><p class="title"><strong>Update and Build</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svnlite update /usr/src</code></strong>  <a id="updating-src-qs-svnup"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<span class="emphasis"><em>check <code class="filename">/usr/src/UPDATING</code></em></span>  <a id="updating-src-qs-review-updating"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>          <a id="updating-src-qs-cd"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make -j<em class="replaceable"><code>4</code></em> buildworld</code></strong>  <a id="updating-src-qs-buildworld"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make -j<em class="replaceable"><code>4</code></em> kernel</code></strong>      <a id="updating-src-qs-kernel"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong>      <a id="updating-src-qs-reboot"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>          <a id="updating-src-qs-cd2"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld</code></strong>    <a id="updating-src-qs-installworld"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>mergemaster -Ui</code></strong>      <a id="updating-src-qs-mergemaster"></a><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong>      <a id="updating-src-qs-shutdown"></a><span><img src="./imagelib/callouts/10.png" alt="10" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-svnup"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Get the latest version of the source.  See
		<a class="xref" href="#updating-src-obtaining-src" title="23.5.3. Updating the Source">Section 23.5.3, &#8220;Updating the Source&#8221;</a> for
		more information on obtaining and updating
		source.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-review-updating"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Check <code class="filename">/usr/src/UPDATING</code>
		for any manual steps required before or after building
		from source.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-cd"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Go to the source directory.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-buildworld"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Compile the world, everything except the
		kernel.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-kernel"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Compile and install the kernel.  This is
		equivalent to <code class="command">make buildkernel
		  installkernel</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-reboot"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Reboot the system to the new kernel.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-cd2"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Go to the source directory.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-installworld"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Install the world.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-mergemaster"><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Update and merge configuration files in
		<code class="filename">/etc/</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-qs-shutdown"><span><img src="./imagelib/callouts/10.png" alt="10" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Restart the system to use the newly-built world
		and kernel.</p></td></tr></table></div></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-preparing"></a>23.5.2. Preparing for a Source Update</h3></div></div></div><p>Read <code class="filename">/usr/src/UPDATING</code>.  Any manual
	steps that must be performed before or after an update are
	described in this file.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-obtaining-src"></a>23.5.3. Updating the Source</h3></div></div></div><p>FreeBSD source code is located in
	<code class="filename">/usr/src/</code>.  The preferred method of
	updating this source is through the
	<span class="application">Subversion</span> version control system.
	Verify that the source code is under version control:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svnlite info /usr/src</code></strong>
Path: /usr/src
Working Copy Root Path: /usr/src
...</pre><p>This indicates that <code class="filename">/usr/src/</code>
	is under version control and can be updated with
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=svnlite&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">svnlite</span>(1)</span></a>:</p><a id="synching"></a><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svnlite update /usr/src</code></strong></pre><p>The update process can take some time if the directory has
	not been updated recently.  After it finishes, the source code
	is up to date and the build process described in the next
	section can begin.</p><div xmlns="" class="note"><h3 class="admontitle"><a xmlns="http://www.w3.org/1999/xhtml" id="updating-src-obtaining-src-checkout"></a>Obtaining the Source: </h3><p xmlns="http://www.w3.org/1999/xhtml">If the output says
	  <code class="literal">'/usr/src' is not a working copy</code>, the
	  files there are missing or were installed with a different
	  method.  A new checkout of the source is required.</p><div xmlns="http://www.w3.org/1999/xhtml" class="table"><a id="updating-src-obtaining-src-repopath"></a><div class="table-title">Table 23.1. FreeBSD Versions and Repository Paths</div><div class="table-contents"><table class="table" summary="FreeBSD Versions and Repository Paths" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th><code class="command">uname -r</code> Output</th><th>Repository Path</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal"><em class="replaceable"><code>X.Y</code></em>-RELEASE</code></td><td><code class="literal">base/releng/</code><em class="replaceable"><code>X.Y</code></em></td><td>The Release version plus only critical security
		  and bug fix patches.  This branch is recommended
		  for most users.</td></tr><tr><td><a id="STABLE"></a><code class="literal"><em class="replaceable"><code>X.Y</code></em>-STABLE</code></td><td><code class="literal">base/stable/</code><em class="replaceable"><code>X</code></em></td><td>
		  <p>The Release version plus all additional
		    development on that branch.
		    <span class="emphasis"><em>STABLE</em></span> refers to the
		    Applications Binary Interface
		    (<acronym class="acronym">ABI</acronym>) not changing, so software
		    compiled for earlier versions still runs.  For
		    example, software compiled to run on FreeBSD 10.1
		    will still run on FreeBSD 10-STABLE compiled
		    later.</p>

		  <p>STABLE branches occasionally have bugs or
		    incompatibilities which might affect users,
		    although these are typically fixed quickly.</p>
		</td></tr><tr><td><code class="literal"><em class="replaceable"><code>X</code></em>-CURRENT</code></td><td><code class="literal">base/head/</code></td><td>The latest unreleased development version of
		  FreeBSD.  The CURRENT branch can have major bugs or
		  incompatibilities and is recommended only for
		  advanced users.</td></tr></tbody></table></div></div><br xmlns="http://www.w3.org/1999/xhtml" class="table-break" /><p xmlns="http://www.w3.org/1999/xhtml">Determine which version of FreeBSD is being used with
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>uname -r</code></strong>
10.3-RELEASE</pre><p xmlns="http://www.w3.org/1999/xhtml">Based on
	  <a class="xref" href="#updating-src-obtaining-src-repopath" title="Table 23.1. FreeBSD Versions and Repository Paths">Table 23.1, &#8220;FreeBSD Versions and Repository Paths&#8221;</a>, the
	  source used to update <code class="literal">10.3-RELEASE</code> has
	  a repository path of <code class="literal">base/releng/10.3</code>.
	  That path is used when checking out the source:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mv /usr/src /usr/src.bak</code></strong>  <a id="updating-src-obtaining-src-mv"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>svnlite checkout https://svn.freebsd.org/base/<em class="replaceable"><code>releng/10.3</code></em> /usr/src</code></strong>  <a id="updating-src-obtaining-src-checkout-cmd"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></pre><div xmlns="http://www.w3.org/1999/xhtml" class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-obtaining-src-mv"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Move the old directory out of the way.  If there are
	      no local modifications in this directory, it can be
	      deleted.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#updating-src-obtaining-src-checkout-cmd"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The path from
	      <a class="xref" href="#updating-src-obtaining-src-repopath" title="Table 23.1. FreeBSD Versions and Repository Paths">Table 23.1, &#8220;FreeBSD Versions and Repository Paths&#8221;</a> is
	      added to the repository <acronym class="acronym">URL</acronym>.  The
	      third parameter is the destination directory for the
	      source code on the local system.</p></td></tr></table></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-building"></a>23.5.4. Building from Source</h3></div></div></div><p>The <span class="emphasis"><em>world</em></span>, or all
	of the operating system except the kernel, is compiled.  This
	is done first to provide up-to-date tools to build the kernel.
	Then the kernel itself is built:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildkernel</code></strong></pre><p>The compiled code is written to
	<code class="filename">/usr/obj</code>.</p><p>These are the basic steps.  Additional options to control
	the build are described below.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-building-clean-build"></a>23.5.4.1. Performing a Clean Build</h4></div></div></div><p>Some versions of the FreeBSD build system leave
	  previously-compiled code in the temporary object directory,
	  <code class="filename">/usr/obj</code>.  This can speed up later
	  builds by avoiding recompiling code that has not changed.
	  To force a clean rebuild of everything, use
	  <code class="buildtarget">cleanworld</code> before starting
	  a build:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make cleanworld</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-building-jobs"></a>23.5.4.2. Setting the Number of Jobs</h4></div></div></div><p>Increasing the number of build jobs on multi-core
	  processors can improve build speed.  Determine the number of
	  cores with <code class="command">sysctl hw.ncpu</code>.  Processors
	  vary, as do the build systems used with different versions
	  of FreeBSD, so testing is the only sure method to tell how a
	  different number of jobs affects the build speed.  For a
	  starting point, consider values between half and double the
	  number of cores.  The number of jobs is specified with
	  <code class="option">-j</code>.</p><div class="example"><a id="updating-src-building-jobs-example"></a><div class="example-title">Example 23.1. Increasing the Number of Build Jobs</div><div class="example-contents"><p>Building the world and kernel with four jobs:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -j4 buildworld buildkernel</code></strong></pre></div></div><br class="example-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-building-only-kernel"></a>23.5.4.3. Building Only the Kernel</h4></div></div></div><p>A <code class="buildtarget">buildworld</code> must be
	  completed if the source code has changed.  After that, a
	  <code class="buildtarget">buildkernel</code> to build a kernel can
	  be run at any time.  To build just the kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildkernel</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-building-custom-kernel"></a>23.5.4.4. Building a Custom Kernel</h4></div></div></div><p>The standard FreeBSD kernel is based on a
	  <span class="emphasis"><em>kernel config file</em></span> called
	  <code class="filename">GENERIC</code>.  The
	  <code class="filename">GENERIC</code> kernel includes the most
	  commonly-needed device drivers and options.  Sometimes it
	  is useful or necessary to build a custom kernel, adding or
	  removing device drivers or options to fit a specific
	  need.</p><p>For example, someone developing a small embedded
	  computer with severely limited <acronym class="acronym">RAM</acronym> could
	  remove unneeded device drivers or options to make the kernel
	  slightly smaller.</p><p>Kernel config files are located in
	  <code class="filename">/usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf/</code>,
	  where <em class="replaceable"><code>arch</code></em> is the output from
	  <code class="command">uname -m</code>.  On most computers, that is
	  <code class="literal">amd64</code>, giving a config file directory of
	  <code class="filename">/usr/src/sys/<em class="replaceable"><code>amd64</code></em>/conf/</code>.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="filename">/usr/src</code> can be deleted or
	    recreated, so it is preferable to keep custom kernel
	    config files in a separate directory, like
	    <code class="filename">/root</code>.  Link the kernel config file
	    into the <code class="filename">conf</code> directory.  If that
	    directory is deleted or overwritten, the kernel config
	    can be re-linked into the new one.</p></div><p>A custom config file can be created by copying the
	  <code class="filename">GENERIC</code> config file.  In this example,
	  the new custom kernel is for a storage server, so is named
	  <code class="filename">STORAGESERVER</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /usr/src/sys/amd64/conf/GENERIC /root/STORAGESERVER</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/amd64/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /root/STORAGESERVER .</code></strong></pre><p><code class="filename">/root/STORAGESERVER</code> is then edited,
	  adding or removing devices or options as shown in
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">config</span>(5)</span></a>.</p><p>The custom kernel is built by setting
	  <code class="varname">KERNCONF</code> to the kernel config file on the
	  command line:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=STORAGESERVER</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-installing"></a>23.5.5. Installing the Compiled Code</h3></div></div></div><p>After the <code class="buildtarget">buildworld</code> and
	<code class="buildtarget">buildkernel</code> steps have been
	completed, the new kernel and world are installed:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installkernel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre><p>If a custom kernel was built, <code class="varname">KERNCONF</code>
	must also be set to use the new custom kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=STORAGESERVER</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-completing"></a>23.5.6. Completing the Update</h3></div></div></div><p>A few final tasks complete the update.  Any modified
	configuration files are merged with the new versions, outdated
	libraries are located and removed, then the system is
	restarted.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-completing-merge-mergemaster"></a>23.5.6.1. Merging Configuration Files with
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a></h4></div></div></div><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> provides an easy
	  way to merge changes that have been made to system
	  configuration files with new versions of those files.</p><p>With <code class="option">-Ui</code>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a>
	  automatically updates files that have not been user-modified
	  and installs new files that are not already present:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mergemaster -Ui</code></strong></pre><p>If a file must be manually merged, an interactive
	  display allows the user to choose which portions of the
	  files are kept.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> for more
	  information.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-completing-check-old"></a>23.5.6.2. Checking for Outdated Files and Libraries</h4></div></div></div><p>Some obsolete files or directories can remain after an
	  update.  These files can be located:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make check-old</code></strong></pre><p>and deleted:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make delete-old</code></strong></pre><p>Some obsolete libraries can also remain.  These can be
	  detected with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make check-old-libs</code></strong></pre><p>and deleted with</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make delete-old-libs</code></strong></pre><p>Programs which were still using those old libraries will
	  stop working when the library has been deleted.  These
	  programs must be rebuilt or replaced after deleting the old
	  libraries.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">When all the old files or directories are known to be
	    safe to delete, pressing <span class="keycap"><strong>y</strong></span> and
	    <span class="keycap"><strong>Enter</strong></span> to delete each file can be avoided
	    by setting <code class="varname">BATCH_DELETE_OLD_FILES</code> in
	    the command.  For example:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make BATCH_DELETE_OLD_FILES=yes delete-old-libs</code></strong></pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-src-completing-restart"></a>23.5.6.3. Restarting After the Update</h4></div></div></div><p>The last step after updating is to restart the computer
	  so all the changes take effect:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="small-lan"></a>23.6. Tracking for Multiple Machines</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mike</span> <span class="surname">Meyer</span></span>. </span></div></div></div><a id="idp65247352" class="indexterm"></a><p>When multiple machines need to track the same source tree,
      it is a waste of disk space, network bandwidth, and
      <acronym class="acronym">CPU</acronym> cycles to have each system download the
      sources and rebuild everything.  The solution is to have one
      machine do most of the work, while the rest of the machines
      mount that work via <acronym class="acronym">NFS</acronym>.  This section
      outlines a method of doing so.  For more information about using
      <acronym class="acronym">NFS</acronym>, refer to <a class="xref" href="#network-nfs" title="29.3. Network File System (NFS)">Section 29.3, &#8220;Network File System (NFS)&#8221;</a>.</p><p>First, identify a set of machines which will run the same
      set of binaries, known as a <em class="firstterm">build set</em>.
      Each machine can have a custom kernel, but will run the same
      userland binaries.  From that set, choose a machine to be the
      <em class="firstterm">build machine</em> that the world and kernel
      are built on.  Ideally, this is a fast machine that has
      sufficient spare <acronym class="acronym">CPU</acronym> to run <code class="command">make
	buildworld</code> and <code class="command">make
	buildkernel</code>.</p><p>Select a machine to be the <em class="firstterm">test
	machine</em>, which will test software updates before
      they are put into production.  This <span class="emphasis"><em>must</em></span> be
      a machine that can afford to be down for an extended period of
      time.  It can be the build machine, but need not be.</p><p>All the machines in this build set need to mount
      <code class="filename">/usr/obj</code> and <code class="filename">/usr/src</code>
      from the build machine via <acronym class="acronym">NFS</acronym>.  For multiple
      build sets, <code class="filename">/usr/src</code> should be on one build
      machine, and <acronym class="acronym">NFS</acronym> mounted on the rest.</p><p>Ensure that <code class="filename">/etc/make.conf</code> and
      <code class="filename">/etc/src.conf</code> on all the machines in the
      build set agree with the build machine.  That means that the
      build machine must build all the parts of the base system that
      any machine in the build set is going to install.  Also, each
      build machine should have its kernel name set with
      <code class="varname">KERNCONF</code> in
      <code class="filename">/etc/make.conf</code>, and the build machine
      should list them all in its <code class="varname">KERNCONF</code>,
      listing its own kernel first.  The build machine must have the
      kernel configuration files for each machine in its <code class="filename">/usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf</code>.</p><p>On the build machine, build the kernel and world as
      described in <a class="xref" href="#makeworld" title="23.5. Updating FreeBSD from Source">Section 23.5, &#8220;Updating FreeBSD from Source&#8221;</a>, but do not install
      anything on the build machine.  Instead, install the built
      kernel on the test machine.  On the test machine, mount
      <code class="filename">/usr/src</code> and
      <code class="filename">/usr/obj</code> via <acronym class="acronym">NFS</acronym>.  Then,
      run <code class="command">shutdown now</code> to go to single-user mode in
      order to install the new kernel and world and run
      <code class="command">mergemaster</code> as usual.  When done, reboot to
      return to normal multi-user operations.</p><p>After verifying that everything on the test machine is
      working properly, use the same procedure to install the new
      software on each of the other machines in the build set.</p><p>The same methodology can be used for the ports tree.  The
      first step is to share <code class="filename">/usr/ports</code> via
      <acronym class="acronym">NFS</acronym> to all the machines in the build set.  To
      configure <code class="filename">/etc/make.conf</code> to share
      distfiles, set <code class="varname">DISTDIR</code> to a common shared
      directory that is writable by whichever user <code class="systemitem">root</code> is mapped to by the
      <acronym class="acronym">NFS</acronym> mount.  Each machine should set
      <code class="varname">WRKDIRPREFIX</code> to a local build directory, if
      ports are to be built locally.  Alternately, if the build system
      is to build and distribute packages to the machines in the build
      set, set <code class="varname">PACKAGES</code> on the build system to a
      directory similar to <code class="varname">DISTDIR</code>.</p></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dtrace"></a>Chapter 24. DTrace</h2></div><div><span class="authorgroup">Written
	by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#dtrace-synopsis">24.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#dtrace-implementation">24.2. Implementation Differences</a></span></dt><dt><span class="sect1"><a href="#dtrace-enable">24.3. Enabling DTrace Support</a></span></dt><dt><span class="sect1"><a href="#dtrace-using">24.4. Using DTrace</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-synopsis"></a>24.1. Synopsis</h2></div></div></div><a id="idp65287544" class="indexterm"></a><a id="idp65288056" class="indexterm"></a><p>DTrace, also known as Dynamic Tracing, was developed by
      <span class="trademark">Sun</span>&#8482; as a tool for locating performance bottlenecks in
      production and pre-production systems.  In addition to
      diagnosing performance problems, DTrace can be used to help
      investigate and debug unexpected behavior in both the FreeBSD
      kernel and in userland programs.</p><p>DTrace is a remarkable profiling tool, with an impressive
      array of features for diagnosing system issues.  It may also be
      used to run pre-written scripts to take advantage of its
      capabilities.  Users can author their own utilities using the
      DTrace D Language, allowing them to customize their profiling
      based on specific needs.</p><p>The FreeBSD implementation provides full support for kernel
      DTrace and experimental support for userland DTrace.
      Userland DTrace allows users to perform function boundary
      tracing for userland programs using the <code class="literal">pid</code>
      provider, and to insert static probes into userland programs for
      later tracing.  Some ports, such as
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/databases/postgresql12-server/pkg-descr">databases/postgresql12-server</a> and
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/lang/php74/pkg-descr">lang/php74</a> have a DTrace option to enable
      static probes.</p><p>The official guide to DTrace is maintained by the Illumos
      project at <code class="uri"><a class="uri" href="http://dtrace.org/guide" target="_top">DTrace
	Guide</a></code>.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>What DTrace is and what features it provides.</p></li><li class="listitem"><p>Differences between the <span class="trademark">Solaris</span>&#8482; DTrace
	  implementation and the one provided by FreeBSD.</p></li><li class="listitem"><p>How to enable and use DTrace on FreeBSD.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand <span class="trademark">UNIX</span>® and FreeBSD basics
	  (<a class="xref" href="#basics" title="Chapter 3. FreeBSD Basics">Chapter 3, <em>FreeBSD Basics</em></a>).</p></li><li class="listitem"><p>Have some familiarity with security and how it pertains
	  to FreeBSD (<a class="xref" href="#security" title="Chapter 13. Security">Chapter 13, <em>Security</em></a>).</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-implementation"></a>24.2. Implementation Differences</h2></div></div></div><p>While the DTrace in FreeBSD is similar to that found in
      <span class="trademark">Solaris</span>&#8482;, differences do exist.  The primary difference is that
      in FreeBSD, DTrace is implemented as a set of kernel modules and
      DTrace can not be used until the modules are loaded.  To load
      all of the necessary modules:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload dtraceall</code></strong></pre><p>Beginning with FreeBSD 10.0-RELEASE, the modules are
      automatically loaded when <code class="command">dtrace</code> is
      run.</p><p>FreeBSD uses the <code class="literal">DDB_CTF</code> kernel option to
      enable support for loading <acronym class="acronym">CTF</acronym> data from
      kernel modules and the kernel itself.  <acronym class="acronym">CTF</acronym> is
      the <span class="trademark">Solaris</span>&#8482; Compact C Type Format which encapsulates a reduced
      form of debugging information similar to
      <acronym class="acronym">DWARF</acronym> and the venerable stabs.
      <acronym class="acronym">CTF</acronym> data is added to binaries by the
      <code class="command">ctfconvert</code> and <code class="command">ctfmerge</code>
      build tools.  The <code class="command">ctfconvert</code> utility parses
      <acronym class="acronym">DWARF</acronym> <acronym class="acronym">ELF</acronym> debug sections
      created by the compiler and <code class="command">ctfmerge</code> merges
      <acronym class="acronym">CTF</acronym> <acronym class="acronym">ELF</acronym> sections from
      objects into either executables or shared libraries.</p><p>Some different providers exist for FreeBSD than for <span class="trademark">Solaris</span>&#8482;.
      Most notable is the <code class="literal">dtmalloc</code> provider, which
      allows tracing <code class="function">malloc()</code> by type in the FreeBSD
      kernel.  Some of the providers found in <span class="trademark">Solaris</span>&#8482;, such as
      <code class="literal">cpc</code> and <code class="literal">mib</code>, are not
      present in FreeBSD.  These may appear in future versions of FreeBSD.
      Moreover, some of the providers available in both operating
      systems are not compatible, in the sense that their probes have
      different argument types.  Thus, <acronym class="acronym">D</acronym> scripts
      written on <span class="trademark">Solaris</span>&#8482; may or may not work unmodified on FreeBSD, and
      vice versa.</p><p>Due to security differences, only <code class="systemitem">root</code> may use DTrace on FreeBSD.
      <span class="trademark">Solaris</span>&#8482; has a few low level security checks which do not yet
      exist in FreeBSD.  As such, the
      <code class="filename">/dev/dtrace/dtrace</code> is strictly limited to
      <code class="systemitem">root</code>.</p><p>DTrace falls under the Common Development and Distribution
      License (<acronym class="acronym">CDDL</acronym>) license.  To view this license
      on FreeBSD, see
      <code class="filename">/usr/src/cddl/contrib/opensolaris/OPENSOLARIS.LICENSE</code>
      or view it online at <code class="uri"><a class="uri" href="http://opensource.org/licenses/CDDL-1.0" target="_top">http://opensource.org/licenses/CDDL-1.0</a></code>.
      While a FreeBSD kernel with DTrace support is
      <acronym class="acronym">BSD</acronym> licensed, the <acronym class="acronym">CDDL</acronym> is
      used when the modules are distributed in binary form or the
      binaries are loaded.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-enable"></a>24.3. Enabling DTrace Support</h2></div></div></div><p>In FreeBSD 9.2 and 10.0, DTrace support is built into the
      <code class="filename">GENERIC</code> kernel.  Users of earlier versions
      of FreeBSD or who prefer to statically compile in DTrace support
      should add the following lines to a custom kernel configuration
      file and recompile the kernel using the instructions in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>:</p><pre class="programlisting">options         KDTRACE_HOOKS
options         DDB_CTF
makeoptions	DEBUG=-g
makeoptions	WITH_CTF=1</pre><p>Users of the AMD64 architecture should also add this
      line:</p><pre class="programlisting">options         KDTRACE_FRAME</pre><p>This option provides support for <acronym class="acronym">FBT</acronym>.
      While DTrace will work without this option, there will be
      limited support for function boundary tracing.</p><p>Once the FreeBSD system has rebooted into the new kernel, or
      the DTrace kernel modules have been loaded using
      <code class="command">kldload dtraceall</code>, the system will need
      support for the Korn shell as the DTrace
      Toolkit has several utilities written in <code class="command">ksh</code>.
      Make sure that the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/shells/ksh93/pkg-descr">shells/ksh93</a> package or
      port is installed.  It is also possible to run these tools under
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/shells/pdksh/pkg-descr">shells/pdksh</a> or
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/shells/mksh/pkg-descr">shells/mksh</a>.</p><p>Finally, install the current DTrace Toolkit,
      a collection of ready-made scripts
      for collecting system information.  There are scripts to check
      open files, memory, <acronym class="acronym">CPU</acronym> usage, and a lot
      more.  FreeBSD 10
      installs a few of these scripts into
      <code class="filename">/usr/share/dtrace</code>.  On other FreeBSD versions,
      or to install the full
      DTrace Toolkit, use the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/DTraceToolkit/pkg-descr">sysutils/DTraceToolkit</a> package or
      port.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The scripts found in
	<code class="filename">/usr/share/dtrace</code> have been specifically
	ported to FreeBSD.  Not all of the scripts found in the DTrace
	Toolkit will work as-is on FreeBSD and some scripts may require
	some effort in order for them to work on FreeBSD.</p></div><p>The DTrace Toolkit includes many scripts in the special
      language of DTrace.  This language is called the D language
      and it is very similar to C++.  An in depth discussion of the
      language is beyond the scope of this document.  It is
      covered extensively in the <code class="uri"><a class="uri" href="http://www.dtrace.org/guide" target="_top">Illumos Dynamic
	Tracing Guide</a></code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-using"></a>24.4. Using DTrace</h2></div></div></div><p>DTrace scripts consist of a list of one or more
      <em class="firstterm">probes</em>, or instrumentation points, where
      each probe is associated with an action.  Whenever the condition
      for a probe is met, the associated action is executed.  For
      example, an action may occur when a file is opened, a process is
      started, or a line of code is executed.  The action might be to
      log some information or to modify context variables.  The
      reading and writing of context variables allows probes to share
      information and to cooperatively analyze the correlation of
      different events.</p><p>To view all probes, the administrator can execute the
      following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dtrace -l | more</code></strong></pre><p>Each probe has an <code class="literal">ID</code>, a
      <code class="literal">PROVIDER</code> (dtrace or fbt), a
      <code class="literal">MODULE</code>, and a
      <code class="literal">FUNCTION NAME</code>.    Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dtrace&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dtrace</span>(1)</span></a> for
      more information about this command.</p><p>The examples in this section provide an overview of how to
      use two of the fully supported scripts from the
      DTrace Toolkit: the
      <code class="filename">hotkernel</code> and
      <code class="filename">procsystime</code> scripts.</p><p>The <code class="filename">hotkernel</code> script is designed to
      identify which function is using the most kernel time.  It will
      produce output similar to the following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/share/dtrace-toolkit</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>./hotkernel</code></strong>
Sampling... Hit Ctrl-C to end.</pre><p>As instructed, use the
      <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> key combination to stop the process.  Upon
      termination, the script will display a list of kernel functions
      and timing information, sorting the output in increasing order
      of time:</p><pre class="screen">kernel`_thread_lock_flags                                   2   0.0%
0xc1097063                                                  2   0.0%
kernel`sched_userret                                        2   0.0%
kernel`kern_select                                          2   0.0%
kernel`generic_copyin                                       3   0.0%
kernel`_mtx_assert                                          3   0.0%
kernel`vm_fault                                             3   0.0%
kernel`sopoll_generic                                       3   0.0%
kernel`fixup_filename                                       4   0.0%
kernel`_isitmyx                                             4   0.0%
kernel`find_instance                                        4   0.0%
kernel`_mtx_unlock_flags                                    5   0.0%
kernel`syscall                                              5   0.0%
kernel`DELAY                                                5   0.0%
0xc108a253                                                  6   0.0%
kernel`witness_lock                                         7   0.0%
kernel`read_aux_data_no_wait                                7   0.0%
kernel`Xint0x80_syscall                                     7   0.0%
kernel`witness_checkorder                                   7   0.0%
kernel`sse2_pagezero                                        8   0.0%
kernel`strncmp                                              9   0.0%
kernel`spinlock_exit                                       10   0.0%
kernel`_mtx_lock_flags                                     11   0.0%
kernel`witness_unlock                                      15   0.0%
kernel`sched_idletd                                       137   0.3%
0xc10981a5                                              42139  99.3%</pre><p>This script will also work with kernel modules.  To use this
      feature, run the script with <code class="option">-m</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./hotkernel -m</code></strong>
Sampling... Hit Ctrl-C to end.
^C
MODULE                                                  COUNT   PCNT
0xc107882e                                                  1   0.0%
0xc10e6aa4                                                  1   0.0%
0xc1076983                                                  1   0.0%
0xc109708a                                                  1   0.0%
0xc1075a5d                                                  1   0.0%
0xc1077325                                                  1   0.0%
0xc108a245                                                  1   0.0%
0xc107730d                                                  1   0.0%
0xc1097063                                                  2   0.0%
0xc108a253                                                 73   0.0%
kernel                                                    874   0.4%
0xc10981a5                                             213781  99.6%</pre><p>The <code class="filename">procsystime</code> script captures and
      prints the system call time usage for a given process
      <acronym class="acronym">ID</acronym> (<acronym class="acronym">PID</acronym>) or process name.
      In the following example, a new instance of
      <code class="filename">/bin/csh</code> was spawned.  Then,
      <code class="filename">procsystime</code> was executed and remained
      waiting while a few commands were typed on the other incarnation
      of <code class="command">csh</code>.  These are the results of this
      test:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./procsystime -n csh</code></strong>
Tracing... Hit Ctrl-C to end...
^C

Elapsed Times for processes csh,

         SYSCALL          TIME (ns)
          getpid               6131
       sigreturn               8121
           close              19127
           fcntl              19959
             dup              26955
         setpgid              28070
            stat              31899
       setitimer              40938
           wait4              62717
       sigaction              67372
     sigprocmask             119091
    gettimeofday             183710
           write             263242
          execve             492547
           ioctl             770073
           vfork            3258923
      sigsuspend            6985124
            read         3988049784</pre><p>As shown, the <code class="function">read()</code> system call used
      the most time in nanoseconds while the
      <code class="function">getpid()</code> system call used the least amount
      of time.</p></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="usb-device-mode"></a>Chapter 25. USB Device Mode / USB OTG</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#usb-device-mode-synopsis">25.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-terminals">25.2. <acronym class="acronym">USB</acronym> Virtual Serial Ports</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-network">25.3. <acronym class="acronym">USB</acronym> Device Mode Network
      Interfaces</a></span></dt><dt><span class="sect1"><a href="#usb-device-mode-storage">25.4. <acronym class="acronym">USB</acronym> Virtual Storage Device</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-device-mode-synopsis"></a>25.1. Synopsis</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Edward Tomasz</span> <span class="surname">Napierala</span></span>. </span></div></div></div><p>This chapter covers the use of USB Device Mode and USB On
      The Go (<acronym class="acronym">USB OTG</acronym>) in FreeBSD.  This includes
      virtual serial consoles, virtual network interfaces, and
      virtual USB drives.</p><p>When running on hardware that supports USB device mode
      or <acronym class="acronym">USB OTG</acronym>, like that built into
      many embedded boards, the FreeBSD <acronym class="acronym">USB</acronym> stack
      can run in <span class="emphasis"><em>device mode</em></span>.  Device mode
      makes it possible for the computer to present itself as
      different kinds of <acronym class="acronym">USB</acronym> device classes,
      including serial ports, network adapters, and mass storage,
      or a combination thereof.  A <acronym class="acronym">USB</acronym> host like
      a laptop or desktop computer is able to access them just like
      physical <acronym class="acronym">USB</acronym> devices.  Device mode is
      sometimes called the <span class="quote">&#8220;<span class="quote">USB gadget mode</span>&#8221;</span>.</p><p>There are two basic ways the hardware can provide the
      device mode functionality: with a separate "client port", which
      only supports the device mode, and with a USB OTG port, which
      can provide both device and host mode.  For
      <acronym class="acronym">USB OTG</acronym> ports, the <acronym class="acronym">USB</acronym>
      stack switches between host-side and device-side automatically,
      depending on what is connected to the port.  Connecting a
      <acronym class="acronym">USB</acronym> device like a memory stick to the
      port causes FreeBSD to switch to host mode.  Connecting a
      <acronym class="acronym">USB</acronym> host like a computer causes FreeBSD to
      switch to device mode.  Single purpose "client ports" always
      work in device mode.</p><p>What FreeBSD presents to the <acronym class="acronym">USB</acronym> host
      depends on the <code class="varname">hw.usb.template</code> sysctl.  Some
      templates provide a single device, such as a serial terminal;
      others provide multiple ones, which can all be used at the same
      time.  An example is the template 10, which provides a mass
      storage device, a serial console, and a network interface.
      See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usb_template</span>(4)</span></a> for the list of available
      values.</p><p>Note that in some cases, depending on the hardware and the
      hosts operating system, for the host to notice the configuration
      change, it must be either physically disconnected and
      reconnected, or forced to rescan the <acronym class="acronym">USB</acronym>
      bus in a system-specific way.  When FreeBSD is running on the host,
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usbconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usbconfig</span>(8)</span></a> <code class="command">reset</code> can be used.
      This also must be done after loading
      <code class="filename">usb_template.ko</code> if the
      <acronym class="acronym">USB</acronym> host was already connected to the
      <acronym class="acronym">USB</acronym> <acronym class="acronym">OTG</acronym> socket.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to set up USB Device Mode functionality on
	  FreeBSD.</p></li><li class="listitem"><p>How to configure the virtual serial port on
	  FreeBSD.</p></li><li class="listitem"><p>How to connect to the virtual serial port
	  from various operating systems.</p></li><li class="listitem"><p>How to configure FreeBSD to provide a virtual
	  <acronym class="acronym">USB</acronym> network interface.</p></li><li class="listitem"><p>How to configure FreeBSD to provide a virtual
	  <acronym class="acronym">USB</acronym> storage device.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-device-mode-terminals"></a>25.2. <acronym class="acronym">USB</acronym> Virtual Serial Ports</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65414648"></a>25.2.1. Configuring USB Device Mode Serial Ports</h3></div></div></div><p>Virtual serial port support is provided by templates
	number 3, 8, and 10.  Note that template 3 works with
	Microsoft Windows 10 without the need for special drivers
	and INF files.  Other host operating systems work with all
	three templates.  Both <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usb_template</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=umodem&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">umodem</span>(4)</span></a>
	kernel modules must be loaded.</p><p>To enable USB device mode serial ports, add those lines
	to <code class="filename">/etc/ttys</code>:</p><pre class="programlisting">ttyU0	"/usr/libexec/getty 3wire"	vt100	onifconsole secure
ttyU1	"/usr/libexec/getty 3wire"	vt100	onifconsole secure</pre><p>Then add these lines to
	<code class="filename">/etc/devd.conf</code>:</p><pre class="programlisting">notify 100 {
	match "system"		"DEVFS";
	match "subsystem"	"CDEV";
	match "type"		"CREATE";
	match "cdev"		"ttyU[0-9]+";
	action "/sbin/init q";
};</pre><p>Reload the configuration if
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> is already running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service devd restart</code></strong></pre><p>Make sure the necessary modules are loaded and the
	correct template is set at boot by adding
	those lines to <code class="filename">/boot/loader.conf</code>,
	creating it if it does not already exist:</p><pre class="screen">umodem_load="YES"
hw.usb.template=3</pre><p>To load the module and set the template without rebooting
	use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload umodem</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.usb.template=3</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65441400"></a>25.2.2. Connecting to USB Device Mode Serial Ports from
	FreeBSD</h3></div></div></div><p>To connect to a board configured to provide USB device
	mode serial ports, connect the USB host, such as a laptop, to
	the boards USB OTG or USB client port.  Use
	<code class="command">pstat -t</code> on the host to list the terminal
	lines.  Near the end of the list you should see a USB serial
	port, eg "ttyU0".  To open the connection, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cu -l /dev/ttyU0</code></strong></pre><p>After pressing the <span class="keycap"><strong>Enter</strong></span> key a few times you will see
	a login prompt.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65444600"></a>25.2.3. Connecting to USB Device Mode Serial Ports from
	<span class="trademark">Mac OS</span>®</h3></div></div></div><p>To connect to a board configured to provide USB device
	mode serial ports, connect the USB host, such as a laptop,
	to the boards USB OTG or USB client port.  To open the
	connection, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cu -l /dev/cu.usbmodemFreeBSD1</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65447032"></a>25.2.4. Connecting to USB Device Mode Serial Ports from
	Linux</h3></div></div></div><p>To connect to a board configured to provide USB device
	mode serial ports, connect the USB host, such as a laptop,
	to the boards USB OTG or USB client port.  To open the
	connection, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>minicom -D /dev/ttyACM0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65449080"></a>25.2.5. Connecting to USB Device Mode Serial Ports from
	Microsoft Windows 10</h3></div></div></div><p>To connect to a board configured to provide USB device
	mode serial ports, connect the USB host, such as a laptop,
	to the boards USB OTG or USB client port.  To open a
	connection you will need a serial terminal program, such as
	<span class="application">PuTTY</span>.  To check the COM port name
	used by Windows, run Device Manager, expand "Ports (COM &amp;
	LPT)".  You will see a name similar to "USB Serial Device
	(COM4)".  Run serial terminal program of your choice, for
	example <span class="application">PuTTY</span>.  In the
	<span class="application">PuTTY</span> dialog set "Connection type"
	to "Serial", type the COMx obtained from Device Manager in the
	"Serial line" dialog box and click Open.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-device-mode-network"></a>25.3. <acronym class="acronym">USB</acronym> Device Mode Network
      Interfaces</h2></div></div></div><p>Virtual network interfaces support is provided by templates
      number 1, 8, and 10.  Note that none of them works with
      Microsoft Windows.  Other host operating systems work with all
      three templates.  Both <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usb_template</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=if_cdce&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">if_cdce</span>(4)</span></a>
      kernel modules must be loaded.</p><p>Make sure the necessary modules are loaded and the correct
      template is set at boot by adding
      those lines to <code class="filename">/boot/loader.conf</code>, creating
      it if it does not already exist:</p><pre class="programlisting">if_cdce_load="YES"
hw.usb.template=1</pre><p>To load the module and set the template without rebooting
      use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload if_cdce</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.usb.template=1</code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-device-mode-storage"></a>25.4. <acronym class="acronym">USB</acronym> Virtual Storage Device</h2></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cfumass&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cfumass</span>(4)</span></a> driver is a <acronym class="acronym">USB</acronym>
	device mode driver first available in FreeBSD 12.0.</p></div><p>Mass Storage target is provided by templates 0 and 10.
      Both <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=usb_template&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">usb_template</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cfumass&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cfumass</span>(4)</span></a> kernel modules
      must be loaded.  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cfumass&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cfumass</span>(4)</span></a> interfaces to the CTL
      subsystem, the same one that is used for
      <acronym class="acronym">iSCSI</acronym> or Fibre Channel targets.
      On the host side, <acronym class="acronym">USB</acronym> Mass Storage
      initiators can only access a single <acronym class="acronym">LUN</acronym>,
      <acronym class="acronym">LUN</acronym> 0.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65469176"></a>25.4.1. Configuring USB Mass Storage Target Using the cfumass
	Startup Script</h3></div></div></div><p>The simplest way to set up a read-only USB storage target
	is to use the <code class="filename">cfumass</code> rc script.  To
	configure it this way, copy the files to be presented to the
	USB host machine into the <code class="literal">/var/cfumass</code>
	directory, and add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">cfumass_enable="YES"</pre><p>To configure the target without restarting,
	run this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service cfumass start</code></strong></pre><p>Differently from serial and network functionality, the
	template should not be set to 0 or 10 in
	<code class="filename">/boot/loader.conf</code>.  This is because the
	LUN must be set up before setting the template.  The cfumass
	startup script sets the correct template number automatically
	when started.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65486200"></a>25.4.2. Configuring USB Mass Storage Using Other Means</h3></div></div></div><p>The rest of this chapter provides detailed description of
	setting the target without using the cfumass rc file.  This is
	necessary if eg one wants to provide a writeable LUN.</p><p><acronym class="acronym">USB</acronym> Mass Storage does not require the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon to be running, although it can be used if
	desired.  This is different from <acronym class="acronym">iSCSI</acronym>.
	Thus, there are two ways to configure the target:
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctladm&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctladm</span>(8)</span></a>, or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a>.  Both require the
	<code class="filename">cfumass.ko</code> kernel module to be loaded.
	The module can be loaded manually:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload cfumass</code></strong></pre><p>If <code class="filename">cfumass.ko</code> has not been built into
	the kernel, <code class="filename">/boot/loader.conf</code> can be set
	to load the module at boot:</p><pre class="programlisting">cfumass_load="YES"</pre><p>A <acronym class="acronym">LUN</acronym> can be created without the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ctladm create -b block -o file=/data/target0</code></strong></pre><p>This presents the contents of the image file
	<code class="filename">/data/target0</code> as a <acronym class="acronym">LUN</acronym>
	to the <acronym class="acronym">USB</acronym> host.  The file must exist
	before executing the command.  To configure the
	<acronym class="acronym">LUN</acronym> at system startup, add the command to
	<code class="filename">/etc/rc.local</code>.</p><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> can also be used to manage
	<acronym class="acronym">LUN</acronym>s.  Create
	<code class="filename">/etc/ctl.conf</code>, add a line to
	<code class="filename">/etc/rc.conf</code> to make sure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> is
	automatically started at boot, and then start the
	daemon.</p><p>This is an example of a simple
	<code class="filename">/etc/ctl.conf</code> configuration file.  Refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctl.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctl.conf</span>(5)</span></a> for a more complete description of the
	options.</p><pre class="programlisting">target naa.50015178f369f092 {
	lun 0 {
		path /data/target0
		size 4G
	}
}</pre><p>The example creates a single target with a single
	<acronym class="acronym">LUN</acronym>.  The
	<code class="literal">naa.50015178f369f092</code> is a device identifier
	composed of 32 random hexadecimal digits.  The
	<code class="literal">path</code> line defines the full path to a file
	or zvol backing the <acronym class="acronym">LUN</acronym>.  That file must
	exist before starting <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a>.  The second line is
	optional and specifies the size of the
	<acronym class="acronym">LUN</acronym>.</p><p>To make sure the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon is started at
	boot, add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ctld_enable="YES"</pre><p>To start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> now, run this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service ctld start</code></strong></pre><p>As the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon is started, it reads
	<code class="filename">/etc/ctl.conf</code>.  If this file is edited
	after the daemon starts, reload the changes so they take
	effect immediately:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service ctld reload</code></strong></pre></div></div></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-communication"></a>Part IV. Network Communication</h1></div></div></div><div class="partintro"><div xmlns=""></div><p>FreeBSD is one of the most widely deployed operating systems
	for high performance network servers.  The chapters in this
	part cover:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Serial communication</p></li><li class="listitem"><p><acronym class="acronym">PPP</acronym> and <acronym class="acronym">PPP</acronym> over
	    Ethernet</p></li><li class="listitem"><p>Electronic Mail</p></li><li class="listitem"><p>Running Network Servers</p></li><li class="listitem"><p>Firewalls</p></li><li class="listitem"><p>Other Advanced Networking Topics</p></li></ul></div><p>These chapters are designed to be read when the
	information is needed.  They do not need to be read in any
	particular order, nor is it necessary to read all of them
	before using FreeBSD in a network environment.</p><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="chapter"><a href="#serialcomms">26. Serial Communications</a></span></dt><dd><dl><dt><span class="sect1"><a href="#serial-synopsis">26.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#serial">26.2. Serial Terminology and Hardware</a></span></dt><dt><span class="sect1"><a href="#term">26.3. Terminals</a></span></dt><dt><span class="sect1"><a href="#dialup">26.4. Dial-in Service</a></span></dt><dt><span class="sect1"><a href="#dialout">26.5. Dial-out Service</a></span></dt><dt><span class="sect1"><a href="#serialconsole-setup">26.6. Setting Up the Serial Console</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ppp-and-slip">27. <acronym class="acronym">PPP</acronym></a></span></dt><dd><dl><dt><span class="sect1"><a href="#ppp-and-slip-synopsis">27.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#userppp">27.2. Configuring <acronym class="acronym">PPP</acronym></a></span></dt><dt><span class="sect1"><a href="#ppp-troubleshoot">27.3. Troubleshooting <acronym class="acronym">PPP</acronym> Connections</a></span></dt><dt><span class="sect1"><a href="#pppoe">27.4. Using <acronym class="acronym">PPP</acronym> over Ethernet (PPPoE)</a></span></dt><dt><span class="sect1"><a href="#pppoa">27.5. Using <span class="application">PPP</span> over
      <acronym class="acronym">ATM</acronym> (PPPoA)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#mail">28. Electronic Mail</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mail-synopsis">28.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#mail-using">28.2. Mail Components</a></span></dt><dt><span class="sect1"><a href="#sendmail">28.3. <span class="application">Sendmail</span> Configuration
	Files</a></span></dt><dt><span class="sect1"><a href="#mail-changingmta">28.4. Changing the Mail Transfer Agent</a></span></dt><dt><span class="sect1"><a href="#mail-trouble">28.5. Troubleshooting</a></span></dt><dt><span class="sect1"><a href="#mail-advanced">28.6. Advanced Topics</a></span></dt><dt><span class="sect1"><a href="#outgoing-only">28.7. Setting Up to Send Only</a></span></dt><dt><span class="sect1"><a href="#SMTP-dialup">28.8. Using Mail with a Dialup Connection</a></span></dt><dt><span class="sect1"><a href="#SMTP-Auth">28.9. SMTP Authentication</a></span></dt><dt><span class="sect1"><a href="#mail-agents">28.10. Mail User Agents</a></span></dt><dt><span class="sect1"><a href="#mail-fetchmail">28.11. Using <span class="application">fetchmail</span></a></span></dt><dt><span class="sect1"><a href="#mail-procmail">28.12. Using <span class="application">procmail</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#network-servers">29. Network Servers</a></span></dt><dd><dl><dt><span class="sect1"><a href="#network-servers-synopsis">29.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#network-inetd">29.2. The <span class="application">inetd</span>
      Super-Server</a></span></dt><dt><span class="sect1"><a href="#network-nfs">29.3. Network File System (NFS)</a></span></dt><dt><span class="sect1"><a href="#network-nis">29.4. Network Information System
      (<acronym class="acronym">NIS</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-ldap">29.5. Lightweight Directory Access Protocol
	(<acronym class="acronym">LDAP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-dhcp">29.6. Dynamic Host Configuration Protocol
      (<acronym class="acronym">DHCP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-dns">29.7. Domain Name System (<acronym class="acronym">DNS</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-apache">29.8. Apache HTTP Server</a></span></dt><dt><span class="sect1"><a href="#network-ftp">29.9. File Transfer Protocol (<acronym class="acronym">FTP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-samba">29.10. File and Print Services for <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® Clients
      (Samba)</a></span></dt><dt><span class="sect1"><a href="#network-ntp">29.11. Clock Synchronization with NTP</a></span></dt><dt><span class="sect1"><a href="#network-iscsi">29.12. <acronym class="acronym">iSCSI</acronym> Initiator and Target
      Configuration</a></span></dt></dl></dd><dt><span class="chapter"><a href="#firewalls">30. Firewalls</a></span></dt><dd><dl><dt><span class="sect1"><a href="#firewalls-intro">30.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#firewalls-concepts">30.2. Firewall Concepts</a></span></dt><dt><span class="sect1"><a href="#firewalls-pf">30.3. PF</a></span></dt><dt><span class="sect1"><a href="#firewalls-ipfw">30.4. <span class="application">IPFW</span></a></span></dt><dt><span class="sect1"><a href="#firewalls-ipf">30.5. IPFILTER (IPF)</a></span></dt><dt><span class="sect1"><a href="#firewalls-blacklistd">30.6. Blacklistd</a></span></dt></dl></dd><dt><span class="chapter"><a href="#advanced-networking">31. Advanced Networking</a></span></dt><dd><dl><dt><span class="sect1"><a href="#advanced-networking-synopsis">31.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#network-routing">31.2. Gateways and Routes</a></span></dt><dt><span class="sect1"><a href="#network-wireless">31.3. Wireless Networking</a></span></dt><dt><span class="sect1"><a href="#network-usb-tethering">31.4. USB Tethering</a></span></dt><dt><span class="sect1"><a href="#network-bluetooth">31.5. Bluetooth</a></span></dt><dt><span class="sect1"><a href="#network-bridging">31.6. Bridging</a></span></dt><dt><span class="sect1"><a href="#network-aggregation">31.7. Link Aggregation and Failover</a></span></dt><dt><span class="sect1"><a href="#network-diskless">31.8. Diskless Operation with <acronym class="acronym">PXE</acronym></a></span></dt><dt><span class="sect1"><a href="#network-ipv6">31.9. <acronym class="acronym">IPv6</acronym></a></span></dt><dt><span class="sect1"><a href="#carp">31.10. Common Address Redundancy Protocol
	(<acronym class="acronym">CARP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-vlan">31.11. VLANs</a></span></dt></dl></dd></dl></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialcomms"></a>Chapter 26. Serial Communications</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#serial-synopsis">26.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#serial">26.2. Serial Terminology and Hardware</a></span></dt><dt><span class="sect1"><a href="#term">26.3. Terminals</a></span></dt><dt><span class="sect1"><a href="#dialup">26.4. Dial-in Service</a></span></dt><dt><span class="sect1"><a href="#dialout">26.5. Dial-out Service</a></span></dt><dt><span class="sect1"><a href="#serialconsole-setup">26.6. Setting Up the Serial Console</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="serial-synopsis"></a>26.1. Synopsis</h2></div></div></div><a id="idp65534712" class="indexterm"></a><p><span class="trademark">UNIX</span>® has always had support for serial communications as
      the very first <span class="trademark">UNIX</span>® machines relied on serial lines for user
      input and output.  Things have changed a lot from the days
      when the average terminal consisted of a 10-character-per-second
      serial printer and a keyboard.  This chapter covers some of the
      ways serial communications can be used on FreeBSD.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to connect terminals to a FreeBSD system.</p></li><li class="listitem"><p>How to use a modem to dial out to remote hosts.</p></li><li class="listitem"><p>How to allow remote users to login to a FreeBSD system
	  with a modem.</p></li><li class="listitem"><p>How to boot a FreeBSD system from a serial console.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Know how to <a class="link" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel"> configure and
	    install a custom kernel</a>.</p></li><li class="listitem"><p>Understand <a class="link" href="#basics" title="Chapter 3. FreeBSD Basics"> FreeBSD permissions
	    and processes</a>.</p></li><li class="listitem"><p>Have access to the technical manual for the serial
	  hardware to be used with FreeBSD.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="serial"></a>26.2. Serial Terminology and Hardware</h2></div></div></div><p>The following terms are often used in serial
      communications:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><acronym class="acronym">bps</acronym></span></dt><dd><p>Bits per
	    Second<a id="idp65584120" class="indexterm"></a>
	    (<acronym class="acronym">bps</acronym>) is the rate at which data is
	    transmitted.</p></dd><dt><span class="term"><acronym class="acronym">DTE</acronym></span></dt><dd><p>Data Terminal
	    Equipment<a id="idp65586680" class="indexterm"></a>
	    (<acronym class="acronym">DTE</acronym>) is one of two endpoints in a
	    serial communication.  An example would be a
	    computer.</p></dd><dt><span class="term"><acronym class="acronym">DCE</acronym></span></dt><dd><p>Data Communications
	    Equipment<a id="idp65589240" class="indexterm"></a>
	    (<acronym class="acronym">DTE</acronym>) is the other endpoint in a
	    serial communication.  Typically, it is a modem or serial
	    terminal.</p></dd><dt><span class="term"><acronym class="acronym">RS-232</acronym></span></dt><dd><p>The original standard which defined hardware serial
	    communications.  It has since been renamed to
	    <acronym class="acronym">TIA-232</acronym>.</p></dd></dl></div><p>When referring to communication data rates, this section
      does not use the term <em class="firstterm">baud</em>.  Baud refers
      to the number of electrical state transitions made in a period
      of time, while <acronym class="acronym">bps</acronym> is the correct term to
      use.</p><p>To connect a serial terminal to a FreeBSD system, a serial port
      on the computer and the proper cable to connect to the serial
      device are needed.  Users who are already familiar with serial
      hardware and cabling can safely skip this section.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="term-cables-null"></a>26.2.1. Serial Cables and Ports</h3></div></div></div><p>There are several different kinds of serial cables.  The
	two most common types are null-modem cables and standard
	<acronym class="acronym">RS-232</acronym> cables.  The documentation for the
	hardware should describe the type of cable required.</p><p>These two types of cables differ in how the wires are
	connected to the connector.  Each wire represents a signal,
	with the defined signals summarized in <a class="xref" href="#serialcomms-signal-names" title="Table 26.1. RS-232C Signal Names">Table 26.1, &#8220;<acronym class="acronym">RS-232C</acronym> Signal Names&#8221;</a>.  A standard serial
	cable passes all of the <acronym class="acronym">RS-232C</acronym> signals
	straight through.  For example, the <span class="quote">&#8220;<span class="quote">Transmitted
	  Data</span>&#8221;</span> pin on one end of the cable goes to the
	<span class="quote">&#8220;<span class="quote">Transmitted Data</span>&#8221;</span> pin on the other end.  This is
	the type of cable used to connect a modem to the FreeBSD system,
	and is also appropriate for some terminals.</p><p>A null-modem cable switches the <span class="quote">&#8220;<span class="quote">Transmitted
	  Data</span>&#8221;</span> pin of the connector on one end with the
	<span class="quote">&#8220;<span class="quote">Received Data</span>&#8221;</span> pin on the other end.  The
	connector can be either a <acronym class="acronym">DB-25</acronym> or a
	<acronym class="acronym">DB-9</acronym>.</p><p>A null-modem cable can be constructed using the pin
	connections summarized in <a class="xref" href="#nullmodem-db25" title="Table 26.2. DB-25 to DB-25 Null-Modem Cable">Table 26.2, &#8220;DB-25 to DB-25 Null-Modem Cable&#8221;</a>,
	<a class="xref" href="#nullmodem-db9" title="Table 26.3. DB-9 to DB-9 Null-Modem Cable">Table 26.3, &#8220;DB-9 to DB-9 Null-Modem Cable&#8221;</a>, and <a class="xref" href="#nullmodem-db9-25" title="Table 26.4. DB-9 to DB-25 Null-Modem Cable">Table 26.4, &#8220;DB-9 to DB-25 Null-Modem Cable&#8221;</a>.  While the standard calls for
	a straight-through pin 1 to pin 1 <span class="quote">&#8220;<span class="quote">Protective
	  Ground</span>&#8221;</span> line, it is often omitted.  Some terminals
	work using only pins 2, 3, and 7, while others require
	different configurations.  When in doubt, refer to the
	documentation for the hardware.</p><a id="idp65605752" class="indexterm"></a><div class="table"><a id="serialcomms-signal-names"></a><div class="table-title">Table 26.1. <acronym class="acronym">RS-232C</acronym> Signal Names</div><div class="table-contents"><table class="table" summary="RS-232C Signal Names" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Acronyms</th><th align="left">Names</th></tr></thead><tbody><tr><td><acronym class="acronym">RD</acronym></td><td>Received Data</td></tr><tr><td><acronym class="acronym">TD</acronym></td><td>Transmitted Data</td></tr><tr><td><acronym class="acronym">DTR</acronym></td><td>Data Terminal Ready</td></tr><tr><td><acronym class="acronym">DSR</acronym></td><td>Data Set Ready</td></tr><tr><td><acronym class="acronym">DCD</acronym></td><td>Data Carrier Detect</td></tr><tr><td><acronym class="acronym">SG</acronym></td><td>Signal Ground</td></tr><tr><td><acronym class="acronym">RTS</acronym></td><td>Request to Send</td></tr><tr><td><acronym class="acronym">CTS</acronym></td><td>Clear to Send</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="nullmodem-db25"></a><div class="table-title">Table 26.2. DB-25 to DB-25 Null-Modem Cable</div><div class="table-contents"><table class="table" summary="DB-25 to DB-25 Null-Modem Cable" width="100%" border="0"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th align="left">Signal</th><th align="left">Pin #</th><th> </th><th align="left">Pin #</th><th align="left">Signal</th></tr></thead><tbody><tr><td>SG</td><td>7</td><td>connects to</td><td>7</td><td>SG</td></tr><tr><td>TD</td><td>2</td><td>connects to</td><td>3</td><td>RD</td></tr><tr><td>RD</td><td>3</td><td>connects to</td><td>2</td><td>TD</td></tr><tr><td>RTS</td><td>4</td><td>connects to</td><td>5</td><td>CTS</td></tr><tr><td>CTS</td><td>5</td><td>connects to</td><td>4</td><td>RTS</td></tr><tr><td>DTR</td><td>20</td><td>connects to</td><td>6</td><td>DSR</td></tr><tr><td>DTR</td><td>20</td><td>connects to</td><td>8</td><td>DCD</td></tr><tr><td>DSR</td><td>6</td><td>connects to</td><td>20</td><td>DTR</td></tr><tr><td>DCD</td><td>8</td><td>connects to</td><td>20</td><td>DTR</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="nullmodem-db9"></a><div class="table-title">Table 26.3. DB-9 to DB-9 Null-Modem Cable</div><div class="table-contents"><table class="table" summary="DB-9 to DB-9 Null-Modem Cable" width="100%" border="0"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th align="left">Signal</th><th align="left">Pin #</th><th> </th><th align="left">Pin #</th><th align="left">Signal</th></tr></thead><tbody><tr><td>RD</td><td>2</td><td>connects to</td><td>3</td><td>TD</td></tr><tr><td>TD</td><td>3</td><td>connects to</td><td>2</td><td>RD</td></tr><tr><td>DTR</td><td>4</td><td>connects to</td><td>6</td><td>DSR</td></tr><tr><td>DTR</td><td>4</td><td>connects to</td><td>1</td><td>DCD</td></tr><tr><td>SG</td><td>5</td><td>connects to</td><td>5</td><td>SG</td></tr><tr><td>DSR</td><td>6</td><td>connects to</td><td>4</td><td>DTR</td></tr><tr><td>DCD</td><td>1</td><td>connects to</td><td>4</td><td>DTR</td></tr><tr><td>RTS</td><td>7</td><td>connects to</td><td>8</td><td>CTS</td></tr><tr><td>CTS</td><td>8</td><td>connects to</td><td>7</td><td>RTS</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="nullmodem-db9-25"></a><div class="table-title">Table 26.4. DB-9 to DB-25 Null-Modem Cable</div><div class="table-contents"><table class="table" summary="DB-9 to DB-25 Null-Modem Cable" width="100%" border="0"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th align="left">Signal</th><th align="left">Pin #</th><th> </th><th align="left">Pin #</th><th align="left">Signal</th></tr></thead><tbody><tr><td>RD</td><td>2</td><td>connects to</td><td>2</td><td>TD</td></tr><tr><td>TD</td><td>3</td><td>connects to</td><td>3</td><td>RD</td></tr><tr><td>DTR</td><td>4</td><td>connects to</td><td>6</td><td>DSR</td></tr><tr><td>DTR</td><td>4</td><td>connects to</td><td>8</td><td>DCD</td></tr><tr><td>SG</td><td>5</td><td>connects to</td><td>7</td><td>SG</td></tr><tr><td>DSR</td><td>6</td><td>connects to</td><td>20</td><td>DTR</td></tr><tr><td>DCD</td><td>1</td><td>connects to</td><td>20</td><td>DTR</td></tr><tr><td>RTS</td><td>7</td><td>connects to</td><td>5</td><td>CTS</td></tr><tr><td>CTS</td><td>8</td><td>connects to</td><td>4</td><td>RTS</td></tr></tbody></table></div></div><br class="table-break" /><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">When one pin at one end connects to a pair of pins at
	  the other end, it is usually implemented with one short wire
	  between the pair of pins in their connector and a long wire
	  to the other single pin.</p></div><p>Serial ports are the devices through which data is
	transferred between the FreeBSD host computer and the terminal.
	Several kinds of serial ports exist.  Before purchasing or
	constructing a cable, make sure it will fit the ports on the
	terminal and on the FreeBSD system.</p><p>Most terminals have <acronym class="acronym">DB-25</acronym> ports.
	Personal computers may have <acronym class="acronym">DB-25</acronym> or
	<acronym class="acronym">DB-9</acronym> ports.  A multiport serial card may
	have <acronym class="acronym">RJ-12</acronym> or <acronym class="acronym">RJ-45/</acronym>
	ports.  See the documentation that accompanied the hardware
	for specifications on the kind of port or visually verify the
	type of port.</p><p>In FreeBSD, each serial port is accessed through an entry in
	<code class="filename">/dev</code>.  There are two different kinds of
	entries:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Call-in ports are named
	    <code class="filename">/dev/ttyu<em class="replaceable"><code>N</code></em></code>
	    where <em class="replaceable"><code>N</code></em> is the port number,
	    starting from zero.  If a terminal is connected to the
	    first serial port (<code class="filename">COM1</code>), use
	    <code class="filename">/dev/ttyu0</code> to refer to the terminal.
	    If the terminal is on the second serial port
	    (<code class="filename">COM2</code>), use
	    <code class="filename">/dev/ttyu1</code>, and so forth.  Generally,
	    the call-in port is used for terminals.  Call-in ports
	    require that the serial line assert the <span class="quote">&#8220;<span class="quote">Data
	      Carrier Detect</span>&#8221;</span> signal to work correctly.</p></li><li class="listitem"><p>Call-out ports are named
	    <code class="filename">/dev/cuau<em class="replaceable"><code>N</code></em></code>
	    on FreeBSD versions 8.X and higher and
	    <code class="filename">/dev/cuad<em class="replaceable"><code>N</code></em></code>
	    on FreeBSD versions 7.X and lower.  Call-out ports are
	    usually not used for terminals, but are used for modems.
	    The call-out port can be used if the serial cable or the
	    terminal does not support the <span class="quote">&#8220;<span class="quote">Data Carrier
	      Detect</span>&#8221;</span> signal.</p></li></ul></div><p>FreeBSD also provides initialization devices
	(<code class="filename">/dev/ttyu<em class="replaceable"><code>N</code></em>.init</code>
	and
	<code class="filename">/dev/cuau<em class="replaceable"><code>N</code></em>.init</code>
	or
	<code class="filename">/dev/cuad<em class="replaceable"><code>N</code></em>.init</code>)
	and locking devices
	(<code class="filename">/dev/ttyu<em class="replaceable"><code>N</code></em>.lock</code>
	and
	<code class="filename">/dev/cuau<em class="replaceable"><code>N</code></em>.lock</code>
	or
	<code class="filename">/dev/cuad<em class="replaceable"><code>N</code></em>.lock</code>).
	The initialization devices are used to initialize
	communications port parameters each time a port is opened,
	such as <code class="literal">crtscts</code> for modems which use
	<code class="literal">RTS/CTS</code> signaling for flow control.  The
	locking devices are used to lock flags on ports to prevent
	users or programs changing certain parameters.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=termios&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">termios</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=stty&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">stty</span>(1)</span></a> for information
	on terminal settings, locking and initializing devices, and
	setting terminal options, respectively.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serial-hw-config"></a>26.2.2. Serial Port Configuration</h3></div></div></div><p>By default, FreeBSD supports four serial ports which are
	commonly known as <code class="filename">COM1</code>,
	<code class="filename">COM2</code>, <code class="filename">COM3</code>, and
	<code class="filename">COM4</code>.  FreeBSD also supports dumb multi-port
	serial interface cards, such as the BocaBoard 1008 and 2016,
	as well as more intelligent multi-port cards such as those
	made by Digiboard.  However, the default kernel only looks for
	the standard <code class="filename">COM</code> ports.</p><p>To see if the system recognizes the serial ports, look for
	system boot messages that start with
	<code class="literal">uart</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>grep uart /var/run/dmesg.boot</code></strong></pre><p>If the system does not recognize all of the needed serial
	ports, additional entries can be added to
	<code class="filename">/boot/device.hints</code>.  This file already
	contains <code class="literal">hint.uart.0.*</code> entries for
	<code class="filename">COM1</code> and <code class="literal">hint.uart.1.*</code>
	entries for <code class="filename">COM2</code>.  When adding a port
	entry for <code class="filename">COM3</code> use
	<code class="literal">0x3E8</code>, and for <code class="filename">COM4</code>
	use <code class="literal">0x2E8</code>.  Common <acronym class="acronym">IRQ</acronym>
	addresses are <code class="literal">5</code> for
	<code class="filename">COM3</code> and <code class="literal">9</code> for
	<code class="filename">COM4</code>.</p><a id="idp65793656" class="indexterm"></a><a id="idp65794296" class="indexterm"></a><p>To determine the default set of terminal
	<acronym class="acronym">I/O</acronym> settings used by the port, specify its
	device name.  This example determines the settings for the
	call-in port on <code class="filename">COM2</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>stty -a -f /dev/<em class="replaceable"><code>ttyu1</code></em></code></strong></pre><p>System-wide initialization of serial devices is controlled
	by <code class="filename">/etc/rc.d/serial</code>.  This file affects
	the default settings of serial devices.  To change the
	settings for a device, use <code class="command">stty</code>.  By
	default, the changed settings are in effect until the device
	is closed and when the device is reopened, it goes back to the
	default set.  To permanently change the default set, open and
	adjust the settings of the initialization device.  For
	example, to turn on <code class="option">CLOCAL</code> mode, 8 bit
	communication, and <code class="option">XON/XOFF</code> flow control for
	<code class="filename">ttyu5</code>, type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>stty -f /dev/ttyu5.init clocal cs8 ixon ixoff</code></strong></pre><a id="idp65341816" class="indexterm"></a><p>To prevent certain settings from being changed by an
	application, make adjustments to the locking device.  For
	example, to lock the speed of <code class="filename">ttyu5</code> to
	57600 bps, type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>stty -f /dev/ttyu5.lock 57600</code></strong></pre><p>Now, any application that opens <code class="filename">ttyu5</code>
	and tries to change the speed of the port will be stuck with
	57600 bps.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="term"></a>26.3. Terminals</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Sean</span> <span class="surname">Kelly</span></span>. </span></div></div></div><a id="idp65349496" class="indexterm"></a><p>Terminals provide a convenient and low-cost way to access
      a FreeBSD system when not at the computer's console or on a
      connected network.  This section describes how to use terminals
      with FreeBSD.</p><p>The original <span class="trademark">UNIX</span>® systems did not have consoles.  Instead,
      users logged in and ran programs through terminals that were
      connected to the computer's serial ports.</p><p>The ability to establish a login session on a serial port
      still exists in nearly every <span class="trademark">UNIX</span>®-like operating system
      today, including FreeBSD.  By using a terminal attached to an
      unused serial port, a user can log in and run any text program
      that can normally be run on the console or in an
      <code class="command">xterm</code> window.</p><p>Many terminals can be attached to a FreeBSD system.  An older
      spare computer can be used as a terminal wired into a more
      powerful computer running FreeBSD.  This can turn what might
      otherwise be a single-user computer into a powerful
      multiple-user system.</p><p>FreeBSD supports three types of terminals:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Dumb terminals</span></dt><dd><p>Dumb terminals are specialized hardware that connect
	    to computers over serial lines.  They are called
	    <span class="quote">&#8220;<span class="quote">dumb</span>&#8221;</span> because they have only enough
	    computational power to display, send, and receive text.
	    No programs can be run on these devices.  Instead, dumb
	    terminals connect to a computer that runs the needed
	    programs.</p><p>There are hundreds of kinds of dumb terminals made by
	    many manufacturers, and just about any kind will work with
	    FreeBSD.  Some high-end terminals can even display graphics,
	    but only certain software packages can take advantage of
	    these advanced features.</p><p>Dumb terminals are popular in work environments where
	    workers do not need access to graphical
	    applications.</p></dd><dt><span class="term">Computers Acting as Terminals</span></dt><dd><p>Since a dumb terminal has just enough ability to
	    display, send, and receive text, any spare computer can
	    be a dumb terminal.  All that is needed is the proper
	    cable and some <em class="firstterm">terminal emulation</em>
	    software to run on the computer.</p><p>This configuration can be useful.  For example, if one
	    user is busy working at the FreeBSD system's console, another
	    user can do some text-only work at the same time from a
	    less powerful personal computer hooked up as a terminal to
	    the FreeBSD system.</p><p>There are at least two utilities in the base-system of
	    FreeBSD that can be used to work through a serial connection:
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cu&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cu</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tip&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tip</span>(1)</span></a>.</p><p>For example, to connect from a client system that runs
	    FreeBSD to the serial connection of another system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cu -l /dev/cuau<em class="replaceable"><code>N</code></em></code></strong></pre><p>Ports are numbered starting from zero.  This means that
	    <code class="filename">COM1</code> is
	    <code class="filename">/dev/cuau0</code>.</p><p>Additional programs are available through the Ports
	    Collection, such as
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/minicom/pkg-descr">comms/minicom</a>.</p></dd><dt><span class="term">X Terminals</span></dt><dd><p>X terminals are the most sophisticated kind of
	    terminal available.  Instead of connecting to a serial
	    port, they usually connect to a network like Ethernet.
	    Instead of being relegated to text-only applications, they
	    can display any <span class="application">Xorg</span>
	    application.</p><p>This chapter does not cover the setup, configuration,
	    or use of X terminals.</p></dd></dl></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="term-config"></a>26.3.1. Terminal Configuration</h3></div></div></div><p>This section describes how to configure a FreeBSD system to
	enable a login session on a serial terminal.  It assumes that
	the system recognizes the serial port to which the terminal is
	connected and that the terminal is connected with the correct
	cable.</p><p>In FreeBSD, <code class="command">init</code> reads
	<code class="filename">/etc/ttys</code> and starts a
	<code class="command">getty</code> process on the available terminals.
	The <code class="command">getty</code> process is responsible for
	reading a login name and starting the <code class="command">login</code>
	program.  The ports on the FreeBSD system which allow logins are
	listed in <code class="filename">/etc/ttys</code>.  For example, the
	first virtual console, <code class="filename">ttyv0</code>, has an
	entry in this file, allowing logins on the console.  This file
	also contains entries for the other virtual consoles, serial
	ports, and pseudo-ttys.  For a hardwired terminal, the serial
	port's <code class="filename">/dev</code> entry is listed without the
	<code class="literal">/dev</code> part.  For example,
	<code class="filename">/dev/ttyv0</code> is listed as
	<code class="literal">ttyv0</code>.</p><p>The default <code class="filename">/etc/ttys</code> configures
	support for the first four serial ports,
	<code class="filename">ttyu0</code> through
	<code class="filename">ttyu3</code>:</p><pre class="programlisting">ttyu0   "/usr/libexec/getty std.9600"   dialup  off secure
ttyu1   "/usr/libexec/getty std.9600"   dialup  off secure
ttyu2   "/usr/libexec/getty std.9600"   dialup  off secure
ttyu3   "/usr/libexec/getty std.9600"   dialup  off secure</pre><p>When attaching a terminal to one of those ports, modify
	the default entry to set the required speed and terminal type,
	to turn the device <code class="literal">on</code> and, if needed, to
	change the port's <code class="literal">secure</code> setting.  If the
	terminal is connected to another port, add an entry for the
	port.</p><p><a class="xref" href="#ex-etc-ttys" title="Example 26.1. Configuring Terminal Entries">Example 26.1, &#8220;Configuring Terminal Entries&#8221;</a> configures two terminals in
	<code class="filename">/etc/ttys</code>.  The first entry configures a
	Wyse-50 connected to <code class="filename">COM2</code>.  The second
	entry configures an old computer running
	<span class="application">Procomm</span> terminal software emulating
	a VT-100 terminal.  The computer is connected to the sixth
	serial port on a multi-port serial card.</p><div class="example"><a id="ex-etc-ttys"></a><div class="example-title">Example 26.1. Configuring Terminal Entries</div><div class="example-contents"><pre class="programlisting">ttyu1<a id="co-ttys-line1col1"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>  "/usr/libexec/getty std.38400"<a id="co-ttys-line1col2"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>  wy50<a id="co-ttys-line1col3"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>  on<a id="co-ttys-line1col4"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>  insecure<a id="co-ttys-line1col5"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
ttyu5   "/usr/libexec/getty std.19200"  vt100  on insecure</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttys-line1col1"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The first field specifies the device name of the
	      serial terminal.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttys-line1col2"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The second field tells <code class="command">getty</code> to
	      initialize and open the line, set the line speed, prompt
	      for a user name, and then execute the
	      <code class="command">login</code> program.  The optional
	      <em class="firstterm">getty type</em> configures
	      characteristics on the terminal line, like
	      <acronym class="acronym">bps</acronym> rate and parity.  The available
	      getty types are listed in
	      <code class="filename">/etc/gettytab</code>.  In almost all
	      cases, the getty types that start with
	      <code class="literal">std</code> will work for hardwired terminals
	      as these entries ignore parity.  There is a
	      <code class="literal">std</code> entry for each
	      <acronym class="acronym">bps</acronym> rate from 110 to 115200.  Refer
	      to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=gettytab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">gettytab</span>(5)</span></a> for more information.</p><p>When setting the getty type, make sure to match the
	      communications settings used by the terminal.  For this
	      example, the Wyse-50 uses no parity and connects at
	      38400 bps.  The computer uses no parity and
	      connects at 19200 bps.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttys-line1col3"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The third field is the type of terminal.  For
	      dial-up ports, <code class="literal">unknown</code> or
	      <code class="literal">dialup</code> is typically used since users
	      may dial up with practically any type of terminal or
	      software.  Since the terminal type does not change for
	      hardwired terminals, a real terminal type from
	      <code class="filename">/etc/termcap</code> can be specified.  For
	      this example, the Wyse-50 uses the real terminal type
	      while the computer running
	      <span class="application">Procomm</span> is set to emulate a
	      VT-100.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttys-line1col4"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The fourth field specifies if the port should be
	      enabled.  To enable logins on this port, this field must
	      be set to <code class="literal">on</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttys-line1col5"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The final field is used to specify whether the port
	      is secure.  Marking a port as <code class="literal">secure</code>
	      means that it is trusted enough to allow <code class="systemitem">root</code> to login from that
	      port.  Insecure ports do not allow <code class="systemitem">root</code> logins.  On an
	      insecure port, users must login from unprivileged
	      accounts and then use <code class="command">su</code> or a similar
	      mechanism to gain superuser privileges, as described in
	      <a class="xref" href="#users-superuser" title="3.3.1.3. The Superuser Account">Section 3.3.1.3, &#8220;The Superuser Account&#8221;</a>.  For security
	      reasons, it is recommended to change this setting to
	      <code class="literal">insecure</code>.</p></td></tr></table></div></div></div><br class="example-break" /><p>After making any changes to
	<code class="filename">/etc/ttys</code>, send a SIGHUP (hangup) signal
	to the <code class="command">init</code> process to force it to re-read
	its configuration file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP 1</code></strong></pre><p>Since <code class="command">init</code> is always the first process
	run on a system, it always has a process <acronym class="acronym">ID</acronym>
	of <code class="literal">1</code>.</p><p>If everything is set up correctly, all cables are in
	place, and the terminals are powered up, a
	<code class="command">getty</code> process should now be running on each
	terminal and login prompts should be available on each
	terminal.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="term-debug"></a>26.3.2. Troubleshooting the Connection</h3></div></div></div><p>Even with the most meticulous attention to detail,
	something could still go wrong while setting up a terminal.
	Here is a list of common symptoms and some suggested
	fixes.</p><p>If no login prompt appears, make sure the terminal is
	plugged in and powered up.  If it is a personal computer
	acting as a terminal, make sure it is running terminal
	emulation software on the correct serial port.</p><p>Make sure the cable is connected firmly to both the
	terminal and the FreeBSD computer.  Make sure it is the right
	kind of cable.</p><p>Make sure the terminal and FreeBSD agree on the
	<acronym class="acronym">bps</acronym> rate and parity settings.  For a video
	display terminal, make sure the contrast and brightness
	controls are turned up.  If it is a printing terminal, make
	sure paper and ink are in good supply.</p><p>Use <code class="command">ps</code> to make sure that a
	<code class="command">getty</code> process is running and serving the
	terminal.  For example, the following listing shows that a
	<code class="command">getty</code> is running on the second serial port,
	<code class="filename">ttyu1</code>, and is using the
	<code class="literal">std.38400</code> entry in
	<code class="filename">/etc/gettytab</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ps -axww|grep ttyu</code></strong>
22189  d1  Is+    0:00.03 /usr/libexec/getty std.38400 ttyu1</pre><p>If no <code class="command">getty</code> process is running, make
	sure the port is enabled in <code class="filename">/etc/ttys</code>.
	Remember to run <code class="command">kill -HUP 1</code> after modifying
	<code class="filename">/etc/ttys</code>.</p><p>If the <code class="command">getty</code> process is running but the
	terminal still does not display a login prompt, or if it
	displays a prompt but will not accept typed input, the
	terminal or cable may not support hardware handshaking.  Try
	changing the entry in <code class="filename">/etc/ttys</code> from
	<code class="literal">std.38400</code> to
	<code class="literal">3wire.38400</code>, then run <code class="command">kill -HUP
	  1</code> after modifying <code class="filename">/etc/ttys</code>.
	The <code class="literal">3wire</code> entry is similar to
	<code class="literal">std</code>, but ignores hardware handshaking.  The
	baud rate may need to be reduced or software flow control
	enabled when using <code class="literal">3wire</code> to prevent buffer
	overflows.</p><p>If garbage appears instead of a login prompt, make sure
	the terminal and FreeBSD agree on the <acronym class="acronym">bps</acronym> rate
	and parity settings.  Check the <code class="command">getty</code>
	processes to make sure the correct
	<em class="replaceable"><code>getty</code></em> type is in use.  If not, edit
	<code class="filename">/etc/ttys</code> and run <code class="command">kill
	  -HUP 1</code>.</p><p>If characters appear doubled and the password appears when
	typed, switch the terminal, or the terminal emulation
	software, from <span class="quote">&#8220;<span class="quote">half duplex</span>&#8221;</span> or <span class="quote">&#8220;<span class="quote">local
	  echo</span>&#8221;</span> to <span class="quote">&#8220;<span class="quote">full duplex.</span>&#8221;</span></p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dialup"></a>26.4. Dial-in Service</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Guy</span> <span class="surname">Helmer</span></span>. </span></div><div><span class="authorgroup">Additions by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Sean</span> <span class="surname">Kelly</span></span>. </span></div></div></div><a id="idp65576568" class="indexterm"></a><p>Configuring a FreeBSD system for dial-in service is similar to
      configuring terminals, except that modems are used instead of
      terminal devices.  FreeBSD supports both external and internal
      modems.</p><p>External modems are more convenient because they often can
      be configured via parameters stored in non-volatile
      <acronym class="acronym">RAM</acronym> and they usually provide lighted
      indicators that display the state of important
      <acronym class="acronym">RS-232</acronym> signals, indicating whether the modem
      is operating properly.</p><p>Internal modems usually lack non-volatile
      <acronym class="acronym">RAM</acronym>, so their configuration may be limited to
      setting <acronym class="acronym">DIP</acronym> switches.  If the internal modem
      has any signal indicator lights, they are difficult to view when
      the system's cover is in place.</p><a id="idp65579896" class="indexterm"></a><p>When using an external modem, a proper cable is needed.  A
      standard <acronym class="acronym">RS-232C</acronym> serial cable should
      suffice.</p><p>FreeBSD needs the <acronym class="acronym">RTS</acronym> and
      <acronym class="acronym">CTS</acronym> signals for flow control at speeds above
      2400 bps, the <acronym class="acronym">CD</acronym> signal to detect when a
      call has been answered or the line has been hung up, and the
      <acronym class="acronym">DTR</acronym> signal to reset the modem after a session
      is complete.  Some cables are wired without all of the needed
      signals, so if a login session does not go away when the line
      hangs up, there may be a problem with the cable.  Refer to <a class="xref" href="#term-cables-null" title="26.2.1. Serial Cables and Ports">Section 26.2.1, &#8220;Serial Cables and Ports&#8221;</a> for more information about these
      signals.</p><p>Like other <span class="trademark">UNIX</span>®-like operating systems, FreeBSD uses the
      hardware signals to find out when a call has been answered or a
      line has been hung up and to hangup and reset the modem after a
      call.  FreeBSD avoids sending commands to the modem or watching for
      status reports from the modem.</p><p>FreeBSD supports the <acronym class="acronym">NS8250</acronym>,
      <acronym class="acronym">NS16450</acronym>, <acronym class="acronym">NS16550</acronym>, and
      <acronym class="acronym">NS16550A</acronym>-based <acronym class="acronym">RS-232C</acronym>
      (<acronym class="acronym">CCITT</acronym> V.24) communications interfaces.  The
      8250 and 16450 devices have single-character buffers.  The 16550
      device provides a 16-character buffer, which allows for better
      system performance.  Bugs in plain 16550 devices prevent the use
      of the 16-character buffer, so use 16550A devices if possible.
      Because single-character-buffer devices require more work by the
      operating system than the 16-character-buffer devices,
      16550A-based serial interface cards are preferred.  If the
      system has many active serial ports or will have a heavy load,
      16550A-based cards are better for low-error-rate
      communications.</p><p>The rest of this section demonstrates how to configure a
      modem to receive incoming connections, how to communicate with
      the modem, and offers some troubleshooting tips.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dialup-ttys"></a>26.4.1. Modem Configuration</h3></div></div></div><a id="idp65887352" class="indexterm"></a><p>As with terminals, <code class="command">init</code> spawns a
	<code class="command">getty</code> process for each configured serial
	port used for dial-in connections.  When a user dials the
	modem's line and the modems connect, the <span class="quote">&#8220;<span class="quote">Carrier
	  Detect</span>&#8221;</span> signal is reported by the modem.  The kernel
	notices that the carrier has been detected and instructs
	<code class="command">getty</code> to open the port and display a
	<code class="prompt">login:</code> prompt at the specified initial line
	speed.  In a typical configuration, if garbage characters are
	received, usually due to the modem's connection speed being
	different than the configured speed, <code class="command">getty</code>
	tries adjusting the line speeds until it receives reasonable
	characters.  After the user enters their login name,
	<code class="command">getty</code> executes <code class="command">login</code>,
	which completes the login process by asking for the user's
	password and then starting the user's shell.</p><a id="idp65920120" class="indexterm"></a><p>There are two schools of thought regarding dial-up modems.
	One configuration method is to set the modems and systems so
	that no matter at what speed a remote user dials in, the
	dial-in <acronym class="acronym">RS-232</acronym> interface runs at a locked
	speed.  The benefit of this configuration is that the remote
	user always sees a system login prompt immediately.  The
	downside is that the system does not know what a user's true
	data rate is, so full-screen programs like
	<span class="application">Emacs</span> will not adjust their
	screen-painting methods to make their response better for
	slower connections.</p><p>The second method is to configure the
	<acronym class="acronym">RS-232</acronym> interface to vary its speed based on
	the remote user's connection speed.  Because
	<code class="command">getty</code> does not understand any particular
	modem's connection speed reporting, it gives a
	<code class="prompt">login:</code> message at an initial speed and
	watches the characters that come back in response.  If the
	user sees junk, they should press <span class="keycap"><strong>Enter</strong></span> until
	they see a recognizable prompt.  If the data rates do not
	match, <code class="command">getty</code> sees anything the user types
	as junk, tries the next speed, and gives the
	<code class="prompt">login:</code> prompt again.  This procedure normally
	only takes a keystroke or two before the user sees a good
	prompt.  This login sequence does not look as clean as the
	locked-speed method, but a user on a low-speed connection
	should receive better interactive response from full-screen
	programs.</p><p>When locking a modem's data communications rate at a
	particular speed, no changes to
	<code class="filename">/etc/gettytab</code> should be needed.  However,
	for a matching-speed configuration, additional entries may be
	required in order to define the speeds to use for the modem.
	This example configures a 14.4 Kbps modem with a top
	interface speed of 19.2 Kbps using 8-bit, no parity
	connections.  It configures <code class="command">getty</code> to start
	the communications rate for a V.32bis connection at
	19.2 Kbps, then cycles through 9600 bps,
	2400 bps, 1200 bps, 300 bps, and back to
	19.2 Kbps.  Communications rate cycling is implemented
	with the <code class="literal">nx=</code> (next table) capability.  Each
	line uses a <code class="literal">tc=</code> (table continuation) entry
	to pick up the rest of the settings for a particular data
	rate.</p><pre class="programlisting">#
# Additions for a V.32bis Modem
#
um|V300|High Speed Modem at 300,8-bit:\
        :nx=V19200:tc=std.300:
un|V1200|High Speed Modem at 1200,8-bit:\
        :nx=V300:tc=std.1200:
uo|V2400|High Speed Modem at 2400,8-bit:\
        :nx=V1200:tc=std.2400:
up|V9600|High Speed Modem at 9600,8-bit:\
        :nx=V2400:tc=std.9600:
uq|V19200|High Speed Modem at 19200,8-bit:\
        :nx=V9600:tc=std.19200:</pre><p>For a 28.8 Kbps modem, or to take advantage of
	compression on a 14.4 Kbps modem, use a higher
	communications rate, as seen in this example:</p><pre class="programlisting">#
# Additions for a V.32bis or V.34 Modem
# Starting at 57.6 Kbps
#
vm|VH300|Very High Speed Modem at 300,8-bit:\
        :nx=VH57600:tc=std.300:
vn|VH1200|Very High Speed Modem at 1200,8-bit:\
        :nx=VH300:tc=std.1200:
vo|VH2400|Very High Speed Modem at 2400,8-bit:\
        :nx=VH1200:tc=std.2400:
vp|VH9600|Very High Speed Modem at 9600,8-bit:\
        :nx=VH2400:tc=std.9600:
vq|VH57600|Very High Speed Modem at 57600,8-bit:\
        :nx=VH9600:tc=std.57600:</pre><p>For a slow <acronym class="acronym">CPU</acronym> or a heavily loaded
	system without 16550A-based serial ports, this configuration
	may produce <span class="errorname">sio</span>
	<span class="quote">&#8220;<span class="quote">silo</span>&#8221;</span> errors at 57.6 Kbps.</p><a id="idp65929464" class="indexterm"></a><p>The configuration of <code class="filename">/etc/ttys</code> is
	similar to <a class="xref" href="#ex-etc-ttys" title="Example 26.1. Configuring Terminal Entries">Example 26.1, &#8220;Configuring Terminal Entries&#8221;</a>, but a different
	argument is passed to <code class="command">getty</code> and
	<code class="literal">dialup</code> is used for the terminal type.
	Replace <em class="replaceable"><code>xxx</code></em> with the process
	<code class="command">init</code> will run on the device:</p><pre class="programlisting">ttyu0   "/usr/libexec/getty <em class="replaceable"><code>xxx</code></em>"   dialup on</pre><p>The <code class="literal">dialup</code> terminal type can be
	changed.  For example, setting <code class="literal">vt102</code> as the
	default terminal type allows users to use
	<acronym class="acronym">VT102</acronym> emulation on their remote
	systems.</p><p>For a locked-speed configuration, specify the speed with
	a valid type listed in <code class="filename">/etc/gettytab</code>.
	This example is for a modem whose port speed is locked at
	19.2 Kbps:</p><pre class="programlisting">ttyu0   "/usr/libexec/getty std.<em class="replaceable"><code>19200</code></em>"   dialup on</pre><p>In a matching-speed configuration, the entry needs to
	reference the appropriate beginning <span class="quote">&#8220;<span class="quote">auto-baud</span>&#8221;</span>
	entry in <code class="filename">/etc/gettytab</code>.  To continue the
	example for a matching-speed modem that starts at
	19.2 Kbps, use this entry:</p><pre class="programlisting">ttyu0   "/usr/libexec/getty V19200"   dialup on</pre><p>After editing <code class="filename">/etc/ttys</code>, wait until
	the modem is properly configured and connected before
	signaling <code class="command">init</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP 1</code></strong></pre><a id="idp65956856" class="indexterm"></a><p>High-speed modems, like <acronym class="acronym">V.32</acronym>,
	<acronym class="acronym">V.32bis</acronym>, and <acronym class="acronym">V.34</acronym>
	modems, use hardware (<code class="literal">RTS/CTS</code>) flow
	control.  Use <code class="command">stty</code> to set the hardware flow
	control flag for the modem port.  This example sets the
	<code class="varname">crtscts</code> flag on <code class="filename">COM2</code>'s
	dial-in and dial-out initialization devices:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>stty -f /dev/ttyu1.init crtscts</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>stty -f /dev/cuau1.init crtscts</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65963256"></a>26.4.2. Troubleshooting</h3></div></div></div><p>This section provides a few tips for troubleshooting a
	dial-up modem that will not connect to a FreeBSD system.</p><p>Hook up the modem to the FreeBSD system and boot the system.
	If the modem has status indication lights, watch to see
	whether the modem's <acronym class="acronym">DTR</acronym> indicator lights
	when the <code class="prompt">login:</code> prompt appears on the
	system's console.  If it lights up, that should mean that FreeBSD
	has started a <code class="command">getty</code> process on the
	appropriate communications port and is waiting for the modem
	to accept a call.</p><p>If the <acronym class="acronym">DTR</acronym> indicator does not light,
	login to the FreeBSD system through the console and type
	<code class="command">ps ax</code> to see if FreeBSD is running a
	<code class="command">getty</code> process on the correct port:</p><pre class="screen">  114 ??  I      0:00.10 /usr/libexec/getty V19200 <em class="replaceable"><code>ttyu0</code></em></pre><p>If the second column contains a <code class="literal">d0</code>
	instead of a <code class="literal">??</code> and the modem has not
	accepted a call yet, this means that <code class="command">getty</code>
	has completed its open on the communications port.  This could
	indicate a problem with the cabling or a misconfigured modem
	because <code class="command">getty</code> should not be able to open
	the communications port until the carrier detect signal has
	been asserted by the modem.</p><p>If no <code class="command">getty</code> processes are waiting to
	open the port, double-check that the entry for the port is
	correct in <code class="filename">/etc/ttys</code>.  Also, check
	<code class="filename">/var/log/messages</code> to see if there are
	any log messages from <code class="command">init</code> or
	<code class="command">getty</code>.</p><p>Next, try dialing into the system.  Be sure to use 8 bits,
	no parity, and 1 stop bit on the remote system.  If a prompt
	does not appear right away, or the prompt shows garbage, try
	pressing <span class="keycap"><strong>Enter</strong></span> about once per second.  If
	there is still no <code class="prompt">login:</code> prompt,
	try sending a <code class="command">BREAK</code>.  When using a
	high-speed modem, try dialing again after locking the
	dialing modem's interface speed.</p><p>If there is still no <code class="prompt">login:</code> prompt, check
	<code class="filename">/etc/gettytab</code> again and double-check
	that:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The initial capability name specified in the entry in
	    <code class="filename">/etc/ttys</code> matches the name of a
	    capability in <code class="filename">/etc/gettytab</code>.</p></li><li class="listitem"><p>Each <code class="literal">nx=</code> entry matches another
	    <code class="filename">gettytab</code> capability name.</p></li><li class="listitem"><p>Each <code class="literal">tc=</code> entry matches another
	    <code class="filename">gettytab</code> capability name.</p></li></ul></div><p>If the modem on the FreeBSD system will not answer, make
	sure that the modem is configured to answer the phone when
	<acronym class="acronym">DTR</acronym> is asserted.  If the modem seems to be
	configured correctly, verify that the
	<acronym class="acronym">DTR</acronym> line is asserted by checking the
	modem's indicator lights.</p><p>If it still does not work, try sending an email
	to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">FreeBSD general questions mailing list</a> describing the modem and the
	problem.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dialout"></a>26.5. Dial-out Service</h2></div></div></div><a id="idp66036600" class="indexterm"></a><p>The following are tips for getting the host to connect over
      the modem to another computer.  This is appropriate for
      establishing a terminal session with a remote host.</p><p>This kind of connection can be helpful to get a file on the
      Internet if there are problems using PPP.  If PPP is not
      working, use the terminal session to FTP the needed file.  Then
      use zmodem to transfer it to the machine.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="hayes-unsupported"></a>26.5.1. Using a Stock Hayes Modem</h3></div></div></div><p>A generic Hayes dialer is built into
	<code class="command">tip</code>.  Use <code class="literal">at=hayes</code> in
	<code class="filename">/etc/remote</code>.</p><p>The Hayes driver is not smart enough to recognize some of
	the advanced features of newer modems messages like
	<code class="literal">BUSY</code>, <code class="literal">NO DIALTONE</code>, or
	<code class="literal">CONNECT 115200</code>.  Turn those messages off
	when using <code class="command">tip</code> with
	<code class="command">ATX0&amp;W</code>.</p><p>The dial timeout for <code class="command">tip</code> is 60
	seconds.  The modem should use something less, or else
	<code class="command">tip</code> will think there is a communication
	problem.  Try <code class="command">ATS7=45&amp;W</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="direct-at"></a>26.5.2. Using <code class="literal">AT</code> Commands</h3></div></div></div><a id="idp66049528" class="indexterm"></a><p>Create a <span class="quote">&#8220;<span class="quote">direct</span>&#8221;</span> entry in
	<code class="filename">/etc/remote</code>.  For example, if the modem
	is hooked up to the first serial port,
	<code class="filename">/dev/cuau0</code>, use the following
	line:</p><pre class="programlisting">cuau0:dv=/dev/cuau0:br#19200:pa=none</pre><p>Use the highest <acronym class="acronym">bps</acronym> rate the modem
	supports in the <code class="literal">br</code> capability.  Then, type
	<code class="command">tip cuau0</code> to connect to the modem.</p><p>Or, use <code class="command">cu</code> as <code class="systemitem">root</code> with the following
	      command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cu -l<em class="replaceable"><code>line</code></em> -s<em class="replaceable"><code>speed</code></em></code></strong></pre><p><em class="replaceable"><code>line</code></em> is the serial port, such
	as <code class="filename">/dev/cuau0</code>, and
	<em class="replaceable"><code>speed</code></em> is the speed, such as
	<code class="literal">57600</code>.  When finished entering the AT
	commands, type <code class="command">~.</code> to exit.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="gt-failure"></a>26.5.3. The <code class="literal">@</code> Sign Does Not Work</h3></div></div></div><p>The <code class="literal">@</code> sign in the phone number
	capability tells <code class="command">tip</code> to look in
	<code class="filename">/etc/phones</code> for a phone number.  But, the
	<code class="literal">@</code> sign is also a special character in
	capability files like <code class="filename">/etc/remote</code>, so it
	needs to be escaped with a backslash:</p><pre class="programlisting">pn=\@</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dial-command-line"></a>26.5.4. Dialing from the Command Line</h3></div></div></div><p>Put a <span class="quote">&#8220;<span class="quote">generic</span>&#8221;</span> entry in
	<code class="filename">/etc/remote</code>.  For example:</p><pre class="programlisting">tip115200|Dial any phone number at 115200 bps:\
        :dv=/dev/cuau0:br#115200:at=hayes:pa=none:du:
tip57600|Dial any phone number at 57600 bps:\
        :dv=/dev/cuau0:br#57600:at=hayes:pa=none:du:</pre><p>This should now work:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tip -115200 5551234</code></strong></pre><p>Users who prefer <code class="command">cu</code> over
	<code class="command">tip</code>, can use a generic
	<code class="literal">cu</code> entry:</p><pre class="programlisting">cu115200|Use cu to dial any number at 115200bps:\
        :dv=/dev/cuau1:br#57600:at=hayes:pa=none:du:</pre><p>and type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cu 5551234 -s 115200</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="set-bps"></a>26.5.5. Setting the <acronym class="acronym">bps</acronym> Rate</h3></div></div></div><p>Put in an entry for <code class="literal">tip1200</code> or
	<code class="literal">cu1200</code>, but go ahead and use whatever
	<acronym class="acronym">bps</acronym> rate is appropriate with the
	<code class="literal">br</code> capability.
	<code class="command">tip</code> thinks a good default is 1200 bps
	which is why it looks for a <code class="literal">tip1200</code> entry.
	1200 bps does not have to be used, though.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="terminal-server"></a>26.5.6. Accessing a Number of Hosts Through a Terminal
	Server</h3></div></div></div><p>Rather than waiting until connected and typing
	<code class="command">CONNECT <em class="replaceable"><code>host</code></em></code>
	each time, use <code class="command">tip</code>'s <code class="literal">cm</code>
	capability.  For example, these entries in
	<code class="filename">/etc/remote</code> will let you type
	<code class="command">tip pain</code> or <code class="command">tip muffin</code>
	to connect to the hosts <code class="systemitem">pain</code> or
	<code class="systemitem">muffin</code>, and <code class="command">tip
	  deep13</code> to connect to the terminal server.</p><pre class="programlisting">pain|pain.deep13.com|Forrester's machine:\
        :cm=CONNECT pain\n:tc=deep13:
muffin|muffin.deep13.com|Frank's machine:\
        :cm=CONNECT muffin\n:tc=deep13:
deep13:Gizmonics Institute terminal server:\
        :dv=/dev/cuau2:br#38400:at=hayes:du:pa=none:pn=5551234:</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="tip-multiline"></a>26.5.7. Using More Than One Line with
	<code class="command">tip</code></h3></div></div></div><p>This is often a problem where a university has several
	modem lines and several thousand students trying to use
	them.</p><p>Make an entry in <code class="filename">/etc/remote</code> and use
	<code class="literal">@</code> for the <code class="literal">pn</code>
	capability:</p><pre class="programlisting">big-university:\
        :pn=\@:tc=dialout
dialout:\
        :dv=/dev/cuau3:br#9600:at=courier:du:pa=none:</pre><p>Then, list the phone numbers in
	<code class="filename">/etc/phones</code>:</p><pre class="programlisting">big-university 5551111
big-university 5551112
big-university 5551113
big-university 5551114</pre><p><code class="command">tip</code> will try each number in the listed
	order, then give up.  To keep retrying, run
	<code class="command">tip</code> in a <code class="literal">while</code>
	loop.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="multi-controlp"></a>26.5.8. Using the Force Character</h3></div></div></div><p><span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>P</strong></span> is the default <span class="quote">&#8220;<span class="quote">force</span>&#8221;</span> character,
	used to tell <code class="command">tip</code> that the next character is
	literal data.  The force character can be set to any other
	character with the <code class="command">~s</code> escape, which means
	<span class="quote">&#8220;<span class="quote">set a variable.</span>&#8221;</span></p><p>Type
	<code class="command">~sforce=<em class="replaceable"><code>single-char</code></em></code>
	followed by a newline.  <em class="replaceable"><code>single-char</code></em>
	is any single character.  If
	<em class="replaceable"><code>single-char</code></em> is left out, then the
	force character is the null character, which is accessed by
	typing
	<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>2</strong></span>
	or <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Space</strong></span>.  A pretty good value for
	<em class="replaceable"><code>single-char</code></em> is
	<span class="keycap"><strong>Shift</strong></span>+<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>6</strong></span>, which is only used on some terminal
	servers.</p><p>To change the force character, specify the following in
	<code class="filename">~/.tiprc</code>:</p><pre class="programlisting">force=<em class="replaceable"><code>single-char</code></em></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="uppercase"></a>26.5.9. Upper Case Characters</h3></div></div></div><p>This happens when
	<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>A</strong></span> is pressed, which is <code class="command">tip</code>'s
	<span class="quote">&#8220;<span class="quote">raise character</span>&#8221;</span>, specially designed for people
	with broken caps-lock keys.  Use <code class="command">~s</code> to set
	<code class="literal">raisechar</code> to something reasonable.  It can
	be set to be the same as the force character, if neither
	feature is used.</p><p>Here is a sample <code class="filename">~/.tiprc</code> for
	<span class="application">Emacs</span> users who need to type
	<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>2</strong></span> and <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>A</strong></span>:</p><pre class="programlisting">force=^^
raisechar=^^</pre><p>The <code class="literal">^^</code> is
	<span class="keycap"><strong>Shift</strong></span>+<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>6</strong></span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="tip-filetransfer"></a>26.5.10. File Transfers with <code class="command">tip</code></h3></div></div></div><p>When talking to another <span class="trademark">UNIX</span>®-like operating system,
	files can be sent and received using <code class="command">~p</code>
	(put) and <code class="command">~t</code> (take).  These commands run
	<code class="command">cat</code> and <code class="command">echo</code> on the
	remote system to accept and send files.  The syntax is:</p><div class="cmdsynopsis"><p><code class="command">~p</code>  local-file  [remote-file]</p></div><div class="cmdsynopsis"><p><code class="command">~t</code>  remote-file  [local-file]</p></div><p>There is no error checking, so another protocol, like
	zmodem, should probably be used.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="zmodem-tip"></a>26.5.11. Using <span class="application">zmodem</span> with
	<code class="command">tip</code>?</h3></div></div></div><p>To receive files, start the sending program on the remote
	end.  Then, type <code class="command">~C rz</code> to begin receiving
	them locally.</p><p>To send files, start the receiving program on the remote
	end.  Then, type <code class="command">~C sz
	<em class="replaceable"><code>files</code></em></code> to send them to the
	remote system.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="serialconsole-setup"></a>26.6. Setting Up the Serial Console</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Kazutaka</span> <span class="surname">YOKOTA</span></span>. </span></div><div><span class="authorgroup">Based on a document by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Bill</span> <span class="surname">Paul</span></span>. </span></div></div></div><a id="idp66201848" class="indexterm"></a><p>FreeBSD has the ability to boot a system with a dumb
      terminal on a serial port as a console.  This configuration is
      useful for system administrators who wish to install FreeBSD on
      machines that have no keyboard or monitor attached, and
      developers who want to debug the kernel or device
      drivers.</p><p>As described in <a class="xref" href="#boot" title="Chapter 12. The FreeBSD Booting Process">Chapter 12, <em>The FreeBSD Booting Process</em></a>, FreeBSD employs a three
      stage bootstrap.  The first two stages are in the boot block
      code which is stored at the beginning of the FreeBSD slice on the
      boot disk.  The boot block then loads and runs the boot loader
      as the third stage code.</p><p>In order to set up booting from a serial console, the boot
      block code, the boot loader code, and the kernel need to be
      configured.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-howto-fast"></a>26.6.1. Quick Serial Console Configuration</h3></div></div></div><p>This section provides a fast overview of setting up the
	serial console.  This procedure can be used when the dumb
	terminal is connected to <code class="filename">COM1</code>.</p><div class="procedure"><a id="idp66205432"></a><div class="procedure-title">Procedure 26.1. Configuring a Serial Console on
	  <code class="filename">COM1</code></div><ol class="procedure" type="1"><li class="step"><p>Connect the serial cable to
	    <code class="filename">COM1</code> and the controlling
	    terminal.</p></li><li class="step"><p>To configure boot messages to display on the serial
	    console, issue the following command as the
	    superuser:</p><pre class="screen"><code class="prompt">#</code> echo 'console="comconsole"' &gt;&gt; /boot/loader.conf</pre></li><li class="step"><p>Edit <code class="filename">/etc/ttys</code> and change
	    <code class="literal">off</code> to <code class="literal">on</code> and
	    <code class="literal">dialup</code> to <code class="literal">vt100</code> for
	    the <code class="filename">ttyu0</code> entry.  Otherwise, a
	    password will not be required to connect via the serial
	    console, resulting in a potential security hole.</p></li><li class="step"><p>Reboot the system to see if the changes took
	    effect.</p></li></ol></div><p>If a different configuration is required, see the next
	section for a more in-depth configuration explanation.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-howto"></a>26.6.2. In-Depth Serial Console Configuration</h3></div></div></div><p>This section provides a more detailed explanation of the
	steps needed to setup a serial console in FreeBSD.</p><div class="procedure"><a id="idp66218744"></a><div class="procedure-title">Procedure 26.2. Configuring a Serial Console</div><ol class="procedure" type="1"><li class="step"><p>Prepare a serial cable.</p><a id="idp66220024" class="indexterm"></a><p>Use either a null-modem cable or a standard serial
	    cable and a null-modem adapter.  See <a class="xref" href="#term-cables-null" title="26.2.1. Serial Cables and Ports">Section 26.2.1, &#8220;Serial Cables and Ports&#8221;</a> for a discussion on serial
	    cables.</p></li><li class="step"><p>Unplug the keyboard.</p><p>Many systems probe for the keyboard during the
	    Power-On Self-Test (<acronym class="acronym">POST</acronym>) and will
	    generate an error if the keyboard is not detected.  Some
	    machines will refuse to boot until the keyboard is plugged
	    in.</p><p>If the computer complains about the error, but boots
	    anyway, no further configuration is needed.</p><p>If the computer refuses to boot without a keyboard
	    attached, configure the <acronym class="acronym">BIOS</acronym> so that it
	    ignores this error.  Consult the motherboard's manual for
	    details on how to do this.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Try setting the keyboard to <span class="quote">&#8220;<span class="quote">Not
		installed</span>&#8221;</span> in the <acronym class="acronym">BIOS</acronym>.
	      This setting tells the <acronym class="acronym">BIOS</acronym> not to
	      probe for a keyboard at power-on so it should not
	      complain if the keyboard is absent.  If that option is
	      not present in the <acronym class="acronym">BIOS</acronym>, look for an
	      <span class="quote">&#8220;<span class="quote">Halt on Error</span>&#8221;</span> option instead.  Setting
	      this to <span class="quote">&#8220;<span class="quote">All but Keyboard</span>&#8221;</span> or to <span class="quote">&#8220;<span class="quote">No
		Errors</span>&#8221;</span> will have the same effect.</p></div><p>If the system has a <span class="trademark">PS/2</span>® mouse, unplug it as well.
	    <span class="trademark">PS/2</span>® mice share some hardware with the keyboard and
	    leaving the mouse plugged in can fool the keyboard probe
	    into thinking the keyboard is still there.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">While most systems will boot without a keyboard,
	      quite a few will not boot without a graphics adapter.
	      Some systems can be configured to  boot with no graphics
	      adapter by changing the <span class="quote">&#8220;<span class="quote">graphics adapter</span>&#8221;</span>
	      setting in the <acronym class="acronym">BIOS</acronym> configuration to
	      <span class="quote">&#8220;<span class="quote">Not installed</span>&#8221;</span>.  Other systems do not
	      support this option and will refuse to boot if there is
	      no display hardware in the system.  With these machines,
	      leave some kind of graphics card plugged in, even if it
	      is just a junky mono board.  A monitor does not need to
	      be attached.</p></div></li><li class="step"><p>Plug a dumb terminal, an old computer with a modem
	    program, or the serial port on another <span class="trademark">UNIX</span>® box into the
	    serial port.</p></li><li class="step"><p>Add the appropriate <code class="literal">hint.sio.*</code>
	    entries to <code class="filename">/boot/device.hints</code> for the
	    serial port.  Some multi-port cards also require kernel
	    configuration options.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a> for the
	    required options and device hints for each supported
	    serial port.</p></li><li class="step"><p>Create <code class="filename">boot.config</code> in the root
	    directory of the <code class="literal">a</code> partition on the
	    boot drive.</p><p>This file instructs the boot block code how to boot
	    the system.  In order to activate the serial console, one
	    or more of the following options are needed.  When using
	    multiple options, include them all on the same
	    line:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-h</code></span></dt><dd><p>Toggles between the internal and serial
		  consoles.  Use this to switch console devices.  For
		  instance, to boot from the internal (video) console,
		  use <code class="option">-h</code> to direct the boot loader
		  and the kernel to use the serial port as its console
		  device.  Alternatively, to boot from the serial
		  port, use <code class="option">-h</code> to tell the boot
		  loader and the kernel to use the video display as
		  the console instead.</p></dd><dt><span class="term"><code class="option">-D</code></span></dt><dd><p>Toggles between the single and dual console
		  configurations.  In the single configuration, the
		  console will be either the internal console (video
		  display) or the serial port, depending on the state
		  of <code class="option">-h</code>.  In the dual console
		  configuration, both the video display  and the
		  serial port will become the console at the same
		  time, regardless of the state of
		  <code class="option">-h</code>.  However, the dual console
		  configuration takes effect only while the boot
		  block is running.  Once the boot loader gets
		  control, the console specified by
		  <code class="option">-h</code> becomes the only
		  console.</p></dd><dt><span class="term"><code class="option">-P</code></span></dt><dd><p>Makes the boot block probe the keyboard.  If no
		  keyboard is found, the <code class="option">-D</code> and
		  <code class="option">-h</code> options are automatically
		  set.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Due to space constraints in the current
		    version of the boot blocks, <code class="option">-P</code> is
		    capable of detecting extended keyboards only.
		    Keyboards with less than 101 keys and without F11
		    and F12 keys may not be detected.  Keyboards on
		    some laptops may not be properly found because of
		    this limitation.  If this is the case, do not use
		    <code class="option">-P</code>.</p></div></dd></dl></div><p>Use either <code class="option">-P</code> to select the console
	    automatically or <code class="option">-h</code> to activate the
	    serial console.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=boot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">boot</span>(8)</span></a> and
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=boot.config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">boot.config</span>(5)</span></a> for more details.</p><p>The options, except for <code class="option">-P</code>, are
	    passed to the boot loader.  The boot loader will
	    determine whether the internal video or the serial port
	    should become the console by examining the state of
	    <code class="option">-h</code>.  This means that if
	    <code class="option">-D</code> is specified but <code class="option">-h</code>
	    is not specified in <code class="filename">/boot.config</code>, the
	    serial port can be used as the console only during the
	    boot block as the boot loader will use the internal video
	    display as the console.</p></li><li class="step"><p>Boot the machine.</p><p>When FreeBSD starts, the boot blocks echo the contents of
	    <code class="filename">/boot.config</code> to the console.  For
	    example:</p><pre class="screen">/boot.config: -P
Keyboard: no</pre><p>The second line appears only if <code class="option">-P</code> is
	    in <code class="filename">/boot.config</code> and indicates the
	    presence or absence of the keyboard.  These messages go
	    to either the serial or internal console, or both,
	    depending on the option in
	    <code class="filename">/boot.config</code>:</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Options</th><th align="left">Message goes to</th></tr></thead><tbody><tr><td>none</td><td>internal console</td></tr><tr><td><code class="option">-h</code></td><td>serial console</td></tr><tr><td><code class="option">-D</code></td><td>serial and internal consoles</td></tr><tr><td><code class="option">-Dh</code></td><td>serial and internal consoles</td></tr><tr><td><code class="option">-P</code>, keyboard present</td><td>internal console</td></tr><tr><td><code class="option">-P</code>, keyboard absent</td><td>serial console</td></tr></tbody></table></div><p>After the message, there will be a small pause before
	    the boot blocks continue loading the boot loader and
	    before any further messages are printed to the console.
	    Under normal circumstances, there is no need to interrupt
	    the boot blocks, but one can do so in order to make sure
	    things are set up correctly.</p><p>Press any key, other than <span class="keycap"><strong>Enter</strong></span>, at
	    the console to interrupt the boot process.  The boot
	    blocks will then prompt for further action:</p><pre class="screen">&gt;&gt; FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:</pre><p>Verify that the above message appears on either the
	    serial or internal console, or both, according to the
	    options in <code class="filename">/boot.config</code>.  If the
	    message appears in the correct console, press
	    <span class="keycap"><strong>Enter</strong></span> to continue the boot
	    process.</p><p>If there is no prompt on the serial terminal,
	    something is wrong with the settings.  Enter
	    <code class="option">-h</code> then <span class="keycap"><strong>Enter</strong></span> or
	    <span class="keycap"><strong>Return</strong></span> to tell the boot block (and then
	    the boot loader and the kernel) to choose the serial port
	    for the console.  Once the system is up, go back and check
	    what went wrong.</p></li></ol></div><p>During the third stage of the boot process, one can still
	switch between the internal console and the serial console by
	setting appropriate environment variables in the boot loader.
	See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> for more
	information.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">This line in <code class="filename">/boot/loader.conf</code> or
	  <code class="filename">/boot/loader.conf.local</code> configures the
	  boot loader and the kernel to send their boot messages to
	  the serial console, regardless of the options in
	  <code class="filename">/boot.config</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">console="comconsole"</pre><p xmlns="http://www.w3.org/1999/xhtml">That line should be the first line of
	  <code class="filename">/boot/loader.conf</code> so that boot messages
	  are displayed on the serial console as early as
	  possible.</p><p xmlns="http://www.w3.org/1999/xhtml">If that line does not exist, or if it is set to
	  <code class="literal">console="vidconsole"</code>, the boot loader and
	  the kernel will use whichever console is indicated by
	  <code class="option">-h</code> in the boot block.  See
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> for more information.</p><p xmlns="http://www.w3.org/1999/xhtml">At the moment, the boot loader has no option
	  equivalent to <code class="option">-P</code> in the boot block, and
	  there is no provision to automatically select the internal
	  console and the serial console based on the presence of the
	  keyboard.</p></div><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">While it is not required, it is possible to provide a
	  <code class="command">login</code> prompt over the serial line.  To
	  configure this, edit the entry for the serial port in
	  <code class="filename">/etc/ttys</code> using the instructions in
	  <a class="xref" href="#term-config" title="26.3.1. Terminal Configuration">Section 26.3.1, &#8220;Terminal Configuration&#8221;</a>.  If the speed of the serial
	  port has been changed, change <code class="literal">std.9600</code> to
	  match the new setting.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66336888"></a>26.6.3. Setting a Faster Serial Port Speed</h3></div></div></div><p>By default, the serial port settings are 9600 baud, 8
	bits, no parity, and 1 stop bit.  To change the default
	console speed, use one of the following options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Edit <code class="filename">/etc/make.conf</code> and set
	    <code class="varname">BOOT_COMCONSOLE_SPEED</code> to the new
	    console speed.  Then, recompile and install the boot
	    blocks and the boot loader:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/boot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make clean</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre><p>If the serial console is configured in some other way
	    than by booting with <code class="option">-h</code>, or if the serial
	    console used by the kernel is different from the one used
	    by the boot blocks, add the following option, with the
	    desired speed, to a custom kernel configuration file and
	    compile a new kernel:</p><pre class="programlisting">options CONSPEED=<em class="replaceable"><code>19200</code></em></pre></li><li class="listitem"><p>Add the
	    <code class="option">-S<em class="replaceable"><code>19200</code></em></code> boot
	    option to <code class="filename">/boot.config</code>, replacing
	    <em class="replaceable"><code>19200</code></em> with the speed to
	    use.</p></li><li class="listitem"><p>Add the following options to
	    <code class="filename">/boot/loader.conf</code>.  Replace
	    <em class="replaceable"><code>115200</code></em> with the speed to
	    use.</p><pre class="programlisting">boot_multicons="YES"
boot_serial="YES"
comconsole_speed="<em class="replaceable"><code>115200</code></em>"
console="comconsole,vidconsole"</pre></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-ddb"></a>26.6.4. Entering the DDB Debugger from the Serial Line</h3></div></div></div><p>To configure the ability to drop into the kernel debugger
	from the serial console, add the following options to a custom
	kernel configuration file and compile the kernel using the
	instructions in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>.  Note that
	while this is useful for remote diagnostics, it is also
	dangerous if a spurious BREAK is generated on the serial port.
	Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ddb&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ddb</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ddb&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ddb</span>(8)</span></a> for more information
	about the kernel debugger.</p><pre class="programlisting">options BREAK_TO_DEBUGGER
options DDB</pre></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ppp-and-slip"></a>Chapter 27. <acronym class="acronym">PPP</acronym></h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#ppp-and-slip-synopsis">27.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#userppp">27.2. Configuring <acronym class="acronym">PPP</acronym></a></span></dt><dt><span class="sect1"><a href="#ppp-troubleshoot">27.3. Troubleshooting <acronym class="acronym">PPP</acronym> Connections</a></span></dt><dt><span class="sect1"><a href="#pppoe">27.4. Using <acronym class="acronym">PPP</acronym> over Ethernet (PPPoE)</a></span></dt><dt><span class="sect1"><a href="#pppoa">27.5. Using <span class="application">PPP</span> over
      <acronym class="acronym">ATM</acronym> (PPPoA)</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp-and-slip-synopsis"></a>27.1. Synopsis</h2></div></div></div><a id="ppp-ppp" class="indexterm"></a><p>FreeBSD supports the Point-to-Point (<acronym class="acronym">PPP</acronym>)
      protocol which can be used to establish a network or Internet
      connection using a dial-up modem.  This chapter describes how to
      configure modem-based communication services in FreeBSD.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to configure, use, and troubleshoot a
	  <acronym class="acronym">PPP</acronym> connection.</p></li><li class="listitem"><p>How to set up <acronym class="acronym">PPP</acronym> over Ethernet
	  (<acronym class="acronym">PPPoE</acronym>).</p></li><li class="listitem"><p>How to set up <acronym class="acronym">PPP</acronym> over
	  <acronym class="acronym">ATM</acronym>
	  (<acronym class="acronym">PPPoA</acronym>).</p></li></ul></div><a id="idp66366456" class="indexterm"></a><a id="idp66367352" class="indexterm"></a><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Be familiar with basic network terminology.</p></li><li class="listitem"><p>Understand the basics and purpose of a dial-up
	  connection and <acronym class="acronym">PPP</acronym>.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="userppp"></a>27.2. Configuring <acronym class="acronym">PPP</acronym></h2></div></div></div><p>FreeBSD provides built-in support for managing dial-up
      <acronym class="acronym">PPP</acronym> connections using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>.  The
      default FreeBSD kernel provides support for
      <code class="filename">tun</code> which is used to interact with a
      modem hardware.  Configuration is performed by editing at least
      one configuration file, and configuration files containing
      examples are provided.  Finally, <code class="command">ppp</code> is
      used to start and manage connections.</p><p>In order to use a <acronym class="acronym">PPP</acronym> connection, the
      following items are needed:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A dial-up account with an Internet Service Provider
	  (<acronym class="acronym">ISP</acronym>).</p></li><li class="listitem"><p>A dial-up modem.</p></li><li class="listitem"><p>The dial-up number for the
	  <acronym class="acronym">ISP</acronym>.</p></li><li class="listitem"><p>The login name and password assigned by the
	  <acronym class="acronym">ISP</acronym>.</p></li><li class="listitem"><p>The <acronym class="acronym">IP</acronym> address of one or more
	  <acronym class="acronym">DNS</acronym> servers.  Normally, the
	  <acronym class="acronym">ISP</acronym> provides these addresses.  If it did
	  not, FreeBSD can be configured to use
	  <acronym class="acronym">DNS</acronym> negotiation.</p></li></ul></div><p>If any of the required information is missing, contact
      the <acronym class="acronym">ISP</acronym>.</p><p>The following information may be supplied by the
      <acronym class="acronym">ISP</acronym>, but is not necessary:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <acronym class="acronym">IP</acronym> address of the default
	  gateway.  If this information is unknown, the
	  <acronym class="acronym">ISP</acronym> will automatically provide the
	  correct value during connection setup.  When configuring
	  <acronym class="acronym">PPP</acronym> on FreeBSD, this address is referred to
	  as <code class="literal">HISADDR</code>.</p></li><li class="listitem"><p>The subnet mask.  If the <acronym class="acronym">ISP</acronym> has not
	  provided one, <code class="systemitem">255.255.255.255</code> will be used
	  in the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> configuration file.</p></li><li class="listitem"><a id="ppp-static-ip" class="indexterm"></a><p>If the <acronym class="acronym">ISP</acronym> has assigned a static
	  <acronym class="acronym">IP</acronym> address and hostname, it should be
	  input into the configuration file.  Otherwise, this
	  information will be automatically provided during
	  connection setup.</p></li></ul></div><p>The rest of this section demonstrates how to configure FreeBSD
      for common <acronym class="acronym">PPP</acronym> connection scenarios.  The
      required configuration file is
      <code class="filename">/etc/ppp/ppp.conf</code> and additional files and
      examples are available in
      <code class="filename">/usr/share/examples/ppp/</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Throughout this section, many of the file examples
	display line numbers.  These line numbers have been added to
	make it easier to follow the discussion and are not meant to
	be placed in the actual file.</p><p xmlns="http://www.w3.org/1999/xhtml">When editing a configuration file, proper indentation is
	important.  Lines that end in a <code class="literal">:</code> start in
	the first column (beginning of the line) while all other lines
	should be indented as shown using spaces or tabs.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-staticIP"></a>27.2.1. Basic Configuration</h3></div></div></div><a id="idp66416632" class="indexterm"></a><p>In order to configure a <acronym class="acronym">PPP</acronym> connection,
	first edit <code class="filename">/etc/ppp/ppp.conf</code> with the
	dial-in information for the <acronym class="acronym">ISP</acronym>.  This file
	is described as follows:</p><pre class="programlisting">1     default:
2       set log Phase Chat LCP IPCP CCP tun command
3       ident user-ppp VERSION
4       set device /dev/cuau0
5       set speed 115200
6       set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \
7                 \"\" AT OK-AT-OK ATE1Q0 OK \\dATDT\\T TIMEOUT 40 CONNECT"
8       set timeout 180
9       enable dns
10
11    provider:
12      set phone "(123) 456 7890"
13      set authname foo
14      set authkey bar
15      set timeout 300
16      set ifaddr <em class="replaceable"><code>x.x.x.x</code></em>/0 <em class="replaceable"><code>y.y.y.y</code></em>/0 255.255.255.255 0.0.0.0
17      add default HISADDR</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">Line 1:</span></dt><dd><p>Identifies the <code class="literal">default</code> entry.
		  Commands in this entry (lines 2 through 9) are
		  executed automatically when <code class="command">ppp</code>
		  is run.</p></dd><dt><span class="term">Line 2:</span></dt><dd><p>Enables verbose logging parameters for testing
		  the connection.  Once the configuration is working
		  satisfactorily, this line should be reduced
		  to:</p><pre class="programlisting">set log phase tun</pre></dd><dt><span class="term">Line 3:</span></dt><dd><p>Displays the version of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to the
		  <acronym class="acronym">PPP</acronym> software running on the other
		  side of the  connection.</p></dd><dt><span class="term">Line 4:</span></dt><dd><p>Identifies the device to which the modem is
		  connected, where  <code class="filename">COM1</code> is
		  <code class="filename">/dev/cuau0</code> and
		  <code class="filename">COM2</code> is
		  <code class="filename">/dev/cuau1</code>.</p></dd><dt><span class="term">Line 5:</span></dt><dd><p>Sets the connection speed.  If
		  <code class="literal">115200</code> does not work on an older
		  modem, try <code class="literal">38400</code> instead.</p></dd><dt><span class="term">Lines 6 &amp; 7:</span></dt><dd><p>The dial string written as an expect-send
		  syntax.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chat&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chat</span>(8)</span></a> for more
		  information.</p><p>Note that this command continues onto the next
		  line for readability.  Any command in
		  <code class="filename">ppp.conf</code> may do this if the
		  last character on the line is
		  <code class="literal">\</code>.</p></dd><dt><span class="term">Line 8:</span></dt><dd><p>Sets the idle timeout for the link in
		  seconds.</p></dd><dt><span class="term">Line 9:</span></dt><dd><p>Instructs the peer to confirm the
		  <acronym class="acronym">DNS</acronym> settings.  If the local
		  network is running its own <acronym class="acronym">DNS</acronym>
		  server, this line should be commented out, by adding
		  a <code class="literal">#</code> at the beginning of the line,
		  or removed.</p></dd><dt><span class="term">Line 10:</span></dt><dd><p>A blank line for readability.  Blank lines are
		  ignored by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>.</p></dd><dt><span class="term">Line 11:</span></dt><dd><p>Identifies an entry called
		  <code class="literal">provider</code>.  This could be changed
		  to the name of the <acronym class="acronym">ISP</acronym> so that
		  <code class="option">load
		    <em class="replaceable"><code>ISP</code></em></code> can be
		  used to start the connection.</p></dd><dt><span class="term">Line 12:</span></dt><dd><p>Use the phone number for the
		  <acronym class="acronym">ISP</acronym>.  Multiple phone numbers may
		  be specified using the colon (<code class="literal">:</code>)
		  or pipe character (<code class="literal">|</code>) as a
		  separator.  To rotate through the numbers, use a
		  colon.  To always attempt to dial the first number
		  first and only use the other numbers if the first
		  number fails, use the pipe character.  Always
		  enclose the entire set of phone numbers between
		  quotation marks (<code class="literal">"</code>) to prevent
		  dialing failures.</p></dd><dt><span class="term">Lines 13 &amp; 14:</span></dt><dd><p>Use the user name and password for the
		  <acronym class="acronym">ISP</acronym>.</p></dd><dt><span class="term">Line 15:</span></dt><dd><p>Sets the default idle timeout in seconds for the
		  connection.  In this example, the connection will be
		  closed automatically after 300 seconds of
		  inactivity.  To prevent a timeout, set this value to
		  zero.</p></dd><dt><span class="term">Line 16:</span></dt><dd><p>Sets the interface addresses.  The values used
		  depend upon whether a static <acronym class="acronym">IP</acronym>
		  address has been obtained from the
		  <acronym class="acronym">ISP</acronym> or if it  instead negotiates
		  a dynamic <acronym class="acronym">IP</acronym> address during
		  connection.</p><p>If the  <acronym class="acronym">ISP</acronym> has allocated a
		  static <acronym class="acronym">IP</acronym> address and default
		  gateway, replace <em class="replaceable"><code>x.x.x.x</code></em>
		  with the static  <acronym class="acronym">IP</acronym> address and
		  replace <em class="replaceable"><code>y.y.y.y</code></em> with the
		  <acronym class="acronym">IP</acronym> address of the default
		  gateway.  If the <acronym class="acronym">ISP</acronym> has only
		  provided a static <acronym class="acronym">IP</acronym> address
		  without a gateway address, replace
		  <em class="replaceable"><code>y.y.y.y</code></em> with <code class="systemitem">10.0.0.2/0</code>.</p><p>If the <acronym class="acronym">IP</acronym> address changes
		  whenever a connection is made, change this line to
		  the following value.  This tells <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to use
		  the <acronym class="acronym">IP</acronym> Configuration Protocol
		  (<acronym class="acronym">IPCP</acronym>) to negotiate a dynamic
		  <acronym class="acronym">IP</acronym> address:</p><pre class="programlisting">set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.255 0.0.0.0</pre></dd><dt><span class="term">Line 17:</span></dt><dd><p>Keep this line as-is as it adds a default route
		  to the gateway.  The <code class="literal">HISADDR</code> will
		  automatically be replaced with the gateway address
		  specified on line 16.  It is important that this
		  line appears after line 16.</p></dd></dl></div><p>Depending upon whether <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is started
	    manually or automatically, a
	    <code class="filename">/etc/ppp/ppp.linkup</code> may also need to
	    be created which contains the following lines.  This file
	    is required when running <code class="command">ppp</code> in
	    <code class="option">-auto</code> mode.  This file is used after the
	    connection has been established.  At this point, the
	    <acronym class="acronym">IP</acronym> address will have been assigned and
	    it is now be possible to add the routing table entries.
	    When creating this file, make sure that
	    <em class="replaceable"><code>provider</code></em> matches the value
	    demonstrated in line 11 of
	    <code class="filename">ppp.conf</code>.</p><pre class="programlisting">provider:
      add default HISADDR</pre><p>This file is also needed when the default gateway
	  address is <span class="quote">&#8220;<span class="quote">guessed</span>&#8221;</span> in a static
	  <acronym class="acronym">IP</acronym> address configuration.  In this case,
	  remove line 17 from <code class="filename">ppp.conf</code> and
	  create <code class="filename">/etc/ppp/ppp.linkup</code> with the
	  above two lines.  More examples for this file can be found
	  in <code class="filename">/usr/share/examples/ppp/</code>.</p><p>By default, <code class="command">ppp</code> must be
	  run as <code class="systemitem">root</code>.
	  To change this default, add the account of the user
	  who should run <code class="command">ppp</code> to the <code class="systemitem">network</code> group in
	  <code class="filename">/etc/group</code>.</p><p>Then, give the user access to one or more entries in
	  <code class="filename">/etc/ppp/ppp.conf</code> with
	  <code class="command">allow</code>.  For example, to give
	  <code class="systemitem">fred</code> and
	  <code class="systemitem">mary</code>
	  permission to only the <code class="literal">provider:</code> entry,
	  add this line to the <code class="literal">provider:</code>
	  section:</p><pre class="programlisting">allow users <em class="replaceable"><code>fred mary</code></em></pre><p>To give the specified users access to all entries, put
	  that line in the <code class="literal">default</code> section
	  instead.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66494840"></a>27.2.2. Advanced Configuration</h3></div></div></div><a id="idp66495480" class="indexterm"></a><a id="idp66496248" class="indexterm"></a><a id="idp66497016" class="indexterm"></a><p>It is possible to configure PPP to supply DNS and
	    NetBIOS nameserver addresses on demand.</p><p>To enable these extensions with
	    <acronym class="acronym">PPP</acronym> version 1.x, the following lines
	    might be added to the relevant section of
	    <code class="filename">/etc/ppp/ppp.conf</code>.</p><pre class="programlisting">enable msext
set ns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</pre><p>And for <acronym class="acronym">PPP</acronym> version 2 and
	    above:</p><pre class="programlisting">accept dns
set dns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</pre><p>This will tell the clients the primary and secondary
	    name server addresses, and a NetBIOS nameserver
	    host.</p><p>In version 2 and above, if the <code class="literal">set
	      dns</code> line is omitted,
	    <acronym class="acronym">PPP</acronym> will use the values found in
	    <code class="filename">/etc/resolv.conf</code>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-PAPnCHAP"></a>27.2.2.1. PAP and CHAP Authentication</h4></div></div></div><a id="idp66532856" class="indexterm"></a><a id="idp66533368" class="indexterm"></a><p>Some <acronym class="acronym">ISP</acronym>s set their system up so
	    that the authentication part of the connection is done
	    using either of the PAP or CHAP authentication mechanisms.
	    If this is the case, the <acronym class="acronym">ISP</acronym> will not
	    give a <code class="prompt">login:</code> prompt at connection, but
	    will start talking <acronym class="acronym">PPP</acronym>
	    immediately.</p><p>PAP is less secure than CHAP, but security is not
	    normally an issue here as passwords, although being sent
	    as plain text with PAP, are being transmitted down a
	    serial line only.  There is not much room for crackers
	    to <span class="quote">&#8220;<span class="quote">eavesdrop</span>&#8221;</span>.</p><p>The following
	    alterations must be made:</p><pre class="programlisting">13      set authname <em class="replaceable"><code>MyUserName</code></em>
14      set authkey <em class="replaceable"><code>MyPassword</code></em>
15      set login</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">Line 13:</span></dt><dd><p>This line specifies the PAP/CHAP user name.
		  Insert the correct value for
		  <em class="replaceable"><code>MyUserName</code></em>.</p></dd><dt><span class="term">Line 14:</span></dt><dd><p>This line specifies the PAP/CHAP
		  password<a id="idp66557816" class="indexterm"></a>.
		  Insert the correct value for
		  <em class="replaceable"><code>MyPassword</code></em>.  You may
		  want to add an additional line, such as:</p><pre class="programlisting">16      accept PAP</pre><p>or</p><pre class="programlisting">16      accept CHAP</pre><p>to make it obvious that this is the intention,
		  but PAP and CHAP are both accepted by
		  default.</p></dd><dt><span class="term">Line 15:</span></dt><dd><p>The <acronym class="acronym">ISP</acronym> will not normally
		  require a login to the server when using PAP or
		  CHAP.  Therefore, disable the <span class="quote">&#8220;<span class="quote">set
		    login</span>&#8221;</span> string.</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-nat"></a>27.2.2.2. Using <acronym class="acronym">PPP</acronym> Network Address
	  Translation Capability</h4></div></div></div><a id="idp66564344" class="indexterm"></a><p>PPP has ability to use internal NAT without kernel
	  diverting capabilities.  This functionality may be enabled
	  by the following line in
	  <code class="filename">/etc/ppp/ppp.conf</code>:</p><pre class="programlisting">nat enable yes</pre><p>Alternatively, NAT may be enabled by command-line
	  option <code class="literal">-nat</code>.  There is also
	  <code class="filename">/etc/rc.conf</code> knob named
	  <code class="literal">ppp_nat</code>, which is enabled by
	  default.</p><p>When using this feature, it may be useful to include
	  the following <code class="filename">/etc/ppp/ppp.conf</code> options
	  to enable incoming connections forwarding:</p><pre class="programlisting">nat port tcp 10.0.0.2:ftp ftp
nat port tcp 10.0.0.2:http http</pre><p>or do not trust the outside at all</p><pre class="programlisting">nat deny_incoming yes</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-final"></a>27.2.3. Final System Configuration</h3></div></div></div><a id="idp66575224" class="indexterm"></a><p>While <code class="command">ppp</code> is now configured,
	  some edits still need to be made to
	  <code class="filename">/etc/rc.conf</code>.</p><p>Working from the top down in this file, make sure the
	  <code class="literal">hostname=</code> line is set:</p><pre class="programlisting">hostname="foo.example.com"</pre><p>If the <acronym class="acronym">ISP</acronym> has supplied a static
	  <acronym class="acronym">IP</acronym> address and name, use this name as the
	  host name.</p><p>Look for the <code class="literal">network_interfaces</code>
	  variable.  To configure the system to dial the
	  <acronym class="acronym">ISP</acronym> on demand, make sure the
	  <code class="filename">tun0</code> device is added to the list,
	  otherwise remove it.</p><pre class="programlisting">network_interfaces="lo0 tun0"
ifconfig_tun0=</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <code class="literal">ifconfig_tun0</code> variable should
	    be empty, and a file called
	    <code class="filename">/etc/start_if.tun0</code> should be created.
	    This file should contain the line:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">ppp -auto mysystem</pre><p xmlns="http://www.w3.org/1999/xhtml">This script is executed at network configuration time,
	    starting the ppp daemon in automatic mode.  If this
	    machine acts as a gateway, consider including
	    <code class="option">-alias</code>.  Refer to the manual page for
	    further details.</p></div><p>Make sure that the router program is set to
	  <code class="literal">NO</code> with the following line in
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">router_enable="NO"</pre><a id="idp66585976" class="indexterm"></a><p>It is important that the <code class="command">routed</code>
	  daemon is not started, as <code class="command">routed</code> tends
	  to delete the default routing table entries created by
	  <code class="command">ppp</code>.</p><p>It is probably a good idea to ensure that the
	  <code class="literal">sendmail_flags</code> line does not include the
	  <code class="option">-q</code> option, otherwise
	  <code class="command">sendmail</code> will attempt to do a network
	  lookup every now and then, possibly causing your machine
	  to dial out.  You may try:</p><pre class="programlisting">sendmail_flags="-bd"</pre><a id="idp66590456" class="indexterm"></a><p>The downside is that <code class="command">sendmail</code> is
	  forced to re-examine the mail queue whenever the ppp link.
	  To automate this, include <code class="command">!bg</code> in
	  <code class="filename">ppp.linkup</code>:</p><pre class="programlisting">1     provider:
2       delete ALL
3       add 0 0 HISADDR
4       !bg sendmail -bd -q30m</pre><a id="idp66597368" class="indexterm"></a><p>An alternative is to set up a
	  <span class="quote">&#8220;<span class="quote">dfilter</span>&#8221;</span> to block SMTP traffic.  Refer to the
	  sample files for further details.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66599032"></a>27.2.4. Using <code class="command">ppp</code></h3></div></div></div><p>All that is left is to reboot the machine.  After
	  rebooting, either type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ppp</code></strong></pre><p>and then <code class="command">dial provider</code> to start the
	  <acronym class="acronym">PPP</acronym> session, or, to configure
	  <code class="command">ppp</code> to establish sessions automatically
	  when there is outbound traffic and
	  <code class="filename">start_if.tun0</code> does not exist,
	  type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ppp -auto provider</code></strong></pre><p>It is possible to talk to the <code class="command">ppp</code>
	    program while it is running in the background, but only
	    if a suitable diagnostic port has been set up.  To do
	    this, add the following line to the configuration:</p><pre class="programlisting">set server /var/run/ppp-tun<em class="replaceable"><code>%d</code></em> DiagnosticPassword 0177</pre><p>This will tell PPP to listen to the specified
	  <span class="trademark">UNIX</span>® domain socket, asking clients for the specified
	  password before allowing access.  The
	  <code class="literal">%d</code> in the name is replaced with the
	  <code class="filename">tun</code> device number that is in
	  use.</p><p>Once a socket has been set up, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pppctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pppctl</span>(8)</span></a>
	  program may be used in scripts that wish to manipulate
	  the running program.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-mgetty"></a>27.2.5. Configuring Dial-in Services</h3></div></div></div><a id="idp66613368" class="indexterm"></a><a id="idp66614264" class="indexterm"></a><a id="idp66615032" class="indexterm"></a><p><a class="xref" href="#dialup" title="26.4. Dial-in Service">Section 26.4, &#8220;Dial-in Service&#8221;</a> provides a good description
	    on enabling dial-up services using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=getty&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">getty</span>(8)</span></a>.</p><p>An alternative to <code class="command">getty</code> is
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/mgetty+sendfax/pkg-descr">comms/mgetty+sendfax</a>
	    port), a smarter version of <code class="command">getty</code>
	    designed with dial-up lines in mind.</p><p>The advantages of using <code class="command">mgetty</code> is
	    that it actively <span class="emphasis"><em>talks</em></span> to modems,
	    meaning if port is turned off in
	    <code class="filename">/etc/ttys</code> then the modem will not
	    answer the phone.</p><p>Later versions of <code class="command">mgetty</code> (from
	    0.99beta onwards) also support the automatic detection of
	    <acronym class="acronym">PPP</acronym> streams, allowing clients
	    scriptless access to the server.</p><p>Refer to <a class="link" href="http://mgetty.greenie.net/doc/mgetty_toc.html" target="_top">http://mgetty.greenie.net/doc/mgetty_toc.html</a>
	    for more information on <code class="command">mgetty</code>.</p><p>By default the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/mgetty+sendfax/pkg-descr">comms/mgetty+sendfax</a>
	    port comes with the <code class="literal">AUTO_PPP</code> option
	    enabled allowing <code class="command">mgetty</code> to detect the
	    LCP phase of <acronym class="acronym">PPP</acronym> connections and
	    automatically spawn off a ppp shell.  However, since the
	    default login/password sequence does not occur it is
	    necessary to authenticate users using either PAP or
	    CHAP.</p><p>This section assumes the user has successfully
	    compiled, and installed the
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/mgetty+sendfax/pkg-descr">comms/mgetty+sendfax</a> port on his
	    system.</p><p>Ensure that
	    <code class="filename">/usr/local/etc/mgetty+sendfax/login.config</code>
	    has the following:</p><pre class="programlisting">/AutoPPP/ -     - /etc/ppp/ppp-pap-dialup</pre><p>This tells <code class="command">mgetty</code> to run
	    <code class="filename">ppp-pap-dialup</code> for detected
	    <acronym class="acronym">PPP</acronym> connections.</p><p>Create an executable file called
	    <code class="filename">/etc/ppp/ppp-pap-dialup</code> containing
	    the following:</p><pre class="programlisting">#!/bin/sh
exec /usr/sbin/ppp -direct pap$IDENT</pre><p>For each dial-up line enabled in
	    <code class="filename">/etc/ttys</code>, create a corresponding
	    entry in <code class="filename">/etc/ppp/ppp.conf</code>.  This
	    will happily co-exist with the definitions we created
	    above.</p><pre class="programlisting">pap:
  enable pap
  set ifaddr 203.14.100.1 203.14.100.20-203.14.100.40
  enable proxy</pre><p>Each user logging in with this method will need to
	    have a username/password in
	    <code class="filename">/etc/ppp/ppp.secret</code>, or
	    alternatively add the following option to authenticate
	    users via PAP from
	    <code class="filename">/etc/passwd</code>.</p><pre class="programlisting">enable passwdauth</pre><p>To assign some users a static <acronym class="acronym">IP</acronym>
	    number, specify the number as the third argument in
	    <code class="filename">/etc/ppp/ppp.secret</code>.  See
	    <code class="filename">/usr/share/examples/ppp/ppp.secret.sample</code>
	    for examples.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp-troubleshoot"></a>27.3. Troubleshooting <acronym class="acronym">PPP</acronym> Connections</h2></div></div></div><a id="idp66651896" class="indexterm"></a><p>This section covers a few issues which may arise when
      using <acronym class="acronym">PPP</acronym> over a modem connection.  Some
      <acronym class="acronym">ISP</acronym>s present the
      <code class="literal">ssword</code> prompt while others present
      <code class="literal">password</code>.  If the <code class="command">ppp</code>
      script is not written accordingly, the login attempt will
      fail.  The most common way to debug <code class="command">ppp</code>
      connections is by connecting manually as described in this
      section.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66659960"></a>27.3.1. Check the Device Nodes</h3></div></div></div><p>When using a custom kernel, make sure to include the
	following line in the kernel configuration file:</p><pre class="programlisting">device   uart</pre><p>The <code class="filename">uart</code> device is already
	included in the <code class="literal">GENERIC</code> kernel, so no
	additional steps are necessary in this case.  Just
	check the <code class="command">dmesg</code> output for the modem
	device with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dmesg | grep uart</code></strong></pre><p>This should display some pertinent output about the
	<code class="filename">uart</code> devices.  These are the COM
	ports we need.  If the modem acts like a standard serial port,
	it should be listed on <code class="filename">uart1</code>, or
	<code class="filename">COM2</code>.  If so, a kernel rebuild is not
	required.  When matching up, if the modem is on
	<code class="filename">uart1</code>, the modem device would be
	<code class="filename">/dev/cuau1</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66666360"></a>27.3.2. Connecting Manually</h3></div></div></div><p>Connecting to the Internet by manually controlling
	<code class="command">ppp</code> is quick, easy, and a great way to
	debug a connection or just get information on how the
	<acronym class="acronym">ISP</acronym> treats <code class="command">ppp</code> client
	connections.  Lets start <span class="application">PPP</span> from
	the command line.  Note that in all of our examples we will
	use <span class="emphasis"><em>example</em></span> as the hostname of the
	machine running <span class="application">PPP</span>.  To start
	<code class="command">ppp</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ppp</code></strong></pre><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set device /dev/cuau1</code></strong></pre><p>This second command sets the modem device to
	<code class="filename">cuau1</code>.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set speed 115200</code></strong></pre><p>This sets the connection speed to
	115,200 <acronym class="acronym">kbps</acronym>.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>enable dns</code></strong></pre><p>This tells <code class="command">ppp</code> to configure the
	resolver and add the nameserver lines to
	<code class="filename">/etc/resolv.conf</code>.  If
	<code class="command">ppp</code> cannot determine the hostname, it can
	manually be set later.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>term</code></strong></pre><p>This switches to <span class="quote">&#8220;<span class="quote">terminal</span>&#8221;</span> mode in order to
	manually control the modem.</p><pre class="programlisting">deflink: Entering terminal mode on <code class="filename">/dev/cuau1</code>
type '~h' for help</pre><pre class="screen"><strong class="userinput"><code>at</code></strong>
OK
<strong class="userinput"><code>atdt<em class="replaceable"><code>123456789</code></em></code></strong></pre><p>Use <code class="command">at</code> to initialize the modem, then
	use <code class="command">atdt</code> and the number for the
	<acronym class="acronym">ISP</acronym> to begin the dial in process.</p><pre class="screen">CONNECT</pre><p>Confirmation of the connection, if we are going to have
	any connection problems, unrelated to hardware, here is where
	we will attempt to resolve them.</p><pre class="screen">ISP Login:<strong class="userinput"><code>myusername</code></strong></pre><p>At this prompt, return the prompt with the username that
	was provided by the <acronym class="acronym">ISP</acronym>.</p><pre class="screen">ISP Pass:<strong class="userinput"><code>mypassword</code></strong></pre><p>At this prompt, reply with the password that was provided
	by the <acronym class="acronym">ISP</acronym>.  Just like logging into FreeBSD,
	the password will not echo.</p><pre class="screen">Shell or PPP:<strong class="userinput"><code>ppp</code></strong></pre><p>Depending on the <acronym class="acronym">ISP</acronym>, this prompt
	might not appear.  If it does, it is asking whether to use a
	shell on the provider or to start
	<code class="command">ppp</code>.  In this example,
	<code class="command">ppp</code> was selected in order to establish an
	Internet connection.</p><pre class="screen">Ppp ON example&gt;</pre><p>Notice that in this example the first <code class="option">p</code>
	has been capitalized.  This shows that we have successfully
	connected to the <acronym class="acronym">ISP</acronym>.</p><pre class="screen">PPp ON example&gt;</pre><p>We have successfully authenticated with our
	<acronym class="acronym">ISP</acronym> and are waiting for the assigned
	<acronym class="acronym">IP</acronym> address.</p><pre class="screen">PPP ON example&gt;</pre><p>We have made an agreement on an <acronym class="acronym">IP</acronym>
	address and successfully completed our connection.</p><pre class="screen">PPP ON example&gt;<strong class="userinput"><code>add default HISADDR</code></strong></pre><p>Here we add our default route, we need to do this before
	we can talk to the outside world as currently the only
	established connection is with the peer.  If this fails due to
	existing routes, put a bang character
	<code class="literal">!</code> in front of the <code class="option">add</code>.
	Alternatively, set this before making the actual
	connection and it will negotiate a new route
	accordingly.</p><p>If everything went good we should now have an active
	connection to the Internet, which could be thrown into the
	background using <span class="keycap"><strong>CTRL</strong></span>+<span class="keycap"><strong>z</strong></span> If <code class="command">PPP</code>
	returns to <code class="command">ppp</code> then the connection has bee
	lost.  This is good to know because it shows the connection
	status.  Capital P's represent a connection to the
	<acronym class="acronym">ISP</acronym> and lowercase p's show that the
	connection has been lost.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66716024"></a>27.3.3. Debugging</h3></div></div></div><p>If a connection cannot be established, turn hardware
	  flow <acronym class="acronym">CTS/RTS</acronym> to off using <code class="option">set
	    ctsrts off</code>.  This is mainly the case when
	  connected to some <span class="application">PPP</span>-capable
	  terminal servers, where <span class="application">PPP</span> hangs
	  when it tries to write data to the communication link, and
	  waits for a Clear To Send (<acronym class="acronym">CTS</acronym>) signal
	  which may never come.  When using this option, include
	  <code class="option">set accmap</code> as it may be required to defeat
	  hardware dependent on passing certain characters from end to
	  end, most of the time XON/XOFF.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> for
	  more information on this option and how it is used.</p><p>An older modem may need <code class="option">set parity
	    even</code>.  Parity is set at none be default, but is
	  used for error checking with a large increase in traffic,
	  on older modems.</p><p><span class="application">PPP</span> may not return to the
	  command mode, which is usually a negotiation error where the
	  <acronym class="acronym">ISP</acronym> is waiting for negotiating to begin.
	  At this point, using  <code class="command">~p</code> will force ppp
	  to start sending the configuration information.</p><p>If a login prompt never appears, <acronym class="acronym">PAP</acronym>
	  or <acronym class="acronym">CHAP</acronym> authentication is most likely
	  required.  To use <acronym class="acronym">PAP</acronym> or
	  <acronym class="acronym">CHAP</acronym>, add the following options to
	  <span class="application">PPP</span> before going into terminal
	  mode:</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set authname <em class="replaceable"><code>myusername</code></em></code></strong></pre><p>Where <em class="replaceable"><code>myusername</code></em> should be
	  replaced with the username that was assigned by the
	  <acronym class="acronym">ISP</acronym>.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set authkey <em class="replaceable"><code>mypassword</code></em></code></strong></pre><p>Where <em class="replaceable"><code>mypassword</code></em> should be
	  replaced with the password that was assigned by the
	  <acronym class="acronym">ISP</acronym>.</p><p>If a connection is established, but cannot seem to find
	  any domain name,  try to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> an
	  <acronym class="acronym">IP</acronym> address.  If there is 100 percent
	  (100%) packet loss, it is likely that a default route was
	  not assigned.  Double check that <code class="option">add default
	    HISADDR</code> was set during the connection.  If a
	  connection can be made to a remote <acronym class="acronym">IP</acronym>
	  address, it is possible that a resolver address has not been
	  added to <code class="filename">/etc/resolv.conf</code>.  This file
	  should look like:</p><pre class="programlisting">domain <em class="replaceable"><code>example.com</code></em>
nameserver <em class="replaceable"><code>x.x.x.x</code></em>
nameserver <em class="replaceable"><code>y.y.y.y</code></em></pre><p>Where <em class="replaceable"><code>x.x.x.x</code></em> and
	  <em class="replaceable"><code>y.y.y.y</code></em> should be replaced with
	  the <acronym class="acronym">IP</acronym> address of the
	  <acronym class="acronym">ISP</acronym>'s DNS servers.</p><p>To configure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> to provide logging for the
	  <span class="application">PPP</span> connection, make sure this
	  line exists in <code class="filename">/etc/syslog.conf</code>:</p><pre class="programlisting">!ppp
*.*     /var/log/ppp.log</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pppoe"></a>27.4. Using <acronym class="acronym">PPP</acronym> over Ethernet (PPPoE)</h2></div></div></div><a id="idp66747000" class="indexterm"></a><p>This section describes how to set up <acronym class="acronym">PPP</acronym>
      over Ethernet (<acronym class="acronym">PPPoE</acronym>).</p><p>Here is an example of a working
      <code class="filename">ppp.conf</code>:</p><pre class="programlisting">default:
  set log Phase tun command # you can add more detailed logging if you wish
  set ifaddr 10.0.0.1/0 10.0.0.2/0

name_of_service_provider:
  set device PPPoE:<em class="replaceable"><code>xl1</code></em> # replace xl1 with your Ethernet device
  set authname YOURLOGINNAME
  set authkey YOURPASSWORD
  set dial
  set login
  add default HISADDR</pre><p>As <code class="systemitem">root</code>,
	run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ppp -ddial name_of_service_provider</code></strong></pre><p>Add the following to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ppp_enable="YES"
ppp_mode="ddial"
ppp_nat="YES"	# if you want to enable nat for your local network, otherwise NO
ppp_profile="name_of_service_provider"</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66782584"></a>27.4.1. Using a PPPoE Service Tag</h3></div></div></div><p>Sometimes it will be necessary to use a service tag to
	establish the connection.  Service tags are used to
	distinguish between different PPPoE servers attached to a
	given network.</p><p>Any required service tag information should be in the
	documentation provided by the <acronym class="acronym">ISP</acronym>.</p><p>As a last resort, one could try installing the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/rr-pppoe/pkg-descr">net/rr-pppoe</a> package or port.  Bear in mind
	however, this may de-program your modem and render it useless,
	so think twice before doing it.  Simply install the program
	shipped with the modem.  Then, access the
	<span class="guimenu">System</span> menu from the program.  The name of
	the profile should be listed there.  It is usually
	<span class="emphasis"><em>ISP</em></span>.</p><p>The profile name (service tag) will be used in the PPPoE
	configuration entry in <code class="filename">ppp.conf</code> as the
	provider part for <code class="command">set device</code>.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> for full details.  It should look like
	this:</p><pre class="programlisting">set device PPPoE:<em class="replaceable"><code>xl1</code></em>:<em class="replaceable"><code>ISP</code></em></pre><p>Do not forget to change <em class="replaceable"><code>xl1</code></em> to
	the proper device for the Ethernet card.</p><p>Do not forget to change <em class="replaceable"><code>ISP</code></em> to
	the profile.</p><p>For additional information, refer to <a class="link" href="http://renaud.waldura.com/doc/freebsd/pppoe/" target="_top">Cheaper
	  Broadband with FreeBSD on DSL</a> by Renaud Waldura.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ppp-3com"></a>27.4.2. PPPoE with a <span class="trademark">3Com</span>®
	<span class="trademark">HomeConnect</span>® ADSL
	Modem Dual Link</h3></div></div></div><p>This modem does not follow the PPPoE specification defined
	in <a class="link" href="http://www.faqs.org/rfcs/rfc2516.html" target="_top">RFC
	  2516</a>.</p><p>In order to make FreeBSD capable of communicating with this
	device, a sysctl must be set.  This can be done automatically
	at boot time by updating
	<code class="filename">/etc/sysctl.conf</code>:</p><pre class="programlisting">net.graph.nonstandard_pppoe=1</pre><p>or can be done immediately with the command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl net.graph.nonstandard_pppoe=1</code></strong></pre><p>Unfortunately, because this is a system-wide setting, it
	is not possible to talk to a normal PPPoE client or server and
	a <span class="trademark">3Com</span>® <span class="trademark">HomeConnect</span>® ADSL Modem at the
	same time.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pppoa"></a>27.5. Using <span class="application">PPP</span> over
      <acronym class="acronym">ATM</acronym> (PPPoA)</h2></div></div></div><a id="idp66803960" class="indexterm"></a><a id="idp66805496" class="indexterm"></a><p>The following describes how to set up PPP over
      <acronym class="acronym">ATM</acronym> (PPPoA).  PPPoA is a popular choice among
      European DSL providers.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66807288"></a>27.5.1. Using mpd</h3></div></div></div><p>The <span class="application">mpd</span> application can be used
	to connect to a variety of services, in particular PPTP
	services.  It can be installed using the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/mpd5/pkg-descr">net/mpd5</a> package or port.  Many ADSL modems
	require that a PPTP tunnel is created between the modem and
	computer.</p><p>Once installed, configure <span class="application">mpd</span>
	to suit the provider's settings.  The port places a set of
	sample configuration files which are well documented in
	<code class="filename">/usr/local/etc/mpd/</code>.  A complete guide to
	configure <span class="application">mpd</span> is available in HTML
	format in <code class="filename">/usr/ports/share/doc/mpd/</code>.
	Here is a sample configuration for connecting to an ADSL
	service with <span class="application">mpd</span>.  The
	configuration is spread over two files, first the
	<code class="filename">mpd.conf</code>:</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">This example <code class="filename">mpd.conf</code> only works
	  with <span class="application">mpd</span> 4.x.</p></div><pre class="programlisting">default:
    load adsl

adsl:
    new -i ng0 adsl adsl
    set bundle authname <em class="replaceable"><code>username</code></em> <a id="co-mpd-ex-user"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
    set bundle password <em class="replaceable"><code>password</code></em> <a id="co-mpd-ex-pass"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
    set bundle disable multilink

    set link no pap acfcomp protocomp
    set link disable chap
    set link accept chap
    set link keep-alive 30 10

    set ipcp no vjcomp
    set ipcp ranges 0.0.0.0/0 0.0.0.0/0

    set iface route default
    set iface disable on-demand
    set iface enable proxy-arp
    set iface idle 0

    open</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-mpd-ex-user"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The username used to authenticate with your
	  <acronym class="acronym">ISP</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-mpd-ex-pass"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The password used to authenticate with your
	  <acronym class="acronym">ISP</acronym>.</p></td></tr></table></div><p>Information about the link, or links, to establish is found
      in <code class="filename">mpd.links</code>.  An example
      <code class="filename">mpd.links</code> to accompany the above example
      is given beneath:</p><pre class="programlisting">adsl:
    set link type pptp
    set pptp mode active
    set pptp enable originate outcall
    set pptp self <em class="replaceable"><code>10.0.0.1</code></em> <a id="co-mpd-ex-self"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
    set pptp peer <em class="replaceable"><code>10.0.0.138</code></em> <a id="co-mpd-ex-peer"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-mpd-ex-self"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <acronym class="acronym">IP</acronym> address of FreeBSD computer
	  running <span class="application">mpd</span>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-mpd-ex-peer"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <acronym class="acronym">IP</acronym> address of the ADSL modem.
	  The Alcatel <span class="trademark">SpeedTouch</span>&#8482; Home defaults to <code class="systemitem">10.0.0.138</code>.</p></td></tr></table></div><p>It is possible to initialize the connection easily by
      issuing the following command as
      <code class="systemitem">root</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mpd -b <em class="replaceable"><code>adsl</code></em></code></strong></pre><p>To view the status of the connection:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>ng0</code></em></code></strong>
ng0: flags=88d1&lt;UP,POINTOPOINT,RUNNING,NOARP,SIMPLEX,MULTICAST&gt; mtu 1500
     inet 216.136.204.117 --&gt; 204.152.186.171 netmask 0xffffffff</pre><p>Using <span class="application">mpd</span> is the recommended
      way to connect to an ADSL service with FreeBSD.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66879352"></a>27.5.2. Using pptpclient</h3></div></div></div><p>It is also possible to use FreeBSD to connect to other
      PPPoA services using <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/pptpclient/pkg-descr">net/pptpclient</a>.</p><p>To use <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/pptpclient/pkg-descr">net/pptpclient</a>
      to connect to a DSL service, install the port or package, then
      edit <code class="filename">/etc/ppp/ppp.conf</code>.  An example section
      of <code class="filename">ppp.conf</code> is given below.  For further
      information on <code class="filename">ppp.conf</code> options consult
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>.</p><pre class="programlisting">adsl:
 set log phase chat lcp ipcp ccp tun command
 set timeout 0
 enable dns
 set authname <em class="replaceable"><code>username</code></em> <a id="co-pptp-ex-user"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
 set authkey <em class="replaceable"><code>password</code></em> <a id="co-pptp-ex-pass"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
 set ifaddr 0 0
 add default HISADDR</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-pptp-ex-user"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The username for the DSL provider.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-pptp-ex-pass"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The password for your account.</p></td></tr></table></div><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Since the account's password is added to
	<code class="filename">ppp.conf</code>in plain text form, make sure
	nobody can read the contents of this file:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chown root:wheel /etc/ppp/ppp.conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 600 /etc/ppp/ppp.conf</code></strong></pre></div><p>This will open a tunnel for a <acronym class="acronym">PPP</acronym>
	session to the DSL router.  Ethernet DSL modems have a
	preconfigured LAN <acronym class="acronym">IP</acronym> address to connect to.
	In the case of the Alcatel <span class="trademark">SpeedTouch</span>&#8482; Home, this address is
	<code class="systemitem">10.0.0.138</code>.  The
	router's documentation should list the address the device
	uses.  To open the tunnel and start a <acronym class="acronym">PPP</acronym>
	session:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pptp <em class="replaceable"><code>address</code></em> <em class="replaceable"><code>adsl</code></em></code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">If an ampersand (<span class="quote">&#8220;<span class="quote">&amp;</span>&#8221;</span>) is added
	  to the end of this command,
	  <span class="application">pptp</span> will return the
	  prompt.</p></div><p>A <code class="filename">tun</code> virtual tunnel device
	will be created for interaction between the
	<span class="application">pptp</span> and
	<span class="application">ppp</span> processes.  Once the
	prompt is returned, or the
	<span class="application">pptp</span> process has confirmed a
	connection, examine the tunnel:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>tun0</code></em></code></strong>
tun0: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 1500
        inet 216.136.204.21 --&gt; 204.152.186.171 netmask 0xffffff00
	Opened by PID 918</pre><p>If the connection fails, check the configuration of
	the router, which is usually accessible using
	a web browser.  Also, examine the output of
	<code class="command">pptp</code> and the contents of the
	log file,
	<code class="filename">/var/log/ppp.log</code> for clues.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail"></a>Chapter 28. Electronic Mail</h2></div><div><span class="authorgroup">Original
	work by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Bill</span> <span class="surname">Lloyd</span></span>. </span></div><div><span class="authorgroup">Rewritten
	by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jim</span> <span class="surname">Mock</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#mail-synopsis">28.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#mail-using">28.2. Mail Components</a></span></dt><dt><span class="sect1"><a href="#sendmail">28.3. <span class="application">Sendmail</span> Configuration
	Files</a></span></dt><dt><span class="sect1"><a href="#mail-changingmta">28.4. Changing the Mail Transfer Agent</a></span></dt><dt><span class="sect1"><a href="#mail-trouble">28.5. Troubleshooting</a></span></dt><dt><span class="sect1"><a href="#mail-advanced">28.6. Advanced Topics</a></span></dt><dt><span class="sect1"><a href="#outgoing-only">28.7. Setting Up to Send Only</a></span></dt><dt><span class="sect1"><a href="#SMTP-dialup">28.8. Using Mail with a Dialup Connection</a></span></dt><dt><span class="sect1"><a href="#SMTP-Auth">28.9. SMTP Authentication</a></span></dt><dt><span class="sect1"><a href="#mail-agents">28.10. Mail User Agents</a></span></dt><dt><span class="sect1"><a href="#mail-fetchmail">28.11. Using <span class="application">fetchmail</span></a></span></dt><dt><span class="sect1"><a href="#mail-procmail">28.12. Using <span class="application">procmail</span></a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-synopsis"></a>28.1. Synopsis</h2></div></div></div><a id="idp66905976" class="indexterm"></a><p><span class="quote">&#8220;<span class="quote">Electronic Mail</span>&#8221;</span>, better known as email, is
      one of the most widely used forms of communication today.  This
      chapter provides a basic introduction to running a mail server
      on FreeBSD, as well as an introduction to sending and receiving
      email using FreeBSD.  For more complete coverage of this subject,
      refer to the books listed in <a class="xref" href="#bibliography" title="Appendix B. Bibliography">Appendix B, <em>Bibliography</em></a>.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Which software components are involved in sending and
	  receiving electronic mail.</p></li><li class="listitem"><p>Where basic <span class="application">Sendmail</span>
	  configuration files are located in FreeBSD.</p></li><li class="listitem"><p>The difference between remote and local
	  mailboxes.</p></li><li class="listitem"><p>How to block spammers from illegally using a mail server
	  as a relay.</p></li><li class="listitem"><p>How to install and configure an alternate Mail Transfer
	  Agent, replacing
	  <span class="application">Sendmail</span>.</p></li><li class="listitem"><p>How to troubleshoot common mail server problems.</p></li><li class="listitem"><p>How to set up the system to send mail only.</p></li><li class="listitem"><p>How to use mail with a dialup connection.</p></li><li class="listitem"><p>How to configure SMTP authentication for added
	  security.</p></li><li class="listitem"><p>How to install and use a Mail User Agent, such as
	  <span class="application">mutt</span>, to send and receive
	  email.</p></li><li class="listitem"><p>How to download mail from a remote
	  <acronym class="acronym">POP</acronym> or <acronym class="acronym">IMAP</acronym>
	  server.</p></li><li class="listitem"><p>How to automatically apply filters and rules to incoming
	  email.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Properly set up a network connection (<a class="xref" href="#advanced-networking" title="Chapter 31. Advanced Networking">Chapter 31, <em>Advanced Networking</em></a>).</p></li><li class="listitem"><p>Properly set up the <acronym class="acronym">DNS</acronym> information
	  for a mail host (<a class="xref" href="#network-servers" title="Chapter 29. Network Servers">Chapter 29, <em>Network Servers</em></a>).</p></li><li class="listitem"><p>Know how to install additional third-party software
	  (<a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a>).</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-using"></a>28.2. Mail Components</h2></div></div></div><a id="idp66945400" class="indexterm"></a><a id="idp66945912" class="indexterm"></a><a id="idp66946424" class="indexterm"></a><a id="idp66946936" class="indexterm"></a><a id="idp66497656" class="indexterm"></a><a id="idp66498936" class="indexterm"></a><a id="idp66500216" class="indexterm"></a><a id="idp66505592" class="indexterm"></a><a id="idp66506744" class="indexterm"></a><a id="idp66507256" class="indexterm"></a><p>There are five major parts involved in an email exchange:
      the Mail User Agent (<acronym class="acronym">MUA</acronym>), the Mail Transfer
      Agent (<acronym class="acronym">MTA</acronym>), a mail host, a remote or local
      mailbox, and <acronym class="acronym">DNS</acronym>.  This section provides an
      overview of these components.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Mail User Agent (<acronym class="acronym">MUA</acronym>)</span></dt><dd><p>The Mail User Agent (<acronym class="acronym">MUA</acronym>) is an
	    application which is used to compose, send, and receive
	    emails.  This application can be a command line program,
	    such as the built-in <code class="command">mail</code> utility or a
	    third-party application from the Ports Collection, such as
	    <span class="application">mutt</span>,
	    <span class="application">alpine</span>, or
	    <span class="application">elm</span>.  Dozens of graphical
	    programs are also available in the Ports Collection,
	    including <span class="application">Claws Mail</span>,
	    <span class="application">Evolution</span>, and
	    <span class="application">Thunderbird</span>.  Some
	    organizations provide a web mail program which can be
	    accessed through a web browser.  More information about
	    installing and using a <acronym class="acronym">MUA</acronym> on FreeBSD can
	    be found in <a class="xref" href="#mail-agents" title="28.10. Mail User Agents">Section 28.10, &#8220;Mail User Agents&#8221;</a>.</p></dd><dt><span class="term">Mail Transfer Agent (<acronym class="acronym">MTA</acronym>)</span></dt><dd><p>The Mail Transfer Agent (<acronym class="acronym">MTA</acronym>) is
	    responsible for receiving incoming mail and delivering
	    outgoing mail.  FreeBSD ships with
	    <span class="application">Sendmail</span> as the default
	    <acronym class="acronym">MTA</acronym>, but it also supports numerous
	    other mail server daemons, including
	    <span class="application">Exim</span>,
	    <span class="application">Postfix</span>, and
	    <span class="application">qmail</span>.
	    <span class="application">Sendmail</span> configuration is
	    described in <a class="xref" href="#sendmail" title="28.3. Sendmail Configuration Files">Section 28.3, &#8220;<span class="application">Sendmail</span> Configuration
	Files&#8221;</a>.  If another
	    <acronym class="acronym">MTA</acronym> is installed using the Ports
	    Collection, refer to its post-installation message for
	    FreeBSD-specific configuration details and the application's
	    website for more general configuration
	    instructions.</p></dd><dt><span class="term">Mail Host and Mailboxes</span></dt><dd><p>The mail host is a server that is responsible for
	    delivering and receiving mail for a host or a network.
	    The mail host collects all mail sent to the domain and
	    stores it either in the default <code class="filename">mbox</code>
	    or the alternative Maildir format, depending on the
	    configuration.  Once mail has been stored, it may either
	    be read locally using a <acronym class="acronym">MUA</acronym> or remotely
	    accessed and collected using protocols such as
	    <acronym class="acronym">POP</acronym> or <acronym class="acronym">IMAP</acronym>.  If
	    mail is read locally, a <acronym class="acronym">POP</acronym> or
	    <acronym class="acronym">IMAP</acronym> server does not need to be
	    installed.</p><p>To access mailboxes remotely, a <acronym class="acronym">POP</acronym>
	    or <acronym class="acronym">IMAP</acronym> server is required as these
	    protocols allow users to connect to their mailboxes from
	    remote locations.  <acronym class="acronym">IMAP</acronym> offers several
	    advantages over <acronym class="acronym">POP</acronym>.  These include the
	    ability to store a copy of messages on a remote server
	    after they are downloaded and concurrent updates.
	    <acronym class="acronym">IMAP</acronym> can be useful over low-speed links
	    as it allows users to fetch the structure of messages
	    without downloading them.  It can also perform tasks such
	    as searching on the server in order to minimize data
	    transfer between clients and servers.</p><p>Several <acronym class="acronym">POP</acronym> and
	    <acronym class="acronym">IMAP</acronym> servers are available in the Ports
	    Collection.  These include
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/qpopper/pkg-descr">mail/qpopper</a>,
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/imap-uw/pkg-descr">mail/imap-uw</a>,
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/courier-imap/pkg-descr">mail/courier-imap</a>, and
	    <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/dovecot2/pkg-descr">mail/dovecot2</a>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">It should be noted that both <acronym class="acronym">POP</acronym>
	      and <acronym class="acronym">IMAP</acronym> transmit information,
	      including username and password credentials, in
	      clear-text.  To secure the transmission of information
	      across these protocols, consider tunneling sessions over
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> (<a class="xref" href="#security-ssh-tunneling" title="13.8.1.2. SSH Tunneling">Section 13.8.1.2, &#8220;<acronym class="acronym">SSH</acronym> Tunneling&#8221;</a>)
	      or using <acronym class="acronym">SSL</acronym> (<a class="xref" href="#openssl" title="13.6. OpenSSL">Section 13.6, &#8220;OpenSSL&#8221;</a>).</p></div></dd><dt><span class="term">Domain Name System (<acronym class="acronym">DNS</acronym>)</span></dt><dd><p>The Domain Name System (<acronym class="acronym">DNS</acronym>) and
	    its daemon <code class="command">named</code> play a large role in
	    the delivery of email.  In order to deliver mail from one
	    site to another, the <acronym class="acronym">MTA</acronym> will look up
	    the remote site in <acronym class="acronym">DNS</acronym> to determine
	    which host will receive mail for the destination.  This
	    process also occurs when mail is sent from a remote host
	    to the <acronym class="acronym">MTA</acronym>.</p><p>In addition to mapping hostnames to
	    <acronym class="acronym">IP</acronym> addresses, <acronym class="acronym">DNS</acronym> is
	    responsible for storing information specific to mail
	    delivery, known as Mail eXchanger
	    <acronym class="acronym">MX</acronym> records.  The <acronym class="acronym">MX</acronym>
	    record specifies which hosts will receive mail for a
	    particular domain.</p><p>To view the <acronym class="acronym">MX</acronym> records for a
	    domain, specify the type of record.   Refer to
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=host&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">host</span>(1)</span></a>, for more details about this command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>host -t mx FreeBSD.org</code></strong>
FreeBSD.org mail is handled by 10 mx1.FreeBSD.org</pre><p>Refer to <a class="xref" href="#network-dns" title="29.7. Domain Name System (DNS)">Section 29.7, &#8220;Domain Name System (<acronym class="acronym">DNS</acronym>)&#8221;</a> for more
	    information about <acronym class="acronym">DNS</acronym> and its
	    configuration.</p></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sendmail"></a>28.3. <span class="application">Sendmail</span> Configuration
	Files</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Christopher</span> <span class="surname">Shumway</span></span>. </span></div></div></div><a id="idp66988920" class="indexterm"></a><p><span class="application">Sendmail</span> is the default
      <acronym class="acronym">MTA</acronym> installed with FreeBSD.  It accepts mail
      from <acronym class="acronym">MUA</acronym>s and delivers it to the appropriate
      mail host, as defined by its configuration.
      <span class="application">Sendmail</span> can also accept network
      connections and deliver mail to local mailboxes or to another
      program.</p><p>The configuration files for
      <span class="application">Sendmail</span> are located in
      <code class="filename">/etc/mail</code>.  This section describes these
      files in more detail.</p><a id="idp66992760" class="indexterm"></a><a id="idp66993656" class="indexterm"></a><a id="idp66994552" class="indexterm"></a><a id="idp66995448" class="indexterm"></a><a id="idp66996344" class="indexterm"></a><a id="idp66997240" class="indexterm"></a><a id="idp66998136" class="indexterm"></a><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">/etc/mail/access</code></span></dt><dd><p>This access database file defines which hosts or
	    <acronym class="acronym">IP</acronym> addresses have access to the local
	    mail server and what kind of access they have.  Hosts
	    listed as <code class="option">OK</code>, which is the default
	    option, are allowed to send mail to this host as long as
	    the mail's final destination is the local machine.  Hosts
	    listed as <code class="option">REJECT</code> are rejected for all
	    mail connections.  Hosts listed as <code class="option">RELAY</code>
	    are allowed to send mail for any destination using this
	    mail server.  Hosts listed as <code class="option">ERROR</code> will
	    have their mail returned with the specified mail error.
	    If a host is listed as <code class="option">SKIP</code>,
	    <span class="application">Sendmail</span> will abort the current
	    search for this entry without accepting or rejecting the
	    mail.  Hosts listed as <code class="option">QUARANTINE</code> will
	    have their messages held and will receive the specified
	    text as the reason for the hold.</p><p>Examples of using these options for both
	    <acronym class="acronym">IPv4</acronym> and <acronym class="acronym">IPv6</acronym>
	    addresses can be found in the FreeBSD sample configuration,
	    <code class="filename">/etc/mail/access.sample</code>:</p><pre class="programlisting"># <span translate="no" class="phrase">$FreeBSD$</span>
#
# Mail relay access control list.  Default is to reject mail unless the
# destination is local, or listed in /etc/mail/local-host-names
#
## Examples (commented out for safety)
#From:cyberspammer.com          ERROR:"550 We don't accept mail from spammers"
#From:okay.cyberspammer.com     OK
#Connect:sendmail.org           RELAY
#To:sendmail.org                RELAY
#Connect:128.32                 RELAY
#Connect:128.32.2               SKIP
#Connect:IPv6:1:2:3:4:5:6:7     RELAY
#Connect:suspicious.example.com QUARANTINE:Mail from suspicious host
#Connect:[127.0.0.3]            OK
#Connect:[IPv6:1:2:3:4:5:6:7:8] OK</pre><p>To configure the access database, use the format shown
	    in the sample to make entries in
	    <code class="filename">/etc/mail/access</code>, but do not put a
	    comment symbol (<code class="literal">#</code>) in front of the
	    entries.  Create an entry for each host or network whose
	    access should be configured.  Mail senders that match the
	    left side of the table are affected by the action on the
	    right side of the table.</p><p>Whenever this file is updated, update its database and
	    restart <span class="application">Sendmail</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>makemap hash /etc/mail/access &lt; /etc/mail/access</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service sendmail restart</code></strong></pre></dd><dt><span class="term"><code class="filename">/etc/mail/aliases</code></span></dt><dd><p>This database file contains a list of virtual
	    mailboxes that are expanded to users, files, programs, or
	    other aliases.  Here are a few entries to illustrate the
	    file format:</p><pre class="programlisting">root: localuser
ftp-bugs: joe,eric,paul
bit.bucket:  /dev/null
procmail: "|/usr/local/bin/procmail"</pre><p>The mailbox name on the left side of the colon is
	    expanded to the target(s) on the right.  The first entry
	    expands the <code class="systemitem">root</code>
	    mailbox  to the <code class="systemitem">localuser</code> mailbox, which
	    is then looked up in the
	    <code class="filename">/etc/mail/aliases</code> database.  If no
	    match is found, the message is delivered to <code class="systemitem">localuser</code>.  The second
	    entry shows a mail list.  Mail to <code class="systemitem">ftp-bugs</code> is expanded to
	    the three local mailboxes <code class="systemitem">joe</code>, <code class="systemitem">eric</code>, and <code class="systemitem">paul</code>.  A remote mailbox
	    could be specified as
	    <em class="replaceable"><code>user@example.com</code></em>.  The third
	    entry shows how to write mail to a file, in this case
	    <code class="filename">/dev/null</code>.  The last entry
	    demonstrates how to send mail to a program,
	    <code class="filename">/usr/local/bin/procmail</code>, through a
	    <span class="trademark">UNIX</span>® pipe.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=aliases&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">aliases</span>(5)</span></a> for more
	    information about the format of this file.</p><p>Whenever this file is updated, run
	    <code class="command">newaliases</code> to update and initialize the
	    aliases database.</p></dd><dt><span class="term"><code class="filename">/etc/mail/sendmail.cf</code></span></dt><dd><p>This is the master configuration file for
	    <span class="application">Sendmail</span>.  It controls the
	    overall behavior of <span class="application">Sendmail</span>,
	    including everything from rewriting email addresses to
	    printing rejection messages to remote mail servers.
	    Accordingly, this configuration file is quite complex.
	    Fortunately, this file rarely needs to be changed for
	    standard mail servers.</p><p>The master <span class="application">Sendmail</span>
	    configuration file can be built from <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=m4&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">m4</span>(1)</span></a> macros
	    that define the features and behavior of
	    <span class="application">Sendmail</span>.  Refer to
	    <code class="filename">/usr/src/contrib/sendmail/cf/README</code>
	    for some of the details.</p><p>Whenever changes to this file are made,
	    <span class="application">Sendmail</span> needs to be restarted
	    for the changes to take effect.</p></dd><dt><span class="term"><code class="filename">/etc/mail/virtusertable</code></span></dt><dd><p>This database file maps mail addresses for virtual
	    domains and users to real mailboxes.  These mailboxes can
	    be local, remote, aliases defined in
	    <code class="filename">/etc/mail/aliases</code>, or files.  This
	    allows multiple virtual domains to be hosted on one
	    machine.</p><p>FreeBSD provides a sample configuration file in
	    <code class="filename">/etc/mail/virtusertable.sample</code> to
	    further demonstrate its format.  The following example
	    demonstrates how to create custom entries using that
	    format:</p><pre class="programlisting">root@example.com                root
postmaster@example.com          postmaster@noc.example.net
@example.com                    joe</pre><p>This file is processed in a first match order.   When
	    an email address matches the address on the left, it is
	    mapped to the local mailbox listed on the right.  The
	    format of the first entry in this example maps a specific
	    email address to a local mailbox, whereas the format of
	    the second entry maps a specific email address to a remote
	    mailbox.  Finally, any email address from
	    <code class="literal">example.com</code> which has not matched any
	    of the previous entries will match the last mapping and be
	    sent to the local mailbox <code class="literal">joe</code>.  When
	    creating custom entries, use this format and add them to
	    <code class="filename">/etc/mail/virtusertable</code>.  Whenever
	    this file is edited, update its database and restart
	    <span class="application">Sendmail</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>makemap hash /etc/mail/virtusertable &lt; /etc/mail/virtusertable</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service sendmail restart</code></strong></pre></dd><dt><span class="term"><code class="filename">/etc/mail/relay-domains</code></span></dt><dd><p>In a default FreeBSD installation,
	    <span class="application">Sendmail</span> is configured to only
	    send mail from the host it is running on.  For example, if
	    a <acronym class="acronym">POP</acronym> server is available, users will
	    be able to check mail from remote locations but they will
	    not be able to send outgoing emails from outside
	    locations.  Typically, a few moments after the attempt, an
	    email will be sent from <code class="literal">MAILER-DAEMON</code>
	    with a <span class="errorname">5.7 Relaying Denied</span>
	    message.</p><p>The most straightforward solution is to add the
	    <acronym class="acronym">ISP</acronym>'s <acronym class="acronym">FQDN</acronym> to
	    <code class="filename">/etc/mail/relay-domains</code>.  If multiple
	    addresses are needed, add them one per
	    line:</p><pre class="programlisting">your.isp.example.com
other.isp.example.net
users-isp.example.org
www.example.org</pre><p>After creating or editing this file, restart
	    <span class="application">Sendmail</span> with
	    <code class="command">service sendmail restart</code>.</p><p>Now any mail sent through the system by any host in
	    this list, provided the user has an account on the system,
	    will succeed.  This allows users to send mail from the
	    system remotely without opening the system up to relaying
	    <acronym class="acronym">SPAM</acronym> from the Internet.</p></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-changingmta"></a>28.4. Changing the Mail Transfer Agent</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Andrew</span> <span class="surname">Boothman</span></span>. </span></div><div><span class="authorgroup">Information taken from emails written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Gregory</span> <span class="surname">Neil Shapiro</span></span>. </span></div></div></div><a id="idp67074168" class="indexterm"></a><p>FreeBSD comes with <span class="application">Sendmail</span> already
      installed as the <acronym class="acronym">MTA</acronym> which is in charge of
      outgoing and incoming mail.  However, the system administrator
      can change the system's <acronym class="acronym">MTA</acronym>.  A wide choice
      of alternative <acronym class="acronym">MTA</acronym>s is available from the
      <code class="literal">mail</code> category of the FreeBSD Ports
      Collection.</p><p>Once a new <acronym class="acronym">MTA</acronym> is installed, configure
      and test the new software before replacing
      <span class="application">Sendmail</span>.  Refer to the documentation
      of the new <acronym class="acronym">MTA</acronym> for information on how to
      configure the software.</p><p>Once the new <acronym class="acronym">MTA</acronym> is working, use the
      instructions in this section to disable
      <span class="application">Sendmail</span> and configure FreeBSD to use
      the replacement <acronym class="acronym">MTA</acronym>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail-disable-sendmail"></a>28.4.1. Disable <span class="application">Sendmail</span></h3></div></div></div><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">If <span class="application">Sendmail</span>'s outgoing mail
	  service is disabled, it is important that it is replaced
	  with an alternative mail delivery system.  Otherwise, system
	  functions such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a> will be unable to deliver
	  their results by email.  Many parts of the system expect a
	  functional <acronym class="acronym">MTA</acronym>.  If applications continue
	  to use <span class="application">Sendmail</span>'s binaries to try
	  to send email after they are disabled, mail could go into an
	  inactive <span class="application">Sendmail</span> queue and
	  never be delivered.</p></div><p>In order to completely disable
	<span class="application">Sendmail</span>, add or edit the following
	lines in <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">sendmail_enable="NO"
sendmail_submit_enable="NO"
sendmail_outbound_enable="NO"
sendmail_msp_queue_enable="NO"</pre><p>To only disable <span class="application">Sendmail</span>'s
	incoming mail service, use only this entry in
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">sendmail_enable="NO"</pre><p>More information on <span class="application">Sendmail</span>'s
	startup options is available in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.sendmail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.sendmail</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67101944"></a>28.4.2. Replace the Default <acronym class="acronym">MTA</acronym></h3></div></div></div><p>When a new <acronym class="acronym">MTA</acronym> is installed using the
	Ports Collection, its startup script is also installed and
	startup instructions are mentioned in its package message.
	Before starting the new <acronym class="acronym">MTA</acronym>, stop the
	running <span class="application">Sendmail</span> processes.  This
	example stops all of these services, then starts the
	<span class="application">Postfix</span> service:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sendmail stop</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service postfix start</code></strong></pre><p>To start the replacement <acronym class="acronym">MTA</acronym> at system
	boot, add its configuration line to
	<code class="filename">/etc/rc.conf</code>.  This entry enables the
	Postfix <acronym class="acronym">MTA</acronym>:</p><pre class="programlisting">postfix_enable="YES"</pre><p>Some extra configuration is needed as
	<span class="application">Sendmail</span> is so ubiquitous that some
	software assumes it is already installed and configured.
	Check <code class="filename">/etc/periodic.conf</code> and make sure
	that these values are set to <code class="literal">NO</code>.  If this
	file does not exist, create it with these entries:</p><pre class="programlisting">daily_clean_hoststat_enable="NO"
daily_status_mail_rejects_enable="NO"
daily_status_include_submit_mailq="NO"
daily_submit_queuerun="NO"</pre><p>Some alternative <acronym class="acronym">MTA</acronym>s provide their own
	compatible implementations of the
	<span class="application">Sendmail</span> command-line interface in
	order to facilitate using them as drop-in replacements for
	<span class="application">Sendmail</span>.  However, some
	<acronym class="acronym">MUA</acronym>s may try to execute standard
	<span class="application">Sendmail</span> binaries instead of the
	new <acronym class="acronym">MTA</acronym>'s binaries.  FreeBSD uses
	<code class="filename">/etc/mail/mailer.conf</code> to map the expected
	<span class="application">Sendmail</span> binaries to the location
	of the new binaries.  More information about this mapping can
	be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mailwrapper&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mailwrapper</span>(8)</span></a>.</p><p>The default <code class="filename">/etc/mail/mailer.conf</code>
	looks like this:</p><pre class="programlisting"># <span translate="no" class="phrase">$FreeBSD$</span>
#
# Execute the "real" sendmail program, named /usr/libexec/sendmail/sendmail
#
sendmail        /usr/libexec/sendmail/sendmail
send-mail       /usr/libexec/sendmail/sendmail
mailq           /usr/libexec/sendmail/sendmail
newaliases      /usr/libexec/sendmail/sendmail
hoststat        /usr/libexec/sendmail/sendmail
purgestat       /usr/libexec/sendmail/sendmail</pre><p>When any of the commands listed on the left are run, the
	system actually executes the associated command shown on the
	right.  This system makes it easy to change what binaries are
	executed when these default binaries are invoked.</p><p>Some <acronym class="acronym">MTA</acronym>s, when installed using the
	Ports Collection, will prompt to update this file for the new
	binaries.  For example, <span class="application">Postfix</span>
	will update the file like this:</p><pre class="programlisting">#
# Execute the Postfix sendmail program, named /usr/local/sbin/sendmail
#
sendmail        /usr/local/sbin/sendmail
send-mail       /usr/local/sbin/sendmail
mailq           /usr/local/sbin/sendmail
newaliases      /usr/local/sbin/sendmail</pre><p>If the installation of the <acronym class="acronym">MTA</acronym> does
	not automatically update
	<code class="filename">/etc/mail/mailer.conf</code>, edit this file in
	a text editor so that it points to the new binaries.  This
	example points to the binaries installed by
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/ssmtp/pkg-descr">mail/ssmtp</a>:</p><pre class="programlisting">sendmail        /usr/local/sbin/ssmtp
send-mail       /usr/local/sbin/ssmtp
mailq           /usr/local/sbin/ssmtp
newaliases      /usr/local/sbin/ssmtp
hoststat        /usr/bin/true
purgestat       /usr/bin/true</pre><p>Once everything is configured, it is recommended to reboot
	the system.  Rebooting provides the opportunity to ensure that
	the system is correctly configured to start the new
	<acronym class="acronym">MTA</acronym> automatically on boot.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-trouble"></a>28.5. Troubleshooting</h2></div></div></div><a id="idp66810744" class="indexterm"></a><div class="qandaset"><a id="idp66811896"></a><dl><dt>28.5.1. <a href="#idp66812152">Why do I have to use the FQDN for hosts on my
	    site?</a></dt><dt>28.5.2. <a href="#idp67138808">How can I run a mail server on a dial-up PPP
	    host?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp66812152"></a><a id="idp66812408"></a><p><strong>28.5.1.</strong></p></td><td align="left" valign="top"><p>Why do I have to use the FQDN for hosts on my
	    site?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>The host may actually be in a different domain.  For
	    example, in order for a host in <code class="systemitem">foo.bar.edu</code> to reach a
	    host called <code class="systemitem">mumble</code> in the
	    <code class="systemitem">bar.edu</code>
	    domain, refer to it by the Fully-Qualified Domain Name
	    <acronym class="acronym">FQDN</acronym>, <code class="systemitem">mumble.bar.edu</code>,
	    instead of just <code class="systemitem">mumble</code>.</p><p>This is because the version of
	    <span class="application">BIND</span><a id="idp67132408" class="indexterm"></a> which ships with FreeBSD
	    no longer provides default abbreviations for non-FQDNs
	    other than the local domain.  An unqualified host such as
	    <code class="systemitem">mumble</code> must either be found as
	    <code class="systemitem">mumble.foo.bar.edu</code>, or
	    it will be searched for in the root domain.</p><p>In older versions of <span class="application">BIND</span>,
	    the search continued across <code class="systemitem">mumble.bar.edu</code>, and
	    <code class="systemitem">mumble.edu</code>.
	    RFC 1535 details why this is considered bad practice or
	    even a security hole.</p><p>As a good workaround, place the line:</p><pre class="programlisting">search foo.bar.edu bar.edu</pre><p>instead of the previous:</p><pre class="programlisting">domain foo.bar.edu</pre><p>into <code class="filename">/etc/resolv.conf</code>.  However,
	    make sure that the search order does not go beyond the
	    <span class="quote">&#8220;<span class="quote">boundary between local and public
	      administration</span>&#8221;</span>, as RFC 1535 calls it.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp67138808"></a><a id="idp67139064"></a><p><strong>28.5.2.</strong></p></td><td align="left" valign="top"><p>How can I run a mail server on a dial-up PPP
	    host?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Connect to a FreeBSD mail gateway on the LAN.  The PPP
	    connection is non-dedicated.</p><p>One way to do this is to get a full-time Internet
	    server to provide secondary
	    <acronym class="acronym">MX</acronym>
	    <a id="idp67145208" class="indexterm"></a>
	    services for the domain.  In this example, the domain is
	    <code class="systemitem">example.com</code>
	    and the ISP has configured
	    <code class="systemitem">example.net</code>
	    to provide secondary <acronym class="acronym">MX</acronym> services to the
	    domain:</p><pre class="programlisting">example.com.          MX        10      example.com.
                      MX        20      example.net.</pre><p>Only one host should be specified as the final
	    recipient.  For <span class="application">Sendmail</span>, add
	    <code class="literal">Cw example.com</code> in
	    <code class="filename">/etc/mail/sendmail.cf</code> on <code class="systemitem">example.com</code>.</p><p>When the sending <acronym class="acronym">MTA</acronym> attempts
	    to deliver mail, it will try to connect to the system,
	    <code class="systemitem">example.com</code>,
	    over the PPP link.  This will time out if the destination
	    is offline.  The <acronym class="acronym">MTA</acronym> will automatically
	    deliver it to the secondary <acronym class="acronym">MX</acronym> site at
	    the Internet Service Provider (<acronym class="acronym">ISP</acronym>),
	    <code class="systemitem">example.net</code>.
	    The secondary <acronym class="acronym">MX</acronym> site will periodically
	    try to connect to the primary <acronym class="acronym">MX</acronym> host,
	    <code class="systemitem">example.com</code>.</p><p>Use something like this as a login script:</p><pre class="programlisting">#!/bin/sh
# Put me in /usr/local/bin/pppmyisp
( sleep 60 ; /usr/sbin/sendmail -q ) &amp;
/usr/sbin/ppp -direct pppmyisp</pre><p>When creating a separate login script for users,
	    instead use <code class="command">sendmail -qRexample.com</code> in
	    the script above.  This will force all mail in the queue
	    for
	    <code class="systemitem">example.com</code>
	    to be processed immediately.</p><p>A further refinement of the situation can be seen from
	    this example from the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp" target="_top">FreeBSD Internet service provider's mailing list</a>:</p><pre class="programlisting">&gt; we provide the secondary MX for a customer. The customer connects to
&gt; our services several times a day automatically to get the mails to
&gt; his primary MX (We do not call his site when a mail for his domains
&gt; arrived). Our sendmail sends the mailqueue every 30 minutes. At the
&gt; moment he has to stay 30 minutes online to be sure that all mail is
&gt; gone to the primary MX.
&gt;
&gt; Is there a command that would initiate sendmail to send all the mails
&gt; now? The user has not root-privileges on our machine of course.

In the <span class="quote">&#8220;<span class="quote">privacy flags</span>&#8221;</span> section of sendmail.cf, there is a
definition Opgoaway,restrictqrun

Remove restrictqrun to allow non-root users to start the queue processing.
You might also like to rearrange the MXs. We are the 1st MX for our
customers like this, and we have defined:

# If we are the best MX for a host, try directly instead of generating
# local config error.
OwTrue

That way a remote site will deliver straight to you, without trying
the customer connection.  You then send to your customer.  Only works for
<span class="quote">&#8220;<span class="quote">hosts</span>&#8221;</span>, so you need to get your customer to name their mail
machine <span class="quote">&#8220;<span class="quote">customer.com</span>&#8221;</span> as well as
<span class="quote">&#8220;<span class="quote">hostname.customer.com</span>&#8221;</span> in the DNS.  Just put an A record in
the DNS for <span class="quote">&#8220;<span class="quote">customer.com</span>&#8221;</span>.</pre></td></tr></tbody></table></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-advanced"></a>28.6. Advanced Topics</h2></div></div></div><p>This section covers more involved topics such as mail
      configuration and setting up mail for an entire domain.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail-config"></a>28.6.1. Basic Configuration</h3></div></div></div><a id="idp67182200" class="indexterm"></a><p>Out of the box, one can send email to external hosts as
	long as <code class="filename">/etc/resolv.conf</code> is configured or
	the network has access to a configured <acronym class="acronym">DNS</acronym>
	server.  To have email delivered to the <acronym class="acronym">MTA</acronym>
	on the FreeBSD host, do one of the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Run a <acronym class="acronym">DNS</acronym> server for the
	    domain.</p></li><li class="listitem"><p>Get mail delivered directly to the
	    <acronym class="acronym">FQDN</acronym> for the machine.</p></li></ul></div><a id="idp67191672" class="indexterm"></a><p>In order to have mail delivered directly to a host, it
	must have a permanent static IP address, not a dynamic IP
	address.  If the system is behind a firewall, it must be
	configured to allow SMTP traffic.  To receive mail directly at
	a host, one of these two must be configured:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Make sure that the lowest-numbered
	    <acronym class="acronym">MX</acronym><a id="idp67193592" class="indexterm"></a> record in
	    <acronym class="acronym">DNS</acronym> points to the host's static IP
	    address.</p></li><li class="listitem"><p>Make sure there is no <acronym class="acronym">MX</acronym> entry in
	    the <acronym class="acronym">DNS</acronym> for the host.</p></li></ul></div><p>Either of the above will allow mail to be received
	directly at the host.</p><p>Try this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hostname</code></strong>
example.FreeBSD.org
<code class="prompt">#</code> <strong class="userinput"><code>host example.FreeBSD.org</code></strong>
example.FreeBSD.org has address 204.216.27.XX</pre><p>In this example, mail sent directly to
	<code class="email">&lt;yourlogin@example.FreeBSD.org&gt;</code>
	should work without problems, assuming
	<span class="application">Sendmail</span> is running correctly on
	<code class="systemitem">example.FreeBSD.org</code>.</p><p>For this example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>host example.FreeBSD.org</code></strong>
example.FreeBSD.org has address 204.216.27.XX
example.FreeBSD.org mail is handled (pri=10) by nevdull.FreeBSD.org</pre><p>All mail sent to <code class="systemitem">example.FreeBSD.org</code> will
	be collected on <code class="systemitem">hub</code> under the same
	username instead of being sent directly to your host.</p><p>The above information is handled by the
	<acronym class="acronym">DNS</acronym> server.  The <acronym class="acronym">DNS</acronym>
	record that carries mail routing information is the
	<acronym class="acronym">MX</acronym> entry.  If no <acronym class="acronym">MX</acronym>
	record exists, mail will be delivered directly to the host by
	way of its IP address.</p><p>The <acronym class="acronym">MX</acronym> entry for <code class="systemitem">freefall.FreeBSD.org</code> at
	one time looked like this:</p><pre class="programlisting">freefall		MX	30	mail.crl.net
freefall		MX	40	agora.rdrop.com
freefall		MX	10	freefall.FreeBSD.org
freefall		MX	20	who.cdrom.com</pre><p><code class="systemitem">freefall</code> had many
	<acronym class="acronym">MX</acronym> entries.  The lowest
	<acronym class="acronym">MX</acronym> number is the host that receives mail
	directly, if available.  If it is not accessible for some
	reason, the next lower-numbered host will accept messages
	temporarily, and pass it along when a lower-numbered host
	becomes available.</p><p>Alternate <acronym class="acronym">MX</acronym> sites should have separate
	Internet connections in order to be most useful.  Your
	<acronym class="acronym">ISP</acronym> can provide this service.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail-domain"></a>28.6.2. Mail for a Domain</h3></div></div></div><p>When configuring a <acronym class="acronym">MTA</acronym> for a network,
	any mail sent to hosts in its domain should be diverted to the
	<acronym class="acronym">MTA</acronym> so that users can receive their mail on
	the master mail server.</p><a id="idp67215992" class="indexterm"></a><p>To make life easiest, a user account with the same
	<span class="emphasis"><em>username</em></span> should exist on both the
	<acronym class="acronym">MTA</acronym> and the system with the
	<acronym class="acronym">MUA</acronym>.  Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a> to create the
	user accounts.</p><p>The <acronym class="acronym">MTA</acronym> must be the designated mail
	exchanger for each workstation on the network.  This is done
	in the<acronym class="acronym">DNS</acronym> configuration with an
	<acronym class="acronym">MX</acronym> record:</p><pre class="programlisting">example.FreeBSD.org	A	204.216.27.XX		; Workstation
			MX	10 nevdull.FreeBSD.org	; Mailhost</pre><p>This will redirect mail for the workstation to the
	<acronym class="acronym">MTA</acronym> no matter where the A record points.
	The mail is sent to the <acronym class="acronym">MX</acronym> host.</p><p>This must be configured on a <acronym class="acronym">DNS</acronym>
	server.  If the network does not run its own
	<acronym class="acronym">DNS</acronym> server, talk to the
	<acronym class="acronym">ISP</acronym> or <acronym class="acronym">DNS</acronym>
	provider.</p><p>The following is an example of virtual email hosting.
	Consider a customer with the domain <code class="systemitem">customer1.org</code>, where all
	the mail for <code class="systemitem">customer1.org</code> should be
	sent to <code class="systemitem">mail.myhost.com</code>.  The
	<acronym class="acronym">DNS</acronym> entry should look like this:</p><pre class="programlisting">customer1.org		MX	10	mail.myhost.com</pre><p>An <code class="literal">A</code>&gt; record is
	<span class="emphasis"><em>not</em></span> needed for <code class="systemitem">customer1.org</code> in order to
	only handle email for that domain.  However, running
	<code class="command">ping</code> against <code class="systemitem">customer1.org</code> will not
	work unless an <code class="literal">A</code> record exists for
	it.</p><p>Tell the <acronym class="acronym">MTA</acronym> which domains and/or
	hostnames it should accept mail for.  Either of the following
	will work for <span class="application">Sendmail</span>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Add the hosts to
	    <code class="filename">/etc/mail/local-host-names</code> when
	    using the <code class="literal">FEATURE(use_cw_file)</code>.</p></li><li class="listitem"><p>Add a <code class="literal">Cwyour.host.com</code> line to
	    <code class="filename">/etc/sendmail.cf</code>.</p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="outgoing-only"></a>28.7. Setting Up to Send Only</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Bill</span> <span class="surname">Moran</span></span>. </span></div></div></div><p>There are many instances where one may only want to send
      mail through a relay.  Some examples are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The computer is a desktop machine that needs to use
	  programs such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a>, using the
	  <acronym class="acronym">ISP</acronym>'s mail relay.</p></li><li class="listitem"><p>The computer is a server that does not handle mail
	  locally, but needs to pass off all mail to a relay for
	  processing.</p></li></ul></div><p>While any <acronym class="acronym">MTA</acronym> is capable of filling
      this particular niche, it can be difficult to properly configure
      a full-featured <acronym class="acronym">MTA</acronym> just to handle offloading
      mail.  Programs such as <span class="application">Sendmail</span> and
      <span class="application">Postfix</span> are overkill for this
      use.</p><p>Additionally, a typical Internet access service agreement
      may forbid one from running a <span class="quote">&#8220;<span class="quote">mail server</span>&#8221;</span>.</p><p>The easiest way to fulfill those needs is to install the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/ssmtp/pkg-descr">mail/ssmtp</a> port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/mail/ssmtp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install replace clean</code></strong></pre><p>Once installed, <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/ssmtp/pkg-descr">mail/ssmtp</a> can be
      configured with
      <code class="filename">/usr/local/etc/ssmtp/ssmtp.conf</code>:</p><pre class="programlisting">root=yourrealemail@example.com
mailhub=mail.example.com
rewriteDomain=example.com
hostname=_HOSTNAME_</pre><p>Use the real email address for <code class="systemitem">root</code>.  Enter the
      <acronym class="acronym">ISP</acronym>'s outgoing mail relay in place of
      <code class="systemitem">mail.example.com</code>.
      Some <acronym class="acronym">ISP</acronym>s call this the <span class="quote">&#8220;<span class="quote">outgoing mail
	server</span>&#8221;</span> or <span class="quote">&#8220;<span class="quote">SMTP server</span>&#8221;</span>.</p><p>Make sure to disable <span class="application">Sendmail</span>,
      including the outgoing mail service.  See <a class="xref" href="#mail-disable-sendmail" title="28.4.1. Disable Sendmail">Section 28.4.1, &#8220;Disable <span class="application">Sendmail</span>&#8221;</a> for details.</p><p><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/ssmtp/pkg-descr">mail/ssmtp</a> has some other options
      available.  Refer to the examples in
      <code class="filename">/usr/local/etc/ssmtp</code> or the manual page
      of <span class="application">ssmtp</span> for more information.</p><p>Setting up <span class="application">ssmtp</span> in this manner
      allows any software on the computer that needs to send mail to
      function properly, while not violating the
      <acronym class="acronym">ISP</acronym>'s usage policy or allowing the computer
      to be hijacked for spamming.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="SMTP-dialup"></a>28.8. Using Mail with a Dialup Connection</h2></div></div></div><p>When using a static IP address, one should not need to
      adjust the default configuration.  Set the hostname to the
      assigned Internet name and <span class="application">Sendmail</span>
      will do the rest.</p><p>When using a dynamically assigned IP address and a dialup
      PPP connection to the Internet, one usually has a mailbox on the
      <acronym class="acronym">ISP</acronym>'s mail server.  In this example, the
      <acronym class="acronym">ISP</acronym>'s domain is <code class="systemitem">example.net</code>, the user name
      is <code class="systemitem">user</code>, the hostname
      is <code class="systemitem">bsd.home</code>, and
      the <acronym class="acronym">ISP</acronym> has allowed <code class="systemitem">relay.example.net</code> as a mail
      relay.</p><p>In order to retrieve mail from the <acronym class="acronym">ISP</acronym>'s
      mailbox, install a retrieval agent from the Ports Collection.
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/fetchmail/pkg-descr">mail/fetchmail</a> is a good choice as it
      supports many different protocols.  Usually, the
      <acronym class="acronym">ISP</acronym> will provide <acronym class="acronym">POP</acronym>.
      When using user <acronym class="acronym">PPP</acronym>, email can be
      automatically fetched when an Internet connection is established
      with the following entry in
      <code class="filename">/etc/ppp/ppp.linkup</code>:</p><pre class="programlisting">MYADDR:
!bg su user -c fetchmail</pre><p>When using <span class="application">Sendmail</span> to deliver
      mail to non-local accounts, configure
      <span class="application">Sendmail</span> to process the mail queue as
      soon as the Internet connection is established.  To do this, add
      this line after the above <code class="command">fetchmail</code> entry in
      <code class="filename">/etc/ppp/ppp.linkup</code>:</p><pre class="programlisting">  !bg su user -c "sendmail -q"</pre><p>In this example, there is an account for
      <code class="systemitem">user</code> on <code class="systemitem">bsd.home</code>.  In the home
      directory of <code class="systemitem">user</code> on
      <code class="systemitem">bsd.home</code>, create a
      <code class="filename">.fetchmailrc</code> which contains this
      line:</p><pre class="programlisting">poll example.net protocol pop3 fetchall pass MySecret</pre><p>This file should not be readable by anyone except
      <code class="systemitem">user</code> as it contains
      the password <code class="literal">MySecret</code>.</p><p>In order to send mail with the correct
      <code class="literal">from:</code> header, configure
      <span class="application">Sendmail</span> to use
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:user@example.net">user@example.net</a>&gt;</code> rather than <code class="email">&lt;user@bsd.home&gt;</code> and to send all mail via
      <code class="systemitem">relay.example.net</code>,
      allowing quicker mail transmission.</p><p>The following <code class="filename">.mc</code> should
      suffice:</p><pre class="programlisting">VERSIONID(`bsd.home.mc version 1.0')
OSTYPE(bsd4.4)dnl
FEATURE(nouucp)dnl
MAILER(local)dnl
MAILER(smtp)dnl
Cwlocalhost
Cwbsd.home
MASQUERADE_AS(`example.net')dnl
FEATURE(allmasquerade)dnl
FEATURE(masquerade_envelope)dnl
FEATURE(nocanonify)dnl
FEATURE(nodns)dnl
define(`SMART_HOST', `relay.example.net')
Dmbsd.home
define(`confDOMAIN_NAME',`bsd.home')dnl
define(`confDELIVERY_MODE',`deferred')dnl</pre><p>Refer to the previous section for details of how to convert
      this file into the <code class="filename">sendmail.cf</code> format.  Do
      not forget to restart <span class="application">Sendmail</span> after
      updating <code class="filename">sendmail.cf</code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="SMTP-Auth"></a>28.9. SMTP Authentication</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">James</span> <span class="surname">Gorham</span></span>. </span></div></div></div><p>Configuring <acronym class="acronym">SMTP</acronym> authentication on the
      <acronym class="acronym">MTA</acronym> provides a number of benefits.
      <acronym class="acronym">SMTP</acronym> authentication adds a layer
      of security to <span class="application">Sendmail</span>, and provides
      mobile users who switch hosts the ability to use the same
      <acronym class="acronym">MTA</acronym> without the need to reconfigure their
      mail client's settings each time.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Install <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/cyrus-sasl2/pkg-descr">security/cyrus-sasl2</a>
	  from the Ports Collection.  This port supports a number of
	  compile-time options.  For the SMTP authentication method
	  demonstrated in this example, make sure that
	  <code class="option">LOGIN</code> is not disabled.</p></li><li class="step"><p>After installing
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/cyrus-sasl2/pkg-descr">security/cyrus-sasl2</a>, edit
	  <code class="filename">/usr/local/lib/sasl2/Sendmail.conf</code>,
	  or create it if it does not exist, and add the following
	  line:</p><pre class="programlisting">pwcheck_method: saslauthd</pre></li><li class="step"><p>Next, install
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/cyrus-sasl2-saslauthd/pkg-descr">security/cyrus-sasl2-saslauthd</a> and add
	  the following line to
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">saslauthd_enable="YES"</pre><p>Finally, start the saslauthd daemon:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service saslauthd start</code></strong></pre><p>This daemon serves as a broker for
	  <span class="application">Sendmail</span> to authenticate against
	  the FreeBSD <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">passwd</span>(5)</span></a> database.  This saves the trouble of
	  creating a new set of usernames and passwords for each user
	  that needs to use <acronym class="acronym">SMTP</acronym> authentication,
	  and keeps the login and mail password the same.</p></li><li class="step"><p>Next, edit <code class="filename">/etc/make.conf</code> and add
	  the following lines:</p><pre class="programlisting">SENDMAIL_CFLAGS=-I/usr/local/include/sasl -DSASL
SENDMAIL_LDADD=/usr/local/lib/libsasl2.so</pre><p>These lines provide <span class="application">Sendmail</span>
	  the proper configuration options for linking to
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/cyrus-sasl2/pkg-descr">cyrus-sasl2</a> at compile time.  Make sure
	  that <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/cyrus-sasl2/pkg-descr">cyrus-sasl2</a> has been installed
	  before recompiling
	  <span class="application">Sendmail</span>.</p></li><li class="step"><p>Recompile <span class="application">Sendmail</span> by
	  executing the following commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/lib/libsmutil</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make cleandir &amp;&amp; make obj &amp;&amp; make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/lib/libsm</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make cleandir &amp;&amp; make obj &amp;&amp; make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/usr.sbin/sendmail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make cleandir &amp;&amp; make obj &amp;&amp; make &amp;&amp; make install</code></strong></pre><p>This compile should not have any problems if
	  <code class="filename">/usr/src</code> has not changed extensively
	  and the shared libraries it needs are available.</p></li><li class="step"><p>After <span class="application">Sendmail</span> has been
	  compiled and reinstalled, edit
	  <code class="filename">/etc/mail/freebsd.mc</code> or the local
	  <code class="filename">.mc</code>.  Many administrators choose
	  to use the output from <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostname&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostname</span>(1)</span></a> as the name of
	  <code class="filename">.mc</code> for uniqueness.  Add these
	  lines:</p><pre class="programlisting">dnl set SASL options
TRUST_AUTH_MECH(`GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl
define(`confAUTH_MECHANISMS', `GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN')dnl</pre><p>These options configure the different methods available
	  to <span class="application">Sendmail</span> for authenticating
	  users.  To use a method other than
	  <span class="application">pwcheck</span>, refer to the
	  <span class="application">Sendmail</span> documentation.</p></li><li class="step"><p>Finally, run <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> while in
	  <code class="filename">/etc/mail</code>.  That will run the new
	  <code class="filename">.mc</code> and create a
	  <code class="filename">.cf</code> named either
	  <code class="filename">freebsd.cf</code> or the name used for the
	  local <code class="filename">.mc</code>.  Then, run <code class="command">make
	    install restart</code>, which will copy the file to
	  <code class="filename">sendmail.cf</code>, and properly restart
	  <span class="application">Sendmail</span>.  For more information
	  about this process, refer to
	  <code class="filename">/etc/mail/Makefile</code>.</p></li></ol></div><p>To test the configuration, use a <acronym class="acronym">MUA</acronym> to
      send a test message.  For further investigation, set the
      <code class="option">LogLevel</code> of <span class="application">Sendmail</span>
      to <code class="literal">13</code> and watch
      <code class="filename">/var/log/maillog</code> for any errors.</p><p>For more information, refer to <a class="link" href="http://www.sendmail.org/~ca/email/auth.html" target="_top">
	<acronym class="acronym">SMTP</acronym> authentication</a>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-agents"></a>28.10. Mail User Agents</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Silver</span></span>. </span></div></div></div><a id="idp67383032" class="indexterm"></a><p>A <acronym class="acronym">MUA</acronym> is an application that is used to
      send and receive email.  As email <span class="quote">&#8220;<span class="quote">evolves</span>&#8221;</span> and
      becomes more complex, <acronym class="acronym">MUA</acronym>s are becoming
      increasingly powerful and provide users increased functionality
      and flexibility.  The <code class="literal">mail</code> category of the
      FreeBSD Ports Collection contains numerous <acronym class="acronym">MUA</acronym>s.
      These include graphical email clients such as
      <span class="application">Evolution</span> or
      <span class="application">Balsa</span> and console based clients such
      as <span class="application">mutt</span> or
      <span class="application">alpine</span>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail-command"></a>28.10.1. <code class="command">mail</code></h3></div></div></div><p><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a> is the default
	<acronym class="acronym">MUA</acronym> installed with FreeBSD.  It is a console
	based <acronym class="acronym">MUA</acronym> that offers the basic
	functionality required to send and receive text-based email.
	It provides limited attachment support and can only access
	local mailboxes.</p><p>Although <code class="command">mail</code> does not natively support
	interaction with <acronym class="acronym">POP</acronym> or
	<acronym class="acronym">IMAP</acronym> servers, these mailboxes may be
	downloaded to a local <code class="filename">mbox</code> using an
	application such as
	<span class="application">fetchmail</span>.</p><p>In order to send and receive email, run
	<code class="command">mail</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mail</code></strong></pre><p>The contents of the user's mailbox in
	<code class="filename">/var/mail</code> are automatically read by
	<code class="command">mail</code>.  Should the mailbox be empty, the
	utility exits with a message indicating that no mail could
	be found.  If mail exists, the application interface starts,
	and a list of messages will be displayed.  Messages are
	automatically numbered, as can be seen in the following
	example:</p><pre class="screen">Mail version 8.1 6/6/93.  Type ? for help.
"/var/mail/marcs": 3 messages 3 new
&gt;N  1 root@localhost        Mon Mar  8 14:05  14/510   "test"
 N  2 root@localhost        Mon Mar  8 14:05  14/509   "user account"
 N  3 root@localhost        Mon Mar  8 14:05  14/509   "sample"</pre><p>Messages can now be read by typing <span class="keycap"><strong>t</strong></span>
	followed by the message number.  This example reads the first
	email:</p><pre class="screen">&amp; <strong class="userinput"><code>t 1</code></strong>
Message 1:
From root@localhost  Mon Mar  8 14:05:52 2004
X-Original-To: marcs@localhost
Delivered-To: marcs@localhost
To: marcs@localhost
Subject: test
Date: Mon,  8 Mar 2004 14:05:52 +0200 (SAST)
From: root@localhost (Charlie Root)

This is a test message, please reply if you receive it.</pre><p>As seen in this example, the message will be displayed
	with full headers.  To display the list of messages again,
	press <span class="keycap"><strong>h</strong></span>.</p><p>If the email requires a reply, press either
	<span class="keycap"><strong>R</strong></span> or <span class="keycap"><strong>r</strong></span>
	<code class="command">mail</code> keys.  <span class="keycap"><strong>R</strong></span> instructs
	<code class="command">mail</code> to reply only to the sender of the
	email, while <span class="keycap"><strong>r</strong></span> replies to all other
	recipients of the message.  These commands can be suffixed
	with the mail number of the message to reply to.  After typing
	the response, the end of the message should be marked by a
	single <span class="keycap"><strong>.</strong></span> on its own line.  An example can be
	seen below:</p><pre class="screen">&amp; <strong class="userinput"><code>R 1</code></strong>
To: root@localhost
Subject: Re: test

<strong class="userinput"><code>Thank you, I did get your email.
.</code></strong>
EOT</pre><p>In order to send a new email, press <span class="keycap"><strong>m</strong></span>,
	followed by the recipient email address.  Multiple recipients
	may be specified by separating each address with the
	<span class="keycap"><strong>,</strong></span> delimiter.  The subject of the message may
	then be entered, followed by the message contents.  The end of
	the message should be specified by putting a single
	<span class="keycap"><strong>.</strong></span> on its own line.</p><pre class="screen">&amp; <strong class="userinput"><code>mail root@localhost</code></strong>
Subject: <strong class="userinput"><code>I mastered mail

Now I can send and receive email using mail ... :)
.</code></strong>
EOT</pre><p>While using <code class="command">mail</code>, press
	<span class="keycap"><strong>?</strong></span> to display help at any time.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a> for more help on how to use
	<code class="command">mail</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a> was not designed to handle attachments and
	  thus deals with them poorly.  Newer <acronym class="acronym">MUA</acronym>s
	  handle attachments in a more intelligent way.  Users who
	  prefer to use <code class="command">mail</code> may find the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/converters/mpack/pkg-descr">converters/mpack</a> port to be of
	  considerable use.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mutt-command"></a>28.10.2. <span class="application">mutt</span></h3></div></div></div><p><span class="application">mutt</span> is a powerful
	<acronym class="acronym">MUA</acronym>, with many features, including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The ability to thread messages.</p></li><li class="listitem"><p>PGP support for digital signing and encryption of
	    email.</p></li><li class="listitem"><p>MIME support.</p></li><li class="listitem"><p>Maildir support.</p></li><li class="listitem"><p>Highly customizable.</p></li></ul></div><p>Refer to <code class="uri"><a class="uri" href="http://www.mutt.org" target="_top">http://www.mutt.org</a></code>
	for more information on
	<span class="application">mutt</span>.</p><p><span class="application">mutt</span> may be installed using the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/mutt/pkg-descr">mail/mutt</a> port.  After the port has been
	installed, <span class="application">mutt</span> can be started by
	issuing the following command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mutt</code></strong></pre><p><span class="application">mutt</span> will automatically read
	and display the contents of the user mailbox in
	<code class="filename">/var/mail</code>.  If no mails are found,
	<span class="application">mutt</span> will wait for commands from
	the user.  The example below shows
	<span class="application">mutt</span> displaying a list of
	messages:</p><div class="mediaobject"><img src="mail/mutt1.png" /></div><p>To read an email, select it using the cursor keys and
	press <span class="keycap"><strong>Enter</strong></span>.  An example of
	<span class="application">mutt</span> displaying email can be seen
	below:</p><div class="mediaobject"><img src="mail/mutt2.png" /></div><p>Similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a>, <span class="application">mutt</span>
	can be used to reply only to the sender of the message as well
	as to all recipients.  To reply only to the sender of the
	email, press <span class="keycap"><strong>r</strong></span>.  To send a group reply
	to the original sender as well as all the message recipients,
	press <span class="keycap"><strong>g</strong></span>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">By default, <span class="application">mutt</span> uses the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a> editor for creating and replying to emails.  Each
	  user can customize this by creating or editing the
	  <code class="filename">.muttrc</code> in their home directory and
	  setting the <code class="literal">editor</code> variable or by setting
	  the <code class="envar">EDITOR</code> environment variable.  Refer to
	  <code class="uri"><a class="uri" href="http://www.mutt.org/" target="_top">http://www.mutt.org/</a></code>
	  for more information about configuring
	  <span class="application">mutt</span>.</p></div><p>To compose a new mail message, press
	<span class="keycap"><strong>m</strong></span>.  After a valid subject has been given,
	<span class="application">mutt</span> will start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a> so the
	email can be written.  Once the contents of the email are
	complete, save and quit from <code class="command">vi</code>.
	<span class="application">mutt</span> will resume, displaying a
	summary screen of the mail that is to be delivered.  In
	order to send the mail, press <span class="keycap"><strong>y</strong></span>.  An example
	of the summary screen can be seen below:</p><div class="mediaobject"><img src="mail/mutt3.png" /></div><p><span class="application">mutt</span> contains extensive help
	which can be accessed from most of the menus by pressing
	<span class="keycap"><strong>?</strong></span>.  The top line also displays the keyboard
	shortcuts where appropriate.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="alpine-command"></a>28.10.3. <span class="application">alpine</span></h3></div></div></div><p><span class="application">alpine</span> is aimed at a beginner
	user, but also includes some advanced features.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">alpine</span> has had several remote
	  vulnerabilities discovered in the past, which allowed remote
	  attackers to execute arbitrary code as users on the local
	  system, by the action of sending a specially-prepared email.
	  While <span class="emphasis"><em>known</em></span> problems have been fixed,
	  <span class="application">alpine</span> code is written in an
	  insecure style and the FreeBSD Security Officer believes there
	  are likely to be other undiscovered vulnerabilities.  Users
	  install <span class="application">alpine</span> at their own
	  risk.</p></div><p>The current version of <span class="application">alpine</span>
	may be installed using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/alpine/pkg-descr">mail/alpine</a>
	port.  Once the port has installed,
	<span class="application">alpine</span> can be started by issuing
	the following command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>alpine</code></strong></pre><p>The first time <span class="application">alpine</span>
	runs, it displays a greeting page with a brief introduction,
	as well as a request from the
	<span class="application">alpine</span> development team to send
	an anonymous email message allowing them to judge how many
	users are using their client.  To send this anonymous message,
	press <span class="keycap"><strong>Enter</strong></span>.  Alternatively, press
	<span class="keycap"><strong>E</strong></span> to exit the greeting without sending an
	anonymous message.  An example of the greeting page is
	shown below:</p><div class="mediaobject"><img src="mail/pine1.png" /></div><p>The main menu is then presented, which can be navigated
	using the cursor keys.  This main menu provides shortcuts for
	the composing new mails, browsing mail directories, and
	administering address book entries.  Below the main menu,
	relevant keyboard shortcuts to perform functions specific to
	the task at hand are shown.</p><p>The default directory opened by
	<span class="application">alpine</span> is
	<code class="filename">inbox</code>.  To view the message index, press
	<span class="keycap"><strong>I</strong></span>, or select the
	<span class="guimenuitem">MESSAGE INDEX</span> option shown
	below:</p><div class="mediaobject"><img src="mail/pine2.png" /></div><p>The message index shows messages in the current directory
	and can be navigated by using the cursor keys.  Highlighted
	messages can be read by pressing
	<span class="keycap"><strong>Enter</strong></span>.</p><div class="mediaobject"><img src="mail/pine3.png" /></div><p>In the screenshot below, a sample message is displayed by
	<span class="application">alpine</span>.  Contextual keyboard
	shortcuts are displayed at the bottom of the screen.  An
	example of one of a shortcut is <span class="keycap"><strong>r</strong></span>, which
	tells the <acronym class="acronym">MUA</acronym> to reply to the current
	message being displayed.</p><div class="mediaobject"><img src="mail/pine4.png" /></div><p>Replying to an email in <span class="application">alpine</span>
	is done using the <span class="application">pico</span> editor,
	which is installed by default with
	<span class="application">alpine</span>.
	<span class="application">pico</span> makes it easy to navigate the
	message and is easier for novice users to use than <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a>
	or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mail&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mail</span>(1)</span></a>.  Once the reply is complete, the message can
	be sent by pressing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>X</strong></span>.  <span class="application">alpine</span> will ask for
	confirmation before sending the message.</p><div class="mediaobject"><img src="mail/pine5.png" /></div><p><span class="application">alpine</span> can be customized using
	the <span class="guimenuitem">SETUP</span> option from the main
	menu.  Consult <code class="uri"><a class="uri" href="http://www.washington.edu/alpine/" target="_top">http://www.washington.edu/alpine/</a></code>
	for more information.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-fetchmail"></a>28.11. Using <span class="application">fetchmail</span></h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Silver</span></span>. </span></div></div></div><a id="idp67175288" class="indexterm"></a><p><span class="application">fetchmail</span> is a full-featured
      <acronym class="acronym">IMAP</acronym> and <acronym class="acronym">POP</acronym> client.  It
      allows users to automatically download mail from remote
      <acronym class="acronym">IMAP</acronym> and <acronym class="acronym">POP</acronym> servers and
      save it into local mailboxes where it can be accessed more
      easily.  <span class="application">fetchmail</span> can be installed
      using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/fetchmail/pkg-descr">mail/fetchmail</a> port, and offers
      various features, including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Support for the <acronym class="acronym">POP3</acronym>,
	  <acronym class="acronym">APOP</acronym>, <acronym class="acronym">KPOP</acronym>,
	  <acronym class="acronym">IMAP</acronym>, <acronym class="acronym">ETRN</acronym> and
	  <acronym class="acronym">ODMR</acronym> protocols.</p></li><li class="listitem"><p>Ability to forward mail using <acronym class="acronym">SMTP</acronym>,
	  which allows filtering, forwarding, and aliasing to function
	  normally.</p></li><li class="listitem"><p>May be run in daemon mode to check periodically for new
	  messages.</p></li><li class="listitem"><p>Can retrieve multiple mailboxes and forward them, based
	  on configuration, to different local users.</p></li></ul></div><p>This section explains some of the basic features of
      <span class="application">fetchmail</span>.  This utility requires a
      <code class="filename">.fetchmailrc</code> configuration in the user's
      home directory in order to run correctly.  This file includes
      server information as well as login credentials.  Due to the
      sensitive nature of the contents of this file, it is advisable
      to make it readable only by the user, with the following
      command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>chmod 600 .fetchmailrc</code></strong></pre><p>The following <code class="filename">.fetchmailrc</code> serves as an
      example for downloading a single user mailbox using
      <acronym class="acronym">POP</acronym>.  It tells
      <span class="application">fetchmail</span> to connect to
      <code class="systemitem">example.com</code> using
      a username of <code class="systemitem">joesoap</code>
      and a password of <code class="literal">XXX</code>.  This example assumes
      that the user <code class="systemitem">joesoap</code>
      exists on the local system.</p><pre class="programlisting">poll example.com protocol pop3 username "joesoap" password "XXX"</pre><p>The next example connects to multiple <acronym class="acronym">POP</acronym>
      and <acronym class="acronym">IMAP</acronym> servers and redirects to different
      local usernames where applicable:</p><pre class="programlisting">poll example.com proto pop3:
user "joesoap", with password "XXX", is "jsoap" here;
user "andrea", with password "XXXX";
poll example2.net proto imap:
user "john", with password "XXXXX", is "myth" here;</pre><p><span class="application">fetchmail</span> can be run in daemon
      mode by running it with <code class="option">-d</code>, followed by the
      interval (in seconds) that <span class="application">fetchmail</span>
      should poll servers listed in <code class="filename">.fetchmailrc</code>.
      The following example configures
      <span class="application">fetchmail</span> to poll every 600
      seconds:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>fetchmail -d 600</code></strong></pre><p>More information on <span class="application">fetchmail</span> can
      be found at <code class="uri"><a class="uri" href="http://www.fetchmail.info/" target="_top">http://www.fetchmail.info/</a></code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-procmail"></a>28.12. Using <span class="application">procmail</span></h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Silver</span></span>. </span></div></div></div><a id="idp67548920" class="indexterm"></a><p><span class="application">procmail</span> is a powerful
      application used to filter incoming mail.  It allows users to
      define <span class="quote">&#8220;<span class="quote">rules</span>&#8221;</span> which can be matched to incoming
      mails to perform specific functions or to reroute mail to
      alternative mailboxes or email addresses.
      <span class="application">procmail</span> can be installed using the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/procmail/pkg-descr">mail/procmail</a> port.  Once installed, it can
      be directly integrated into most <acronym class="acronym">MTA</acronym>s.
      Consult the <acronym class="acronym">MTA</acronym> documentation for more
      information.  Alternatively, <span class="application">procmail</span>
      can be integrated by adding the following line to a
      <code class="filename">.forward</code> in the home directory of the
      user:</p><pre class="programlisting">"|exec /usr/local/bin/procmail || exit 75"</pre><p>The following section displays some basic
      <span class="application">procmail</span> rules, as well as brief
      descriptions of what they do.  Rules must be inserted into a
      <code class="filename">.procmailrc</code>, which must reside in the
      user's home directory.</p><p>The majority of these rules can be found in
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=procmailex&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">procmailex</span>(5)</span></a>.</p><p>To forward all mail from <code class="email">&lt;<a xmlns="" class="email" href="mailto:user@example.com">user@example.com</a>&gt;</code> to
      an external address of <code class="email">&lt;goodmail@example2.com&gt;</code>:</p><pre class="programlisting">:0
* ^From.*user@example.com
! goodmail@example2.com</pre><p>To forward all mails shorter than 1000 bytes to an external
      address of <code class="email">&lt;goodmail@example2.com&gt;</code>:</p><pre class="programlisting">:0
* &lt; 1000
! goodmail@example2.com</pre><p>To send all mail sent to
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:alternate@example.com">alternate@example.com</a>&gt;</code> to a mailbox called
      <code class="filename">alternate</code>:</p><pre class="programlisting">:0
* ^TOalternate@example.com
alternate</pre><p>To send all mail with a subject of <span class="quote">&#8220;<span class="quote">Spam</span>&#8221;</span> to
      <code class="filename">/dev/null</code>:</p><pre class="programlisting">:0
^Subject:.*Spam
/dev/null</pre><p>A useful recipe that parses incoming <code class="systemitem">FreeBSD.org</code> mailing lists and
      places each list in its own mailbox:</p><pre class="programlisting">:0
* ^Sender:.owner-freebsd-\/[^@]+@FreeBSD.ORG
{
	LISTNAME=${MATCH}
	:0
	* LISTNAME??^\/[^@]+
	FreeBSD-${MATCH}
}</pre></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-servers"></a>Chapter 29. Network Servers</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#network-servers-synopsis">29.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#network-inetd">29.2. The <span class="application">inetd</span>
      Super-Server</a></span></dt><dt><span class="sect1"><a href="#network-nfs">29.3. Network File System (NFS)</a></span></dt><dt><span class="sect1"><a href="#network-nis">29.4. Network Information System
      (<acronym class="acronym">NIS</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-ldap">29.5. Lightweight Directory Access Protocol
	(<acronym class="acronym">LDAP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-dhcp">29.6. Dynamic Host Configuration Protocol
      (<acronym class="acronym">DHCP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-dns">29.7. Domain Name System (<acronym class="acronym">DNS</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-apache">29.8. Apache HTTP Server</a></span></dt><dt><span class="sect1"><a href="#network-ftp">29.9. File Transfer Protocol (<acronym class="acronym">FTP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-samba">29.10. File and Print Services for <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® Clients
      (Samba)</a></span></dt><dt><span class="sect1"><a href="#network-ntp">29.11. Clock Synchronization with NTP</a></span></dt><dt><span class="sect1"><a href="#network-iscsi">29.12. <acronym class="acronym">iSCSI</acronym> Initiator and Target
      Configuration</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-servers-synopsis"></a>29.1. Synopsis</h2></div></div></div><p>This chapter covers some of the more frequently used network
      services on <span class="trademark">UNIX</span>® systems.  This includes installing,
      configuring, testing, and maintaining many different types of
      network services.  Example configuration files are included
      throughout this chapter for reference.</p><p>By the end of this chapter, readers will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to manage the <span class="application">inetd</span>
	  daemon.</p></li><li class="listitem"><p>How to set up the Network File System
	  (<acronym class="acronym">NFS</acronym>).</p></li><li class="listitem"><p>How to set up the Network Information Server
	  (<acronym class="acronym">NIS</acronym>) for centralizing and sharing
	  user accounts.</p></li><li class="listitem"><p>How to set FreeBSD up to act as an <acronym class="acronym">LDAP</acronym>
	  server or client</p></li><li class="listitem"><p>How to set up automatic network settings using
	  <acronym class="acronym">DHCP</acronym>.</p></li><li class="listitem"><p>How to set up a Domain Name Server
	  (<acronym class="acronym">DNS</acronym>).</p></li><li class="listitem"><p>How to set up the <span class="application">Apache</span>
	  <acronym class="acronym">HTTP</acronym> Server.</p></li><li class="listitem"><p>How to set up a File Transfer Protocol
	  (<acronym class="acronym">FTP</acronym>) server.</p></li><li class="listitem"><p>How to set up a file and print server for <span class="trademark">Windows</span>®
	  clients using <span class="application">Samba</span>.</p></li><li class="listitem"><p>How to synchronize the time and date, and set up a
	  time server using the Network Time Protocol
	  (<acronym class="acronym">NTP</acronym>).</p></li><li class="listitem"><p>How to set up <acronym class="acronym">iSCSI</acronym>.</p></li></ul></div><p>This chapter assumes a basic knowledge of:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">/etc/rc</code> scripts.</p></li><li class="listitem"><p>Network terminology.</p></li><li class="listitem"><p>Installation of additional third-party
	  software (<a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a>).</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-inetd"></a>29.2. The <span class="application">inetd</span>
      Super-Server</h2></div></div></div><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> daemon is sometimes referred to as a
      Super-Server because it manages connections for many services.
      Instead of starting multiple applications, only the
      <span class="application">inetd</span> service needs to be started.
      When a connection is received for a service that is managed by
      <span class="application">inetd</span>, it determines which program
      the connection is destined for, spawns a process for that
      program, and delegates the program a socket.  Using
      <span class="application">inetd</span> for services that are not
      heavily used can reduce system load, when compared to running
      each daemon individually in stand-alone mode.</p><p>Primarily, <span class="application">inetd</span> is used to
      spawn other daemons, but several trivial protocols are handled
      internally, such as <span class="application">chargen</span>,
      <span class="application">auth</span>,
      <span class="application">time</span>,
      <span class="application">echo</span>,
      <span class="application">discard</span>, and
      <span class="application">daytime</span>.</p><p>This section covers the basics of configuring
      <span class="application">inetd</span>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-conf"></a>29.2.1. Configuration File</h3></div></div></div><p>Configuration of <span class="application">inetd</span> is
	done by editing <code class="filename">/etc/inetd.conf</code>.  Each
	line of this configuration file represents an application
	which can be started by <span class="application">inetd</span>.  By
	default, every line starts with a comment
	(<code class="literal">#</code>), meaning that
	<span class="application">inetd</span> is not listening for any
	applications.  To configure <span class="application">inetd</span>
	to listen for an application's connections, remove the
	<code class="literal">#</code> at the beginning of the line for that
	application.</p><p>After saving your edits, configure
	<span class="application">inetd</span> to start at system boot by
	editing <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">inetd_enable="YES"</pre><p>To start  <span class="application">inetd</span> now, so that it
	listens for the service you configured, type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service inetd start</code></strong></pre><p>Once <span class="application">inetd</span> is started, it needs
	to be notified whenever a modification is made to
	<code class="filename">/etc/inetd.conf</code>:</p><div class="example"><a id="network-inetd-reread"></a><div class="example-title">Example 29.1. Reloading the <span class="application">inetd</span>
	  Configuration File</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service inetd reload</code></strong></pre></div></div><br class="example-break" /><p>Typically, the default entry for an application does not
	need to be edited beyond removing the <code class="literal">#</code>.
	In some situations, it may be appropriate to edit the default
	entry.</p><p>As an example, this is the default entry for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a>
	over IPv4:</p><pre class="programlisting">ftp     stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -l</pre><p>The seven columns in an entry are as follows:</p><pre class="programlisting">service-name
socket-type
protocol
{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]
user[:group][/login-class]
server-program
server-program-arguments</pre><p>where:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">service-name</span></dt><dd><p>The service name of the daemon to start.  It must
	      correspond to a service listed in
	      <code class="filename">/etc/services</code>.  This determines
	      which port <span class="application">inetd</span> listens on
	      for incoming connections to that service.  When using a
	      custom service, it must first be added to
	      <code class="filename">/etc/services</code>.</p></dd><dt><span class="term">socket-type</span></dt><dd><p>Either <code class="literal">stream</code>,
	      <code class="literal">dgram</code>, <code class="literal">raw</code>, or
	      <code class="literal">seqpacket</code>.  Use
	      <code class="literal">stream</code> for TCP connections and
	      <code class="literal">dgram</code> for
	      <acronym class="acronym">UDP</acronym> services.</p></dd><dt><span class="term">protocol</span></dt><dd><p>Use one of the following protocol names:</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Protocol Name</th><th>Explanation</th></tr></thead><tbody><tr><td>tcp or tcp4</td><td>TCP IPv4</td></tr><tr><td>udp or udp4</td><td><acronym class="acronym">UDP</acronym> IPv4</td></tr><tr><td>tcp6</td><td>TCP IPv6</td></tr><tr><td>udp6</td><td><acronym class="acronym">UDP</acronym> IPv6</td></tr><tr><td>tcp46</td><td>Both TCP IPv4 and IPv6</td></tr><tr><td>udp46</td><td>Both <acronym class="acronym">UDP</acronym> IPv4 and
		      IPv6</td></tr></tbody></table></div></dd><dt><span class="term">{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]</span></dt><dd><p>In this field, <code class="option">wait</code> or
	      <code class="option">nowait</code> must be specified.
	      <code class="option">max-child</code>,
	      <code class="option">max-connections-per-ip-per-minute</code> and
	      <code class="option">max-child-per-ip</code> are optional.</p><p><code class="option">wait|nowait</code> indicates whether or
	      not the service is able to handle its own socket.
	      <code class="option">dgram</code> socket types must use
	      <code class="option">wait</code> while
	      <code class="option">stream</code> daemons, which are usually
	      multi-threaded, should use <code class="option">nowait</code>.
	      <code class="option">wait</code> usually hands off multiple sockets
	      to a single daemon, while <code class="option">nowait</code> spawns
	      a child daemon for each new socket.</p><p>The maximum number of child daemons
	      <span class="application">inetd</span> may spawn is set by
	      <code class="option">max-child</code>.  For example, to limit ten
	      instances of the daemon, place a <code class="literal">/10</code>
	      after <code class="option">nowait</code>.  Specifying
	      <code class="literal">/0</code> allows an unlimited number of
	      children.</p><p><code class="option">max-connections-per-ip-per-minute</code>
	      limits the number of connections from any particular
	      <acronym class="acronym">IP</acronym> address per minute.  Once the
	      limit  is reached, further connections from this IP
	      address will be dropped until the end of the minute.
	      For example, a value of <code class="literal">/10</code> would
	      limit any particular <acronym class="acronym">IP</acronym> address to
	      ten connection attempts per minute.
	      <code class="option">max-child-per-ip</code> limits the number of
	      child processes that can be started on behalf on any
	      single <acronym class="acronym">IP</acronym> address at any moment.
	      These options can limit excessive resource consumption
	      and help to prevent Denial of Service attacks.</p><p>An example can be seen in the default settings for
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fingerd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fingerd</span>(8)</span></a>:</p><pre class="programlisting">finger stream  tcp     nowait/3/10 nobody /usr/libexec/fingerd fingerd -k -s</pre></dd><dt><span class="term">user</span></dt><dd><p>The username the daemon
	      will run as.  Daemons typically run as
	      <code class="systemitem">root</code>,
	      <code class="systemitem">daemon</code>, or
	      <code class="systemitem">nobody</code>.</p></dd><dt><span class="term">server-program</span></dt><dd><p>The full path to the daemon.  If the daemon is a
	      service provided by <span class="application">inetd</span>
	      internally, use <code class="option">internal</code>.</p></dd><dt><span class="term">server-program-arguments</span></dt><dd><p>Used to specify any command arguments to be passed
	      to the daemon on invocation.  If the daemon is an
	      internal service, use
	      <code class="option">internal</code>.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-cmdline"></a>29.2.2. Command-Line Options</h3></div></div></div><p>Like most server daemons, <span class="application">inetd</span>
	has a number of options that can be used to modify its
	behavior.  By default, <span class="application">inetd</span> is
	started with <code class="literal">-wW -C 60</code>.  These options
	enable TCP wrappers for all services, including internal
	services, and prevent any <acronym class="acronym">IP</acronym> address from
	requesting any service more than 60 times per minute.</p><p>To change the default options which are passed to
	<span class="application">inetd</span>, add an entry for
	<code class="literal">inetd_flags</code> in
	<code class="filename">/etc/rc.conf</code>.  If
	<span class="application">inetd</span> is already running, restart
	it with <code class="command">service inetd restart</code>.</p><p>The available rate limiting options are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-c maximum</span></dt><dd><p>Specify the default maximum number of simultaneous
	      invocations of each service, where the default is
	      unlimited.  May be overridden on a per-service basis by
	      using <code class="option">max-child</code> in
	      <code class="filename">/etc/inetd.conf</code>.</p></dd><dt><span class="term">-C rate</span></dt><dd><p>Specify the default maximum number of times a
	      service can be invoked from a single
	      <acronym class="acronym">IP</acronym> address per minute.  May be
	      overridden on a per-service basis by using
	      <code class="option">max-connections-per-ip-per-minute</code> in
	      <code class="filename">/etc/inetd.conf</code>.</p></dd><dt><span class="term">-R rate</span></dt><dd><p>Specify the maximum number of times a service can be
	      invoked in one minute, where the default is
	      <code class="literal">256</code>.  A rate of <code class="literal">0</code>
	      allows an unlimited number.</p></dd><dt><span class="term">-s maximum</span></dt><dd><p>Specify the maximum number of times a service can be
	      invoked from a single <acronym class="acronym">IP</acronym> address at
	      any one time, where the default is unlimited.  May be
	      overridden on a per-service basis by using
	      <code class="option">max-child-per-ip</code> in
	      <code class="filename">/etc/inetd.conf</code>.</p></dd></dl></div><p>Additional options are available.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>
	for the full list of options.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-security"></a>29.2.3. Security Considerations</h3></div></div></div><p>Many of the daemons which can be managed by
	<span class="application">inetd</span> are not security-conscious.
	Some daemons, such as <span class="application">fingerd</span>, can
	provide information that may be useful to an attacker.  Only
	enable the services which are needed and monitor the system
	for excessive connection attempts.
	<code class="literal">max-connections-per-ip-per-minute</code>,
	<code class="literal">max-child</code> and
	<code class="literal">max-child-per-ip</code> can be used to limit such
	attacks.</p><p>By default, TCP wrappers is enabled.  Consult
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> for more information on placing TCP
	restrictions on various
	<span class="application">inetd</span> invoked daemons.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-nfs"></a>29.3. Network File System (NFS)</h2></div><div><span class="authorgroup">Reorganized and enhanced by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Bill</span> <span class="surname">Swingle</span></span>. </span></div></div></div><a id="idp67743352" class="indexterm"></a><p>FreeBSD supports the Network File System
      (<acronym class="acronym">NFS</acronym>), which allows a server to share
      directories and files with clients over a network.  With
      <acronym class="acronym">NFS</acronym>, users and programs can access files on
      remote systems as if they were stored locally.</p><p><acronym class="acronym">NFS</acronym> has many practical uses.  Some of
      the more common uses include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Data that would otherwise be duplicated on each client
	  can be kept in a single location and accessed by clients
	  on the network.</p></li><li class="listitem"><p>Several clients may need access to the
	  <code class="filename">/usr/ports/distfiles</code> directory.
	  Sharing that directory allows for quick access to the
	  source files without having to download them to each
	  client.</p></li><li class="listitem"><p>On large networks, it is often more convenient to
	  configure a central <acronym class="acronym">NFS</acronym> server on which
	  all user home directories are stored.  Users can log into
	  a client anywhere on the network and have access to their
	  home directories.</p></li><li class="listitem"><p>Administration of <acronym class="acronym">NFS</acronym> exports is
	  simplified.  For example, there is only one file system
	  where security or backup policies must be set.</p></li><li class="listitem"><p>Removable media storage devices can be used by other
	  machines on the network.  This reduces the number of devices
	  throughout the network and provides a centralized location
	  to manage their security.  It is often more convenient to
	  install software on multiple machines from a centralized
	  installation media.</p></li></ul></div><p><acronym class="acronym">NFS</acronym> consists of a server and one or more
      clients.  The client remotely accesses the data that is stored
      on the server machine.  In order for this to function properly,
      a few processes have to be configured and running.</p><p>These daemons must be running on the server:</p><a id="idp67752184" class="indexterm"></a><a id="idp67753336" class="indexterm"></a><a id="idp67754488" class="indexterm"></a><a id="idp67763576" class="indexterm"></a><a id="idp67764472" class="indexterm"></a><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Daemon</th><th>Description</th></tr></thead><tbody><tr><td><span class="application">nfsd</span></td><td>The <acronym class="acronym">NFS</acronym> daemon which services
		requests from <acronym class="acronym">NFS</acronym> clients.</td></tr><tr><td><span class="application">mountd</span></td><td>The <acronym class="acronym">NFS</acronym> mount daemon which
		carries out requests received from
		<span class="application">nfsd</span>.</td></tr><tr><td><span class="application">rpcbind</span></td><td> This daemon allows <acronym class="acronym">NFS</acronym>
		clients to discover which port the
		<acronym class="acronym">NFS</acronym> server is using.</td></tr></tbody></table></div><p>Running <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=nfsiod&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">nfsiod</span>(8)</span></a> on the client can improve
	performance, but is not required.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-configuring-nfs"></a>29.3.1. Configuring the Server</h3></div></div></div><a id="idp67777272" class="indexterm"></a><p>The file systems which the <acronym class="acronym">NFS</acronym> server
	will share are specified in <code class="filename">/etc/exports</code>.
	Each line in this file specifies a file system to be exported,
	which clients have access to that file system, and any access
	options.  When adding entries to this file, each exported file
	system, its properties, and allowed hosts must occur on a
	single line.  If no clients are listed in the entry, then any
	client on the network can mount that file system.</p><a id="idp67783672" class="indexterm"></a><p>The following <code class="filename">/etc/exports</code> entries
	demonstrate how to export file systems.  The examples can be
	modified to match the file systems and client names on the
	reader's network.  There are many options that can be used in
	this file, but only a few will be mentioned here.  See
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=exports&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">exports</span>(5)</span></a> for the full list of options.</p><p>This example shows how to export
	<code class="filename">/cdrom</code> to three hosts named
	<em class="replaceable"><code>alpha</code></em>,
	<em class="replaceable"><code>bravo</code></em>, and
	<em class="replaceable"><code>charlie</code></em>:</p><pre class="programlisting">/cdrom -ro <em class="replaceable"><code>alpha</code></em> <em class="replaceable"><code>bravo</code></em> <em class="replaceable"><code>charlie</code></em></pre><p>The <code class="literal">-ro</code> flag makes the file system
	read-only, preventing clients from making any changes to the
	exported file system.  This example assumes that the host
	names are either in <acronym class="acronym">DNS</acronym> or in
	<code class="filename">/etc/hosts</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> if
	the network does not have a <acronym class="acronym">DNS</acronym>
	server.</p><p>The next example exports <code class="filename">/home</code> to
	three clients by <acronym class="acronym">IP</acronym> address.  This can be
	useful for networks without <acronym class="acronym">DNS</acronym> or
	<code class="filename">/etc/hosts</code> entries.  The
	<code class="literal">-alldirs</code> flag allows subdirectories to be
	mount points.  In other words, it will not automatically mount
	the subdirectories, but will permit the client to mount the
	directories that are required as needed.</p><pre class="programlisting">/usr/home  -alldirs  10.0.0.2 10.0.0.3 10.0.0.4</pre><p>This next example exports <code class="filename">/a</code> so that
	two clients from different domains may access that file
	system.  The <code class="option">-maproot=root</code> allows <code class="systemitem">root</code> on the remote system to
	write data on the exported file system as <code class="systemitem">root</code>.  If
	<code class="literal">-maproot=root</code> is not specified, the
	client's <code class="systemitem">root</code> user
	will be mapped to the server's <code class="systemitem">nobody</code> account and will be
	subject to the access limitations defined for <code class="systemitem">nobody</code>.</p><pre class="programlisting">/a  -maproot=root  host.example.com box.example.org</pre><p>A client can only be specified once per file system.  For
	example, if <code class="filename">/usr</code> is a single file system,
	these entries would be invalid as both entries specify the
	same host:</p><pre class="programlisting"># Invalid when /usr is one file system
/usr/src   client
/usr/ports client</pre><p>The correct format for this situation is to use one
	entry:</p><pre class="programlisting">/usr/src /usr/ports  client</pre><p>The following is an example of a valid export list, where
	<code class="filename">/usr</code> and <code class="filename">/exports</code>
	are local file systems:</p><pre class="programlisting"># Export src and ports to client01 and client02, but only
# client01 has root privileges on it
/usr/src /usr/ports -maproot=root    client01
/usr/src /usr/ports               client02
# The client machines have root and can mount anywhere
# on /exports. Anyone in the world can mount /exports/obj read-only
/exports -alldirs -maproot=root      client01 client02
/exports/obj -ro</pre><p>To enable the processes required by the
	<acronym class="acronym">NFS</acronym> server at boot time, add these options
	to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">rpcbind_enable="YES"
nfs_server_enable="YES"
mountd_enable="YES"</pre><p>The server can be started now by running this
	command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service nfsd start</code></strong></pre><p>Whenever the <acronym class="acronym">NFS</acronym> server is started,
	<span class="application">mountd</span> also starts automatically.
	However, <span class="application">mountd</span> only reads
	<code class="filename">/etc/exports</code> when it is started.  To make
	subsequent <code class="filename">/etc/exports</code> edits take effect
	immediately, force <span class="application">mountd</span> to reread
	it:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service mountd reload</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67825912"></a>29.3.2. Configuring the Client</h3></div></div></div><p>To enable <acronym class="acronym">NFS</acronym> clients, set this option
	in each client's <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">nfs_client_enable="YES"</pre><p>Then, run this command on each <acronym class="acronym">NFS</acronym>
	client:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service nfsclient start</code></strong></pre><p>The client now has everything it needs to mount a remote
	file system.  In these examples, the server's name is
	<code class="systemitem">server</code> and the client's name is
	<code class="systemitem">client</code>.  To mount
	<code class="filename">/home</code> on
	<code class="systemitem">server</code> to the
	<code class="filename">/mnt</code> mount point on
	<code class="systemitem">client</code>:</p><a id="idp67832568" class="indexterm"></a><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount server:/home /mnt</code></strong></pre><p>The files and directories in
	<code class="filename">/home</code> will now be available on
	<code class="systemitem">client</code>, in the
	<code class="filename">/mnt</code> directory.</p><p>To mount a remote file system each time the client boots,
	add it to <code class="filename">/etc/fstab</code>:</p><pre class="programlisting">server:/home	/mnt	nfs	rw	0	0</pre><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> for a description of all available
	options.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67842680"></a>29.3.3. Locking</h3></div></div></div><p>Some applications require file locking to operate
	correctly.  To enable locking, add these lines to
	<code class="filename">/etc/rc.conf</code> on both the client and
	server:</p><pre class="programlisting">rpc_lockd_enable="YES"
rpc_statd_enable="YES"</pre><p>Then start the applications:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service lockd start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service statd start</code></strong></pre><p>If locking is not required on the server, the
	<acronym class="acronym">NFS</acronym> client can be configured to lock
	locally by including <code class="option">-L</code> when running
	<span class="application">mount</span>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mount_nfs&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mount_nfs</span>(8)</span></a>
	for further details.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-autofs"></a>29.3.4. Automating Mounts with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a></h3></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> automount facility is supported
	  starting with FreeBSD 10.1-RELEASE.  To use the
	  automounter functionality in older versions of FreeBSD, use
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> instead.  This chapter only describes the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> automounter.</p></div><a id="idp67869816" class="indexterm"></a><a id="idp67870328" class="indexterm"></a><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> facility is a common name for several
	components that, together, allow for automatic mounting of
	remote and local filesystems whenever a file or directory
	within that file system is accessed.  It consists of the
	kernel component, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a>, and several userspace
	applications: <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automount</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autounmountd</span>(8)</span></a>.  It serves as an alternative for
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> from previous FreeBSD releases.  Amd is still
	provided for backward compatibility purposes, as the two use
	different map format; the one used by autofs is the same as
	with other SVR4 automounters, such as the ones in Solaris,
	MacOS X, and Linux.</p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> virtual filesystem is mounted on
	specified mountpoints by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automount</span>(8)</span></a>, usually invoked
	during boot.</p><p>Whenever a process attempts to access file within the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> mountpoint, the kernel will notify
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> daemon and pause the triggering process.
	The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> daemon will handle kernel requests by
	finding the proper map and mounting the filesystem according
	to it, then signal the kernel to release blocked process.  The
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autounmountd</span>(8)</span></a> daemon automatically unmounts automounted
	filesystems after some time, unless they are still being
	used.</p><p>The primary autofs configuration file is
	<code class="filename">/etc/auto_master</code>.  It assigns individual
	maps to top-level mounts.  For an explanation of
	<code class="filename">auto_master</code> and the map syntax, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auto_master&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auto_master</span>(5)</span></a>.</p><p>There is a special automounter map mounted on
	<code class="filename">/net</code>.  When a file is accessed within
	this directory, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> looks up the corresponding
	remote mount and automatically mounts it.  For instance, an
	attempt to access a file within
	<code class="filename">/net/foobar/usr</code> would tell
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> to mount the <code class="filename">/usr</code> export from the host
	<code class="systemitem">foobar</code>.</p><div class="example"><a id="idp67891192"></a><div class="example-title">Example 29.2. Mounting an Export with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a></div><div class="example-contents"><p>In this example, <code class="command">showmount -e</code> shows
	  the exported file systems that can be mounted from the
	  <acronym class="acronym">NFS</acronym> server,
	  <code class="systemitem">foobar</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>showmount -e foobar</code></strong>
Exports list on foobar:
/usr                               10.10.10.0
/a                                 10.10.10.0
<code class="prompt">%</code> <strong class="userinput"><code>cd /net/foobar/usr</code></strong></pre></div></div><br class="example-break" /><p>The output from <code class="command">showmount</code> shows
	<code class="filename">/usr</code> as an export.
	When changing directories to <code class="filename">/host/foobar/usr</code>,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> intercepts the request and attempts to
	resolve the hostname <code class="systemitem">foobar</code>.  If successful,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a> automatically mounts the source
	export.</p><p>To enable <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> at boot time, add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">autofs_enable="YES"</pre><p>Then <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> can be started by running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service automount start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service automountd start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service autounmountd start</code></strong></pre><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autofs</span>(5)</span></a> map format is the same as in other
	operating systems.  Information about this format from other
	sources can be useful, like the <a class="link" href="http://web.archive.org/web/20160813071113/http://images.apple.com/business/docs/Autofs.pdf" target="_top">Mac
	  OS X document</a>.</p><p>Consult the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automount&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automount</span>(8)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=automountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">automountd</span>(8)</span></a>,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=autounmountd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">autounmountd</span>(8)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=auto_master&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">auto_master</span>(5)</span></a> manual pages for
	more information.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-nis"></a>29.4. Network Information System
      (<acronym class="acronym">NIS</acronym>)</h2></div></div></div><a id="idp67932408" class="indexterm"></a><a id="idp67932920" class="indexterm"></a><a id="idp67933432" class="indexterm"></a><a id="idp67933944" class="indexterm"></a><a id="idp67934456" class="indexterm"></a><a id="idp67934968" class="indexterm"></a><a id="idp67935480" class="indexterm"></a><a id="idp67935992" class="indexterm"></a><p>Network Information System (<acronym class="acronym">NIS</acronym>) is
      designed to centralize administration of <span class="trademark">UNIX</span>®-like systems
      such as <span class="trademark">Solaris</span>&#8482;, HP-UX, <span class="trademark">AIX</span>®, Linux, NetBSD, OpenBSD, and
      FreeBSD.  <acronym class="acronym">NIS</acronym> was originally known as Yellow
      Pages but the name was changed due to trademark issues.   This
      is the reason why <acronym class="acronym">NIS</acronym> commands begin with
      <code class="literal">yp</code>.</p><a id="idp67940600" class="indexterm"></a><p><acronym class="acronym">NIS</acronym> is a Remote Procedure Call
      (<acronym class="acronym">RPC</acronym>)-based client/server system that allows
      a group of machines within an <acronym class="acronym">NIS</acronym> domain to
      share a common set of configuration files.  This permits a
      system administrator to set up <acronym class="acronym">NIS</acronym> client
      systems with only minimal configuration data and to add, remove,
      or modify configuration data from a single location.</p><p>FreeBSD uses version 2 of the <acronym class="acronym">NIS</acronym>
      protocol.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67944440"></a>29.4.1. <acronym class="acronym">NIS</acronym> Terms and Processes</h3></div></div></div><p>Table 28.1 summarizes the terms and important processes
	used by <acronym class="acronym">NIS</acronym>:</p><a id="idp67946104" class="indexterm"></a><a id="idp67947000" class="indexterm"></a><div class="table"><a id="idp67947896"></a><div class="table-title">Table 29.1. <acronym class="acronym">NIS</acronym> Terminology</div><div class="table-contents"><table class="table" summary="NIS Terminology" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Term</th><th>Description</th></tr></thead><tbody><tr><td><acronym class="acronym">NIS</acronym> domain name</td><td><acronym class="acronym">NIS</acronym> servers and clients share
		an <acronym class="acronym">NIS</acronym> domain name.  Typically,
		this name does not have anything to do with
		<acronym class="acronym">DNS</acronym>.</td></tr><tr><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rpcbind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rpcbind</span>(8)</span></a></td><td>This service enables <acronym class="acronym">RPC</acronym> and
		must be running in order to run an
		<acronym class="acronym">NIS</acronym> server or act as an
		<acronym class="acronym">NIS</acronym> client.</td></tr><tr><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypbind</span>(8)</span></a></td><td>This service binds an <acronym class="acronym">NIS</acronym>
		client to its <acronym class="acronym">NIS</acronym> server.  It will
		take the <acronym class="acronym">NIS</acronym> domain name and use
		<acronym class="acronym">RPC</acronym> to connect to the server.  It
		is the core of client/server communication in an
		<acronym class="acronym">NIS</acronym> environment.  If this service
		is not running on a client machine, it will not be
		able to access the <acronym class="acronym">NIS</acronym>
		server.</td></tr><tr><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a></td><td>This is the process for the
		<acronym class="acronym">NIS</acronym> server.  If this service stops
		running, the server will no longer be able to respond
		to <acronym class="acronym">NIS</acronym> requests so hopefully, there
		is a slave server to take over.  Some non-FreeBSD clients
		will not try to reconnect using a slave server and the
		<span class="application">ypbind</span> process may need to
		be restarted on these
		clients.</td></tr><tr><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rpc.yppasswdd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rpc.yppasswdd</span>(8)</span></a></td><td>This process only runs on
		<acronym class="acronym">NIS</acronym> master servers.  This daemon
		allows <acronym class="acronym">NIS</acronym> clients to change their
		<acronym class="acronym">NIS</acronym> passwords.  If this daemon is
		not running, users will have to login to the
		<acronym class="acronym">NIS</acronym> master server and change their
		passwords there.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67988472"></a>29.4.2. Machine Types</h3></div></div></div><a id="idp67989112" class="indexterm"></a><a id="idp67990136" class="indexterm"></a><a id="idp67991160" class="indexterm"></a><p>There are three types of hosts in an
	<acronym class="acronym">NIS</acronym> environment:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><acronym class="acronym">NIS</acronym> master server</p><p>This server acts as a central repository for host
	    configuration information and maintains the
	    authoritative copy of the files used by all of the
	    <acronym class="acronym">NIS</acronym> clients.  The
	    <code class="filename">passwd</code>, <code class="filename">group</code>,
	    and other various files used by <acronym class="acronym">NIS</acronym>
	    clients are stored on the master server.  While it is
	    possible for one machine to be an <acronym class="acronym">NIS</acronym>
	    master server for more than one <acronym class="acronym">NIS</acronym>
	    domain, this type of configuration will not be covered in
	    this chapter as it assumes a relatively small-scale
	    <acronym class="acronym">NIS</acronym> environment.</p></li><li class="listitem"><p><acronym class="acronym">NIS</acronym> slave servers</p><p><acronym class="acronym">NIS</acronym> slave servers maintain copies
	    of the <acronym class="acronym">NIS</acronym> master's data files in
	    order to provide redundancy.  Slave servers also help to
	    balance the load of the master server as
	    <acronym class="acronym">NIS</acronym> clients always attach to the
	    <acronym class="acronym">NIS</acronym> server which responds
	    first.</p></li><li class="listitem"><p><acronym class="acronym">NIS</acronym> clients</p><p><acronym class="acronym">NIS</acronym> clients authenticate
	    against the <acronym class="acronym">NIS</acronym> server during log
	    on.</p></li></ul></div><p>Information in many files can be shared using
	<acronym class="acronym">NIS</acronym>.  The
	<code class="filename">master.passwd</code>,
	<code class="filename">group</code>, and <code class="filename">hosts</code>
	files are commonly shared via <acronym class="acronym">NIS</acronym>.
	Whenever a process on a client needs information that would
	normally be found in these files locally, it makes a query to
	the <acronym class="acronym">NIS</acronym> server that it is bound to
	instead.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68009336"></a>29.4.3. Planning Considerations</h3></div></div></div><p>This section describes a sample <acronym class="acronym">NIS</acronym>
	environment which consists of 15 FreeBSD machines with no
	centralized point of administration.  Each machine has its own
	<code class="filename">/etc/passwd</code> and
	<code class="filename">/etc/master.passwd</code>.  These files are kept
	in sync with each other only through manual intervention.
	Currently, when a user is added to the lab, the process must
	be repeated on all 15 machines.</p><p>The configuration of the lab will be as follows:</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Machine name</th><th><acronym class="acronym">IP</acronym> address</th><th>Machine role</th></tr></thead><tbody><tr><td><code class="systemitem">ellington</code></td><td><code class="systemitem">10.0.0.2</code></td><td><acronym class="acronym">NIS</acronym> master</td></tr><tr><td><code class="systemitem">coltrane</code></td><td><code class="systemitem">10.0.0.3</code></td><td><acronym class="acronym">NIS</acronym> slave</td></tr><tr><td><code class="systemitem">basie</code></td><td><code class="systemitem">10.0.0.4</code></td><td>Faculty workstation</td></tr><tr><td><code class="systemitem">bird</code></td><td><code class="systemitem">10.0.0.5</code></td><td>Client machine</td></tr><tr><td><code class="systemitem">cli[1-11]</code></td><td>
		<code class="systemitem">10.0.0.[6-17]</code></td><td>Other client machines</td></tr></tbody></table></div><p>If this is the first time an <acronym class="acronym">NIS</acronym>
	scheme is being developed, it should be thoroughly planned
	ahead of time.  Regardless of network size, several decisions
	need to be made as part of the planning process.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68043128"></a>29.4.3.1. Choosing a <acronym class="acronym">NIS</acronym> Domain Name</h4></div></div></div><a id="idp68044152" class="indexterm"></a><p>When a client broadcasts its requests for info, it
	  includes the name of the <acronym class="acronym">NIS</acronym> domain that
	  it is part of.  This is how multiple servers on one network
	  can tell which server should answer which request.  Think of
	  the <acronym class="acronym">NIS</acronym> domain name as the name for a
	  group of hosts.</p><p>Some organizations choose to use their Internet domain
	  name for their <acronym class="acronym">NIS</acronym> domain name.  This is
	  not recommended as it can cause confusion when trying to
	  debug network problems.  The <acronym class="acronym">NIS</acronym> domain
	  name should be unique within the network and it is helpful
	  if it describes the group of machines it represents.  For
	  example, the Art department at Acme Inc. might be in the
	  <span class="quote">&#8220;<span class="quote">acme-art</span>&#8221;</span> <acronym class="acronym">NIS</acronym> domain.  This
	  example will use the domain name
	  <code class="literal">test-domain</code>.</p><p>However, some non-FreeBSD operating systems require the
	  <acronym class="acronym">NIS</acronym> domain name to be the same as the
	  Internet domain name.  If one or more machines on the
	  network have this restriction, the Internet domain name
	  <span class="emphasis"><em>must</em></span> be used as the
	  <acronym class="acronym">NIS</acronym> domain name.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68050552"></a>29.4.3.2. Physical Server Requirements</h4></div></div></div><p>There are several things to keep in mind when choosing a
	  machine to use as a <acronym class="acronym">NIS</acronym> server.  Since
	  <acronym class="acronym">NIS</acronym> clients depend upon the availability
	  of the server, choose a machine that is not rebooted
	  frequently.  The <acronym class="acronym">NIS</acronym> server should
	  ideally be a stand alone machine whose sole purpose is to be
	  an <acronym class="acronym">NIS</acronym> server.  If the network is not
	  heavily used, it is acceptable to put the
	  <acronym class="acronym">NIS</acronym> server on a machine running other
	  services.  However, if the <acronym class="acronym">NIS</acronym> server
	  becomes unavailable, it will adversely affect all
	  <acronym class="acronym">NIS</acronym> clients.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68054648"></a>29.4.4. Configuring the <acronym class="acronym">NIS</acronym> Master
	Server</h3></div></div></div><p>The canonical copies of all <acronym class="acronym">NIS</acronym> files
	are stored on the master server.  The databases used to store
	the information are called <acronym class="acronym">NIS</acronym> maps.  In
	FreeBSD, these maps are stored in
	<code class="filename">/var/yp/[domainname]</code> where
	<code class="filename">[domainname]</code> is the name of the
	<acronym class="acronym">NIS</acronym> domain.  Since multiple domains are
	supported, it is possible to have several directories, one for
	each domain.  Each domain will have its own independent set of
	maps.</p><p><acronym class="acronym">NIS</acronym> master and slave servers handle all
	<acronym class="acronym">NIS</acronym> requests through <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a>.  This
	daemon is responsible for receiving incoming requests from
	<acronym class="acronym">NIS</acronym> clients, translating the requested
	domain and map name to a path to the corresponding database
	file, and transmitting data from the database back to the
	client.</p><a id="idp68060152" class="indexterm"></a><p>Setting up a master <acronym class="acronym">NIS</acronym> server can be
	relatively straight forward, depending on environmental needs.
	Since FreeBSD provides built-in <acronym class="acronym">NIS</acronym> support,
	it only needs to be enabled by adding the following lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">nisdomainname="<em class="replaceable"><code>test-domain</code></em>"	<a id="network-nis-co-domainname"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
nis_server_enable="YES"		<a id="network-nis-co-server"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
nis_yppasswdd_enable="YES"	<a id="network-nis-co-yppasswdd"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#network-nis-co-domainname"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This line sets the <acronym class="acronym">NIS</acronym> domain name
	    to <code class="literal">test-domain</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#network-nis-co-server"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This automates the start up of the
	    <acronym class="acronym">NIS</acronym> server processes when the system
	    boots.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#network-nis-co-yppasswdd"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This enables the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rpc.yppasswdd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rpc.yppasswdd</span>(8)</span></a> daemon so that
	    users can change their <acronym class="acronym">NIS</acronym> password
	    from a client machine.</p></td></tr></table></div><p>Care must be taken in a multi-server domain where the
	server machines are also <acronym class="acronym">NIS</acronym> clients.  It
	is generally a good idea to force the servers to bind to
	themselves rather than allowing them to broadcast bind
	requests and possibly become bound to each other.  Strange
	failure modes can result if one server goes down and others
	are dependent upon it.  Eventually, all the clients will time
	out and attempt to bind to other servers, but the delay
	involved can be considerable and the failure mode is still
	present since the servers might bind to each other all over
	again.</p><p>A server that is also a client can be forced to bind to a
	particular server by adding these additional lines to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">nis_client_enable="YES"				<a id="network-nis-co-client"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
nis_client_flags="-S <em class="replaceable"><code>test-domain</code></em>,<em class="replaceable"><code>server</code></em>"	<a id="network-nis-co-clientflags"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#network-nis-co-client"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This enables running client stuff as well.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#network-nis-co-clientflags"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This line sets the <acronym class="acronym">NIS</acronym> domain name
	    to <code class="literal">test-domain</code> and bind to itself.</p></td></tr></table></div><p>After saving the edits, type
	<code class="command">/etc/netstart</code> to restart the network and
	apply the values defined in <code class="filename">/etc/rc.conf</code>.
	Before initializing the <acronym class="acronym">NIS</acronym> maps, start
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service ypserv start</code></strong></pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68087800"></a>29.4.4.1. Initializing the <acronym class="acronym">NIS</acronym> Maps</h4></div></div></div><a id="idp68088824" class="indexterm"></a><p><acronym class="acronym">NIS</acronym> maps are generated from the
	  configuration files in <code class="filename">/etc</code> on the
	  <acronym class="acronym">NIS</acronym> master, with one exception:
	  <code class="filename">/etc/master.passwd</code>.  This is to prevent
	  the propagation of passwords to all the servers in the
	  <acronym class="acronym">NIS</acronym> domain.  Therefore, before the
	  <acronym class="acronym">NIS</acronym> maps are initialized, configure the
	  primary password files:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /etc/master.passwd /var/yp/master.passwd</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi master.passwd</code></strong></pre><p>It is advisable to remove all entries for system
	  accounts as well as any user accounts that do not need to be
	  propagated to the <acronym class="acronym">NIS</acronym> clients, such as
	  the <code class="systemitem">root</code> and any
	  other administrative accounts.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ensure that the
	    <code class="filename">/var/yp/master.passwd</code> is neither
	    group or world readable by setting its permissions to
	    <code class="literal">600</code>.</p></div><p>After completing this task, initialize the
	  <acronym class="acronym">NIS</acronym> maps.  FreeBSD includes the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypinit&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypinit</span>(8)</span></a> script to do this.  When generating maps
	  for the master server, include <code class="option">-m</code> and
	  specify the <acronym class="acronym">NIS</acronym> domain name:</p><pre class="screen">ellington<code class="prompt">#</code> <strong class="userinput"><code>ypinit -m test-domain</code></strong>
Server Type: MASTER Domain: test-domain
Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.
Do you want this procedure to quit on non-fatal errors? [y/n: n] <strong class="userinput"><code>n</code></strong>
Ok, please remember to go back and redo manually whatever fails.
If not, something might not work.
At this point, we have to construct a list of this domains YP servers.
rod.darktech.org is already known as master server.
Please continue to add any slave servers, one per line. When you are
done with the list, type a &lt;control D&gt;.
master server   :  ellington
next host to add:  <strong class="userinput"><code>coltrane</code></strong>
next host to add:  <strong class="userinput"><code>^D</code></strong>
The current list of NIS servers looks like this:
ellington
coltrane
Is this correct?  [y/n: y] <strong class="userinput"><code>y</code></strong>

[..output from map generation..]

NIS Map update completed.
ellington has been setup as an YP master server without any errors.</pre><p>This will create <code class="filename">/var/yp/Makefile</code>
	  from <code class="filename">/var/yp/Makefile.dist</code>.  By
	  default, this file assumes that the environment has a
	  single <acronym class="acronym">NIS</acronym> server with only FreeBSD clients.
	  Since <code class="literal">test-domain</code> has a slave server,
	  edit this line in <code class="filename">/var/yp/Makefile</code> so
	  that it begins with a  comment
	  (<code class="literal">#</code>):</p><pre class="programlisting">NOPUSH = "True"</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68130552"></a>29.4.4.2. Adding New Users</h4></div></div></div><p>Every time a new user is created, the user account must
	  be added to the master <acronym class="acronym">NIS</acronym> server and the
	  <acronym class="acronym">NIS</acronym> maps rebuilt.  Until this occurs, the
	  new user will not be able to login anywhere except on the
	  <acronym class="acronym">NIS</acronym> master.  For example, to add the new
	  user <code class="systemitem">jsmith</code> to the
	  <code class="literal">test-domain</code> domain, run these commands on
	  the master server:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw useradd jsmith</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make test-domain</code></strong></pre><p>The user could also be added using <code class="command">adduser
	    jsmith</code> instead of <code class="command">pw useradd
	    smith</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68141560"></a>29.4.5. Setting up a <acronym class="acronym">NIS</acronym> Slave Server</h3></div></div></div><a id="idp68142584" class="indexterm"></a><p>To set up an <acronym class="acronym">NIS</acronym> slave server, log on
	to the slave server and edit <code class="filename">/etc/rc.conf</code>
	as for the master server.  Do not generate any
	<acronym class="acronym">NIS</acronym> maps, as these already exist on the
	master server.  When running <code class="command">ypinit</code> on the
	slave server, use <code class="option">-s</code> (for slave) instead of
	<code class="option">-m</code> (for master).  This option requires the
	name of the <acronym class="acronym">NIS</acronym> master in addition to the
	domain name, as  seen in this example:</p><pre class="screen">coltrane<code class="prompt">#</code> <strong class="userinput"><code>ypinit -s ellington test-domain</code></strong>

Server Type: SLAVE Domain: test-domain Master: ellington

Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.

Do you want this procedure to quit on non-fatal errors? [y/n: n]  <strong class="userinput"><code>n</code></strong>

Ok, please remember to go back and redo manually whatever fails.
If not, something might not work.
There will be no further questions. The remainder of the procedure
should take a few minutes, to copy the databases from ellington.
Transferring netgroup...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byuser...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byhost...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring group.bygid...
ypxfr: Exiting: Map successfully transferred
Transferring group.byname...
ypxfr: Exiting: Map successfully transferred
Transferring services.byname...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.byname...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.byname...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring netid.byname...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring ypservers...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byname...
ypxfr: Exiting: Map successfully transferred

coltrane has been setup as an YP slave server without any errors.
Remember to update map ypservers on ellington.</pre><p>This will generate a directory on the slave server called
	<code class="filename">/var/yp/test-domain</code> which contains copies
	of the <acronym class="acronym">NIS</acronym> master server's maps.  Adding
	these <code class="filename">/etc/crontab</code> entries on each slave
	server will force the slaves to sync their maps with the maps
	on the master server:</p><pre class="programlisting">20      *       *       *       *       root   /usr/libexec/ypxfr passwd.byname
21      *       *       *       *       root   /usr/libexec/ypxfr passwd.byuid</pre><p>These entries are not mandatory because the master server
	automatically attempts to push any map changes to its slaves.
	However, since clients may depend upon the slave server to
	provide correct password information, it is recommended to
	force frequent password map updates.  This is especially
	important on busy networks where map updates might not always
	complete.</p><p>To finish the configuration, run
	<code class="command">/etc/netstart</code> on the slave server in order
	to start the <acronym class="acronym">NIS</acronym> services.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68151928"></a>29.4.6. Setting Up an <acronym class="acronym">NIS</acronym> Client</h3></div></div></div><p>An <acronym class="acronym">NIS</acronym> client binds to an
	<acronym class="acronym">NIS</acronym> server using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypbind</span>(8)</span></a>.  This
	daemon broadcasts RPC requests on the local network.  These
	requests specify the domain name configured on the client.  If
	an <acronym class="acronym">NIS</acronym> server in the same domain receives
	one of the broadcasts, it will respond to
	<span class="application">ypbind</span>, which will record the
	server's address.  If there are several servers available,
	the client will use the address of the first server to respond
	and will direct all of its <acronym class="acronym">NIS</acronym> requests to
	that server.  The client will automatically
	<span class="application">ping</span> the server on a regular basis
	to make sure it is still available.  If it fails to receive a
	reply within a reasonable amount of time,
	<span class="application">ypbind</span> will mark the domain as
	unbound and begin broadcasting again in the hopes of locating
	another server.</p><a id="idp68173176" class="indexterm"></a><p>To configure a FreeBSD machine to be an
	<acronym class="acronym">NIS</acronym> client:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Edit <code class="filename">/etc/rc.conf</code> and add the
	    following lines in order to set the
	    <acronym class="acronym">NIS</acronym> domain name and start
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypbind&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypbind</span>(8)</span></a> during network startup:</p><pre class="programlisting">nisdomainname="test-domain"
nis_client_enable="YES"</pre></li><li class="step"><p>To import all possible password entries from the
	    <acronym class="acronym">NIS</acronym> server, use
	    <code class="command">vipw</code> to remove all user accounts
	    except one from <code class="filename">/etc/master.passwd</code>.
	    When removing the accounts, keep in mind that at least one
	    local account should remain and this account should be a
	    member of <code class="systemitem">wheel</code>.  If there is a
	    problem with <acronym class="acronym">NIS</acronym>, this local account
	    can be used to log in remotely, become the superuser, and
	    fix the problem.  Before saving the edits, add the
	    following line to the end of the file:</p><pre class="programlisting">+:::::::::</pre><p>This line configures the client to provide anyone with
	    a valid account in the <acronym class="acronym">NIS</acronym> server's
	    password maps an account on the client.  There are many
	    ways to configure the <acronym class="acronym">NIS</acronym> client by
	    modifying this line.  One method is described in <a class="xref" href="#network-netgroups" title="29.4.8. Using Netgroups">Section 29.4.8, &#8220;Using Netgroups&#8221;</a>.  For more detailed
	    reading, refer to the book
	    <code class="literal">Managing NFS and NIS</code>, published by
	    O'Reilly Media.</p></li><li class="step"><p>To import all possible group entries from the
	    <acronym class="acronym">NIS</acronym> server, add this line to
	    <code class="filename">/etc/group</code>:</p><pre class="programlisting">+:*::</pre></li></ol></div><p>To start the <acronym class="acronym">NIS</acronym> client immediately,
	execute the following commands as the superuser:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/netstart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service ypbind start</code></strong></pre><p>After completing these steps, running
	<code class="command">ypcat passwd</code> on the client should show
	the server's <code class="filename">passwd</code> map.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68221560"></a>29.4.7. <acronym class="acronym">NIS</acronym> Security</h3></div></div></div><p>Since <acronym class="acronym">RPC</acronym> is a broadcast-based service,
	any system running <span class="application">ypbind</span> within
	the same domain can retrieve the contents of the
	<acronym class="acronym">NIS</acronym> maps.  To prevent unauthorized
	transactions, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> supports a feature called
	<span class="quote">&#8220;<span class="quote">securenets</span>&#8221;</span> which can be used to restrict access
	to a given set of hosts.  By default, this information is
	stored in <code class="filename">/var/yp/securenets</code>, unless
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> is started with <code class="option">-p</code> and an
	alternate path.  This file contains entries that consist of a
	network specification and a network mask separated by white
	space.  Lines starting with <code class="literal">#</code> are
	considered to be comments.  A sample
	<code class="filename">securenets</code> might look like this:</p><pre class="programlisting"># allow connections from local host -- mandatory
127.0.0.1     255.255.255.255
# allow connections from any host
# on the 192.168.128.0 network
192.168.128.0 255.255.255.0
# allow connections from any host
# between 10.0.0.0 to 10.0.15.255
# this includes the machines in the testlab
10.0.0.0      255.255.240.0</pre><p>If <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> receives a request from an address that
	matches one of these rules, it will process the request
	normally.  If the address fails to match a rule, the request
	will be ignored and a warning message will be logged.  If the
	<code class="filename">securenets</code> does not exist,
	<code class="command">ypserv</code> will allow connections from any
	host.</p><p><a class="xref" href="#tcpwrappers" title="13.4. TCP Wrapper">Section 13.4, &#8220;TCP Wrapper&#8221;</a> is an alternate mechanism
	for providing access control instead of
	<code class="filename">securenets</code>.  While either access control
	mechanism adds some security, they are both vulnerable to
	<span class="quote">&#8220;<span class="quote"><acronym class="acronym">IP</acronym> spoofing</span>&#8221;</span> attacks.  All
	<acronym class="acronym">NIS</acronym>-related traffic should be blocked at
	the firewall.</p><p>Servers using <code class="filename">securenets</code>
	may fail to serve legitimate <acronym class="acronym">NIS</acronym> clients
	with archaic TCP/IP implementations.  Some of these
	implementations set all host bits to zero when doing
	broadcasts or fail to observe the subnet mask when
	calculating the broadcast address.  While some of these
	problems can be fixed by changing the client configuration,
	other problems may force the retirement of these client
	systems or the abandonment of
	<code class="filename">securenets</code>.</p><a id="idp68233336" class="indexterm"></a><p>The use of <span class="application">TCP Wrapper</span>
	increases the latency of the <acronym class="acronym">NIS</acronym> server.
	The additional delay may be long enough to cause timeouts in
	client programs, especially in busy networks with slow
	<acronym class="acronym">NIS</acronym> servers.  If one or more clients suffer
	from latency, convert those clients into
	<acronym class="acronym">NIS</acronym> slave servers and force them to bind to
	themselves.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68239864"></a>29.4.7.1. Barring Some Users</h4></div></div></div><p>In this example, the <code class="systemitem">basie</code>
	  system is a faculty workstation within the
	  <acronym class="acronym">NIS</acronym> domain.  The
	  <code class="filename">passwd</code> map on the master
	  <acronym class="acronym">NIS</acronym> server contains accounts for both
	  faculty and students.  This section demonstrates how to
	  allow faculty logins on this system while refusing student
	  logins.</p><p>To prevent specified users from logging on to a system,
	  even if they are present in the <acronym class="acronym">NIS</acronym>
	  database, use <code class="command">vipw</code> to add
	  <code class="literal">-<em class="replaceable"><code>username</code></em></code> with
	  the correct number of colons towards the end of
	  <code class="filename">/etc/master.passwd</code> on the client,
	  where <em class="replaceable"><code>username</code></em> is the username of
	  a user to bar from logging in.  The line with the blocked
	  user must be before the <code class="literal">+</code> line that
	  allows <acronym class="acronym">NIS</acronym> users.  In this example,
	  <code class="systemitem">bill</code> is barred
	  from logging on to <code class="systemitem">basie</code>:</p><pre class="screen">basie<code class="prompt">#</code> <strong class="userinput"><code>cat /etc/master.passwd</code></strong>
root:[password]:0:0::0:0:The super-user:/root:/bin/csh
toor:[password]:0:0::0:0:The other super-user:/root:/bin/sh
daemon:*:1:1::0:0:Owner of many system processes:/root:/usr/sbin/nologin
operator:*:2:5::0:0:System &amp;:/:/usr/sbin/nologin
bin:*:3:7::0:0:Binaries Commands and Source,,,:/:/usr/sbin/nologin
tty:*:4:65533::0:0:Tty Sandbox:/:/usr/sbin/nologin
kmem:*:5:65533::0:0:KMem Sandbox:/:/usr/sbin/nologin
games:*:7:13::0:0:Games pseudo-user:/usr/games:/usr/sbin/nologin
news:*:8:8::0:0:News Subsystem:/:/usr/sbin/nologin
man:*:9:9::0:0:Mister Man Pages:/usr/share/man:/usr/sbin/nologin
bind:*:53:53::0:0:Bind Sandbox:/:/usr/sbin/nologin
uucp:*:66:66::0:0:UUCP pseudo-user:/var/spool/uucppublic:/usr/libexec/uucp/uucico
xten:*:67:67::0:0:X-10 daemon:/usr/local/xten:/usr/sbin/nologin
pop:*:68:6::0:0:Post Office Owner:/nonexistent:/usr/sbin/nologin
nobody:*:65534:65534::0:0:Unprivileged user:/nonexistent:/usr/sbin/nologin
-bill:::::::::
+:::::::::

basie<code class="prompt">#</code></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-netgroups"></a>29.4.8. Using Netgroups</h3></div></div></div><a id="idp68249336" class="indexterm"></a><p>Barring specified users from logging on to individual
	systems becomes unscaleable on larger networks and quickly
	loses the main benefit of <acronym class="acronym">NIS</acronym>:
	<span class="emphasis"><em>centralized</em></span> administration.</p><p>Netgroups were developed to handle large, complex networks
	with hundreds of users and machines.  Their use is comparable
	to <span class="trademark">UNIX</span>® groups, where the main difference is the lack of a
	numeric ID and the ability to define a netgroup by including
	both user accounts and other netgroups.</p><p>To expand on the example used in this chapter, the
	<acronym class="acronym">NIS</acronym> domain will be extended to add the
	users and systems shown in Tables 28.2 and 28.3:</p><div class="table"><a id="idp68256888"></a><div class="table-title">Table 29.2. Additional Users</div><div class="table-contents"><table class="table" summary="Additional Users" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>User Name(s)</th><th>Description</th></tr></thead><tbody><tr><td><code class="systemitem">alpha</code>,
		<code class="systemitem">beta</code></td><td>IT department employees</td></tr><tr><td><code class="systemitem">charlie</code>, <code class="systemitem">delta</code></td><td>IT department apprentices</td></tr><tr><td><code class="systemitem">echo</code>,
		<code class="systemitem">foxtrott</code>,
		<code class="systemitem">golf</code>,
		...</td><td>employees</td></tr><tr><td><code class="systemitem">able</code>,
		<code class="systemitem">baker</code>,
		...</td><td>interns</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp68268792"></a><div class="table-title">Table 29.3. Additional Systems</div><div class="table-contents"><table class="table" summary="Additional Systems" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Machine Name(s)</th><th>Description</th></tr></thead><tbody><tr><td><code class="systemitem">war</code>,
		<code class="systemitem">death</code>,
		<code class="systemitem">famine</code>,
		<code class="systemitem">pollution</code></td><td>Only IT employees are allowed to log onto these
		servers.</td></tr><tr><td><code class="systemitem">pride</code>,
		<code class="systemitem">greed</code>,
		<code class="systemitem">envy</code>,
		<code class="systemitem">wrath</code>,
		<code class="systemitem">lust</code>,
		<code class="systemitem">sloth</code></td><td>All members of the IT department are allowed to
		login onto these servers.</td></tr><tr><td><code class="systemitem">one</code>,
		<code class="systemitem">two</code>,
		<code class="systemitem">three</code>,
		<code class="systemitem">four</code>,
		...</td><td>Ordinary workstations used by
		employees.</td></tr><tr><td><code class="systemitem">trashcan</code></td><td>A very old machine without any critical data.
		Even interns are allowed to use this system.</td></tr></tbody></table></div></div><br class="table-break" /><p>When using netgroups to configure this scenario, each user
	is assigned to one or more netgroups and logins are then
	allowed or forbidden for all members of the netgroup.  When
	adding a new machine, login restrictions must be defined for
	all netgroups.  When a new user is added, the account must be
	added to one or more netgroups.  If the
	<acronym class="acronym">NIS</acronym> setup is planned carefully, only one
	central configuration file needs modification to grant or deny
	access to machines.</p><p>The first step is the initialization of the
	<acronym class="acronym">NIS</acronym> <code class="literal">netgroup</code> map.  In
	FreeBSD, this map is not created by default.  On the
	<acronym class="acronym">NIS</acronym> master server, use an editor to create
	a map named <code class="filename">/var/yp/netgroup</code>.</p><p>This example creates four netgroups to represent IT
	employees, IT apprentices, employees, and interns:</p><pre class="programlisting">IT_EMP  (,alpha,test-domain)    (,beta,test-domain)
IT_APP  (,charlie,test-domain)  (,delta,test-domain)
USERS   (,echo,test-domain)     (,foxtrott,test-domain) \
        (,golf,test-domain)
INTERNS (,able,test-domain)     (,baker,test-domain)</pre><p>Each entry configures a netgroup.  The first column in an
	entry is the name of the netgroup.  Each set of brackets
	represents  either a group of one or more users or the name of
	another netgroup.  When specifying a user, the three
	comma-delimited fields inside each group represent:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The name of the host(s) where the other fields
	    representing the user are valid.  If a hostname is not
	    specified, the entry is valid on all hosts.</p></li><li class="listitem"><p>The name of the account that belongs to this
	    netgroup.</p></li><li class="listitem"><p>The <acronym class="acronym">NIS</acronym> domain for the account.
	    Accounts may be imported from other <acronym class="acronym">NIS</acronym>
	    domains into a netgroup.</p></li></ol></div><p>If a group contains multiple users, separate each user
	with  whitespace.  Additionally, each field may contain
	wildcards.  See <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=netgroup&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">netgroup</span>(5)</span></a> for details.</p><a id="idp68311288" class="indexterm"></a><p>Netgroup names longer than 8 characters should not be
	used.  The names are case sensitive and using capital letters
	for netgroup names is an easy way to distinguish between user,
	machine and netgroup names.</p><p>Some non-FreeBSD <acronym class="acronym">NIS</acronym> clients cannot
	handle netgroups containing more than 15 entries.  This
	limit may be circumvented by creating several sub-netgroups
	with 15 users or fewer and a real netgroup consisting of the
	sub-netgroups, as seen in this example:</p><pre class="programlisting">BIGGRP1  (,joe1,domain)  (,joe2,domain)  (,joe3,domain) [...]
BIGGRP2  (,joe16,domain)  (,joe17,domain) [...]
BIGGRP3  (,joe31,domain)  (,joe32,domain)
BIGGROUP  BIGGRP1 BIGGRP2 BIGGRP3</pre><p>Repeat this process if more than 225 (15 times 15) users
	exist within a single netgroup.</p><p>To activate and distribute the new
	<acronym class="acronym">NIS</acronym> map:</p><pre class="screen">ellington<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
ellington<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong></pre><p>This will generate the three <acronym class="acronym">NIS</acronym> maps
	<code class="filename">netgroup</code>,
	<code class="filename">netgroup.byhost</code> and
	<code class="filename">netgroup.byuser</code>.  Use the map key option
	of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ypcat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ypcat</span>(1)</span></a> to check if the new <acronym class="acronym">NIS</acronym>
	maps are available:</p><pre class="screen">ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup</code></strong>
ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup.byhost</code></strong>
ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup.byuser</code></strong></pre><p>The output of the first command should resemble the
	contents of <code class="filename">/var/yp/netgroup</code>.  The second
	command only produces output if host-specific netgroups were
	created.  The third command is used to get the list of
	netgroups for a user.</p><p>To configure a client, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vipw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vipw</span>(8)</span></a> to specify the
	name  of the netgroup.  For example, on the server named
	<code class="systemitem">war</code>,  replace this line:</p><pre class="programlisting">+:::::::::</pre><p>with</p><pre class="programlisting">+@IT_EMP:::::::::</pre><p>This specifies that only the users defined in the netgroup
	<code class="literal">IT_EMP</code> will be imported into this system's
	password database and only those users are allowed to login to
	this system.</p><p>This configuration also applies to the
	<code class="literal">~</code> function of the shell and all routines
	which convert between user names and numerical user IDs.  In
	other words,
	<code class="command">cd ~<em class="replaceable"><code>user</code></em></code> will
	not work, <code class="command">ls -l</code> will show the numerical ID
	instead of the username, and <code class="command">find . -user joe
	  -print</code> will fail with the message
	<span class="errorname">No such user</span>.  To fix this, import all
	user entries without allowing them to login into the servers.
	This can be achieved by adding an extra line:</p><pre class="programlisting">+:::::::::/usr/sbin/nologin</pre><p>This line configures the client to import all entries but
	to replace the shell in those entries with
	<code class="filename">/usr/sbin/nologin</code>.</p><p>Make sure that extra line is placed
	<span class="emphasis"><em>after</em></span>
	<code class="literal">+@IT_EMP:::::::::</code>.  Otherwise, all user
	accounts imported from <acronym class="acronym">NIS</acronym> will have
	<code class="filename">/usr/sbin/nologin</code> as their login
	shell and no one will be able to login to the system.</p><p>To configure the less important servers, replace the old
	<code class="literal">+:::::::::</code> on the servers with these
	lines:</p><pre class="programlisting">+@IT_EMP:::::::::
+@IT_APP:::::::::
+:::::::::/usr/sbin/nologin</pre><p>The corresponding lines for the workstations
	would be:</p><pre class="programlisting">+@IT_EMP:::::::::
+@USERS:::::::::
+:::::::::/usr/sbin/nologin</pre><p>NIS supports the creation of netgroups from other
	netgroups which can be useful if the policy regarding user
	access changes.  One possibility is the creation of role-based
	netgroups.  For example, one might create a netgroup called
	<code class="literal">BIGSRV</code> to define the login restrictions for
	the important servers, another netgroup called
	<code class="literal">SMALLSRV</code> for the less important servers,
	and a third netgroup called <code class="literal">USERBOX</code> for the
	workstations.  Each of these netgroups contains the netgroups
	that are allowed to login onto these machines.  The new
	entries for the <acronym class="acronym">NIS</acronym>
	<code class="literal">netgroup</code> map would look like this:</p><pre class="programlisting">BIGSRV    IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP  ITINTERN
USERBOX   IT_EMP  ITINTERN USERS</pre><p>This method of defining login restrictions works
	reasonably well when it is possible to define groups of
	machines with identical restrictions.  Unfortunately, this is
	the exception and not the rule.  Most of the time, the ability
	to define login restrictions on a per-machine basis is
	required.</p><p>Machine-specific netgroup definitions are another
	possibility to deal with the policy changes.  In this
	scenario, the <code class="filename">/etc/master.passwd</code> of each
	system contains two lines starting with <span class="quote">&#8220;<span class="quote">+</span>&#8221;</span>.
	The first line adds a netgroup with the accounts allowed to
	login onto this machine and the second line adds all other
	accounts with <code class="filename">/usr/sbin/nologin</code> as shell.
	It is recommended to use the <span class="quote">&#8220;<span class="quote">ALL-CAPS</span>&#8221;</span> version
	of the hostname as the name of the netgroup:</p><pre class="programlisting">+@<em class="replaceable"><code>BOXNAME</code></em>:::::::::
+:::::::::/usr/sbin/nologin</pre><p>Once this task is completed on all the machines, there is
	no longer a need to modify the local versions of
	<code class="filename">/etc/master.passwd</code> ever again.  All
	further changes can be handled by modifying the
	<acronym class="acronym">NIS</acronym> map.  Here is an example of a possible
	<code class="literal">netgroup</code> map for this scenario:</p><pre class="programlisting"># Define groups of users first
IT_EMP    (,alpha,test-domain)    (,beta,test-domain)
IT_APP    (,charlie,test-domain)  (,delta,test-domain)
DEPT1     (,echo,test-domain)     (,foxtrott,test-domain)
DEPT2     (,golf,test-domain)     (,hotel,test-domain)
DEPT3     (,india,test-domain)    (,juliet,test-domain)
ITINTERN  (,kilo,test-domain)     (,lima,test-domain)
D_INTERNS (,able,test-domain)     (,baker,test-domain)
#
# Now, define some groups based on roles
USERS     DEPT1   DEPT2     DEPT3
BIGSRV    IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP    ITINTERN
USERBOX   IT_EMP  ITINTERN  USERS
#
# And a groups for a special tasks
# Allow echo and golf to access our anti-virus-machine
SECURITY  IT_EMP  (,echo,test-domain)  (,golf,test-domain)
#
# machine-based netgroups
# Our main servers
WAR       BIGSRV
FAMINE    BIGSRV
# User india needs access to this server
POLLUTION  BIGSRV  (,india,test-domain)
#
# This one is really important and needs more access restrictions
DEATH     IT_EMP
#
# The anti-virus-machine mentioned above
ONE       SECURITY
#
# Restrict a machine to a single user
TWO       (,hotel,test-domain)
# [...more groups to follow]</pre><p>It may not always be advisable
	to use machine-based netgroups.  When deploying a couple of
	dozen or hundreds of systems,
	role-based netgroups instead of machine-based netgroups may be
	used to keep the size of the <acronym class="acronym">NIS</acronym> map within
	reasonable limits.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68351096"></a>29.4.9. Password Formats</h3></div></div></div><a id="idp68351736" class="indexterm"></a><p><acronym class="acronym">NIS</acronym> requires that all hosts within an
	<acronym class="acronym">NIS</acronym> domain use the same format for
	encrypting passwords.  If users have trouble authenticating on
	an <acronym class="acronym">NIS</acronym> client, it may be due to a differing
	password format.  In a heterogeneous network, the format must
	be supported by all operating systems, where
	<acronym class="acronym">DES</acronym> is the lowest common standard.</p><p>To check which format a server or client is using, look
	at this section of
	<code class="filename">/etc/login.conf</code>:</p><pre class="programlisting">default:\
	:passwd_format=des:\
	:copyright=/etc/COPYRIGHT:\
	[Further entries elided]</pre><p>In this example, the system is using the
	<acronym class="acronym">DES</acronym> format.  Other possible values are
	<code class="literal">blf</code> for Blowfish and <code class="literal">md5</code>
	for MD5 encrypted passwords.</p><p>If the format on a host needs to be edited to match the
	one  being used in the <acronym class="acronym">NIS</acronym> domain, the
	login capability database must be rebuilt after saving the
	change:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The format of passwords for existing user accounts will
	  not be updated until each user changes their password
	  <span class="emphasis"><em>after</em></span> the login capability database is
	  rebuilt.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ldap"></a>29.5. Lightweight Directory Access Protocol
	(<acronym class="acronym">LDAP</acronym>)</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Updates by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Rocky</span> <span class="surname">Hotas</span></span>. </span></div></div></div><a id="idp68383096" class="indexterm"></a><p>The Lightweight Directory Access Protocol
      (<acronym class="acronym">LDAP</acronym>) is an application layer protocol used
      to access, modify, and authenticate objects using a distributed
      directory information service.  Think of it as a phone or record
      book which stores several levels of hierarchical, homogeneous
      information.  It is used in Active Directory and
      <span class="application">OpenLDAP</span> networks and allows users to
      access to several levels of internal information utilizing a
      single account.  For example, email authentication, pulling
      employee contact information, and internal website
      authentication might all make use of a single user account in
      the <acronym class="acronym">LDAP</acronym> server's record base.</p><p>This section provides a quick start guide for configuring an
      <acronym class="acronym">LDAP</acronym> server on a FreeBSD system.  It assumes
      that the administrator already has a design plan which includes
      the type of information to store, what that information will be
      used for, which users should have access to that information,
      and how to secure this information from unauthorized
      access.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68385912"></a>29.5.1. <acronym class="acronym">LDAP</acronym> Terminology and Structure</h3></div></div></div><p><acronym class="acronym">LDAP</acronym> uses several terms which should be
	understood before starting the configuration.  All directory
	entries consist of a group of
	<em class="firstterm">attributes</em>.  Each of these attribute
	sets contains a unique identifier known as a
	<em class="firstterm">Distinguished Name</em>
	(<acronym class="acronym">DN</acronym>) which is normally built from several
	other attributes such as the common or
	<em class="firstterm">Relative Distinguished Name</em>
	(<acronym class="acronym">RDN</acronym>).  Similar to how directories have
	absolute and relative paths, consider a <acronym class="acronym">DN</acronym>
	as an absolute path and the <acronym class="acronym">RDN</acronym> as the
	relative path.</p><p>An example <acronym class="acronym">LDAP</acronym> entry looks like the
	following.  This example searches for the entry for the
	specified user account (<code class="literal">uid</code>),
	organizational unit (<code class="literal">ou</code>), and organization
	(<code class="literal">o</code>):</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ldapsearch -xb "uid=<em class="replaceable"><code>trhodes</code></em>,ou=<em class="replaceable"><code>users</code></em>,o=<em class="replaceable"><code>example.com</code></em>"</code></strong>
# extended LDIF
#
# LDAPv3
# base &lt;uid=trhodes,ou=users,o=example.com&gt; with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# trhodes, users, example.com
dn: uid=trhodes,ou=users,o=example.com
mail: trhodes@example.com
cn: Tom Rhodes
uid: trhodes
telephoneNumber: (123) 456-7890

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1</pre><p>This example entry shows the values for the
	<code class="literal">dn</code>, <code class="literal">mail</code>,
	<code class="literal">cn</code>, <code class="literal">uid</code>, and
	<code class="literal">telephoneNumber</code> attributes.  The
	<acronym class="acronym">cn</acronym> attribute is the
	<acronym class="acronym">RDN</acronym>.</p><p>More information about <acronym class="acronym">LDAP</acronym> and its
	terminology can be found at <code class="uri"><a class="uri" href="http://www.openldap.org/doc/admin24/intro.html" target="_top">http://www.openldap.org/doc/admin24/intro.html</a></code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ldap-config"></a>29.5.2. Configuring an <acronym class="acronym">LDAP</acronym> Server</h3></div></div></div><a id="idp68403960" class="indexterm"></a><p>FreeBSD does not provide a built-in <acronym class="acronym">LDAP</acronym>
	server.  Begin the configuration by installing <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/openldap-server/pkg-descr">net/openldap-server</a> package or
	port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install openldap-server</code></strong></pre><p>There is a large set of default options enabled in the
	<a class="link" href="../../../../doc/en_US.ISO8859-1/articles/linux-users/software.html" target="_top">
	  package</a>.  Review them by running
	<code class="command">pkg info openldap-server</code>.  If they are not
	sufficient (for example if SQL support is needed), please
	consider recompiling the port using the appropriate <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/ports-using.html" target="_top">framework</a>.</p><p>The installation creates the directory
	<code class="filename">/var/db/openldap-data</code> to hold the data.
	The directory to store the certificates must be
	created:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /usr/local/etc/openldap/private</code></strong></pre><p>The next phase is to configure the Certificate Authority.
	The following commands must be executed from
	<code class="filename">/usr/local/etc/openldap/private</code>.  This is
	important as the file permissions need to be restrictive and
	users should not have access to these files.  More detailed
	information about certificates and their parameters can be
	found in <a class="xref" href="#openssl" title="13.6. OpenSSL">Section 13.6, &#8220;OpenSSL&#8221;</a>.  To create the
	Certificate Authority, start with this command and follow the
	prompts:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -days <em class="replaceable"><code>365</code></em> -nodes -new -x509 -keyout ca.key -out ../ca.crt</code></strong></pre><p>The entries for the prompts may be generic
	<span class="emphasis"><em>except</em></span> for the
	<code class="literal">Common Name</code>.  This entry must be
	<span class="emphasis"><em>different</em></span> than the system hostname.  If
	this will be a self signed certificate, prefix the hostname
	with <code class="literal">CA</code> for Certificate Authority.</p><p>The next task is to create a certificate signing request
	and a private key.  Input this command and follow the
	prompts:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -days <em class="replaceable"><code>365</code></em> -nodes -new -keyout server.key -out server.csr</code></strong></pre><p>During the certificate generation process, be sure to
	correctly set the <code class="literal">Common Name</code> attribute.
	The Certificate Signing Request must be signed with the
	Certificate Authority in order to be used as a valid
	certificate:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl x509 -req -days <em class="replaceable"><code>365</code></em> -in server.csr -out ../server.crt -CA ../ca.crt -CAkey ca.key -CAcreateserial</code></strong></pre><p>The final part of the certificate generation process is to
	generate and sign the client certificates:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -days <em class="replaceable"><code>365</code></em> -nodes -new -keyout client.key -out client.csr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>openssl x509 -req -days 3650 -in client.csr -out ../client.crt -CA ../ca.crt -CAkey ca.key</code></strong></pre><p>Remember to use the same <code class="literal">Common Name</code>
	attribute when prompted.  When finished, ensure that a total
	of eight (8) new files have been generated through the
	proceeding commands.</p><p>The daemon running the OpenLDAP server is
	<code class="filename">slapd</code>.  Its configuration is performed
	through <code class="filename">slapd.ldif</code>: the old
	<code class="filename">slapd.conf</code> has been deprecated by
	OpenLDAP.</p><p><a class="link" href="http://www.openldap.org/doc/admin24/slapdconf2.html" target="_top">Configuration
	  examples</a> for <code class="filename">slapd.ldif</code> are
	available and can also be found in
	<code class="filename">/usr/local/etc/openldap/slapd.ldif.sample</code>.
	Options are documented in slapd-config(5).  Each section
	of <code class="filename">slapd.ldif</code>, like all the other LDAP
	attribute sets, is uniquely identified through a DN.  Be sure
	that no blank lines are left between the
	<code class="literal">dn:</code> statement and the desired end of the
	section.  In the following example, TLS will be used to
	implement a secure channel.  The first section represents the
	global configuration:</p><pre class="programlisting">#
# See slapd-config(5) for details on configuration options.
# This file should NOT be world readable.
#
dn: cn=config
objectClass: olcGlobal
cn: config
#
#
# Define global ACLs to disable default read access.
#
olcArgsFile: /var/run/openldap/slapd.args
olcPidFile: /var/run/openldap/slapd.pid
olcTLSCertificateFile: /usr/local/etc/openldap/server.crt
olcTLSCertificateKeyFile: /usr/local/etc/openldap/private/server.key
olcTLSCACertificateFile: /usr/local/etc/openldap/ca.crt
#olcTLSCipherSuite: HIGH
olcTLSProtocolMin: 3.1
olcTLSVerifyClient: never</pre><p>The Certificate Authority, server certificate and server
	private key files must be specified here.  It is recommended
	to let the clients choose the security cipher and omit option
	<code class="literal">olcTLSCipherSuite</code> (incompatible with TLS
	clients other than <code class="filename">openssl</code>).  Option
	<code class="literal">olcTLSProtocolMin</code> lets the server require a
	minimum security level: it is recommended.  While
	verification is mandatory for the server, it is not for the
	client: <code class="literal">olcTLSVerifyClient: never</code>.</p><p>The second section is about the backend modules and can be
	configured as follows:</p><pre class="programlisting">#
# Load dynamic backend modules:
#
dn: cn=module,cn=config
objectClass: olcModuleList
cn: module
olcModulepath:	/usr/local/libexec/openldap
olcModuleload:	back_mdb.la
#olcModuleload:	back_bdb.la
#olcModuleload:	back_hdb.la
#olcModuleload:	back_ldap.la
#olcModuleload:	back_passwd.la
#olcModuleload:	back_shell.la</pre><p>The third section is devoted to load the needed
	<code class="literal">ldif</code> schemas to be used by the databases:
	they are essential.</p><pre class="programlisting">dn: cn=schema,cn=config
objectClass: olcSchemaConfig
cn: schema

include: file:///usr/local/etc/openldap/schema/core.ldif
include: file:///usr/local/etc/openldap/schema/cosine.ldif
include: file:///usr/local/etc/openldap/schema/inetorgperson.ldif
include: file:///usr/local/etc/openldap/schema/nis.ldif</pre><p>Next, the frontend configuration section:</p><pre class="programlisting"># Frontend settings
#
dn: olcDatabase={-1}frontend,cn=config
objectClass: olcDatabaseConfig
objectClass: olcFrontendConfig
olcDatabase: {-1}frontend
olcAccess: to * by * read
#
# Sample global access control policy:
#	Root DSE: allow anyone to read it
#	Subschema (sub)entry DSE: allow anyone to read it
#	Other DSEs:
#		Allow self write access
#		Allow authenticated users read access
#		Allow anonymous users to authenticate
#
#olcAccess: to dn.base="" by * read
#olcAccess: to dn.base="cn=Subschema" by * read
#olcAccess: to *
#	by self write
#	by users read
#	by anonymous auth
#
# if no access controls are present, the default policy
# allows anyone and everyone to read anything but restricts
# updates to rootdn.  (e.g., "access to * by * read")
#
# rootdn can always read and write EVERYTHING!
#
olcPasswordHash: {SSHA}
# {SSHA} is already the default for olcPasswordHash</pre><p>Another section is devoted to the <span class="emphasis"><em>configuration
	  backend</em></span>, the only way to later access the
	OpenLDAP server configuration is as a global
	super-user.</p><pre class="programlisting">dn: olcDatabase={0}config,cn=config
objectClass: olcDatabaseConfig
olcDatabase: {0}config
olcAccess: to * by * none
olcRootPW: {SSHA}iae+lrQZILpiUdf16Z9KmDmSwT77Dj4U</pre><p>The default administrator username is
	<code class="literal">cn=config</code>.  Type
	<code class="filename">slappasswd</code> in a shell, choose a password
	and use its hash in <code class="literal">olcRootPW</code>.  If this
	option is not specified now, before
	<code class="filename">slapd.ldif</code> is imported, no one will be
	later able to modify the
	<span class="emphasis"><em>global configuration</em></span> section.</p><p>The last section is about the database backend:</p><pre class="programlisting">#######################################################################
# LMDB database definitions
#######################################################################
#
dn: olcDatabase=mdb,cn=config
objectClass: olcDatabaseConfig
objectClass: olcMdbConfig
olcDatabase: mdb
olcDbMaxSize: 1073741824
olcSuffix: dc=domain,dc=example
olcRootDN: cn=mdbadmin,dc=domain,dc=example
# Cleartext passwords, especially for the rootdn, should
# be avoided.  See slappasswd(8) and slapd-config(5) for details.
# Use of strong authentication encouraged.
olcRootPW: {SSHA}X2wHvIWDk6G76CQyCMS1vDCvtICWgn0+
# The database directory MUST exist prior to running slapd AND
# should only be accessible by the slapd and slap tools.
# Mode 700 recommended.
olcDbDirectory:	/var/db/openldap-data
# Indices to maintain
olcDbIndex: objectClass eq</pre><p>This database hosts the <span class="emphasis"><em>actual
	  contents</em></span> of the <acronym class="acronym">LDAP</acronym>
	directory.  Types other than <code class="literal">mdb</code> are
	available.  Its super-user, not to be confused with the global
	one, is configured here: a (possibly custom) username in
	<code class="literal">olcRootDN</code> and the password hash in
	<code class="literal">olcRootPW</code>; <code class="filename">slappasswd</code>
	can be used as before.</p><p>This <a class="link" href="http://www.openldap.org/devel/gitweb.cgi?p=openldap.git;a=tree;f=tests/data/regressions/its8444;h=8a5e808e63b0de3d2bdaf2cf34fecca8577ca7fd;hb=HEAD" target="_top">repository</a>
	contains four examples of <code class="filename">slapd.ldif</code>.  To
	convert an existing <code class="filename">slapd.conf</code> into
	<code class="filename">slapd.ldif</code>, refer to <a class="link" href="http://www.openldap.org/doc/admin24/slapdconf2.html" target="_top">this
	  page</a> (please note that this may introduce some
	unuseful options).</p><p>When the configuration is completed,
	<code class="filename">slapd.ldif</code> must be placed in an empty
	directory.  It is recommended to create it as:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /usr/local/etc/openldap/slapd.d/</code></strong></pre><p>Import the configuration database:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/local/sbin/slapadd -n0 -F /usr/local/etc/openldap/slapd.d/ -l /usr/local/etc/openldap/slapd.ldif</code></strong></pre><p>Start the <code class="filename">slapd</code> daemon:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/local/libexec/slapd -F /usr/local/etc/openldap/slapd.d/</code></strong></pre><p>Option <code class="literal">-d</code> can be used for debugging,
	as specified in slapd(8).  To verify that the server is
	running and working:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ldapsearch -x -b '' -s base '(objectclass=*)' namingContexts</code></strong>
# extended LDIF
#
# LDAPv3
# base &lt;&gt; with scope baseObject
# filter: (objectclass=*)
# requesting: namingContexts
#

#
dn:
namingContexts: dc=domain,dc=example

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1</pre><p>The server must still be trusted.  If that has never been
	done before, follow these instructions.  Install the OpenSSL
	package or port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install openssl</code></strong></pre><p>From the directory where <code class="filename">ca.crt</code> is
	stored (in this example,
	<code class="filename">/usr/local/etc/openldap</code>), run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>c_rehash .</code></strong></pre><p>Both the CA and the server certificate are now correctly
	recognized in their respective roles.  To verify this, run
	this command from the <code class="filename">server.crt</code>
	directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl verify -verbose -CApath . server.crt</code></strong></pre><p>If <code class="filename">slapd</code> was running, restart it.  As
	stated in <code class="filename">/usr/local/etc/rc.d/slapd</code>, to
	properly run <code class="filename">slapd</code> at boot the
	following lines must be added to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">lapd_enable="YES"
slapd_flags='-h "ldapi://%2fvar%2frun%2fopenldap%2fldapi/
ldap://0.0.0.0/"'
slapd_sockets="/var/run/openldap/ldapi"
slapd_cn_config="YES"</pre><p><code class="filename">slapd</code> does not provide debugging at
	boot.  Check <code class="filename">/var/log/debug.log</code>,
	<code class="filename">dmesg -a</code> and
	<code class="filename">/var/log/messages</code> for this
	purpose.</p><p>The following example adds the group
	<code class="literal">team</code> and the user <code class="literal">john</code>
	to the <code class="systemitem">domain.example</code>
	<acronym class="acronym">LDAP</acronym> database, which is still empty.
	First, create the file
	<code class="filename">domain.ldif</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat domain.ldif</code></strong>
dn: dc=domain,dc=example
objectClass: dcObject
objectClass: organization
o: domain.example
dc: domain

dn: ou=groups,dc=domain,dc=example
objectClass: top
objectClass: organizationalunit
ou: groups

dn: ou=users,dc=domain,dc=example
objectClass: top
objectClass: organizationalunit
ou: users

dn: cn=team,ou=groups,dc=domain,dc=example
objectClass: top
objectClass: posixGroup
cn: team
gidNumber: 10001

dn: uid=john,ou=users,dc=domain,dc=example
objectClass: top
objectClass: account
objectClass: posixAccount
objectClass: shadowAccount
cn: John McUser
uid: john
uidNumber: 10001
gidNumber: 10001
homeDirectory: /home/john/
loginShell: /usr/bin/bash
userPassword: secret</pre><p>See the OpenLDAP documentation for more details.  Use
	<code class="filename">slappasswd</code> to replace the plain text
	password <code class="literal">secret</code> with a hash in
	<code class="literal">userPassword</code>.  The path specified as
	<code class="literal">loginShell</code> must exist in all the systems
	where <code class="literal">john</code> is allowed to login.  Finally,
	use the <code class="literal">mdb</code> administrator to modify the
	database:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ldapadd -W -D "cn=mdbadmin,dc=domain,dc=example" -f domain.ldif</code></strong></pre><p>Modifications to the <span class="emphasis"><em>global
	  configuration</em></span> section can only be performed by
	the global super-user.  For example, assume that the option
	<code class="literal">olcTLSCipherSuite: HIGH:MEDIUM:SSLv3</code> was
	initially specified and must now be deleted.  First, create a
	file that contains the following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat <em class="replaceable"><code>global_mod</code></em></code></strong>
dn: cn=config
changetype: modify
delete: olcTLSCipherSuite</pre><p>Then, apply the modifications:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ldapmodify -f global_mod -x -D "cn=config" -W</code></strong></pre><p>When asked, provide the password chosen in the
	<span class="emphasis"><em>configuration backend</em></span> section.  The
	username is not required: here, <code class="literal">cn=config</code>
	represents the DN of the database section to be modified.
	Alternatively, use <code class="literal">ldapmodify</code> to delete a
	single line of the database, <code class="literal">ldapdelete</code> to
	delete a whole entry.</p><p>If something goes wrong, or if the global super-user
	cannot access the configuration backend, it is possible to
	delete and re-write the whole configuration:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rm -rf /usr/local/etc/openldap/slapd.d/</code></strong></pre><p><code class="filename">slapd.ldif</code> can then be edited and
	imported again.  Please, follow this procedure only when no
	other solution is available.</p><p>This is the configuration of the server only.  The same
	machine can also host an LDAP client, with its own separate
	configuration.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-dhcp"></a>29.6. Dynamic Host Configuration Protocol
      (<acronym class="acronym">DHCP</acronym>)</h2></div></div></div><a id="idp68533496" class="indexterm"></a><a id="idp68534776" class="indexterm"></a><p>The Dynamic Host Configuration Protocol
      (<acronym class="acronym">DHCP</acronym>) allows a system to connect to a
      network in order to be assigned the necessary addressing
      information for communication on that network.  FreeBSD includes
      the OpenBSD version of <code class="command">dhclient</code> which is used
      by the client to obtain the addressing information.  FreeBSD does
      not install a <acronym class="acronym">DHCP</acronym> server, but several
      servers are available in the FreeBSD Ports Collection.  The
      <acronym class="acronym">DHCP</acronym> protocol is fully described in <a class="link" href="http://www.freesoft.org/CIE/RFC/2131/" target="_top">RFC
	2131</a>.
      Informational resources are also available at <a class="link" href="http://www.isc.org/downloads/dhcp/" target="_top">isc.org/downloads/dhcp/</a>.</p><p>This section describes how to use the built-in
      <acronym class="acronym">DHCP</acronym> client.  It then describes how to
      install and configure a <acronym class="acronym">DHCP</acronym> server.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In FreeBSD, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> device is needed by both the
	<acronym class="acronym">DHCP</acronym> server and <acronym class="acronym">DHCP</acronym>
	client.  This device is included in the
	<code class="filename">GENERIC</code>  kernel that is installed with
	FreeBSD.  Users who prefer to create a custom kernel need to keep
	this device if  <acronym class="acronym">DHCP</acronym> is used.</p><p xmlns="http://www.w3.org/1999/xhtml">It should be noted that <code class="filename">bpf</code> also
	allows privileged users to run network packet sniffers on
	that system.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68543608"></a>29.6.1. Configuring a <acronym class="acronym">DHCP</acronym> Client</h3></div></div></div><p><acronym class="acronym">DHCP</acronym> client support is included in the
	FreeBSD installer, making it easy to configure a newly installed
	system to automatically receive its networking addressing
	information from an existing <acronym class="acronym">DHCP</acronym> server.
	Refer to <a class="xref" href="#bsdinstall-post" title="2.8. Accounts, Time Zone, Services and Hardening">Section 2.8, &#8220;Accounts, Time Zone, Services and Hardening&#8221;</a> for examples of
	network configuration.</p><a id="idp68546040" class="indexterm"></a><p>When <code class="command">dhclient</code> is executed on the client
	machine, it begins broadcasting requests for configuration
	information.  By default, these requests use
	<acronym class="acronym">UDP</acronym> port 68.  The server replies on
	<acronym class="acronym">UDP</acronym> port 67, giving the client an
	<acronym class="acronym">IP</acronym> address and other relevant network
	information such as a subnet mask, default gateway, and
	<acronym class="acronym">DNS</acronym> server addresses.  This information is
	in the form of a <acronym class="acronym">DHCP</acronym>
	<span class="quote">&#8220;<span class="quote">lease</span>&#8221;</span> and is valid for a configurable time.
	This allows stale <acronym class="acronym">IP</acronym> addresses for clients
	no longer connected to the network to automatically be reused.
	<acronym class="acronym">DHCP</acronym> clients can obtain a great deal of
	information from the server.  An exhaustive list may be found
	in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhcp-options&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhcp-options</span>(5)</span></a>.</p><p>By default, when a FreeBSD system boots, its
	<acronym class="acronym">DHCP</acronym> client runs in the background, or
	<em class="firstterm">asynchronously</em>.  Other startup scripts
	continue to run while the <acronym class="acronym">DHCP</acronym> process
	completes, which speeds up system startup.</p><p>Background <acronym class="acronym">DHCP</acronym> works well when the
	<acronym class="acronym">DHCP</acronym> server responds quickly to the
	client's requests.  However, <acronym class="acronym">DHCP</acronym> may take
	a long time to complete on some systems.  If network services
	attempt to run before <acronym class="acronym">DHCP</acronym> has assigned the
	network addressing information, they will fail.  Using
	<acronym class="acronym">DHCP</acronym> in <em class="firstterm">synchronous</em>
	mode prevents this problem as it pauses startup until the
	<acronym class="acronym">DHCP</acronym> configuration has completed.</p><p>This line in <code class="filename">/etc/rc.conf</code> is used to
	configure background or asynchronous mode:</p><pre class="programlisting">ifconfig_<em class="replaceable"><code>fxp0</code></em>="DHCP"</pre><p>This line may already exist if the system was configured
	to use <acronym class="acronym">DHCP</acronym> during installation.  Replace
	the <em class="replaceable"><code>fxp0</code></em> shown in these examples
	with the name of the interface to be dynamically configured,
	as described in <a class="xref" href="#config-network-setup" title="11.5. Setting Up Network Interface Cards">Section 11.5, &#8220;Setting Up Network Interface Cards&#8221;</a>.</p><p>To instead configure the system to use synchronous mode,
	and to pause during startup while <acronym class="acronym">DHCP</acronym>
	completes, use
	<span class="quote">&#8220;<span class="quote"><code class="literal">SYNCDHCP</code></span>&#8221;</span>:</p><pre class="programlisting">ifconfig_<em class="replaceable"><code>fxp0</code></em>="SYNCDHCP"</pre><p>Additional client options are available.  Search for
	<code class="literal">dhclient</code> in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> for
	details.</p><a id="idp68578936" class="indexterm"></a><p>The <acronym class="acronym">DHCP</acronym> client uses the following
	files:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">/etc/dhclient.conf</code></p><p>The configuration file used by
	    <code class="command">dhclient</code>.  Typically, this file
	    contains only comments as the defaults are suitable for
	    most clients.  This configuration file is described in
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient.conf</span>(5)</span></a>.</p></li><li class="listitem"><p><code class="filename">/sbin/dhclient</code></p><p>More information about the command itself can
	    be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient</span>(8)</span></a>.</p></li><li class="listitem"><p><code class="filename">/sbin/dhclient-script</code></p><p>The
	    FreeBSD-specific <acronym class="acronym">DHCP</acronym> client configuration
	    script.  It is described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient-script&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient-script</span>(8)</span></a>, but
	    should not need any user modification to function
	    properly.</p></li><li class="listitem"><p><code class="filename">/var/db/dhclient.leases.<em class="replaceable"><code>interface</code></em></code></p><p>The <acronym class="acronym">DHCP</acronym> client keeps a database of
	    valid leases in this file, which is written as a log and
	    is described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient.leases&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient.leases</span>(5)</span></a>.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-dhcp-server"></a>29.6.2. Installing and Configuring a <acronym class="acronym">DHCP</acronym>
	Server</h3></div></div></div><p>This section demonstrates how to configure a FreeBSD system
	to act as a <acronym class="acronym">DHCP</acronym> server using the Internet
	Systems Consortium (<acronym class="acronym">ISC</acronym>) implementation of
	the <acronym class="acronym">DHCP</acronym> server.  This implementation and
	its documentation can be installed using the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp43-server/pkg-descr">net/isc-dhcp43-server</a> package or
	port.</p><a id="idp68598264" class="indexterm"></a><a id="idp68603640" class="indexterm"></a><p>The installation of
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp43-server/pkg-descr">net/isc-dhcp43-server</a> installs a sample
	configuration file.  Copy
	<code class="filename">/usr/local/etc/dhcpd.conf.example</code> to
	<code class="filename">/usr/local/etc/dhcpd.conf</code> and make any
	edits to this new file.</p><a id="idp68606456" class="indexterm"></a><p>The configuration file is comprised of declarations for
	subnets and hosts which define the  information that is
	provided to <acronym class="acronym">DHCP</acronym>  clients.  For example,
	these  lines configure the following:</p><pre class="programlisting">option domain-name "example.org";<a id="domain-name"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
option domain-name-servers ns1.example.org;<a id="domain-name-servers"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
option subnet-mask 255.255.255.0;<a id="subnet-mask"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>

default-lease-time 600;<a id="default-lease-time"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
max-lease-time 72400;<a id="max-lease-time"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
ddns-update-style none;<a id="ddns-update-style"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>

subnet 10.254.239.0 netmask 255.255.255.224 {
  range 10.254.239.10 10.254.239.20;<a id="range"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;<a id="routers"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
}

host fantasia {
  hardware ethernet 08:00:07:26:c0:a5;<a id="hardware"></a><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span>
  fixed-address fantasia.fugue.com;<a id="fixed-address"></a><span><img src="./imagelib/callouts/10.png" alt="10" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#domain-name"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This option specifies the default search domain that
	    will be provided to clients.  Refer to
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=resolv.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">resolv.conf</span>(5)</span></a> for more information.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#domain-name-servers"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This option specifies a comma separated list of
	    <acronym class="acronym">DNS</acronym> servers that the client should use.
	    They can be listed by their Fully Qualified Domain Names
	    (<acronym class="acronym">FQDN</acronym>), as seen in the example, or by
	    their <acronym class="acronym">IP</acronym> addresses.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#subnet-mask"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The subnet mask that will be provided to
	    clients.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#default-lease-time"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The default lease expiry time in seconds.  A client
	    can be configured to override this value.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#max-lease-time"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The maximum allowed length of time, in seconds, for a
	    lease.  Should a client request a longer lease, a lease
	    will still be issued, but it will only be valid for
	    <code class="literal">max-lease-time</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ddns-update-style"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The default of <code class="option">none</code> disables dynamic
	    DNS updates.  Changing this to <code class="option">interim</code>
	    configures the <acronym class="acronym">DHCP</acronym> server to update a
	    <acronym class="acronym">DNS</acronym> server whenever it hands out a
	    lease so that the <acronym class="acronym">DNS</acronym> server knows
	    which <acronym class="acronym">IP</acronym> addresses are associated with
	    which computers in the network.  Do not change the default
	    setting unless the <acronym class="acronym">DNS</acronym> server has  been
	    configured to support dynamic
	    <acronym class="acronym">DNS</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#range"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This line creates a pool of available
	    <acronym class="acronym">IP</acronym> addresses which are reserved for
	    allocation to <acronym class="acronym">DHCP</acronym> clients.  The range
	    of addresses must be valid for the network or subnet
	    specified in the previous line.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#routers"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Declares the default gateway that is valid for the
	    network or subnet specified before the opening
	    <code class="literal">{</code> bracket.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#hardware"><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Specifies the hardware <acronym class="acronym">MAC</acronym> address
	    of a client so that the <acronym class="acronym">DHCP</acronym> server can
	    recognize the client when it makes a request.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#fixed-address"><span><img src="./imagelib/callouts/10.png" alt="10" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Specifies that this host should always be given the
	    same <acronym class="acronym">IP</acronym> address.  Using the hostname is
	    correct, since the <acronym class="acronym">DHCP</acronym> server will
	    resolve the hostname before returning the lease
	    information.</p></td></tr></table></div><p>This configuration file supports many more options.  Refer
	to dhcpd.conf(5), installed with the server, for details and
	examples.</p><p>Once the configuration of <code class="filename">dhcpd.conf</code>
	is complete, enable the <acronym class="acronym">DHCP</acronym> server in
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">dhcpd_enable="YES"
dhcpd_ifaces="dc0"</pre><p>Replace the <code class="literal">dc0</code> with the interface (or
	interfaces, separated by whitespace) that the
	<acronym class="acronym">DHCP</acronym> server should listen on for
	<acronym class="acronym">DHCP</acronym> client requests.</p><p>Start the server by issuing the following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service isc-dhcpd start</code></strong></pre><p>Any future changes to the configuration of the server will
	require the <span class="application">dhcpd</span> service to be
	stopped and then started using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=service&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">service</span>(8)</span></a>.</p><p>The <acronym class="acronym">DHCP</acronym> server uses the following
	files.  Note that the manual pages are installed with the
	server software.</p><a id="idp68723960" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">/usr/local/sbin/dhcpd</code></p><p>More information about the
	    <span class="application">dhcpd</span> server can be found in
	    dhcpd(8).</p></li><li class="listitem"><p><code class="filename">/usr/local/etc/dhcpd.conf</code></p><p>The server configuration file needs to contain all the
	    information that should be provided to clients, along with
	    information regarding the operation of the server.  This
	    configuration file is described in dhcpd.conf(5).</p></li><li class="listitem"><p><code class="filename">/var/db/dhcpd.leases</code></p><p>The <acronym class="acronym">DHCP</acronym> server keeps a database of
	    leases it has issued in this file, which is written as a
	    log.  Refer to dhcpd.leases(5), which gives a slightly
	    longer description.</p></li><li class="listitem"><p><code class="filename">/usr/local/sbin/dhcrelay</code></p><p>This daemon is used in advanced environments where one
	    <acronym class="acronym">DHCP</acronym> server forwards a request from a
	    client to another <acronym class="acronym">DHCP</acronym> server on a
	    separate network.  If this functionality is required,
	    install the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp43-relay/pkg-descr">net/isc-dhcp43-relay</a>
	    package or port.  The installation includes dhcrelay(8)
	    which provides more detail.</p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-dns"></a>29.7. Domain Name System (<acronym class="acronym">DNS</acronym>)</h2></div></div></div><a id="idp68738424" class="indexterm"></a><p>Domain Name System (<acronym class="acronym">DNS</acronym>) is the protocol
      through which domain names are mapped to <acronym class="acronym">IP</acronym>
      addresses, and vice versa.  <acronym class="acronym">DNS</acronym> is
      coordinated across the Internet through a somewhat complex
      system of authoritative root, Top Level Domain
      (<acronym class="acronym">TLD</acronym>), and other smaller-scale name servers,
      which host and cache individual domain information.  It is not
      necessary to run a name server to perform
      <acronym class="acronym">DNS</acronym> lookups on a system.</p><a id="idp68741240" class="indexterm"></a><a id="idp68741752" class="indexterm"></a><a id="idp68742520" class="indexterm"></a><p>The following table describes some of the terms associated
      with <acronym class="acronym">DNS</acronym>:</p><div class="table"><a id="idp68743800"></a><div class="table-title">Table 29.4. <acronym class="acronym">DNS</acronym> Terminology</div><div class="table-contents"><table class="table" summary="DNS Terminology" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Term</th><th>Definition</th></tr></thead><tbody><tr><td>Forward <acronym class="acronym">DNS</acronym></td><td>Mapping of hostnames to <acronym class="acronym">IP</acronym>
	      addresses.</td></tr><tr><td>Origin</td><td>Refers to the domain covered in a particular zone
	      file.</td></tr><tr><td>Resolver</td><td>A system process through which a machine queries
	      a name server for zone information.</td></tr><tr><td>Reverse <acronym class="acronym">DNS</acronym></td><td>Mapping of <acronym class="acronym">IP</acronym> addresses to
	      hostnames.</td></tr><tr><td>Root zone</td><td>The beginning of the Internet zone hierarchy.  All
	      zones fall under the root zone, similar to how all files
	      in a file system fall under the root directory.</td></tr><tr><td>Zone</td><td>An individual domain, subdomain, or portion of the
	      <acronym class="acronym">DNS</acronym> administered by the same
	      authority.</td></tr></tbody></table></div></div><br class="table-break" /><a id="idp68769144" class="indexterm"></a><p>Examples of zones:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="systemitem">.</code> is how the root zone is
	  usually referred to in documentation.</p></li><li class="listitem"><p><code class="systemitem">org.</code> is a Top Level Domain
	  (<acronym class="acronym">TLD</acronym>) under the root zone.</p></li><li class="listitem"><p><code class="systemitem">example.org.</code> is a zone
	  under the <code class="systemitem">org.</code>
	  <acronym class="acronym">TLD</acronym>.</p></li><li class="listitem"><p><code class="systemitem">1.168.192.in-addr.arpa</code> is a
	  zone referencing all <acronym class="acronym">IP</acronym> addresses which
	  fall under the <code class="systemitem">192.168.1.*</code>
	  <acronym class="acronym">IP</acronym> address space.</p></li></ul></div><p>As one can see, the more specific part of a hostname
      appears to its left.  For example, <code class="systemitem">example.org.</code> is more
      specific than <code class="systemitem">org.</code>, as
      <code class="systemitem">org.</code> is more specific than the root
      zone.  The layout of each part of a hostname is much like a file
      system: the <code class="filename">/dev</code> directory falls within the
      root, and so on.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68345720"></a>29.7.1. Reasons to Run a Name Server</h3></div></div></div><p>Name servers generally come in two forms: authoritative
	name servers, and caching (also known as resolving) name
	servers.</p><p>An authoritative name server is needed when:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>One wants to serve <acronym class="acronym">DNS</acronym> information
	    to the world, replying authoritatively to queries.</p></li><li class="listitem"><p>A domain, such as <code class="systemitem">example.org</code>, is
	    registered and <acronym class="acronym">IP</acronym> addresses need to be
	    assigned to hostnames under it.</p></li><li class="listitem"><p>An <acronym class="acronym">IP</acronym> address block requires
	    reverse <acronym class="acronym">DNS</acronym> entries
	    (<acronym class="acronym">IP</acronym> to hostname).</p></li><li class="listitem"><p>A backup or second name server, called a slave, will
	    reply to queries.</p></li></ul></div><p>A caching name server is needed when:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A local <acronym class="acronym">DNS</acronym> server may cache and
	    respond more quickly than querying an outside name
	    server.</p></li></ul></div><p>When one queries for <code class="systemitem">www.FreeBSD.org</code>, the
	resolver usually queries the uplink <acronym class="acronym">ISP</acronym>'s
	name server, and retrieves the reply.  With a local, caching
	<acronym class="acronym">DNS</acronym> server, the query only has to be made
	once to the outside world by the caching
	<acronym class="acronym">DNS</acronym> server.  Additional queries will not
	have to go outside the local network, since the information is
	cached locally.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68799736"></a>29.7.2. <acronym class="acronym">DNS</acronym> Server Configuration</h3></div></div></div><p><span class="application">Unbound</span> is provided in the FreeBSD
	base system.  By default, it will provide
	<acronym class="acronym">DNS</acronym> resolution to the local machine only.
	While the base system package can be configured to provide
	resolution services beyond the local machine, it is
	recommended that such requirements be addressed by installing
	<span class="application">Unbound</span> from the FreeBSD Ports
	Collection.</p><p>To enable <span class="application">Unbound</span>, add the
	following to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">local_unbound_enable="YES"</pre><p>Any existing nameservers in
	<code class="filename">/etc/resolv.conf</code> will be configured as
	forwarders in the new <span class="application">Unbound</span>
	configuration.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If any of the listed nameservers do not support
	  <acronym class="acronym">DNSSEC</acronym>, local <acronym class="acronym">DNS</acronym>
	  resolution will fail.  Be sure to test each nameserver and
	  remove any that fail the test.  The following command will
	  show the trust tree or a failure for a nameserver running on
	  <code class="systemitem">192.168.1.1</code>:</p></div><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>drill -S FreeBSD.org @<em class="replaceable"><code>192.168.1.1</code></em></code></strong></pre><p>Once each nameserver is confirmed to support
	<acronym class="acronym">DNSSEC</acronym>, start
	<span class="application">Unbound</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service local_unbound onestart</code></strong></pre><p>This will take care of updating
	<code class="filename">/etc/resolv.conf</code> so that queries for
	<acronym class="acronym">DNSSEC</acronym> secured domains will now work.  For
	example, run the following to validate the FreeBSD.org
	<acronym class="acronym">DNSSEC</acronym> trust tree:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>drill -S FreeBSD.org</code></strong>
;; Number of trusted keys: 1
;; Chasing: freebsd.org. A

DNSSEC Trust tree:
freebsd.org. (A)
|---freebsd.org. (DNSKEY keytag: 36786 alg: 8 flags: 256)
    |---freebsd.org. (DNSKEY keytag: 32659 alg: 8 flags: 257)
    |---freebsd.org. (DS keytag: 32659 digest type: 2)
        |---org. (DNSKEY keytag: 49587 alg: 7 flags: 256)
            |---org. (DNSKEY keytag: 9795 alg: 7 flags: 257)
            |---org. (DNSKEY keytag: 21366 alg: 7 flags: 257)
            |---org. (DS keytag: 21366 digest type: 1)
            |   |---. (DNSKEY keytag: 40926 alg: 8 flags: 256)
            |       |---. (DNSKEY keytag: 19036 alg: 8 flags: 257)
            |---org. (DS keytag: 21366 digest type: 2)
                |---. (DNSKEY keytag: 40926 alg: 8 flags: 256)
                    |---. (DNSKEY keytag: 19036 alg: 8 flags: 257)
;; Chase successful</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-apache"></a>29.8. Apache HTTP Server</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div></div></div><a id="idp68820344" class="indexterm"></a><a id="idp68821240" class="indexterm"></a><p>The open source
      <span class="application">Apache HTTP Server</span> is the most widely
      used web server.  FreeBSD does not install this web server by
      default, but it can be installed from the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/apache24/pkg-descr">www/apache24</a> package or port.</p><p>This section summarizes how to configure and start version
      2.<em class="replaceable"><code>x</code></em> of the <span class="application">Apache HTTP
	Server</span> on FreeBSD.  For more detailed information
      about <span class="application">Apache</span> 2.X and its
      configuration directives, refer to <a class="link" href="http://httpd.apache.org/" target="_top">httpd.apache.org</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68824952"></a>29.8.1. Configuring and Starting Apache</h3></div></div></div><a id="idp68825592" class="indexterm"></a><p>In FreeBSD, the main <span class="application">Apache HTTP
	  Server</span> configuration file is installed as
	<code class="filename">/usr/local/etc/apache2<em class="replaceable"><code>x</code></em>/httpd.conf</code>,
	where <em class="replaceable"><code>x</code></em> represents the version
	number.  This <acronym class="acronym">ASCII</acronym> text file begins
	comment lines with a <code class="literal">#</code>.  The most
	frequently modified directives are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ServerRoot "/usr/local"</code></span></dt><dd><p>Specifies the default directory hierarchy for the
	      <span class="application">Apache</span> installation.
	      Binaries are stored in the <code class="filename">bin</code> and
	      <code class="filename">sbin</code> subdirectories of the server
	      root and configuration files are stored in the <code class="filename">etc/apache2<em class="replaceable"><code>x</code></em></code>
	      subdirectory.</p></dd><dt><span class="term"><code class="literal">ServerAdmin you@example.com</code></span></dt><dd><p>Change this to the email address to receive problems
	      with the server.  This address also appears on some
	      server-generated pages, such as error documents.</p></dd><dt><span class="term"><code class="literal">ServerName
	      www.example.com:80</code></span></dt><dd><p>Allows an administrator to set a hostname which is
	      sent back to clients for the server.  For example,
	      <code class="systemitem">www</code> can be used instead of the
	      actual hostname.  If the system does not have a
	      registered <acronym class="acronym">DNS</acronym> name, enter its
	      <acronym class="acronym">IP</acronym> address instead.  If the server
	      will listen on an alternate report, change
	      <code class="literal">80</code> to the alternate port
	      number.</p></dd><dt><span class="term"><code class="literal">DocumentRoot
	    "/usr/local/www/apache2<em class="replaceable"><code>x</code></em>/data"</code></span></dt><dd><p>The directory where documents will be served from.
	      By default, all requests are taken from this directory,
	      but symbolic links and aliases may be used to point to
	      other locations.</p></dd></dl></div><p>It is always a good idea to make a backup copy of the
	default <span class="application">Apache</span> configuration file
	before making changes.  When the configuration of
	<span class="application">Apache</span> is complete, save the file
	and verify the configuration using
	<code class="command">apachectl</code>.  Running <code class="command">apachectl
	  configtest</code> should return <code class="literal">Syntax
	  OK</code>.</p><a id="idp68862840" class="indexterm"></a><p>To launch <span class="application">Apache</span> at system
	startup, add the following line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">apache<em class="replaceable"><code>24</code></em>_enable="YES"</pre><p>If <span class="application">Apache</span> should be started
	with non-default options, the following line may be added to
	<code class="filename">/etc/rc.conf</code> to specify the needed
	flags:</p><pre class="programlisting">apache<em class="replaceable"><code>24</code></em>_flags=""</pre><p>If <span class="application">apachectl</span> does not report
	configuration errors, start <code class="command">httpd</code>
	now:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service apache<em class="replaceable"><code>24</code></em> start</code></strong></pre><p>The <code class="command">httpd</code> service can be tested by
	entering
	<code class="literal">http://<em class="replaceable"><code>localhost</code></em></code>
	in a web browser, replacing
	<em class="replaceable"><code>localhost</code></em> with the fully-qualified
	domain name of the machine running <code class="command">httpd</code>.
	The default web page that is displayed is
	<code class="filename">/usr/local/www/apache<em class="replaceable"><code>24</code></em>/data/index.html</code>.</p><p>The <span class="application">Apache</span> configuration can be
	tested for errors after making subsequent configuration
	changes while <code class="command">httpd</code> is running using the
	following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service apache<em class="replaceable"><code>24</code></em> configtest</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is important to note that
	  <code class="literal">configtest</code> is not an <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> standard,
	  and should not be expected to work for all startup
	  scripts.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68877432"></a>29.8.2. Virtual Hosting</h3></div></div></div><p>Virtual hosting allows multiple websites to run on one
	<span class="application">Apache</span> server.  The virtual hosts
	can be <em class="firstterm">IP-based</em> or
	<em class="firstterm">name-based</em>.
	<acronym class="acronym">IP</acronym>-based virtual hosting uses a different
	<acronym class="acronym">IP</acronym> address for each website.  Name-based
	virtual hosting uses the clients HTTP/1.1 headers to figure
	out the hostname, which allows the websites to share the same
	<acronym class="acronym">IP</acronym> address.</p><p>To setup <span class="application">Apache</span> to use
	name-based virtual hosting, add a
	<code class="literal">VirtualHost</code> block for each website.  For
	example, for the webserver named <code class="systemitem">www.domain.tld</code> with a
	virtual domain of <code class="systemitem">www.someotherdomain.tld</code>,
	add the following entries to
	<code class="filename">httpd.conf</code>:</p><pre class="programlisting">&lt;VirtualHost *&gt;
    ServerName <em class="replaceable"><code>www.domain.tld</code></em>
    DocumentRoot <em class="replaceable"><code>/www/domain.tld</code></em>
&lt;/VirtualHost&gt;

&lt;VirtualHost *&gt;
    ServerName <em class="replaceable"><code>www.someotherdomain.tld</code></em>
    DocumentRoot <em class="replaceable"><code>/www/someotherdomain.tld</code></em>
&lt;/VirtualHost&gt;</pre><p>For each virtual host, replace the values for
	<code class="literal">ServerName</code> and
	<code class="literal">DocumentRoot</code> with the values to be
	used.</p><p>For more information about setting up virtual hosts,
	consult the official <span class="application">Apache</span>
	documentation at: <code class="uri"><a class="uri" href="http://httpd.apache.org/docs/vhosts/" target="_top">http://httpd.apache.org/docs/vhosts/</a></code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68904184"></a>29.8.3. Apache Modules</h3></div></div></div><a id="idp68904824" class="indexterm"></a><p><span class="application">Apache</span> uses modules to augment
	the functionality provided by the basic server.  Refer to <code class="uri"><a class="uri" href="http://httpd.apache.org/docs/current/mod/" target="_top">http://httpd.apache.org/docs/current/mod/</a></code>
	for a complete listing of and the configuration details for
	the available modules.</p><p>In FreeBSD, some modules can be compiled with the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/apache24/pkg-descr">www/apache24</a> port.  Type <code class="command">make
	  config</code> within
	<code class="filename">/usr/ports/www/apache24</code> to see which
	modules are available and which are enabled by default.  If
	the module is not compiled with the port, the FreeBSD Ports
	Collection provides an easy way to install many modules.  This
	section describes three of the most commonly used
	modules.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68912504"></a>29.8.3.1. SSL support</h4></div></div></div><a id="idp68913144" class="indexterm"></a><a id="idp68914296" class="indexterm"></a><a id="idp68914808" class="indexterm"></a><p>At one in point in time, support for <acronym class="acronym">SSL</acronym>
	  inside of Apache required a secondary module called
	  <code class="filename">mod_ssl</code>. This is no longer the case and
	  the default install of Apache comes with <acronym class="acronym">SSL</acronym>
	  built into the web server. An example of how to enable
	  support for <acronym class="acronym">SSL</acronym> websites is available
	  in the installed file, <code class="filename">httpd-ssl.conf</code>
	  inside of the
	  <code class="filename">/usr/local/etc/apache24/extra</code>
	  directory. Inside this directory is also a sample file called
	  named <code class="filename">ssl.conf-sample</code>. It is recommended
	  that both files be evaluated to properly set up secure websites
	  in the Apache web server.</p><p>After the configuration of <acronym class="acronym">SSL</acronym> is
	  complete, the following line must be uncommented in the main
	  <code class="filename">http.conf</code> to activate the changes on the
	  next restart or reload of Apache:</p><pre class="programlisting">#Include etc/apache24/extra/httpd-ssl.conf</pre><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml"><acronym class="acronym">SSL</acronym> version two and version three have
	    known vulnerability issues. It is highly recommended TLS version 
	    1.2 and 1.3 be enabled in place of the older SSL options.
	    This can be accomplished by setting the following options in the
	    <code class="filename">ssl.conf</code>:</p></div><pre class="programlisting">SSLProtocol all -SSLv3 -SSLv2 +TLSv1.2 +TLSv1.3
SSLProxyProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1</pre><p>To complete the configuration of <acronym class="acronym">SSL</acronym>
	  in the web server, uncomment the following line to ensure that
	  the configuration will be pulled into Apache during restart or
	  reload:</p><pre class="programlisting"># Secure (SSL/TLS) connections
Include etc/apache24/extra/httpd-ssl.conf</pre><p>The following lines must also be uncommented in the
	  <code class="filename">httpd.conf</code> to fully support
	  <acronym class="acronym">SSL</acronym> in Apache:</p><pre class="programlisting">LoadModule authn_socache_module libexec/apache24/mod_authn_socache.so
LoadModule socache_shmcb_module libexec/apache24/mod_socache_shmcb.so
LoadModule ssl_module libexec/apache24/mod_ssl.so</pre><p>The next step is to work with a certificate authority
	  to have the appropriate certificates installed on the
	  system. This will set up a chain of trust for the site
	  and prevent any warnings of self-signed certificates.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68925176"></a>29.8.3.2. <code class="filename">mod_perl</code></h4></div></div></div><a id="idp68925944" class="indexterm"></a><p>The
	  <code class="filename">mod_perl</code> module makes it possible to
	  write <span class="application">Apache</span> modules in
	  <span class="application">Perl</span>.  In addition, the
	  persistent interpreter embedded in the server avoids the
	  overhead of starting an external interpreter and the penalty
	  of <span class="application">Perl</span> start-up time.</p><p>The <code class="filename">mod_perl</code> can be installed using
	  the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/mod_perl2/pkg-descr">www/mod_perl2</a> package or port.
	  Documentation for using this module can be found at <code class="uri"><a class="uri" href="http://perl.apache.org/docs/2.0/index.html" target="_top">http://perl.apache.org/docs/2.0/index.html</a></code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68934904"></a>29.8.3.3. <code class="filename">mod_php</code></h4></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp68938360" class="indexterm"></a><p><em class="firstterm">PHP: Hypertext Preprocessor</em>
	  (<acronym class="acronym">PHP</acronym>) is a general-purpose scripting
	  language that is especially suited for web development.
	  Capable of being embedded into <acronym class="acronym">HTML</acronym>, its
	  syntax draws upon <span class="application">C</span>, <span class="trademark">Java</span>&#8482;, and
	  <span class="application">Perl</span> with the intention of
	  allowing web developers to write dynamically generated
	  webpages quickly.</p><p>Support for <acronym class="acronym">PHP</acronym> for
	  <span class="application">Apache</span> and any other feature
	  written in the language, can be added
	  by installing the appropriate port.</p><p>For all supported versions, search the package database
	  using <code class="command">pkg</code>. Here is an example of the
	  available <acronym class="acronym">PHP</acronym> packages as of the time
	  of this writing:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg search php</code></strong></pre><p>A list will be displayed including the versions and
	  additional features they provide. The components are
	  completely modular, meaning features are enabled by
	  installing the appropriate port. To install
	  <acronym class="acronym">PHP</acronym> version 7.4 for Apache, issue
	  the following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install mod_php74</code></strong></pre><p>If any dependency packages need to be installed, they will
	  be installed as well.</p><p>By default, <acronym class="acronym">PHP</acronym> will not be
	  enabled. The following lines will need to be added to
	  the Apache configuration file located in
	  <code class="filename">/usr/local/etc/apache24</code>
	  to make it active:</p><pre class="programlisting">&lt;FilesMatch "\.php$"&gt;
    SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
&lt;FilesMatch "\.phps$"&gt;
    SetHandler application/x-httpd-php-source
&lt;/FilesMatch&gt;</pre><p>In addition, the <code class="option">DirectoryIndex</code> in
	  the configuration file will also need to be updated
	  and Apache will either need to be restarted or reloaded
	  for the changes to take effect.</p><p>Support for many of the <acronym class="acronym">PHP</acronym>
	  features may also be installed by using
	  <code class="command">pkg</code>. For example, to install
	  support for <acronym class="acronym">XML</acronym> or
	  <acronym class="acronym">SSL</acronym>, install their respective
	  ports:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install php74-xml php74-openssl</code></strong></pre><p>As before, the Apache configuration will need to be
	  reloaded for the changes to take effect, even in cases
	  where it was just a module install.</p><p>To perform a graceful restart to reload the
	  configuration, issue the following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>apachectl graceful</code></strong></pre><p>Once the install is complete, there are two methods of
	  obtaining the installed <acronym class="acronym">PHP</acronym> support modules
	  and the environmental information of the build. The first is
	  to install the full <acronym class="acronym">PHP</acronym> binary and running
	  the command to gain the information:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install php74</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>php -i |less</code></strong></pre><p>It is necessary to pass the output to a pager, such as
	  the <code class="command">more</code> or <code class="command">less</code> to
	  easier digest the amount of output.</p><p>Finally, to make any changes to the global configuration
	  of <acronym class="acronym">PHP</acronym> there is a well documented file
	  installed into
	  <code class="filename">/usr/local/etc/php.ini</code>.
	  At the time of install, this file will not exist because there
	  are two versions to choose from, one is
	  <code class="filename">php.ini-development</code> and the other is
	  <code class="filename">php.ini-production</code>. These are starting
	  points to assist administrators in their deployment.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68977400"></a>29.8.4. Dynamic Websites</h3></div></div></div><a id="idp68978040" class="indexterm"></a><p>In addition to <span class="application">mod_perl</span> and
	<span class="application">mod_php</span>, other languages are
	available for creating dynamic web content.  These include
	<span class="application">Django</span> and
	<span class="application">Ruby on Rails</span>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68981112"></a>29.8.4.1. Django</h4></div></div></div><a id="idp68981752" class="indexterm"></a><a id="idp68982264" class="indexterm"></a><p><span class="application">Django</span> is a BSD-licensed
	  framework designed to allow developers to write high
	  performance, elegant web applications quickly.  It provides
	  an object-relational mapper so that data types are developed
	  as <span class="application">Python</span> objects.  A rich
	  dynamic database-access <acronym class="acronym">API</acronym> is provided
	  for those objects without the developer ever having to write
	  <acronym class="acronym">SQL</acronym>.  It also provides an extensible
	  template system so that the logic of the application is
	  separated from the <acronym class="acronym">HTML</acronym>
	  presentation.</p><p>Django depends on <code class="filename">mod_python</code>, and
	  an <acronym class="acronym">SQL</acronym> database engine.  In FreeBSD, the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/py-django/pkg-descr">www/py-django</a> port automatically installs
	  <code class="filename">mod_python</code> and supports the
	  <span class="application">PostgreSQL</span>,
	  <span class="application">MySQL</span>, or
	  <span class="application">SQLite</span> databases, with the
	  default being <span class="application">SQLite</span>.  To change
	  the database engine, type <code class="command">make config</code>
	  within <code class="filename">/usr/ports/www/py-django</code>, then
	  install the port.</p><p>Once <span class="application">Django</span> is installed, the
	  application will need a project directory along with the
	  <span class="application">Apache</span> configuration in order to
	  use the embedded <span class="application">Python</span>
	  interpreter.  This interpreter is used to call the
	  application for specific <acronym class="acronym">URL</acronym>s on the
	  site.</p><p>To configure <span class="application">Apache</span> to pass
	  requests for certain <acronym class="acronym">URL</acronym>s to the web
	  application, add the following to
	  <code class="filename">httpd.conf</code>, specifying the full path to
	  the project directory:</p><pre class="programlisting">&lt;Location "/"&gt;
    SetHandler python-program
    PythonPath "['<em class="replaceable"><code>/dir/to/the/django/packages/</code></em>'] + sys.path"
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE mysite.settings
    PythonAutoReload On
    PythonDebug On
&lt;/Location&gt;</pre><p>Refer to <code class="uri"><a class="uri" href="https://docs.djangoproject.com" target="_top">https://docs.djangoproject.com</a></code>
	  for more information on how to use
	  <span class="application">Django</span>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68994936"></a>29.8.4.2. Ruby on Rails</h4></div></div></div><a id="idp68995576" class="indexterm"></a><p><span class="application">Ruby on Rails</span> is another open
	  source web framework that provides a full development stack.
	  It is optimized to make web developers more productive and
	  capable of writing powerful applications quickly.  On FreeBSD,
	  it can be installed using the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/www/rubygem-rails/pkg-descr">www/rubygem-rails</a> package or port.</p><p>Refer to <code class="uri"><a class="uri" href="http://guides.rubyonrails.org" target="_top">http://guides.rubyonrails.org</a></code>
	  for more information on how to use <span class="application">Ruby on
	    Rails</span>.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ftp"></a>29.9. File Transfer Protocol (<acronym class="acronym">FTP</acronym>)</h2></div></div></div><a id="idp69008376" class="indexterm"></a><p>The File Transfer Protocol (<acronym class="acronym">FTP</acronym>) provides
      users with a simple way to transfer files to and from an
      <acronym class="acronym">FTP</acronym> server.  FreeBSD includes
      <acronym class="acronym">FTP</acronym> server software,
      <span class="application">ftpd</span>, in the base system.</p><p>FreeBSD provides several configuration files for controlling
      access to the <acronym class="acronym">FTP</acronym> server.  This section
      summarizes these files.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a> for more details
      about the built-in <acronym class="acronym">FTP</acronym> server.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69012984"></a>29.9.1. Configuration</h3></div></div></div><p>The most important configuration step is deciding which
	accounts will be allowed access to the <acronym class="acronym">FTP</acronym>
	server.  A FreeBSD system has a number of system accounts which
	should not be allowed <acronym class="acronym">FTP</acronym> access.  The list
	of users disallowed any <acronym class="acronym">FTP</acronym> access can be
	found in <code class="filename">/etc/ftpusers</code>.  By default, it
	includes system accounts.  Additional users that should not be
	allowed access to <acronym class="acronym">FTP</acronym> can be added.</p><p>In some cases it may be desirable to restrict the access
	of some users without preventing them completely from using
	<acronym class="acronym">FTP</acronym>.  This can be accomplished be creating
	<code class="filename">/etc/ftpchroot</code> as described in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftpchroot&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftpchroot</span>(5)</span></a>.  This file lists users and groups subject
	to <acronym class="acronym">FTP</acronym> access restrictions.</p><a id="idp69018360" class="indexterm"></a><p>To enable anonymous <acronym class="acronym">FTP</acronym> access to the
	server, create a user named <code class="systemitem">ftp</code> on the FreeBSD system.  Users
	will then be able to log on to the
	<acronym class="acronym">FTP</acronym> server with a username of
	<code class="systemitem">ftp</code> or <code class="systemitem">anonymous</code>.  When prompted for
	the password, any input will be accepted, but by convention,
	an email address should be used as the password.  The
	<acronym class="acronym">FTP</acronym> server will call <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=2&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">chroot</span>(2)</span></a> when an
	anonymous user logs in, to restrict access to only the home
	directory of the <code class="systemitem">ftp</code> user.</p><p>There are two text files that can be created to specify
	welcome messages to be displayed to <acronym class="acronym">FTP</acronym>
	clients.  The contents of
	<code class="filename">/etc/ftpwelcome</code> will be displayed to
	users before they reach the login prompt.  After a successful
	login, the contents of
	<code class="filename">/etc/ftpmotd</code> will be displayed.  Note
	that the path to this file is relative to the login
	environment, so the contents of
	<code class="filename">~ftp/etc/ftpmotd</code> would be displayed for
	anonymous users.</p><p>Once the <acronym class="acronym">FTP</acronym> server has been
	configured, set the appropriate variable in
	<code class="filename">/etc/rc.conf</code> to start the service during
	boot:</p><pre class="programlisting">ftpd_enable="YES"</pre><p>To start the service now:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service ftpd start</code></strong></pre><p>Test the connection to the <acronym class="acronym">FTP</acronym> server
	by typing:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ftp localhost</code></strong></pre><a id="idp69038712" class="indexterm"></a><a id="idp69039224" class="indexterm"></a><p>The <span class="application">ftpd</span> daemon uses
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> to log messages.  By default, the system log
	daemon will write messages related to <acronym class="acronym">FTP</acronym>
	in <code class="filename">/var/log/xferlog</code>.  The location of
	the <acronym class="acronym">FTP</acronym> log can be modified by changing the
	following line in
	<code class="filename">/etc/syslog.conf</code>:</p><pre class="programlisting">ftp.info      /var/log/xferlog</pre><a id="idp69043704" class="indexterm"></a><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Be aware of the potential problems involved with running
	  an anonymous <acronym class="acronym">FTP</acronym> server.  In particular,
	  think twice about allowing anonymous users to upload files.
	  It may turn out that the <acronym class="acronym">FTP</acronym> site becomes
	  a forum for the trade of unlicensed commercial software or
	  worse.  If anonymous <acronym class="acronym">FTP</acronym> uploads are
	  required, then verify the permissions so that these files
	  cannot be read by other anonymous users until they have
	  been reviewed by an administrator.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-samba"></a>29.10. File and Print Services for <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® Clients
      (Samba)</h2></div></div></div><a id="idp69065720" class="indexterm"></a><a id="idp69066232" class="indexterm"></a><a id="idp69066744" class="indexterm"></a><a id="idp69067896" class="indexterm"></a><p><span class="application">Samba</span> is a popular open source
      software package that provides file and print services using the
      <acronym class="acronym">SMB/CIFS</acronym> protocol.  This protocol is built
      into <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® systems.  It can be added to
      non-<span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® systems by installing the
      <span class="application">Samba</span> client libraries.  The protocol
      allows clients to access shared data and printers.  These shares
      can be mapped as a local disk drive and shared printers can be
      used as if they were local printers.</p><p>On FreeBSD, the <span class="application">Samba</span> client
      libraries can be installed using the
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/samba410/pkg-descr">net/samba410</a> port or package.  The
      client provides the ability for a FreeBSD system to access
      <acronym class="acronym">SMB/CIFS</acronym> shares in a <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>®
      network.</p><p>A FreeBSD system can also be configured to act as a
      <span class="application">Samba</span> server by installing the same
      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/samba410/pkg-descr">net/samba410</a> port or package.  This allows the
      administrator to create <acronym class="acronym">SMB</acronym>/<acronym class="acronym">CIFS</acronym>
      shares on
      the FreeBSD system which can be accessed by clients running
      <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® or the <span class="application">Samba</span>
      client libraries.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69082488"></a>29.10.1. Server Configuration</h3></div></div></div><p><span class="application">Samba</span> is configured in
	<code class="filename">/usr/local/etc/smb4.conf</code>.  This file must
	be created before <span class="application">Samba</span>
	can be used.</p><p>A simple <code class="filename">smb4.conf</code> to share
	directories and printers  with <span class="trademark">Windows</span>® clients in a
	workgroup is shown here.  For more complex setups
	involving LDAP or Active Directory, it is easier to use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=samba-tool&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">samba-tool</span>(8)</span></a> to create the initial
	<code class="filename">smb4.conf</code>.</p><pre class="programlisting">[global]
workgroup = WORKGROUP
server string = Samba Server Version %v
netbios name = ExampleMachine
wins support = Yes
security = user
passdb backend = tdbsam

# Example: share /usr/src accessible only to 'developer' user
[src]
path = /usr/src
valid users = developer
writable  = yes
browsable = yes
read only = no
guest ok = no
public = no
create mask = 0666
directory mask = 0755</pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69087480"></a>29.10.1.1. Global Settings</h4></div></div></div><p>Settings that describe the network are added in
	  <code class="filename">/usr/local/etc/smb4.conf</code>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">workgroup</code></span></dt><dd><p>The name of the workgroup to be served.</p></dd><dt><span class="term"><code class="literal">netbios name</code></span></dt><dd><p>The NetBIOS name by which a
		<span class="application">Samba</span> server is known.  By
		default, it is the same as the first component of the
		host's <acronym class="acronym">DNS</acronym> name.</p></dd><dt><span class="term"><code class="literal">server string</code></span></dt><dd><p>The string that will be displayed in the output of
		<code class="command">net view</code> and some other
		networking tools that seek to display descriptive text
		about the server.</p></dd><dt><span class="term"><code class="literal">wins support</code></span></dt><dd><p>Whether <span class="application">Samba</span> will
		act as a <acronym class="acronym">WINS</acronym> server.  Do not
		enable support for <acronym class="acronym">WINS</acronym> on more than
		one server on the network.</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69110648"></a>29.10.1.2. Security Settings</h4></div></div></div><p>The most important settings in
	  <code class="filename">/usr/local/etc/smb4.conf</code> are the
	  security model and the backend password format.  These
	  directives control the options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">security</code></span></dt><dd><p>The most common settings are
		<code class="literal">security = share</code> and
		<code class="literal">security = user</code>.  If the clients
		use usernames that are the same as their usernames on
		the FreeBSD machine, user level security should be
		used.  This is the default security policy and it
		requires clients to first log on before they can
		access shared resources.</p><p>In share level security, clients do not need to
		log onto the server with a valid username and password
		before attempting to connect to a shared resource.
		This was the default security model for older versions
		of <span class="application">Samba</span>.</p></dd><dt><span class="term"><code class="literal">passdb backend</code></span></dt><dd><a id="idp69116536" class="indexterm"></a><a id="idp69117048" class="indexterm"></a><a id="idp69117560" class="indexterm"></a><p><span class="application">Samba</span> has several
		different backend authentication models.  Clients may
		be authenticated with LDAP, NIS+, an SQL database,
		or a modified password file.  The recommended
		authentication method, <code class="literal">tdbsam</code>,
		is ideal for simple networks and is covered here.
		For larger or more complex networks,
		<code class="literal">ldapsam</code> is recommended.
		<code class="literal">smbpasswd</code>
		was the former default and is now obsolete.</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69120376"></a>29.10.1.3. <span class="application">Samba</span> Users</h4></div></div></div><p>FreeBSD user accounts must be mapped to the
	  <code class="literal">SambaSAMAccount</code> database for
	  <span class="trademark">Windows</span>® clients to access the share.
	  Map existing FreeBSD user accounts using
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pdbedit&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pdbedit</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pdbedit -a <em class="replaceable"><code>username</code></em></code></strong></pre><p>This section has only mentioned the most commonly used
	  settings.  Refer to the <a class="link" href="https://wiki.samba.org" target="_top">Official
	    Samba Wiki</a> for additional information about the
	  available configuration options.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69137912"></a>29.10.2. Starting <span class="application">Samba</span></h3></div></div></div><p>To enable <span class="application">Samba</span> at boot time,
	add the following line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">samba_server_enable="YES"</pre><p>To start <span class="application">Samba</span> now:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service samba_server start</code></strong>
Performing sanity check on Samba configuration: OK
Starting nmbd.
Starting smbd.</pre><p><span class="application">Samba</span> consists of three
	separate daemons.  Both the <span class="application">nmbd</span>
	and <span class="application">smbd</span> daemons are started by
	<code class="varname">samba_enable</code>.  If winbind name resolution
	is also required, set:</p><pre class="programlisting">winbindd_enable="YES"</pre><p><span class="application">Samba</span> can be stopped at any
	time by typing:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service samba_server stop</code></strong></pre><p><span class="application">Samba</span> is a complex software
	suite with functionality that allows broad integration with
	<span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® networks.  For more information about
	functionality beyond the basic configuration described here,
	refer to <code class="uri"><a class="uri" href="https://www.samba.org" target="_top">https://www.samba.org</a></code>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ntp"></a>29.11. Clock Synchronization with NTP</h2></div></div></div><a id="idp69153400" class="indexterm"></a><p>Over time, a computer's clock is prone to drift.   This is
      problematic as many network services require the computers on a
      network to share the same accurate time.  Accurate time is also
      needed to ensure that file timestamps stay consistent.  The
      Network Time Protocol (<acronym class="acronym">NTP</acronym>) is one way to
      provide clock accuracy in a network.</p><p>FreeBSD includes <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> which can be configured to query
      other <acronym class="acronym">NTP</acronym> servers to synchronize the clock on
      that machine or to provide time services to other computers in
      the network.</p><p>This section describes how to configure
      <span class="application">ntpd</span> on FreeBSD.  Further documentation
      can be found in <code class="filename">/usr/share/doc/ntp/</code> in HTML
      format.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69162104"></a>29.11.1. <acronym class="acronym">NTP</acronym> Configuration</h3></div></div></div><a id="idp69163000" class="indexterm"></a><p>On FreeBSD, the built-in <span class="application">ntpd</span> can
	be used to synchronize a system's clock.
	<span class="application">Ntpd</span> is configured using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
	variables and <code class="filename">/etc/ntp.conf</code>, as detailed
	in the following sections.</p><p><span class="application">Ntpd</span> communicates with its network
        peers using UDP packets.  Any firewalls between your machine and
	its NTP peers must be configured to allow UDP packets in and out
	on port 123.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69170552"></a>29.11.1.1. The <code class="filename">/etc/ntp.conf</code> file</h4></div></div></div><a id="idp69171576" class="indexterm"></a><p><span class="application">Ntpd</span> reads
	  <code class="filename">/etc/ntp.conf</code>
	  to determine which <acronym class="acronym">NTP</acronym> servers to query.
	  Choosing several <acronym class="acronym">NTP</acronym> servers is recommended
	    in case one of the servers becomes unreachable or its clock proves
	    unreliable.  As <span class="application">ntpd</span> receives responses,
	    it favors reliable servers over the less reliable ones.  The servers
	    which are queried can be local to the network, provided by an
	    <acronym class="acronym">ISP</acronym>, or selected from an <a class="link" href="http://support.ntp.org/bin/view/Servers/WebHome" target="_top">
	      online list of publicly accessible <acronym class="acronym">NTP</acronym>
	      servers</a>.
	    When choosing a public <acronym class="acronym">NTP</acronym> server, select one
	    that is geographically close and review its usage policy.  The
	    <code class="literal">pool</code> configuration keyword selects one or more
	    servers from a pool of servers.  An <a class="link" href="http://support.ntp.org/bin/view/Servers/NTPPoolServers" target="_top">
	      online list of publicly accessible <acronym class="acronym">NTP</acronym>
	      pools</a>
	    is available, organized by geographic area.  In addition, FreeBSD
	    provides a project-sponsored pool,
	    <code class="literal">0.freebsd.pool.ntp.org</code>.</p><div class="example"><a id="idp69182456"></a><div class="example-title">Example 29.3. Sample <code class="filename">/etc/ntp.conf</code></div><div class="example-contents"><p>This is a simple example of an <code class="filename">ntp.conf</code>
	    file.  It can safely be used as-is; it contains the recommended
	    <code class="literal">restrict</code> options for operation on a
	    publicly-accessible network connection.</p><pre class="programlisting">
# Disallow ntpq control/query access.  Allow peers to be added only
# based on pool and server statements in this file.
restrict default limited kod nomodify notrap noquery nopeer
restrict source  limited kod nomodify notrap noquery

# Allow unrestricted access from localhost for queries and control.
restrict 127.0.0.1
restrict ::1

# Add a specific server.
server ntplocal.example.com iburst

# Add FreeBSD pool servers until 3-6 good servers are available.
tos minclock 3 maxclock 6
pool 0.freebsd.pool.ntp.org iburst

# Use a local leap-seconds file.
leapfile "/var/db/ntpd.leap-seconds.list"</pre></div></div><br class="example-break" /><p>The format of this file is described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.
	  The descriptions below provide a quick overview of just the
	  keywords used in the sample file above.</p><p>By default, an <acronym class="acronym">NTP</acronym> server is accessible
	  to any network host.  The <code class="literal">restrict</code> keyword
	  controls which systems can access the server.  Multiple
	  <code class="literal">restrict</code> entries are supported, each one
	  refining the restrictions given in previous statements.  The
	  values shown in the example grant the local system full query
	  and control access, while allowing remote systems only the
	  ability to query the time.  For more details, refer to the
	  <code class="literal">Access Control Support</code> subsection of
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.</p><p>The <code class="literal">server</code> keyword specifies a single
	  server to query.  The file can contain multiple server keywords,
	  with one server listed on each line.  The <code class="literal">pool</code>
	  keyword specifies a pool of servers.
	  <span class="application">Ntpd</span> will add one or more
	  servers from this pool as needed to reach the number of peers
	  specified using the <code class="literal">tos minclock</code> value.  The
	  <code class="literal">iburst</code> keyword directs
	  <span class="application">ntpd</span> to perform a burst of eight quick
	  packet exchanges with a server when contact is first established,
	  to help quickly synchronize system time.</p><p>The <code class="literal">leapfile</code> keyword specifies the location
	  of a file containing information about leap seconds.  The file is
	  updated automatically by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a>.  The file location
	  specified by this keyword must match the location set in the
	  <code class="literal">ntp_db_leapfile</code> variable in
	  <code class="filename">/etc/rc.conf</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69210232"></a>29.11.1.2. NTP entries in <code class="filename">/etc/rc.conf</code></h4></div></div></div><a id="idp69211128" class="indexterm"></a><p>Set <code class="literal">ntpd_enable=YES</code> to start
	  <span class="application">ntpd</span> at boot time.  Once
	  <code class="literal">ntpd_enable=YES</code> has been added
	  to <code class="filename">/etc/rc.conf</code>,
	  <span class="application">ntpd</span> can be started immediately without
	  rebooting the system by typing:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service ntpd start</code></strong></pre><p>Only <code class="literal">ntpd_enable</code> must be set to use ntpd.
	The <code class="filename">rc.conf</code> variables listed below may also be
	set as needed.</p><p>Set <code class="literal">ntpd_sync_on_start=YES</code> to allow
	  <span class="application">ntpd</span> to step the clock any amount, one
	  time at startup.  Normally <span class="application">ntpd</span> will
	  log an error message and exit if the clock is off by more than
	  1000 seconds.  This option is especially useful on systems without
	  a battery-backed realtime clock.</p><p>Set <code class="literal">ntpd_oomprotect=YES</code> to protect the
	  <span class="application">ntpd</span> daemon from being killed by
	  the system attempting to recover from an Out Of Memory
	  (<acronym class="acronym">OOM</acronym>) condition.</p><p>Set <code class="literal">ntpd_config=</code> to the location of
	  an alternate <code class="filename">ntp.conf</code> file.</p><p>Set <code class="literal">ntpd_flags=</code> to contain any other
	  <span class="application">ntpd</span> flags as needed, but avoid using
	  these flags which are managed internally by
	  <code class="filename">/etc/rc.d/ntpd</code>:
	  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
	      <code class="literal">-p</code> (pid file location)</p></li><li class="listitem"><p>
	      <code class="literal">-c</code> (set <code class="literal">ntpd_config=</code>
	      instead)</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69224952"></a>29.11.1.3. <span class="application">Ntpd</span> and the unpriveleged
	  <code class="literal">ntpd</code> user</h4></div></div></div><p><span class="application">Ntpd</span> on FreeBSD can start and
	  run as an unpriveleged user.  Doing so requires the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_ntpd&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_ntpd</span>(4)</span></a> policy module.  The
	  <code class="filename">/etc/rc.d/ntpd</code> startup script first
	  examines the NTP configuration.  If possible, it loads the
	  <code class="literal">mac_ntpd</code> module, then starts
	  <span class="application">ntpd</span> as unpriveleged user
	  <code class="literal">ntpd</code> (user id 123).
	  To avoid problems with file and directory access, the startup
	  script will not automatically start
	  <span class="application">ntpd</span> as <code class="literal">ntpd</code>
	  when the configuration contains any file-related options.</p><p>The presence of any of the following in
	  <code class="literal">ntpd_flags</code> requires manual configuration
	  as described below to run as the <code class="literal">ntpd</code> user:
	  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>-f or --driftfile</p></li><li class="listitem"><p>-i or --jaildir</p></li><li class="listitem"><p>-k or --keyfile</p></li><li class="listitem"><p>-l or --logfile</p></li><li class="listitem"><p>-s or --statsdir</p></li></ul></div><p>The presence of any of the following keywords in
	  <code class="filename">ntp.conf</code> requires manual configuration
	  as described below to run as the <code class="literal">ntpd</code> user:
	  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>crypto</p></li><li class="listitem"><p>driftfile</p></li><li class="listitem"><p>key</p></li><li class="listitem"><p>logdir</p></li><li class="listitem"><p>statsdir</p></li></ul></div><p>To manually configure <span class="application">ntpd</span>
	  to run as user <code class="literal">ntpd</code> you must:
	  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: none; "><li class="listitem" style="list-style-type: none"><p>Ensure that the <code class="literal">ntpd</code>
	      user has access to all the files and directories specified
	      in the configuration.</p></li><li class="listitem" style="list-style-type: none"><p>Arrange for the <code class="literal">mac_ntpd</code>
	      module to be loaded or compiled into the kernel.  See
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=mac_ntpd&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">mac_ntpd</span>(4)</span></a> for details.</p></li><li class="listitem" style="list-style-type: none"><p>Set <code class="literal">ntpd_user="ntpd"</code> in
	      <code class="filename">/etc/rc.conf</code></p></li></ul></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69260280"></a>29.11.2. Using <acronym class="acronym">NTP</acronym> with a
	<acronym class="acronym">PPP</acronym> Connection</h3></div></div></div><p><span class="application">ntpd</span> does not need a permanent
	connection to the Internet to function properly.  However, if
	a <acronym class="acronym">PPP</acronym> connection is configured to dial out
	on demand, <acronym class="acronym">NTP</acronym> traffic should be prevented
	from triggering a dial out or keeping the connection alive.
	This can be configured with <code class="literal">filter</code>
	directives in <code class="filename">/etc/ppp/ppp.conf</code>.  For
	example:</p><pre class="programlisting">set filter dial 0 deny udp src eq 123
# Prevent NTP traffic from initiating dial out
set filter dial 1 permit 0 0
set filter alive 0 deny udp src eq 123
# Prevent incoming NTP traffic from keeping the connection open
set filter alive 1 deny udp dst eq 123
# Prevent outgoing NTP traffic from keeping the connection open
set filter alive 2 permit 0/0 0/0</pre><p>For more details, refer to the
	<code class="literal">PACKET FILTERING</code> section in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> and
	the examples in
	<code class="filename">/usr/share/examples/ppp/</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some Internet access providers block low-numbered ports,
	  preventing NTP from functioning since replies never reach
	  the machine.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-iscsi"></a>29.12. <acronym class="acronym">iSCSI</acronym> Initiator and Target
      Configuration</h2></div></div></div><p><acronym class="acronym">iSCSI</acronym> is a way to share storage over a
      network.  Unlike <acronym class="acronym">NFS</acronym>, which works at the file
      system level, <acronym class="acronym">iSCSI</acronym> works at the block device
      level.</p><p>In <acronym class="acronym">iSCSI</acronym> terminology, the system that
      shares the storage is known as the <span class="emphasis"><em>target</em></span>.
      The storage can be a physical disk, or an area representing
      multiple disks or a portion of a physical disk.  For example, if
      the disk(s) are formatted with <acronym class="acronym">ZFS</acronym>, a zvol
      can be created to use as the <acronym class="acronym">iSCSI</acronym>
      storage.</p><p>The clients which access the <acronym class="acronym">iSCSI</acronym>
      storage are called <span class="emphasis"><em>initiators</em></span>.  To
      initiators, the storage available through
      <acronym class="acronym">iSCSI</acronym> appears as a raw, unformatted disk
      known as a <acronym class="acronym">LUN</acronym>.  Device nodes for the disk
      appear in <code class="filename">/dev/</code> and the device must be
      separately formatted and mounted.</p><p>FreeBSD provides a native,
      kernel-based <acronym class="acronym">iSCSI</acronym> target and initiator.
      This section describes how to configure a FreeBSD system as a
      target or an initiator.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-iscsi-target"></a>29.12.1. Configuring an <acronym class="acronym">iSCSI</acronym> Target</h3></div></div></div><p>To configure an <acronym class="acronym">iSCSI</acronym> target, create
	the <code class="filename">/etc/ctl.conf</code> configuration file, add
	a line to <code class="filename">/etc/rc.conf</code> to make sure the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon is automatically started at boot, and then
	start the daemon.</p><p>The following is an example of a simple
	<code class="filename">/etc/ctl.conf</code> configuration file.  Refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctl.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctl.conf</span>(5)</span></a> for a more complete description of this
	file's available options.</p><pre class="programlisting">portal-group pg0 {
	discovery-auth-group no-authentication
	listen 0.0.0.0
	listen [::]
}

target iqn.2012-06.com.example:target0 {
	auth-group no-authentication
	portal-group pg0

	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre><p>The first entry defines the <code class="literal">pg0</code> portal
	group.  Portal groups define which network addresses the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon will listen on.  The
	<code class="literal">discovery-auth-group no-authentication</code>
	entry indicates that any initiator is allowed to perform
	<acronym class="acronym">iSCSI</acronym> target discovery without
	authentication.  Lines three and four configure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a>
	to listen on all <acronym class="acronym">IPv4</acronym>
	(<code class="literal">listen 0.0.0.0</code>) and
	<acronym class="acronym">IPv6</acronym> (<code class="literal">listen [::]</code>)
	addresses on the default port of 3260.</p><p>It is not necessary to define a portal group as there is a
	built-in portal group called <code class="literal">default</code>.  In
	this case, the difference between <code class="literal">default</code>
	and <code class="literal">pg0</code> is that with
	<code class="literal">default</code>, target discovery is always denied,
	while with <code class="literal">pg0</code>, it is always
	allowed.</p><p>The second entry defines a single target.  Target has two
	possible meanings: a machine serving <acronym class="acronym">iSCSI</acronym>
	or a named group of <acronym class="acronym">LUNs</acronym>.  This example
	uses the latter meaning, where
	<code class="literal">iqn.2012-06.com.example:target0</code> is the
	target name.  This target name is suitable for testing
	purposes.  For actual use, change
	<code class="literal">com.example</code> to the real domain name,
	reversed.  The <code class="literal">2012-06</code> represents the year
	and month of acquiring control of that domain name, and
	<code class="literal">target0</code> can be any value.  Any number of
	targets can be defined in this configuration file.</p><p>The <code class="literal">auth-group no-authentication</code> line
	allows all initiators to connect to the specified target and
	<code class="literal">portal-group pg0</code> makes the target reachable
	through the <code class="literal">pg0</code> portal group.</p><p>The next section defines the <acronym class="acronym">LUN</acronym>.  To
	the initiator, each <acronym class="acronym">LUN</acronym> will be visible as
	a separate disk device.  Multiple <acronym class="acronym">LUNs</acronym> can
	be defined for each target.  Each <acronym class="acronym">LUN</acronym> is
	identified by a number, where <acronym class="acronym">LUN</acronym> 0 is
	mandatory.  The <code class="literal">path /data/target0-0</code> line
	defines the full path to a file or zvol backing the
	<acronym class="acronym">LUN</acronym>.  That path must exist before starting
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a>.  The second line is optional and specifies the
	size of the <acronym class="acronym">LUN</acronym>.</p><p>Next, to make sure the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon is started at
	boot, add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ctld_enable="YES"</pre><p>To start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> now, run this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service ctld start</code></strong></pre><p>As the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ctld&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ctld</span>(8)</span></a> daemon is started, it reads
	<code class="filename">/etc/ctl.conf</code>.  If this file is edited
	after the daemon starts, use this command so that the changes
	take effect immediately:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service ctld reload</code></strong></pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69331064"></a>29.12.1.1. Authentication</h4></div></div></div><p>The previous example is inherently insecure as it uses
	  no authentication, granting anyone full access to all
	  targets.  To require a username and password to access
	  targets, modify the configuration as follows:</p><pre class="programlisting">auth-group ag0 {
	chap username1 secretsecret
	chap username2 anothersecret
}

portal-group pg0 {
	discovery-auth-group no-authentication
	listen 0.0.0.0
	listen [::]
}

target iqn.2012-06.com.example:target0 {
	auth-group ag0
	portal-group pg0
	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre><p>The <code class="literal">auth-group</code> section defines
	  username and password pairs.  An initiator trying to connect
	  to <code class="literal">iqn.2012-06.com.example:target0</code> must
	  first specify a defined username and secret.  However,
	  target discovery is still permitted without authentication.
	  To require target discovery authentication, set
	  <code class="literal">discovery-auth-group</code> to a defined
	  <code class="literal">auth-group</code> name instead of
	  <code class="literal">no-authentication</code>.</p><p>It is common to define a single exported target for
	  every initiator.  As a shorthand for the syntax above, the
	  username and password can be specified directly in the
	  target entry:</p><pre class="programlisting">target iqn.2012-06.com.example:target0 {
	portal-group pg0
	chap username1 secretsecret

	lun 0 {
		path /data/target0-0
		size 4G
	}
}</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-iscsi-initiator"></a>29.12.2. Configuring an <acronym class="acronym">iSCSI</acronym> Initiator</h3></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <acronym class="acronym">iSCSI</acronym> initiator described in this
	  section is supported starting with FreeBSD 10.0-RELEASE.  To
	  use the <acronym class="acronym">iSCSI</acronym> initiator available in
	  older versions, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iscontrol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iscontrol</span>(8)</span></a>.</p></div><p>The <acronym class="acronym">iSCSI</acronym> initiator requires that the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iscsid</span>(8)</span></a> daemon is running.  This daemon does not use a
	configuration file.  To start it automatically at boot, add
	this line to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">iscsid_enable="YES"</pre><p>To start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iscsid</span>(8)</span></a> now, run this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service iscsid start</code></strong></pre><p>Connecting to a target can be done with or without an
	<code class="filename">/etc/iscsi.conf</code> configuration file.  This
	section demonstrates both types of connections.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69344504"></a>29.12.2.1. Connecting to a Target Without a Configuration
	  File</h4></div></div></div><p>To connect an initiator to a single target, specify the
	  <acronym class="acronym">IP</acronym> address of the portal and the name of
	  the target:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iscsictl -A -p <em class="replaceable"><code>10.10.10.10</code></em> -t <em class="replaceable"><code>iqn.2012-06.com.example:target0</code></em></code></strong></pre><p>To verify if the connection succeeded, run
	  <code class="command">iscsictl</code> without any arguments.  The
	  output should look similar to this:</p><pre class="programlisting">Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Connected: da0</pre><p>In this example, the <acronym class="acronym">iSCSI</acronym> session
	  was successfully established, with
	  <code class="filename">/dev/da0</code> representing the attached
	  <acronym class="acronym">LUN</acronym>.  If the
	  <code class="literal">iqn.2012-06.com.example:target0</code> target
	  exports more than one <acronym class="acronym">LUN</acronym>, multiple
	  device nodes will be shown in that section of the
	  output:</p><pre class="screen">Connected: da0 da1 da2.</pre><p>Any errors will be reported in the output, as well as
	  the system logs.  For example, this message usually means
	  that the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=iscsid&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">iscsid</span>(8)</span></a> daemon is not running:</p><pre class="programlisting">Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Waiting for iscsid(8)</pre><p>The following message suggests a networking problem,
	  such as a wrong <acronym class="acronym">IP</acronym> address or
	  port:</p><pre class="programlisting">Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.11     Connection refused</pre><p>This message means that the specified target name is
	  wrong:</p><pre class="programlisting">Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Not found</pre><p>This message means that the target requires
	  authentication:</p><pre class="programlisting">Target name                                     Target portal   State
iqn.2012-06.com.example:target0                 10.10.10.10     Authentication failed</pre><p>To specify a <acronym class="acronym">CHAP</acronym> username and
	  secret, use this syntax:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iscsictl -A -p <em class="replaceable"><code>10.10.10.10</code></em> -t <em class="replaceable"><code>iqn.2012-06.com.example:target0</code></em> -u <em class="replaceable"><code>user</code></em> -s <em class="replaceable"><code>secretsecret</code></em></code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69362936"></a>29.12.2.2. Connecting to a Target with a Configuration
	  File</h4></div></div></div><p>To connect using a configuration file, create
	  <code class="filename">/etc/iscsi.conf</code> with contents like
	  this:</p><pre class="programlisting">t0 {
	TargetAddress   = 10.10.10.10
	TargetName      = iqn.2012-06.com.example:target0
	AuthMethod      = CHAP
	chapIName       = user
	chapSecret      = secretsecret
}</pre><p>The <code class="literal">t0</code> specifies a nickname for the
	  configuration file section.  It will be used by the
	  initiator to specify which configuration to use.  The other
	  lines specify the parameters to use during connection.  The
	  <code class="literal">TargetAddress</code> and
	  <code class="literal">TargetName</code> are mandatory, whereas the
	  other options are optional.  In this example, the
	  <acronym class="acronym">CHAP</acronym> username and secret are
	  shown.</p><p>To connect to the defined target, specify the
	  nickname:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iscsictl -An <em class="replaceable"><code>t0</code></em></code></strong></pre><p>Alternately, to connect to all targets defined in the
	  configuration file, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iscsictl -Aa</code></strong></pre><p>To make the initiator automatically connect to all
	  targets in <code class="filename">/etc/iscsi.conf</code>, add the
	  following to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">iscsictl_enable="YES"
iscsictl_flags="-Aa"</pre></div></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls"></a>Chapter 30. Firewalls</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Joseph J.</span> <span class="surname">Barbish</span></span>. </span></div><div><span class="authorgroup">Converted to SGML and updated by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Brad</span> <span class="surname">Davis</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#firewalls-intro">30.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#firewalls-concepts">30.2. Firewall Concepts</a></span></dt><dt><span class="sect1"><a href="#firewalls-pf">30.3. PF</a></span></dt><dt><span class="sect1"><a href="#firewalls-ipfw">30.4. <span class="application">IPFW</span></a></span></dt><dt><span class="sect1"><a href="#firewalls-ipf">30.5. IPFILTER (IPF)</a></span></dt><dt><span class="sect1"><a href="#firewalls-blacklistd">30.6. Blacklistd</a></span></dt></dl></div><a id="idp69394040" class="indexterm"></a><a id="idp69394552" class="indexterm"></a><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-intro"></a>30.1. Synopsis</h2></div></div></div><p>Firewalls make it possible to filter the incoming and
      outgoing traffic that flows through a system.  A firewall can
      use one or more sets of <span class="quote">&#8220;<span class="quote">rules</span>&#8221;</span> to inspect network
      packets as they come in or go out of network connections and
      either allows the traffic through or blocks it.  The rules of
      a firewall can inspect one or more characteristics of the
      packets such as the protocol type, source or destination host
      address, and source or destination port.</p><p>Firewalls can enhance the security of a host or a network.
      They can be used to do one or more of the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Protect and insulate the applications, services, and
	  machines of an internal network from unwanted traffic from
	  the public Internet.</p></li><li class="listitem"><p>Limit or disable access from hosts of the internal
	  network to services of the public Internet.</p></li><li class="listitem"><p>Support network address translation
	  (<acronym class="acronym">NAT</acronym>), which allows an internal network
	  to use private <acronym class="acronym">IP</acronym> addresses and share a
	  single connection to the public Internet using either a
	  single <acronym class="acronym">IP</acronym> address or a shared pool of
	  automatically assigned public addresses.</p></li></ul></div><p>FreeBSD has three firewalls built into the base system:
      <span class="application">PF</span>, <span class="application">IPFW</span>,
      and <span class="application">IPFILTER</span>, also known as
      <span class="application">IPF</span>.  FreeBSD also provides two traffic
      shapers for controlling bandwidth usage: <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> and
      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a>.  <span class="application">ALTQ</span> has
      traditionally been closely tied with
      <span class="application">PF</span> and
      <span class="application">dummynet</span> with
      <span class="application">IPFW</span>.  Each firewall uses rules to
      control the access of packets to and from a FreeBSD system,
      although they go about it in different ways and each has a
      different rule syntax.</p><p>FreeBSD provides multiple firewalls in order to meet the
      different requirements and preferences for a wide variety of
      users.  Each user should evaluate which firewall best meets
      their needs.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to define packet filtering rules.</p></li><li class="listitem"><p>The differences between the firewalls built into
	  FreeBSD.</p></li><li class="listitem"><p>How to use and configure the
	  <span class="application">PF</span> firewall.</p></li><li class="listitem"><p>How to use and configure the
	  <span class="application">IPFW</span> firewall.</p></li><li class="listitem"><p>How to use and configure the
	  <span class="application">IPFILTER</span> firewall.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand basic FreeBSD and Internet concepts.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Since all firewalls are based on inspecting the values of
	selected packet control fields, the creator of the firewall
	ruleset must have an understanding of how
	<acronym class="acronym">TCP/IP</acronym> works, what the different values in
	the packet control fields are, and how these values are used
	in a normal session conversation.  For a good introduction,
	refer to <a class="link" href="http://www.ipprimer.com" target="_top">Daryl's
	  TCP/IP Primer</a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-concepts"></a>30.2. Firewall Concepts</h2></div></div></div><a id="idp69420920" class="indexterm"></a><p>A ruleset contains a group of rules which pass or block
      packets based on the values contained in the packet.  The
      bi-directional exchange of packets between hosts comprises a
      session conversation.  The firewall ruleset processes both the
      packets arriving from the public Internet, as well as the
      packets produced by the system as a response to them.  Each
      <acronym class="acronym">TCP/IP</acronym> service is predefined by its protocol
      and listening port.  Packets destined for a specific service
      originate from the source address using an unprivileged port and
      target the specific service port on the destination address.
      All the above parameters can be used as selection criteria to
      create rules which will pass or block services.</p><p>To lookup unknown port numbers, refer to
      <code class="filename">/etc/services</code>.  Alternatively, visit <code class="uri"><a class="uri" href="http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers" target="_top">http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers</a></code>
      and do a port number lookup to find the purpose of a particular
      port number.</p><p>Check out this link for <code class="uri"><a class="uri" href="http://web.archive.org/web/20150803024617/http://www.sans.org/security-resources/idfaq/oddports.php" target="_top">port numbers used by Trojans</a></code>.</p><p>FTP has two modes:  active mode and passive mode.  The
      difference is in how the data channel is acquired.  Passive
      mode is more secure as the data channel is acquired by the
      ordinal ftp session requester.  For a good explanation of FTP
      and the different modes, see <code class="uri"><a class="uri" href="http://www.slacksite.com/other/ftp.html" target="_top">http://www.slacksite.com/other/ftp.html</a></code>.</p><p>A firewall ruleset can be either
      <span class="quote">&#8220;<span class="quote">exclusive</span>&#8221;</span> or <span class="quote">&#8220;<span class="quote">inclusive</span>&#8221;</span>.  An
      exclusive firewall allows all traffic through except for the
      traffic matching the ruleset.  An inclusive firewall does the
      reverse as it only allows traffic matching the rules through and
      blocks everything else.</p><p>An inclusive firewall offers better control of the outgoing
      traffic, making it a better choice for systems that offer
      services to the public Internet.  It also controls the type of
      traffic originating from the public Internet that can gain
      access to a private network.  All traffic that does not match
      the rules is blocked and logged.  Inclusive firewalls are
      generally safer than exclusive firewalls because they
      significantly reduce the risk of allowing unwanted
      traffic.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Unless noted otherwise, all configuration and example
	rulesets in this chapter create inclusive firewall
	rulesets.</p></div><p>Security can be tightened further using a <span class="quote">&#8220;<span class="quote">stateful
	firewall</span>&#8221;</span>.  This type of firewall keeps track of open
      connections and only allows traffic which either matches an
      existing connection or opens a new, allowed connection.</p><p>Stateful filtering treats traffic as a bi-directional
      exchange of packets comprising a session.  When state is
      specified on a matching rule the firewall dynamically generates
      internal rules for each anticipated packet being exchanged
      during the session.  It has sufficient matching capabilities to
      determine if a packet is valid for a session.  Any packets that
      do not properly fit the session template are automatically
      rejected.</p><p>When the session completes, it is removed from the dynamic
      state table.</p><p>Stateful filtering allows one to focus on blocking/passing
      new sessions.  If the new session is passed, all its subsequent
      packets are allowed automatically and any impostor packets are
      automatically rejected.  If a new session is blocked, none of
      its subsequent packets are allowed.  Stateful filtering provides
      advanced matching abilities capable of defending against the
      flood of different attack methods employed by attackers.</p><p><acronym class="acronym">NAT</acronym> stands for <span class="emphasis"><em>Network
	Address Translation</em></span>.  <acronym class="acronym">NAT</acronym>
      function enables the private LAN behind the firewall to share a
      single ISP-assigned IP address, even if that address is
      dynamically assigned.  NAT allows each computer in the LAN to
      have Internet access, without having to pay the ISP for multiple
      Internet accounts or IP addresses.</p><p><acronym class="acronym">NAT</acronym> will automatically translate the
      private LAN IP address for each system on the LAN to the
      single public IP address as packets exit the firewall bound for
      the public Internet.  It also performs the reverse translation
      for returning packets.</p><p>According to RFC 1918, the following IP address ranges are
      reserved for private networks which will never be routed
      directly to the public Internet, and therefore are available
      for use with NAT:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">10.0.0.0/8</code>.</p></li><li class="listitem"><p><code class="literal">172.16.0.0/12</code>.</p></li><li class="listitem"><p><code class="literal">192.168.0.0/16</code>.</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">When working with the firewall rules, be <span class="emphasis"><em>very
	  careful</em></span>.  Some configurations <span class="emphasis"><em>can
	  lock the administrator out</em></span> of the server.  To be
	on the safe side, consider performing the initial firewall
	configuration from the local console rather than doing it
	remotely over <span class="application">ssh</span>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-pf"></a>30.3. PF</h2></div><div><span class="authorgroup">Revised and updated by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">John</span> <span class="surname">Ferrell</span></span>. </span></div></div></div><a id="idp69458040" class="indexterm"></a><p>Since FreeBSD 5.3, a ported version of OpenBSD's
      <span class="application">PF</span> firewall has been included as an
      integrated part of the base system.
      <span class="application">PF</span> is a complete, full-featured
      firewall that has optional support for
      <span class="application">ALTQ</span> (Alternate Queuing), which
      provides Quality of Service (<acronym class="acronym">QoS</acronym>).</p><p>The OpenBSD Project maintains the definitive reference for
      <span class="application">PF</span> in the <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">PF FAQ</a>.
      Peter Hansteen maintains a thorough
      <span class="application">PF</span> tutorial at <a class="link" href="http://home.nuug.no/~peter/pf/" target="_top">http://home.nuug.no/~peter/pf/</a>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">When reading the <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">PF FAQ</a>,
	keep in mind that FreeBSD's version of
	<span class="application">PF</span> has diverged substantially from
	the upstream OpenBSD version over the years.  Not all features
	work the same way on FreeBSD as they do in OpenBSD and vice
	versa.</p></div><p>The <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf" target="_top">FreeBSD packet filter mailing list</a> is a good place to ask questions about
      configuring and running the <span class="application">PF</span>
      firewall.  Check the mailing list archives before asking a
      question as it may have already been answered.</p><p>This section of the Handbook focuses on
      <span class="application">PF</span> as it pertains to FreeBSD.  It
      demonstrates how to enable <span class="application">PF</span> and
      <span class="application">ALTQ</span>.  It also provides several
      examples for creating rulesets on a FreeBSD system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69472120"></a>30.3.1. Enabling <span class="application">PF</span></h3></div></div></div><p>To use <span class="application">PF</span>, its kernel
	module must be first loaded.  This section describes the
	entries that can be added to <code class="filename">/etc/rc.conf</code>
	to enable <span class="application">PF</span>.</p><p>Start by adding <code class="literal">pf_enable=yes</code> to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc pf_enable=yes</code></strong></pre><p>Additional options, described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a>, can be
	passed to <span class="application">PF</span> when it is started.
	Add or change this entry in <code class="filename">/etc/rc.conf</code>
	and specify any required flags between the two quotes
	(<code class="literal">""</code>):</p><pre class="programlisting">pf_flags=""                     # additional flags for pfctl startup</pre><p><span class="application">PF</span> will not start if it cannot
	find its ruleset configuration file.  By default, FreeBSD does
	not ship with a ruleset and there is no
	<code class="filename">/etc/pf.conf</code>.  Example rulesets can be
	found in <code class="filename">/usr/share/examples/pf/</code>.  If a
	custom ruleset has been saved somewhere else, add a line to
	<code class="filename">/etc/rc.conf</code> which specifies the full
	path to the file:</p><pre class="programlisting">pf_rules="<em class="replaceable"><code>/path/to/pf.conf</code></em>"</pre><p>Logging support for <span class="application">PF</span> is
	provided by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pflog&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pflog</span>(4)</span></a>.  To enable logging support, add
	<code class="literal">pflog_enable=yes</code> to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc pflog_enable=yes</code></strong></pre><p>The following lines can also be added to change the
	default location of the log file or to specify any additional
	flags to pass to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pflog&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pflog</span>(4)</span></a> when it is started:</p><pre class="programlisting">pflog_logfile="/var/log/pflog"  # where pflogd should store the logfile
pflog_flags=""                  # additional flags for pflogd startup</pre><p>Finally, if there is a <acronym class="acronym">LAN</acronym> behind the
	firewall and packets need to be forwarded for the computers on
	the <acronym class="acronym">LAN</acronym>, or <acronym class="acronym">NAT</acronym> is
	required, enable the following option:</p><pre class="programlisting">gateway_enable="YES"            # Enable as LAN gateway</pre><p>After saving the needed edits,
	<span class="application">PF</span> can be started with logging
	support by typing:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service pf start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service pflog start</code></strong></pre><p>By default, <span class="application">PF</span> reads its
	configuration rules from <code class="filename">/etc/pf.conf</code> and
	modifies, drops, or passes packets according to the rules or
	definitions specified in this file.  The FreeBSD installation
	includes several sample files located in
	<code class="filename">/usr/share/examples/pf/</code>.  Refer to the
	<a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">PF
	  FAQ</a> for complete coverage
	of <span class="application">PF</span> rulesets.</p><p>To control <span class="application">PF</span>, use
	<code class="command">pfctl</code>.  <a class="xref" href="#pfctl" title="Table 30.1. Useful pfctl Options">Table 30.1, &#8220;Useful <code class="command">pfctl</code> Options&#8221;</a> summarizes
	some useful options to this command.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a>
	for a description of all available options:</p><div class="table"><a id="pfctl"></a><div class="table-title">Table 30.1. Useful <code class="command">pfctl</code> Options</div><div class="table-contents"><table class="table" summary="Useful pfctl Options" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Command</th><th>Purpose</th></tr></thead><tbody><tr><td><code class="command">pfctl
		  -e</code></td><td>Enable <span class="application">PF</span>.</td></tr><tr><td><code class="command">pfctl
		  -d</code></td><td>Disable <span class="application">PF</span>.</td></tr><tr><td><code class="command">pfctl -F all
		  -f /etc/pf.conf</code></td><td>Flush all <acronym class="acronym">NAT</acronym>, filter, state,
		and table rules and reload
		<code class="filename">/etc/pf.conf</code>.</td></tr><tr><td><code class="command">pfctl -s [ rules | nat |
		  states ]</code></td><td>Report on the filter rules,
		<acronym class="acronym">NAT</acronym> rules, or state
		table.</td></tr><tr><td><code class="command">pfctl -vnf
		  /etc/pf.conf</code></td><td>Check <code class="filename">/etc/pf.conf</code> for
		errors, but do not load ruleset.</td></tr></tbody></table></div></div><br class="table-break" /><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml"><a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/sudo/pkg-descr">security/sudo</a> is useful for running
	  commands like <code class="command">pfctl</code> that require elevated
	  privileges.  It can be installed from the Ports
	  Collection.</p></div><p>To keep an eye on the traffic that passes through the
	<span class="application">PF</span> firewall, consider installing
	the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/sysutils/pftop/pkg-descr">sysutils/pftop</a> package or port.  Once
	installed, <span class="application">pftop</span> can be run to
	view a running snapshot of traffic in a format which is
	similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pf-tutorial"></a>30.3.2. <span class="application">PF</span> Rulesets</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Peter</span> <span class="othername">N. M.</span> <span class="surname">Hansteen</span></span>. </span></div></div></div><p>This section demonstrates how to create a customized
	ruleset.  It starts with the simplest of rulesets and builds
	upon its concepts using several examples to demonstrate
	real-world usage of <span class="application">PF</span>'s many
	features.</p><p>The simplest possible ruleset is for a single machine
	that does not run any services and which needs access to one
	network, which may be the Internet.  To create this minimal
	ruleset, edit <code class="filename">/etc/pf.conf</code> so it looks
	like this:</p><pre class="programlisting">block in all
pass out all keep state</pre><p>The first rule denies all incoming traffic by default.
	The second rule allows connections created by this system to
	pass out, while retaining state information on those
	connections.  This state information allows return traffic for
	those connections to pass back and should only be used on
	machines that can be trusted.  The ruleset can be loaded
	with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -e ; pfctl -f /etc/pf.conf</code></strong></pre><p>In addition to keeping state,
	<span class="application">PF</span> provides
	<em class="firstterm">lists</em> and
	<em class="firstterm">macros</em> which can be defined for use
	when creating rules.  Macros can include lists and need to be
	defined before use.  As an example, insert these lines at the
	very top of the ruleset:</p><pre class="programlisting">tcp_services = "{ ssh, smtp, domain, www, pop3, auth, pop3s }"
udp_services = "{ domain }"</pre><p><span class="application">PF</span> understands port names as
	well as port numbers, as long as the names are listed in
	<code class="filename">/etc/services</code>.  This example creates two
	macros.  The first is a list of seven
	<acronym class="acronym">TCP</acronym> port names and the second is one
	<acronym class="acronym">UDP</acronym> port name.  Once defined, macros can be
	used in rules.  In this example, all traffic is blocked except
	for the  connections initiated by this system for the seven
	specified <acronym class="acronym">TCP</acronym> services and the one
	specified <acronym class="acronym">UDP</acronym> service:</p><pre class="programlisting">tcp_services = "{ ssh, smtp, domain, www, pop3, auth, pop3s }"
udp_services = "{ domain }"
block all
pass out proto tcp to any port $tcp_services keep state
pass proto udp to any port $udp_services keep state</pre><p>Even though <acronym class="acronym">UDP</acronym> is considered to be a
	stateless protocol, <span class="application">PF</span> is able to
	track some state information.  For example, when a
	<acronym class="acronym">UDP</acronym> request is passed which asks a name
	server about a domain name, <span class="application">PF</span> will
	watch for the response to pass it back.</p><p>Whenever an edit is made to a ruleset, the new rules must
	be loaded so they can be used:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -f /etc/pf.conf</code></strong></pre><p>If there are no syntax errors, <code class="command">pfctl</code>
	will not output any messages during the rule load.  Rules can
	also be tested before attempting to load them:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -nf /etc/pf.conf</code></strong></pre><p>Including <code class="option">-n</code> causes the rules to be
	interpreted only, but not loaded.  This provides an
	opportunity to correct any errors.  At all times, the last
	valid ruleset loaded will be enforced until either
	<span class="application">PF</span> is disabled or a new ruleset is
	loaded.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Adding <code class="option">-v</code> to a <code class="command">pfctl</code>
	  ruleset verify or load will display the fully parsed rules
	  exactly the way they will be loaded.  This is extremely
	  useful when debugging rules.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-gateway"></a>30.3.2.1. A Simple Gateway with NAT</h4></div></div></div><p>This section demonstrates how to configure a FreeBSD system
	  running <span class="application">PF</span> to act as a gateway
	  for at least one other machine.  The gateway needs at least
	  two network interfaces, each connected to a separate
	  network.  In this example, <code class="filename">xl0</code> is
	  connected to the Internet and <code class="filename">xl1</code> is
	  connected to the internal network.</p><p>First, enable the gateway to let the machine
	  forward the network traffic it receives on one interface to
	  another interface.  This <span class="application">sysctl</span>
	  setting will forward <acronym class="acronym">IPv4</acronym> packets:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet.ip.forwarding=1</code></strong></pre><p>To forward <acronym class="acronym">IPv6</acronym> traffic, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet6.ip6.forwarding=1</code></strong></pre><p>To enable these settings at system boot, use
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysrc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysrc</span>(8)</span></a> to add them to
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc gateway_enable=yes</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysrc ipv6_gateway_enable=yes</code></strong></pre><p>Verify with <code class="command">ifconfig</code> that both of the
	  interfaces are up and running.</p><p>Next, create the <span class="application">PF</span> rules to
	  allow the gateway to pass traffic.  While the following rule
	  allows stateful traffic from hosts of the internal network
	  to pass to the gateway, the <code class="literal">to</code> keyword
	  does not guarantee passage all the way from source to
	  destination:</p><pre class="programlisting">pass in on xl1 from xl1:network to xl0:network port $ports keep state</pre><p>That rule only lets the traffic pass in to the gateway
	  on the internal interface.  To let the packets go further, a
	  matching rule is needed:</p><pre class="programlisting">pass out on xl0 from xl1:network to xl0:network port $ports keep state</pre><p>While these two rules will work, rules this specific are
	  rarely needed.  For a busy network admin, a readable ruleset
	  is a safer ruleset.  The remainder of this section
	  demonstrates how to keep the rules as simple as possible for
	  readability.  For example, those two rules could be
	  replaced with one rule:</p><pre class="programlisting">pass from xl1:network to any port $ports keep state</pre><p>The <code class="literal">interface:network</code> notation can be
	  replaced with a macro to make the ruleset even more
	  readable.  For example, a <code class="literal">$localnet</code> macro
	  could be defined as the network directly attached to the
	  internal interface (<code class="literal">$xl1:network</code>).
	  Alternatively, the definition of
	  <code class="literal">$localnet</code> could be changed to an
	  <span class="emphasis"><em>IP address/netmask</em></span> notation to denote
	  a network, such as <code class="literal">192.168.100.1/24</code> for a
	  subnet of private addresses.</p><p>If required, <code class="literal">$localnet</code> could even be
	  defined as a list of networks.  Whatever the specific needs,
	  a sensible <code class="literal">$localnet</code> definition could be
	  used in a typical pass rule as follows:</p><pre class="programlisting">pass from $localnet to any port $ports keep state</pre><p>The following sample ruleset allows all traffic
	  initiated by machines on the internal network.  It first
	  defines two macros to represent the external and internal
	  3COM interfaces of the gateway.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">For dialup users, the external interface will use
	    <code class="filename">tun0</code>.  For an
	    <acronym class="acronym">ADSL</acronym> connection, specifically those
	    using <acronym class="acronym">PPP</acronym> over Ethernet
	    (<acronym class="acronym">PPPoE</acronym>), the correct external
	    interface is <code class="filename">tun0</code>, not the physical
	    Ethernet interface.</p></div><pre class="programlisting">ext_if = "xl0"	# macro for external interface - use tun0 for PPPoE
int_if = "xl1"	# macro for internal interface
localnet = $int_if:network
# ext_if IP address could be dynamic, hence ($ext_if)
nat on $ext_if from $localnet to any -&gt; ($ext_if)
block all
pass from { lo0, $localnet } to any keep state</pre><p>This ruleset introduces the <code class="literal">nat</code> rule
	  which is used to handle the network address translation from
	  the non-routable addresses inside the internal network to
	  the <acronym class="acronym">IP</acronym> address assigned to the external
	  interface.  The parentheses surrounding the last part of the
	  nat rule <code class="literal">($ext_if)</code> is included when the
	  <acronym class="acronym">IP</acronym> address of the external interface is
	  dynamically assigned.  It ensures that network traffic runs
	  without serious interruptions even if the external
	  <acronym class="acronym">IP</acronym> address changes.</p><p>Note that this ruleset probably allows more traffic to
	  pass out of the network than is needed.  One reasonable
	  setup could create this macro:</p><pre class="programlisting">client_out = "{ ftp-data, ftp, ssh, domain, pop3, auth, nntp, http, \
    https, cvspserver, 2628, 5999, 8000, 8080 }"</pre><p>to use in the main pass rule:</p><pre class="programlisting">pass inet proto tcp from $localnet to any port $client_out \
    flags S/SA keep state</pre><p>A few other pass rules may be needed.  This one enables
	  <acronym class="acronym">SSH</acronym> on the external interface:</p><pre class="programlisting">pass in inet proto tcp to $ext_if port ssh</pre><p>This macro definition and rule allows
	  <acronym class="acronym">DNS</acronym> and <acronym class="acronym">NTP</acronym> for
	  internal clients:</p><pre class="programlisting">udp_services = "{ domain, ntp }"
pass quick inet proto { tcp, udp } to any port $udp_services keep state</pre><p>Note the <code class="literal">quick</code> keyword in this rule.
	  Since the ruleset consists of several rules, it is important
	  to understand the relationships between the rules in a
	  ruleset.  Rules are evaluated from top to bottom, in the
	  sequence they are written.  For each packet or connection
	  evaluated by <span class="application">PF</span>,
	  <span class="emphasis"><em>the last matching rule</em></span> in the ruleset
	  is the one which is applied.  However, when a packet matches
	  a rule which contains the <code class="literal">quick</code> keyword,
	  the rule processing stops and the packet is treated
	  according to that rule.  This is very useful when an
	  exception to the general rules is needed.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-ftp"></a>30.3.2.2. Creating an <acronym class="acronym">FTP</acronym> Proxy</h4></div></div></div><p>Configuring working <acronym class="acronym">FTP</acronym> rules can be
	  problematic due to the nature of the <acronym class="acronym">FTP</acronym>
	  protocol.  <acronym class="acronym">FTP</acronym> pre-dates firewalls by
	  several decades and is insecure in its design.  The most
	  common points against using <acronym class="acronym">FTP</acronym>
	  include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Passwords are transferred in the clear.</p></li><li class="listitem"><p>The protocol demands the use of at least two
	      <acronym class="acronym">TCP</acronym> connections (control and data) on
	      separate ports.</p></li><li class="listitem"><p>When a session is established, data is communicated
	      using randomly selected ports.</p></li></ul></div><p>All of these points present security challenges, even
	  before considering any potential security weaknesses in
	  client or server software.  More secure alternatives for
	  file transfer exist, such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sftp</span>(1)</span></a> or <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>,
	  which both feature authentication and data transfer over
	  encrypted connections..</p><p>For those situations when <acronym class="acronym">FTP</acronym> is
	  required, <span class="application">PF</span> provides
	  redirection of <acronym class="acronym">FTP</acronym> traffic to a small
	  proxy program called <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftp-proxy</span>(8)</span></a>, which is included in
	  the base system of FreeBSD.  The role of the proxy is to
	  dynamically insert and delete rules in the ruleset, using a
	  set of anchors, to correctly handle
	  <acronym class="acronym">FTP</acronym> traffic.</p><p>To enable the <acronym class="acronym">FTP</acronym> proxy, add this
	  line to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ftpproxy_enable="YES"</pre><p>Then start the proxy by running <code class="command">service
	    ftp-proxy start</code>.</p><p>For a basic configuration, three elements need to be
	  added to <code class="filename">/etc/pf.conf</code>.  First, the
	  anchors which the proxy will use to insert the rules it
	  generates for the <acronym class="acronym">FTP</acronym> sessions:</p><pre class="programlisting">nat-anchor "ftp-proxy/*"
rdr-anchor "ftp-proxy/*"</pre><p>Second, a pass rule is needed to allow
	  <acronym class="acronym">FTP</acronym> traffic in to the proxy.</p><p>Third, redirection and <acronym class="acronym">NAT</acronym> rules need
	  to be defined before the filtering rules.  Insert this
	  <code class="literal">rdr</code> rule immediately after the
	  <code class="literal">nat</code> rule:</p><pre class="programlisting">rdr pass on $int_if proto tcp from any to any port ftp -&gt; 127.0.0.1 port 8021</pre><p>Finally, allow the redirected traffic to pass:</p><pre class="programlisting">pass out proto tcp from $proxy to any port ftp</pre><p>where <code class="literal">$proxy</code> expands to the address
	  the proxy daemon is bound to.</p><p>Save <code class="filename">/etc/pf.conf</code>, load the new
	  rules, and verify from a client that <acronym class="acronym">FTP</acronym>
	  connections are working:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -f /etc/pf.conf</code></strong></pre><p>This example covers a basic setup where the clients in
	  the local network need to contact <acronym class="acronym">FTP</acronym>
	  servers elsewhere.  This basic configuration should
	  work well with most combinations of <acronym class="acronym">FTP</acronym>
	  clients and servers.  As shown in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftp-proxy</span>(8)</span></a>, the
	  proxy's behavior can be changed in various ways by adding
	  options to the <code class="literal">ftpproxy_flags=</code> line.
	  Some clients or servers may have specific quirks that must
	  be compensated for in the configuration, or there may be a
	  need to integrate the proxy in specific ways such as
	  assigning <acronym class="acronym">FTP</acronym> traffic to a specific
	  queue.</p><p>For ways to run an <acronym class="acronym">FTP</acronym> server
	  protected by <span class="application">PF</span> and
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftp-proxy</span>(8)</span></a>, configure a separate
	  <code class="command">ftp-proxy</code> in reverse mode, using
	  <code class="option">-R</code>, on a separate port with its own
	  redirecting pass rule.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-icmp"></a>30.3.2.3. Managing <acronym class="acronym">ICMP</acronym></h4></div></div></div><p>Many of the tools used for debugging or troubleshooting
	  a <acronym class="acronym">TCP/IP</acronym> network rely on the Internet
	  Control Message Protocol (<acronym class="acronym">ICMP</acronym>), which
	  was designed specifically with debugging in mind.</p><p>The <acronym class="acronym">ICMP</acronym> protocol sends and receives
	  <span class="emphasis"><em>control messages</em></span> between hosts and
	  gateways, mainly to provide feedback to a sender about any
	  unusual or difficult conditions enroute to the target host.
	  Routers use <acronym class="acronym">ICMP</acronym> to negotiate packet
	  sizes and other transmission parameters in a process often
	  referred to as <span class="emphasis"><em>path <acronym class="acronym">MTU</acronym>
	    discovery</em></span>.</p><p>From a firewall perspective, some
	  <acronym class="acronym">ICMP</acronym> control messages are vulnerable to
	  known attack vectors.  Also, letting all diagnostic traffic
	  pass unconditionally makes debugging easier, but it also
	  makes it easier for others to extract information about the
	  network.  For these reasons, the following rule may not be
	  optimal:</p><pre class="programlisting">pass inet proto icmp from any to any</pre><p>One solution is to let all <acronym class="acronym">ICMP</acronym>
	  traffic from the local network through while stopping all
	  probes from outside the network:</p><pre class="programlisting">pass inet proto icmp from $localnet to any keep state
pass inet proto icmp from any to $ext_if keep state</pre><p>Additional options are available which demonstrate some
	  of <span class="application">PF</span>'s flexibility.  For
	  example, rather than allowing all <acronym class="acronym">ICMP</acronym>
	  messages, one can specify the messages used by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>
	  and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">traceroute</span>(8)</span></a>.  Start by defining a macro for that
	  type of message:</p><pre class="programlisting">icmp_types = "echoreq"</pre><p>and a rule which uses the macro:</p><pre class="programlisting">pass inet proto icmp all icmp-type $icmp_types keep state</pre><p>If other types of <acronym class="acronym">ICMP</acronym> packets are
	  needed, expand <code class="literal">icmp_types</code> to a list of
	  those packet types.  Type <code class="command">more
	    /usr/src/sbin/pfctl/pfctl_parser.c</code> to see
	  the list of <acronym class="acronym">ICMP</acronym> message types supported
	  by <span class="application">PF</span>.  Refer to <a class="link" href="http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml" target="_top">http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml</a>
	  for an explanation of each message type.</p><p>Since Unix <code class="command">traceroute</code> uses
	  <acronym class="acronym">UDP</acronym> by default, another rule is needed to
	  allow Unix <code class="command">traceroute</code>:</p><pre class="programlisting"># allow out the default range for traceroute(8):
pass out on $ext_if inet proto udp from any to any port 33433 &gt;&lt; 33626 keep state</pre><p>Since <code class="command">TRACERT.EXE</code> on Microsoft
	  Windows systems uses <acronym class="acronym">ICMP</acronym> echo request
	  messages, only the first rule is needed to allow network
	  traces from those systems.  Unix
	  <code class="command">traceroute</code> can be instructed to use other
	  protocols as well, and will use <acronym class="acronym">ICMP</acronym> echo
	  request messages if <code class="option">-I</code> is used.  Check the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">traceroute</span>(8)</span></a> man page for details.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-pathmtudisc"></a>30.3.2.3.1. Path <acronym class="acronym">MTU</acronym> Discovery</h5></div></div></div><p>Internet protocols are designed to be device
	    independent, and one consequence of device independence is
	    that the optimal packet size for a given connection cannot
	    always be predicted reliably.  The main constraint on
	    packet size is the <em class="firstterm">Maximum Transmission
	      Unit</em> (<acronym class="acronym">MTU</acronym>) which sets the
	    upper limit on the packet size for an interface.  Type
	    <code class="command">ifconfig</code> to view the
	    <acronym class="acronym">MTU</acronym>s for a system's network
	    interfaces.</p><p><acronym class="acronym">TCP/IP</acronym> uses a process known as path
	    <acronym class="acronym">MTU</acronym> discovery to determine the right
	    packet size for a connection.  This process sends packets
	    of varying sizes with the <span class="quote">&#8220;<span class="quote">Do not fragment</span>&#8221;</span>
	    flag set, expecting an <acronym class="acronym">ICMP</acronym> return
	    packet of <span class="quote">&#8220;<span class="quote">type 3, code 4</span>&#8221;</span> when the upper
	    limit has been reached.  Type 3 means <span class="quote">&#8220;<span class="quote">destination
	      unreachable</span>&#8221;</span>, and code 4 is short for
	    <span class="quote">&#8220;<span class="quote">fragmentation needed, but the do-not-fragment flag
	      is set</span>&#8221;</span>.  To allow path MTU discovery in order
	    to support connections to other <acronym class="acronym">MTU</acronym>s,
	    add the <code class="literal">destination unreachable</code> type to
	    the <code class="literal">icmp_types</code> macro:</p><pre class="programlisting">icmp_types = "{ echoreq, unreach }"</pre><p>Since the pass rule already uses that macro, it does
	    not need to be modified to support the new
	    <acronym class="acronym">ICMP</acronym> type:</p><pre class="programlisting">pass inet proto icmp all icmp-type $icmp_types keep state</pre><p><span class="application">PF</span> allows filtering on all
	    variations of <acronym class="acronym">ICMP</acronym> types and codes.
	    The list of possible types and codes are documented in
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=icmp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">icmp</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=icmp6&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">icmp6</span>(4)</span></a>.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-tables"></a>30.3.2.4. Using Tables</h4></div></div></div><p>Some types of data are relevant to filtering and
	  redirection at a given time, but their definition is too
	  long to be included in the ruleset file.
	  <span class="application">PF</span> supports the use of tables,
	  which are defined lists that can be manipulated without
	  needing to reload the entire ruleset, and which can provide
	  fast lookups.  Table names are always enclosed within
	  <code class="literal">&lt; &gt;</code>, like this:</p><pre class="programlisting">table &lt;clients&gt; { 192.168.2.0/24, !192.168.2.5 }</pre><p>In this example, the <code class="literal">192.168.2.0/24</code>
	  network is part of the table, except for the address
	  <code class="literal">192.168.2.5</code>, which is excluded using the
	  <code class="literal">!</code> operator.  It is also possible to load
	  tables from files where each item is on a separate line, as
	  seen in this example
	  <code class="filename">/etc/clients</code>:</p><pre class="programlisting">192.168.2.0/24
!192.168.2.5</pre><p>To refer to the file, define the table like this:</p><pre class="programlisting">table &lt;clients&gt; persist file "/etc/clients"</pre><p>Once the table is defined, it can be referenced by a
	  rule:</p><pre class="programlisting">pass inet proto tcp from &lt;clients&gt; to any port $client_out flags S/SA keep state</pre><p>A table's contents can be manipulated live, using
	  <code class="command">pfctl</code>.  This example adds another network
	  to the table:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -t clients -T add 192.168.1.0/16</code></strong></pre><p>Note that any changes made this way will take affect
	  now, making them ideal for testing, but will not survive a
	  power failure or reboot.  To make the changes permanent,
	  modify the definition of the table in the ruleset or edit
	  the file that the table refers to.  One can maintain the
	  on-disk copy of the table using a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> job which
	  dumps the table's contents to disk at regular intervals,
	  using a command such as <code class="command">pfctl -t clients -T show
	    &gt;/etc/clients</code>.  Alternatively,
	  <code class="filename">/etc/clients</code> can be updated with the
	  in-memory table contents:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -t clients -T replace -f /etc/clients</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-overload"></a>30.3.2.5. Using Overload Tables to Protect
	  <acronym class="acronym">SSH</acronym></h4></div></div></div><p>Those who run <acronym class="acronym">SSH</acronym> on an external
	  interface have probably seen something like this in the
	  authentication logs:</p><pre class="programlisting">Sep 26 03:12:34 skapet sshd[25771]: Failed password for root from 200.72.41.31 port 40992 ssh2
Sep 26 03:12:34 skapet sshd[5279]: Failed password for root from 200.72.41.31 port 40992 ssh2
Sep 26 03:12:35 skapet sshd[5279]: Received disconnect from 200.72.41.31: 11: Bye Bye
Sep 26 03:12:44 skapet sshd[29635]: Invalid user admin from 200.72.41.31
Sep 26 03:12:44 skapet sshd[24703]: input_userauth_request: invalid user admin
Sep 26 03:12:44 skapet sshd[24703]: Failed password for invalid user admin from 200.72.41.31 port 41484 ssh2</pre><p>This is indicative of a brute force attack where
	  somebody or some program is trying to discover the user name
	  and password which will let them into the system.</p><p>If external <acronym class="acronym">SSH</acronym> access is needed for
	  legitimate users, changing the default port used by
	  <acronym class="acronym">SSH</acronym> can offer some protection.  However,
	  <span class="application">PF</span> provides a more elegant
	  solution.  Pass rules can contain limits on what connecting
	  hosts can do and violators can be banished to a table of
	  addresses which are denied some or all access.  It is even
	  possible to drop all existing connections from machines
	  which overreach the limits.</p><p>To configure this, create this table in the tables
	  section of the ruleset:</p><pre class="programlisting">table &lt;bruteforce&gt; persist</pre><p>Then, somewhere early in the ruleset, add rules to block
	  brute access while allowing legitimate access:</p><pre class="programlisting">block quick from &lt;bruteforce&gt;
pass inet proto tcp from any to $localnet port $tcp_services \
    flags S/SA keep state \
    (max-src-conn <em class="replaceable"><code>100</code></em>, max-src-conn-rate <em class="replaceable"><code>15/5</code></em>, \
    overload &lt;bruteforce&gt; flush global)</pre><p>The part in parentheses defines the limits and the
	  numbers should be changed to meet local requirements.  It
	  can be read as follows:</p><p><code class="literal">max-src-conn</code> is the number of
	  simultaneous connections allowed from one host.</p><p><code class="literal">max-src-conn-rate</code> is the rate of new
	  connections allowed from any single host
	  (<em class="replaceable"><code>15</code></em>) per number of seconds
	  (<em class="replaceable"><code>5</code></em>).</p><p><code class="literal">overload &lt;bruteforce&gt;</code> means
	  that any host which exceeds these limits gets its address
	  added to the <code class="literal">bruteforce</code> table.  The
	  ruleset blocks all traffic from addresses in the
	  <code class="literal">bruteforce</code> table.</p><p>Finally, <code class="literal">flush global</code> says that when
	  a host reaches the limit, that all
	  (<code class="literal">global</code>) of that host's connections will
	  be terminated (<code class="literal">flush</code>).</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">These rules will <span class="emphasis"><em>not</em></span> block slow
	    bruteforcers, as described in <a class="link" href="http://home.nuug.no/~peter/hailmary2013/" target="_top">http://home.nuug.no/~peter/hailmary2013/</a>.</p></div><p>This example ruleset is intended mainly as an
	  illustration.  For example, if a generous number of
	  connections in general are wanted, but the desire is to be
	  more restrictive when it comes to
	  <span class="application">ssh</span>, supplement the rule above
	  with something like the one below, early on in the rule
	  set:</p><pre class="programlisting">pass quick proto { tcp, udp } from any to any port ssh \
    flags S/SA keep state \
    (max-src-conn 15, max-src-conn-rate 5/3, \
    overload &lt;bruteforce&gt; flush global)</pre><div xmlns="" class="note"><h3 class="admontitle">It May Not be Necessary to Block All
	    Overloaders: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is worth noting that the overload mechanism is a
	    general technique which does not apply exclusively to
	    <acronym class="acronym">SSH</acronym>, and it is not always optimal to
	    entirely block all traffic from offenders.</p><p xmlns="http://www.w3.org/1999/xhtml">For example, an overload rule could be used to
	    protect a mail service or a web service, and the overload
	    table could be used in a rule to assign offenders to a
	    queue with a minimal bandwidth allocation or to redirect
	    to a specific web page.</p></div><p>Over time, tables will be filled by overload rules and
	  their size will grow incrementally, taking up more memory.
	  Sometimes an <acronym class="acronym">IP</acronym> address that is blocked
	  is a dynamically assigned one, which has since been assigned
	  to a host who has a legitimate reason to communicate with
	  hosts in the local network.</p><p>For situations like these,
	  <span class="application">pfctl</span> provides the ability to
	  expire table entries.  For example, this command will remove
	  <code class="literal">&lt;bruteforce&gt;</code> table entries which
	  have not been referenced for <code class="literal">86400</code>
	  seconds:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -t bruteforce -T expire 86400</code></strong></pre><p>Similar functionality is provided by
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/expiretable/pkg-descr">security/expiretable</a>, which removes table
	  entries which have not been accessed for a specified period
	  of time.</p><p>Once installed, <span class="application">expiretable</span>
	  can be run to remove <code class="literal">&lt;bruteforce&gt;</code>
	  table entries older than a specified age.  This example
	  removes all entries older than 24 hours:</p><pre class="programlisting">/usr/local/sbin/expiretable -v -d -t 24h bruteforce</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-spamd"></a>30.3.2.6. Protecting Against <acronym class="acronym">SPAM</acronym></h4></div></div></div><p>Not to be confused with the
	  <span class="application">spamd</span> daemon which comes bundled
	  with <span class="application">spamassassin</span>,
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/spamd/pkg-descr">mail/spamd</a> can be configured with
	  <span class="application">PF</span> to provide an outer defense
	  against <acronym class="acronym">SPAM</acronym>.  This
	  <span class="application">spamd</span> hooks into the
	  <span class="application">PF</span> configuration using a set of
	  redirections.</p><p>Spammers tend to send a large number of messages, and
	  <acronym class="acronym">SPAM</acronym> is mainly sent from a few spammer
	  friendly networks and a large number of hijacked machines,
	  both of which are reported to
	  <em class="firstterm">blacklists</em> fairly quickly.</p><p>When an <acronym class="acronym">SMTP</acronym> connection from an
	  address in a blacklist is received,
	  <span class="application">spamd</span> presents its banner and
	  immediately switches to a mode where it answers
	  <acronym class="acronym">SMTP</acronym> traffic one byte at a time.  This
	  technique, which is intended to waste as much time as
	  possible on the spammer's end, is called
	  <em class="firstterm">tarpitting</em>.  The specific
	  implementation which uses one byte <acronym class="acronym">SMTP</acronym>
	  replies is often referred to as
	  <em class="firstterm">stuttering</em>.</p><p>This example demonstrates the basic procedure for
	  setting up <span class="application">spamd</span> with
	  automatically updated blacklists.  Refer to the man pages
	  which are installed with <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/spamd/pkg-descr">mail/spamd</a> for
	  more information.</p><div class="procedure"><a id="idp69848824"></a><div class="procedure-title">Procedure 30.1. Configuring <span class="application">spamd</span></div><ol class="procedure" type="1"><li class="step"><p>Install the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/spamd/pkg-descr">mail/spamd</a> package
	      or port.  To use <span class="application">spamd</span>'s
	      greylisting features, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fdescfs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fdescfs</span>(5)</span></a> must be mounted at
	      <code class="filename">/dev/fd</code>.  Add the following line to
	      <code class="filename">/etc/fstab</code>:</p><pre class="programlisting"> fdescfs /dev/fd fdescfs rw 0 0</pre><p>Then, mount the filesystem:</p><pre class="programlisting"><code class="prompt">#</code> <strong class="userinput"><code>mount fdescfs</code></strong></pre></li><li class="step"><p>Next, edit the <span class="application">PF</span> ruleset
	      to include:</p><pre class="programlisting">table &lt;spamd&gt; persist
table &lt;spamd-white&gt; persist
rdr pass on $ext_if inet proto tcp from &lt;spamd&gt; to \
    { $ext_if, $localnet } port smtp -&gt; 127.0.0.1 port 8025
rdr pass on $ext_if inet proto tcp from !&lt;spamd-white&gt; to \
    { $ext_if, $localnet } port smtp -&gt; 127.0.0.1 port 8025</pre><p>The two tables <code class="literal">&lt;spamd&gt;</code> and
	      <code class="literal">&lt;spamd-white&gt;</code> are essential.
	      <acronym class="acronym">SMTP</acronym> traffic from an address listed
	      in <code class="literal">&lt;spamd&gt;</code> but not in
	      <code class="literal">&lt;spamd-white&gt;</code> is redirected to
	      the <span class="application">spamd</span> daemon listening at
	      port 8025.</p></li><li class="step"><p>The next step is to configure
	      <span class="application">spamd</span> in
	      <code class="filename">/usr/local/etc/spamd.conf</code> and to
	      add some <code class="filename">rc.conf</code> parameters.</p><p>The installation of <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/mail/spamd/pkg-descr">mail/spamd</a>
	      includes a sample configuration file
	      (<code class="filename">/usr/local/etc/spamd.conf.sample</code>)
	      and a man page for <code class="filename">spamd.conf</code>.
	      Refer to these for additional configuration options
	      beyond those shown in this example.</p><p>One of the first lines in the configuration file
	      that does not begin with a <code class="literal">#</code> comment
	      sign contains the block which defines the
	      <code class="literal">all</code> list, which specifies the lists
	      to use:</p><pre class="programlisting">all:\
    :traplist:whitelist:</pre><p>This entry adds the desired blacklists, separated by
	      colons (<code class="literal">:</code>).  To use a whitelist to
	      subtract addresses from a blacklist, add the name of the
	      whitelist <span class="emphasis"><em>immediately</em></span> after the
	      name of that blacklist.  For example:
	      <code class="literal">:blacklist:whitelist:</code>.</p><p>This is followed by the specified blacklist's
	      definition:</p><pre class="programlisting">traplist:\
    :black:\
    :msg="SPAM. Your address %A has sent spam within the last 24 hours":\
    :method=http:\
    :file=www.openbsd.org/spamd/traplist.gz</pre><p>where the first line is the name of the blacklist
	      and the second line specifies the list type.  The
	      <code class="literal">msg</code> field contains the message to
	      display to blacklisted senders during the
	      <acronym class="acronym">SMTP</acronym> dialogue.  The
	      <code class="literal">method</code> field specifies how
	      <span class="application">spamd-setup</span> fetches the list
	      data; supported methods are <code class="literal">http</code>,
	      <code class="literal">ftp</code>, from a
	      <code class="literal">file</code> in a mounted file system, and
	      via <code class="literal">exec</code> of an external program.
	      Finally, the <code class="literal">file</code> field specifies
	      the name of the file <span class="application">spamd</span>
	      expects to receive.</p><p>The definition of the specified whitelist is
	      similar, but omits the <code class="literal">msg</code> field
	      since a message is not needed:</p><pre class="programlisting">whitelist:\
    :white:\
    :method=file:\
    :file=/var/mail/whitelist.txt</pre><div xmlns="" class="tip"><h3 class="admontitle">Choose Data Sources with Care: </h3><p xmlns="http://www.w3.org/1999/xhtml">Using all the blacklists in the sample
		<code class="filename">spamd.conf</code> will blacklist large
		blocks of the Internet.  Administrators need to edit
		the file to create an optimal configuration which uses
		applicable data sources and, when necessary, uses
		custom lists.</p></div><p>Next, add this entry to
	      <code class="filename">/etc/rc.conf</code>.  Additional flags are
	      described in the man page specified by the
	      comment:</p><pre class="programlisting">spamd_flags="-v" # use "" and see spamd-setup(8) for flags</pre><p>When finished, reload the ruleset, start
	      <span class="application">spamd</span> by typing
	      <code class="command">service obspamd start</code>, and complete
	      the configuration using <code class="command">spamd-setup</code>.
	      Finally, create a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> job which calls
	      <code class="command">spamd-setup</code> to update the tables at
	      reasonable intervals.</p></li></ol></div><p>On a typical gateway in front of a mail server, hosts
	  will soon start getting trapped within a few seconds to
	  several minutes.</p><p><span class="application">PF</span> also supports
	  <em class="firstterm">greylisting</em>, which temporarily
	  rejects messages from unknown hosts with
	  <em class="replaceable"><code>45n</code></em> codes.  Messages from
	  greylisted hosts which try again within a reasonable time
	  are let through.  Traffic from senders which are set up to
	  behave within the limits set by RFC 1123 and RFC 2821 are
	  immediately let through.</p><p>More information about greylisting as a technique can be
	  found at the <a class="link" href="http://www.greylisting.org/" target="_top">greylisting.org</a>
	  web site.  The most amazing thing about greylisting, apart
	  from its simplicity, is that it still works.  Spammers and
	  malware writers have been very slow to adapt to bypass this
	  technique.</p><p>The basic procedure for configuring greylisting is as
	  follows:</p><div class="procedure"><a id="idp69605624"></a><div class="procedure-title">Procedure 30.2. Configuring Greylisting</div><ol class="procedure" type="1"><li class="step"><p>Make sure that <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fdescfs&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fdescfs</span>(5)</span></a> is mounted as
	      described in Step 1 of the previous Procedure.</p></li><li class="step"><p>To run <span class="application">spamd</span> in
	      greylisting mode, add this line to
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">spamd_grey="YES"  # use spamd greylisting if YES</pre><p>Refer to the <span class="application">spamd</span> man
	      page for descriptions of additional related
	      parameters.</p></li><li class="step"><p>To complete the greylisting setup:</p><pre class="programlisting"><code class="prompt">#</code> <strong class="userinput"><code>service obspamd restart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service obspamlogd start</code></strong></pre></li></ol></div><p>Behind the scenes, the <span class="application">spamdb</span>
	  database tool and the <span class="application">spamlogd</span>
	  whitelist updater perform essential functions for the
	  greylisting feature.  <span class="application">spamdb</span> is
	  the administrator's main interface to managing the black,
	  grey, and white lists via the contents of the
	  <code class="filename">/var/db/spamdb</code> database.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-hygiene"></a>30.3.2.7. Network Hygiene</h4></div></div></div><p>This section describes how
	  <code class="literal">block-policy</code>, <code class="literal">scrub</code>,
	  and <code class="literal">antispoof</code> can be used to make the
	  ruleset behave sanely.</p><p>The <code class="literal">block-policy</code> is an option which
	  can be set in the <code class="literal">options</code> part of the
	  ruleset, which precedes the redirection and filtering rules.
	  This option determines which feedback, if any,
	  <span class="application">PF</span> sends to hosts that are
	  blocked by a rule.  The option has two possible values:
	  <code class="literal">drop</code> drops blocked packets with no
	  feedback, and <code class="literal">return</code> returns a status
	  code such as
	  <code class="computeroutput">Connection refused</code>.</p><p>If not set, the default policy is
	  <code class="literal">drop</code>.  To change the
	  <code class="literal">block-policy</code>, specify the desired
	  value:</p><pre class="programlisting">set block-policy return</pre><p>In <span class="application">PF</span>,
	  <code class="literal">scrub</code> is a keyword which enables network
	  packet normalization.  This process reassembles fragmented
	  packets and drops TCP packets that have invalid flag
	  combinations.  Enabling <code class="literal">scrub</code> provides a
	  measure of protection against certain kinds of attacks
	  based on incorrect handling of packet fragments.  A number
	  of options are available, but the simplest form is suitable
	  for most configurations:</p><pre class="programlisting">scrub in all</pre><p>Some services, such as <acronym class="acronym">NFS</acronym>, require
	  specific fragment handling options.  Refer to <a class="link" href="https://home.nuug.no/~peter/pf/en/scrub.html" target="_top">https://home.nuug.no/~peter/pf/en/scrub.html</a>
	  for more information.</p><p>This example reassembles fragments, clears the
	  <span class="quote">&#8220;<span class="quote">do not fragment</span>&#8221;</span> bit, and sets the maximum
	  segment size to 1440 bytes:</p><pre class="programlisting">scrub in all fragment reassemble no-df max-mss 1440</pre><p>The <code class="literal">antispoof</code> mechanism protects
	  against activity from spoofed or forged
	  <acronym class="acronym">IP</acronym> addresses, mainly by blocking packets
	  appearing on interfaces and in directions which are
	  logically not possible.</p><p>These rules weed out spoofed traffic coming in from the
	  rest of the world as well as any spoofed packets which
	  originate in the local network:</p><pre class="programlisting">antispoof for $ext_if
antispoof for $int_if</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pftut-unrouteables"></a>30.3.2.8. Handling Non-Routable Addresses</h4></div></div></div><p>Even with a properly configured gateway to handle
	  network address translation, one may have to compensate for
	  other people's misconfigurations.  A common misconfiguration
	  is to let traffic with non-routable addresses out to the
	  Internet.  Since traffic from non-routeable addresses can
	  play a part in several <acronym class="acronym">DoS</acronym> attack
	  techniques, consider explicitly blocking traffic from
	  non-routeable addresses from entering the network through
	  the external interface.</p><p>In this example, a macro containing non-routable
	  addresses is defined, then used in blocking rules.  Traffic
	  to and from these addresses is quietly dropped on the
	  gateway's external
	  interface.</p><pre class="programlisting">martians = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, \
	      10.0.0.0/8, 169.254.0.0/16, 192.0.2.0/24, \
	      0.0.0.0/8, 240.0.0.0/4 }"

block drop in quick on $ext_if from $martians to any
block drop out quick on $ext_if from any to $martians</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69946232"></a>30.3.3. Enabling <span class="application">ALTQ</span></h3></div></div></div><p>On FreeBSD, <span class="application">ALTQ</span> can be used with
	<span class="application">PF</span> to provide Quality of Service
	(<acronym class="acronym">QOS</acronym>).  Once
	<span class="application">ALTQ</span> is enabled, queues can be
	defined in the ruleset which determine the processing priority
	of outbound packets.</p><p>Before enabling <span class="application">ALTQ</span>, refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> to determine if the drivers for the network cards
	installed on the system support it.</p><p><span class="application">ALTQ</span> is not available as a
	loadable kernel module.  If the system's interfaces support
	<span class="application">ALTQ</span>, create a custom kernel using
	the instructions in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>.  The
	following kernel options are available.  The first is needed
	to enable <span class="application">ALTQ</span>.  At least one of
	the other options is necessary to specify the queueing
	scheduler algorithm:</p><pre class="programlisting">options         ALTQ
options         ALTQ_CBQ        # Class Based Queuing (CBQ)
options         ALTQ_RED        # Random Early Detection (RED)
options         ALTQ_RIO        # RED In/Out
options         ALTQ_HFSC       # Hierarchical Packet Scheduler (HFSC)
options         ALTQ_PRIQ       # Priority Queuing (PRIQ)</pre><p>The following scheduler algorithms are available:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CBQ</span></dt><dd><p>Class Based Queuing (<acronym class="acronym">CBQ</acronym>) is
	      used to divide a connection's bandwidth into different
	      classes or queues to prioritize traffic based on filter
	      rules.</p></dd><dt><span class="term">RED</span></dt><dd><p>Random Early Detection (<acronym class="acronym">RED</acronym>) is
	      used to avoid network congestion by measuring the length
	      of the queue and comparing it to the minimum and maximum
	      thresholds for the queue.  When the queue is over the
	      maximum, all new packets are randomly dropped.</p></dd><dt><span class="term">RIO</span></dt><dd><p>In Random Early Detection In and Out
	      (<acronym class="acronym">RIO</acronym>) mode, <acronym class="acronym">RED</acronym>
	      maintains multiple average queue lengths and multiple
	      threshold values, one for each
	      <acronym class="acronym">QOS</acronym> level.</p></dd><dt><span class="term">HFSC</span></dt><dd><p>Hierarchical Fair Service Curve Packet Scheduler
	      (<acronym class="acronym">HFSC</acronym>) is described in <code class="uri"><a class="uri" href="http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html" target="_top">http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html</a></code>.</p></dd><dt><span class="term">PRIQ</span></dt><dd><p>Priority Queuing (<acronym class="acronym">PRIQ</acronym>) always
	      passes traffic that is in a higher queue first.</p></dd></dl></div><p>More information about the scheduling
	algorithms and example rulesets are available at the <code class="uri"><a class="uri" href="https://web.archive.org/web/20151109213426/http://www.openbsd.org/faq/pf/queueing.html" target="_top">OpenBSD's web archive</a></code>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-ipfw"></a>30.4. <span class="application">IPFW</span></h2></div></div></div><a id="idp69970680" class="indexterm"></a><p><span class="application">IPFW</span> is a stateful firewall
      written for FreeBSD which supports both <acronym class="acronym">IPv4</acronym> and
      <acronym class="acronym">IPv6</acronym>.  It is comprised of several components:
      the kernel firewall filter rule processor and its integrated
      packet accounting facility, the logging facility,
      <acronym class="acronym">NAT</acronym>, the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a> traffic shaper, a
      forward facility, a bridge facility, and an ipstealth
      facility.</p><p>FreeBSD provides a sample ruleset in
      <code class="filename">/etc/rc.firewall</code> which defines several
      firewall types for common scenarios to assist novice users in
      generating an appropriate ruleset.
      <span class="application">IPFW</span> provides a powerful syntax which
      advanced users can use to craft customized rulesets that meet
      the security requirements of a given environment.</p><p>This section describes how to enable
      <span class="application">IPFW</span>, provides an overview of its
      rule syntax, and demonstrates several rulesets for common
      configuration scenarios.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipfw-enable"></a>30.4.1. Enabling <span class="application">IPFW</span></h3></div></div></div><a id="idp69518712" class="indexterm"></a><p><span class="application">IPFW</span> is included in the basic
	FreeBSD install as a kernel loadable module, meaning that a
	custom kernel is not needed in order to enable
	<span class="application">IPFW</span>.</p><p>For those users who wish to statically compile
	<span class="application">IPFW</span> support into a custom kernel,
	see <a class="xref" href="#firewalls-ipfw-kernelconfig" title="30.4.6. IPFW Kernel Options">Section 30.4.6, &#8220;<span class="application">IPFW</span> Kernel Options&#8221;</a>.</p><p>To configure the system to enable
	<span class="application">IPFW</span> at boot time, add
	<code class="literal">firewall_enable="YES"</code> to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc firewall_enable="YES"</code></strong></pre><p>To use one of the default firewall types provided by FreeBSD,
	add another line which specifies the type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc firewall_type="open"</code></strong></pre><p>The available types are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">open</code>: passes all traffic.</p></li><li class="listitem"><p><code class="literal">client</code>: protects only this
	    machine.</p></li><li class="listitem"><p><code class="literal">simple</code>: protects the whole
	    network.</p></li><li class="listitem"><p><code class="literal">closed</code>: entirely disables IP
	    traffic except for the loopback interface.</p></li><li class="listitem"><p><code class="literal">workstation</code>: protects only this
	    machine using stateful rules.</p></li><li class="listitem"><p><code class="literal">UNKNOWN</code>: disables the loading of
	    firewall rules.</p></li><li class="listitem"><p><code class="filename"><em class="replaceable"><code>filename</code></em></code>:
	    full path of the file containing the firewall
	    ruleset.</p></li></ul></div><p>If <code class="literal">firewall_type</code> is set to either
	<code class="literal">client</code> or <code class="literal">simple</code>,
	modify the default rules found in
	<code class="filename">/etc/rc.firewall</code> to fit the
	configuration of the system.</p><p>Note that the <code class="literal">filename</code> type is used to
	load a custom ruleset.</p><p>An alternate way to load a custom ruleset is to set the
	<code class="literal">firewall_script</code> variable to the absolute
	path of an <span class="emphasis"><em>executable script</em></span> that
	includes <span class="application">IPFW</span> commands.    The
	examples used in this section assume that the
	<code class="literal">firewall_script</code> is set to
	<code class="filename">/etc/ipfw.rules</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc firewall_script="/etc/ipfw.rules"</code></strong></pre><p>To enable logging through <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>, include this
	line:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc firewall_logging="YES"</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Only firewall rules with the <code class="option">log</code> option will
	  be logged.  The default rules do not include this option and it
	  must be manually added.  Therefore it is advisable that the default
	  ruleset is edited for logging.  In addition, log rotation may be
	  desired if the logs are stored in a separate file.</p></div><p>There is no <code class="filename">/etc/rc.conf</code> variable to
	set logging limits.  To limit the number of times a rule is
	logged per connection attempt, specify the number using this
	line in <code class="filename">/etc/sysctl.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo "net.inet.ip.fw.verbose_limit=<em class="replaceable"><code>5</code></em>" &gt;&gt; /etc/sysctl.conf</code></strong></pre><p>To enable logging through a dedicated interface named
	<code class="literal">ipfw0</code>, add this line to
	<code class="filename">/etc/rc.conf</code> instead:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc firewall_logif="YES"</code></strong></pre><p>Then use <span class="application">tcpdump</span> to see what is
	being logged:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tcpdump -t -n -i ipfw0</code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">There is no overhead due to logging unless
	  <span class="application">tcpdump</span> is attached.</p></div><p>After saving the needed edits, start the firewall.  To
	enable logging limits now, also set the
	<code class="command">sysctl</code> value specified above:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service ipfw start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet.ip.fw.verbose_limit=<em class="replaceable"><code>5</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipfw-rules"></a>30.4.2. <span class="application">IPFW</span> Rule Syntax</h3></div></div></div><a id="idp70004728" class="indexterm"></a><p>When a packet enters the <span class="application">IPFW</span>
	firewall, it is compared against the first rule in the ruleset
	and progresses one rule at a time, moving from top to bottom
	in sequence.  When the packet matches the selection parameters
	of a rule, the rule's action is executed and the search of the
	ruleset terminates for that packet.  This is referred to as
	<span class="quote">&#8220;<span class="quote">first match wins</span>&#8221;</span>.  If the packet does not match
	any of the rules, it gets caught by the mandatory
	<span class="application">IPFW</span> default rule number 65535,
	which denies all packets and silently discards them.  However,
	if the packet matches a rule that contains the
	<code class="literal">count</code>, <code class="literal">skipto</code>, or
	<code class="literal">tee</code> keywords, the search continues.  Refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> for details on how these keywords affect rule
	processing.</p><a id="idp70034040" class="indexterm"></a><p>When creating an
	<span class="application">IPFW</span> rule, keywords must be
	written in the following order.  Some keywords are mandatory
	while other keywords are optional.  The words shown in
	uppercase represent a variable and the words shown in
	lowercase must precede the variable that follows it.  The
	<code class="literal">#</code> symbol is used to mark the start of a
	comment and may appear at the end of a rule or on its own
	line.  Blank lines are ignored.</p><p><em class="replaceable"><code>CMD RULE_NUMBER set SET_NUMBER ACTION log
	  LOG_AMOUNT PROTO from SRC SRC_PORT to DST DST_PORT
	  OPTIONS</code></em></p><p>This section provides an overview of these keywords and
	their options.  It is not an exhaustive list of every possible
	option.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> for a complete description of
	the rule syntax that can be used when creating
	<span class="application">IPFW</span> rules.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CMD</span></dt><dd><p>Every rule must start with
	      <em class="parameter"><code>ipfw add</code></em>.</p></dd><dt><span class="term">RULE_NUMBER</span></dt><dd><p>Each rule is associated with a number from
	      <code class="literal">1</code> to
	      <code class="literal">65534</code>.  The number is used to
	      indicate the order of rule processing.  Multiple rules
	      can have the same number, in which case they are applied
	      according to the order in which they have been
	      added.</p></dd><dt><span class="term">SET_NUMBER</span></dt><dd><p>Each rule is associated with a set number from
	      <code class="literal">0</code> to <code class="literal">31</code>.
	      Sets can be individually disabled or enabled, making it
	      possible to quickly add or delete a set of rules.  If a
	      SET_NUMBER is not specified, the rule will be added to
	      set <code class="literal">0</code>.</p></dd><dt><span class="term">ACTION</span></dt><dd><p>A rule can be associated with one of the following
	      actions.  The specified action will be executed when the
	      packet matches the selection criterion of the
	      rule.</p><p><em class="parameter"><code>allow | accept | pass |
		permit</code></em>: these keywords are equivalent and
	      allow packets that match the rule.</p><p><em class="parameter"><code>check-state</code></em>: checks the
	      packet against the dynamic state table.  If a match is
	      found, execute the action associated with the rule which
	      generated this dynamic rule, otherwise move to the next
	      rule.  A <code class="literal">check-state</code> rule does not
	      have selection criterion.  If no
	      <code class="literal">check-state</code> rule is present in the
	      ruleset, the dynamic rules table is checked at the first
	      <code class="literal">keep-state</code> or
	      <code class="literal">limit</code> rule.</p><p><em class="parameter"><code>count</code></em>: updates counters for
	      all packets that match the rule.  The search continues
	      with the next rule.</p><p><em class="parameter"><code>deny | drop</code></em>: either word
	      silently discards packets that match this rule.</p><p>Additional actions are available.  Refer to
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> for details.</p></dd><dt><span class="term">LOG_AMOUNT</span></dt><dd><p>When a packet matches a rule with the
	      <code class="literal">log</code> keyword, a message will be logged
	      to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> with a facility name of
	      <code class="literal">SECURITY</code>.  Logging only occurs if the
	      number of packets logged for that particular rule does
	      not exceed a specified LOG_AMOUNT.  If no
	      LOG_AMOUNT is specified, the limit is taken from the
	      value of
	      <code class="varname">net.inet.ip.fw.verbose_limit</code>.  A
	      value of zero removes the logging limit.  Once the limit
	      is reached, logging can be re-enabled by clearing the
	      logging counter or the packet counter for that rule,
	      using <code class="command">ipfw resetlog</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Logging is done after all other packet matching
		conditions have been met, and before performing the
		final action on the packet.  The administrator decides
		which rules to enable logging on.</p></div></dd><dt><span class="term">PROTO</span></dt><dd><p>This optional value can be used to specify any
	      protocol name or number found in
	      <code class="filename">/etc/protocols</code>.</p></dd><dt><span class="term">SRC</span></dt><dd><p>The <code class="literal">from</code> keyword must be followed
	      by the source address or a keyword that represents the
	      source address.  An address can be represented by
	      <code class="literal">any</code>, <code class="literal">me</code> (any
	      address configured on an interface on this system),
	      <code class="literal">me6</code>, (any <acronym class="acronym">IPv6</acronym>
	      address configured on an interface on this system), or
	      <code class="literal">table</code> followed by the number of a
	      lookup table which contains a list of addresses.  When
	      specifying an <acronym class="acronym">IP</acronym> address, it can be
	      optionally followed by its <acronym class="acronym">CIDR</acronym> mask
	      or subnet mask.  For example,
	      <code class="literal">1.2.3.4/25</code> or
	      <code class="literal">1.2.3.4:255.255.255.128</code>.</p></dd><dt><span class="term">SRC_PORT</span></dt><dd><p>An optional source port can be specified using the
	      port number or name from
	      <code class="filename">/etc/services</code>.</p></dd><dt><span class="term">DST</span></dt><dd><p>The <code class="literal">to</code> keyword must be followed
	      by the destination address or a keyword that represents
	      the destination address.  The same keywords and
	      addresses described in the SRC section can be used to
	      describe the destination.</p></dd><dt><span class="term">DST_PORT</span></dt><dd><p>An optional destination port can be specified using
	      the port number or name from
	      <code class="filename">/etc/services</code>.</p></dd><dt><span class="term">OPTIONS</span></dt><dd><p>Several keywords can follow the source and
	      destination.  As the name suggests, OPTIONS are
	      optional.  Commonly used options include
	      <code class="literal">in</code> or <code class="literal">out</code>, which
	      specify the direction of packet flow,
	      <code class="literal">icmptypes</code> followed by the type of
	      <acronym class="acronym">ICMP</acronym> message, and
	      <code class="literal">keep-state</code>.</p><p>When a <em class="parameter"><code>keep-state</code></em> rule is
	      matched, the firewall will create a dynamic rule which
	      matches bidirectional traffic between the source and
	      destination addresses and ports using the same
	      protocol.</p><p>The dynamic rules facility is vulnerable to resource
	      depletion from a SYN-flood attack which would open a
	      huge number of dynamic rules.  To counter this type of
	      attack with  <span class="application">IPFW</span>, use
	      <code class="literal">limit</code>.  This option limits the number
	      of simultaneous sessions by checking the open dynamic
	      rules, counting the number of times this rule and
	      <acronym class="acronym">IP</acronym> address combination occurred.  If
	      this count is greater than the value specified by
	      <code class="literal">limit</code>, the packet is
	      discarded.</p><p>Dozens of OPTIONS are available.  Refer to
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> for a description of each available
	      option.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70098296"></a>30.4.3. Example Ruleset</h3></div></div></div><p>This section demonstrates how to create an example
	stateful firewall ruleset script named
	<code class="filename">/etc/ipfw.rules</code>.  In this example, all
	connection rules use <code class="literal">in</code> or
	<code class="literal">out</code> to clarify the direction.  They also
	use <code class="literal">via</code>
	<em class="replaceable"><code>interface-name</code></em> to specify
	the interface the packet is traveling over.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">When first creating or testing a firewall ruleset,
	  consider temporarily setting this tunable:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">net.inet.ip.fw.default_to_accept="1"</pre><p xmlns="http://www.w3.org/1999/xhtml">This sets the default policy of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> to be more
	  permissive than the default <code class="literal">deny ip from any to
	    any</code>, making it slightly more difficult to get
	  locked out of the system right after a reboot.</p></div><p>The firewall script begins by indicating that it is a
	Bourne shell script and flushes any existing rules.  It then
	creates the <code class="literal">cmd</code> variable so that
	<code class="literal">ipfw add</code> does not have to be typed at the
	beginning of every rule.  It also defines the
	<code class="literal">pif</code> variable which represents the name of
	the interface that is attached to the Internet.</p><pre class="programlisting">#!/bin/sh
# Flush out the list before we begin.
ipfw -q -f flush

# Set rules command prefix
cmd="ipfw -q add"
pif="dc0"     # interface name of NIC attached to Internet</pre><p>The first two rules allow all traffic on the trusted
	internal interface and on the loopback interface:</p><pre class="programlisting"># Change xl0 to LAN NIC interface name
$cmd 00005 allow all from any to any via xl0

# No restrictions on Loopback Interface
$cmd 00010 allow all from any to any via lo0</pre><p>The next rule allows the packet through if it matches an
	existing entry in the dynamic rules table:</p><pre class="programlisting">$cmd 00101 check-state</pre><p>The next set of rules defines which stateful connections
	internal systems can create to hosts on the Internet:</p><pre class="programlisting"># Allow access to public DNS
# Replace x.x.x.x with the IP address of a public DNS server
# and repeat for each DNS server in /etc/resolv.conf
$cmd 00110 allow tcp from any to x.x.x.x 53 out via $pif setup keep-state
$cmd 00111 allow udp from any to x.x.x.x 53 out via $pif keep-state

# Allow access to ISP's DHCP server for cable/DSL configurations.
# Use the first rule and check log for IP address.
# Then, uncomment the second rule, input the IP address, and delete the first rule
$cmd 00120 allow log udp from any to any 67 out via $pif keep-state
#$cmd 00120 allow udp from any to x.x.x.x 67 out via $pif keep-state

# Allow outbound HTTP and HTTPS connections
$cmd 00200 allow tcp from any to any 80 out via $pif setup keep-state
$cmd 00220 allow tcp from any to any 443 out via $pif setup keep-state

# Allow outbound email connections
$cmd 00230 allow tcp from any to any 25 out via $pif setup keep-state
$cmd 00231 allow tcp from any to any 110 out via $pif setup keep-state

# Allow outbound ping
$cmd 00250 allow icmp from any to any out via $pif keep-state

# Allow outbound NTP
$cmd 00260 allow udp from any to any 123 out via $pif keep-state

# Allow outbound SSH
$cmd 00280 allow tcp from any to any 22 out via $pif setup keep-state

# deny and log all other outbound connections
$cmd 00299 deny log all from any to any out via $pif</pre><p>The next set of rules controls connections from Internet
	hosts to the internal network.  It starts by denying packets
	typically associated with attacks and then explicitly allows
	specific types of connections.  All the authorized services
	that originate from the Internet use <code class="literal">limit</code>
	to prevent flooding.</p><pre class="programlisting"># Deny all inbound traffic from non-routable reserved address spaces
$cmd 00300 deny all from 192.168.0.0/16 to any in via $pif     #RFC 1918 private IP
$cmd 00301 deny all from 172.16.0.0/12 to any in via $pif      #RFC 1918 private IP
$cmd 00302 deny all from 10.0.0.0/8 to any in via $pif         #RFC 1918 private IP
$cmd 00303 deny all from 127.0.0.0/8 to any in via $pif        #loopback
$cmd 00304 deny all from 0.0.0.0/8 to any in via $pif          #loopback
$cmd 00305 deny all from 169.254.0.0/16 to any in via $pif     #DHCP auto-config
$cmd 00306 deny all from 192.0.2.0/24 to any in via $pif       #reserved for docs
$cmd 00307 deny all from 204.152.64.0/23 to any in via $pif    #Sun cluster interconnect
$cmd 00308 deny all from 224.0.0.0/3 to any in via $pif        #Class D &amp; E multicast

# Deny public pings
$cmd 00310 deny icmp from any to any in via $pif

# Deny ident
$cmd 00315 deny tcp from any to any 113 in via $pif

# Deny all Netbios services.
$cmd 00320 deny tcp from any to any 137 in via $pif
$cmd 00321 deny tcp from any to any 138 in via $pif
$cmd 00322 deny tcp from any to any 139 in via $pif
$cmd 00323 deny tcp from any to any 81 in via $pif

# Deny fragments
$cmd 00330 deny all from any to any frag in via $pif

# Deny ACK packets that did not match the dynamic rule table
$cmd 00332 deny tcp from any to any established in via $pif

# Allow traffic from ISP's DHCP server.
# Replace x.x.x.x with the same IP address used in rule 00120.
#$cmd 00360 allow udp from any to x.x.x.x 67 in via $pif keep-state

# Allow HTTP connections to internal web server
$cmd 00400 allow tcp from any to me 80 in via $pif setup limit src-addr 2

# Allow inbound SSH connections
$cmd 00410 allow tcp from any to me 22 in via $pif setup limit src-addr 2

# Reject and log all other incoming connections
$cmd 00499 deny log all from any to any in via $pif</pre><p>The last rule logs all packets that do not match any of
	the rules in the ruleset:</p><pre class="programlisting"># Everything else is denied and logged
$cmd 00999 deny log all from any to any</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="in-kernel-nat"></a>30.4.4. In-kernel <acronym class="acronym">NAT</acronym></h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div><div><span class="authorgroup">Rewritten and updated by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Dries</span> <span class="surname">Michiels</span></span>. </span></div></div></div><a id="idp70173560" class="indexterm"></a><p>FreeBSD's <span class="application">IPFW</span> firewall has two
	implementations of <acronym class="acronym">NAT</acronym>: the userland
	implementation <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a>, and the more recent in-kernel
	<acronym class="acronym">NAT</acronym> implementation.  Both work in
	conjunction with <span class="application">IPFW</span> to provide
	network address translation.  This can be used to provide an
	Internet Connection Sharing solution so that several internal
	computers can connect to the Internet using a single public
	<acronym class="acronym">IP</acronym> address.</p><p>To do this, the FreeBSD machine connected to the Internet
	must act as a gateway.  This system must have two
	<acronym class="acronym">NIC</acronym>s, where one is connected to the
	Internet and the other is connected to the internal
	<acronym class="acronym">LAN</acronym>.  Each machine connected to the
	<acronym class="acronym">LAN</acronym> should be assigned an
	<acronym class="acronym">IP</acronym> address in the private network space, as
	defined by <a class="link" href="https://www.ietf.org/rfc/rfc1918.txt" target="_top">RFC
	1918</a>.</p><p>Some additional configuration is needed in order to enable
	the in-kernel <acronym class="acronym">NAT</acronym> facility of
	<span class="application">IPFW</span>.  To enable in-kernel
	<acronym class="acronym">NAT</acronym> support at boot time, the following
	must be set in <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">gateway_enable="YES"
firewall_enable="YES"
firewall_nat_enable="YES"</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">When <code class="literal">firewall_nat_enable</code> is set but
	  <code class="literal">firewall_enable</code> is not, it will have no
	  effect and do nothing.  This is because the in-kernel
	  <acronym class="acronym">NAT</acronym> implementation is only compatible
	  with <span class="application">IPFW</span>.</p></div><p>When the ruleset contains stateful rules, the positioning
	of the <acronym class="acronym">NAT</acronym> rule is critical and the
	<code class="literal">skipto</code> action is used.  The
	<code class="literal">skipto</code> action requires a rule number so
	that it knows which rule to jump to.  The example below builds
	upon the firewall ruleset shown in the previous section.  It
	adds some additional entries and modifies some existing rules
	in order to configure the firewall for in-kernel
	<acronym class="acronym">NAT</acronym>.  It starts by adding some additional
	variables which represent the rule number to skip to, the
	<code class="literal">keep-state</code> option, and a list of
	<acronym class="acronym">TCP</acronym> ports which will be used to reduce the
	number of rules.</p><pre class="programlisting">#!/bin/sh
ipfw -q -f flush
cmd="ipfw -q add"
skip="skipto 1000"
pif=dc0
ks="keep-state"
good_tcpo="22,25,37,53,80,443,110"</pre><p>With in-kernel <acronym class="acronym">NAT</acronym> it is
	necessary to disable TCP segmentation offloading
	(<acronym class="acronym">TSO</acronym>) due to the architecture of
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=libalias&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">libalias</span>(3)</span></a>, a library implemented as a kernel module to
	provide the in-kernel <acronym class="acronym">NAT</acronym> facility of
	<span class="application">IPFW</span>.  <acronym class="acronym">TSO</acronym> can
	be disabled on a per network interface basis using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> or on a system wide basis using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.  To disable <acronym class="acronym">TSO</acronym> system
	wide, the following must be set it
	<code class="filename">/etc/sysctl.conf</code>:</p><pre class="programlisting">net.inet.tcp.tso="0"</pre><p>A <acronym class="acronym">NAT</acronym> instance will also be configured.
	It is possible to have multiple <acronym class="acronym">NAT</acronym>
	instances each with their own configuration.  For this example
	only one <acronym class="acronym">NAT</acronym> instance is needed,
	<acronym class="acronym">NAT</acronym> instance number 1.  The configuration
	can take a few options such as: <code class="option">if</code> which
	indicates the public interface, <code class="option">same_ports</code>
	which takes care that alliased ports and local port numbers
	are mapped the same, <code class="option">unreg_only</code> will result
	in only unregistered (private) address spaces to be processed
	by the <acronym class="acronym">NAT</acronym> instance, and
	<code class="option">reset</code> which will help to keep a functioning
	<acronym class="acronym">NAT</acronym> instance even when the public
	<acronym class="acronym">IP</acronym> address of the
	<span class="application">IPFW</span> machine changes.  For all
	possible options that can be passed to a single
	<acronym class="acronym">NAT</acronym> instance configuration consult
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>.  When configuring a stateful
	<acronym class="acronym">NAT</acronym>ing firewall, it is neseccary to allow
	translated packets to be reinjected in the firewall for
	further processing.  This can be achieved by disabling
	<code class="option">one_pass</code> behavior at the start of the
	firewall script.</p><pre class="programlisting">ipfw disable one_pass
ipfw -q nat 1 config if $pif same_ports unreg_only reset</pre><p>The inbound <acronym class="acronym">NAT</acronym> rule is inserted
	<span class="emphasis"><em>after</em></span> the two rules which allow all
	traffic on the trusted and loopback interfaces and after the
	reassemble rule but <span class="emphasis"><em>before</em></span> the
	<code class="literal">check-state</code> rule.  It is important that the
	rule number selected for this <acronym class="acronym">NAT</acronym> rule, in
	this example <code class="literal">100</code>, is higher than the first
	three rules and lower than the <code class="literal">check-state</code>
	rule.  Furthermore, because of the behavior of in-kernel
	<acronym class="acronym">NAT</acronym> it is advised to place a reassemble
	rule just before the first <acronym class="acronym">NAT</acronym> rule and
	after the rules that allow traffic on trusted interface.
	Normally, <acronym class="acronym">IP</acronym> fragmentation should not
	happen, but when dealing with <acronym class="acronym">IPSEC/ESP/GRE</acronym>
	tunneling traffic it might and the reassembling of fragments
	is necessary before handing the complete packet over to the
	in-kernel <acronym class="acronym">NAT</acronym> facility.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The reassemble rule was not needed with userland
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> because the internal workings of the
	  <span class="application">IPFW</span> <code class="literal">divert</code>
	  action already takes care of reassembling packets before
	  delivery to the socket as also stated in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>.</p><p xmlns="http://www.w3.org/1999/xhtml">The <acronym class="acronym">NAT</acronym> instance and rule number used
	  in this example does not match with the default
	  <acronym class="acronym">NAT</acronym> instance and rule number created by
	  <code class="filename">rc.firewall</code>.
	  <code class="filename">rc.firewall</code> is a script that sets up
	  the default firewall rules present in FreeBSD.</p></div><pre class="programlisting">$cmd 005 allow all from any to any via xl0  # exclude LAN traffic
$cmd 010 allow all from any to any via lo0  # exclude loopback traffic
$cmd 099 reass all from any to any in       # reassemble inbound packets
$cmd 100 nat 1 ip from any to any in via $pif # NAT any inbound packets
# Allow the packet through if it has an existing entry in the dynamic rules table
$cmd 101 check-state</pre><p>The outbound rules are modified to replace the
	<code class="literal">allow</code> action with the
	<code class="literal">$skip</code> variable, indicating that rule
	processing will continue at rule <code class="literal">1000</code>.  The
	seven <code class="literal">tcp</code> rules have been replaced by rule
	<code class="literal">125</code> as the
	<code class="literal">$good_tcpo</code> variable contains the
	seven allowed outbound ports.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Remember that <span class="application">IPFW</span>'s
	  performance is largely determined by the number of rules
	  present in the ruleset.</p></div><pre class="programlisting"># Authorized outbound packets
$cmd 120 $skip udp from any to x.x.x.x 53 out via $pif $ks
$cmd 121 $skip udp from any to x.x.x.x 67 out via $pif $ks
$cmd 125 $skip tcp from any to any $good_tcpo out via $pif setup $ks
$cmd 130 $skip icmp from any to any out via $pif $ks</pre><p>The inbound rules remain the same, except for the very
	last rule which removes the <code class="literal">via $pif</code> in
	order to catch both inbound and outbound rules.  The
	<acronym class="acronym">NAT</acronym> rule must follow this last outbound
	rule, must have a higher number than that last rule, and the
	rule number must be referenced by the
	<code class="literal">skipto</code> action.  In this ruleset, rule
	number <code class="literal">1000</code> handles passing all packets to
	our configured instance for <acronym class="acronym">NAT</acronym> processing.
	The next rule allows any packet which has undergone
	<acronym class="acronym">NAT</acronym> processing to pass.</p><pre class="programlisting">$cmd 999 deny log all from any to any
$cmd 1000 nat 1 ip from any to any out via $pif # skipto location for outbound stateful rules
$cmd 1001 allow ip from any to any</pre><p>In this example, rules <code class="literal">100</code>,
	<code class="literal">101</code>, <code class="literal">125</code>,
	<code class="literal">1000</code>, and <code class="literal">1001</code> control
	the address translation of the outbound and inbound packets so
	that the entries in the dynamic state table always register
	the private <acronym class="acronym">LAN</acronym> <acronym class="acronym">IP</acronym>
	address.</p><p>Consider an internal web browser which initializes a new
	outbound <acronym class="acronym">HTTP</acronym> session over port 80.  When
	the first outbound packet enters the firewall, it does not
	match rule <code class="literal">100</code> because it is headed out
	rather than in.  It passes rule <code class="literal">101</code> because
	this is the first packet and it has not been posted to the
	dynamic state table yet.  The packet finally matches rule
	<code class="literal">125</code> as it is outbound on an allowed port
	and has a source <acronym class="acronym">IP</acronym> address from the
	internal <acronym class="acronym">LAN</acronym>.  On matching this rule, two
	actions take place.  First, the <code class="literal">keep-state</code>
	action adds an entry to the dynamic state table and the
	specified action, <code class="literal">skipto rule 1000</code>, is
	executed.  Next, the packet undergoes <acronym class="acronym">NAT</acronym>
	and is sent out to the Internet.  This packet makes its way to
	the destination web server, where a response packet is
	generated and sent back.  This new packet enters the top of
	the ruleset.  It matches rule <code class="literal">100</code> and has
	its destination <acronym class="acronym">IP</acronym> address mapped back to
	the original internal address.  It then is processed by the
	<code class="literal">check-state</code> rule, is found in the table as
	an existing session, and is released to the
	<acronym class="acronym">LAN</acronym>.</p><p>On the inbound side, the ruleset has to deny bad packets
	and allow only authorized services.  A packet which matches an
	inbound rule is posted to the dynamic state table and the
	packet is released to the <acronym class="acronym">LAN</acronym>.  The packet
	generated as a response is recognized by the
	<code class="literal">check-state</code> rule as belonging to an
	existing session.  It is then sent to rule
	<code class="literal">1000</code> to undergo
	<acronym class="acronym">NAT</acronym> before being released to the outbound
	interface.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Transitioning from userland <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> to in-kernel
	  <acronym class="acronym">NAT</acronym> might seem seamless at first but
	  there is small catch.  When using the GENERIC kernel,
	  <span class="application">IPFW</span> will load the
	  <code class="filename">libalias.ko</code> kernel module, when
	  <code class="literal">firewall_nat_enable</code> is enabled in
	  <code class="filename">rc.conf</code>.  The
	  <code class="filename">libalias.ko</code> kernel module only provides
	  basic <acronym class="acronym">NAT</acronym> functionality, whereas the
	  userland implementation <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> has all
	  <acronym class="acronym">NAT</acronym> functionality available in its
	  userland library without any extra configuration.  All
	  functionality refers to the following kernel modules that
	  can additionally be loaded when needed besides the standard
	  <code class="filename">libalias.ko</code> kernel module:
	  <code class="filename">alias_cuseeme.ko</code>,
	  <code class="filename">alias_ftp.ko</code>,
	  <code class="filename">alias_bbt.ko</code>,
	  <code class="filename">skinny.ko</code>, <code class="filename">irc.ko</code>,
	  <code class="filename">alias_pptp.ko</code> and
	  <code class="filename">alias_smedia.ko</code> using the
	  <code class="literal">kld_list</code> directive in
	  <code class="filename">rc.conf</code>.  If a custom kernel is used,
	  the full functionality of the userland library can be
	  compiled in, in the kernel, using the <code class="option">options
	  LIBALIAS</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70246776"></a>30.4.4.1. Port Redirection</h4></div></div></div><p>The drawback with <acronym class="acronym">NAT</acronym> in general is
	  that the <acronym class="acronym">LAN</acronym> clients are not accessible
	  from the Internet.  Clients on the <acronym class="acronym">LAN</acronym>
	  can make outgoing connections to the world but cannot
	  receive incoming ones.  This presents a problem if trying to
	  run Internet services on one of the <acronym class="acronym">LAN</acronym>
	  client machines.  A simple way around this is to redirect
	  selected Internet ports on the <acronym class="acronym">NAT</acronym>
	  providing machine to a <acronym class="acronym">LAN</acronym> client.</p><p>For example, an <acronym class="acronym">IRC</acronym> server runs on
	  client <code class="systemitem">A</code> and a web server runs on
	  client <code class="systemitem">B</code>.  For this to work
	  properly, connections received on ports 6667
	  (<acronym class="acronym">IRC</acronym>) and 80 (<acronym class="acronym">HTTP</acronym>)
	  must be redirected to the respective machines.</p><p>With in-kernel <acronym class="acronym">NAT</acronym> all configuration
	  is done in the <acronym class="acronym">NAT</acronym> instance
	  configuration.  For a full list of options that an in-kernel
	  <acronym class="acronym">NAT</acronym> instance can use, consult
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>.  The <span class="application">IPFW</span> syntax
	  follows the syntax of <span class="application">natd</span>.  The
	  syntax for <code class="option">redirect_port</code> is as
	  follows:</p><pre class="programlisting">redirect_port proto targetIP:targetPORT[-targetPORT]
  [aliasIP:]aliasPORT[-aliasPORT]
  [remoteIP[:remotePORT[-remotePORT]]]</pre><p>To configure the above example setup, the arguments
	should be:</p><pre class="programlisting">redirect_port tcp 192.168.0.2:6667 6667
redirect_port tcp 192.168.0.3:80 80</pre><p>After adding these arguments to the configuration of
	  <acronym class="acronym">NAT</acronym> instance 1 in the above ruleset, the
	  <acronym class="acronym">TCP</acronym> ports will be port forwarded to the
	  <acronym class="acronym">LAN</acronym> client machines running the
	  <acronym class="acronym">IRC</acronym> and <acronym class="acronym">HTTP</acronym>
	  services.</p><pre class="programlisting">ipfw -q nat 1 config if $pif same_ports unreg_only reset \
  redirect_port tcp 192.168.0.2:6667 6667 \
  redirect_port tcp 192.168.0.3:80 80</pre><p>Port ranges over individual ports can be indicated with
	  <code class="option">redirect_port</code>.  For example,
	  <em class="replaceable"><code>tcp 192.168.0.2:2000-3000
	  2000-3000</code></em> would redirect all connections
	  received on ports 2000 to 3000 to ports 2000 to 3000 on
	  client <code class="systemitem">A</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70265592"></a>30.4.4.2. Address Redirection</h4></div></div></div><p>Address redirection is useful if more than one
	  <acronym class="acronym">IP</acronym> address is available.  Each
	  <acronym class="acronym">LAN</acronym> client can be assigned its own
	  external <acronym class="acronym">IP</acronym> address by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>,
	  which will then rewrite outgoing packets from the
	  <acronym class="acronym">LAN</acronym> clients with the proper external
	  <acronym class="acronym">IP</acronym> address and redirects all traffic
	  incoming on that particular <acronym class="acronym">IP</acronym> address
	  back to the specific <acronym class="acronym">LAN</acronym> client.  This is
	  also known as static <acronym class="acronym">NAT</acronym>.  For example,
	  if <acronym class="acronym">IP</acronym> addresses <code class="systemitem">128.1.1.1</code>, <code class="systemitem">128.1.1.2</code>, and <code class="systemitem">128.1.1.3</code> are available,
	  <code class="systemitem">128.1.1.1</code> can be
	  used as the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> machine's external
	  <acronym class="acronym">IP</acronym> address, while <code class="systemitem">128.1.1.2</code> and <code class="systemitem">128.1.1.3</code> are forwarded
	  back to <acronym class="acronym">LAN</acronym> clients
	  <code class="systemitem">A</code> and
	  <code class="systemitem">B</code>.</p><p>The <code class="option">redirect_address</code> syntax is as
	  below, where <code class="literal">localIP</code> is the internal
	  <acronym class="acronym">IP</acronym> address of the <acronym class="acronym">LAN</acronym>
	  client, and <code class="literal">publicIP</code> the external
	  <acronym class="acronym">IP</acronym> address corresponding to the
	  <acronym class="acronym">LAN</acronym> client.</p><pre class="programlisting">redirect_address localIP publicIP</pre><p>In the example, the arguments would read:</p><pre class="programlisting">redirect_address 192.168.0.2 128.1.1.2
redirect_address 192.168.0.3 128.1.1.3</pre><p>Like <code class="option">redirect_port</code>, these arguments
	  are placed in a <acronym class="acronym">NAT</acronym> instance
	  configuration.  With address redirection, there is no
	  need for port redirection, as all data received on a
	  particular <acronym class="acronym">IP</acronym> address is
	  redirected.</p><p>The external <acronym class="acronym">IP</acronym> addresses on the
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> machine must be active and aliased to the
	  external interface.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> for
	  details.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70304888"></a>30.4.4.3. Userspace <acronym class="acronym">NAT</acronym></h4></div></div></div><p>Let us start with a statement: the userspace
	  <acronym class="acronym">NAT</acronym> implementation: <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a>, has
	  more overhead than in-kernel <acronym class="acronym">NAT</acronym>.  For
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> to translate packets, the packets have to be
	  copied from the kernel to userspace and back which brings in
	  extra overhead that is not present with in-kernel
	  <acronym class="acronym">NAT</acronym>.</p><p>To enable the userpace <acronym class="acronym">NAT</acronym> daemon
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> at boot time, the following is a minimum
	  configuration in <code class="filename">/etc/rc.conf</code>.  Where
	  <code class="option">natd_interface</code> is set to the name of the
	  <acronym class="acronym">NIC</acronym> attached to the Internet.  The
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> script of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> will automatically check
	  if a dynamic <acronym class="acronym">IP</acronym> address is used and
	  configure itself to handle that.</p><pre class="programlisting">gateway_enable="YES"
natd_enable="YES"
natd_interface="rl0"</pre><p>In general, the above ruleset as explained for in-kernel
	  <acronym class="acronym">NAT</acronym> can also be used together with
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a>.  The exceptions are the configuration of the
	  in-kernel <acronym class="acronym">NAT</acronym> instance <code class="literal">(ipfw -q
	  nat 1 config ...)</code> which is not needed together
	  with reassemble rule 99 because its functionality is
	  included in the <code class="option">divert</code> action.  Rule number
	  100 and 1000 will have to change sligthly as shown
	  below.</p><pre class="programlisting">$cmd 100 divert natd ip from any to any in via $pif
$cmd 1000 divert natd ip from any to any out via $pif</pre><p>To configure port or address redirection, a similar
	  syntax as with in-kernel <acronym class="acronym">NAT</acronym> is used.
	  Although, now, instead of specifying the configuration in
	  our ruleset script like with in-kernel
	  <acronym class="acronym">NAT</acronym>, configuration of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> is
	  best done in a configuration file.  To do this, an extra
	  flag must be passed via <code class="filename">/etc/rc.conf</code>
	  which specifies the path of the configuration file.</p><pre class="programlisting">natd_flags="-f /etc/natd.conf"</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The specified file must contain a list of
	    configuration options, one per line.  For more information
	    about the configuration file and possible variables,
	    consult <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a>.  Below are two example
	    entries, one per line:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">redirect_port tcp 192.168.0.2:6667 6667
redirect_address 192.168.0.3 128.1.1.3</pre></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipfw-cmd"></a>30.4.5. The <span class="application">IPFW</span> Command</h3></div></div></div><a id="idp70347512" class="indexterm"></a><p><code class="command">ipfw</code> can be used to make manual,
	single rule additions or deletions to the active firewall
	while it is running.  The problem with using this method is
	that all the changes are lost when the system reboots.  It is
	recommended to instead write all the rules in a file and to
	use that file to load the rules at boot time and to replace
	the currently running firewall rules whenever that file
	changes.</p><p><code class="command">ipfw</code> is a useful way to display the
	running firewall rules to the console screen.  The
	<span class="application">IPFW</span> accounting facility
	dynamically creates a counter for each rule that counts each
	packet that matches the rule.  During the process of testing a
	rule, listing the rule with its counter is one way to
	determine if the rule is functioning as expected.</p><p>To list all the running rules in sequence:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipfw list</code></strong></pre><p>To list all the running rules with a time stamp of when
	the last time the rule was matched:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipfw -t list</code></strong></pre><p>The next example lists accounting information and the
	packet count for matched rules along with the rules
	themselves.  The first column is the rule number, followed by
	the number of matched packets and bytes, followed by the rule
	itself.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipfw -a list</code></strong></pre><p>To list dynamic rules in addition to static rules:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipfw -d list</code></strong></pre><p>To also show the expired dynamic rules:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipfw -d -e list</code></strong></pre><p>To zero the counters:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipfw zero</code></strong></pre><p>To zero the counters for just the rule with number
	<em class="replaceable"><code>NUM</code></em>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipfw zero <em class="replaceable"><code>NUM</code></em></code></strong></pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70031736"></a>30.4.5.1. Logging Firewall Messages</h4></div></div></div><a id="idp70351864" class="indexterm"></a><p>Even with the logging facility enabled,
	  <span class="application">IPFW</span> will not generate any rule
	  logging on its own.  The firewall administrator decides
	  which rules in the ruleset will be logged, and adds the
	  <code class="literal">log</code> keyword to those rules.  Normally
	  only deny rules are logged.  It is customary to duplicate
	  the <span class="quote">&#8220;<span class="quote">ipfw default deny everything</span>&#8221;</span> rule with
	  the <code class="literal">log</code> keyword included as the last rule
	  in the ruleset.  This way, it is possible to see all the
	  packets that did not match any of the rules in the
	  ruleset.</p><p>Logging is a two edged sword.  If one is not careful,
	  an over abundance of log data or a DoS attack can fill the
	  disk with log files.  Log messages are not only written to
	  <span class="application">syslogd</span>, but also are displayed
	  on the root console screen and soon become annoying.</p><p>The <code class="literal">IPFIREWALL_VERBOSE_LIMIT=5</code>
	  kernel option limits the number of consecutive messages
	  sent to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>, concerning the packet matching of a
	  given rule.  When this option is enabled in the kernel, the
	  number of consecutive messages concerning a particular rule
	  is capped at the number specified.  There is nothing to be
	  gained from 200 identical log messages.  With this option
	  set to five,
	  five consecutive messages concerning a particular rule
	  would be logged to <span class="application">syslogd</span> and
	  the remainder identical consecutive messages would be
	  counted and posted to <span class="application">syslogd</span>
	  with a phrase like the following:</p><pre class="programlisting">last message repeated 45 times</pre><p>All logged packets messages are written by default to
	  <code class="filename">/var/log/security</code>, which is
	  defined in <code class="filename">/etc/syslog.conf</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipfw-rules-script"></a>30.4.5.2. Building a Rule Script</h4></div></div></div><p>Most experienced <span class="application">IPFW</span> users
	  create a file containing the rules and code them in a manner
	  compatible with running them as a script.  The major benefit
	  of doing this is the firewall rules can be refreshed in mass
	  without the need of rebooting the system to activate them.
	  This method is convenient in testing new rules as the
	  procedure can be executed as many times as needed.  Being a
	  script, symbolic substitution can be used for frequently
	  used values to be substituted into multiple rules.</p><p>This example script is compatible with the syntax used
	  by the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a>,  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a> shells.
	  Symbolic substitution fields are prefixed with a dollar sign
	  ($).  Symbolic fields do not have the $
	  prefix.  The value to populate the symbolic field must be
	  enclosed in double quotes ("").</p><p>Start the rules file like this:</p><pre class="programlisting">############### start of example ipfw rules script #############
#
ipfw -q -f flush       # Delete all rules
# Set defaults
oif="tun0"             # out interface
odns="192.0.2.11"      # ISP's DNS server IP address
cmd="ipfw -q add "     # build rule prefix
ks="keep-state"        # just too lazy to key this each time
$cmd 00500 check-state
$cmd 00502 deny all from any to any frag
$cmd 00501 deny tcp from any to any established
$cmd 00600 allow tcp from any to any 80 out via $oif setup $ks
$cmd 00610 allow tcp from any to $odns 53 out via $oif setup $ks
$cmd 00611 allow udp from any to $odns 53 out via $oif $ks
################### End of example ipfw rules script ############</pre><p>The rules are not important as the focus of this example
	  is how the symbolic substitution fields are
	  populated.</p><p>If the above example was in
	  <code class="filename">/etc/ipfw.rules</code>, the rules could be
	  reloaded by the following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /etc/ipfw.rules</code></strong></pre><p><code class="filename">/etc/ipfw.rules</code> can be located
	  anywhere and the file can have any name.</p><p>The same thing could be accomplished by running these
	  commands by hand:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipfw -q -f flush</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add check-state</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add deny all from any to any frag</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add deny tcp from any to any established</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add allow tcp from any to any 80 out via tun0 setup keep-state</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add allow tcp from any to 192.0.2.11 53 out via tun0 setup keep-state</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ipfw -q add 00611 allow udp from any to 192.0.2.11 53 out via tun0 keep-state</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipfw-kernelconfig"></a>30.4.6. <span class="application">IPFW</span> Kernel Options</h3></div></div></div><a id="idp70133112" class="indexterm"></a><a id="idp70134264" class="indexterm"></a><a id="idp70135416" class="indexterm"></a><a id="idp70136568" class="indexterm"></a><p>In order to statically compile
	<span class="application">IPFW</span> support into a custom kernel,
	refer to the instructions in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>.
	The following options are available for the
	custom kernel configuration file:</p><pre class="programlisting">options    IPFIREWALL			# enables IPFW
options    IPFIREWALL_VERBOSE		# enables logging for rules with log keyword to syslogd(8)
options    IPFIREWALL_VERBOSE_LIMIT=5	# limits number of logged packets per-entry
options    IPFIREWALL_DEFAULT_TO_ACCEPT # sets default policy to pass what is not explicitly denied
options    IPFIREWALL_NAT		# enables basic in-kernel NAT support
options    LIBALIAS			# enables full in-kernel NAT support
options    IPFIREWALL_NAT64		# enables in-kernel NAT64 support
options    IPFIREWALL_NPTV6		# enables in-kernel IPv6 NPT support
options    IPFIREWALL_PMOD		# enables protocols modification module support
options    IPDIVERT			# enables NAT through natd(8)</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">IPFW</span> can be loaded as
	  a kernel module: options above are built by default
	  as modules or can be set at runtime using tunables.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-ipf"></a>30.5. IPFILTER (IPF)</h2></div></div></div><a id="idp70153848" class="indexterm"></a><p><span class="application">IPFILTER</span>, also known as
      <span class="application">IPF</span>, is a cross-platform, open source
      firewall which has been ported to several operating systems,
      including FreeBSD, NetBSD, OpenBSD, and <span class="trademark">Solaris</span>&#8482;.</p><p><span class="application">IPFILTER</span> is a kernel-side
      firewall and <acronym class="acronym">NAT</acronym> mechanism that can be
      controlled and monitored by userland programs.  Firewall rules
      can be set or deleted using <span class="application">ipf</span>,
      <acronym class="acronym">NAT</acronym> rules can be set or deleted using
      <span class="application">ipnat</span>, run-time statistics for the
      kernel parts of <span class="application">IPFILTER</span> can be
      printed using <span class="application">ipfstat</span>, and
      <span class="application">ipmon</span> can be used to log
      <span class="application">IPFILTER</span> actions to the system log
      files.</p><p><span class="application">IPF</span> was originally written using
      a rule processing logic of <span class="quote">&#8220;<span class="quote">the last matching rule
	wins</span>&#8221;</span> and only used stateless rules.  Since then,
      <span class="application">IPF</span> has been enhanced to include the
      <code class="literal">quick</code> and <code class="literal">keep state</code>
      options.</p><p>The <span class="application">IPF</span> FAQ is at <code class="uri"><a class="uri" href="http://www.phildev.net/ipf/index.html" target="_top">http://www.phildev.net/ipf/index.html</a></code>.
      A searchable archive of the IPFilter mailing list is available
      at <code class="uri"><a class="uri" href="http://marc.info/?l=ipfilter" target="_top">http://marc.info/?l=ipfilter</a></code>.</p><p>This section of the Handbook focuses on
      <span class="application">IPF</span> as it pertains to FreeBSD.  It
      provides examples of rules that contain the
      <code class="literal">quick</code> and <code class="literal">keep state</code>
      options.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70391160"></a>30.5.1. Enabling <span class="application">IPF</span></h3></div></div></div><a id="idp70392056" class="indexterm"></a><p><span class="application">IPF</span> is included in the basic
	FreeBSD install as a kernel loadable module, meaning that a
	custom kernel is not needed in order to enable
	<span class="application">IPF</span>.</p><a id="idp70394360" class="indexterm"></a><a id="idp70395640" class="indexterm"></a><a id="idp70396792" class="indexterm"></a><a id="idp70397944" class="indexterm"></a><p>For users who prefer to statically compile
	<span class="application">IPF</span> support into a custom kernel,
	refer to the instructions in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>.
	The following kernel options are available:</p><pre class="programlisting">options IPFILTER
options IPFILTER_LOG
options IPFILTER_LOOKUP
options IPFILTER_DEFAULT_BLOCK</pre><p>where <code class="literal">options IPFILTER</code> enables support
	for <span class="application">IPFILTER</span>,
	<code class="literal">options IPFILTER_LOG</code> enables
	<span class="application">IPF</span> logging using the
	<code class="filename">ipl</code> packet logging pseudo-device for
	every rule that has the <code class="literal">log</code> keyword,
	<code class="literal">IPFILTER_LOOKUP</code> enables
	<acronym class="acronym">IP</acronym> pools in order to speed up
	<acronym class="acronym">IP</acronym> lookups, and <code class="literal">options
	  IPFILTER_DEFAULT_BLOCK</code> changes the default
	behavior so that any packet not matching a firewall
	<code class="literal">pass</code> rule gets blocked.</p><p>To configure the system to enable
	<span class="application">IPF</span> at boot time, add the following
	entries to <code class="filename">/etc/rc.conf</code>.  These entries
	will also enable logging and <code class="literal">default pass
	  all</code>.  To change the default policy to
	<code class="literal">block all</code> without  compiling a custom
	kernel, remember to add a <code class="literal">block all</code> rule at
	the end of the ruleset.</p><pre class="programlisting">ipfilter_enable="YES"             # Start ipf firewall
ipfilter_rules="/etc/ipf.rules"   # loads rules definition text file
ipv6_ipfilter_rules="/etc/ipf6.rules" # loads rules definition text file for IPv6
ipmon_enable="YES"                # Start IP monitor log
ipmon_flags="-Ds"                 # D = start as daemon
                                  # s = log to syslog
                                  # v = log tcp window, ack, seq
                                  # n = map IP &amp; port to names</pre><p>If <acronym class="acronym">NAT</acronym> functionality is needed, also
	add these lines:</p><pre class="programlisting">gateway_enable="YES"              # Enable as LAN gateway
ipnat_enable="YES"                # Start ipnat function
ipnat_rules="/etc/ipnat.rules"    # rules definition file for ipnat</pre><p>Then, to start <span class="application">IPF</span> now:</p><pre class="programlisting"><code class="prompt">#</code> <strong class="userinput"><code>service ipfilter start</code></strong></pre><p>To load the firewall rules, specify the name of the
	ruleset file using <code class="command">ipf</code>.  The following
	command can be used to replace the currently running firewall
	rules:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipf -Fa -f /etc/ipf.rules</code></strong></pre><p>where <code class="option">-Fa</code> flushes all the internal rules
	tables and <code class="option">-f</code> specifies the file containing
	the rules to load.</p><p>This provides the ability to make changes to a custom
	ruleset and update the running firewall with a fresh copy of
	the rules without having to reboot the system.  This method is
	convenient for testing new rules as the procedure can be
	executed as many times as needed.</p><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a> for details on the other flags
	available with this command.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70423544"></a>30.5.2. <span class="application">IPF</span> Rule Syntax</h3></div></div></div><a id="idp70424440" class="indexterm"></a><p>This section describes the <span class="application">IPF</span>
	rule syntax used to create stateful rules.  When creating
	rules, keep in mind that unless the <code class="literal">quick</code>
	keyword appears in a rule, every rule is read in order, with
	the <span class="emphasis"><em>last  matching rule</em></span> being the one
	that is applied.  This means that even if the first rule to
	match a packet is a <code class="literal">pass</code>, if there is a
	later matching rule that is a <code class="literal">block</code>, the
	packet will be dropped.  Sample rulesets can be found in
	<code class="filename">/usr/share/examples/ipfilter</code>.</p><p>When creating rules, a <code class="literal">#</code> character is
	used to mark the start of a comment and may appear at the end
	of a rule, to explain that rule's function, or on its own
	line.  Any blank lines are ignored.</p><p>The keywords which are used in rules must be written in a
	specific order, from left to right.  Some keywords are
	mandatory while others are optional.  Some keywords have
	sub-options which may be keywords themselves and also include
	more sub-options.  The keyword order is as follows, where the
	words shown in uppercase represent a variable and the words
	shown in lowercase must precede the variable that follows
	it:</p><p><em class="replaceable"><code>ACTION DIRECTION OPTIONS proto PROTO_TYPE
	  from SRC_ADDR SRC_PORT to DST_ADDR DST_PORT
	  TCP_FLAG|ICMP_TYPE keep state STATE</code></em></p><p>This section describes each of these keywords and their
	options.  It is not an exhaustive list of every possible
	option.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> for a complete description of
	the rule syntax that can be used when creating
	<span class="application">IPF</span> rules and examples for using
	each keyword.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">ACTION</span></dt><dd><p>The action keyword indicates what to do with the
	      packet if it matches that rule.  Every rule
	      <span class="emphasis"><em>must</em></span> have an action.  The
	      following actions are recognized:</p><p><code class="literal">block</code>: drops the packet.</p><p><code class="literal">pass</code>: allows the packet.</p><p><code class="literal">log</code>: generates a log
	      record.</p><p><code class="literal">count</code>: counts the number of
	      packets and bytes which can provide an indication of
	      how often a rule is used.</p><p><code class="literal">auth</code>: queues the packet for
	      further processing by another program.</p><p><code class="literal">call</code>: provides access to
	      functions built into <span class="application">IPF</span> that
	      allow more complex actions.</p><p><code class="literal">decapsulate</code>: removes any headers
	      in order to process the contents of the packet.</p></dd><dt><span class="term">DIRECTION</span></dt><dd><p>Next, each rule must explicitly state the direction
	      of traffic using one of these keywords:</p><p><code class="literal">in</code>: the rule is applied against
	      an inbound packet.</p><p><code class="literal">out</code>: the rule is applied against
	      an outbound packet.</p><p><code class="literal">all</code>: the rule applies to either
	      direction.</p><p>If the system has multiple interfaces, the interface
	      can be specified along with the direction.  An example
	      would be <code class="literal">in on fxp0</code>.</p></dd><dt><span class="term">OPTIONS</span></dt><dd><p>Options are optional.  However, if multiple options
	      are specified, they must be used in the order shown
	      here.</p><p><code class="literal">log</code>: when performing the
	      specified ACTION, the contents of the packet's headers
	      will be written to the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipl&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipl</span>(4)</span></a> packet log
	      pseudo-device.</p><p><code class="literal">quick</code>: if a packet matches this
	      rule, the ACTION specified by the rule occurs and no
	      further processing of any following rules will occur for
	      this packet.</p><p><code class="literal">on</code>: must be followed by the
	      interface name as displayed by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.  The
	      rule will only match if the packet is going through the
	      specified interface in the specified direction.</p><p>When using the
	      <code class="literal">log</code> keyword, the following qualifiers
	      may be used in this order:</p><p><code class="literal">body</code>: indicates that the first
	      128 bytes of the packet contents will be logged after
	      the headers.</p><p><code class="literal">first</code>:  if the
	      <code class="literal">log</code> keyword is being used in
	      conjunction with a <code class="literal">keep state</code> option,
	      this option is recommended so that only the triggering
	      packet is logged and not every packet which matches the
	      stateful connection.</p><p>Additional options are available to specify error
	      return messages.  Refer to  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> for more
	      details.</p></dd><dt><span class="term">PROTO_TYPE</span></dt><dd><p>The protocol type is optional.  However, it is
	      mandatory if the rule needs to specify a SRC_PORT or
	      a DST_PORT as it defines the type of protocol.  When
	      specifying the type of protocol, use the
	      <code class="literal">proto</code> keyword followed by either a
	      protocol number or name from
	      <code class="filename">/etc/protocols</code>.
	      Example protocol names include <code class="literal">tcp</code>,
	      <code class="literal">udp</code>, or <code class="literal">icmp</code>.  If
	      PROTO_TYPE is specified but no SRC_PORT or DST_PORT is
	      specified, all port numbers for that protocol will match
	      that rule.</p></dd><dt><span class="term">SRC_ADDR</span></dt><dd><p>The <code class="literal">from</code> keyword is mandatory and
	      is followed by a keyword which represents the source of
	      the packet.  The source can be a hostname, an
	      <acronym class="acronym">IP</acronym> address followed by the
	      <acronym class="acronym">CIDR</acronym> mask, an address pool, or the
	      keyword <code class="literal">all</code>.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a>
	      for examples.</p><p>There is no way to match ranges of
	      <acronym class="acronym">IP</acronym> addresses which do not express
	      themselves easily using the dotted numeric form /
	      mask-length notation.  The
	      <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/ipcalc/pkg-descr">net-mgmt/ipcalc</a> package or port may
	      be used to ease the calculation of the
	      <acronym class="acronym">CIDR</acronym> mask.  Additional information is
	      available at the utility's web page: <code class="uri"><a class="uri" href="http://jodies.de/ipcalc" target="_top">http://jodies.de/ipcalc</a></code>.</p></dd><dt><span class="term">SRC_PORT</span></dt><dd><p>The port number of the source is optional.  However,
	      if it is used, it requires PROTO_TYPE to be first
	      defined in the rule.  The port number must also be
	      preceded by the <code class="literal">proto</code> keyword.</p><p>A number of different comparison operators are
	      supported: <code class="literal">=</code> (equal to),
	      <code class="literal">!=</code> (not equal to),
	      <code class="literal">&lt;</code> (less than),
	      <code class="literal">&gt;</code> (greater than),
	      <code class="literal">&lt;=</code> (less than or equal to), and
	      <code class="literal">&gt;=</code> (greater than or equal
	      to).</p><p>To specify port ranges, place the two port numbers
	      between <code class="literal">&lt;&gt;</code> (less than and
	      greater than ), <code class="literal">&gt;&lt;</code> (greater
	      than and less than ), or <code class="literal">:</code> (greater
	      than or equal to and less than or equal to).</p></dd><dt><span class="term">DST_ADDR</span></dt><dd><p>The <code class="literal">to</code> keyword is mandatory and
	      is followed by a keyword which represents the
	      destination of the packet.  Similar to SRC_ADDR, it can
	      be a hostname, an  <acronym class="acronym">IP</acronym> address
	      followed by the <acronym class="acronym">CIDR</acronym> mask, an address
	      pool, or the keyword <code class="literal">all</code>.</p></dd><dt><span class="term">DST_PORT</span></dt><dd><p>Similar to SRC_PORT, the port number of the
	      destination is optional.  However, if it is used, it
	      requires PROTO_TYPE to be first defined in the rule.
	      The port number must also be preceded by the
	      <code class="literal">proto</code> keyword.</p></dd><dt><span class="term">TCP_FLAG|ICMP_TYPE</span></dt><dd><p>If <code class="literal">tcp</code> is specified as the
	      PROTO_TYPE, flags can be specified as letters, where
	      each letter represents one of the possible
	      <acronym class="acronym">TCP</acronym> flags used to determine the state
	      of a connection.  Possible values are:
	      <code class="literal">S</code> (SYN),
	      <code class="literal">A</code> (ACK),
	      <code class="literal">P</code> (PSH),
	      <code class="literal">F</code> (FIN),
	      <code class="literal">U</code> (URG),
	      <code class="literal">R</code> (RST),
	      <code class="literal">C</code> (CWN), and
	      <code class="literal">E</code> (ECN).</p><p>If <code class="literal">icmp</code> is specified as the
	      PROTO_TYPE, the <acronym class="acronym">ICMP</acronym> type to match
	      can be specified.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> for the
	      allowable types.</p></dd><dt><span class="term">STATE</span></dt><dd><p>If a <code class="literal">pass</code> rule contains
	      <code class="literal">keep state</code>,
	      <span class="application">IPF</span> will add an entry to its
	      dynamic state table and allow subsequent packets that
	      match the connection.
	      <span class="application">IPF</span> can track state for
	      <acronym class="acronym">TCP</acronym>, <acronym class="acronym">UDP</acronym>, and
	      <acronym class="acronym">ICMP</acronym> sessions.  Any packet that
	      <span class="application">IPF</span> can be certain is part of
	      an active session, even if it is a different protocol,
	      will be allowed.</p><p>In <span class="application">IPF</span>, packets destined
	      to go out through the interface connected to the public
	      Internet are first checked against the dynamic state
	      table.  If the packet matches the next expected packet
	      comprising an active session conversation, it exits the
	      firewall and the state of the session conversation flow
	      is updated in the dynamic state table.  Packets that do
	      not belong to an already active session are checked
	      against the outbound ruleset.  Packets coming in from
	      the interface connected to the public Internet are first
	      checked against the dynamic state table.  If the packet
	      matches the next expected packet comprising an active
	      session, it exits the firewall and the state of the
	      session conversation flow is updated in the dynamic
	      state table.  Packets that do not belong to an already
	      active session are checked against the inbound
	      ruleset.</p><p>Several keywords can be added after
	      <code class="literal">keep state</code>.  If used, these keywords
	      set various options that control stateful filtering,
	      such as setting connection limits or connection age.
	      Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> for the list of available options
	      and their descriptions.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70528632"></a>30.5.3. Example Ruleset</h3></div></div></div><p>This section demonstrates how to create an example ruleset
	which only allows services matching
	<code class="literal">pass</code> rules and blocks all others.</p><p>FreeBSD uses the loopback interface
	(<code class="filename">lo0</code>) and the <acronym class="acronym">IP</acronym>
	address <code class="systemitem">127.0.0.1</code>
	for internal communication.  The firewall ruleset must contain
	rules to allow free movement of these internally used
	packets:</p><pre class="programlisting"># no restrictions on loopback interface
pass in quick on lo0 all
pass out quick on lo0 all</pre><p>The public interface connected to the Internet is used to
	authorize and control access of all outbound and inbound
	connections.  If one or more interfaces are cabled to private
	networks, those internal interfaces may require rules to allow
	packets originating from the <acronym class="acronym">LAN</acronym> to flow
	between the internal networks or to the interface attached to
	the Internet.  The ruleset should be organized into three
	major sections: any trusted internal interfaces, outbound
	connections through the public interface, and inbound
	connections through the public interface.</p><p>These two rules allow all traffic to pass through a
	trusted <acronym class="acronym">LAN</acronym> interface named
	<code class="filename">xl0</code>:</p><pre class="programlisting"># no restrictions on inside LAN interface for private network
pass out quick on xl0 all
pass in quick on xl0 all</pre><p>The rules for the public interface's outbound and inbound
	sections should have the most frequently matched rules placed
	before less commonly matched rules, with the last rule in the
	section blocking and logging all packets for that interface
	and direction.</p><p>This set of rules defines the outbound section of the
	public interface named <code class="filename">dc0</code>.  These rules
	keep state and identify the specific services that internal
	systems are authorized for public Internet access.  All the
	rules use <code class="literal">quick</code> and specify the
	appropriate port numbers and, where applicable, destination
	addresses.</p><pre class="programlisting"># interface facing Internet (outbound)
# Matches session start requests originating from or behind the
# firewall, destined for the Internet.

# Allow outbound access to public DNS servers.
# Replace x.x.x. with address listed in /etc/resolv.conf.
# Repeat for each DNS server.
pass out quick on dc0 proto tcp from any to x.x.x. port = 53 flags S keep state
pass out quick on dc0 proto udp from any to xxx port = 53 keep state

# Allow access to ISP's specified DHCP server for cable or DSL networks.
# Use the first rule, then check log for the IP address of DHCP server.
# Then, uncomment the second rule, replace z.z.z.z with the IP address,
# and comment out the first rule
pass out log quick on dc0 proto udp from any to any port = 67 keep state
#pass out quick on dc0 proto udp from any to z.z.z.z port = 67 keep state

# Allow HTTP and HTTPS
pass out quick on dc0 proto tcp from any to any port = 80 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 443 flags S keep state

# Allow email
pass out quick on dc0 proto tcp from any to any port = 110 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 25 flags S keep state

# Allow NTP
pass out quick on dc0 proto tcp from any to any port = 37 flags S keep state

# Allow FTP
pass out quick on dc0 proto tcp from any to any port = 21 flags S keep state

# Allow SSH
pass out quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Allow ping
pass out quick on dc0 proto icmp from any to any icmp-type 8 keep state

# Block and log everything else
block out log first quick on dc0 all</pre><p>This example of the rules in the inbound section of the
	public interface blocks all undesirable packets first.  This
	reduces the number of packets that are logged by the last
	rule.</p><pre class="programlisting"># interface facing Internet (inbound)
# Block all inbound traffic from non-routable or reserved address spaces
block in quick on dc0 from 192.168.0.0/16 to any    #RFC 1918 private IP
block in quick on dc0 from 172.16.0.0/12 to any     #RFC 1918 private IP
block in quick on dc0 from 10.0.0.0/8 to any        #RFC 1918 private IP
block in quick on dc0 from 127.0.0.0/8 to any       #loopback
block in quick on dc0 from 0.0.0.0/8 to any         #loopback
block in quick on dc0 from 169.254.0.0/16 to any    #DHCP auto-config
block in quick on dc0 from 192.0.2.0/24 to any      #reserved for docs
block in quick on dc0 from 204.152.64.0/23 to any   #Sun cluster interconnect
block in quick on dc0 from 224.0.0.0/3 to any       #Class D &amp; E multicast

# Block fragments and too short tcp packets
block in quick on dc0 all with frags
block in quick on dc0 proto tcp all with short

# block source routed packets
block in quick on dc0 all with opt lsrr
block in quick on dc0 all with opt ssrr

# Block OS fingerprint attempts and log first occurrence
block in log first quick on dc0 proto tcp from any to any flags FUP

# Block anything with special options
block in quick on dc0 all with ipopts

# Block public pings and ident
block in quick on dc0 proto icmp all icmp-type 8
block in quick on dc0 proto tcp from any to any port = 113

# Block incoming Netbios services
block in log first quick on dc0 proto tcp/udp from any to any port = 137
block in log first quick on dc0 proto tcp/udp from any to any port = 138
block in log first quick on dc0 proto tcp/udp from any to any port = 139
block in log first quick on dc0 proto tcp/udp from any to any port = 81</pre><p>Any time there are logged messages on a rule with
	the <code class="literal">log first</code> option, run
	<code class="command">ipfstat -hio</code> to evaluate how many times the
	rule has been matched.  A large number of matches may indicate
	that the system is under attack.</p><p>The rest of the rules in the inbound section define which
	connections are allowed to be initiated from the Internet.
	The last rule denies all connections which were not explicitly
	allowed by previous rules in this section.</p><pre class="programlisting"># Allow traffic in from ISP's DHCP server. Replace z.z.z.z with
# the same IP address used in the outbound section.
pass in quick on dc0 proto udp from z.z.z.z to any port = 68 keep state

# Allow public connections to specified internal web server
pass in quick on dc0 proto tcp from any to x.x.x.x port = 80 flags S keep state

# Block and log only first occurrence of all remaining traffic.
block in log first quick on dc0 all</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70563832"></a>30.5.4. Configuring <acronym class="acronym">NAT</acronym></h3></div></div></div><a id="idp70601592" class="indexterm"></a><a id="idp70602104" class="indexterm"></a><a id="idp70603256" class="indexterm"></a><a id="idp70604408" class="indexterm"></a><p>To enable <acronym class="acronym">NAT</acronym>, add these statements
	to <code class="filename">/etc/rc.conf</code> and specify the name of
	the file containing the <acronym class="acronym">NAT</acronym> rules:</p><pre class="programlisting">gateway_enable="YES"
ipnat_enable="YES"
ipnat_rules="/etc/ipnat.rules"</pre><p><acronym class="acronym">NAT</acronym> rules are flexible and can
	accomplish many different things to fit the needs of both
	commercial and home users.  The rule syntax presented here has
	been simplified to demonstrate common usage.  For a complete
	rule syntax description, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipnat&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipnat</span>(5)</span></a>.</p><p>The basic syntax for a <acronym class="acronym">NAT</acronym> rule is as
	follows, where <code class="literal">map</code> starts the rule and
	<em class="replaceable"><code>IF</code></em> should be replaced with the
	name of the external interface:</p><pre class="programlisting">map <em class="replaceable"><code>IF</code></em> <em class="replaceable"><code>LAN_IP_RANGE</code></em> -&gt; <em class="replaceable"><code>PUBLIC_ADDRESS</code></em></pre><p>The <em class="replaceable"><code>LAN_IP_RANGE</code></em> is the range
	of <acronym class="acronym">IP</acronym> addresses used by internal clients.
	Usually, it is a private address range such as <code class="systemitem">192.168.1.0/24</code>.  The
	<em class="replaceable"><code>PUBLIC_ADDRESS</code></em> can either be the
	static external <acronym class="acronym">IP</acronym> address or the keyword
	<code class="literal">0/32</code> which represents the
	<acronym class="acronym">IP</acronym> address assigned to
	<em class="replaceable"><code>IF</code></em>.</p><p>In <span class="application">IPF</span>, when a packet arrives
	at the firewall from the <acronym class="acronym">LAN</acronym> with a public
	destination, it first passes through the outbound rules of the
	firewall ruleset.  Then, the packet is passed to the
	<acronym class="acronym">NAT</acronym> ruleset which is read from the top
	down, where the first matching rule wins.
	<span class="application">IPF</span> tests each
	<acronym class="acronym">NAT</acronym> rule against the packet's interface
	name and source <acronym class="acronym">IP</acronym> address.  When a
	packet's interface name matches a <acronym class="acronym">NAT</acronym> rule,
	the packet's source <acronym class="acronym">IP</acronym> address in the
	private <acronym class="acronym">LAN</acronym> is checked to see if it falls
	within the <acronym class="acronym">IP</acronym> address range specified in
	<em class="replaceable"><code>LAN_IP_RANGE</code></em>.  On a match, the
	packet has its source <acronym class="acronym">IP</acronym> address rewritten
	with the public <acronym class="acronym">IP</acronym> address specified by
	<em class="replaceable"><code>PUBLIC_ADDRESS</code></em>.
	<span class="application">IPF</span> posts an entry in its internal
	<acronym class="acronym">NAT</acronym> table so that when the packet returns
	from the Internet, it can be mapped back to its original
	private <acronym class="acronym">IP</acronym> address before being passed to
	the firewall rules for further processing.</p><p>For networks that have large numbers of internal systems
	or multiple subnets, the process of funneling every private
	<acronym class="acronym">IP</acronym> address into a single public
	<acronym class="acronym">IP</acronym> address becomes a resource problem.
	Two methods are available to relieve this issue.</p><p>The first method is to assign a range of ports to use as
	source ports.  By adding the <code class="literal">portmap</code>
	keyword, <acronym class="acronym">NAT</acronym> can be directed to only use
	source ports in the specified range:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp 20000:60000</pre><p>Alternately, use the <code class="literal">auto</code> keyword
	which tells <acronym class="acronym">NAT</acronym> to determine the ports
	that are available for use:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp auto</pre><p>The second method is to use a pool of public addresses.
	This is useful when there are too many
	<acronym class="acronym">LAN</acronym> addresses to fit into a single public
	address and a block of public <acronym class="acronym">IP</acronym> addresses
	is available.  These public addresses can be used as a pool
	from which <acronym class="acronym">NAT</acronym> selects an
	<acronym class="acronym">IP</acronym> address as a packet's address is
	mapped on its way out.</p><p>The range of public <acronym class="acronym">IP</acronym> addresses can
	be specified using a netmask or <acronym class="acronym">CIDR</acronym>
	notation.  These two rules are equivalent:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 204.134.75.0/255.255.255.0
map dc0 192.168.1.0/24 -&gt; 204.134.75.0/24</pre><p>A common practice is to have a publically accessible web
	server or mail server segregated to an internal network
	segment.  The traffic from these servers still has to undergo
	<acronym class="acronym">NAT</acronym>, but port redirection is needed to
	direct inbound traffic to the correct server.  For example, to
	map a web server using the internal address <code class="systemitem">10.0.10.25</code> to its public
	<acronym class="acronym">IP</acronym> address of <code class="systemitem">20.20.20.5</code>, use this
	rule:</p><pre class="programlisting">rdr dc0 20.20.20.5/32 port 80 -&gt; 10.0.10.25 port 80</pre><p>If it is the only web server, this rule would also work as
	it redirects all external <acronym class="acronym">HTTP</acronym> requests to
	<code class="literal">10.0.10.25</code>:</p><pre class="programlisting">rdr dc0 0.0.0.0/0 port 80 -&gt; 10.0.10.25 port 80</pre><p><span class="application">IPF</span> has a built in
	<acronym class="acronym">FTP</acronym> proxy which can be used with
	<acronym class="acronym">NAT</acronym>.  It monitors all outbound traffic for
	active or passive <acronym class="acronym">FTP</acronym> connection requests
	and dynamically creates temporary filter rules containing the
	port number used by the <acronym class="acronym">FTP</acronym> data channel.
	This eliminates the need to open large ranges of high order
	ports for <acronym class="acronym">FTP</acronym> connections.</p><p>In this example, the first rule calls the proxy for
	outbound <acronym class="acronym">FTP</acronym> traffic from the internal
	<acronym class="acronym">LAN</acronym>.  The second rule passes the
	<acronym class="acronym">FTP</acronym> traffic from the firewall to the
	Internet, and the third rule handles all
	non-<acronym class="acronym">FTP</acronym> traffic from the internal
	<acronym class="acronym">LAN</acronym>:</p><pre class="programlisting">map dc0 10.0.10.0/29 -&gt; 0/32 proxy port 21 ftp/tcp
map dc0 0.0.0.0/0 -&gt; 0/32 proxy port 21 ftp/tcp
map dc0 10.0.10.0/29 -&gt; 0/32</pre><p>The <acronym class="acronym">FTP</acronym> <code class="literal">map</code> rules go
	before the <acronym class="acronym">NAT</acronym> rule so that when a packet
	matches an <acronym class="acronym">FTP</acronym> rule, the
	<acronym class="acronym">FTP</acronym> proxy creates temporary filter rules to
	let the <acronym class="acronym">FTP</acronym> session packets pass and
	undergo <acronym class="acronym">NAT</acronym>.  All LAN packets that are not
	<acronym class="acronym">FTP</acronym> will not match the
	<acronym class="acronym">FTP</acronym> rules but will undergo
	<acronym class="acronym">NAT</acronym> if they match the third rule.</p><p>Without the <acronym class="acronym">FTP</acronym> proxy, the following
	firewall rules would instead be needed.  Note that without the
	proxy, all ports above <code class="literal">1024</code> need to be
	allowed:</p><pre class="programlisting"># Allow out LAN PC client FTP to public Internet
# Active and passive modes
pass out quick on rl0 proto tcp from any to any port = 21 flags S keep state

# Allow out passive mode data channel high order port numbers
pass out quick on rl0 proto tcp from any to any port &gt; 1024 flags S keep state

# Active mode let data channel in from FTP server
pass in quick on rl0 proto tcp from any to any port = 20 flags S keep state</pre><p>Whenever the file containing the <acronym class="acronym">NAT</acronym>
	rules is edited, run <code class="command">ipnat</code> with
	<code class="option">-CF</code> to delete the current
	<acronym class="acronym">NAT</acronym> rules and flush the contents of the
	dynamic translation table.  Include <code class="option">-f</code> and
	specify the name of the <acronym class="acronym">NAT</acronym> ruleset to
	load:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -CF -f /etc/ipnat.rules</code></strong></pre><p>To display the <acronym class="acronym">NAT</acronym> statistics:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -s</code></strong></pre><p>To list the <acronym class="acronym">NAT</acronym> table's current
	mappings:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -l</code></strong></pre><p>To turn verbose mode on and display information relating
	to rule processing and active rules and table entries:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -v</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70678008"></a>30.5.5. Viewing <span class="application">IPF</span> Statistics</h3></div></div></div><a id="idp70679032" class="indexterm"></a><a id="idp70687864" class="indexterm"></a><p><span class="application">IPF</span> includes <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a>
	which can be used to retrieve
	and display statistics which are gathered
	as packets match rules as they go through the
	firewall.  Statistics are accumulated since the firewall was
	last started or since the last time they
	were reset to zero using <code class="command">ipf
	  -Z</code>.</p><p>The default <code class="command">ipfstat</code> output looks
	like this:</p><pre class="screen">input packets: blocked 99286 passed 1255609 nomatch 14686 counted 0
 output packets: blocked 4200 passed 1284345 nomatch 14687 counted 0
 input packets logged: blocked 99286 passed 0
 output packets logged: blocked 0 passed 0
 packets logged: input 0 output 0
 log failures: input 3898 output 0
 fragment state(in): kept 0 lost 0
 fragment state(out): kept 0 lost 0
 packet state(in): kept 169364 lost 0
 packet state(out): kept 431395 lost 0
 ICMP replies: 0 TCP RSTs sent: 0
 Result cache hits(in): 1215208 (out): 1098963
 IN Pullups succeeded: 2 failed: 0
 OUT Pullups succeeded: 0 failed: 0
 Fastroute successes: 0 failures: 0
 TCP cksum fails(in): 0 (out): 0
 Packet log flags set: (0)</pre><p>Several options are available.  When supplied with either
	<code class="option">-i</code> for inbound or <code class="option">-o</code> for
	outbound, the command will retrieve and display the
	appropriate list of filter rules currently installed and in
	use by the kernel.  To also see the rule numbers, include
	<code class="option">-n</code>.  For example, <code class="command">ipfstat
	  -on</code> displays the outbound rules table with rule
	numbers:</p><pre class="screen">@1 pass out on xl0 from any to any
@2 block out on dc0 from any to any
@3 pass out quick on dc0 proto tcp/udp from any to any keep state</pre><p>Include <code class="option">-h</code> to prefix each rule with a
	count of how many times the rule was matched.  For example,
	<code class="command">ipfstat -oh</code> displays the outbound internal
	rules table, prefixing each rule with its usage count:</p><pre class="screen">2451423 pass out on xl0 from any to any
354727 block out on dc0 from any to any
430918 pass out quick on dc0 proto tcp/udp from any to any keep state</pre><p>To display the state table in a format similar to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a>, use <code class="command">ipfstat -t</code>.  When the
	firewall is under attack, this option provides the ability to
	identify and see the attacking packets.  The optional
	sub-flags give the ability to select the destination or source
	<acronym class="acronym">IP</acronym>, port, or protocol to be monitored in
	real time.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> for details.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70715128"></a>30.5.6. <span class="application">IPF</span> Logging</h3></div></div></div><a id="idp70716024" class="indexterm"></a><a id="idp70716664" class="indexterm"></a><p><span class="application">IPF</span> provides
	<code class="command">ipmon</code>, which can be used to write the
	firewall's logging information in a human readable format.  It
	requires that <code class="literal">options IPFILTER_LOG</code> be first
	added to a custom kernel using the instructions in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>.</p><p>This command is typically run in daemon mode in order to
	provide a continuous system log file so that logging of past
	events may be reviewed.  Since FreeBSD has a built in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> facility to automatically rotate system logs,
	the default <code class="filename">rc.conf</code>
	<code class="literal">ipmon_flags</code> statement uses
	<code class="option">-Ds</code>:</p><pre class="programlisting">ipmon_flags="-Ds" # D = start as daemon
                  # s = log to syslog
                  # v = log tcp window, ack, seq
                  # n = map IP &amp; port to names</pre><p>Logging provides the ability to review, after the fact,
	information such as which packets were dropped, what addresses
	they came from, and where they were going.  This information
	is useful in tracking down attackers.</p><p>Once the logging facility is enabled in
	<code class="filename">rc.conf</code> and started with <code class="command">service
	  ipmon start</code>, <span class="application">IPF</span> will
	only log the rules which contain the <code class="literal">log</code>
	keyword.  The firewall administrator decides which rules in
	the ruleset should be logged and normally only deny rules are
	logged.  It is customary to include the
	<code class="literal">log</code> keyword in the last rule in the
	ruleset.  This makes it possible to see all the packets that
	did not match any of the rules in the ruleset.</p><p>By default, <code class="command">ipmon -Ds</code> mode uses
	<code class="literal">local0</code> as the logging facility.  The
	following logging levels can be used to further segregate the
	logged data:</p><pre class="screen">LOG_INFO - packets logged using the "log" keyword as the action rather than pass or block.
LOG_NOTICE - packets logged which are also passed
LOG_WARNING - packets logged which are also blocked
LOG_ERR - packets which have been logged and which can be considered short due to an incomplete header</pre><p>In order to setup <span class="application">IPF</span> to
	log all data to <code class="filename">/var/log/ipfilter.log</code>,
	first create the empty file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>touch /var/log/ipfilter.log</code></strong></pre><p>Then, to write all logged messages to the specified file,
	add the following statement to
	<code class="filename">/etc/syslog.conf</code>:</p><pre class="programlisting">local0.* /var/log/ipfilter.log</pre><p>To activate the changes and instruct <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>
	to read the modified <code class="filename">/etc/syslog.conf</code>,
	run <code class="command">service syslogd reload</code>.</p><p>Do not forget to edit
	<code class="filename">/etc/newsyslog.conf</code> to rotate the new
	log file.</p><p>Messages generated by <code class="command">ipmon</code> consist
	of data fields separated by white space.  Fields common to
	all messages are:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The date of packet receipt.</p></li><li class="listitem"><p>The time of packet receipt.  This is in the form
	    HH:MM:SS.F, for hours, minutes, seconds, and fractions
	    of a second.</p></li><li class="listitem"><p>The name of the interface that processed the
	    packet.</p></li><li class="listitem"><p>The group and rule number of the rule in the format
	    <code class="literal">@0:17</code>.</p></li><li class="listitem"><p>The action: <code class="literal">p</code> for passed,
	    <code class="literal">b</code> for blocked, <code class="literal">S</code> for
	    a short packet, <code class="literal">n</code> did not match any
	    rules, and <code class="literal">L</code> for a log rule.</p></li><li class="listitem"><p>The addresses written as three fields: the source
	    address and port separated by a comma, the -&gt; symbol,
	    and the destination address and port.  For example:
	    <code class="literal">209.53.17.22,80 -&gt;
	      198.73.220.17,1722</code>.</p></li><li class="listitem"><p><code class="literal">PR</code> followed by the protocol name
	    or number: for example, <code class="literal">PR tcp</code>.</p></li><li class="listitem"><p><code class="literal">len</code> followed by the header length
	    and total length of the packet: for example,
	    <code class="literal">len 20 40</code>.</p></li></ol></div><p>If the packet is a <acronym class="acronym">TCP</acronym> packet, there
	will be an additional field starting with a hyphen followed by
	letters corresponding to any flags that were set.  Refer to
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> for a list of letters and their flags.</p><p>If the packet is an <acronym class="acronym">ICMP</acronym> packet, there
	will be two fields at the end:  the first always being
	<span class="quote">&#8220;<span class="quote">icmp</span>&#8221;</span> and the next being the
	<acronym class="acronym">ICMP</acronym> message and sub-message type,
	separated by a slash.  For example:
	<code class="literal">icmp 3/3</code> for a port unreachable
	message.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-blacklistd"></a>30.6. Blacklistd</h2></div></div></div><p>Blacklistd is a daemon listening to sockets to receive
      notifications from other daemons about connection attempts
      that failed or were successful.  It is most widely used in
      blocking too many connection attempts on open ports.  A
      prime example is <span class="application">SSH</span> running on
      the internet getting a lot of requests from bots or scripts
      trying to guess passwords and gain access.  Using
      <span class="application">blacklistd</span>, the daemon can notify
      the firewall to create a filter rule to block excessive
      connection attempts from a single source after a number of
      tries.  Blacklistd was first developed on
      NetBSD and appeared there in version 7.  FreeBSD 11
      imported blacklistd from NetBSD.</p><p>This chapter describes how to set up blacklistd,
      configure it, and provides examples on how to use it.
      Readers should be familiar with basic firewall concepts like
      rules.  For details, refer to the firewall chapter.  PF is
      used in the examples, but other firewalls available on
      FreeBSD should be able to work with blacklistd, too.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70758392"></a>30.6.1. Enabling Blacklistd</h3></div></div></div><p>The main configuration for blacklistd is stored in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">blacklistd.conf</span>(5)</span></a>.  Various command line options are
	also available to change blacklistd's run-time behavior.
	Persistent configuration across reboots should be stored
	in <code class="filename">/etc/blacklistd.conf</code>.  To enable
	the daemon during system boot, add a
	<code class="literal">blacklistd_enable</code> line to
	<code class="filename">/etc/rc.conf</code> like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc blacklistd_enable=yes</code></strong></pre><p>To start the service manually, run this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service blacklistd start</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70767736"></a>30.6.2. Creating a Blacklistd Ruleset</h3></div></div></div><p>Rules for blacklistd are configured in
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">blacklistd.conf</span>(5)</span></a> with one entry per line.  Each
	rule contains a tuple separated by spaces or tabs.  Rules
	either belong to a <code class="literal">local</code> or a
	<code class="literal">remote</code>, which applies to the machine
	where blacklistd is running or an outside source,
	respectively.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70786680"></a>30.6.2.1. Local Rules</h4></div></div></div><p>An example blacklistd.conf entry for a local rule
	  looks like this:</p><pre class="programlisting">[local]
ssh             stream  *       *               *       3       24h</pre><p>All rules that follow the <code class="literal">[local]</code>
	  section are treated as local rules (which is the
	  default), applying to the local machine.  When a
	  <code class="literal">[remote]</code> section is encountered, all
	  rules that follow it are handled as remote machine
	  rules.</p><p>Seven fields define a rule separated by either tabs
	  or spaces.  The first four fields identify the traffic
	  that should be blacklisted.  The three fields that
	  follow define backlistd's behavior.  Wildcards are
	  denoted as asterisks (<code class="literal">*</code>), matching
	  anything in this field.  The first field defines the
	  location.  In local rules, these are the network ports.
	  The syntax for the location field is as follows:</p><pre class="programlisting">[<em class="replaceable"><code>address</code></em>|<em class="replaceable"><code>interface</code></em>][/<em class="replaceable"><code>mask</code></em>][:<em class="replaceable"><code>port</code></em>]</pre><p>Adressses can be specified as IPv4 in numeric format
	    or IPv6 in square brackets.  An interface name like
	    <code class="literal"><em class="replaceable"><code>em0</code></em></code> can also
	    be used.</p><p>The socket type is defined by the second field.  TCP
	    sockets are of type <code class="literal">stream</code>, whereas UDP
	    is denoted as <code class="literal">dgram</code>.  The example above
	    uses TCP, since SSH is using that protocol.</p><p>A protocol can be used in the third field of a
	    blacklistd rule.  The following protocols can be used:
	    <code class="literal">tcp</code>, <code class="literal">udp</code>,
	    <code class="literal">tcp6</code>, <code class="literal">udp6</code>, or
	    numeric.  A wildcard, like in the example, is typically
	    used to match all protocols unless there is a reason to
	    distinguish traffic by a certain protocol.</p><p>In the fourth field, the effective user or owner of
	    the daemon process that is reporting the event is defined.
	    The username or <acronym class="acronym">UID</acronym> can be used here,
	    as well as a wildcard (see example rule above).</p><p>The packet filter rule name is declared by the fifth
	    field, which starts the behavior part of the rule.  By
	    default, blacklistd puts all blocks under a pf anchor
	    called <code class="literal">blacklistd</code> in
	    <code class="filename">pf.conf</code> like this:</p><pre class="programlisting">anchor "blacklistd/*" in on $ext_if
block in
pass out</pre><p>For separate blacklists, an anchor name can be used in
	    this field.  In other cases, the wildcard will suffice.
	    When a name starts with a hyphen (<code class="literal">-</code>) it
	    means that an anchor with the default rule name prepended
	    should be used.  A modified example from the above using
	    the hyphen would look like this:</p><pre class="programlisting">ssh             stream  *       *               -ssh       3       24h</pre><p>With such a rule, any new blacklist rules are added to
	    an anchor called <code class="literal">blacklistd-ssh</code>.</p><p>To block whole subnets for a single rule violation, a
	    <code class="literal">/</code> in the rule name can be used.  This
	    causes the remaining portion of the name to be interpreted
	    as the mask to be applied to the address specified in
	    the rule.  For example, this rule would block every
	    address adjoining <code class="literal">/24</code>.</p><pre class="programlisting">22              stream  tcp       *               */24    3       24h</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is important to specify the proper
	      protocol here.  IPv4 and IPv6 treat /24 differently,
	      that is the reason why <code class="literal">*</code> cannot be
	      used in the third field for this rule.</p></div><p>This rule defines that if any one host in that network
	    is misbehaving, everything else on that network will be
	    blocked, too.</p><p>The sixth field, called <code class="literal">nfail</code>, sets
	    the number of login failures required to blacklist the
	    remote IP in question.  When a wildcard is used at this
	    position, it means that blocks will never happen.  In the
	    example rule above, a limit of three is defined meaning
	    that after three attempts to log into
	    <span class="application">SSH</span> on one connection, the IP
	    is blocked.</p><p>The last field in a blacklistd rule definition
	    specifies how long a host is blacklisted.  The default
	    unit is seconds, but suffixes like <code class="literal">m</code>,
	    <code class="literal">h</code>, and <code class="literal">d</code> can also be
	    specified for minutes, hours, and days,
	    respectively.</p><p>The example rule in its entirety means that after
	    three times authenticating to
	    <span class="application">SSH</span> will result in a new PF
	    block rule for that host.  Rule matches are performed by
	    first checking local rules one after another, from most
	    specific to least specific.  When a match occurs, the
	    <code class="literal">remote</code> rules are applied and the name,
	    <code class="literal">nfail</code>, and disable fields are changed
	    by the <code class="literal">remote</code> rule that matched.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70816376"></a>30.6.2.2. Remote Rules</h4></div></div></div><p>Remote rules are used to specify how blacklistd
	    changes its behavior depending on the remote host
	    currently being evaluated.  Each field in a remote rule
	    is the same as in a local rule.  The only difference is
	    in the way blacklistd is using them.  To explain it,
	    this example rule is used:</p><pre class="programlisting">[remote]
203.0.113.128/25 *      *       *               =/25    =       48h</pre><p>The address field can be an IP address (either v4 or
	    v6), a port or both.  This allows setting special rules
	    for a specific remote address range like in this example.
	    The fields for type, protocol and owner are identically
	    interpreted as in the local rule.</p><p>The name fields is different though: the equal sign
	    (<code class="literal">=</code>) in a remote rule tells blacklistd
	    to use the value from the matching local rule.  It means
	    that the firewall rule entry is taken and the
	    <code class="systemitem">/25</code> prefix (a
	    netmask of <code class="systemitem">255.255.255.128</code>) is added.
	    When a connection from that address range is blacklisted,
	    the entire subnet is affected.  A PF anchor name can also
	    be used here, in which case blacklistd will add rules for
	    this address block to the anchor of that name.  The
	    default table is used when a wildcard is specified.</p><p>A custom number of failures in the
	    <code class="literal">nfail</code> column can be defined for an
	    address.  This is useful for exceptions to a specific
	    rule, to maybe allow someone a less strict application
	    of rules or a bit more leniency in login tries.
	    Blocking is disabled when an asterisk is used in this
	    sixth field.</p><p>Remote rules allow a stricter enforcement of limits
	    on attempts to log in compared to attempts coming from a
	    local network like an office.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70821368"></a>30.6.3. Blacklistd Client Configuration</h3></div></div></div><p>There are a few software packages in FreeBSD that can
	  utilize blacklistd's functionality.  The two most
	  prominent ones are <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> to block
	  excessive connection attempts.  To activate blacklistd in
	  the SSH daemon, add the following line to
	  <code class="filename">/etc/ssh/sshd_config</code>:</p><pre class="programlisting">UseBlacklist yes</pre><p>Restart sshd afterwards to make these changes take
	  effect.</p><p>Blacklisting for <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a> is enabled using
	  <code class="literal">-B</code>, either in
	  <code class="filename">/etc/inetd.conf</code> or as a
	  flag in <code class="filename">/etc/rc.conf</code> like
	  this:</p><pre class="programlisting">ftpd_flags="-B"</pre><p>That is all that is needed to make these programs
	  talk to blacklistd.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70832504"></a>30.6.4. Blacklistd Management</h3></div></div></div><p>Blacklistd provides the user with a management utility
	  called <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=blacklistctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">blacklistctl</span>(8)</span></a>.  It displays blocked
	  addresses and networks that are blacklisted by the rules
	  defined in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">blacklistd.conf</span>(5)</span></a>.  To see the
	  list of currently blocked hosts, use
	  <code class="command">dump</code> combined with <code class="option">-b</code>
	  like this.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>blacklistctl dump -b</code></strong>
      address/ma:port id      nfail   last access
213.0.123.128/25:22   OK      6/3     2019/06/08 14:30:19</pre><p>This example shows that there were 6 out of three
	  permitted attempts on port 22 coming from the address
	  range <code class="systemitem">213.0.123.128/25</code>.  There
	  are more attempts listed than are allowed because SSH
	  allows a client to try multiple logins on a single TCP
	  connection.  A connection that is currently going on is
	  not stopped by blacklistd.  The last connection attempt is
	  listed in the <code class="literal">last access</code> column of the
	  output.</p><p>To see the remaining time that this host will be on
	  the blacklist, add <code class="option">-r</code> to the previous
	  command.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>blacklistctl dump -br</code></strong>
      address/ma:port id      nfail   remaining time
213.0.123.128/25:22   OK      6/3     36s</pre><p>In this example, there are 36s seconds left until this
	  host will not be blocked any more.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70840568"></a>30.6.5. Removing Hosts from the Block List</h3></div></div></div><p>Sometimes it is necessary to remove a host from the
	  block list before the remaining time expires.
	  Unfortunately, there is no functionality in blacklistd to
	  do that.  However, it is possible to remove the address
	  from the PF table using pfctl.  For each blocked port,
	  there is a child anchor inside the blacklistd anchor
	  defined in <code class="filename">/etc/pf.conf</code>.  For
	  example, if there is a child anchor for blocking port 22
	  it is called <code class="literal">blacklistd/22</code>.  There is a
	  table inside that child anchor that contains the blocked
	  addresses.  This table is called port followed by the port
	  number.  In this example, it would be called
	  <code class="literal">port22</code>.  With that information at hand,
	  it is now possible to use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a> to display all
	  addresses listed like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -a <em class="replaceable"><code>blacklistd/22</code></em> -t <em class="replaceable"><code>port22</code></em> -T show</code></strong>
...
213.0.123.128/25
...</pre><p>After identifying the address to be unblocked from the
	  list, the following command removes it from the list:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -a <em class="replaceable"><code>blacklistd/22</code></em> -t <em class="replaceable"><code>port22</code></em> -T delete <em class="replaceable"><code>213.0.123.128/25</code></em></code></strong></pre><p>The address is now removed from PF, but will still
	  show up in the blacklistctl list, since it does not know
	  about any changes made in PF.  The entry in blacklistd's
	  database will eventually expire and be removed from its
	  output eventually.  The entry will be added again if the
	  host is matching one of the block rules in blacklistd
	  again.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="advanced-networking"></a>Chapter 31. Advanced Networking</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#advanced-networking-synopsis">31.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#network-routing">31.2. Gateways and Routes</a></span></dt><dt><span class="sect1"><a href="#network-wireless">31.3. Wireless Networking</a></span></dt><dt><span class="sect1"><a href="#network-usb-tethering">31.4. USB Tethering</a></span></dt><dt><span class="sect1"><a href="#network-bluetooth">31.5. Bluetooth</a></span></dt><dt><span class="sect1"><a href="#network-bridging">31.6. Bridging</a></span></dt><dt><span class="sect1"><a href="#network-aggregation">31.7. Link Aggregation and Failover</a></span></dt><dt><span class="sect1"><a href="#network-diskless">31.8. Diskless Operation with <acronym class="acronym">PXE</acronym></a></span></dt><dt><span class="sect1"><a href="#network-ipv6">31.9. <acronym class="acronym">IPv6</acronym></a></span></dt><dt><span class="sect1"><a href="#carp">31.10. Common Address Redundancy Protocol
	(<acronym class="acronym">CARP</acronym>)</a></span></dt><dt><span class="sect1"><a href="#network-vlan">31.11. VLANs</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="advanced-networking-synopsis"></a>31.1. Synopsis</h2></div></div></div><p>This chapter covers a number of advanced networking
      topics.</p><p>After reading this chapter, you will know:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The basics of gateways and routes.</p></li><li class="listitem"><p>How to set up USB tethering.</p></li><li class="listitem"><p>How to set up <span class="trademark">IEEE</span>® 802.11 and <span class="trademark">Bluetooth</span>®
	  devices.</p></li><li class="listitem"><p>How to make FreeBSD act as a bridge.</p></li><li class="listitem"><p>How to set up network <acronym class="acronym">PXE</acronym>
	  booting.</p></li><li class="listitem"><p>How to set up <acronym class="acronym">IPv6</acronym> on a FreeBSD
	  machine.</p></li><li class="listitem"><p>How to enable and utilize the features of the Common
	  Address Redundancy Protocol (<acronym class="acronym">CARP</acronym>) in
	  FreeBSD.</p></li><li class="listitem"><p>How to configure multiple <acronym class="acronym">VLANs</acronym> on
	  FreeBSD.</p></li><li class="listitem"><p>Configure bluetooth headset.</p></li></ul></div><p>Before reading this chapter, you should:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Understand the basics of the
	  <code class="filename">/etc/rc</code> scripts.</p></li><li class="listitem"><p>Be familiar with basic network terminology.</p></li><li class="listitem"><p>Know how to configure and install a new FreeBSD kernel
	  (<a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>).</p></li><li class="listitem"><p>Know how to install additional third-party software
	  (<a class="xref" href="#ports" title="Chapter 4. Installing Applications: Packages and Ports">Chapter 4, <em>Installing Applications: Packages and Ports</em></a>).</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-routing"></a>31.2. Gateways and Routes</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Coranth</span> <span class="surname">Gryphon</span></span>. </span></div></div></div><a id="idp70881784" class="indexterm"></a><a id="idp70882552" class="indexterm"></a><a id="idp70883320" class="indexterm"></a><p><em class="firstterm">Routing</em> is the mechanism that allows
      a system to find the network path to another system.  A
      <em class="firstterm">route</em> is a defined pair of addresses
      which represent the <span class="quote">&#8220;<span class="quote">destination</span>&#8221;</span> and a
      <span class="quote">&#8220;<span class="quote">gateway</span>&#8221;</span>.  The route indicates that when trying
      to get to the specified destination, send the packets through
      the specified gateway.  There are three types of destinations:
      individual hosts, subnets, and <span class="quote">&#8220;<span class="quote">default</span>&#8221;</span>.  The
      <span class="quote">&#8220;<span class="quote">default route</span>&#8221;</span> is used if no other routes apply.
      There are also three types of gateways: individual hosts,
      interfaces, also called links, and Ethernet hardware
      (<acronym class="acronym">MAC</acronym>) addresses.  Known routes are stored in
      a routing table.</p><p>This section provides an overview of routing basics.  It
      then demonstrates how to configure a FreeBSD system as a router and
      offers some troubleshooting tips.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-routing-default"></a>31.2.1. Routing Basics</h3></div></div></div><p>To view the routing table of a FreeBSD system, use
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">netstat</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>netstat -r</code></strong>
Routing tables

Internet:
Destination      Gateway            Flags     Refs     Use     Netif Expire
default          outside-gw         UGS        37      418       em0
localhost        localhost          UH          0      181       lo0
test0            0:e0:b5:36:cf:4f   UHLW        5    63288       re0     77
10.20.30.255     link#1             UHLW        1     2421
example.com      link#1             UC          0        0
host1            0:e0:a8:37:8:1e    UHLW        3     4601       lo0
host2            0:e0:a8:37:8:1e    UHLW        0        5       lo0 =&gt;
host2.example.com link#1            UC          0        0
224              link#1             UC          0        0</pre><p>The entries in this example are as follows:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">default</span></dt><dd><p>The first route in this table specifies the
	      <code class="literal">default</code> route.  When the local system
	      needs to make a connection to a remote host, it checks
	      the routing table to determine if a known path exists.
	      If the remote host matches an entry in the table, the
	      system checks to see if it can connect using the
	      interface specified in that entry.</p><p>If the destination does not match an entry, or if
	      all known paths fail, the system uses the entry for the
	      default route.  For hosts on a local area network, the
	      <code class="literal">Gateway</code> field in the default route is
	      set to the system which has a direct connection to the
	      Internet.  When reading this entry, verify that the
	      <code class="literal">Flags</code> column indicates that the
	      gateway is usable (<code class="literal">UG</code>).</p><p>The default route for a machine which itself is
	      functioning as the gateway to the outside world will be
	      the gateway machine at the Internet Service Provider
	      (<acronym class="acronym">ISP</acronym>).</p></dd><dt><span class="term">localhost</span></dt><dd><p>The second route is the <code class="literal">localhost</code>
	      route.  The interface specified in the
	      <code class="literal">Netif</code> column for
	      <code class="literal">localhost</code> is
	      <code class="filename">lo0</code>, also known as the loopback
	      device.  This indicates that all traffic for this
	      destination should be internal, rather than sending it
	      out over the network.</p></dd><dt><span class="term">MAC address</span></dt><dd><p>The addresses beginning with <code class="systemitem">0:e0:</code> are
	      <acronym class="acronym">MAC</acronym> addresses.  FreeBSD will
	      automatically identify any hosts,
	      <code class="systemitem">test0</code> in the example, on the
	      local Ethernet and add a route for that host over the
	      Ethernet interface, <code class="filename">re0</code>.  This type
	      of route has a timeout, seen in the
	      <code class="literal">Expire</code> column, which is used if the
	      host does not respond in a specific amount of time.
	      When this happens, the route to this host will be
	      automatically deleted.  These hosts are identified using
	      the Routing Information Protocol
	      (<acronym class="acronym">RIP</acronym>), which calculates routes to
	      local hosts based upon a shortest path
	      determination.</p></dd><dt><span class="term">subnet</span></dt><dd><p>FreeBSD will automatically add subnet routes for the
	      local subnet.  In this example, <code class="systemitem">10.20.30.255</code> is the
	      broadcast address for the subnet <code class="systemitem">10.20.30</code> and
	      <code class="systemitem">example.com</code> is the
	      domain name associated with that subnet.  The
	      designation <code class="literal">link#1</code> refers to the
	      first Ethernet card in the machine.</p><p>Local network hosts and local subnets have their
	      routes automatically configured by a daemon called
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=routed&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">routed</span>(8)</span></a>.  If it is not running, only routes which
	      are statically defined by the administrator will
	      exist.</p></dd><dt><span class="term">host</span></dt><dd><p>The <code class="literal">host1</code> line refers to the host
	      by its Ethernet address.  Since it is the sending host,
	      FreeBSD knows to use the loopback interface
	      (<code class="filename">lo0</code>) rather than the Ethernet
	      interface.</p><p>The two <code class="literal">host2</code> lines represent
	      aliases which were created using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.  The
	      <code class="literal">=&gt;</code> symbol after the
	      <code class="filename">lo0</code> interface says that an alias
	      has been set in addition to the loopback address.  Such
	      routes only show up on the host that supports the alias
	      and all other hosts on the local network will have a
	      <code class="literal">link#1</code> line for such routes.</p></dd><dt><span class="term">224</span></dt><dd><p>The final line (destination subnet <code class="systemitem">224</code>) deals with
	      multicasting.</p></dd></dl></div><p>Various attributes of each route can be seen in the
	<code class="literal">Flags</code> column.  <a class="xref" href="#routeflags" title="Table 31.1. Commonly Seen Routing Table Flags">Table 31.1, &#8220;Commonly Seen Routing Table Flags&#8221;</a>
	summarizes some of these flags and their meanings:</p><div class="table"><a id="routeflags"></a><div class="table-title">Table 31.1. Commonly Seen Routing Table Flags</div><div class="table-contents"><table class="table" summary="Commonly Seen Routing Table Flags" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Command</th><th>Purpose</th></tr></thead><tbody><tr><td>U</td><td>The route is active (up).</td></tr><tr><td>H</td><td>The route destination is a single host.</td></tr><tr><td>G</td><td>Send anything for this destination on to this
		gateway, which will figure out from there where to
		send it.</td></tr><tr><td>S</td><td>This route was statically configured.</td></tr><tr><td>C</td><td>Clones a new route based upon this route for
		machines to connect to.  This type of route is
		normally used for local networks.</td></tr><tr><td>W</td><td>The route was auto-configured based upon a local
		area network (clone) route.</td></tr><tr><td>L</td><td>Route involves references to Ethernet (link)
		hardware.</td></tr></tbody></table></div></div><br class="table-break" /><p>On a FreeBSD system, the default route can defined in
	<code class="filename">/etc/rc.conf</code> by specifying the
	<acronym class="acronym">IP</acronym> address of the default gateway:</p><pre class="programlisting">defaultrouter="10.20.30.1"</pre><p>It is also possible to manually add the route using
	<code class="command">route</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>route add default 10.20.30.1</code></strong></pre><p>Note that manually added routes will not survive a reboot.
	For more information on manual manipulation of network
	routing tables, refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=route&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">route</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-static-routes"></a>31.2.2. Configuring a Router with Static Routes</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Al</span> <span class="surname">Hoang</span></span>. </span></div></div></div><a id="idp70959992" class="indexterm"></a><p>A FreeBSD system can be configured as the default gateway, or
	router, for a network if it is a dual-homed system.  A
	dual-homed system is a host which resides on at least two
	different networks.  Typically, each network is connected to a
	separate network interface, though <acronym class="acronym">IP</acronym>
	aliasing can be used to bind multiple addresses, each on a
	different subnet, to one physical interface.</p><a id="idp70961528" class="indexterm"></a><p>In order for the system to forward packets between
	interfaces, FreeBSD must be configured as a router.  Internet
	standards and good engineering practice prevent the FreeBSD
	Project from enabling this feature by default, but it can be
	configured to start at boot by adding this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">gateway_enable="YES"          # Set to YES if this host will be a gateway</pre><p>To enable routing now, set the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable
	<code class="varname">net.inet.ip.forwarding</code> to
	<code class="literal">1</code>.  To stop routing, reset this variable to
	<code class="literal">0</code>.</p><a id="idp70965752" class="indexterm"></a><a id="idp70966520" class="indexterm"></a><a id="idp70967288" class="indexterm"></a><p>The routing table of a router needs additional routes so
	it knows how to reach other networks.  Routes can be either
	added manually using static routes or routes can be
	automatically learned using a routing protocol.  Static routes
	are appropriate for small networks and this section describes
	how to add a static routing entry for a small network.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">For large networks, static routes quickly become
	  unscalable.  FreeBSD comes with the standard
	  <acronym class="acronym">BSD</acronym> routing daemon <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=routed&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">routed</span>(8)</span></a>, which
	  provides the routing protocols <acronym class="acronym">RIP</acronym>,
	  versions 1 and 2, and <acronym class="acronym">IRDP</acronym>.  Support for
	  the <acronym class="acronym">BGP</acronym> and <acronym class="acronym">OSPF</acronym>
	  routing protocols can be installed using the
	  <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/zebra/pkg-descr">net/zebra</a> package or port.</p></div><p>Consider the following network:</p><div class="mediaobject"><img src="advanced-networking/static-routes.png" /></div><p>In this scenario, <code class="systemitem">RouterA</code> is a
	FreeBSD machine that is acting as a router to the rest of the
	Internet.  It has a default route set to <code class="systemitem">10.0.0.1</code> which allows it to
	connect with the outside world.
	<code class="systemitem">RouterB</code> is already configured to use
	<code class="systemitem">192.168.1.1</code> as its
	default gateway.</p><p>Before adding any static routes, the routing table on
	<code class="systemitem">RouterA</code> looks like this:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>netstat -nr</code></strong>
Routing tables

Internet:
Destination        Gateway            Flags    Refs      Use  Netif  Expire
default            10.0.0.1           UGS         0    49378    xl0
127.0.0.1          127.0.0.1          UH          0        6    lo0
10.0.0.0/24        link#1             UC          0        0    xl0
192.168.1.0/24     link#2             UC          0        0    xl1</pre><p>With the current routing table,
	<code class="systemitem">RouterA</code> does not have a route to the
	<code class="systemitem">192.168.2.0/24</code>
	network.  The following command adds the <code class="literal">Internal Net
	  2</code> network to <code class="systemitem">RouterA</code>'s
	routing table using <code class="systemitem">192.168.1.2</code> as the next
	hop:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>route add -net 192.168.2.0/24 192.168.1.2</code></strong></pre><p>Now, <code class="systemitem">RouterA</code> can reach any host
	on the <code class="systemitem">192.168.2.0/24</code> network.
	However, the routing information will not persist if the FreeBSD
	system reboots.  If a static route needs to be persistent, add
	it to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting"># Add Internal Net 2 as a persistent static route
static_routes="internalnet2"
route_internalnet2="-net 192.168.2.0/24 192.168.1.2"</pre><p>The <code class="literal">static_routes</code> configuration
	variable is a list of strings separated by a space, where each
	string references a route name.  The variable
	<code class="literal">route_<em class="replaceable"><code>internalnet2</code></em></code>
	contains the static route for that route name.</p><p>Using more than one string in
	<code class="literal">static_routes</code> creates multiple static
	routes.  The following shows an example of adding static
	routes for the <code class="systemitem">192.168.0.0/24</code> and
	<code class="systemitem">192.168.1.0/24</code>
	networks:</p><pre class="programlisting">static_routes="net1 net2"
route_net1="-net 192.168.0.0/24 192.168.0.1"
route_net2="-net 192.168.1.0/24 192.168.1.1"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-routing-troubleshooting"></a>31.2.3. Troubleshooting</h3></div></div></div><p>When an address space is assigned to a network, the
	service provider configures their routing tables so that all
	traffic for the network will be sent to the link for the site.
	But how do external sites know to send their packets to the
	network's <acronym class="acronym">ISP</acronym>?</p><p>There is a system that keeps track of all assigned
	address spaces and defines their point of connection to the
	Internet backbone, or the main trunk lines that carry Internet
	traffic across the country and around the world.  Each
	backbone machine has a copy of a master set of tables, which
	direct traffic for a particular network to a specific
	backbone carrier, and from there down the chain of service
	providers until it reaches a particular network.</p><p>It is the task of the service provider to advertise to
	the backbone sites that they are the point of connection, and
	thus the path inward, for a site.  This is known as route
	propagation.</p><a id="idp71010936" class="indexterm"></a><p>Sometimes, there is a problem with route propagation and
	some sites are unable to connect.  Perhaps the most useful
	command for trying to figure out where routing is breaking
	down is <code class="command">traceroute</code>.  It is useful when
	<code class="command">ping</code> fails.</p><p>When using <code class="command">traceroute</code>, include the
	address of the remote host to connect to.  The output will
	show the gateway hosts along the path of the attempt,
	eventually either reaching the target host, or terminating
	because of a lack of connection.  For more information, refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">traceroute</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-routing-multicast"></a>31.2.4. Multicast Considerations</h3></div></div></div><a id="idp71019896" class="indexterm"></a><a id="idp71020664" class="indexterm"></a><p>FreeBSD natively supports both multicast applications and
	multicast routing.  Multicast applications do not require any
	special configuration in order to run on FreeBSD.  Support for
	multicast routing requires that the following option be
	compiled into a custom kernel:</p><pre class="programlisting">options MROUTING</pre><p>The multicast routing daemon,
	<span class="application">mrouted</span> can be installed using the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/mrouted/pkg-descr">net/mrouted</a> package or port.  This daemon
	implements the <acronym class="acronym">DVMRP</acronym> multicast routing
	protocol and is configured by editing
	<code class="filename">/usr/local/etc/mrouted.conf</code> in order to
	set up the tunnels and <acronym class="acronym">DVMRP</acronym>.  The
	installation of <span class="application">mrouted</span> also
	installs <span class="application">map-mbone</span> and
	<span class="application">mrinfo</span>, as well as their associated
	man pages.  Refer to these for configuration examples.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><acronym class="acronym">DVMRP</acronym> has largely been replaced by
	  the <acronym class="acronym">PIM</acronym> protocol in many multicast
	  installations.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pim&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pim</span>(4)</span></a> for more
	  information.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-wireless"></a>31.3. Wireless Networking</h2></div><div><span class="authorgroup"><span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="othername">Loader</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div></div></div><a id="idp71058808" class="indexterm"></a><a id="idp71059576" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71060728"></a>31.3.1. Wireless Networking Basics</h3></div></div></div><p>Most wireless networks are based on the <span class="trademark">IEEE</span>® 802.11
	standards.  A basic wireless network consists of multiple
	stations communicating with radios that broadcast in either
	the 2.4GHz or 5GHz band, though this varies according to the
	locale and is also changing to enable communication in the
	2.3GHz and 4.9GHz ranges.</p><p>802.11 networks are organized in two ways.  In
	<span class="emphasis"><em>infrastructure mode</em></span>, one station acts as
	a
	master with all the other stations associating to it, the
	network is known as a <acronym class="acronym">BSS</acronym>, and the master
	station is termed an access point (<acronym class="acronym">AP</acronym>).
	In a <acronym class="acronym">BSS</acronym>, all communication passes through
	the <acronym class="acronym">AP</acronym>; even when one station wants to
	communicate with another wireless station, messages must go
	through the <acronym class="acronym">AP</acronym>.  In the second form of
	network, there is no master and stations communicate directly.
	This form of network is termed an <acronym class="acronym">IBSS</acronym>
	and is commonly known as an <span class="emphasis"><em>ad-hoc
	  network</em></span>.</p><p>802.11 networks were first deployed in the 2.4GHz band
	using protocols defined by the <span class="trademark">IEEE</span>® 802.11 and 802.11b
	standard.  These specifications include the operating
	frequencies and the <acronym class="acronym">MAC</acronym> layer
	characteristics, including framing and transmission rates,
	as communication can occur at various rates.  Later, the
	802.11a standard defined operation in the 5GHz band, including
	different signaling mechanisms and higher transmission rates.
	Still later, the 802.11g standard defined the use of 802.11a
	signaling and transmission mechanisms in the 2.4GHz band in
	such a way as to be backwards compatible with 802.11b
	networks.</p><p>Separate from the underlying transmission techniques,
	802.11 networks have a variety of security mechanisms.  The
	original 802.11 specifications defined a simple security
	protocol called <acronym class="acronym">WEP</acronym>.  This protocol uses a
	fixed pre-shared key and the RC4 cryptographic cipher to
	encode data transmitted on a network.  Stations must all
	agree on the fixed key in order to communicate.  This scheme
	was shown to be easily broken and is now rarely used except
	to discourage transient users from joining networks.  Current
	security practice is given by the <span class="trademark">IEEE</span>® 802.11i specification
	that defines new cryptographic ciphers and an additional
	protocol to authenticate stations to an access point and
	exchange keys for data communication.  Cryptographic keys
	are periodically refreshed and there are mechanisms for
	detecting and countering intrusion attempts.  Another
	security protocol specification commonly used in wireless
	networks is termed <acronym class="acronym">WPA</acronym>, which was a
	precursor to 802.11i.  <acronym class="acronym">WPA</acronym> specifies a
	subset of the requirements found in 802.11i and is designed
	for implementation on legacy hardware.  Specifically,
	<acronym class="acronym">WPA</acronym> requires only the
	<acronym class="acronym">TKIP</acronym> cipher that is derived from the
	original <acronym class="acronym">WEP</acronym> cipher.  802.11i permits use
	of <acronym class="acronym">TKIP</acronym> but also requires support for a
	stronger cipher, AES-CCM, for encrypting data.  The
	<acronym class="acronym">AES</acronym> cipher was not required in
	<acronym class="acronym">WPA</acronym> because it was deemed too
	computationally costly to be implemented on legacy
	hardware.</p><p>The other standard to be aware of is 802.11e.  It defines
	protocols for deploying multimedia applications, such as
	streaming video and voice over IP (<acronym class="acronym">VoIP</acronym>),
	in an 802.11 network.  Like 802.11i, 802.11e also has a
	precursor specification termed <acronym class="acronym">WME</acronym> (later
	renamed <acronym class="acronym">WMM</acronym>) that has been defined by an
	industry group as a subset of 802.11e that can be deployed now
	to enable multimedia applications while waiting for the final
	ratification of 802.11e.  The most important thing to know
	about 802.11e and
	<acronym class="acronym">WME</acronym>/<acronym class="acronym">WMM</acronym> is that it
	enables prioritized traffic over a wireless network through
	Quality of Service (<acronym class="acronym">QoS</acronym>) protocols and
	enhanced media access protocols.  Proper implementation of
	these protocols enables high speed bursting of data and
	prioritized traffic flow.</p><p>FreeBSD supports networks that operate using 802.11a,
	802.11b, and 802.11g.  The <acronym class="acronym">WPA</acronym> and 802.11i
	security protocols are likewise supported (in conjunction with
	any of 11a, 11b, and 11g) and <acronym class="acronym">QoS</acronym> and
	traffic prioritization required by the
	<acronym class="acronym">WME</acronym>/<acronym class="acronym">WMM</acronym> protocols are
	supported for a limited set of wireless devices.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-quick-start"></a>31.3.2. Quick Start</h3></div></div></div><p>Connecting a computer to an existing wireless network is
	a very common situation.  This procedure shows the steps
	required.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Obtain the <acronym class="acronym">SSID</acronym> (Service Set
	    Identifier) and <acronym class="acronym">PSK</acronym> (Pre-Shared Key)
	    for the wireless network from the network
	    administrator.</p></li><li class="step"><p>Identify the wireless adapter.  The FreeBSD
	    <code class="filename">GENERIC</code> kernel includes drivers for
	    many common wireless adapters.  If the wireless adapter is
	    one of those models, it will be shown in the output from
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ifconfig | grep -B3 -i wireless</code></strong></pre><p>On FreeBSD 11 or higher, use this command
	    instead:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sysctl net.wlan.devices</code></strong></pre><p>If a wireless adapter is not listed, an additional
	    kernel module might be required, or it might be a model
	    not supported by FreeBSD.</p><p>This example shows the Atheros <code class="literal">ath0</code>
	    wireless adapter.</p></li><li class="step"><p>Add an entry for this network to
	    <code class="filename">/etc/wpa_supplicant.conf</code>.  If the
	    file does not exist, create it.  Replace
	    <em class="replaceable"><code>myssid</code></em> and
	    <em class="replaceable"><code>mypsk</code></em> with the
	    <acronym class="acronym">SSID</acronym> and <acronym class="acronym">PSK</acronym>
	    provided by the network administrator.</p><pre class="programlisting">network={
	ssid="<em class="replaceable"><code>myssid</code></em>"
	psk="<em class="replaceable"><code>mypsk</code></em>"
}</pre></li><li class="step"><p>Add entries to <code class="filename">/etc/rc.conf</code> to
	    configure the network on startup:</p><pre class="programlisting">wlans_<em class="replaceable"><code>ath0</code></em>="wlan0"
ifconfig_wlan0="WPA SYNCDHCP"</pre></li><li class="step"><p>Restart the computer, or restart the network service
	    to connect to the network:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif restart</code></strong></pre></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-basic"></a>31.3.3. Basic Setup</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71101560"></a>31.3.3.1. Kernel Configuration</h4></div></div></div><p>To use wireless networking, a wireless networking card
	  is needed and the kernel needs to be configured with the
	  appropriate wireless networking support.  The kernel is
	  separated into multiple modules so that only the required
	  support needs to be configured.</p><p>The most
	  commonly used wireless devices are those that use parts made
	  by Atheros.  These devices are supported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a>
	  and require the following line to be added to
	  <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">if_ath_load="YES"</pre><p>The Atheros driver is split up into three separate
	  pieces: the driver (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a>), the hardware support
	  layer that handles chip-specific functions
	  (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath_hal&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath_hal</span>(4)</span></a>), and an algorithm for selecting the
	  rate for transmitting frames.  When this support is loaded
	  as kernel modules, any dependencies are automatically
	  handled.  To load support for a different type of wireless
	  device, specify the module for that device.  This example
	  is for devices based on the Intersil Prism parts
	  (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wi</span>(4)</span></a>) driver:</p><pre class="programlisting">if_wi_load="YES"</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The examples in this section use an <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a>
	    device and the device name in the examples must be
	    changed according to the configuration.  A list of
	    available wireless drivers and supported adapters can be
	    found in the FreeBSD Hardware Notes, available on
	    the <a class="link" href="https://www.FreeBSD.org/releases/index.html" target="_top">Release
	      Information</a> page of the FreeBSD website.  If a
	    native FreeBSD driver for the wireless device does not
	    exist, it may be possible to use the <span class="trademark">Windows</span>® driver
	    with the help of the <a class="link" href="#config-network-ndis" title="11.5.1.1. Using Windows® NDIS Drivers">NDIS</a> driver
	    wrapper.</p></div><p>In addition, the modules that implement cryptographic
	  support for the security protocols to use must be loaded.
	  These are intended to be dynamically loaded on demand by
	  the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan</span>(4)</span></a> module, but for now they must be manually
	  configured.  The following modules are available:
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_wep&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_wep</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_ccmp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_ccmp</span>(4)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_tkip&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_tkip</span>(4)</span></a>.
	  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_ccmp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_ccmp</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_tkip&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_tkip</span>(4)</span></a> drivers are
	  only needed when using the <acronym class="acronym">WPA</acronym> or
	  802.11i security protocols.  If the network does not use
	  encryption, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_wep&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_wep</span>(4)</span></a> support is not needed.  To
	  load these modules at boot time, add the following lines to
	  <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">wlan_wep_load="YES"
wlan_ccmp_load="YES"
wlan_tkip_load="YES"</pre><p>Once this information has been added to
	  <code class="filename">/boot/loader.conf</code>, reboot the FreeBSD
	  box.  Alternately, load the modules by hand using
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">For users who do not want to use modules, it is
	    possible to compile these drivers into the kernel by
	    adding the following lines to a custom kernel
	    configuration file:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">device wlan              # 802.11 support
device wlan_wep          # 802.11 WEP support
device wlan_ccmp         # 802.11 CCMP support
device wlan_tkip         # 802.11 TKIP support
device wlan_amrr         # AMRR transmit rate control algorithm
device ath               # Atheros pci/cardbus NIC's
device ath_hal           # pci/cardbus chip support
options AH_SUPPORT_AR5416 # enable AR5416 tx/rx descriptors
device ath_rate_sample   # SampleRate tx rate control for ath</pre><p xmlns="http://www.w3.org/1999/xhtml">With this information in the kernel configuration
	    file, recompile the kernel and reboot the FreeBSD
	    machine.</p></div><p>Information about the wireless device should appear
	  in the boot messages, like this:</p><pre class="screen">ath0: &lt;Atheros 5212&gt; mem 0x88000000-0x8800ffff irq 11 at device 0.0 on cardbus1
ath0: [ITHREAD]
ath0: AR2413 mac 7.9 RF2413 phy 4.5</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71142264"></a>31.3.3.2. Setting the Correct Region</h4></div></div></div><p>Since the regulatory situation is different
	  in various parts of the world, it is necessary to
	  correctly set the domains that apply to your location to
	  have the correct information about what channels can be
	  used.</p><p>The available region definitions can be found in
	  <code class="filename">/etc/regdomain.xml</code>.  To set the data at
	  runtime, use <code class="command">ifconfig</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> regdomain <em class="replaceable"><code>ETSI</code></em> country <em class="replaceable"><code>AT</code></em></code></strong></pre><p>To persist the settings, add it to
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc create_args_wlan0="country <em class="replaceable"><code>AT</code></em> regdomain <em class="replaceable"><code>ETSI</code></em>"</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71149048"></a>31.3.4. Infrastructure Mode</h3></div></div></div><p>Infrastructure (<acronym class="acronym">BSS</acronym>) mode is the
	mode that is typically used.  In this mode, a number of
	wireless access points are connected to a wired network.
	Each wireless network has its own name, called the
	<acronym class="acronym">SSID</acronym>.  Wireless clients connect to the
	wireless access points.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71150840"></a>31.3.4.1. FreeBSD Clients</h4></div></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71151480"></a>31.3.4.1.1. How to Find Access Points</h5></div></div></div><p>To scan for available networks, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.
	    This request may take a few moments to complete as it
	    requires the system to switch to each available wireless
	    frequency and probe for available access points.  Only
	    the superuser can initiate a scan:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
dlinkap         00:13:46:49:41:76   11   54M -90:96   100 EPS  WPA WME
freebsdap       00:11:95:c3:0d:ac    1   54M -83:96   100 EPS  WPA</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The interface must be <code class="option">up</code> before
	      it can scan.  Subsequent scan requests do not require
	      the interface to be marked as up again.</p></div><p>The output of a scan request lists each
	    <acronym class="acronym">BSS</acronym>/<acronym class="acronym">IBSS</acronym> network
	    found.  Besides listing the name of the network, the
	    <code class="literal">SSID</code>, the output also shows the
	    <code class="literal">BSSID</code>, which is the
	    <acronym class="acronym">MAC</acronym> address of the access point.  The
	    <code class="literal">CAPS</code> field identifies the type of
	    each network and the capabilities of the stations
	    operating there:</p><div class="table"><a id="idp71168248"></a><div class="table-title">Table 31.2. Station Capability Codes</div><div class="table-contents"><table class="table" summary="Station Capability Codes" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Capability Code</th><th>Meaning</th></tr></thead><tbody><tr><td><code class="literal">E</code></td><td>Extended Service Set
		    (<acronym class="acronym">ESS</acronym>).  Indicates that
		    the station is part of an infrastructure network
		    rather than an <acronym class="acronym">IBSS</acronym>/ad-hoc
		    network.</td></tr><tr><td><code class="literal">I</code></td><td><acronym class="acronym">IBSS</acronym>/ad-hoc network.
		    Indicates that the station is part of an ad-hoc
		    network rather than an <acronym class="acronym">ESS</acronym>
		    network.</td></tr><tr><td><code class="literal">P</code></td><td>Privacy.  Encryption is required for all
		    data frames exchanged within the
		    <acronym class="acronym">BSS</acronym> using cryptographic means
		    such as <acronym class="acronym">WEP</acronym>,
		    <acronym class="acronym">TKIP</acronym> or
		    <acronym class="acronym">AES</acronym>-<acronym class="acronym">CCMP</acronym>.</td></tr><tr><td><code class="literal">S</code></td><td>Short Preamble.  Indicates that the network
		    is using short preambles, defined in 802.11b High
		    Rate/DSSS PHY, and utilizes a 56 bit sync field
		    rather than the 128 bit field used in long
		    preamble mode.</td></tr><tr><td><code class="literal">s</code></td><td>Short slot time.  Indicates that the 802.11g
		    network is using a short slot time because there
		    are no legacy (802.11b) stations present.</td></tr></tbody></table></div></div><br class="table-break" /><p>One can also display the current list of known
	    networks with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> list scan</code></strong></pre><p>This information may be updated automatically by the
	    adapter or manually with a <code class="option">scan</code> request.
	    Old data is automatically removed from the cache, so over
	    time this list may shrink unless more scans are
	    done.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71192184"></a>31.3.4.1.2. Basic Settings</h5></div></div></div><p>This section provides a simple example of how to make
	    the wireless network adapter work in FreeBSD without
	    encryption.  Once familiar with these concepts, it is
	    strongly recommend to use <a class="link" href="#network-wireless-wpa" title="31.3.4.1.3. WPA">WPA</a> to set up
	    the wireless network.</p><p>There are three basic steps to configure a wireless
	    network: select an access point, authenticate the
	    station, and configure an <acronym class="acronym">IP</acronym> address.
	    The following sections discuss each step.</p><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71194488"></a>31.3.4.1.2.1. Selecting an Access Point</h6></div></div></div><p>Most of the time, it is sufficient to let the system
	      choose an access point using the builtin heuristics.
	      This is the default behavior when an interface is
	      marked as up or it is listed in
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="DHCP"</pre><p>If there are multiple access points, a specific
	      one can be selected by its
	      <acronym class="acronym">SSID</acronym>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="ssid <em class="replaceable"><code>your_ssid_here</code></em> DHCP"</pre><p>In an environment where there are multiple access
	      points with the same <acronym class="acronym">SSID</acronym>, which
	      is often done to simplify roaming, it may be necessary
	      to associate to one specific device.  In this case, the
	      <acronym class="acronym">BSSID</acronym> of the access point can be
	      specified, with or without the
	      <acronym class="acronym">SSID</acronym>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="ssid <em class="replaceable"><code>your_ssid_here</code></em> bssid <em class="replaceable"><code>xx:xx:xx:xx:xx:xx</code></em> DHCP"</pre><p>There are other ways to constrain the choice of an
	      access point, such as limiting the set of frequencies
	      the system will scan on.  This may be useful for a
	      multi-band wireless card as scanning all the possible
	      channels can be time-consuming.  To limit operation to a
	      specific band, use the <code class="option">mode</code>
	      parameter:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="mode <em class="replaceable"><code>11g</code></em> ssid <em class="replaceable"><code>your_ssid_here</code></em> DHCP"</pre><p>This example will force the card to operate in
	      802.11g, which is defined only for 2.4GHz frequencies
	      so any 5GHz channels will not be considered.  This can
	      also be achieved with the
	      <code class="option">channel</code> parameter, which locks
	      operation to one specific frequency, and the
	      <code class="option">chanlist</code> parameter, to specify a list
	      of channels for scanning.  More information about these
	      parameters can be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71216888"></a>31.3.4.1.2.2. Authentication</h6></div></div></div><p>Once an access point is selected, the station
	      needs to authenticate before it can pass data.
	      Authentication can happen in several ways.  The most
	      common scheme, open authentication, allows any station
	      to join the network and communicate.  This is the
	      authentication to use for test purposes the first time
	      a wireless network is setup.  Other schemes require
	      cryptographic handshakes to be completed before data
	      traffic can flow, either using pre-shared keys or
	      secrets, or more complex schemes that involve backend
	      services such as <acronym class="acronym">RADIUS</acronym>.  Open
	      authentication is the default setting.  The next most
	      common setup is <acronym class="acronym">WPA-PSK</acronym>, also
	      known as <acronym class="acronym">WPA</acronym> Personal, which is
	      described in <a class="xref" href="#network-wireless-wpa-wpa-psk" title="31.3.4.1.3.1. WPA-PSK">Section 31.3.4.1.3.1, &#8220;<acronym class="acronym">WPA-PSK</acronym>&#8221;</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If using an <span class="trademark">Apple</span>® <span class="trademark">AirPort</span>® Extreme base
		station for an access point, shared-key authentication
		together with a <acronym class="acronym">WEP</acronym> key needs to
		be configured.  This can be configured in
		<code class="filename">/etc/rc.conf</code> or by using
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a>.  For a single <span class="trademark">AirPort</span>® base
		station, access can be configured with:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="authmode shared wepmode on weptxkey <em class="replaceable"><code>1</code></em> wepkey <em class="replaceable"><code>01234567</code></em> DHCP"</pre><p xmlns="http://www.w3.org/1999/xhtml">In general, shared key authentication should be
		avoided because it uses the <acronym class="acronym">WEP</acronym> key
		material in a highly-constrained manner, making it
		even easier to crack the key.  If
		<acronym class="acronym">WEP</acronym> must be used for compatibility
		with legacy devices, it is better to use
		<acronym class="acronym">WEP</acronym> with <code class="literal">open</code>
		authentication.  More information regarding
		<acronym class="acronym">WEP</acronym> can be found in <a class="xref" href="#network-wireless-wep" title="31.3.4.1.4. WEP">Section 31.3.4.1.4, &#8220;<acronym class="acronym">WEP</acronym>&#8221;</a>.</p></div></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71231352"></a>31.3.4.1.2.3. Getting an <acronym class="acronym">IP</acronym> Address with
	      <acronym class="acronym">DHCP</acronym></h6></div></div></div><p>Once an access point is selected and the
	      authentication parameters are set, an
	      <acronym class="acronym">IP</acronym> address must be obtained in
	      order to communicate.  Most of the time, the
	      <acronym class="acronym">IP</acronym> address is obtained via
	      <acronym class="acronym">DHCP</acronym>.  To achieve that, edit
	      <code class="filename">/etc/rc.conf</code> and add
	      <code class="literal">DHCP</code> to the configuration for the
	      device:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="DHCP"</pre><p>The
	      wireless interface is now ready to bring up:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong></pre><p>Once the interface is running, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>
	      to see the status of the interface
	      <code class="filename">ath0</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        ether 00:11:95:d5:43:62
        inet 192.168.1.100 netmask 0xffffff00 broadcast 192.168.1.255
        media: IEEE 802.11 Wireless Ethernet OFDM/54Mbps mode 11g
        status: associated
        ssid dlinkap channel 11 (2462 Mhz 11g) bssid 00:13:46:49:41:76
        country US ecm authmode OPEN privacy OFF txpower 21.5 bmiss 7
        scanvalid 60 bgscan bgscanintvl 300 bgscanidle 250 roam:rssi 7
        roam:rate 5 protmode CTS wme burst</pre><p>The <code class="literal">status: associated</code> line means
	      that it is connected to the wireless network.  The
	      <code class="literal">bssid 00:13:46:49:41:76</code> is the
	      <acronym class="acronym">MAC</acronym> address of the access point and
	      <code class="literal">authmode OPEN</code> indicates that the
	      communication is not encrypted.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71245560"></a>31.3.4.1.2.4. Static <acronym class="acronym">IP</acronym> Address</h6></div></div></div><p>If an <acronym class="acronym">IP</acronym> address cannot be
	      obtained from a <acronym class="acronym">DHCP</acronym> server, set a
	      fixed <acronym class="acronym">IP</acronym> address.  Replace the
	      <code class="literal">DHCP</code> keyword shown above with the
	      address information.  Be sure to retain any other
	      parameters for selecting the access point:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="inet <em class="replaceable"><code>192.168.1.100</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>your_ssid_here</code></em>"</pre></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa"></a>31.3.4.1.3. <acronym class="acronym">WPA</acronym></h5></div></div></div><p>Wi-Fi Protected Access (<acronym class="acronym">WPA</acronym>) is a
	    security protocol used together with 802.11 networks to
	    address the lack of proper authentication and the weakness
	    of <acronym class="acronym">WEP</acronym>.  WPA leverages the 802.1X
	    authentication protocol and uses one of several ciphers
	    instead of <acronym class="acronym">WEP</acronym> for data integrity.
	    The only cipher required by <acronym class="acronym">WPA</acronym> is the
	    Temporary Key Integrity Protocol
	    (<acronym class="acronym">TKIP</acronym>).  <acronym class="acronym">TKIP</acronym> is a
	    cipher that extends the basic RC4 cipher used by
	    <acronym class="acronym">WEP</acronym> by adding integrity checking,
	    tamper detection, and measures for responding to detected
	    intrusions.  <acronym class="acronym">TKIP</acronym> is designed to work
	    on legacy hardware with only software modification.  It
	    represents a compromise that improves security but is
	    still not entirely immune to attack.
	    <acronym class="acronym">WPA</acronym> also specifies the
	    <acronym class="acronym">AES-CCMP</acronym> cipher as an alternative to
	    <acronym class="acronym">TKIP</acronym>, and that is preferred when
	    possible.  For this specification, the term
	    <acronym class="acronym">WPA2</acronym> or <acronym class="acronym">RSN</acronym> is
	    commonly used.</p><p><acronym class="acronym">WPA</acronym> defines authentication and
	    encryption protocols.  Authentication is most commonly
	    done using one of two techniques: by 802.1X and a backend
	    authentication service such as <acronym class="acronym">RADIUS</acronym>,
	    or by a minimal handshake between the station and the
	    access point using a pre-shared secret.  The former is
	    commonly termed <acronym class="acronym">WPA</acronym> Enterprise and the
	    latter is known as <acronym class="acronym">WPA</acronym> Personal.  Since
	    most people will not set up a <acronym class="acronym">RADIUS</acronym>
	    backend server for their wireless network,
	    <acronym class="acronym">WPA-PSK</acronym> is by far the most commonly
	    encountered configuration for
	    <acronym class="acronym">WPA</acronym>.</p><p>The control of the wireless connection and the key
	    negotiation or authentication with a server is done using
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a>.  This program requires a
	    configuration file,
	    <code class="filename">/etc/wpa_supplicant.conf</code>, to run.
	    More information regarding this file can be found in
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant.conf</span>(5)</span></a>.</p><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-wpa-psk"></a>31.3.4.1.3.1. <acronym class="acronym">WPA-PSK</acronym></h6></div></div></div><p><acronym class="acronym">WPA-PSK</acronym>, also known as
	      <acronym class="acronym">WPA</acronym> Personal, is based on a
	      pre-shared key (<acronym class="acronym">PSK</acronym>) which is
	      generated from a given password and used as the master
	      key in the wireless network.  This means every wireless
	      user will share the same key.
	      <acronym class="acronym">WPA-PSK</acronym> is intended for small
	      networks where the use of an authentication server is
	      not possible or desired.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Always use strong passwords that are sufficiently
		long and made from a rich alphabet so that they will
		not be easily guessed or attacked.</p></div><p>The first step is the configuration of
	      <code class="filename">/etc/wpa_supplicant.conf</code> with
	      the <acronym class="acronym">SSID</acronym> and the pre-shared key of
	      the network:</p><pre class="programlisting">network={
  ssid="freebsdap"
  psk="freebsdmall"
}</pre><p>Then, in <code class="filename">/etc/rc.conf</code>,
	      indicate that the wireless device configuration will be
	      done with <acronym class="acronym">WPA</acronym> and the
	      <acronym class="acronym">IP</acronym> address will be obtained with
	      <acronym class="acronym">DHCP</acronym>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p>Then, bring up the interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 5
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 6
DHCPOFFER from 192.168.0.1
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPACK from 192.168.0.1
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><p>Or, try to configure the interface manually using
	      the information in
	      <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>wpa_supplicant -i <em class="replaceable"><code>wlan0</code></em> -c /etc/wpa_supplicant.conf</code></strong>
Trying to associate with 00:11:95:c3:0d:ac (SSID='freebsdap' freq=2412 MHz)
Associated with 00:11:95:c3:0d:ac
WPA: Key negotiation completed with 00:11:95:c3:0d:ac [PTK=CCMP GTK=CCMP]
CTRL-EVENT-CONNECTED - Connection to 00:11:95:c3:0d:ac completed (auth) [id=0 id_str=]</pre><p>The next operation is to launch <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient</span>(8)</span></a>
	      to get the <acronym class="acronym">IP</acronym> address from the
	      <acronym class="acronym">DHCP</acronym> server:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dhclient <em class="replaceable"><code>wlan0</code></em></code></strong>
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPACK from 192.168.0.1
bound to 192.168.0.254 -- renewal in 300 seconds.
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If <code class="filename">/etc/rc.conf</code> has an
		<code class="literal">ifconfig_wlan0="DHCP"</code> entry,
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient</span>(8)</span></a> will be launched automatically after
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> associates with the access
		point.</p></div><p>If <acronym class="acronym">DHCP</acronym> is not possible or
	      desired, set a static <acronym class="acronym">IP</acronym> address
	      after <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> has authenticated the
	      station:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.100</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.100 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><p>When <acronym class="acronym">DHCP</acronym> is not used, the
	      default gateway and the nameserver also have to be
	      manually set:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>route add default <em class="replaceable"><code>your_default_router</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo "nameserver <em class="replaceable"><code>your_DNS_server</code></em>" &gt;&gt; /etc/resolv.conf</code></strong></pre></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-eap-tls"></a>31.3.4.1.3.2. <acronym class="acronym">WPA</acronym> with
	      <acronym class="acronym">EAP-TLS</acronym></h6></div></div></div><p>The second way to use <acronym class="acronym">WPA</acronym> is with
	      an 802.1X backend authentication server.  In this case,
	      <acronym class="acronym">WPA</acronym> is called
	      <acronym class="acronym">WPA</acronym> Enterprise to differentiate it
	      from the less secure <acronym class="acronym">WPA</acronym> Personal.
	      Authentication in <acronym class="acronym">WPA</acronym> Enterprise is
	      based on the Extensible Authentication Protocol
	      (<acronym class="acronym">EAP</acronym>).</p><p><acronym class="acronym">EAP</acronym> does not come with an
	      encryption method.  Instead, <acronym class="acronym">EAP</acronym> is
	      embedded inside an encrypted tunnel.  There are many
	      <acronym class="acronym">EAP</acronym> authentication methods, but
	      <acronym class="acronym">EAP-TLS</acronym>, <acronym class="acronym">EAP-TTLS</acronym>,
	      and <acronym class="acronym">EAP-PEAP</acronym> are the most
	      common.</p><p>EAP with Transport Layer Security
	      (<acronym class="acronym">EAP-TLS</acronym>) is a well-supported
	      wireless authentication protocol since it was the
	      first <acronym class="acronym">EAP</acronym> method to be certified
	      by the <a class="link" href="http://www.wi-fi.org/" target="_top">Wi-Fi
		Alliance</a>.  <acronym class="acronym">EAP-TLS</acronym> requires
	      three certificates to run: the certificate of the
	      Certificate Authority (<acronym class="acronym">CA</acronym>) installed
	      on all machines, the server certificate for the
	      authentication server, and one client certificate for
	      each wireless client.  In this <acronym class="acronym">EAP</acronym>
	      method, both the authentication server and wireless
	      client authenticate each other by presenting their
	      respective certificates, and then verify that these
	      certificates were signed by the organization's
	      <acronym class="acronym">CA</acronym>.</p><p>As previously, the configuration is done via
	      <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre class="programlisting">network={
  ssid="freebsdap" <a id="co-tls-ssid"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  proto=RSN  <a id="co-tls-proto"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
  key_mgmt=WPA-EAP <a id="co-tls-kmgmt"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
  eap=TLS <a id="co-tls-eap"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  identity="loader" <a id="co-tls-id"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
  ca_cert="/etc/certs/cacert.pem" <a id="co-tls-cacert"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
  client_cert="/etc/certs/clientcert.pem" <a id="co-tls-clientcert"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
  private_key="/etc/certs/clientkey.pem" <a id="co-tls-pkey"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
  private_key_passwd="freebsdmallclient" <a id="co-tls-pwd"></a><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-ssid"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field indicates the network name
		  (<acronym class="acronym">SSID</acronym>).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-proto"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This example uses the <acronym class="acronym">RSN</acronym>
		  <span class="trademark">IEEE</span>® 802.11i protocol, also known as
		  <acronym class="acronym">WPA2</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-kmgmt"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">key_mgmt</code> line refers to
		  the key management protocol to use.  In this
		  example, it is <acronym class="acronym">WPA</acronym> using
		  <acronym class="acronym">EAP</acronym> authentication.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-eap"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field indicates the <acronym class="acronym">EAP</acronym>
		  method for the connection.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-id"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">identity</code> field contains
		  the identity string for
		  <acronym class="acronym">EAP</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-cacert"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">ca_cert</code> field indicates
		  the pathname of the <acronym class="acronym">CA</acronym>
		  certificate file.  This file is needed to verify
		  the server certificate.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-clientcert"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">client_cert</code> line gives
		  the pathname to the client certificate file.  This
		  certificate is unique to each wireless client of the
		  network.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-pkey"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">private_key</code> field is the
		  pathname to the client certificate private key
		  file.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-pwd"><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">private_key_passwd</code> field
		  contains the passphrase for the private key.</p></td></tr></table></div><p>Then, add the following lines to
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p>The next step is to bring up the interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><p>It is also possible to bring up the interface
	      manually using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> and
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-eap-ttls"></a>31.3.4.1.3.3. <acronym class="acronym">WPA</acronym> with
	      <acronym class="acronym">EAP-TTLS</acronym></h6></div></div></div><p>With <acronym class="acronym">EAP-TLS</acronym>, both the
	      authentication server and the client need a certificate.
	      With <acronym class="acronym">EAP-TTLS</acronym>, a client certificate
	      is optional.  This method is similar to a web server
	      which creates a secure <acronym class="acronym">SSL</acronym> tunnel
	      even if visitors do not have client-side certificates.
	      <acronym class="acronym">EAP-TTLS</acronym> uses an encrypted
	      <acronym class="acronym">TLS</acronym> tunnel for safe transport of
	      the authentication data.</p><p>The required configuration can be added to
	      <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre class="programlisting">network={
  ssid="freebsdap"
  proto=RSN
  key_mgmt=WPA-EAP
  eap=TTLS <a id="co-ttls-eap"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  identity="test" <a id="co-ttls-id"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
  password="test" <a id="co-ttls-passwd"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
  ca_cert="/etc/certs/cacert.pem" <a id="co-ttls-cacert"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  phase2="auth=MD5" <a id="co-ttls-pha2"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-eap"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field specifies the <acronym class="acronym">EAP</acronym>
		  method for the connection.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-id"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">identity</code> field contains
		  the identity string for <acronym class="acronym">EAP</acronym>
		  authentication inside the encrypted
		  <acronym class="acronym">TLS</acronym> tunnel.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-passwd"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">password</code> field contains
		  the passphrase for the <acronym class="acronym">EAP</acronym>
		  authentication.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-cacert"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">ca_cert</code> field indicates
		  the pathname of the <acronym class="acronym">CA</acronym>
		  certificate file.  This file is needed to verify
		  the server certificate.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-pha2"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field specifies the authentication
		  method used in the encrypted <acronym class="acronym">TLS</acronym>
		  tunnel.  In this example,
		  <acronym class="acronym">EAP</acronym> with MD5-Challenge is used.
		  The <span class="quote">&#8220;<span class="quote">inner authentication</span>&#8221;</span> phase is
		  often called <span class="quote">&#8220;<span class="quote">phase2</span>&#8221;</span>.</p></td></tr></table></div><p>Next, add the following lines to
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p>The next step is to bring up the interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 21
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-eap-peap"></a>31.3.4.1.3.4. <acronym class="acronym">WPA</acronym> with
	      <acronym class="acronym">EAP-PEAP</acronym></h6></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><acronym class="acronym">PEAPv0/EAP-MSCHAPv2</acronym> is the most
		common <acronym class="acronym">PEAP</acronym> method.  In this
		chapter, the term <acronym class="acronym">PEAP</acronym> is used to
		refer to that method.</p></div><p>Protected EAP (<acronym class="acronym">PEAP</acronym>) is designed
	      as an alternative to <acronym class="acronym">EAP-TTLS</acronym> and
	      is the most used <acronym class="acronym">EAP</acronym> standard after
	      <acronym class="acronym">EAP-TLS</acronym>.  In a network with mixed
	      operating systems, <acronym class="acronym">PEAP</acronym> should be
	      the most supported standard after
	      <acronym class="acronym">EAP-TLS</acronym>.</p><p><acronym class="acronym">PEAP</acronym> is similar to
	      <acronym class="acronym">EAP-TTLS</acronym> as it uses a server-side
	      certificate to authenticate clients by creating an
	      encrypted <acronym class="acronym">TLS</acronym> tunnel between the
	      client and the authentication server, which protects
	      the ensuing exchange of authentication information.
	      <acronym class="acronym">PEAP</acronym> authentication differs from
	      <acronym class="acronym">EAP-TTLS</acronym> as it broadcasts the
	      username in the clear and only the password is sent
	      in the encrypted <acronym class="acronym">TLS</acronym> tunnel.
	      <acronym class="acronym">EAP-TTLS</acronym> will use the
	      <acronym class="acronym">TLS</acronym> tunnel for both the username
	      and password.</p><p>Add the following lines to
	      <code class="filename">/etc/wpa_supplicant.conf</code> to
	      configure the <acronym class="acronym">EAP-PEAP</acronym> related
	      settings:</p><pre class="programlisting">network={
  ssid="freebsdap"
  proto=RSN
  key_mgmt=WPA-EAP
  eap=PEAP <a id="co-peap-eap"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  identity="test" <a id="co-peap-id"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
  password="test" <a id="co-peap-passwd"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
  ca_cert="/etc/certs/cacert.pem" <a id="co-peap-cacert"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  phase1="peaplabel=0" <a id="co-peap-pha1"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
  phase2="auth=MSCHAPV2" <a id="co-peap-pha2"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-eap"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field specifies the <acronym class="acronym">EAP</acronym>
		  method for the connection.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-id"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">identity</code> field contains
		  the identity string for <acronym class="acronym">EAP</acronym>
		  authentication inside the encrypted
		  <acronym class="acronym">TLS</acronym> tunnel.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-passwd"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">password</code> field contains
		  the passphrase for the <acronym class="acronym">EAP</acronym>
		  authentication.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-cacert"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">ca_cert</code> field indicates
		  the pathname of the <acronym class="acronym">CA</acronym>
		  certificate file.  This file is needed to verify
		  the server certificate.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-pha1"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field contains the parameters for the
		  first phase of authentication, the
		  <acronym class="acronym">TLS</acronym> tunnel.  According to the
		  authentication server used, specify a specific
		  label for authentication.  Most of the time, the
		  label will be <span class="quote">&#8220;<span class="quote">client <acronym class="acronym">EAP</acronym>
		    encryption</span>&#8221;</span> which is set by using
		  <code class="literal">peaplabel=0</code>.  More information
		  can be found in  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant.conf</span>(5)</span></a>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-pha2"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field specifies the authentication
		  protocol used in the encrypted
		  <acronym class="acronym">TLS</acronym> tunnel.  In the
		  case of <acronym class="acronym">PEAP</acronym>, it is
		  <code class="literal">auth=MSCHAPV2</code>.</p></td></tr></table></div><p>Add the following to
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p>Then, bring up the interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 21
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wep"></a>31.3.4.1.4. <acronym class="acronym">WEP</acronym></h5></div></div></div><p>Wired Equivalent Privacy (<acronym class="acronym">WEP</acronym>) is
	    part of the original 802.11 standard.  There is no
	    authentication mechanism, only a weak form of access
	    control which is easily cracked.</p><p><acronym class="acronym">WEP</acronym> can be set up using
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.1.100</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> \
	    ssid <em class="replaceable"><code>my_net</code></em> wepmode on weptxkey <em class="replaceable"><code>3</code></em> wepkey <em class="replaceable"><code>3:0x3456789012</code></em></code></strong></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="literal">weptxkey</code> specifies which
		<acronym class="acronym">WEP</acronym> key will be used in the
		transmission.  This example uses the third key.
		This must match the setting on the access point.
		When unsure which key is used by the access point,
		try <code class="literal">1</code> (the first key) for this
		value.</p></li><li class="listitem"><p>The <code class="literal">wepkey</code> selects one of the
		<acronym class="acronym">WEP</acronym> keys.  It should be in the
		format <em class="replaceable"><code>index:key</code></em>.  Key
		<code class="literal">1</code> is used by default; the index
		only needs to be set when using a key other than the
		first key.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Replace the <code class="literal">0x3456789012</code>
		  with the key configured for use on the access
		  point.</p></div></li></ul></div><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> for further
	    information.</p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> facility can be used to
	    configure a wireless interface with
	    <acronym class="acronym">WEP</acronym>.  The example above can be set up
	    by adding the following lines to
	    <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre class="programlisting">network={
  ssid="my_net"
  key_mgmt=NONE
  wep_key3=3456789012
  wep_tx_keyidx=3
}</pre><p>Then:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>wpa_supplicant -i <em class="replaceable"><code>wlan0</code></em> -c /etc/wpa_supplicant.conf</code></strong>
Trying to associate with 00:13:46:49:41:76 (SSID='dlinkap' freq=2437 MHz)
Associated with 00:13:46:49:41:76</pre></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71506680"></a>31.3.5. Ad-hoc Mode</h3></div></div></div><p><acronym class="acronym">IBSS</acronym> mode, also called ad-hoc mode, is
	designed for point to point connections.  For example, to
	establish an ad-hoc network between the machines
	<code class="systemitem">A</code> and <code class="systemitem">B</code>,
	choose two <acronym class="acronym">IP</acronym> addresses and a
	<acronym class="acronym">SSID</acronym>.</p><p>On <code class="systemitem">A</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode adhoc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;adhoc&gt;
	  status: running
	  ssid freebsdap channel 2 (2417 Mhz 11g) bssid 02:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst</pre><p>The <code class="literal">adhoc</code> parameter indicates that the
	interface is running in <acronym class="acronym">IBSS</acronym> mode.</p><p><code class="systemitem">B</code> should now be able to detect
	<code class="systemitem">A</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode adhoc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
  SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
  freebsdap       02:11:95:c3:0d:ac    2   54M -64:-96  100 IS   WME</pre><p>The <code class="literal">I</code> in the output confirms that
	<code class="systemitem">A</code> is in ad-hoc mode.  Now, configure
	<code class="systemitem">B</code> with a different
	<acronym class="acronym">IP</acronym> address:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.2</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:d5:43:62
	  inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;adhoc&gt;
	  status: running
	  ssid freebsdap channel 2 (2417 Mhz 11g) bssid 02:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst</pre><p>Both <code class="systemitem">A</code> and
	<code class="systemitem">B</code> are now ready to exchange
	information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-ap"></a>31.3.6. FreeBSD Host Access Points</h3></div></div></div><p>FreeBSD can act as an Access Point (<acronym class="acronym">AP</acronym>)
	which eliminates the need to buy a hardware
	<acronym class="acronym">AP</acronym> or run an ad-hoc network.  This can
	be particularly useful when a FreeBSD machine is acting as a
	gateway to another network such as the Internet.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-ap-basic"></a>31.3.6.1. Basic Settings</h4></div></div></div><p>Before configuring a FreeBSD machine as an
	  <acronym class="acronym">AP</acronym>, the kernel must be configured with
	  the appropriate networking support for the wireless card
	  as well as the security protocols being used.  For more
	  details, see <a class="xref" href="#network-wireless-basic" title="31.3.3. Basic Setup">Section 31.3.3, &#8220;Basic Setup&#8221;</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <acronym class="acronym">NDIS</acronym> driver wrapper for
	    <span class="trademark">Windows</span>® drivers does not currently support
	    <acronym class="acronym">AP</acronym> operation.  Only native FreeBSD
	    wireless drivers support <acronym class="acronym">AP</acronym>
	    mode.</p></div><p>Once wireless networking support is loaded, check if
	  the wireless device supports the host-based access point
	  mode, also known as hostap mode:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> list caps</code></strong>
drivercaps=6f85edc1&lt;STA,FF,TURBOP,IBSS,HOSTAP,AHDEMO,TXPMGT,SHSLOT,SHPREAMBLE,MONITOR,MBSS,WPA1,WPA2,BURST,WME,WDS,BGSCAN,TXFRAG&gt;
cryptocaps=1f&lt;WEP,TKIP,AES,AES_CCM,TKIPMIC&gt;</pre><p>This output displays the card's capabilities.  The
	  <code class="literal">HOSTAP</code> word confirms that this wireless
	  card can act as an <acronym class="acronym">AP</acronym>.  Various supported
	  ciphers are also listed: <acronym class="acronym">WEP</acronym>,
	  <acronym class="acronym">TKIP</acronym>, and <acronym class="acronym">AES</acronym>.  This
	  information indicates which security protocols can be used
	  on the <acronym class="acronym">AP</acronym>.</p><p>The wireless device can only be put into hostap mode
	  during the creation of the network pseudo-device, so a
	  previously created device must be destroyed first:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> destroy</code></strong></pre><p>then regenerated with the correct option before setting
	  the other parameters:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode hostap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em> mode 11g channel 1</code></strong></pre><p>Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> again to see the status of the
	  <code class="filename">wlan0</code> interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;hostap&gt;
	  status: running
	  ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst dtimperiod 1 -dfs</pre><p>The <code class="literal">hostap</code> parameter indicates the
	  interface is running in the host-based access point
	  mode.</p><p>The interface configuration can be done automatically at
	  boot time by adding the following lines to
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">wlans_ath0="wlan0"
create_args_wlan0="wlanmode hostap"
ifconfig_wlan0="inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em> mode 11g channel <em class="replaceable"><code>1</code></em>"</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71592568"></a>31.3.6.2. Host-based Access Point Without Authentication or
	  Encryption</h4></div></div></div><p>Although it is not recommended to run an
	  <acronym class="acronym">AP</acronym> without any authentication or
	  encryption, this is a simple way to check if the
	  <acronym class="acronym">AP</acronym> is working.  This configuration is
	  also important for debugging client issues.</p><p>Once the <acronym class="acronym">AP</acronym> is configured, initiate
	  a scan from another wireless machine to find the
	  <acronym class="acronym">AP</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
freebsdap       00:11:95:c3:0d:ac    1   54M -66:-96  100 ES   WME</pre><p>The client machine found the <acronym class="acronym">AP</acronym> and
	  can be associated with it:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.2</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:d5:43:62
	  inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet OFDM/54Mbps mode 11g
	  status: associated
	  ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 bmiss 7
	  scanvalid 60 bgscan bgscanintvl 300 bgscanidle 250 roam:rssi 7
	  roam:rate 5 protmode CTS wme burst</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-ap-wpa"></a>31.3.6.3. <acronym class="acronym">WPA2</acronym> Host-based Access Point</h4></div></div></div><p>This section focuses on setting up a FreeBSD
	  access point using the <acronym class="acronym">WPA2</acronym>
	  security protocol.  More details regarding
	  <acronym class="acronym">WPA</acronym> and the configuration of
	  <acronym class="acronym">WPA</acronym>-based wireless clients can be found
	  in <a class="xref" href="#network-wireless-wpa" title="31.3.4.1.3. WPA">Section 31.3.4.1.3, &#8220;<acronym class="acronym">WPA</acronym>&#8221;</a>.</p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a> daemon is used to deal with client
	  authentication and key management on the
	  <acronym class="acronym">WPA2</acronym>-enabled
	  <acronym class="acronym">AP</acronym>.</p><p>The following configuration operations are performed
	  on the FreeBSD machine acting as the <acronym class="acronym">AP</acronym>.
	  Once the <acronym class="acronym">AP</acronym> is correctly working,
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a> can be automatically started at boot
	  with this line in
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">hostapd_enable="YES"</pre><p>Before trying to configure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>, first
	  configure the basic settings introduced in <a class="xref" href="#network-wireless-ap-basic" title="31.3.6.1. Basic Settings">Section 31.3.6.1, &#8220;Basic Settings&#8221;</a>.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71619960"></a>31.3.6.3.1. <acronym class="acronym">WPA2-PSK</acronym></h5></div></div></div><p><acronym class="acronym">WPA2-PSK</acronym> is intended for small
	    networks where the use of a backend authentication server
	    is not possible or desired.</p><p>The configuration is done in
	    <code class="filename">/etc/hostapd.conf</code>:</p><pre class="programlisting">interface=wlan0                  <a id="co-ap-wpapsk-iface"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
debug=1                          <a id="co-ap-wpapsk-dbug"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
ctrl_interface=/var/run/hostapd  <a id="co-ap-wpapsk-ciface"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
ctrl_interface_group=wheel       <a id="co-ap-wpapsk-cifacegrp"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
ssid=freebsdap                   <a id="co-ap-wpapsk-ssid"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
wpa=2                            <a id="co-ap-wpapsk-wpa"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
wpa_passphrase=freebsdmall       <a id="co-ap-wpapsk-pass"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
wpa_key_mgmt=WPA-PSK             <a id="co-ap-wpapsk-kmgmt"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
wpa_pairwise=CCMP                <a id="co-ap-wpapsk-pwise"></a><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-iface"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Wireless interface used
		for the access point.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-dbug"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Level of verbosity used during the
		execution of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>.  A value of
		<code class="literal">1</code> represents the minimal
		level.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-ciface"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Pathname of the directory used by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>
		to store domain socket files for communication
		with external programs such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd_cli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd_cli</span>(8)</span></a>.
		The default value is used in this example.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-cifacegrp"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The group allowed to access the control
		interface files.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-ssid"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The wireless network name, or
		<acronym class="acronym">SSID</acronym>, that will appear in wireless
		scans.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-wpa"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Enable
		<acronym class="acronym">WPA</acronym> and specify which
		<acronym class="acronym">WPA</acronym> authentication protocol will
		be required.  A value of <code class="literal">2</code>
		configures the <acronym class="acronym">AP</acronym> for
		<acronym class="acronym">WPA2</acronym> and is recommended.
		Set to <code class="literal">1</code> only if the obsolete
		<acronym class="acronym">WPA</acronym> is required.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-pass"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>ASCII passphrase for
		<acronym class="acronym">WPA</acronym> authentication.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Always use strong passwords that are at least
		  8 characters long and made from a rich alphabet so
		  that they will not be easily guessed or
		  attacked.</p></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-kmgmt"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The
		key management protocol to use.  This example
		sets <acronym class="acronym">WPA-PSK</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-pwise"><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Encryption algorithms accepted by
		the access point.  In this example, only
		the
		<acronym class="acronym">CCMP</acronym> (<acronym class="acronym">AES</acronym>)
		cipher is accepted.  <acronym class="acronym">CCMP</acronym>
		is an alternative to <acronym class="acronym">TKIP</acronym>
		and is strongly preferred when possible.
		<acronym class="acronym">TKIP</acronym> should be allowed only when
		there are stations incapable of using
		<acronym class="acronym">CCMP</acronym>.</p></td></tr></table></div><p>The next step is to start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service hostapd forcestart</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	ether 04:f0:21:16:8e:10
	inet6 fe80::6f0:21ff:fe16:8e10%wlan0 prefixlen 64 scopeid 0x9
	nd6 options=21&lt;PERFORMNUD,AUTO_LINKLOCAL&gt;
	media: IEEE 802.11 Wireless Ethernet autoselect mode 11na &lt;hostap&gt;
	status: running
	ssid No5ignal channel 36 (5180 MHz 11a ht/40+) bssid 04:f0:21:16:8e:10
	country US ecm authmode WPA2/802.11i privacy MIXED deftxkey 2
	AES-CCM 2:128-bit AES-CCM 3:128-bit txpower 17 mcastrate 6 mgmtrate 6
	scanvalid 60 ampdulimit 64k ampdudensity 8 shortgi wme burst
	dtimperiod 1 -dfs
	groups: wlan</pre><p>Once the <acronym class="acronym">AP</acronym> is running, the
	    clients can associate with it.  See <a class="xref" href="#network-wireless-wpa" title="31.3.4.1.3. WPA">Section 31.3.4.1.3, &#8220;<acronym class="acronym">WPA</acronym>&#8221;</a> for more details.  It
	    is possible to see the stations associated with the
	    <acronym class="acronym">AP</acronym> using <code class="command">ifconfig
	      <em class="replaceable"><code>wlan0</code></em> list
	      sta</code>.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71387768"></a>31.3.6.4. <acronym class="acronym">WEP</acronym> Host-based Access Point</h4></div></div></div><p>It is not recommended to use <acronym class="acronym">WEP</acronym> for
	  setting up an <acronym class="acronym">AP</acronym> since there is no
	  authentication mechanism and the encryption is easily
	  cracked.  Some legacy wireless cards only support
	  <acronym class="acronym">WEP</acronym> and these cards will only support
	  an <acronym class="acronym">AP</acronym> without authentication or
	  encryption.</p><p>The wireless device can now be put into hostap mode and
	  configured with the correct <acronym class="acronym">SSID</acronym> and
	  <acronym class="acronym">IP</acronym> address:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode hostap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> \
	ssid <em class="replaceable"><code>freebsdap</code></em> wepmode on weptxkey <em class="replaceable"><code>3</code></em> wepkey <em class="replaceable"><code>3:0x3456789012</code></em> mode 11g</code></strong></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="literal">weptxkey</code> indicates which
	      <acronym class="acronym">WEP</acronym> key will be used in the
	      transmission.  This example uses the third key as key
	      numbering starts with <code class="literal">1</code>.  This
	      parameter must be specified in order to encrypt the
	      data.</p></li><li class="listitem"><p>The <code class="literal">wepkey</code> sets the selected
	      <acronym class="acronym">WEP</acronym> key.  It should be in the format
	      <em class="replaceable"><code>index:key</code></em>.  If the index is
	      not given, key <code class="literal">1</code> is set.  The index
	      needs to be set when using keys other than the first
	      key.</p></li></ul></div><p>Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> to see the status of the
	  <code class="filename">wlan0</code> interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;hostap&gt;
	  status: running
	  ssid freebsdap channel 4 (2427 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy ON deftxkey 3 wepkey 3:40-bit
	  txpower 21.5 scanvalid 60 protmode CTS wme burst dtimperiod 1 -dfs</pre><p>From another wireless machine, it is now possible to
	  initiate a scan to find the <acronym class="acronym">AP</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
SSID            BSSID              CHAN RATE  S:N   INT CAPS
freebsdap       00:11:95:c3:0d:ac    1   54M 22:1   100 EPS</pre><p>In this example, the client machine found the
	  <acronym class="acronym">AP</acronym> and can associate with it using the
	  correct parameters.  See <a class="xref" href="#network-wireless-wep" title="31.3.4.1.4. WEP">Section 31.3.4.1.4, &#8220;<acronym class="acronym">WEP</acronym>&#8221;</a> for more details.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71704056"></a>31.3.7. Using Both Wired and Wireless Connections</h3></div></div></div><p>A wired connection provides better performance and
	reliability, while a wireless connection provides flexibility
	and mobility.  Laptop users typically want to roam seamlessly
	between the two types of connections.</p><p>On FreeBSD, it is possible to combine two or even more
	network interfaces together in a <span class="quote">&#8220;<span class="quote">failover</span>&#8221;</span>
	fashion.  This type of configuration uses the most preferred
	and available connection from a group of network interfaces,
	and the operating system switches automatically when the link
	state changes.</p><p>Link aggregation and failover is covered in <a class="xref" href="#network-aggregation" title="31.7. Link Aggregation and Failover">Section 31.7, &#8220;Link Aggregation and Failover&#8221;</a> and an example for using
	both wired and wireless connections is provided at <a class="xref" href="#networking-lagg-wired-and-wireless" title="Example 31.3. Failover Mode Between Ethernet and Wireless Interfaces">Example 31.3, &#8220;Failover Mode Between Ethernet and Wireless
	  Interfaces&#8221;</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71707128"></a>31.3.8. Troubleshooting</h3></div></div></div><p>This section describes
	a number of steps to help troubleshoot common wireless
	networking problems.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the access point is not listed when scanning,
	    check that the configuration has not limited the wireless
	    device to a limited set of channels.</p></li><li class="listitem"><p>If the device cannot associate with an access point,
	    verify that the configuration matches the settings on the
	    access point.  This includes the authentication scheme and
	    any security protocols.  Simplify the configuration as
	    much as possible.  If using a security protocol such as
	    <acronym class="acronym">WPA</acronym> or <acronym class="acronym">WEP</acronym>,
	    configure the access point for open authentication and
	    no security to see if traffic will pass.</p><p>Debugging support is provided by
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a>.  Try running this utility manually
	    with <code class="option">-dd</code> and look at the
	    system logs.</p></li><li class="listitem"><p>Once the system can associate with the access point,
	    diagnose the network configuration using tools like
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>.</p></li><li class="listitem"><p>There are many lower-level debugging tools.
	    Debugging messages can be enabled in the 802.11 protocol
	    support layer using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlandebug&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlandebug</span>(8)</span></a>.
	    For example, to enable console messages related to
	    scanning for access points and the 802.11 protocol
	    handshakes required to arrange communication:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>wlandebug -i <em class="replaceable"><code>wlan0</code></em> +scan+auth+debug+assoc</code></strong>
  net.wlan.0.debug: 0 =&gt; 0xc80000&lt;assoc,auth,scan&gt;</pre><p>Many useful statistics are maintained by the 802.11
	    layer and <code class="command">wlanstats</code>, found in <code class="filename">/usr/src/tools/tools/net80211</code>,
	    will dump this information.  These statistics should
	    display all errors identified by the 802.11 layer.
	    However, some errors are identified in the device drivers
	    that lie below the 802.11 layer so they may not show up.
	    To diagnose device-specific problems, refer to the
	    drivers' documentation.</p></li></ul></div><p>If the above information does not help to clarify the
	problem, submit a problem report and include output from the
	above tools.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-usb-tethering"></a>31.4. USB Tethering</h2></div></div></div><a id="idp71719928" class="indexterm"></a><p>Many cellphones provide the option to share their data
      connection over USB (often called "tethering").  This feature
      uses one of <acronym class="acronym">RNDIS</acronym>, <acronym class="acronym">CDC</acronym>,
      or a custom <span class="trademark">Apple</span>® <span class="trademark">iPhone</span>®/<span class="trademark">iPad</span>®
      protocol.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="trademark">Android</span>&#8482; devices generally use the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=urndis&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">urndis</span>(4)</span></a>
	  driver.</p></li><li class="listitem"><p><span class="trademark">Apple</span>® devices use the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipheth&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipheth</span>(4)</span></a> driver.</p></li><li class="listitem"><p>Older devices will often use the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=cdce&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">cdce</span>(4)</span></a>
	  driver.</p></li></ul></div><p>Before attaching a device, load the appropriate driver
      into the kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload if_urndis</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>kldload if_cdce</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>kldload if_ipheth</code></strong></pre><p>Once the device is attached
      <code class="literal">ue</code><em class="replaceable"><code>0</code></em> will be
      available for use like a normal network device.  Be sure that
      the <span class="quote">&#8220;<span class="quote">USB tethering</span>&#8221;</span> option is enabled on the
      device.</p><p>To make this change permanent and load the driver as a
      module at boot time, place the appropriate line of the following
      in <code class="filename">/boot/loader.conf</code>:</p><pre class="screen"><strong class="userinput"><code>if_urndis_load="YES"
if_cdce_load="YES"
if_ipheth_load="YES"</code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bluetooth"></a>31.5. Bluetooth</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Pav</span> <span class="surname">Lucistnik</span></span>. </span></div></div></div><a id="idp71746680" class="indexterm"></a><p>Bluetooth is a wireless technology for creating personal
      networks operating in the 2.4 GHz unlicensed band, with a
      range of 10 meters.  Networks are usually formed ad-hoc from
      portable devices such as cellular phones, handhelds, and
      laptops.  Unlike Wi-Fi wireless technology, Bluetooth offers
      higher level service profiles, such as
      <acronym class="acronym">FTP</acronym>-like file servers, file pushing, voice
      transport, serial line emulation, and more.</p><p>This section describes the use of a <acronym class="acronym">USB</acronym>
      Bluetooth dongle on a FreeBSD system.  It then describes the
      various Bluetooth protocols and utilities.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71761400"></a>31.5.1. Loading Bluetooth Support</h3></div></div></div><p>The Bluetooth stack in FreeBSD is implemented using the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=netgraph&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">netgraph</span>(4)</span></a> framework.  A broad variety of Bluetooth
	<acronym class="acronym">USB</acronym> dongles is supported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_ubt</span>(4)</span></a>.
	Broadcom BCM2033 based Bluetooth devices are supported by the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ubtbcmfw&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ubtbcmfw</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_ubt</span>(4)</span></a> drivers.  The 3Com
	Bluetooth PC Card 3CRWB60-A is supported by the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_bt3c&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_bt3c</span>(4)</span></a> driver.  Serial and UART based Bluetooth
	devices are supported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_h4&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_h4</span>(4)</span></a>, and
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcseriald&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcseriald</span>(8)</span></a>.</p><p>Before attaching a device, determine which of the above
	drivers it uses, then load the driver.  For example, if the
	device uses the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_ubt</span>(4)</span></a> driver:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload ng_ubt</code></strong></pre><p>If the Bluetooth device will be attached to the system
	during system startup, the system can be configured to load
	the module at boot time by adding the driver to
	<code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">ng_ubt_load="YES"</pre><p>Once the driver is loaded, plug in the
	<acronym class="acronym">USB</acronym> dongle.  If the driver load was
	successful, output similar to the following should appear on
	the console and in
	<code class="filename">/var/log/messages</code>:</p><pre class="screen">ubt0: vendor 0x0a12 product 0x0001, rev 1.10/5.25, addr 2
ubt0: Interface 0 endpoints: interrupt=0x81, bulk-in=0x82, bulk-out=0x2
ubt0: Interface 1 (alt.config 5) endpoints: isoc-in=0x83, isoc-out=0x3,
      wMaxPacketSize=49, nframes=6, buffer size=294</pre><p>To start and stop the Bluetooth stack, use its startup
	script.  It is a good idea to stop the stack before unplugging
	the device.  Starting the bluetooth stack might require
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> to be started.  When starting the stack, the
	output should be similar to the following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service bluetooth start ubt0</code></strong>
BD_ADDR: 00:02:72:00:d4:1a
Features: 0xff 0xff 0xf 00 00 00 00 00
&lt;3-Slot&gt; &lt;5-Slot&gt; &lt;Encryption&gt; &lt;Slot offset&gt;
&lt;Timing accuracy&gt; &lt;Switch&gt; &lt;Hold mode&gt; &lt;Sniff mode&gt;
&lt;Park mode&gt; &lt;RSSI&gt; &lt;Channel quality&gt; &lt;SCO link&gt;
&lt;HV2 packets&gt; &lt;HV3 packets&gt; &lt;u-law log&gt; &lt;A-law log&gt; &lt;CVSD&gt;
&lt;Paging scheme&gt; &lt;Power control&gt; &lt;Transparent SCO data&gt;
Max. ACL packet size: 192 bytes
Number of ACL packets: 8
Max. SCO packet size: 64 bytes
Number of SCO packets: 8</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71792504"></a>31.5.2. Finding Other Bluetooth Devices</h3></div></div></div><a id="idp71793144" class="indexterm"></a><p>The Host Controller Interface (<acronym class="acronym">HCI</acronym>)
	provides a uniform method for accessing Bluetooth baseband
	capabilities.  In FreeBSD, a netgraph <acronym class="acronym">HCI</acronym> node
	is created for each Bluetooth device.  For more details, refer
	to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_hci&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_hci</span>(4)</span></a>.</p><p>One of the most common tasks is discovery of Bluetooth
	devices within <acronym class="acronym">RF</acronym> proximity.  This
	operation is called <span class="emphasis"><em>inquiry</em></span>.  Inquiry and
	other <acronym class="acronym">HCI</acronym> related operations are done using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hccontrol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hccontrol</span>(8)</span></a>.  The example below shows how to find out
	which Bluetooth devices are in range.  The list of devices
	should be displayed in a few seconds.  Note that a remote
	device will only answer the inquiry if it is set to
	<span class="emphasis"><em>discoverable</em></span> mode.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci inquiry</code></strong>
Inquiry result, num_responses=1
Inquiry result #0
       BD_ADDR: 00:80:37:29:19:a4
       Page Scan Rep. Mode: 0x1
       Page Scan Period Mode: 00
       Page Scan Mode: 00
       Class: 52:02:04
       Clock offset: 0x78ef
Inquiry complete. Status: No error [00]</pre><p>The <code class="literal">BD_ADDR</code> is the unique address of a
	Bluetooth device, similar to the <acronym class="acronym">MAC</acronym>
	address of a network card.  This address is needed for further
	communication with a device and it is possible to assign a
	human readable name to a <code class="literal">BD_ADDR</code>.
	Information regarding the known Bluetooth hosts is contained
	in <code class="filename">/etc/bluetooth/hosts</code>.  The following
	example shows how to obtain the human readable name that was
	assigned to the remote device:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci remote_name_request 00:80:37:29:19:a4</code></strong>
BD_ADDR: 00:80:37:29:19:a4
Name: Pav's T39</pre><p>If an inquiry is performed on a remote Bluetooth device,
	it will find the computer as
	<span class="quote">&#8220;<span class="quote">your.host.name (ubt0)</span>&#8221;</span>.  The name assigned to
	the local device can be changed at any time.</p><p>Remote devices can be assigned aliases in
	<code class="filename">/etc/bluetooth/hosts</code>.  More information
	about <code class="filename">/etc/bluetooth/hosts</code> file might be
	found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bluetooth.hosts&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bluetooth.hosts</span>(5)</span></a>.</p><p>The Bluetooth system provides a point-to-point connection
	between two Bluetooth units, or a point-to-multipoint
	connection which is shared among several Bluetooth devices.
	The following example shows how to create a connection to a
	remote device:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci create_connection <em class="replaceable"><code>BT_ADDR</code></em></code></strong></pre><p><code class="literal">create_connection</code> accepts
	<code class="literal">BT_ADDR</code> as well as host aliases in
	<code class="filename">/etc/bluetooth/hosts</code>.</p><p>The following example shows how to obtain the list of
	active baseband connections for the local device:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci read_connection_list</code></strong>
Remote BD_ADDR    Handle Type Mode Role Encrypt Pending Queue State
00:80:37:29:19:a4     41  ACL    0 MAST    NONE       0     0 OPEN</pre><p>A <span class="emphasis"><em>connection handle</em></span> is useful when
	termination of the baseband connection is required, though
	it is normally not required to do this by hand.  The stack
	will automatically terminate inactive baseband
	connections.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hccontrol -n ubt0hci disconnect 41</code></strong>
Connection handle: 41
Reason: Connection terminated by local host [0x16]</pre><p>Type <code class="command">hccontrol help</code> for a complete
	listing of available <acronym class="acronym">HCI</acronym> commands.  Most
	of the <acronym class="acronym">HCI</acronym> commands do not require
	superuser privileges.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71817080"></a>31.5.3. Device Pairing</h3></div></div></div><p>By default, Bluetooth communication is not authenticated,
	and any device can talk to any other device.  A Bluetooth
	device, such as a cellular phone, may choose to require
	authentication to provide a particular service.  Bluetooth
	authentication is normally done with a
	<span class="emphasis"><em><acronym class="acronym">PIN</acronym> code</em></span>, an ASCII
	string up to 16 characters in length.  The user is required
	to enter the same <acronym class="acronym">PIN</acronym> code on both devices.
	Once the user has entered the <acronym class="acronym">PIN</acronym> code,
	both devices will generate a <span class="emphasis"><em>link key</em></span>.
	After that, the link key can be stored either in the devices
	or in a persistent storage.  Next time, both devices will
	use the previously generated link key.  This procedure is
	called <span class="emphasis"><em>pairing</em></span>.  Note that if the link
	key is lost by either device, the pairing must be
	repeated.</p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> daemon is responsible for handling
	Bluetooth authentication requests.  The default configuration
	file is <code class="filename">/etc/bluetooth/hcsecd.conf</code>.  An
	example section for a cellular phone with the
	<acronym class="acronym">PIN</acronym> code set to <code class="literal">1234</code> is
	shown below:</p><pre class="programlisting">device {
        bdaddr  00:80:37:29:19:a4;
        name    "Pav's T39";
        key     nokey;
        pin     "1234";
      }</pre><p>The only limitation on <acronym class="acronym">PIN</acronym> codes is
	length.  Some devices, such as Bluetooth headsets, may have
	a fixed <acronym class="acronym">PIN</acronym> code built in.  The
	<code class="option">-d</code> switch forces <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> to stay in
	the foreground, so it is easy to see what is happening.  Set
	the remote device to receive pairing and initiate the
	Bluetooth connection to the remote device.  The remote device
	should indicate that pairing was accepted and request the
	<acronym class="acronym">PIN</acronym> code.  Enter the same
	<acronym class="acronym">PIN</acronym> code listed in
	<code class="filename">hcsecd.conf</code>.  Now the computer and the
	remote device are paired.  Alternatively, pairing can be
	initiated on the remote device.</p><p>The following line can be added to
	<code class="filename">/etc/rc.conf</code> to configure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a>
	to start automatically on system start:</p><pre class="programlisting">hcsecd_enable="YES"</pre><p>The following is a sample of the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> daemon
	output:</p><pre class="programlisting">hcsecd[16484]: Got Link_Key_Request event from 'ubt0hci', remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name 'Pav's T39', link key doesn't exist
hcsecd[16484]: Sending Link_Key_Negative_Reply to 'ubt0hci' for remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Got PIN_Code_Request event from 'ubt0hci', remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name 'Pav's T39', PIN code exists
hcsecd[16484]: Sending PIN_Code_Reply to 'ubt0hci' for remote bdaddr 0:80:37:29:19:a4</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71846648"></a>31.5.4. Network Access with
	<acronym class="acronym">PPP</acronym> Profiles</h3></div></div></div><p>A Dial-Up Networking (<acronym class="acronym">DUN</acronym>) profile can
	be used to configure a cellular phone as a wireless modem for
	connecting to a dial-up Internet access server.  It can also
	be used to configure a computer to receive data calls from a
	cellular phone.</p><p>Network access with a <acronym class="acronym">PPP</acronym> profile can
	be used to provide <acronym class="acronym">LAN</acronym> access for a single
	Bluetooth device or multiple Bluetooth devices.  It can also
	provide <acronym class="acronym">PC</acronym> to <acronym class="acronym">PC</acronym>
	connection using <acronym class="acronym">PPP</acronym> networking over serial
	cable emulation.</p><p>In FreeBSD, these profiles are implemented with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>
	and the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> wrapper which converts a
	Bluetooth connection into something
	<acronym class="acronym">PPP</acronym> can use.  Before a profile can be used,
	a new <acronym class="acronym">PPP</acronym> label must be created in
	<code class="filename">/etc/ppp/ppp.conf</code>.  Consult
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> for examples.</p><p>In this example, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> is used to open a
	connection to a remote device with a
	<code class="literal">BD_ADDR</code> of
	<code class="literal">00:80:37:29:19:a4</code> on a
	<acronym class="acronym">DUN</acronym> <acronym class="acronym">RFCOMM</acronym>
	channel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_pppd -a 00:80:37:29:19:a4 -c -C dun -l rfcomm-dialup</code></strong></pre><p>The actual channel number will be obtained from the remote
	device using the <acronym class="acronym">SDP</acronym> protocol.  It is
	possible to specify the <acronym class="acronym">RFCOMM</acronym> channel by
	hand, and in this case <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> will not perform
	the <acronym class="acronym">SDP</acronym> query.  Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpcontrol</span>(8)</span></a> to
	find out the <acronym class="acronym">RFCOMM</acronym> channel on the remote
	device.</p><p>In order to provide network access with the
	<acronym class="acronym">PPP</acronym> <acronym class="acronym">LAN</acronym> service,
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> must be running and a new entry for
	<acronym class="acronym">LAN</acronym> clients must be created in
	<code class="filename">/etc/ppp/ppp.conf</code>.  Consult
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> for examples.  Finally, start the
	<acronym class="acronym">RFCOMM</acronym> <acronym class="acronym">PPP</acronym> server on a
	valid <acronym class="acronym">RFCOMM</acronym> channel number.  The
	<acronym class="acronym">RFCOMM</acronym> <acronym class="acronym">PPP</acronym> server will
	automatically register the Bluetooth <acronym class="acronym">LAN</acronym>
	service with the local <acronym class="acronym">SDP</acronym> daemon.  The
	example below shows how to start the <acronym class="acronym">RFCOMM</acronym>
	<acronym class="acronym">PPP</acronym> server.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_pppd -s -C 7 -l rfcomm-server</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71898232"></a>31.5.5. Bluetooth Protocols</h3></div></div></div><p>This section provides an overview of the various Bluetooth
	protocols, their function, and associated utilities.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71899384"></a>31.5.5.1. Logical Link Control and Adaptation Protocol
	  (<acronym class="acronym">L2CAP</acronym>)</h4></div></div></div><a id="idp71900408" class="indexterm"></a><p>The Logical Link Control and Adaptation Protocol
	  (<acronym class="acronym">L2CAP</acronym>) provides connection-oriented and
	  connectionless data services to upper layer protocols.
	  <acronym class="acronym">L2CAP</acronym> permits higher level protocols and
	  applications to transmit and receive
	  <acronym class="acronym">L2CAP</acronym> data packets up to 64 kilobytes in
	  length.</p><p><acronym class="acronym">L2CAP</acronym> is based around the concept of
	  <span class="emphasis"><em>channels</em></span>.  A channel is a logical
	  connection on top of a baseband connection, where each
	  channel is bound to a single protocol in a many-to-one
	  fashion.  Multiple channels can be bound to the same
	  protocol, but a channel cannot be bound to multiple
	  protocols.  Each <acronym class="acronym">L2CAP</acronym> packet received on
	  a channel is directed to the appropriate higher level
	  protocol.  Multiple channels can share the same baseband
	  connection.</p><p>In FreeBSD, a netgraph <acronym class="acronym">L2CAP</acronym> node is
	  created for each Bluetooth device.  This node is normally
	  connected to the downstream Bluetooth <acronym class="acronym">HCI</acronym>
	  node and upstream Bluetooth socket nodes.  The default name
	  for the <acronym class="acronym">L2CAP</acronym> node is
	  <span class="quote">&#8220;<span class="quote">devicel2cap</span>&#8221;</span>.  For more details refer to
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_l2cap&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_l2cap</span>(4)</span></a>.</p><p>A useful command is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=l2ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">l2ping</span>(8)</span></a>, which can be used to
	  ping other devices.  Some Bluetooth implementations might
	  not return all of the data sent to them, so <code class="literal">0
	    bytes</code> in the following example is normal.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>l2ping -a 00:80:37:29:19:a4</code></strong>
0 bytes from 0:80:37:29:19:a4 seq_no=0 time=48.633 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=1 time=37.551 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=2 time=28.324 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=3 time=46.150 ms result=0</pre><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=l2control&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">l2control</span>(8)</span></a> utility is used to perform various
	  operations on <acronym class="acronym">L2CAP</acronym> nodes.  This example
	  shows how to obtain the list of logical connections
	  (channels) and the list of baseband connections for the
	  local device:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>l2control -a 00:02:72:00:d4:1a read_channel_list</code></strong>
L2CAP channels:
Remote BD_ADDR     SCID/ DCID   PSM  IMTU/ OMTU State
00:07:e0:00:0b:ca    66/   64     3   132/  672 OPEN
<code class="prompt">%</code> <strong class="userinput"><code>l2control -a 00:02:72:00:d4:1a read_connection_list</code></strong>
L2CAP connections:
Remote BD_ADDR    Handle Flags Pending State
00:07:e0:00:0b:ca     41 O           0 OPEN</pre><p>Another diagnostic tool is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=btsockstat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">btsockstat</span>(1)</span></a>.  It is
	  similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=netstat&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">netstat</span>(1)</span></a>, but for Bluetooth
	  network-related data structures.  The example below shows
	  the same logical connection as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=l2control&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">l2control</span>(8)</span></a>
	  above.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>btsockstat</code></strong>
Active L2CAP sockets
PCB      Recv-Q Send-Q Local address/PSM       Foreign address   CID   State
c2afe900      0      0 00:02:72:00:d4:1a/3     00:07:e0:00:0b:ca 66    OPEN
Active RFCOMM sessions
L2PCB    PCB      Flag MTU   Out-Q DLCs State
c2afe900 c2b53380 1    127   0     Yes  OPEN
Active RFCOMM sockets
PCB      Recv-Q Send-Q Local address     Foreign address   Chan DLCI State
c2e8bc80      0    250 00:02:72:00:d4:1a 00:07:e0:00:0b:ca 3    6    OPEN</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71937272"></a>31.5.5.2. Radio Frequency Communication
	  (<acronym class="acronym">RFCOMM</acronym>)</h4></div></div></div><p>The <acronym class="acronym">RFCOMM</acronym> protocol provides
	  emulation of serial ports over the <acronym class="acronym">L2CAP</acronym>
	  protocol.  <acronym class="acronym">RFCOMM</acronym> is a simple transport
	  protocol, with additional provisions for emulating the 9
	  circuits of RS-232 (EIATIA-232-E) serial ports.  It
	  supports up to 60 simultaneous connections
	  (<acronym class="acronym">RFCOMM</acronym> channels) between two Bluetooth
	  devices.</p><p>For the purposes of <acronym class="acronym">RFCOMM</acronym>, a
	  complete communication path involves two applications
	  running on the communication endpoints with a communication
	  segment between them.  <acronym class="acronym">RFCOMM</acronym> is intended
	  to cover applications that make use of the serial ports of
	  the devices in which they reside.  The communication segment
	  is a direct connect Bluetooth link from one device to
	  another.</p><p><acronym class="acronym">RFCOMM</acronym> is only concerned with the
	  connection between the devices in the direct connect case,
	  or between the device and a modem in the network case.
	  <acronym class="acronym">RFCOMM</acronym> can support other configurations,
	  such as modules that communicate via Bluetooth wireless
	  technology on one side and provide a wired interface on the
	  other side.</p><p>In FreeBSD, <acronym class="acronym">RFCOMM</acronym> is implemented at the
	  Bluetooth sockets layer.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71947384"></a>31.5.5.3. Service Discovery Protocol
	  (<acronym class="acronym">SDP</acronym>)</h4></div></div></div><a id="idp71948408" class="indexterm"></a><p>The Service Discovery Protocol (<acronym class="acronym">SDP</acronym>)
	  provides the means for client applications to discover the
	  existence of services provided by server applications as
	  well as the attributes of those services.  The attributes of
	  a service include the type or class of service offered and
	  the mechanism or protocol information needed to utilize the
	  service.</p><p><acronym class="acronym">SDP</acronym> involves communication between a
	  <acronym class="acronym">SDP</acronym> server and a <acronym class="acronym">SDP</acronym>
	  client.  The server maintains a list of service records that
	  describe the characteristics of services associated with the
	  server.  Each service record contains information about a
	  single service.  A client may retrieve information from a
	  service record maintained by the <acronym class="acronym">SDP</acronym>
	  server by issuing a <acronym class="acronym">SDP</acronym> request.  If the
	  client, or an application associated with the client,
	  decides to use a service, it must open a separate connection
	  to the service provider in order to utilize the service.
	  <acronym class="acronym">SDP</acronym> provides a mechanism for discovering
	  services and their attributes, but it does not provide a
	  mechanism for utilizing those services.</p><p>Normally, a <acronym class="acronym">SDP</acronym> client searches for
	  services based on some desired characteristics of the
	  services.  However, there are times when it is desirable to
	  discover which types of services are described by an
	  <acronym class="acronym">SDP</acronym> server's service records without any
	  prior information about the services.  This process of
	  looking for any offered services is called
	  <span class="emphasis"><em>browsing</em></span>.</p><p>The Bluetooth <acronym class="acronym">SDP</acronym> server,
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a>, and command line client, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpcontrol</span>(8)</span></a>,
	  are included in the standard FreeBSD installation.  The
	  following example shows how to perform a
	  <acronym class="acronym">SDP</acronym> browse query.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sdpcontrol -a 00:01:03:fc:6e:ec browse</code></strong>
Record Handle: 00000000
Service Class ID List:
        Service Discovery Server (0x1000)
Protocol Descriptor List:
        L2CAP (0x0100)
                Protocol specific parameter #1: u/int/uuid16 1
                Protocol specific parameter #2: u/int/uuid16 1

Record Handle: 0x00000001
Service Class ID List:
        Browse Group Descriptor (0x1001)

Record Handle: 0x00000002
Service Class ID List:
        LAN Access Using PPP (0x1102)
Protocol Descriptor List:
        L2CAP (0x0100)
        RFCOMM (0x0003)
                Protocol specific parameter #1: u/int8/bool 1
Bluetooth Profile Descriptor List:
        LAN Access Using PPP (0x1102) ver. 1.0</pre><p>Note that each service has a list of attributes, such
	  as the <acronym class="acronym">RFCOMM</acronym> channel.  Depending on the
	  service, the user might need to make note of some of the
	  attributes.  Some Bluetooth implementations do not support
	  service browsing and may return an empty list.  In this
	  case, it is possible to search for the specific service.
	  The example below shows how to search for the
	  <acronym class="acronym">OBEX</acronym> Object Push
	  (<acronym class="acronym">OPUSH</acronym>) service:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sdpcontrol -a 00:01:03:fc:6e:ec search OPUSH</code></strong></pre><p>Offering services on FreeBSD to Bluetooth clients is done
	  with the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> server.  The following line can be
	  added to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">sdpd_enable="YES"</pre><p>Then the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> daemon can be started with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sdpd start</code></strong></pre><p>The local server application that wants to provide a
	  Bluetooth service to remote clients will register the
	  service with the local <acronym class="acronym">SDP</acronym> daemon.  An
	  example of such an application is <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a>.  Once
	  started, it will register the Bluetooth LAN service with the
	  local <acronym class="acronym">SDP</acronym> daemon.</p><p>The list of services registered with the local
	  <acronym class="acronym">SDP</acronym> server can be obtained by issuing a
	  <acronym class="acronym">SDP</acronym> browse query via the local control
	  channel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sdpcontrol -l browse</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71980536"></a>31.5.5.4. <acronym class="acronym">OBEX</acronym> Object Push
	  (<acronym class="acronym">OPUSH</acronym>)</h4></div></div></div><a id="idp71981816" class="indexterm"></a><p>Object Exchange (<acronym class="acronym">OBEX</acronym>) is a widely
	  used protocol for simple file transfers between mobile
	  devices.  Its main use is in infrared communication, where
	  it is used for generic file transfers between notebooks or
	  <acronym class="acronym">PDA</acronym>s, and for sending business cards or
	  calendar entries between cellular phones and other devices
	  with Personal Information Manager (<acronym class="acronym">PIM</acronym>)
	  applications.</p><p>The <acronym class="acronym">OBEX</acronym> server and client are
	  implemented by <span class="application">obexapp</span>, which can
	  be installed using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/obexapp/pkg-descr">comms/obexapp</a>
	  package or port.</p><p>The <acronym class="acronym">OBEX</acronym> client is used to push
	  and/or pull objects from the <acronym class="acronym">OBEX</acronym> server.
	  An example object is a business card or an appointment.
	  The <acronym class="acronym">OBEX</acronym> client can obtain the
	  <acronym class="acronym">RFCOMM</acronym> channel number from the remote
	  device via <acronym class="acronym">SDP</acronym>.  This can be done by
	  specifying the service name instead of the
	  <acronym class="acronym">RFCOMM</acronym> channel number.  Supported service
	  names are: <code class="literal">IrMC</code>, <code class="literal">FTRN</code>,
	  and <code class="literal">OPUSH</code>.  It is also possible to
	  specify the <acronym class="acronym">RFCOMM</acronym> channel as a number.
	  Below is an example of an <acronym class="acronym">OBEX</acronym> session
	  where the device information object is pulled from the
	  cellular phone, and a new object, the business card, is
	  pushed into the phone's directory.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>obexapp -a 00:80:37:29:19:a4 -C IrMC</code></strong>
obex&gt; get telecom/devinfo.txt devinfo-t39.txt
Success, response: OK, Success (0x20)
obex&gt; put new.vcf
Success, response: OK, Success (0x20)
obex&gt; di
Success, response: OK, Success (0x20)</pre><p>In order to provide the <acronym class="acronym">OPUSH</acronym>
	  service, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> must be running and a root folder,
	  where all incoming objects will be stored, must be created.
	  The default path to the root folder is
	  <code class="filename">/var/spool/obex</code>.  Finally, start the
	  <acronym class="acronym">OBEX</acronym> server on a valid
	  <acronym class="acronym">RFCOMM</acronym> channel number.  The
	  <acronym class="acronym">OBEX</acronym> server will automatically register
	  the <acronym class="acronym">OPUSH</acronym> service with the local
	  <acronym class="acronym">SDP</acronym> daemon.  The example below shows how
	  to start the <acronym class="acronym">OBEX</acronym> server.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>obexapp -s -C 10</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72025208"></a>31.5.5.5. Serial Port Profile (<acronym class="acronym">SPP</acronym>)</h4></div></div></div><p>The Serial Port Profile (<acronym class="acronym">SPP</acronym>) allows
	  Bluetooth devices to perform serial cable emulation.  This
	  profile allows legacy applications to use Bluetooth as a
	  cable replacement, through a virtual serial port
	  abstraction.</p><p>In FreeBSD, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_sppd</span>(1)</span></a> implements
	  <acronym class="acronym">SPP</acronym> and a pseudo tty is used as a virtual
	  serial port abstraction.  The example below shows how to
	  connect to a remote device's serial port service.  A
	  <acronym class="acronym">RFCOMM</acronym> channel does not have to be
	  specified as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rfcomm_sppd</span>(1)</span></a> can obtain it from the
	  remote device via <acronym class="acronym">SDP</acronym>.  To override this,
	  specify a <acronym class="acronym">RFCOMM</acronym> channel on the command
	  line.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_sppd -a 00:07:E0:00:0B:CA -t</code></strong>
rfcomm_sppd[94692]: Starting on /dev/pts/6...
/dev/pts/6</pre><p>Once connected, the pseudo tty can be used as serial
	  port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cu -l /dev/pts/6</code></strong></pre><p>The pseudo tty is printed on stdout and can be read by
	  wrapper scripts:</p><pre class="programlisting">PTS=`rfcomm_sppd -a 00:07:E0:00:0B:CA -t`
cu -l $PTS</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72037880"></a>31.5.6. Troubleshooting</h3></div></div></div><p>By default, when FreeBSD is accepting a new connection, it
	tries to perform a role switch and become master.  Some older
	Bluetooth devices which do not support role switching will not
	be able to connect.  Since role switching is performed when a
	new connection is being established, it is not possible to ask
	the remote device if it supports role switching.  However,
	there is a <acronym class="acronym">HCI</acronym> option to disable role
	switching on the local side:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hccontrol -n ubt0hci write_node_role_switch 0</code></strong></pre><p>To display Bluetooth packets, use the third-party package
	<span class="application">hcidump</span>, which can be installed
	using the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/comms/hcidump/pkg-descr">comms/hcidump</a> package or port.
	This utility is similar to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> and can be used to
	display the contents of Bluetooth packets on the terminal and
	to dump the Bluetooth packets to a file.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bridging"></a>31.6. Bridging</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Andrew</span> <span class="surname">Thompson</span></span>. </span></div></div></div><a id="idp72045944" class="indexterm"></a><a id="idp72046968" class="indexterm"></a><p>It is sometimes useful to divide a network, such as an
      Ethernet segment, into network segments without having to
      create <acronym class="acronym">IP</acronym> subnets and use a router to connect
      the segments together.  A device that connects two networks
      together in this fashion is called a
      <span class="quote">&#8220;<span class="quote">bridge</span>&#8221;</span>.</p><p>A bridge works by learning the <acronym class="acronym">MAC</acronym>
      addresses of the devices on each of its network interfaces.  It
      forwards traffic between networks only when the source and
      destination <acronym class="acronym">MAC</acronym> addresses are on different
      networks.  In many respects, a bridge is like an Ethernet switch
      with very few ports.    A FreeBSD system with multiple network
      interfaces can be configured to act as a bridge.</p><p>Bridging can be useful in the following situations:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Connecting Networks</span></dt><dd><p>The basic operation of a bridge is to join two or more
	    network segments.  There are many reasons to use a
	    host-based bridge instead of networking equipment, such as
	    cabling constraints or firewalling.  A bridge can also
	    connect a wireless interface running in hostap mode to a
	    wired network and act as an access point.</p></dd><dt><span class="term">Filtering/Traffic Shaping Firewall</span></dt><dd><p>A bridge can be used when firewall functionality is
	    needed without routing or Network Address Translation
	    (<acronym class="acronym">NAT</acronym>).</p><p>An example is a small company that is connected via
	    <acronym class="acronym">DSL</acronym> or <acronym class="acronym">ISDN</acronym> to an
	    <acronym class="acronym">ISP</acronym>.  There are thirteen public
	    <acronym class="acronym">IP</acronym> addresses from the
	    <acronym class="acronym">ISP</acronym> and ten computers on the network.
	    In this situation, using a router-based firewall is
	    difficult because of subnetting issues.  A bridge-based
	    firewall can be configured without any
	    <acronym class="acronym">IP</acronym> addressing issues.</p></dd><dt><span class="term">Network Tap</span></dt><dd><p>A bridge can join two network segments in order to
	    inspect all Ethernet frames that pass between them using
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> on the bridge interface or
	    by sending a copy of all frames out an additional
	    interface known as a span port.</p></dd><dt><span class="term">Layer 2 <acronym class="acronym">VPN</acronym></span></dt><dd><p>Two Ethernet networks can be joined across an
	    <acronym class="acronym">IP</acronym> link by bridging the networks to an
	    EtherIP tunnel or a <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tap&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tap</span>(4)</span></a> based solution such as
	    <span class="application">OpenVPN</span>.</p></dd><dt><span class="term">Layer 2 Redundancy</span></dt><dd><p>A network can be connected together with multiple
	    links and use the Spanning Tree Protocol
	    (<acronym class="acronym">STP</acronym>) to block redundant paths.</p></dd></dl></div><p>This section describes how to configure a FreeBSD system as a
      bridge using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a>.  A netgraph bridging driver is
      also available, and is described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ng_bridge&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ng_bridge</span>(4)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Packet filtering can be used with any firewall package
	that hooks into the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pfil&amp;sektion=9&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pfil</span>(9)</span></a> framework.  The bridge can be
	used as a traffic shaper with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> or
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72078840"></a>31.6.1. Enabling the Bridge</h3></div></div></div><p>In FreeBSD, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a> is a kernel module which is
	automatically loaded by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> when creating a
	bridge interface.  It is also possible to compile bridge
	support into a custom kernel by adding
	<code class="literal">device if_bridge</code> to the custom kernel
	configuration file.</p><p>The bridge is created using interface cloning.  To create
	the bridge interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge create</code></strong>
bridge0
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0</code></strong>
bridge0: flags=8802&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:00:00:00:00:00 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:00:00:00:00:00 priority 0 ifcost 0 port 0</pre><p>When a bridge interface is created, it is automatically
	assigned a randomly generated Ethernet address.  The
	<code class="literal">maxaddr</code> and <code class="literal">timeout</code>
	parameters control how many <acronym class="acronym">MAC</acronym> addresses
	the bridge will keep in its forwarding table and how many
	seconds before each entry is removed after it is last seen.
	The other parameters control how <acronym class="acronym">STP</acronym>
	operates.</p><p>Next, specify which network interfaces to add as members
	of the bridge.  For the bridge to forward packets, all member
	interfaces and the bridge need to be up:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm fxp0 addm fxp1 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp0 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp1 up</code></strong></pre><p>The bridge can now forward Ethernet frames between
	<code class="filename">fxp0</code> and <code class="filename">fxp1</code>.  Add
	the following lines to <code class="filename">/etc/rc.conf</code> so
	the bridge is created at startup:</p><pre class="programlisting">cloned_interfaces="bridge0"
ifconfig_bridge0="addm fxp0 addm fxp1 up"
ifconfig_fxp0="up"
ifconfig_fxp1="up"</pre><p>If the bridge host needs an <acronym class="acronym">IP</acronym>
	address, set it on the bridge interface, not on the member
	interfaces.  The address can be set statically or via
	<acronym class="acronym">DHCP</acronym>.  This example sets a static
	<acronym class="acronym">IP</acronym> address:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 inet 192.168.0.1/24</code></strong></pre><p>It is also possible to assign an <acronym class="acronym">IPv6</acronym>
	address to a bridge interface.  To make the changes permanent,
	add the addressing information to
	<code class="filename">/etc/rc.conf</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">When packet filtering is enabled, bridged packets will
	  pass through the filter inbound on the originating interface
	  on the bridge interface, and outbound on the appropriate
	  interfaces.  Either stage can be disabled.  When direction
	  of the packet flow is important, it is best to firewall on
	  the member interfaces rather than the bridge itself.</p><p xmlns="http://www.w3.org/1999/xhtml">The bridge has several configurable settings for passing
	  non-<acronym class="acronym">IP</acronym> and <acronym class="acronym">IP</acronym> packets,
	  and layer2 firewalling with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>.  See
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a> for more information.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71872760"></a>31.6.2. Enabling Spanning Tree</h3></div></div></div><p>For an Ethernet network to function properly, only one
	active path can exist between two devices.  The
	<acronym class="acronym">STP</acronym> protocol detects loops and puts
	redundant links into a blocked state.  Should one of the
	active links fail, <acronym class="acronym">STP</acronym> calculates a
	different tree and enables one of the blocked paths to restore
	connectivity to all points in the network.</p><p>The Rapid Spanning Tree Protocol (<acronym class="acronym">RSTP</acronym>
	or 802.1w) provides backwards compatibility with legacy
	<acronym class="acronym">STP</acronym>.  <acronym class="acronym">RSTP</acronym> provides
	faster convergence and exchanges information with neighboring
	switches to quickly transition to forwarding mode without
	creating loops.  FreeBSD supports <acronym class="acronym">RSTP</acronym> and
	<acronym class="acronym">STP</acronym> as operating modes, with
	<acronym class="acronym">RSTP</acronym> being the default mode.</p><p><acronym class="acronym">STP</acronym> can be enabled on member interfaces
	using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.  For a bridge with
	<code class="filename">fxp0</code> and <code class="filename">fxp1</code> as the
	current interfaces, enable <acronym class="acronym">STP</acronym> with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 stp fxp0 stp fxp1</code></strong>
bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether d6:cf:d5:a0:94:6d
        id 00:01:02:4b:d4:50 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 0 port 0
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 3 priority 128 path cost 200000 proto rstp
                role designated state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role designated state forwarding</pre><p>This bridge has a spanning tree ID of
	<code class="literal">00:01:02:4b:d4:50</code> and a priority of
	<code class="literal">32768</code>.  As the <code class="literal">root id</code>
	is the same, it indicates that this is the root bridge for the
	tree.</p><p>Another bridge on the network also has
	<acronym class="acronym">STP</acronym> enabled:</p><pre class="screen">bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:13:d4:9a:06:7a priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 400000 port 4
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role root state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 5 priority 128 path cost 200000 proto rstp
                role designated state forwarding</pre><p>The line <code class="literal">root id 00:01:02:4b:d4:50 priority 32768
	  ifcost 400000 port 4</code> shows that the root bridge is
	<code class="literal">00:01:02:4b:d4:50</code> and has a path cost of
	<code class="literal">400000</code> from this bridge.  The path to the
	root bridge is via <code class="literal">port 4</code> which is
	<code class="filename">fxp0</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72103160"></a>31.6.3. Bridge Interface Parameters</h3></div></div></div><p>Several <code class="command">ifconfig</code> parameters are unique
	to bridge interfaces.  This section summarizes some common
	uses for these parameters.  The complete list of available
	parameters is described in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">private</span></dt><dd><p>A private interface does not forward any traffic to
	      any other port that is also designated as a private
	      interface.  The traffic is blocked unconditionally so no
	      Ethernet frames will be forwarded, including
	      <acronym class="acronym">ARP</acronym> packets.  If traffic needs to be
	      selectively blocked, a firewall should be used
	      instead.</p></dd><dt><span class="term">span</span></dt><dd><p>A span port transmits a copy of every Ethernet frame
	      received by the bridge.  The number of span ports
	      configured on a bridge is unlimited, but if an
	      interface is designated as a span port, it cannot also
	      be used as a regular bridge port.  This is most useful
	      for snooping a bridged network passively on another host
	      connected to one of the span ports of the bridge.  For
	      example, to send a copy of all frames out the interface
	      named <code class="filename">fxp4</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 span fxp4</code></strong></pre></dd><dt><span class="term">sticky</span></dt><dd><p>If a bridge member interface is marked as sticky,
	      dynamically learned address entries are treated as
	      static entries in the forwarding cache.  Sticky entries
	      are never aged out of the cache or replaced, even if the
	      address is seen on a different interface.  This gives
	      the benefit of static address entries without the need
	      to pre-populate the forwarding table.  Clients learned
	      on a particular segment of the bridge cannot roam to
	      another segment.</p><p>An example of using sticky addresses is to combine
	      the bridge with <acronym class="acronym">VLAN</acronym>s in order to
	      isolate customer networks without wasting
	      <acronym class="acronym">IP</acronym> address space.  Consider that
	      <code class="systemitem">CustomerA</code>
	      is on <code class="literal">vlan100</code>, <code class="systemitem">CustomerB</code> is on
	      <code class="literal">vlan101</code>, and the bridge has the
	      address <code class="systemitem">192.168.0.1</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm vlan100 sticky vlan100 addm vlan101 sticky vlan101</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 inet 192.168.0.1/24</code></strong></pre><p>In this example, both clients see <code class="systemitem">192.168.0.1</code> as their
	      default gateway.  Since the bridge cache is sticky, one
	      host cannot spoof the <acronym class="acronym">MAC</acronym> address of
	      the other customer in order to intercept their
	      traffic.</p><p>Any communication between the
	      <acronym class="acronym">VLAN</acronym>s can be blocked using a firewall
	      or, as seen in this example, private interfaces:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 private vlan100 private vlan101</code></strong></pre><p>The customers are completely isolated from each
	      other and the full <code class="systemitem">/24</code> address range can be
	      allocated without subnetting.</p><p>The number of unique source <acronym class="acronym">MAC</acronym>
	      addresses behind an interface can be limited.  Once the
	      limit is reached, packets with unknown source addresses
	      are dropped until an existing host cache entry expires
	      or is removed.</p><p>The following example sets the maximum number of
	      Ethernet devices for <code class="systemitem">CustomerA</code> on
	      <code class="literal">vlan100</code> to 10:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 ifmaxaddr vlan100 10</code></strong></pre></dd></dl></div><p>Bridge interfaces also support monitor mode, where the
	packets are discarded after <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> processing and are not
	processed or forwarded further.  This can be used to
	multiplex the input of two or more interfaces into a single
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> stream.  This is useful for reconstructing the
	traffic for network taps that transmit the RX/TX signals out
	through two separate interfaces.  For example, to read the
	input from four network interfaces as one stream:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm fxp0 addm fxp1 addm fxp2 addm fxp3 monitor up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tcpdump -i bridge0</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72148088"></a>31.6.4. <acronym class="acronym">SNMP</acronym> Monitoring</h3></div></div></div><p>The bridge interface and <acronym class="acronym">STP</acronym>
	parameters can be monitored via <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsnmpd</span>(1)</span></a> which is
	included in the FreeBSD base system.  The exported bridge
	<acronym class="acronym">MIB</acronym>s conform to <acronym class="acronym">IETF</acronym>
	standards so any <acronym class="acronym">SNMP</acronym> client or monitoring
	package can be used to retrieve the data.</p><p>To enable monitoring on the bridge, uncomment this line in
	<code class="filename">/etc/snmpd.config</code> by removing the
	beginning <code class="literal">#</code> symbol:</p><pre class="programlisting">begemotSnmpdModulePath."bridge" = "/usr/lib/snmp_bridge.so"</pre><p>Other configuration settings, such as community names and
	access lists, may need to be modified in this file.  See
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsnmpd</span>(1)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=snmp_bridge&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">snmp_bridge</span>(3)</span></a> for more information.
	Once these edits are saved, add this line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">bsnmpd_enable="YES"</pre><p>Then, start  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">bsnmpd</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service bsnmpd start</code></strong></pre><p>The following examples use the
	<span class="application">Net-SNMP</span> software
	(<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/net-snmp/pkg-descr">net-mgmt/net-snmp</a>) to query a bridge
	from a client system.  The
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/bsnmptools/pkg-descr">net-mgmt/bsnmptools</a> port can also be used.
	From the <acronym class="acronym">SNMP</acronym> client which is running
	<span class="application">Net-SNMP</span>, add the following lines
	to <code class="filename">$HOME/.snmp/snmp.conf</code> in order to
	import the bridge <acronym class="acronym">MIB</acronym> definitions:</p><pre class="programlisting">mibdirs +/usr/share/snmp/mibs
mibs +BRIDGE-MIB:RSTP-MIB:BEGEMOT-MIB:BEGEMOT-BRIDGE-MIB</pre><p>To monitor a single bridge using the IETF BRIDGE-MIB
	(RFC4188):</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpwalk -v 2c -c public bridge1.example.com mib-2.dot1dBridge</code></strong>
BRIDGE-MIB::dot1dBaseBridgeAddress.0 = STRING: 66:fb:9b:6e:5c:44
BRIDGE-MIB::dot1dBaseNumPorts.0 = INTEGER: 1 ports
BRIDGE-MIB::dot1dStpTimeSinceTopologyChange.0 = Timeticks: (189959) 0:31:39.59 centi-seconds
BRIDGE-MIB::dot1dStpTopChanges.0 = Counter32: 2
BRIDGE-MIB::dot1dStpDesignatedRoot.0 = Hex-STRING: 80 00 00 01 02 4B D4 50
...
BRIDGE-MIB::dot1dStpPortState.3 = INTEGER: forwarding(5)
BRIDGE-MIB::dot1dStpPortEnable.3 = INTEGER: enabled(1)
BRIDGE-MIB::dot1dStpPortPathCost.3 = INTEGER: 200000
BRIDGE-MIB::dot1dStpPortDesignatedRoot.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedCost.3 = INTEGER: 0
BRIDGE-MIB::dot1dStpPortDesignatedBridge.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedPort.3 = Hex-STRING: 03 80
BRIDGE-MIB::dot1dStpPortForwardTransitions.3 = Counter32: 1
RSTP-MIB::dot1dStpVersion.0 = INTEGER: rstp(2)</pre><p>The <code class="literal">dot1dStpTopChanges.0</code> value is two,
	indicating that the <acronym class="acronym">STP</acronym> bridge topology has
	changed twice.  A topology change means that one or more links
	in the network have changed or failed and a new tree has been
	calculated.  The
	<code class="literal">dot1dStpTimeSinceTopologyChange.0</code> value
	will show when this happened.</p><p>To monitor multiple bridge interfaces, the private
	BEGEMOT-BRIDGE-MIB can be used:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpwalk -v 2c -c public bridge1.example.com</code></strong>
enterprises.fokus.begemot.begemotBridge
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge0" = STRING: bridge0
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge2" = STRING: bridge2
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge0" = STRING: e:ce:3b:5a:9e:13
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge2" = STRING: 12:5e:4d:74:d:fc
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge0" = INTEGER: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge2" = INTEGER: 1
...
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge0" = Timeticks: (116927) 0:19:29.27 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge2" = Timeticks: (82773) 0:13:47.73 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge0" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge2" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge0" = Hex-STRING: 80 00 00 40 95 30 5E 31
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge2" = Hex-STRING: 80 00 00 50 8B B8 C6 A9</pre><p>To change the bridge interface being monitored via the
	<code class="literal">mib-2.dot1dBridge</code> subtree:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpset -v 2c -c private bridge1.example.com</code></strong>
BEGEMOT-BRIDGE-MIB::begemotBridgeDefaultBridgeIf.0 s bridge2</pre></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-aggregation"></a>31.7. Link Aggregation and Failover</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Andrew</span> <span class="surname">Thompson</span></span>. </span></div></div></div><a id="idp72232824" class="indexterm"></a><a id="idp72233592" class="indexterm"></a><a id="idp72234360" class="indexterm"></a><a id="idp72235256" class="indexterm"></a><a id="idp72236152" class="indexterm"></a><a id="idp72236920" class="indexterm"></a><p>FreeBSD provides the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interface which can be used
      to aggregate multiple network interfaces into one virtual
      interface in order to provide failover and link aggregation.
      Failover allows traffic to continue to flow as long as at least
      one aggregated network interface has an established link.  Link
      aggregation works best on switches which support
      <acronym class="acronym">LACP</acronym>, as this protocol distributes traffic
      bi-directionally while responding to the failure of individual
      links.</p><p>The aggregation protocols supported by the lagg interface
      determine which ports are used for outgoing traffic and whether
      or not a specific port accepts incoming traffic.  The following
      protocols are supported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">failover</span></dt><dd><p>This mode sends and receives traffic only through
	    the master port.  If the master port becomes
	    unavailable, the next active port is used.  The first
	    interface added to the virtual interface is the master
	    port and all subsequently added interfaces are used as
	    failover devices.  If failover to a non-master port
	    occurs, the original port becomes master once it
	    becomes available again.</p></dd><dt><span class="term">fec / loadbalance</span></dt><dd><p><span class="trademark">Cisco</span>® Fast <span class="trademark">EtherChannel</span>® (<acronym class="acronym">FEC</acronym>)
	    is found on older <span class="trademark">Cisco</span>® switches.  It provides a
	    static setup and does not negotiate aggregation with the
	    peer or exchange frames to monitor the link.  If the
	    switch supports <acronym class="acronym">LACP</acronym>, that should be
	    used instead.</p></dd><dt><span class="term"><acronym class="acronym">lacp</acronym></span></dt><dd><p>The <span class="trademark">IEEE</span>® 802.3ad Link Aggregation Control Protocol
	    (<acronym class="acronym">LACP</acronym>) negotiates a set of
	    aggregable links with the peer into one or more Link
	    Aggregated Groups (<acronym class="acronym">LAG</acronym>s).  Each
	    <acronym class="acronym">LAG</acronym> is composed of ports of the same
	    speed, set to full-duplex operation, and traffic is
	    balanced across the ports in the
	    <acronym class="acronym">LAG</acronym> with the greatest total speed.
	    Typically, there is only one <acronym class="acronym">LAG</acronym>
	    which contains all the ports.  In the event of changes
	    in physical connectivity,
	    <acronym class="acronym">LACP</acronym> will quickly converge to a new
	    configuration.</p><p><acronym class="acronym">LACP</acronym> balances outgoing traffic
	    across the active ports based on hashed protocol header
	    information and accepts incoming traffic from any active
	    port.  The hash includes the Ethernet source and
	    destination address and, if available, the
	    <acronym class="acronym">VLAN</acronym> tag, and the
	    <acronym class="acronym">IPv4</acronym> or <acronym class="acronym">IPv6</acronym>
	    source and destination address.</p></dd><dt><span class="term">roundrobin</span></dt><dd><p>This mode distributes outgoing traffic using a
	    round-robin scheduler through all active ports and
	    accepts incoming traffic from any active port.  Since
	    this mode violates Ethernet frame ordering, it should be
	    used with caution.</p></dd></dl></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72270328"></a>31.7.1. Configuration Examples</h3></div></div></div><p>This section demonstrates how to configure a <span class="trademark">Cisco</span>®
	switch and a FreeBSD system for <acronym class="acronym">LACP</acronym> load
	balancing.  It then shows how to configure two Ethernet
	interfaces in failover mode as well as how to configure
	failover mode between an Ethernet and a wireless
	interface.</p><div class="example"><a id="networking-lacp-aggregation-cisco"></a><div class="example-title">Example 31.1. <acronym class="acronym">LACP</acronym> Aggregation with a <span class="trademark">Cisco</span>®
	  Switch</div><div class="example-contents"><p>This example connects two <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=fxp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">fxp</span>(4)</span></a> Ethernet
	  interfaces on a FreeBSD machine to the first two Ethernet ports
	  on a <span class="trademark">Cisco</span>® switch as a single load balanced and fault
	  tolerant link.  More interfaces can be added to increase
	  throughput and fault tolerance.  Replace the names of the
	  <span class="trademark">Cisco</span>® ports, Ethernet devices, channel group number, and
	  <acronym class="acronym">IP</acronym> address shown in the example to match
	  the local configuration.</p><p>Frame ordering is mandatory on Ethernet links and any
	  traffic between two stations always flows over the same
	  physical link, limiting the maximum speed to that of one
	  interface.  The transmit algorithm attempts to use as much
	  information as it can to distinguish different traffic flows
	  and balance the flows across the available
	  interfaces.</p><p>On the <span class="trademark">Cisco</span>® switch, add the
	  <em class="replaceable"><code>FastEthernet0/1</code></em> and
	  <em class="replaceable"><code>FastEthernet0/2</code></em> interfaces to
	  channel group <em class="replaceable"><code>1</code></em>:</p><pre class="screen"><strong class="userinput"><code>interface <em class="replaceable"><code>FastEthernet0/1</code></em>
 channel-group <em class="replaceable"><code>1</code></em> mode active
 channel-protocol lacp</code></strong>
!
<strong class="userinput"><code>interface <em class="replaceable"><code>FastEthernet0/2</code></em>
 channel-group <em class="replaceable"><code>1</code></em> mode active
 channel-protocol lacp</code></strong></pre><p>On the FreeBSD system, create the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interface
	  using the physical interfaces
	  <em class="replaceable"><code>fxp0</code></em> and
	  <em class="replaceable"><code>fxp1</code></em> and bring the interfaces up
	  with an <acronym class="acronym">IP</acronym> address of
	  <em class="replaceable"><code>10.0.0.3/24</code></em>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>fxp0</code></em> up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>fxp1</code></em> up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> create </code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> up laggproto lacp laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.3/24</code></em></code></strong></pre><p>Next, verify the status of the virtual interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code></code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        inet 10.0.0.3 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet autoselect
        status: active
        laggproto lacp
        laggport: fxp1 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;
        laggport: fxp0 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;</pre><p>Ports
	  marked as <code class="literal">ACTIVE</code> are part of the
	  <acronym class="acronym">LAG</acronym> that has been negotiated with the
	  remote switch.  Traffic will be transmitted and received
	  through these active ports.  Add <code class="option">-v</code> to the
	  above command to view the <acronym class="acronym">LAG</acronym>
	  identifiers.</p><p>To see the port status on the <span class="trademark">Cisco</span>® switch:</p><pre class="screen">switch# <strong class="userinput"><code>show lacp neighbor</code></strong>
Flags:  S - Device is requesting Slow LACPDUs
        F - Device is requesting Fast LACPDUs
        A - Device is in Active mode       P - Device is in Passive mode

Channel group 1 neighbors

Partner's information:

                  LACP port                        Oper    Port     Port
Port      Flags   Priority  Dev ID         Age     Key     Number   State
Fa0/1     SA      32768     0005.5d71.8db8  29s    0x146   0x3      0x3D
Fa0/2     SA      32768     0005.5d71.8db8  29s    0x146   0x4      0x3D</pre><p>For more detail, type <strong class="userinput"><code>show lacp neighbor
	  detail</code></strong>.</p><p>To retain this configuration across reboots, add the
	  following entries to
	  <code class="filename">/etc/rc.conf</code> on the FreeBSD system:</p><pre class="programlisting">ifconfig_<em class="replaceable"><code>fxp0</code></em>="up"
ifconfig_<em class="replaceable"><code>fxp1</code></em>="up"
cloned_interfaces="<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>"
ifconfig_<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>="laggproto lacp laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.3/24</code></em>"</pre></div></div><br class="example-break" /><div class="example"><a id="networking-lagg-failover"></a><div class="example-title">Example 31.2. Failover Mode</div><div class="example-contents"><p>Failover mode can be used to switch over to a secondary
	  interface if the link is lost on the master interface.  To
	  configure failover, make sure that the underlying physical
	  interfaces are up, then create the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interface.
	  In this example, <em class="replaceable"><code>fxp0</code></em> is the
	  master interface, <em class="replaceable"><code>fxp1</code></em> is the
	  secondary interface, and the virtual interface is assigned
	  an <acronym class="acronym">IP</acronym> address of
	  <em class="replaceable"><code>10.0.0.15/24</code></em>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>fxp0</code></em> up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>fxp1</code></em> up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> up laggproto failover laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.15/24</code></em></code></strong></pre><p>The virtual interface should look something like
	  this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code></code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        inet 10.0.0.15 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet autoselect
        status: active
        laggproto failover
        laggport: fxp1 flags=0&lt;&gt;
        laggport: fxp0 flags=5&lt;MASTER,ACTIVE&gt;</pre><p>Traffic will be transmitted and received on
	  <em class="replaceable"><code>fxp0</code></em>.  If the link is lost on
	  <em class="replaceable"><code>fxp0</code></em>,
	  <em class="replaceable"><code>fxp1</code></em> will become the active link.
	  If the link is restored on the master interface, it will
	  once again become the active link.</p><p>To retain this configuration across reboots, add the
	  following entries to
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ifconfig_<em class="replaceable"><code>fxp0</code></em>="up"
ifconfig_<em class="replaceable"><code>fxp1</code></em>="up"
cloned_interfaces="<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>"
ifconfig_<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>="laggproto failover laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.15/24</code></em>"</pre></div></div><br class="example-break" /><div class="example"><a id="networking-lagg-wired-and-wireless"></a><div class="example-title">Example 31.3. Failover Mode Between Ethernet and Wireless
	  Interfaces</div><div class="example-contents"><p>For laptop users, it is usually desirable to configure
	  the wireless device as a secondary which is only used when
	  the Ethernet connection is not available.  With
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>, it is possible to configure a failover which
	  prefers the Ethernet connection for both performance and
	  security reasons, while maintaining the ability to transfer
	  data over the wireless connection.</p><p>This is achieved by overriding the Ethernet interface's
	  <acronym class="acronym">MAC</acronym> address with that of the wireless
	  interface.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In theory, either the Ethernet or wireless MAC address
	    can be changed to match the other.  However, some popular
	    wireless interfaces lack support for overriding the MAC
	    address.  We therefore recommend overriding the Ethernet
	    MAC address for this purpose.</p></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If the driver for the wireless interface is not loaded
	    in the <code class="literal">GENERIC</code> or custom kernel,
	    and the computer is running FreeBSD 12.1,
	    load the corresponding <code class="filename">.ko</code> in
	    <code class="filename">/boot/loader.conf</code> by adding
	    <strong class="userinput"><code><em class="replaceable"><code>driver</code></em>_load="YES"</code></strong>
	    to that file and rebooting.  Another, better way is to
	    load the driver in <code class="filename">/etc/rc.conf</code> by
	    adding it to <code class="varname">kld_list</code> (see
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> for details) in that file and rebooting.
	    This is needed because otherwise the driver is not loaded
	    yet at the time the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interface is set
	    up.</p></div><p>In this example, the Ethernet interface,
	  <em class="replaceable"><code>re0</code></em>, is the master and the
	  wireless interface, <em class="replaceable"><code>wlan0</code></em>, is
	  the failover.  The <em class="replaceable"><code>wlan0</code></em>
	  interface was created from the
	  <em class="replaceable"><code>ath0</code></em> physical wireless interface,
	  and the Ethernet interface will be configured with the
	  <acronym class="acronym">MAC</acronym> address of the wireless interface.
	  First, determine the <acronym class="acronym">MAC</acronym> address of the
	  wireless interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	ether b8:ee:65:5b:32:59
	groups: wlan
	ssid Bbox-A3BD2403 channel 6 (2437 MHz 11g ht/20) bssid 00:37:b7:56:4b:60
	regdomain ETSI country FR indoor ecm authmode WPA2/802.11i privacy ON
	deftxkey UNDEF AES-CCM 2:128-bit txpower 30 bmiss 7 scanvalid 60
	protmode CTS ampdulimit 64k ampdudensity 8 shortgi -stbctx stbcrx
	-ldpc wme burst roaming MANUAL
	media: IEEE 802.11 Wireless Ethernet MCS mode 11ng
	status: associated
	nd6 options=29&lt;PERFORMNUD,IFDISABLED,AUTO_LINKLOCAL&gt;</pre><p>Replace <em class="replaceable"><code>wlan0</code></em> to match the
	  system's wireless interface name.  The
	  <code class="literal">ether</code> line will contain the
	  <acronym class="acronym">MAC</acronym> address of the specified interface.
	  Now, change the <acronym class="acronym">MAC</acronym> address of the
	  Ethernet interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>re0</code></em> ether <em class="replaceable"><code>b8:ee:65:5b:32:59</code></em></code></strong></pre><p>Bring the wireless interface up (replacing
	  <em class="replaceable"><code>FR</code></em> with your own 2-letter country
	  code), but do not set an <acronym class="acronym">IP</acronym>
	  address:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> country <em class="replaceable"><code>FR</code></em> ssid <em class="replaceable"><code>my_router</code></em> up</code></strong></pre><p>Make sure the <em class="replaceable"><code>re0</code></em> interface
	  is up, then create the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interface with
	  <em class="replaceable"><code>re0</code></em> as master with failover to
	  <em class="replaceable"><code>wlan0</code></em>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>re0</code></em> up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code> up laggproto failover laggport <em class="replaceable"><code>re0</code></em> laggport <em class="replaceable"><code>wlan0</code></em></code></strong></pre><p>The virtual interface should look something like
	  this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <code class="literal">lagg<em class="replaceable"><code>0</code></em></code></code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether b8:ee:65:5b:32:59
        laggproto failover lagghash l2,l3,l4
        laggport: re0 flags=5&lt;MASTER,ACTIVE&gt;
        laggport: wlan0 flags=0&lt;&gt;
        groups: lagg
        media: Ethernet autoselect
        status: active</pre><p>Then, start the <acronym class="acronym">DHCP</acronym> client to
	  obtain an <acronym class="acronym">IP</acronym> address:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dhclient <code class="literal">lagg<em class="replaceable"><code>0</code></em></code></code></strong></pre><p>To retain this configuration across reboots, add the
	  following entries to
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ifconfig_<em class="replaceable"><code>re0</code></em>="ether <em class="replaceable"><code>b8:ee:65:5b:32:59</code></em>"
wlans_<em class="replaceable"><code>ath0</code></em>="wlan0"
ifconfig_wlan0="WPA"
create_args_wlan0="country <em class="replaceable"><code>FR</code></em>"
cloned_interfaces="<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>"
ifconfig_<code class="literal">lagg<em class="replaceable"><code>0</code></em></code>="up laggproto failover laggport <em class="replaceable"><code>re0</code></em> laggport wlan0 DHCP"</pre></div></div><br class="example-break" /></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-diskless"></a>31.8. Diskless Operation with <acronym class="acronym">PXE</acronym></h2></div><div><span class="authorgroup">Updated by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jean-François</span> <span class="surname">Dockès</span></span>. </span></div><div><span class="authorgroup">Reorganized and enhanced by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Alex</span> <span class="surname">Dupre</span></span>. </span></div></div></div><a id="idp72409464" class="indexterm"></a><a id="idp72410232" class="indexterm"></a><p>The <span class="trademark">Intel</span>® Preboot eXecution Environment
      (<acronym class="acronym">PXE</acronym>) allows an operating system to boot over
      the network.  For example, a FreeBSD system can boot over the
      network and operate without a local disk, using file systems
      mounted from an <acronym class="acronym">NFS</acronym> server.
      <acronym class="acronym">PXE</acronym> support is usually available in the
      <acronym class="acronym">BIOS</acronym>.  To use <acronym class="acronym">PXE</acronym> when the
      machine starts, select the <code class="literal">Boot from network</code>
      option in the <acronym class="acronym">BIOS</acronym> setup or type a function
      key during system initialization.</p><p>In order to provide the files needed for an operating system
      to boot over the network, a <acronym class="acronym">PXE</acronym> setup also
      requires properly configured <acronym class="acronym">DHCP</acronym>,
      <acronym class="acronym">TFTP</acronym>, and <acronym class="acronym">NFS</acronym> servers,
      where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Initial parameters, such as an <acronym class="acronym">IP</acronym>
	  address, executable boot filename and location, server name,
	  and root path are obtained from the
	  <acronym class="acronym">DHCP</acronym> server.</p></li><li class="listitem"><p>The operating system loader file is booted using
	  <acronym class="acronym">TFTP</acronym>.</p></li><li class="listitem"><p>The file systems are loaded using
	  <acronym class="acronym">NFS</acronym>.</p></li></ul></div><p>When a computer <acronym class="acronym">PXE</acronym> boots, it receives
      information over <acronym class="acronym">DHCP</acronym> about where to obtain
      the initial boot loader file.  After the host computer receives
      this information, it downloads the boot loader via
      <acronym class="acronym">TFTP</acronym> and then executes the boot loader.  In
      FreeBSD, the boot loader file is
      <code class="filename">/boot/pxeboot</code>.  After
      <code class="filename">/boot/pxeboot</code> executes, the FreeBSD kernel is
      loaded and the rest of the FreeBSD bootup sequence proceeds, as
      described in <a class="xref" href="#boot" title="Chapter 12. The FreeBSD Booting Process">Chapter 12, <em>The FreeBSD Booting Process</em></a>.</p><p>This section describes how to configure these services on a
      FreeBSD system so that other systems can <acronym class="acronym">PXE</acronym>
      boot into FreeBSD.  Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=diskless&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">diskless</span>(8)</span></a> for more
      information.</p><div xmlns="" class="caution"><h3 class="admontitle">Caution: </h3><p xmlns="http://www.w3.org/1999/xhtml">As described, the system providing these services is
	insecure.  It should live in a protected area of a network and
	be untrusted by other hosts.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-pxe-nfs"></a>31.8.1. Setting Up the <acronym class="acronym">PXE</acronym>
	  Environment</h3></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Craig</span> <span class="surname">Rodrigues</span></span>. </span></div></div></div><p>The steps shown in this section configure the built-in
	<acronym class="acronym">NFS</acronym> and <acronym class="acronym">TFTP</acronym> servers.
	The next section demonstrates how to install and configure the
	<acronym class="acronym">DHCP</acronym> server.  In this example, the
	directory which will contain the files used by
	<acronym class="acronym">PXE</acronym> users is
	<code class="filename">/b/tftpboot/FreeBSD/install</code>.  It is
	important that this directory exists and that the same
	directory name is set in both
	<code class="filename">/etc/inetd.conf</code> and
	<code class="filename">/usr/local/etc/dhcpd.conf</code>.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create the root directory which will contain a FreeBSD
	    installation to be <acronym class="acronym">NFS</acronym> mounted:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>export NFSROOTDIR=/b/tftpboot/FreeBSD/install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p ${NFSROOTDIR}</code></strong></pre></li><li class="step"><p>Enable the <acronym class="acronym">NFS</acronym> server by adding
	    this line to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">nfs_server_enable="YES"</pre></li><li class="step"><p>Export the diskless root directory via
	    <acronym class="acronym">NFS</acronym> by adding the following to
	    <code class="filename">/etc/exports</code>:</p><pre class="programlisting">/b -ro -alldirs -maproot=root</pre></li><li class="step"><p>Start the <acronym class="acronym">NFS</acronym> server:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service nfsd start</code></strong></pre></li><li class="step"><p>Enable <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> by adding the following line to
	    <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">inetd_enable="YES"</pre></li><li class="step"><p>Uncomment the following line in
	    <code class="filename">/etc/inetd.conf</code> by making sure it
	    does not start with a <code class="literal">#</code> symbol:</p><pre class="programlisting">tftp dgram udp wait root /usr/libexec/tftpd tftpd -l -s /b/tftpboot</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some <acronym class="acronym">PXE</acronym> versions require the
	      <acronym class="acronym">TCP</acronym> version of
	      <acronym class="acronym">TFTP</acronym>.  In this case, uncomment the
	      second <code class="literal">tftp</code> line which contains
	      <code class="literal">stream tcp</code>.</p></div></li><li class="step"><p>Start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service inetd start</code></strong></pre></li><li class="step"><p>Install the base system into
		<code class="filename">${NFSROOTDIR}</code>, either by
		decompressing the official archives or by rebuilding
		the FreeBSD kernel and userland (refer to
		<a class="xref" href="#makeworld" title="23.5. Updating FreeBSD from Source">Section 23.5, &#8220;Updating FreeBSD from Source&#8221;</a> for more detailed
		instructions, but do not forget to add
		<code class="option">DESTDIR=<em class="replaceable"><code>${NFSROOTDIR}</code></em></code>
		when running the
		<code class="command">make installkernel</code> and
		<code class="command">make installworld</code> commands.</p></li><li class="step"><p>Test that the <acronym class="acronym">TFTP</acronym> server works and
	    can download the boot loader which will be obtained via
	    <acronym class="acronym">PXE</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tftp localhost</code></strong>
tftp&gt; <strong class="userinput"><code>get FreeBSD/install/boot/pxeboot</code></strong>
Received 264951 bytes in 0.1 seconds</pre></li><li class="step"><p>Edit <code class="filename">${NFSROOTDIR}/etc/fstab</code> and
	    create an entry to mount the root file system over
	    <acronym class="acronym">NFS</acronym>:</p><pre class="programlisting"># Device                                         Mountpoint    FSType   Options  Dump Pass
<em class="replaceable"><code>myhost.example.com</code></em>:/b/tftpboot/FreeBSD/install       /         nfs      ro        0    0</pre><p>Replace <em class="replaceable"><code>myhost.example.com</code></em>
	    with the hostname or <acronym class="acronym">IP</acronym> address of the
	    <acronym class="acronym">NFS</acronym> server.  In this example, the root
	    file system is mounted read-only in order to prevent
	    <acronym class="acronym">NFS</acronym> clients from potentially deleting
	    the contents of the root file system.</p></li><li class="step"><p>Set the root password in the <acronym class="acronym">PXE</acronym>
	    environment for client machines which are
	    <acronym class="acronym">PXE</acronym> booting :</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chroot ${NFSROOTDIR}</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>passwd</code></strong></pre></li><li class="step"><p>If needed, enable <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> root logins for client
	    machines which are <acronym class="acronym">PXE</acronym> booting by
	    editing
	    <code class="filename">${NFSROOTDIR}/etc/ssh/sshd_config</code> and
	    enabling <code class="literal">PermitRootLogin</code>.  This option
	    is documented in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sshd_config&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sshd_config</span>(5)</span></a>.</p></li><li class="step"><p>Perform any other needed customizations of the
	    <acronym class="acronym">PXE</acronym> environment in
	    <code class="filename">${NFSROOTDIR}</code>.  These customizations
	    could include things like installing packages or editing
	    the password file with <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vipw&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vipw</span>(8)</span></a>.</p></li></ol></div><p>When booting from an <acronym class="acronym">NFS</acronym> root volume,
	<code class="filename">/etc/rc</code> detects the
	<acronym class="acronym">NFS</acronym> boot and runs
	<code class="filename">/etc/rc.initdiskless</code>.  In this case,
	<code class="filename">/etc</code> and <code class="filename">/var</code> need
	to be memory backed file systems so that these directories are
	writable but the <acronym class="acronym">NFS</acronym> root directory is
	read-only:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chroot ${NFSROOTDIR}</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p conf/base</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar -c -v -f conf/base/etc.cpio.gz --format cpio --gzip etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar -c -v -f conf/base/var.cpio.gz --format cpio --gzip var</code></strong></pre><p>When the system boots, memory file systems for
	<code class="filename">/etc</code> and <code class="filename">/var</code> will
	be created and mounted and the contents of the
	<code class="filename">cpio.gz</code> files will be copied into
	them.  By default, these file systems have a maximum capacity
	of 5 megabytes.  If your archives do not fit, which is
	usually the case for <code class="filename">/var</code> when binary
	packages have been installed, request a larger size by putting
	the number of 512 byte sectors needed (e.g., 5 megabytes
	is 10240 sectors) in
	<code class="filename">${NFSROOTDIR}/conf/base/etc/md_size</code> and
	<code class="filename">${NFSROOTDIR}/conf/base/var/md_size</code>
	files for <code class="filename">/etc</code> and
	<code class="filename">/var</code> file systems respectively.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-pxe-setting-up-dhcp"></a>31.8.2. Configuring the <acronym class="acronym">DHCP</acronym> Server</h3></div></div></div><a id="idp72195576" class="indexterm"></a><p>The <acronym class="acronym">DHCP</acronym> server does not need to be the
	same machine as the <acronym class="acronym">TFTP</acronym> and
	<acronym class="acronym">NFS</acronym> server, but it needs to be accessible
	in the network.</p><p><acronym class="acronym">DHCP</acronym> is not part of the FreeBSD base
	system but can be installed using the
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp43-server/pkg-descr">net/isc-dhcp43-server</a> port or
	package.</p><p>Once installed, edit the configuration file,
	<code class="filename">/usr/local/etc/dhcpd.conf</code>.  Configure
	the <code class="literal">next-server</code>,
	<code class="literal">filename</code>, and
	<code class="literal">root-path</code> settings as seen in this
	example:</p><pre class="programlisting">subnet 192.168.0.0 netmask 255.255.255.0 {
   range 192.168.0.2 192.168.0.3 ;
   option subnet-mask 255.255.255.0 ;
   option routers 192.168.0.1 ;
   option broadcast-address 192.168.0.255 ;
   option domain-name-servers 192.168.35.35, 192.168.35.36 ;
   option domain-name "example.com";

   # IP address of TFTP server
   next-server <em class="replaceable"><code>192.168.0.1</code></em> ;

   # path of boot loader obtained via tftp
   filename "<em class="replaceable"><code>FreeBSD/install/boot/pxeboot</code></em>" ;

   # pxeboot boot loader will try to NFS mount this directory for root FS
   option root-path "<em class="replaceable"><code>192.168.0.1:/b/tftpboot/FreeBSD/install/</code></em>" ;

}</pre><p>The <code class="literal">next-server</code> directive is used to
	specify the <acronym class="acronym">IP</acronym> address of the
	<acronym class="acronym">TFTP</acronym> server.</p><p>The <code class="literal">filename</code> directive defines the path
	to <code class="filename">/boot/pxeboot</code>.  A relative filename is
	used, meaning that <code class="filename">/b/tftpboot</code> is not
	included in the path.</p><p>The <code class="literal">root-path</code> option defines the path
	to the <acronym class="acronym">NFS</acronym> root file system.</p><p>Once the edits are saved, enable <acronym class="acronym">DHCP</acronym>
	at boot time by adding the following line to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">dhcpd_enable="YES"</pre><p>Then start the <acronym class="acronym">DHCP</acronym> service:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service isc-dhcpd start</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72223096"></a>31.8.3. Debugging <acronym class="acronym">PXE</acronym> Problems</h3></div></div></div><p>Once all of the services are configured and started,
	<acronym class="acronym">PXE</acronym> clients should be able to
	automatically load FreeBSD over the network.  If a particular
	client is unable to connect, when that client machine boots
	up, enter the <acronym class="acronym">BIOS</acronym> configuration menu and
	confirm that it is set to boot from the network.</p><p>This section describes some troubleshooting tips for
	isolating the source of the configuration problem should no
	clients be able to <acronym class="acronym">PXE</acronym> boot.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Use the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/wireshark/pkg-descr">net/wireshark</a> package or
	    port to debug the network traffic involved during the
	    <acronym class="acronym">PXE</acronym> booting process, which is
	    illustrated in the diagram below.</p><div class="figure"><a id="idp72539000"></a><div class="figure-title">Figure 31.1. <acronym class="acronym">PXE</acronym> Booting Process with
	      <acronym class="acronym">NFS</acronym> Root Mount</div><div class="figure-contents"><div class="mediaobject"><img border="0" usemap="#idp72540792" src="advanced-networking/pxe-nfs.png" alt="PXE Booting Process with NFS Root Mount" /><map name="idp72540792" id="idp72540792"><area shape="rect" coords="155,98,179,67" /><area shape="rect" coords="190,162,210,132" /><area shape="rect" coords="258,173,276,149" /><area shape="rect" coords="259,230,276,204" /><area shape="rect" coords="168,295,190,264" /></map><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></p></td><td valign="top" align="left"><p>Client broadcasts a
		      <code class="literal">DHCPDISCOVER</code> message.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></p></td><td valign="top" align="left"><p>The <acronym class="acronym">DHCP</acronym> server responds
		      with the <acronym class="acronym">IP</acronym> address,
		      <code class="literal">next-server</code>,
		      <code class="literal">filename</code>, and
		      <code class="literal">root-path</code> values.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></p></td><td valign="top" align="left"><p>The client sends a <acronym class="acronym">TFTP</acronym>
		      request to <code class="literal">next-server</code>,
		      asking to retrieve
		      <code class="literal">filename</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></p></td><td valign="top" align="left"><p>The <acronym class="acronym">TFTP</acronym> server responds
		      and sends <code class="literal">filename</code> to
		      client.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></p></td><td valign="top" align="left"><p>The client executes
		      <code class="literal">filename</code>, which is
		      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a>, which then loads the kernel.
		      When the kernel executes, the root file system
		      specified by <code class="literal">root-path</code> is
		      mounted over <acronym class="acronym">NFS</acronym>.</p></td></tr></table></div></div></div></div><br class="figure-break" /></li><li class="step"><p>On the
	    <acronym class="acronym">TFTP</acronym> server, read
	    <code class="filename">/var/log/xferlog</code> to ensure that
	    <code class="filename">pxeboot</code> is being retrieved from
	    the correct location.  To test this example
	    configuration:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tftp 192.168.0.1</code></strong>
tftp&gt; <strong class="userinput"><code>get FreeBSD/install/boot/pxeboot</code></strong>
Received 264951 bytes in 0.1 seconds</pre><p>The <code class="literal">BUGS</code> sections in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tftpd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tftpd</span>(8)</span></a>
	    and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=tftp&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">tftp</span>(1)</span></a> document some limitations with
	    <acronym class="acronym">TFTP</acronym>.</p></li><li class="step"><p>Make sure that the root file system can be mounted
	    via <acronym class="acronym">NFS</acronym>.  To test this example
	    configuration:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t nfs 192.168.0.1:/b/tftpboot/FreeBSD/install /mnt</code></strong></pre></li></ol></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ipv6"></a>31.9. <acronym class="acronym">IPv6</acronym></h2></div><div><span class="authorgroup">Originally Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Aaron</span> <span class="surname">Kaplan</span></span>. </span></div><div><span class="authorgroup">Restructured and Added by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Extended by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Brad</span> <span class="surname">Davis</span></span>. </span></div></div></div><p><acronym class="acronym">IPv6</acronym> is the new version of the well known
      <acronym class="acronym">IP</acronym> protocol, also known as
      <acronym class="acronym">IPv4</acronym>.  <acronym class="acronym">IPv6</acronym> provides
      several advantages over <acronym class="acronym">IPv4</acronym> as well as many
      new features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Its 128-bit address space allows for
	  340,282,366,920,938,463,463,374,607,431,768,211,456
	  addresses.  This addresses the <acronym class="acronym">IPv4</acronym>
	  address shortage and eventual <acronym class="acronym">IPv4</acronym>
	  address exhaustion.</p></li><li class="listitem"><p>Routers only store network aggregation addresses in
	  their routing tables, thus reducing the average space of a
	  routing table to 8192 entries.  This addresses the
	  scalability issues associated with <acronym class="acronym">IPv4</acronym>,
	  which required every allocated block of
	  <acronym class="acronym">IPv4</acronym> addresses to be exchanged between
	  Internet routers, causing their routing tables to become too
	  large to allow efficient routing.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Address autoconfiguration (<a class="link" href="http://www.ietf.org/rfc/rfc2462.txt" target="_top">RFC2462</a>).</p></li><li class="listitem"><p>Mandatory multicast addresses.</p></li><li class="listitem"><p>Built-in <acronym class="acronym">IPsec</acronym> (<acronym class="acronym">IP</acronym>
	  security).</p></li><li class="listitem"><p>Simplified header structure.</p></li><li class="listitem"><p>Support for mobile <acronym class="acronym">IP</acronym>.</p></li><li class="listitem"><p><acronym class="acronym">IPv6</acronym>-to-<acronym class="acronym">IPv4</acronym>
	  transition mechanisms.</p></li></ul></div><p>FreeBSD includes the <a class="link" href="http://www.kame.net/" target="_top">http://www.kame.net/</a>
      <acronym class="acronym">IPv6</acronym> reference implementation and comes
      with everything needed to use <acronym class="acronym">IPv6</acronym>.  This
      section focuses on getting <acronym class="acronym">IPv6</acronym> configured
      and running.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72608376"></a>31.9.1. Background on <acronym class="acronym">IPv6</acronym> Addresses</h3></div></div></div><p>There are three different types of <acronym class="acronym">IPv6</acronym>
	addresses:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Unicast</span></dt><dd><p>A packet sent to a unicast address arrives at the
	      interface belonging to the address.</p></dd><dt><span class="term">Anycast</span></dt><dd><p>These addresses are syntactically indistinguishable
	      from unicast addresses but they address a group of
	      interfaces.  The packet destined for an anycast address
	      will arrive at the nearest router interface.  Anycast
	      addresses are only used by routers.</p></dd><dt><span class="term">Multicast</span></dt><dd><p>These addresses identify a group of interfaces.  A
	      packet destined for a multicast address will arrive at
	      all interfaces belonging to the multicast group.  The
	      <acronym class="acronym">IPv4</acronym> broadcast address, usually
	      <code class="systemitem">xxx.xxx.xxx.255</code>, is
	      expressed by multicast addresses in
	      <acronym class="acronym">IPv6</acronym>.</p></dd></dl></div><p>When reading an <acronym class="acronym">IPv6</acronym> address, the
	canonical form is represented as
	<code class="systemitem">x:x:x:x:x:x:x:x</code>, where each
	<code class="literal">x</code> represents a 16 bit hex value.  An
	example is
	<code class="systemitem">FEBC:A574:382B:23C1:AA49:4592:4EFE:9982</code>.</p><p>Often, an address will have long substrings of all zeros.
	A <code class="literal">::</code> (double colon) can be used to replace
	one substring per address.  Also, up to three leading
	<code class="literal">0</code>s per hex value can be omitted.  For
	example, <code class="systemitem">fe80::1</code> corresponds to the
	canonical form
	<code class="systemitem">fe80:0000:0000:0000:0000:0000:0000:0001</code>.</p><p>A third form is to write the last 32 bits using the well
	known <acronym class="acronym">IPv4</acronym> notation.  For example,
	<code class="systemitem">2002::10.0.0.1</code> corresponds to the
	hexadecimal canonical representation
	<code class="systemitem">2002:0000:0000:0000:0000:0000:0a00:0001</code>,
	which in turn is equivalent to
	<code class="systemitem">2002::a00:1</code>.</p><p>To view a FreeBSD system's <acronym class="acronym">IPv6 </acronym> address,
	use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig</code></strong></pre><pre class="programlisting">rl0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500
         inet 10.0.0.10 netmask 0xffffff00 broadcast 10.0.0.255
         inet6 fe80::200:21ff:fe03:8e1%rl0 prefixlen 64 scopeid 0x1
         ether 00:00:21:03:08:e1
         media: Ethernet autoselect (100baseTX )
         status: active</pre><p>In this example, the <code class="filename">rl0</code> interface is
	using <code class="systemitem">fe80::200:21ff:fe03:8e1%rl0</code>, an
	auto-configured link-local address which was automatically
	generated from the <acronym class="acronym">MAC</acronym> address.</p><p>Some <acronym class="acronym">IPv6</acronym> addresses are reserved.  A
	summary of these reserved addresses is seen in <a class="xref" href="#reservedip6" title="Table 31.3. Reserved IPv6 Addresses">Table 31.3, &#8220;Reserved <acronym class="acronym">IPv6</acronym> Addresses&#8221;</a>:</p><div class="table"><a id="reservedip6"></a><div class="table-title">Table 31.3. Reserved <acronym class="acronym">IPv6</acronym> Addresses</div><div class="table-contents"><table class="table" summary="Reserved IPv6 Addresses" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th><acronym class="acronym">IPv6</acronym> address</th><th>Prefixlength (Bits)</th><th>Description</th><th>Notes</th></tr></thead><tbody><tr><td><code class="systemitem">::</code></td><td>128 bits</td><td>unspecified</td><td>Equivalent to <code class="systemitem">0.0.0.0</code> in
		<acronym class="acronym">IPv4</acronym>.</td></tr><tr><td><code class="systemitem">::1</code></td><td>128 bits</td><td>loopback address</td><td>Equivalent to <code class="systemitem">127.0.0.1</code> in
		<acronym class="acronym">IPv4</acronym>.</td></tr><tr><td><code class="systemitem">::00:xx:xx:xx:xx</code></td><td>96 bits</td><td>embedded <acronym class="acronym">IPv4</acronym></td><td>The lower 32 bits are the compatible
		<acronym class="acronym">IPv4</acronym> address.</td></tr><tr><td><code class="systemitem">::ff:xx:xx:xx:xx</code></td><td>96 bits</td><td><acronym class="acronym">IPv4</acronym> mapped
		<acronym class="acronym">IPv6</acronym> address</td><td>The lower 32 bits are the <acronym class="acronym">IPv4</acronym>
		address for hosts which do not support
		<acronym class="acronym">IPv6</acronym>.</td></tr><tr><td><code class="systemitem">fe80::/10</code></td><td>10 bits</td><td>link-local</td><td>Equivalent to 169.254.0.0/16 in
		<acronym class="acronym">IPv4</acronym>.</td></tr><tr><td><code class="systemitem">fc00::/7</code></td><td>7 bits</td><td>unique-local</td><td>Unique local addresses are intended for local
		communication and are only routable within a set of
		cooperating sites.</td></tr><tr><td><code class="systemitem">ff00::</code></td><td>8 bits</td><td>multicast</td><td> </td></tr><tr><td><code class="systemitem">2000::-3fff:: </code></td><td>3 bits</td><td>global unicast</td><td>All global unicast addresses are assigned from
		this pool.  The first 3 bits are
		<code class="literal">001</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p>For further information on the structure of
	<acronym class="acronym">IPv6</acronym> addresses, refer to <a class="link" href="http://www.ietf.org/rfc/rfc3513.txt" target="_top">RFC3513</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72675576"></a>31.9.2. Configuring <acronym class="acronym">IPv6</acronym></h3></div></div></div><p>To configure a FreeBSD system as an <acronym class="acronym">IPv6</acronym>
	client, add these two lines to
	<code class="filename">rc.conf</code>:</p><pre class="programlisting">ifconfig_<em class="replaceable"><code>rl0</code></em>_ipv6="inet6 accept_rtadv"
rtsold_enable="YES"</pre><p>The first line enables the specified interface to receive
	router advertisement messages.  The second line enables the
	router solicitation daemon, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rtsol&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rtsol</span>(8)</span></a>.</p><p>If the interface needs a statically assigned
	<acronym class="acronym">IPv6</acronym> address, add an entry to specify the
	static address and associated prefix length:</p><pre class="programlisting">ifconfig_<em class="replaceable"><code>rl0</code></em>_ipv6="inet6 <em class="replaceable"><code>2001:db8:4672:6565:2026:5043:2d42:5344</code></em> prefixlen <em class="replaceable"><code>64</code></em>"</pre><p>To assign a default router, specify its address:</p><pre class="programlisting">ipv6_defaultrouter="<em class="replaceable"><code>2001:db8:4672:6565::1</code></em>"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72687224"></a>31.9.3. Connecting to a Provider</h3></div></div></div><p>In order to connect to other <acronym class="acronym">IPv6</acronym>
	networks, one must have a provider or a tunnel that supports
	<acronym class="acronym">IPv6</acronym>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Contact an Internet Service Provider to see if they
	    offer <acronym class="acronym">IPv6</acronym>.</p></li><li class="listitem"><p><a class="link" href="http://www.tunnelbroker.net" target="_top">Hurricane
	      Electric</a> offers tunnels with end-points all
	    around the globe.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Install the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/freenet6/pkg-descr">net/freenet6</a> package or
	  port for a dial-up connection.</p></div><p>This section demonstrates how to take the directions from
	a tunnel provider and convert them into
	<code class="filename">/etc/rc.conf</code> settings that will persist
	through reboots.</p><p>The first <code class="filename">/etc/rc.conf</code> entry creates
	the generic tunneling interface
	<code class="filename"><em class="replaceable"><code>gif0</code></em></code>:</p><pre class="programlisting">cloned_interfaces="gif<em class="replaceable"><code>0</code></em>"</pre><p>Next, configure that interface with the
	<acronym class="acronym">IPv4</acronym> addresses of the local and remote
	endpoints.  Replace <em class="replaceable"><code>MY_IPv4_ADDR</code></em>
	and <em class="replaceable"><code>REMOTE_IPv4_ADDR</code></em> with the
	actual <acronym class="acronym">IPv4</acronym> addresses:</p><pre class="programlisting">create_args_gif0="tunnel <em class="replaceable"><code>MY_IPv4_ADDR REMOTE_IPv4_ADDR</code></em>"</pre><p>To apply the <acronym class="acronym">IPv6</acronym> address that has been
	assigned for use as the <acronym class="acronym">IPv6</acronym> tunnel
	endpoint, add this line, replacing
	<em class="replaceable"><code>MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR</code></em>
	with the assigned address:</p><pre class="programlisting">ifconfig_gif0_ipv6="inet6 <em class="replaceable"><code>MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR</code></em>"</pre><p>Then, set the default route for the other side of the
	<acronym class="acronym">IPv6</acronym> tunnel.  Replace
	<em class="replaceable"><code>MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR</code></em>
	with the default gateway address assigned by the
	provider:</p><pre class="programlisting">ipv6_defaultrouter="<em class="replaceable"><code>MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR</code></em>"</pre><p>If the FreeBSD system will route <acronym class="acronym">IPv6</acronym>
	packets between the rest of the network and the world, enable
	the gateway using this line:</p><pre class="programlisting">ipv6_gateway_enable="YES"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72712056"></a>31.9.4. Router Advertisement and Host Auto Configuration</h3></div></div></div><p>This section demonstrates how to setup <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rtadvd</span>(8)</span></a> to
	advertise the <acronym class="acronym">IPv6</acronym> default route.</p><p>To enable <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rtadvd</span>(8)</span></a>, add the following to
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">rtadvd_enable="YES"</pre><p>It is important to specify the interface on which to
	do <acronym class="acronym">IPv6</acronym> router advertisement.  For example,
	to tell <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=rtadvd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">rtadvd</span>(8)</span></a> to use
	<code class="filename">rl0</code>:</p><pre class="programlisting">rtadvd_interfaces="rl0"</pre><p>Next, create the configuration file,
	<code class="filename">/etc/rtadvd.conf</code> as seen in this
	example:</p><pre class="programlisting">rl0:\
	:addrs#1:addr="2001:db8:1f11:246::":prefixlen#64:tc=ether:</pre><p>Replace <code class="filename">rl0</code> with the interface
	to be used and <code class="systemitem">2001:db8:1f11:246::</code>
	with the prefix of the allocation.</p><p>For a dedicated <code class="systemitem">/64</code> subnet, nothing else needs
	to be changed.  Otherwise, change the
	<code class="literal">prefixlen#</code> to the correct value.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72722168"></a>31.9.5. <acronym class="acronym">IPv6</acronym> and <acronym class="acronym">IPv6</acronym>
	Address Mapping</h3></div></div></div><p>When <acronym class="acronym">IPv6</acronym> is enabled on a server, there
	may be a need to enable <acronym class="acronym">IPv4</acronym> mapped
	<acronym class="acronym">IPv6</acronym> address communication.  This
	compatibility option allows for <acronym class="acronym">IPv4</acronym>
	addresses to be represented as <acronym class="acronym">IPv6</acronym>
	addresses.  Permitting <acronym class="acronym">IPv6</acronym> applications
	to communicate with <acronym class="acronym">IPv4</acronym> and vice versa
	may be a security issue.</p><p>This option may not be required in most cases and is
	available only for compatibility.  This option will allow
	<acronym class="acronym">IPv6</acronym>-only applications to work with
	<acronym class="acronym">IPv4</acronym> in a dual stack environment.  This
	is most useful for third party applications which may not
	support an <acronym class="acronym">IPv6</acronym>-only environment.  To
	enable this feature,
	add the following to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ipv6_ipv4mapping="YES"</pre><p>Reviewing the information in <acronym class="acronym">RFC</acronym> 3493,
	section 3.6 and 3.7 as well as <acronym class="acronym">RFC</acronym> 4038
	section 4.2 may be useful to some administrators.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="carp"></a>31.10. Common Address Redundancy Protocol
	(<acronym class="acronym">CARP</acronym>)</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Updated by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>. </span></div></div></div><a id="idp72523768" class="indexterm"></a><a id="idp72524664" class="indexterm"></a><p>The Common Address Redundancy Protocol
      (<acronym class="acronym">CARP</acronym>) allows multiple hosts to share the
      same <acronym class="acronym">IP</acronym> address and Virtual Host ID
      (<acronym class="acronym">VHID</acronym>) in order to provide <em class="firstterm">high
      availability</em> for one or more services.  This means
      that one or more hosts can fail, and the other hosts will
      transparently take over so that users do not see a service
      failure.</p><p>In addition to the shared <acronym class="acronym">IP</acronym> address,
      each host has its own <acronym class="acronym">IP</acronym> address for
      management and configuration.  All of the machines that share an
      <acronym class="acronym">IP</acronym> address have the same
      <acronym class="acronym">VHID</acronym>.  The <acronym class="acronym">VHID</acronym> for each
      virtual <acronym class="acronym">IP</acronym> address must be unique across the
      broadcast domain of the network interface.</p><p>High availability using <acronym class="acronym">CARP</acronym> is built
      into FreeBSD, though the steps to configure it vary slightly
      depending upon the FreeBSD version.  This section provides the same
      example configuration for versions before and equal to or after
      FreeBSD 10.</p><p>This example configures failover support with three hosts,
      all with unique <acronym class="acronym">IP</acronym> addresses, but providing
      the same web content.  It has two different masters named
      <code class="systemitem">hosta.example.org</code> and
      <code class="systemitem">hostb.example.org</code>, with a shared backup
      named <code class="systemitem">hostc.example.org</code>.</p><p>These machines are load balanced with a Round Robin
      <acronym class="acronym">DNS</acronym> configuration.  The master and backup
      machines are configured identically except for their hostnames
      and management <acronym class="acronym">IP</acronym> addresses.  These servers
      must have the same configuration and run the same services.
      When the failover occurs, requests to the service on the shared
      <acronym class="acronym">IP</acronym> address can only be answered correctly if
      the backup server has access to the same content.  The backup
      machine has two additional <acronym class="acronym">CARP</acronym> interfaces,
      one for each of the master content server's
      <acronym class="acronym">IP</acronym> addresses.  When a failure occurs, the
      backup server will pick up the failed master machine's
      <acronym class="acronym">IP</acronym> address.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="carp-10x"></a>31.10.1. Using <acronym class="acronym">CARP</acronym> on FreeBSD 10 and
	Later</h3></div></div></div><p>Enable boot-time support for <acronym class="acronym">CARP</acronym> by
	adding an entry for the <code class="filename">carp.ko</code> kernel
	module in <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">carp_load="YES"</pre><p>To load the module now without rebooting:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload carp</code></strong></pre><p>For users who prefer to use a custom kernel, include the
	following line in the custom kernel configuration file and
	compile the kernel as described in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>:</p><pre class="programlisting">device	carp</pre><p>The hostname, management <acronym class="acronym">IP</acronym> address and
	subnet mask, shared <acronym class="acronym">IP</acronym> address, and
	<acronym class="acronym">VHID</acronym> are all set by adding entries to
	<code class="filename">/etc/rc.conf</code>.  This example is for
	<code class="systemitem">hosta.example.org</code>:</p><pre class="programlisting">hostname="<em class="replaceable"><code>hosta.example.org</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>="inet <em class="replaceable"><code>192.168.1.3</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>_alias0="inet vhid <em class="replaceable"><code>1</code></em> pass <em class="replaceable"><code>testpass</code></em> alias <em class="replaceable"><code>192.168.1.50</code></em>/32"</pre><p>The next set of entries are for
	<code class="systemitem">hostb.example.org</code>.  Since it
	represents a second master, it uses a different shared
	<acronym class="acronym">IP</acronym> address and <acronym class="acronym">VHID</acronym>.
	However, the passwords specified with <code class="option">pass</code>
	must be identical as <acronym class="acronym">CARP</acronym> will only listen
	to and accept advertisements from machines with the correct
	password.</p><pre class="programlisting">hostname="<em class="replaceable"><code>hostb.example.org</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>="inet <em class="replaceable"><code>192.168.1.4</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>_alias0="inet vhid <em class="replaceable"><code>2</code></em> pass <em class="replaceable"><code>testpass</code></em> alias <em class="replaceable"><code>192.168.1.51</code></em>/32"</pre><p>The third machine,
	<code class="systemitem">hostc.example.org</code>, is configured to
	handle failover from either master.  This machine is
	configured with two <acronym class="acronym">CARP</acronym>
	<acronym class="acronym">VHID</acronym>s, one to handle the virtual
	<acronym class="acronym">IP</acronym> address for each of the master hosts.
	The <acronym class="acronym">CARP</acronym> advertising skew,
	<code class="option">advskew</code>, is set to ensure that the backup
	host advertises later than the master, since
	<code class="option">advskew</code> controls the order of precedence when
	there are multiple backup servers.</p><pre class="programlisting">hostname="hostc.example.org"
ifconfig_<em class="replaceable"><code>em0</code></em>="inet <em class="replaceable"><code>192.168.1.5</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>_alias0="inet vhid <em class="replaceable"><code>1</code></em> advskew <em class="replaceable"><code>100</code></em> pass <em class="replaceable"><code>testpass</code></em> alias <em class="replaceable"><code>192.168.1.50</code></em>/32"
ifconfig_<em class="replaceable"><code>em0</code></em>_alias1="inet vhid <em class="replaceable"><code>2</code></em> advskew <em class="replaceable"><code>100</code></em> pass <em class="replaceable"><code>testpass</code></em> alias <em class="replaceable"><code>192.168.1.51</code></em>/32"</pre><p>Having two <acronym class="acronym">CARP</acronym>
	<acronym class="acronym">VHID</acronym>s configured means that
	<code class="systemitem">hostc.example.org</code> will notice if
	either of the master servers becomes unavailable.  If a master
	fails to advertise before the backup server, the backup server
	will pick up the shared <acronym class="acronym">IP</acronym> address until
	the master becomes available again.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If the original master server becomes available again,
	  <code class="systemitem">hostc.example.org</code>  will not release
	  the virtual <acronym class="acronym">IP</acronym> address back to it
	  automatically.  For this to happen, preemption has to be
	  enabled.  The feature is disabled by default,
	  it is controlled via the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variable
	  <code class="varname">net.inet.carp.preempt</code>.  The administrator
	  can force the backup server to return the
	  <acronym class="acronym">IP</acronym> address to the master:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig em0 vhid 1 state backup</code></strong></pre></div><p>Once the configuration is complete, either restart
	networking or reboot each system.  High availability is now
	enabled.</p><p><acronym class="acronym">CARP</acronym> functionality can be controlled
	via several <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> variables documented in the
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=carp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">carp</span>(4)</span></a> manual pages.  Other actions can be triggered
	from <acronym class="acronym">CARP</acronym> events by using
	<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="carp-9x"></a>31.10.2. Using <acronym class="acronym">CARP</acronym> on FreeBSD 9 and
	Earlier</h3></div></div></div><p>The configuration for these versions of FreeBSD is similar to
	the one described in the previous section, except that a
	<acronym class="acronym">CARP</acronym> device must first be created and
	referred to in the configuration.</p><p>Enable boot-time support for <acronym class="acronym">CARP</acronym> by
	loading the <code class="filename">if_carp.ko</code> kernel module in
	<code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">if_carp_load="YES"</pre><p>To load the module now without rebooting:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload carp</code></strong></pre><p>For users who prefer to use a custom kernel, include the
	following line in the custom kernel configuration file and
	compile the kernel as described in <a class="xref" href="#kernelconfig" title="Chapter 8. Configuring the FreeBSD Kernel">Chapter 8, <em>Configuring the FreeBSD Kernel</em></a>:</p><pre class="programlisting">device	carp</pre><p>Next, on each host, create a <acronym class="acronym">CARP</acronym>
	device:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig carp0 create</code></strong></pre><p>Set the hostname, management <acronym class="acronym">IP</acronym>
	address, the shared <acronym class="acronym">IP</acronym> address, and
	<acronym class="acronym">VHID</acronym> by adding the required lines to
	<code class="filename">/etc/rc.conf</code>.  Since a virtual
	<acronym class="acronym">CARP</acronym> device is used instead of an alias,
	the actual subnet mask of <code class="literal">/24</code> is used
	instead of <code class="literal">/32</code>.  Here are the entries for
	<code class="systemitem">hosta.example.org</code>:</p><pre class="programlisting">hostname="<em class="replaceable"><code>hosta.example.org</code></em>"
ifconfig_<em class="replaceable"><code>fxp0</code></em>="inet <em class="replaceable"><code>192.168.1.3</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
cloned_interfaces="carp0"
ifconfig_carp0="vhid <em class="replaceable"><code>1</code></em> pass <em class="replaceable"><code>testpass</code></em> <em class="replaceable"><code>192.168.1.50/24</code></em>"</pre><p>On <code class="systemitem">hostb.example.org</code>:</p><pre class="programlisting">hostname="<em class="replaceable"><code>hostb.example.org</code></em>"
ifconfig_<em class="replaceable"><code>fxp0</code></em>="inet <em class="replaceable"><code>192.168.1.4</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
cloned_interfaces="carp0"
ifconfig_carp0="vhid <em class="replaceable"><code>2</code></em> pass <em class="replaceable"><code>testpass</code></em> <em class="replaceable"><code>192.168.1.51/24</code></em>"</pre><p>The third machine,
	<code class="systemitem">hostc.example.org</code>, is configured to
	handle failover from either of the master hosts:</p><pre class="programlisting">hostname="<em class="replaceable"><code>hostc.example.org</code></em>"
ifconfig_<em class="replaceable"><code>fxp0</code></em>="inet <em class="replaceable"><code>192.168.1.5</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em>"
cloned_interfaces="carp0 carp1"
ifconfig_carp0="vhid <em class="replaceable"><code>1</code></em> advskew <em class="replaceable"><code>100</code></em> pass <em class="replaceable"><code>testpass</code></em> <em class="replaceable"><code>192.168.1.50/24</code></em>"
ifconfig_carp1="vhid <em class="replaceable"><code>2</code></em> advskew <em class="replaceable"><code>100</code></em> pass <em class="replaceable"><code>testpass</code></em> <em class="replaceable"><code>192.168.1.51/24</code></em>"</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Preemption is disabled in the
	  <code class="filename">GENERIC</code> FreeBSD kernel.  If
	  preemption has been enabled with a custom kernel,
	  <code class="systemitem">hostc.example.org</code> may not release
	  the <acronym class="acronym">IP</acronym> address back to the original
	  content server.  The administrator can force the backup
	  server to return the <acronym class="acronym">IP</acronym> address to the
	  master with the command:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig carp0 down &amp;&amp; ifconfig carp0 up</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">This should be done on the <code class="filename">carp</code>
	  interface which corresponds to the correct host.</p></div><p>Once the configuration is complete, either restart
	networking or reboot each system.  High availability is now
	enabled.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-vlan"></a>31.11. VLANs</h2></div></div></div><a id="idp72977784" class="indexterm"></a><a id="idp72978680" class="indexterm"></a><p><acronym class="acronym">VLANs</acronym> are a way of virtually dividing up
      a network into many different subnetworks, also referred
      to as segmenting.  Each segment will have its
      own broadcast domain and be isolated from other
      <acronym class="acronym">VLANs</acronym>.</p><p>On FreeBSD, <acronym class="acronym">VLANs</acronym> must be supported by the
      network card driver.  To see which drivers support vlans, refer
      to the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=vlan&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">vlan</span>(4)</span></a> manual page.</p><p>When configuring a <acronym class="acronym">VLAN</acronym>, a couple pieces
      of information must be known.  First, which network interface?
      Second, what is the <acronym class="acronym">VLAN</acronym> tag?</p><p>To configure <acronym class="acronym">VLANs</acronym> at run time, with a
      <acronym class="acronym">NIC</acronym> of <code class="literal">em0</code> and a
      <acronym class="acronym">VLAN</acronym> tag of <code class="systemitem">5</code> the
      command would look like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>em0.5</code></em> create vlan <em class="replaceable"><code>5</code></em> vlandev <em class="replaceable"><code>em0</code></em> inet 192.168.20.20/24</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">See how the interface name includes the
	<acronym class="acronym">NIC</acronym> driver name and the
	<acronym class="acronym">VLAN</acronym> tag, separated by a period?  This is a
	best practice to make maintaining the <acronym class="acronym">VLAN</acronym>
	configuration easy when many <acronym class="acronym">VLANs</acronym> are
	present on a machine.</p></div><p>To configure <acronym class="acronym">VLANs</acronym> at boot time,
      <code class="filename">/etc/rc.conf</code> must be updated.  To duplicate
      the configuration above, the following will need to be
      added:</p><pre class="programlisting">vlans_<em class="replaceable"><code>em0</code></em>="<em class="replaceable"><code>5</code></em>"
ifconfig_<em class="replaceable"><code>em0</code></em>_<em class="replaceable"><code>5</code></em>="inet 192.168.20.20/24"</pre><p>Additional <acronym class="acronym">VLANs</acronym> may be added, by simply
      adding the tag to the
      <code class="literal">vlans_<em class="replaceable"><code>em0</code></em></code>
      field and adding an additional line configuring the network on
      that <acronym class="acronym">VLAN</acronym> tag's interface.</p><p>It is useful to assign a symbolic name to an interface so
      that when the associated hardware is changed, only a few
      configuration variables need to be updated.  For example,
      security cameras need to be run over VLAN 1 on
      <code class="literal">em0</code>.  Later, if the <code class="literal">em0</code>
      card is replaced with a card that uses the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ixgb&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ixgb</span>(4)</span></a> driver,
      all references to <code class="literal">em0.1</code> will not have to
      change to <code class="literal">ixgb0.1</code>.</p><p>To configure <acronym class="acronym">VLAN</acronym>
      <code class="systemitem">5</code>, on the
      <acronym class="acronym">NIC</acronym> <code class="literal">em0</code>, assign the
      interface name <code class="literal">cameras</code>, and assign the
      interface an IP address of <code class="systemitem"><em class="replaceable"><code>192.168.20.20</code></em></code>
      with a <code class="systemitem">24</code>-bit prefix,
      use this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>em0.5</code></em> create vlan <em class="replaceable"><code>5</code></em> vlandev <em class="replaceable"><code>em0</code></em> name <em class="replaceable"><code>cameras</code></em> inet <em class="replaceable"><code>192.168.20.20/24</code></em></code></strong></pre><p>For an interface named <code class="literal">video</code>, use the
    following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>video.5</code></em> create vlan <em class="replaceable"><code>5</code></em> vlandev <em class="replaceable"><code>video</code></em> name <em class="replaceable"><code>cameras inet 192.168.20.20/24</code></em></code></strong></pre><p>To apply the changes at boot time, add the following lines to
  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">vlans_<em class="replaceable"><code>video</code></em>="<em class="replaceable"><code>cameras</code></em>"
create_args_<em class="replaceable"><code>cameras</code></em>="vlan <em class="replaceable"><code>5</code></em>"
ifconfig_<em class="replaceable"><code>cameras</code></em>="inet <em class="replaceable"><code>192.168.20.20/24</code></em>"</pre></div></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="appendices"></a>Part V. Appendices</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="appendix"><a href="#mirrors">A. Obtaining FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#mirrors-cdrom">A.1. <acronym class="acronym">CD</acronym> and
      <acronym class="acronym">DVD</acronym> Sets</a></span></dt><dt><span class="sect1"><a href="#mirrors-ftp">A.2. <acronym class="acronym">FTP</acronym> Sites</a></span></dt><dt><span class="sect1"><a href="#svn">A.3. Using <span class="application">Subversion</span></a></span></dt><dt><span class="sect1"><a href="#mirrors-rsync">A.4. Using <span class="application">rsync</span></a></span></dt></dl></dd><dt><span class="appendix"><a href="#bibliography">B. Bibliography</a></span></dt><dd><dl><dt><span class="sect1"><a href="#bibliography-freebsd">B.1. Books Specific to FreeBSD</a></span></dt><dt><span class="sect1"><a href="#bibliography-userguides">B.2. Users' Guides</a></span></dt><dt><span class="sect1"><a href="#bibliography-adminguides">B.3. Administrators' Guides</a></span></dt><dt><span class="sect1"><a href="#bibliography-programmers">B.4. Programmers' Guides</a></span></dt><dt><span class="sect1"><a href="#bibliography-osinternals">B.5. Operating System Internals</a></span></dt><dt><span class="sect1"><a href="#bibliography-security">B.6. Security Reference</a></span></dt><dt><span class="sect1"><a href="#bibliography-hardware">B.7. Hardware Reference</a></span></dt><dt><span class="sect1"><a href="#bibliography-history">B.8. <span class="trademark">UNIX</span>® History</a></span></dt><dt><span class="sect1"><a href="#bibliography-journals">B.9. Periodicals, Journals, and Magazines</a></span></dt></dl></dd><dt><span class="appendix"><a href="#eresources">C. Resources on the Internet</a></span></dt><dd><dl><dt><span class="sect1"><a href="#eresources-www">C.1. Websites</a></span></dt><dt><span class="sect1"><a href="#eresources-mail">C.2. Mailing Lists</a></span></dt><dt><span class="sect1"><a href="#eresources-news">C.3. Usenet Newsgroups</a></span></dt><dt><span class="sect1"><a href="#eresources-web">C.4. Official Mirrors</a></span></dt></dl></dd><dt><span class="appendix"><a href="#pgpkeys">D. Open<acronym class="acronym">PGP</acronym> Keys</a></span></dt><dd><dl><dt><span class="sect1"><a href="#pgpkeys-officers">D.1. Officers</a></span></dt></dl></dd></dl></div><div class="appendix"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirrors"></a>Appendix A. Obtaining FreeBSD</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#mirrors-cdrom">A.1. <acronym class="acronym">CD</acronym> and
      <acronym class="acronym">DVD</acronym> Sets</a></span></dt><dt><span class="sect1"><a href="#mirrors-ftp">A.2. <acronym class="acronym">FTP</acronym> Sites</a></span></dt><dt><span class="sect1"><a href="#svn">A.3. Using <span class="application">Subversion</span></a></span></dt><dt><span class="sect1"><a href="#mirrors-rsync">A.4. Using <span class="application">rsync</span></a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mirrors-cdrom"></a>A.1. <acronym class="acronym">CD</acronym> and
      <acronym class="acronym">DVD</acronym> Sets</h2></div></div></div><p>FreeBSD <acronym class="acronym">CD</acronym> and <acronym class="acronym">DVD</acronym> sets
      are available from several online retailers:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><div class="address"><p>FreeBSD Mall, Inc.<br />
	  <span class="street">2420 Sand Creek Rd C-1 #347</span><br />
	  <span class="city">Brentwood</span>, <span class="state">CA</span><br />
	  <span class="postcode">94513</span><br />
	  <span class="country">USA</span><br />
	  Phone: <span class="phone">+1 925 240-6652</span><br />
	  Fax: <span class="fax">+1 925 674-0821</span><br />
	  Email: <code class="email">&lt;<a xmlns="" class="email" href="mailto:info@freebsdmall.com">info@freebsdmall.com</a>&gt;</code><br />
	  WWW: <span class="otheraddr"><a class="otheraddr" href="https://www.freebsdmall.com" target="_top">https://www.freebsdmall.com</a></span><br />
	</p></div></li><li class="listitem"><div class="address"><p>Getlinux<br />
	  <span class="street">78 Rue de la Croix Rochopt</span><br />
	  <span class="city">Épinay-sous-Sénart</span><br />
	  <span class="postcode">91860</span><br />
	  <span class="country">France</span><br />
	  Email: <code class="email">&lt;<a xmlns="" class="email" href="mailto:contact@getlinux.fr">contact@getlinux.fr</a>&gt;</code><br />
	  WWW: <span class="otheraddr"><a class="otheraddr" href="http://www.getlinux.fr" target="_top">http://www.getlinux.fr/</a></span><br />
	</p></div></li><li class="listitem"><div class="address"><p>Dr. Hinner EDV<br />
	  <span class="street">Kochelseestr. 11</span><br />
	  <span class="postcode">D-81371</span> <span class="city">München</span><br />
	  <span class="country">Germany</span><br />
	  Phone: <span class="phone">(0177) 428 419 0</span><br />
	  Email: <code class="email">&lt;<a xmlns="" class="email" href="mailto:infow@hinner.de">infow@hinner.de</a>&gt;</code><br />
	  WWW: <span class="otheraddr"><a class="otheraddr" href="http://www.hinner.de/linux/freebsd.html" target="_top">http://www.hinner.de/linux/freebsd.html</a></span><br />
	</p></div></li><li class="listitem"><div class="address"><p>Linux Center<br />
	  <span class="street">Galernaya Street, 55</span><br />
	  <span class="city">Saint-Petersburg</span><br />
	  <span class="postcode">190000</span><br />
	  <span class="country">Russia</span><br />
	  Phone: <span class="phone">+7-812-309-06-86</span><br />
	  Email: <code class="email">&lt;<a xmlns="" class="email" href="mailto:info@linuxcenter.ru">info@linuxcenter.ru</a>&gt;</code><br />
	  WWW: <span class="otheraddr"><a class="otheraddr" href="http://linuxcenter.ru/shop/freebsd" target="_top">http://linuxcenter.ru/shop/freebsd</a></span><br />
	</p></div></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mirrors-ftp"></a>A.2. <acronym class="acronym">FTP</acronym> Sites</h2></div></div></div><p>The official sources for FreeBSD are available via anonymous
      <acronym class="acronym">FTP</acronym> from a worldwide set of mirror sites.
      The site <code class="uri"><a class="uri" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/</a></code>
      is available via <acronym class="acronym">HTTP</acronym> and
      <acronym class="acronym">FTP</acronym>.  It is made up of many machines operated
      by the project cluster administrators and behind GeoDNS to
      direct users to the closest available mirror.</p><p>Additionally, FreeBSD is available via anonymous
      <acronym class="acronym">FTP</acronym> from the following mirror sites.  When
      obtaining FreeBSD via anonymous <acronym class="acronym">FTP</acronym>,
      please try to use a nearby site.  The mirror sites listed as
      <span class="quote">&#8220;<span class="quote">Primary Mirror Sites</span>&#8221;</span> typically have the entire
      FreeBSD archive (all the currently available versions for each of
      the architectures) but faster download speeds are probably
      available from a site that is in your country or region.  The
      regional sites carry the most recent versions for the most
      popular architecture(s) but might not carry the entire FreeBSD
      archive.  All sites provide access via anonymous
      <acronym class="acronym">FTP</acronym> but some sites also provide access via
      other methods.  The access methods available for each site are
      provided in parentheses after the hostname.</p><p><a class="link" href="#central-ftp">Central Servers</a>, <a class="link" href="#mirrors-primary-ftp">Primary Mirror Sites</a>, <a class="link" href="#mirrors-am-ftp">Armenia</a>, <a class="link" href="#mirrors-au-ftp">Australia</a>, <a class="link" href="#mirrors-at-ftp">Austria</a>, <a class="link" href="#mirrors-br-ftp">Brazil</a>, <a class="link" href="#mirrors-cz-ftp">Czech Republic</a>, <a class="link" href="#mirrors-dk-ftp">Denmark</a>, <a class="link" href="#mirrors-ee-ftp">Estonia</a>, <a class="link" href="#mirrors-fi-ftp">Finland</a>, <a class="link" href="#mirrors-fr-ftp">France</a>, <a class="link" href="#mirrors-de-ftp">Germany</a>, <a class="link" href="#mirrors-gr-ftp">Greece</a>, <a class="link" href="#mirrors-hk-ftp">Hong Kong</a>, <a class="link" href="#mirrors-ie-ftp">Ireland</a>, <a class="link" href="#mirrors-jp-ftp">Japan</a>, <a class="link" href="#mirrors-kr-ftp">Korea</a>, <a class="link" href="#mirrors-lv-ftp">Latvia</a>, <a class="link" href="#mirrors-lt-ftp">Lithuania</a>, <a class="link" href="#mirrors-nl-ftp">Netherlands</a>, <a class="link" href="#mirrors-nz-ftp">New Zealand</a>, <a class="link" href="#mirrors-no-ftp">Norway</a>, <a class="link" href="#mirrors-pl-ftp">Poland</a>, <a class="link" href="#mirrors-ru-ftp">Russia</a>, <a class="link" href="#mirrors-sa-ftp">Saudi Arabia</a>, <a class="link" href="#mirrors-si-ftp">Slovenia</a>, <a class="link" href="#mirrors-za-ftp">South Africa</a>, <a class="link" href="#mirrors-es-ftp">Spain</a>, <a class="link" href="#mirrors-se-ftp">Sweden</a>, <a class="link" href="#mirrors-ch-ftp">Switzerland</a>, <a class="link" href="#mirrors-tw-ftp">Taiwan</a>, <a class="link" href="#mirrors-ua-ftp">Ukraine</a>, <a class="link" href="#mirrors-uk-ftp">United Kingdom</a>, <a class="link" href="#mirrors-us-ftp">USA</a>.</p><p>(as of   UTC)</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><a id="central-ftp"></a>Central Servers</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-primary-ftp"></a>Primary Mirror Sites</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:mirror-admin@FreeBSD.org">mirror-admin@FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp1.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp1.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp3.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp4.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp4.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp4.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp5.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp6.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp7.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp10.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp10.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp10.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp10.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp10.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp10.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp11.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp11.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp13.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp13.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp14.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp14.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp14.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp14.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-am-ftp"></a>Armenia</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@am.FreeBSD.org">hostmaster@am.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp1.am.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp1.am.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp1.am.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp1.am.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-au-ftp"></a>Australia</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@au.FreeBSD.org">hostmaster@au.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.au.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.au.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.au.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.au.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp3.au.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.au.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-at-ftp"></a>Austria</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@at.FreeBSD.org">hostmaster@at.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.at.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.at.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp.at.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.at.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp.at.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.at.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-br-ftp"></a>Brazil</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@br.FreeBSD.org">hostmaster@br.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp2.br.FreeBSD.org/FreeBSD/" target="_top">ftp://ftp2.br.FreeBSD.org/FreeBSD/</a> (ftp / <a class="link" href="http://ftp2.br.FreeBSD.org/" target="_top">http://ftp2.br.FreeBSD.org/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp3.br.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.br.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp4.br.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.br.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-cz-ftp"></a>Czech Republic</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@cz.FreeBSD.org">hostmaster@cz.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp.cz.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp.cz.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.cz.FreeBSD.org/pub/FreeBSD/</a> / rsync / rsyncv6) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.cz.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.cz.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp2.cz.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.cz.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-dk-ftp"></a>Denmark</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@dk.FreeBSD.org">hostmaster@dk.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.dk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.dk.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp.dk.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.dk.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp.dk.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.dk.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-ee-ftp"></a>Estonia</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@ee.FreeBSD.org">hostmaster@ee.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.ee.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.ee.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-fi-ftp"></a>Finland</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@fi.FreeBSD.org">hostmaster@fi.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.fi.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.fi.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-fr-ftp"></a>France</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@fr.FreeBSD.org">hostmaster@fr.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp1.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp1.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp1.fr.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp1.fr.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp3.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp5.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp6.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp7.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp8.fr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp8.fr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-de-ftp"></a>Germany</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:de-bsd-hubs@de.FreeBSD.org">de-bsd-hubs@de.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.de.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.de.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp1.de.FreeBSD.org/freebsd/" target="_top">ftp://ftp1.de.FreeBSD.org/freebsd/</a> (ftp / <a class="link" href="http://www1.de.FreeBSD.org/freebsd/" target="_top">http://www1.de.FreeBSD.org/freebsd/</a> / <a class="link" href="rsync://rsync3.de.FreeBSD.org/freebsd/" target="_top">rsync://rsync3.de.FreeBSD.org/freebsd/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.de.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.de.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp2.de.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.de.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp4.de.FreeBSD.org/FreeBSD/" target="_top">ftp://ftp4.de.FreeBSD.org/FreeBSD/</a> (ftp / <a class="link" href="http://ftp4.de.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.de.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp5.de.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.de.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp7.de.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.de.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp7.de.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp7.de.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp8.de.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp8.de.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-gr-ftp"></a>Greece</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@gr.FreeBSD.org">hostmaster@gr.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.gr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.gr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.gr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.gr.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-hk-ftp"></a>Hong Kong</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.hk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.hk.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-ie-ftp"></a>Ireland</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@ie.FreeBSD.org">hostmaster@ie.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp3.ie.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.ie.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-jp-ftp"></a>Japan</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@jp.FreeBSD.org">hostmaster@jp.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp3.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp4.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp5.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp6.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp7.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp8.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp8.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp9.jp.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp9.jp.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-kr-ftp"></a>Korea</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@kr.FreeBSD.org">hostmaster@kr.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.kr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.kr.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.kr.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.kr.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp2.kr.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.kr.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-lv-ftp"></a>Latvia</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@lv.FreeBSD.org">hostmaster@lv.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.lv.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.lv.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.lv.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.lv.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-lt-ftp"></a>Lithuania</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@lt.FreeBSD.org">hostmaster@lt.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.lt.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.lt.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.lt.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.lt.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-nl-ftp"></a>Netherlands</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@nl.FreeBSD.org">hostmaster@nl.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.nl.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.nl.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.nl.FreeBSD.org/os/FreeBSD/" target="_top">http://ftp.nl.FreeBSD.org/os/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.nl.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.nl.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-nz-ftp"></a>New Zealand</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.nz.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.nz.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.nz.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.nz.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-no-ftp"></a>Norway</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@no.FreeBSD.org">hostmaster@no.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.no.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.no.FreeBSD.org/pub/FreeBSD/</a> (ftp / rsync) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-pl-ftp"></a>Poland</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@pl.FreeBSD.org">hostmaster@pl.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.pl.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.pl.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p>ftp2.pl.FreeBSD.org</p></li></ul></div></dd><dt><span class="term"><a id="mirrors-ru-ftp"></a>Russia</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@ru.FreeBSD.org">hostmaster@ru.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.ru.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.ru.FreeBSD.org/FreeBSD/" target="_top">http://ftp.ru.FreeBSD.org/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.ru.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp2.ru.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.ru.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp4.ru.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp5.ru.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp5.ru.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp5.ru.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp6.ru.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.ru.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-sa-ftp"></a>Saudi Arabia</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:ftpadmin@isu.net.sa">ftpadmin@isu.net.sa</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.isu.net.sa/pub/ftp.freebsd.org/" target="_top">ftp://ftp.isu.net.sa/pub/ftp.freebsd.org/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-si-ftp"></a>Slovenia</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@si.FreeBSD.org">hostmaster@si.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.si.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.si.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-za-ftp"></a>South Africa</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@za.FreeBSD.org">hostmaster@za.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.za.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.za.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.za.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.za.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp4.za.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.za.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-es-ftp"></a>Spain</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@es.FreeBSD.org">hostmaster@es.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.es.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.es.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.es.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.es.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp3.es.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.es.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-se-ftp"></a>Sweden</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@se.FreeBSD.org">hostmaster@se.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.se.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.se.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="rsync://ftp2.se.FreeBSD.org/" target="_top">rsync://ftp2.se.FreeBSD.org/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp3.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.se.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/" target="_top">rsync://ftp4.se.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp6.se.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.se.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp6.se.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp6.se.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-ch-ftp"></a>Switzerland</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@ch.FreeBSD.org">hostmaster@ch.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.ch.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.ch.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.ch.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.ch.FreeBSD.org/pub/FreeBSD/</a>) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-tw-ftp"></a>Taiwan</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@tw.FreeBSD.org">hostmaster@tw.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.tw.FreeBSD.org/pub/FreeBSD/</a> / rsync / rsyncv6) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp2.tw.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp2.tw.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp2.tw.FreeBSD.org/pub/FreeBSD/</a> / rsync / rsyncv6) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp4.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp5.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp6.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp6.tw.FreeBSD.org/" target="_top">http://ftp6.tw.FreeBSD.org/</a> / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp7.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp8.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp8.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp11.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp11.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp11.tw.FreeBSD.org/FreeBSD/" target="_top">http://ftp11.tw.FreeBSD.org/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp12.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp12.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp13.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp13.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp14.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp14.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp15.tw.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp15.tw.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-ua-ftp"></a>Ukraine</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.ua.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.ua.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp.ua.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp.ua.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp6.ua.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.ua.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp6.ua.FreeBSD.org/pub/FreeBSD" target="_top">http://ftp6.ua.FreeBSD.org/pub/FreeBSD</a> / <a class="link" href="rsync://ftp6.ua.FreeBSD.org/FreeBSD/" target="_top">rsync://ftp6.ua.FreeBSD.org/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp7.ua.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp7.ua.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-uk-ftp"></a>United Kingdom</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@uk.FreeBSD.org">hostmaster@uk.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp.uk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.uk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="rsync://ftp2.uk.FreeBSD.org/ftp.freebsd.org/pub/FreeBSD/" target="_top">rsync://ftp2.uk.FreeBSD.org/ftp.freebsd.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp3.uk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp4.uk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp5.uk.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.uk.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd><dt><span class="term"><a id="mirrors-us-ftp"></a>USA</span></dt><dd><p>In case of problems, please contact the hostmaster
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:hostmaster@us.FreeBSD.org">hostmaster@us.FreeBSD.org</a>&gt;</code> for this domain.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="ftp://ftp1.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp1.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp2.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp2.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp3.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp3.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp4.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp4.us.FreeBSD.org/pub/FreeBSD/</a> (ftp / ftpv6 / <a class="link" href="http://ftp4.us.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.us.FreeBSD.org/pub/FreeBSD/</a> / <a class="link" href="http://ftp4.us.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp4.us.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp5.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp5.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp6.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp6.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp8.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp8.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp10.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp10.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp11.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp11.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp13.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp13.us.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp13.us.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp13.us.FreeBSD.org/pub/FreeBSD/</a> / rsync) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp14.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp14.us.FreeBSD.org/pub/FreeBSD/</a> (ftp / <a class="link" href="http://ftp14.us.FreeBSD.org/pub/FreeBSD/" target="_top">http://ftp14.us.FreeBSD.org/pub/FreeBSD/</a>) </p></li><li class="listitem"><p><a class="link" href="ftp://ftp15.us.FreeBSD.org/pub/FreeBSD/" target="_top">ftp://ftp15.us.FreeBSD.org/pub/FreeBSD/</a> (ftp) </p></li></ul></div></dd></dl></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="svn"></a>A.3. Using <span class="application">Subversion</span></h2></div></div></div><a id="idp73434360" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-intro"></a>A.3.1. Introduction</h3></div></div></div><p>As of July 2012, FreeBSD uses
	<span class="application">Subversion</span> as the only version
	control system for storing all of FreeBSD's source code,
	documentation, and the Ports Collection.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">Subversion</span> is generally a
	  developer tool.  Users may prefer to use
	  <code class="command">freebsd-update</code> (<a class="xref" href="#updating-upgrading-freebsdupdate" title="23.2. FreeBSD Update">Section 23.2, &#8220;FreeBSD Update&#8221;</a>) to update
	  the FreeBSD base system, and <code class="command">portsnap</code> (<a class="xref" href="#ports-using" title="4.5. Using the Ports Collection">Section 4.5, &#8220;Using the Ports Collection&#8221;</a>) to update the FreeBSD Ports
	  Collection.</p></div><p>This section demonstrates how to install
	<span class="application">Subversion</span> on a FreeBSD system and
	use it to create a local copy of a FreeBSD repository.
	Additional information on the use of
	<span class="application">Subversion</span> is included.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-ssl-certificates"></a>A.3.2. Root <acronym class="acronym">SSL</acronym> Certificates</h3></div></div></div><p>Installing
	<a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/security/ca_root_nss/pkg-descr">security/ca_root_nss</a> allows
	<span class="application">Subversion</span> to verify the identity
	of <acronym class="acronym">HTTPS</acronym> repository servers.  The root
	<acronym class="acronym">SSL</acronym> certificates can be installed from a
	port:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/security/ca_root_nss</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>or as a package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install ca_root_nss</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-svnlite"></a>A.3.3. <span class="application">Svnlite</span></h3></div></div></div><p>A lightweight version of
	<span class="application">Subversion</span> is already installed
	on FreeBSD as <code class="command">svnlite</code>.  The port or package
	version of <span class="application">Subversion</span> is only
	needed if the Python or Perl <acronym class="acronym">API</acronym> is needed,
	or if a later version of Subversion is desired.</p><p>The only difference from normal
	<span class="application">Subversion</span> use is that the command
	name is <code class="literal">svnlite</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-install"></a>A.3.4. Installation</h3></div></div></div><p>If <code class="command">svnlite</code> is unavailable or the full
	version of <span class="application">Subversion</span> is needed,
	then it must be installed.</p><p><span class="application">Subversion</span> can be installed
	from the Ports Collection:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/devel/subversion</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p><span class="application">Subversion</span> can also be
	installed as a package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install subversion</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-usage"></a>A.3.5. Running <span class="application">Subversion</span></h3></div></div></div><p>To fetch a clean copy of the sources into a local
	directory, use <code class="command">svn</code>.  The files in this
	directory are called a <span class="emphasis"><em>local working
	  copy</em></span>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Move or delete an existing destination directory before
	  using <code class="command">checkout</code> for the first time.</p><p xmlns="http://www.w3.org/1999/xhtml">Checkout over an existing
	  non-<code class="command">svn</code> directory can cause conflicts
	  between the existing files and those brought in from the
	  repository.</p></div><p><span class="application">Subversion</span> uses
	<acronym class="acronym">URL</acronym>s to designate a repository, taking the
	form of <em class="replaceable"><code>protocol://hostname/path</code></em>.
	The first component of the path is the FreeBSD repository to
	access.  There are three different repositories,
	<code class="literal">base</code> for the FreeBSD base system source code,
	<code class="literal">ports</code> for the Ports Collection, and
	<code class="literal">doc</code> for documentation.  For example, the
	URL
	<code class="literal">https://svn.FreeBSD.org/ports/head/</code>
	specifies the main branch of the ports repository,
	using the <code class="literal">https</code> protocol.</p><p>A checkout from a given repository is performed with a
	command like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svn checkout https://svn.FreeBSD.org/<em class="replaceable"><code>repository</code></em>/<em class="replaceable"><code>branch</code></em> <em class="replaceable"><code>lwcdir</code></em></code></strong></pre><p>where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><em class="replaceable"><code>repository</code></em> is one of the
	    Project repositories: <code class="literal">base</code>,
	    <code class="literal">ports</code>, or
	    <code class="literal">doc</code>.</p></li><li class="listitem"><p><em class="replaceable"><code>branch</code></em> depends on the
	    repository used.  <code class="literal">ports</code> and
	    <code class="literal">doc</code> are mostly updated in the
	    <code class="literal">head</code> branch, while
	    <code class="literal">base</code> maintains the latest version of
	    -CURRENT under <code class="literal">head</code> and the respective
	    latest versions of the -STABLE branches under
	    <code class="literal">stable/9</code>
	    (9.<em class="replaceable"><code>x</code></em>) and
	    <code class="literal">stable/10</code>
	    (10.<em class="replaceable"><code>x</code></em>).</p></li><li class="listitem"><p><em class="replaceable"><code>lwcdir</code></em> is the target
	    directory where the contents of the specified branch
	    should be placed.  This is usually
	    <code class="filename">/usr/ports</code> for
	    <code class="literal">ports</code>,
	    <code class="filename">/usr/src</code> for
	    <code class="literal">base</code>, and
	    <code class="filename">/usr/doc</code> for
	    <code class="literal">doc</code>.</p></li></ul></div><p>This example checks out the Ports Collection from the
	FreeBSD repository using the <acronym class="acronym">HTTPS</acronym>
	protocol, placing the local working copy in
	<code class="filename">/usr/ports</code>.  If
	<code class="filename">/usr/ports</code> is already
	present but was not created by <code class="command">svn</code>,
	remember to rename or delete it before the checkout.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svn checkout https://svn.FreeBSD.org/ports/head /usr/ports</code></strong></pre><p>Because the initial checkout must download the full
	branch of the remote repository, it can take a while.  Please
	be patient.</p><p>After the initial checkout, the local working copy can be
	updated by running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svn update <em class="replaceable"><code>lwcdir</code></em></code></strong></pre><p>To update
	<code class="filename">/usr/ports</code> created in
	the example above, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svn update /usr/ports</code></strong></pre><p>The update is much quicker than a checkout, only
	transferring files that have changed.</p><p>An alternate way of updating the local working copy after
	checkout is provided by the <code class="filename">Makefile</code> in
	the <code class="filename">/usr/ports</code>,
	<code class="filename">/usr/src</code>, and
	<code class="filename">/usr/doc</code> directories.
	Set <code class="varname">SVN_UPDATE</code> and use the
	<code class="buildtarget">update</code> target.  For example, to
	update <code class="filename">/usr/src</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make update SVN_UPDATE=yes</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-mirrors"></a>A.3.6. <span class="application">Subversion</span> Mirror
	Sites</h3></div></div></div><a id="idp73535608" class="indexterm"></a><p>The FreeBSD <span class="application">Subversion</span>
	repository is:</p><pre class="programlisting">svn.FreeBSD.org</pre><p>This is
	a publicly accessible mirror network that uses GeoDNS to
	select an appropriate back end server.  To view the FreeBSD
	<span class="application">Subversion</span> repositories through a
	browser, use <a class="link" href="https://svnweb.FreeBSD.org/" target="_top">https://svnweb.FreeBSD.org/</a>.</p><p>HTTPS is the preferred protocol, but the
	<code class="filename">security/ca_root_nss</code>
	package will need to be installed in order to automatically
	validate certificates.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73540216"></a>A.3.7. For More Information</h3></div></div></div><p>For other information about using
	<span class="application">Subversion</span>, please see the
	<span class="quote">&#8220;<span class="quote">Subversion Book</span>&#8221;</span>, titled
	<a class="link" href="http://svnbook.red-bean.com/" target="_top">Version
	  Control with Subversion</a>, or the <a class="link" href="http://subversion.apache.org/docs/" target="_top">Subversion
	  Documentation</a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mirrors-rsync"></a>A.4. Using <span class="application">rsync</span></h2></div></div></div><p>These sites make FreeBSD available through the rsync
      protocol.  The <span class="application">rsync</span> utility
      transfers only the differences between two sets of files.
      This is useful for mirror sites of the FreeBSD
      <acronym class="acronym">FTP</acronym> server.  The
      <span class="application">rsync</span> suite is available for many
      operating systems, on FreeBSD, see the <a xmlns="" class="package" href="https://www.freebsd.org/cgi/url.cgi?ports/net/rsync/pkg-descr">net/rsync</a>
      port or use the package.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Czech Republic</span></dt><dd><p>rsync://ftp.cz.FreeBSD.org/</p><p>Available collections:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ftp: A partial mirror of the FreeBSD
		<acronym class="acronym">FTP</acronym> server.</p></li><li class="listitem"><p>FreeBSD: A full mirror of the FreeBSD
		<acronym class="acronym">FTP</acronym> server.</p></li></ul></div></dd><dt><span class="term">Netherlands</span></dt><dd><p>rsync://ftp.nl.FreeBSD.org/</p><p>Available collections:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: A full mirror of the FreeBSD
		<acronym class="acronym">FTP</acronym> server.</p></li></ul></div></dd><dt><span class="term">Russia</span></dt><dd><p>rsync://ftp.mtu.ru/</p><p>Available collections:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: A full mirror of the FreeBSD
		<acronym class="acronym">FTP</acronym> server.</p></li><li class="listitem"><p>FreeBSD-Archive: The mirror of FreeBSD Archive
		<acronym class="acronym">FTP</acronym> server.</p></li></ul></div></dd><dt><span class="term">Sweden</span></dt><dd><p>rsync://ftp4.se.freebsd.org/</p><p>Available collections:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: A full mirror of the FreeBSD
		<acronym class="acronym">FTP</acronym> server.</p></li></ul></div></dd><dt><span class="term">Taiwan</span></dt><dd><p>rsync://ftp.tw.FreeBSD.org/</p><p>rsync://ftp2.tw.FreeBSD.org/</p><p>rsync://ftp6.tw.FreeBSD.org/</p><p>Available collections:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: A full mirror of the FreeBSD
		<acronym class="acronym">FTP</acronym> server.</p></li></ul></div></dd><dt><span class="term">United Kingdom</span></dt><dd><p>rsync://rsync.mirrorservice.org/</p><p>Available collections:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ftp.freebsd.org: A full mirror of the FreeBSD
		<acronym class="acronym">FTP</acronym> server.</p></li></ul></div></dd><dt><span class="term">United States of America</span></dt><dd><p>rsync://ftp-master.FreeBSD.org/</p><p>This server may only be used by FreeBSD primary mirror
	    sites.</p><p>Available collections:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: The master archive of the FreeBSD
		<acronym class="acronym">FTP</acronym> server.</p></li><li class="listitem"><p>acl: The FreeBSD master ACL list.</p></li></ul></div><p>rsync://ftp13.FreeBSD.org/</p><p>Available collections:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD: A full mirror of the FreeBSD
		<acronym class="acronym">FTP</acronym> server.</p></li></ul></div></dd></dl></div></div></div><div class="appendix"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bibliography"></a>Appendix B. Bibliography</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#bibliography-freebsd">B.1. Books Specific to FreeBSD</a></span></dt><dt><span class="sect1"><a href="#bibliography-userguides">B.2. Users' Guides</a></span></dt><dt><span class="sect1"><a href="#bibliography-adminguides">B.3. Administrators' Guides</a></span></dt><dt><span class="sect1"><a href="#bibliography-programmers">B.4. Programmers' Guides</a></span></dt><dt><span class="sect1"><a href="#bibliography-osinternals">B.5. Operating System Internals</a></span></dt><dt><span class="sect1"><a href="#bibliography-security">B.6. Security Reference</a></span></dt><dt><span class="sect1"><a href="#bibliography-hardware">B.7. Hardware Reference</a></span></dt><dt><span class="sect1"><a href="#bibliography-history">B.8. <span class="trademark">UNIX</span>® History</a></span></dt><dt><span class="sect1"><a href="#bibliography-journals">B.9. Periodicals, Journals, and Magazines</a></span></dt></dl></div><p>While manual pages provide a definitive reference for
    individual pieces of the FreeBSD operating system, they seldom
    illustrate how to put the pieces together to
    make the whole operating system run smoothly.  For this, there is
    no substitute for a good book or users' manual on <span class="trademark">UNIX</span>® system
    administration.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-freebsd"></a>B.1. Books Specific to FreeBSD</h2></div></div></div><p>International books:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://jdli.tw.FreeBSD.org/publication/book/freebsd2/index.htm" target="_top">Using
	    FreeBSD</a> (in Traditional Chinese), published by
	  <a class="link" href="http://www.drmaster.com.tw/" target="_top">Drmaster</a>,
	  1997.  ISBN 9-578-39435-7.</p></li><li class="listitem"><p>FreeBSD Unleashed (Simplified Chinese translation),
	  published by
	  <a class="link" href="http://www.hzbook.com/" target="_top">China Machine
	    Press</a>.  ISBN 7-111-10201-0.</p></li><li class="listitem"><p>FreeBSD From Scratch Second Edition (in Simplified
	  Chinese), published by China Machine Press.  ISBN
	  7-111-10286-X.</p></li><li class="listitem"><p>FreeBSD Handbook Second Edition (Simplified Chinese
	  translation), published by <a class="link" href="http://www.ptpress.com.cn/" target="_top">Posts &amp;
	    Telecom Press</a>.  ISBN 7-115-10541-3.</p></li><li class="listitem"><p>FreeBSD &amp; Windows (in Simplified Chinese), published
	  by <a class="link" href="http://www.tdpress.com/" target="_top">China Railway
	    Publishing House</a>.  ISBN 7-113-03845-X</p></li><li class="listitem"><p>FreeBSD Internet Services HOWTO (in Simplified Chinese),
	  published by China Railway Publishing House.  ISBN
	  7-113-03423-3</p></li><li class="listitem"><p>FreeBSD (in Japanese), published by CUTT.  ISBN
	  4-906391-22-2 C3055 P2400E.</p></li><li class="listitem"><p><a class="link" href="http://www.shoeisha.com/book/Detail.asp?bid=650" target="_top">Complete
	    Introduction to FreeBSD</a> (in Japanese), published by
	  <a class="link" href="http://www.shoeisha.co.jp/" target="_top">Shoeisha Co.,
	    Ltd</a>.  ISBN 4-88135-473-6 P3600E.</p></li><li class="listitem"><p><a class="link" href="http://www.ascii.co.jp/pb/book1/shinkan/detail/1322785.html" target="_top">Personal
	    UNIX Starter Kit FreeBSD</a> (in Japanese), published
	  by <a class="link" href="http://www.ascii.co.jp/" target="_top">ASCII</a>.
	  ISBN 4-7561-1733-3 P3000E.</p></li><li class="listitem"><p>FreeBSD Handbook (Japanese translation), published by
	  <a class="link" href="http://www.ascii.co.jp/" target="_top">ASCII</a>.
	  ISBN 4-7561-1580-2 P3800E.</p></li><li class="listitem"><p>FreeBSD mit Methode (in German), published by
	  <a class="link" href="http://www.cul.de" target="_top">Computer und Literatur
	    Verlag</a>/Vertrieb Hanser, 1998.  ISBN
	  3-932311-31-0.</p></li><li class="listitem"><p><a class="link" href="http://www.mitp.de/vmi/mitp/detail/pWert/1343/" target="_top">
	    FreeBSD de Luxe</a> (in German), published by
	  <a class="link" href="http://www.mitp.de" target="_top">Verlag Modere
	    Industrie</a>, 2003.  ISBN 3-8266-1343-0.</p></li><li class="listitem"><p><a class="link" href="http://www.pc.mycom.co.jp/FreeBSD/install-manual.html" target="_top">FreeBSD
	    Install and Utilization Manual</a> (in Japanese),
	  published by
	  <a class="link" href="http://www.pc.mycom.co.jp/" target="_top">Mainichi
	    Communications Inc.</a>, 1998.  ISBN
	  4-8399-0112-0.</p></li><li class="listitem"><p>Onno W Purbo, Dodi Maryanto, Syahrial Hubbany, Widjil
	  Widodo <span class="emphasis"><em><a class="link" href="http://maxwell.itb.ac.id/" target="_top">Building Internet
	      Server with FreeBSD</a></em></span> (in Indonesia
	  Language), published by
	  <a class="link" href="http://www.elexmedia.co.id/" target="_top">Elex
	    Media Komputindo</a>.</p></li><li class="listitem"><p>Absolute BSD: The Ultimate Guide to FreeBSD (Traditional
	  Chinese translation), published by <a class="link" href="http://www.grandtech.com.tw/" target="_top">GrandTech
	    Press</a>, 2003.  ISBN 986-7944-92-5.</p></li><li class="listitem"><p><a class="link" href="http://www.twbsd.org/cht/book/" target="_top">The
	    FreeBSD 6.0 Book</a> (in Traditional Chinese),
	  published by Drmaster, 2006.  ISBN 9-575-27878-X.</p></li></ul></div><p>English language books:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.absoluteFreeBSD.com/" target="_top">Absolute
	    FreeBSD, 2nd Edition: The Complete Guide to
	    FreeBSD</a>, published by
	  <a class="link" href="http://www.nostarch.com/" target="_top">No Starch
	    Press</a>, 2007.  ISBN: 978-1-59327-151-0</p></li><li class="listitem"><p><a class="link" href="http://www.freebsdmall.com/cgi-bin/fm/bsdcomp" target="_top">
	    The Complete FreeBSD</a>, published by
	  <a class="link" href="http://www.oreilly.com/" target="_top">O'Reilly</a>,
	  2003. ISBN: 0596005164</p></li><li class="listitem"><p><a class="link" href="http://www.freebsd-corp-net-guide.com/" target="_top">The
	    FreeBSD Corporate Networker's Guide</a>, published by
	  <a class="link" href="http://www.awl.com/aw/" target="_top">Addison-Wesley</a>,
	  2000.  ISBN: 0201704811</p></li><li class="listitem"><p><a class="link" href="http://andrsn.stanford.edu/FreeBSD/introbook/" target="_top">
	    FreeBSD: An Open-Source Operating System for Your Personal
	    Computer</a>, published by The Bit Tree Press, 2001.
	  ISBN: 0971204500</p></li><li class="listitem"><p>Teach Yourself FreeBSD in 24 Hours, published by <a class="link" href="http://www.samspublishing.com/" target="_top">Sams</a>,
	  2002.  ISBN: 0672324245</p></li><li class="listitem"><p>FreeBSD 6 Unleashed, published by <a class="link" href="http://www.samspublishing.com/" target="_top">Sams</a>,
	  2006.  ISBN: 0672328755</p></li><li class="listitem"><p>FreeBSD: The Complete Reference, published by <a class="link" href="http://books.mcgraw-hill.com" target="_top">McGrawHill</a>,
	  2003.  ISBN: 0072224096</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-userguides"></a>B.2. Users' Guides</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Ohio State University has written a <a class="link" href="http://www.cs.duke.edu/csl/docs/unix_course/" target="_top">UNIX
	    Introductory Course</a> which is available online in
	  HTML and PostScript format.</p><p>An Italian <a class="link" href="../../../../doc/it_IT.ISO8859-15/books/unix-introduction/index.html" target="_top">translation</a>
	  of this document is available as part of the FreeBSD Italian
	  Documentation Project.</p></li><li class="listitem"><p><a class="link" href="http://www.jp.FreeBSD.org/" target="_top">Jpman
	    Project, Japan FreeBSD Users Group</a>.  FreeBSD
	  User's Reference Manual (Japanese translation).
	  <a class="link" href="http://www.pc.mycom.co.jp/" target="_top">Mainichi
	    Communications Inc.</a>, 1998.  ISBN4-8399-0088-4
	  P3800E.</p></li><li class="listitem"><p><a class="link" href="http://www.ed.ac.uk/" target="_top">Edinburgh
	    University</a> has written an <a class="link" href="http://www.ed.ac.uk/information-services/help-consultancy/is-skills/catalogue/program-op-sys-catalogue/unix1" target="_top">Online
	    Guide</a> for newcomers to the UNIX environment.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-adminguides"></a>B.3. Administrators' Guides</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.jp.FreeBSD.org/" target="_top">Jpman
	    Project, Japan FreeBSD Users Group</a>.  FreeBSD
	  System Administrator's Manual (Japanese translation).
	  <a class="link" href="http://www.pc.mycom.co.jp/" target="_top">Mainichi
	    Communications Inc.</a>, 1998.  ISBN4-8399-0109-0
	  P3300E.</p></li><li class="listitem"><p>Dreyfus, Emmanuel.  <a class="link" href="http://www.eyrolles.com/Informatique/Livre/9782212114638/" target="_top">Cahiers
	    de l'Admin: BSD</a> 2nd Ed. (in French), Eyrolles,
	  2004.  ISBN 2-212-11463-X</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-programmers"></a>B.4. Programmers' Guides</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Computer Systems Research Group, UC Berkeley.
	  <span class="emphasis"><em>4.4BSD Programmer's Reference Manual</em></span>.
	  O'Reilly &amp; Associates, Inc., 1994.  ISBN
	  1-56592-078-3</p></li><li class="listitem"><p>Computer Systems Research Group, UC Berkeley.
	  <span class="emphasis"><em>4.4BSD Programmer's Supplementary
	    Documents</em></span>.  O'Reilly &amp; Associates, Inc.,
	  1994.  ISBN 1-56592-079-1</p></li><li class="listitem"><p>Harbison, Samuel P. and Steele, Guy L. Jr.  <span class="emphasis"><em>C:
	    A Reference Manual</em></span>.  4th Ed. Prentice Hall,
	  1995.  ISBN 0-13-326224-3</p></li><li class="listitem"><p>Kernighan, Brian and Dennis M. Ritchie.  <span class="emphasis"><em>The C
	    Programming Language</em></span>.  2nd Ed. PTR Prentice
	  Hall, 1988.  ISBN 0-13-110362-8</p></li><li class="listitem"><p>Lehey, Greg.  <span class="emphasis"><em>Porting UNIX
	    Software</em></span>.  O'Reilly &amp; Associates, Inc.,
	  1995.  ISBN 1-56592-126-7</p></li><li class="listitem"><p>Plauger, P. J. <span class="emphasis"><em>The Standard C
	    Library</em></span>.  Prentice Hall, 1992.  ISBN
	  0-13-131509-9</p></li><li class="listitem"><p>Spinellis, Diomidis.  <a class="link" href="http://www.spinellis.gr/codereading/" target="_top"><span class="emphasis"><em>Code
	      Reading: The Open Source Perspective</em></span></a>.
	  Addison-Wesley, 2003.  ISBN 0-201-79940-5</p></li><li class="listitem"><p>Spinellis, Diomidis.  <a class="link" href="http://www.spinellis.gr/codequality/" target="_top"><span class="emphasis"><em>Code
	      Quality: The Open Source Perspective</em></span></a>.
	  Addison-Wesley, 2006.  ISBN 0-321-16607-8</p></li><li class="listitem"><p>Stevens, W. Richard and Stephen A. Rago.
	  <span class="emphasis"><em>Advanced Programming in the UNIX
	    Environment</em></span>.  2nd Ed. Reading, Mass. :
	  Addison-Wesley, 2005.  ISBN 0-201-43307-9</p></li><li class="listitem"><p>Stevens, W. Richard.  <span class="emphasis"><em>UNIX Network
	    Programming</em></span>.  2nd Ed, PTR Prentice Hall, 1998.
	  ISBN 0-13-490012-X</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-osinternals"></a>B.5. Operating System Internals</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Andleigh, Prabhat K.  <span class="emphasis"><em>UNIX System
	    Architecture</em></span>.  Prentice-Hall, Inc., 1990.  ISBN
	  0-13-949843-5</p></li><li class="listitem"><p>Jolitz, William.  <span class="quote">&#8220;<span class="quote">Porting UNIX to the
	    386</span>&#8221;</span>.  <span class="emphasis"><em>Dr. Dobb's Journal</em></span>.
	  January 1991-July 1992.</p></li><li class="listitem"><p>Leffler, Samuel J., Marshall Kirk McKusick, Michael J
	  Karels and John Quarterman <span class="emphasis"><em>The Design and
	    Implementation of the 4.3BSD UNIX Operating
	    System</em></span>.  Reading, Mass. : Addison-Wesley, 1989.
	  ISBN 0-201-06196-1</p></li><li class="listitem"><p>Leffler, Samuel J., Marshall Kirk McKusick,
	  <span class="emphasis"><em>The Design and Implementation of the 4.3BSD UNIX
	    Operating System: Answer Book</em></span>.  Reading, Mass.
	  : Addison-Wesley, 1991.  ISBN 0-201-54629-9</p></li><li class="listitem"><p>McKusick, Marshall Kirk, Keith Bostic, Michael J Karels,
	  and John Quarterman.  <span class="emphasis"><em>The Design and
	    Implementation of the 4.4BSD Operating System</em></span>.
	  Reading, Mass. : Addison-Wesley, 1996.  ISBN
	  0-201-54979-4</p><p>(Chapter 2 of this book is available <a class="link" href="../../../../doc/en_US.ISO8859-1/books/design-44bsd/book.html" target="_top">online</a>
	  as part of the FreeBSD Documentation Project.)</p></li><li class="listitem"><p>Marshall Kirk McKusick, George V. Neville-Neil
	  <span class="emphasis"><em>The Design and Implementation of the FreeBSD
	    Operating System</em></span>.  Boston, Mass. :
	  Addison-Wesley, 2004.  ISBN 0-201-70245-2</p></li><li class="listitem"><p>Marshall Kirk McKusick, George V. Neville-Neil,
	  Robert N. M. Watson <span class="emphasis"><em>The Design and Implementation
	    of the FreeBSD Operating System, 2nd Ed.</em></span>.
	  Westford, Mass. : Pearson Education, Inc., 2014.
	  ISBN 0-321-96897-2</p></li><li class="listitem"><p>Stevens, W. Richard.  <span class="emphasis"><em>TCP/IP Illustrated,
	    Volume 1: The Protocols</em></span>.  Reading, Mass. :
	  Addison-Wesley, 1996.  ISBN 0-201-63346-9</p></li><li class="listitem"><p>Schimmel, Curt.  <span class="emphasis"><em>Unix Systems for Modern
	    Architectures</em></span>.  Reading, Mass. :
	  Addison-Wesley, 1994.  ISBN 0-201-63338-8</p></li><li class="listitem"><p>Stevens, W. Richard.  <span class="emphasis"><em>TCP/IP Illustrated,
	    Volume 3: TCP for Transactions, HTTP, NNTP and the UNIX
	    Domain Protocols</em></span>.  Reading, Mass. :
	  Addison-Wesley, 1996.  ISBN 0-201-63495-3</p></li><li class="listitem"><p>Vahalia, Uresh.  <span class="emphasis"><em>UNIX Internals -- The New
	    Frontiers</em></span>.  Prentice Hall, 1996.  ISBN
	  0-13-101908-2</p></li><li class="listitem"><p>Wright, Gary R. and W. Richard Stevens.
	  <span class="emphasis"><em>TCP/IP Illustrated, Volume 2: The
	    Implementation</em></span>.  Reading, Mass. :
	  Addison-Wesley, 1995.  ISBN 0-201-63354-X</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-security"></a>B.6. Security Reference</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Cheswick, William R. and Steven M. Bellovin.
	  <span class="emphasis"><em>Firewalls and Internet Security: Repelling the
	    Wily Hacker</em></span>.  Reading, Mass. : Addison-Wesley,
	  1995.  ISBN 0-201-63357-4</p></li><li class="listitem"><p>Garfinkel, Simson.  <span class="emphasis"><em>PGP Pretty Good
	    Privacy</em></span> O'Reilly &amp; Associates, Inc., 1995.
	  ISBN 1-56592-098-8</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-hardware"></a>B.7. Hardware Reference</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Anderson, Don and Tom Shanley.  <span class="emphasis"><em>Pentium
	    Processor System Architecture</em></span>.  2nd Ed.
	  Reading, Mass. : Addison-Wesley, 1995.  ISBN
	  0-201-40992-5</p></li><li class="listitem"><p>Ferraro, Richard F.  <span class="emphasis"><em>Programmer's Guide to the
	    EGA, VGA, and Super VGA Cards</em></span>.  3rd ed.
	  Reading, Mass. : Addison-Wesley, 1995.  ISBN
	  0-201-62490-7</p></li><li class="listitem"><p>Intel Corporation publishes documentation on their CPUs,
	  chipsets and standards on their
	  <a class="link" href="http://developer.intel.com/" target="_top">developer web
	    site</a>, usually as PDF files.</p></li><li class="listitem"><p>Shanley, Tom.  <span class="emphasis"><em>80486 System
	    Architecture</em></span>.  3rd Ed. Reading, Mass. :
	  Addison-Wesley, 1995.  ISBN 0-201-40994-1</p></li><li class="listitem"><p>Shanley, Tom.  <span class="emphasis"><em>ISA System
	    Architecture</em></span>.  3rd Ed. Reading, Mass. :
	  Addison-Wesley, 1995.  ISBN 0-201-40996-8</p></li><li class="listitem"><p>Shanley, Tom.  <span class="emphasis"><em>PCI System
	    Architecture</em></span>.  4th Ed. Reading, Mass. :
	  Addison-Wesley, 1999.  ISBN 0-201-30974-2</p></li><li class="listitem"><p>Van Gilluwe, Frank.  <span class="emphasis"><em>The Undocumented
	    PC</em></span>, 2nd Ed.  Reading, Mass: Addison-Wesley Pub.
	  Co., 1996.  ISBN 0-201-47950-8</p></li><li class="listitem"><p>Messmer, Hans-Peter.  <span class="emphasis"><em>The Indispensable PC
	    Hardware Book</em></span>, 4th Ed. Reading, Mass :
	  Addison-Wesley Pub. Co., 2002.  ISBN 0-201-59616-4</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-history"></a>B.8. <span class="trademark">UNIX</span>® History</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Lion, John <span class="emphasis"><em>Lion's Commentary on UNIX, 6th Ed.
	    With Source Code</em></span>.  ITP Media Group, 1996.  ISBN
	  1573980137</p></li><li class="listitem"><p>Raymond, Eric S.  <span class="emphasis"><em>The New Hacker's Dictionary,
	    3rd edition</em></span>.  MIT Press, 1996.  ISBN
	  0-262-68092-0.  Also known as the <a class="link" href="http://www.catb.org/~esr/jargon/html/index.html" target="_top">Jargon
	    File</a></p></li><li class="listitem"><p>Salus, Peter H.  <span class="emphasis"><em>A quarter century of
	    UNIX</em></span>.  Addison-Wesley Publishing Company, Inc.,
	  1994.  ISBN 0-201-54777-5</p></li><li class="listitem"><p>Simon Garfinkel, Daniel Weise, Steven Strassmann.
	  <span class="emphasis"><em>The UNIX-HATERS Handbook</em></span>.  IDG Books
	  Worldwide, Inc., 1994.  ISBN 1-56884-203-1.  Out of print,
	  but available <a class="link" href="http://www.simson.net/ref/ugh.pdf" target="_top">online</a>.</p></li><li class="listitem"><p>Don Libes, Sandy Ressler <span class="emphasis"><em>Life with
	    UNIX</em></span> &#8212; special edition.  Prentice-Hall,
	  Inc., 1989.  ISBN 0-13-536657-7</p></li><li class="listitem"><p><span class="emphasis"><em>The BSD family tree</em></span>.
	  <code class="uri"><a class="uri" href="https://svnweb.freebsd.org/base/head/share/misc/bsd-family-tree?view=co" target="_top">https://svnweb.freebsd.org/base/head/share/misc/bsd-family-tree?view=co</a></code>
	  or <a class="link" href="file://localhost/usr/share/misc/bsd-family-tree" target="_top"><code class="filename">/usr/share/misc/bsd-family-tree</code></a>
	  on a FreeBSD machine.</p></li><li class="listitem"><p><span class="emphasis"><em>Networked Computer Science Technical Reports
	    Library</em></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>Old BSD releases from the Computer Systems
	    Research group (CSRG)</em></span>.  <code class="uri"><a class="uri" href="http://www.mckusick.com/csrg/" target="_top">http://www.mckusick.com/csrg/</a></code>:
	  The 4CD set covers all BSD versions from 1BSD to 4.4BSD and
	  4.4BSD-Lite2 (but not 2.11BSD, unfortunately).  The last
	  disk also holds the final sources plus the SCCS
	  files.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="bibliography-journals"></a>B.9. Periodicals, Journals, and Magazines</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.admin-magazin.de/" target="_top">Admin
	    Magazin</a> (in German), published by
	  Medialinx AG. ISSN: 2190-1066</p></li><li class="listitem"><p><a class="link" href="http://www.bsdmag.org/" target="_top">BSD
	    Magazine</a>, published by Software Press Sp. z o.o.
	  SK. ISSN: 1898-9144</p></li><li class="listitem"><p><a class="link" href="http://www.bsdnow.tv/" target="_top">BSD Now
	    &#8212; Video Podcast</a>, published by
	  Jupiter Broadcasting LLC</p></li><li class="listitem"><p><a class="link" href="http://bsdtalk.blogspot.com/" target="_top">BSD
	    Talk Podcast</a>, by Will Backman</p></li><li class="listitem"><p><a class="link" href="http://freebsdjournal.com/" target="_top">FreeBSD
	    Journal</a>, published by S&amp;W
	  Publishing, sponsored by The FreeBSD Foundation.
	  ISBN: 978-0-615-88479-0</p></li></ul></div></div></div><div class="appendix"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="eresources"></a>Appendix C. Resources on the Internet</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#eresources-www">C.1. Websites</a></span></dt><dt><span class="sect1"><a href="#eresources-mail">C.2. Mailing Lists</a></span></dt><dt><span class="sect1"><a href="#eresources-news">C.3. Usenet Newsgroups</a></span></dt><dt><span class="sect1"><a href="#eresources-web">C.4. Official Mirrors</a></span></dt></dl></div><p>The rapid pace of FreeBSD progress makes print media
    impractical as a means of following the latest developments.
    Electronic resources are the best, if not often the only, way to
    stay informed of the latest advances.  Since FreeBSD is a volunteer
    effort, the user community itself also generally serves as a
    <span class="quote">&#8220;<span class="quote">technical support department</span>&#8221;</span> of sorts, with
    electronic mail, web forums, and USENET news being the most
    effective way of reaching that community.</p><p>The most important points of contact with the FreeBSD user
    community are outlined below.  Please send other resources not
    mentioned here to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc" target="_top">FreeBSD documentation project mailing list</a> so that they may also be
    included.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="eresources-www"></a>C.1. Websites</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="https://forums.FreeBSD.org/" target="_top">The
	    FreeBSD Forums</a> provide a web based discussion forum
	  for FreeBSD questions and technical
	  discussion.</p></li><li class="listitem"><p>The <a class="link" href="http://www.youtube.com/bsdconferences" target="_top">BSDConferences
	    YouTube Channel</a> provides a collection of high
	  quality videos from BSD conferences around the world.
	  This is a great way to watch key developers give
	  presentations about new work in FreeBSD.</p></li></ul></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="eresources-mail"></a>C.2. Mailing Lists</h2></div></div></div><p>The mailing lists are the most direct way of addressing
      questions or opening a technical discussion to a concentrated
      FreeBSD audience.  There are a wide variety of lists on a number of
      different FreeBSD topics.  Sending questions to the most
      appropriate mailing list will invariably assure a faster and
      more accurate response.</p><p>The charters for the various lists are given at the bottom
      of this document.  <span class="emphasis"><em>Please read the charter before
      joining or sending mail to any list</em></span>.  Most list
      subscribers receive many hundreds of FreeBSD related messages every
      day, and the charters and rules for use are meant to keep the
      signal-to-noise ratio of the lists high.  To do less would see
      the mailing lists ultimately fail as an effective communications
      medium for the Project.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="emphasis"><em>To test the ability to send email to FreeBSD lists,
	  send a test message to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-test" target="_top">freebsd-test</a>.</em></span>  Please do
	not send test messages to any other list.</p></div><p>When in doubt about what list to post a question to, see
      <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/freebsd-questions" target="_top">How to get
	best results from the FreeBSD-questions mailing
	list</a>.</p><p>Before posting to any list, please learn about how to best
      use the mailing lists, such as how to help avoid
      frequently-repeated discussions, by reading the
      <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/mailing-list-faq" target="_top">Mailing List
	Frequently Asked Questions</a> (FAQ) document.</p><p>Archives are kept for all of the mailing lists and can be
      searched using the
      <a class="link" href="../../../../search/index.html" target="_top">FreeBSD World Wide
	Web server</a>.  The keyword searchable archive offers an
      excellent way of finding answers to frequently asked questions
      and should be consulted before posting a question.  Note that
      this also means that messages sent to FreeBSD mailing lists are
      archived in perpetuity.  When protecting privacy is a concern,
      consider using a disposable secondary email address and posting
      only public information.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="eresources-summary"></a>C.2.1. List Summary</h3></div></div></div><p><span class="emphasis"><em>General lists:</em></span> The following are
	general lists which anyone is free (and encouraged) to
	join:</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>List</th><th>Purpose</th></tr></thead><tbody><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-advocacy" target="_top">freebsd-advocacy</a></td><td>FreeBSD Evangelism</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce" target="_top">freebsd-announce</a></td><td>Important events and Project milestones
		(moderated)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-arch" target="_top">freebsd-arch</a></td><td>Architecture and design discussions</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugbusters" target="_top">freebsd-bugbusters</a></td><td>Discussions pertaining to the maintenance of
		the FreeBSD problem report database and related
		tools</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugs" target="_top">freebsd-bugs</a></td><td>Bug reports</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">freebsd-chat</a></td><td>Non-technical items related to the FreeBSD
		community</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chromium" target="_top">freebsd-chromium</a></td><td>FreeBSD-specific Chromium issues</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a></td><td>Discussion concerning the use of
		FreeBSD-CURRENT</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp" target="_top">freebsd-isp</a></td><td>Issues for Internet Service Providers using
		FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-jobs" target="_top">freebsd-jobs</a></td><td>FreeBSD employment and consulting
		opportunities</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-quarterly-calls" target="_top">freebsd-quarterly-calls</a></td><td>Calls for quarterly status reports (moderated)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">freebsd-questions</a></td><td>User questions and technical support</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications" target="_top">freebsd-security-notifications</a></td><td>Security notifications (moderated)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable" target="_top">freebsd-stable</a></td><td>Discussion concerning the use of
		FreeBSD-STABLE</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-test" target="_top">freebsd-test</a></td><td>Where to send test messages instead of to
		one of the actual lists</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-women" target="_top">freebsd-women</a></td><td>FreeBSD advocacy for women</td></tr></tbody></table></div><p><span class="emphasis"><em>Technical lists:</em></span> The following lists
	are for technical discussion.  Read the charter for each list
	carefully before joining or sending mail to one as there are
	firm guidelines for their use and content.</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>List</th><th>Purpose</th></tr></thead><tbody><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a></td><td>ACPI and power management development</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-amd64" target="_top">freebsd-amd64</a></td><td>Porting FreeBSD to AMD64 systems (moderated)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-apache" target="_top">freebsd-apache</a></td><td>Discussion about
		<span class="application">Apache</span> related
		ports</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-arm" target="_top">freebsd-arm</a></td><td>Porting FreeBSD to <span class="trademark">ARM</span>® processors</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-atm" target="_top">freebsd-atm</a></td><td>Using ATM networking with FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bluetooth" target="_top">freebsd-bluetooth</a></td><td>Using <span class="trademark">Bluetooth</span>® technology in FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-cloud" target="_top">freebsd-cloud</a></td><td>FreeBSD on cloud platforms (EC2, GCE, Azure,
		etc.)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-cluster" target="_top">freebsd-cluster</a></td><td>Using FreeBSD in a clustered environment</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-database" target="_top">freebsd-database</a></td><td>Discussing database use and development under
		FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-desktop" target="_top">freebsd-desktop</a></td><td>Using and improving FreeBSD on the desktop</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/dev-ci" target="_top">dev-ci</a></td><td>Build and test reports from the Continuous
		Integration servers</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/dev-reviews" target="_top">dev-reviews</a></td><td>Notifications of the FreeBSD review
		system</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc" target="_top">freebsd-doc</a></td><td>Creating FreeBSD related documents</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-drivers" target="_top">freebsd-drivers</a></td><td>Writing device drivers for FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-dtrace" target="_top">freebsd-dtrace</a></td><td>Using and working on DTrace in FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eclipse" target="_top">freebsd-eclipse</a></td><td>FreeBSD users of Eclipse IDE, tools, rich client
		applications and ports.</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-elastic" target="_top">freebsd-elastic</a></td><td>FreeBSD-specific ElasticSearch discussions</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-embedded" target="_top">freebsd-embedded</a></td><td>Using FreeBSD in embedded applications</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eol" target="_top">freebsd-eol</a></td><td>Peer support of FreeBSD-related software that
		is no longer supported by the FreeBSD Project.</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-emulation" target="_top">freebsd-emulation</a></td><td>Emulation of other systems such as
		Linux/<span class="trademark">MS-DOS</span>®/<span class="trademark">Windows</span>®</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-enlightenment" target="_top">freebsd-enlightenment</a></td><td>Porting <span class="application">Enlightenment</span>
		and <span class="application">Enlightenment</span>
		applications</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-erlang" target="_top">freebsd-erlang</a></td><td>FreeBSD-specific Erlang discussions</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-firewire" target="_top">freebsd-firewire</a></td><td>FreeBSD <span class="trademark">FireWire</span>® (iLink, IEEE 1394) technical
		discussion</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fortran" target="_top">freebsd-fortran</a></td><td>Fortran on FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fs" target="_top">freebsd-fs</a></td><td>File systems</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-games" target="_top">freebsd-games</a></td><td>Support for Games on FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gecko" target="_top">freebsd-gecko</a></td><td><span class="application">Gecko Rendering
		  Engine</span> issues</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-geom" target="_top">freebsd-geom</a></td><td>GEOM-specific discussions and
		implementations</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-git" target="_top">freebsd-git</a></td><td>Discussion of git use in the FreeBSD project</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gnome" target="_top">freebsd-gnome</a></td><td>Porting <span class="application">GNOME</span> and
		<span class="application">GNOME</span> applications</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers" target="_top">freebsd-hackers</a></td><td>General technical discussion</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-haskell" target="_top">freebsd-haskell</a></td><td>FreeBSD-specific Haskell issues and
		discussions</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hardware" target="_top">freebsd-hardware</a></td><td>General discussion of hardware for running
		FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-i18n" target="_top">freebsd-i18n</a></td><td>FreeBSD Internationalization</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-infiniband" target="_top">freebsd-infiniband</a></td><td>Infiniband on FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ipfw" target="_top">freebsd-ipfw</a></td><td>Technical discussion concerning the redesign
		of the IP firewall code</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isdn" target="_top">freebsd-isdn</a></td><td>ISDN developers</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-jail" target="_top">freebsd-jail</a></td><td>Discussion about the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>
		facility</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-java" target="_top">freebsd-java</a></td><td><span class="trademark">Java</span>&#8482; developers and people porting <span class="trademark">JDK</span>&#8482;s to
		FreeBSD</td></tr><tr><td><a class="link" href="https://mail.kde.org/mailman/listinfo/kde-freebsd" target="_top">freebsd-kde</a></td><td>Porting <span class="application">KDE</span> and
		<span class="application">KDE</span> applications</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-lfs" target="_top">freebsd-lfs</a></td><td>Porting LFS to FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-mips" target="_top">freebsd-mips</a></td><td>Porting FreeBSD to <span class="trademark">MIPS</span>®</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-mono" target="_top">freebsd-mono</a></td><td>Mono and C# applications on FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-multimedia" target="_top">freebsd-multimedia</a></td><td>Multimedia applications</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-new-bus" target="_top">freebsd-new-bus</a></td><td>Technical discussions about bus
		architecture</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-net" target="_top">freebsd-net</a></td><td>Networking discussion and TCP/IP source
		code</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-numerics" target="_top">freebsd-numerics</a></td><td>Discussions of high quality implementation of
		libm functions</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ocaml" target="_top">freebsd-ocaml</a></td><td>FreeBSD-specific OCaml discussions</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-office" target="_top">freebsd-office</a></td><td>Office applications on FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-performance" target="_top">freebsd-performance</a></td><td>Performance tuning questions for high
		performance/load installations</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-perl" target="_top">freebsd-perl</a></td><td>Maintenance of a number of
		Perl-related ports</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf" target="_top">freebsd-pf</a></td><td>Discussion and questions about the packet filter
		firewall system</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg" target="_top">freebsd-pkg</a></td><td>Binary package management and package
		tools discussion</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg-fallout" target="_top">freebsd-pkg-fallout</a></td><td>Fallout logs from package building</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkgbase" target="_top">freebsd-pkgbase</a></td><td>Packaging the FreeBSD base system</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-platforms" target="_top">freebsd-platforms</a></td><td>Concerning ports to non <span class="trademark">Intel</span>® architecture
		platforms</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports" target="_top">freebsd-ports</a></td><td>Discussion of the Ports Collection</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-announce" target="_top">freebsd-ports-announce</a></td><td>Important news and instructions about the Ports
		Collection (moderated)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-bugs" target="_top">freebsd-ports-bugs</a></td><td>Discussion of the ports bugs/PRs</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ppc" target="_top">freebsd-ppc</a></td><td>Porting FreeBSD to the <span class="trademark">PowerPC</span>®</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-proliant" target="_top">freebsd-proliant</a></td><td>Technical discussion of FreeBSD on HP ProLiant
		server platforms</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-python" target="_top">freebsd-python</a></td><td>FreeBSD-specific Python issues</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-rc" target="_top">freebsd-rc</a></td><td>Discussion related to the
		<code class="filename">rc.d</code> system and its
		development</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-realtime" target="_top">freebsd-realtime</a></td><td>Development of realtime extensions to
		FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-riscv" target="_top">freebsd-riscv</a></td><td>Porting FreeBSD to <span class="trademark">RISC-V</span>® systems</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ruby" target="_top">freebsd-ruby</a></td><td>FreeBSD-specific Ruby discussions</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-scsi" target="_top">freebsd-scsi</a></td><td>The SCSI subsystem</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security" target="_top">freebsd-security</a></td><td>Security issues affecting FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-snapshots" target="_top">freebsd-snapshots</a></td><td>FreeBSD Development Snapshot Announcements</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-sparc64" target="_top">freebsd-sparc64</a></td><td>Porting FreeBSD to <span class="trademark">SPARC</span>® based systems</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-standards" target="_top">freebsd-standards</a></td><td>FreeBSD's conformance to the C99 and the <span class="trademark">POSIX</span>®
		standards</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-sysinstall" target="_top">freebsd-sysinstall</a></td><td><a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> development</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tcltk" target="_top">freebsd-tcltk</a></td><td>FreeBSD-specific Tcl/Tk discussions</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-testing" target="_top">freebsd-testing</a></td><td>Testing on FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tex" target="_top">freebsd-tex</a></td><td>Porting <span class="application">TeX</span> and its
		applications to FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-threads" target="_top">freebsd-threads</a></td><td>Threading in FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tilera" target="_top">freebsd-tilera</a></td><td>Porting FreeBSD to the Tilera family of
		CPUs</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tokenring" target="_top">freebsd-tokenring</a></td><td>Support Token Ring in FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-toolchain" target="_top">freebsd-toolchain</a></td><td>Maintenance of FreeBSD's integrated
		toolchain</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-translators" target="_top">freebsd-translators</a></td><td>Translating FreeBSD documents and programs</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-transport" target="_top">freebsd-transport</a></td><td>Discussions of transport level network protocols
		in FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-usb" target="_top">freebsd-usb</a></td><td>Discussing FreeBSD support for USB</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-virtualization" target="_top">freebsd-virtualization</a></td><td>Discussion of various virtualization techniques
		supported by FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-vuxml" target="_top">freebsd-vuxml</a></td><td>Discussion on VuXML infrastructure</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-x11" target="_top">freebsd-x11</a></td><td>Maintenance and support of X11 on FreeBSD</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xen" target="_top">freebsd-xen</a></td><td>Discussion of the FreeBSD port to <span class="trademark">Xen</span>&#8482; &#8212;
		implementation and usage</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xfce" target="_top">freebsd-xfce</a></td><td><span class="application">XFCE</span> for FreeBSD &#8212;
		porting and maintaining</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-zope" target="_top">freebsd-zope</a></td><td><span class="application">Zope</span> for FreeBSD &#8212;
		porting and maintaining</td></tr></tbody></table></div><p><span class="emphasis"><em>Limited lists:</em></span>  The following lists
	are for more specialized (and demanding) audiences and are
	probably not of interest to the general public.  It is also a
	good idea to establish a presence in the technical lists
	before joining one of these limited lists in order to
	understand the communications etiquette involved.</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>List</th><th>Purpose</th></tr></thead><tbody><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hubs" target="_top">freebsd-hubs</a></td><td>People running mirror sites (infrastructural
		support)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-user-groups" target="_top">freebsd-user-groups</a></td><td>User group coordination</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wip-status" target="_top">freebsd-wip-status</a></td><td>FreeBSD Work-In-Progress Status</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wireless" target="_top">freebsd-wireless</a></td><td>Discussions of 802.11 stack, tools, device driver
		development</td></tr></tbody></table></div><p><span class="emphasis"><em>Digest lists:</em></span>  All of the above lists
	are available in a digest format.  Once subscribed to a list,
	the digest options can be changed in the account options
	section.</p><p><span class="emphasis"><em>SVN lists:</em></span> The following lists are
	for people interested in seeing the log messages for changes
	to various areas of the source tree.  They are
	<span class="emphasis"><em>Read-Only</em></span> lists and should not have mail
	sent to them.</p><div class="informaltable"><table class="informaltable" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>List</th><th>Source area</th><th>Area Description (source for)</th></tr></thead><tbody><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-all" target="_top">svn-doc-all</a></td><td><code class="filename">/usr/doc</code></td><td>All changes to the doc Subversion repository
		(except for <code class="filename">user</code>,
		<code class="filename">projects</code> and
		<code class="filename">translations</code>)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-head" target="_top">svn-doc-head</a></td><td><code class="filename">/usr/doc</code></td><td>All changes to the <span class="quote">&#8220;<span class="quote">head</span>&#8221;</span> branch of
		the doc Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-projects" target="_top">svn-doc-projects</a></td><td><code class="filename">/usr/doc/projects</code></td><td>All changes to the <code class="filename">projects</code>
		area of the doc Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-doc-svnadmin" target="_top">svn-doc-svnadmin</a></td><td><code class="filename">/usr/doc</code></td><td>All changes to the administrative scripts, hooks,
		and other configuration data of the doc Subversion
		repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-ports-all" target="_top">svn-ports-all</a></td><td><code class="filename">/usr/ports</code></td><td>All changes to the ports Subversion
		repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-ports-head" target="_top">svn-ports-head</a></td><td><code class="filename">/usr/ports</code></td><td>All changes to the <span class="quote">&#8220;<span class="quote">head</span>&#8221;</span> branch
		of the ports Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-ports-svnadmin" target="_top">svn-ports-svnadmin</a></td><td><code class="filename">/usr/ports</code></td><td>All changes to the administrative scripts, hooks,
		and other configuration data of the ports Subversion
		repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-all" target="_top">svn-src-all</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the src Subversion repository
		(except for <code class="filename">user</code>
		and <code class="filename">projects</code>)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-head" target="_top">svn-src-head</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the <span class="quote">&#8220;<span class="quote">head</span>&#8221;</span> branch
		of the src Subversion repository (the FreeBSD-CURRENT
		branch)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-projects" target="_top">svn-src-projects</a></td><td><code class="filename">/usr/projects</code></td><td>All changes to the <code class="filename">projects</code>
		area of the src Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-release" target="_top">svn-src-release</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the <code class="filename">releases</code>
		area of the src Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-releng" target="_top">svn-src-releng</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the <code class="filename">releng</code>
		branches of the src Subversion repository (the
		security / release engineering branches)</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable" target="_top">svn-src-stable</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the all stable branches of the src
		Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-6" target="_top">svn-src-stable-6</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the <code class="filename">stable/6</code>
		branch of the src Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-7" target="_top">svn-src-stable-7</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the <code class="filename">stable/7</code>
		branch of the src Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-8" target="_top">svn-src-stable-8</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the <code class="filename">stable/8</code>
		branch of the src Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-9" target="_top">svn-src-stable-9</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the <code class="filename">stable/9</code>
		branch of the src Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-10" target="_top">svn-src-stable-10</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the <code class="filename">stable/10</code>
		branch of the src Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-11" target="_top">svn-src-stable-11</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the <code class="filename">stable/11</code>
		branch of the src Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-12" target="_top">svn-src-stable-12</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the <code class="filename">stable/12</code>
		branch of the src Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-stable-other" target="_top">svn-src-stable-other</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the
		older <code class="filename">stable</code> branches of the src
		Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-svnadmin" target="_top">svn-src-svnadmin</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the administrative scripts, hooks,
		and other configuration data of the src Subversion
		repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-user" target="_top">svn-src-user</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the
		experimental <code class="filename">user</code> area of the src
		Subversion repository</td></tr><tr><td><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/svn-src-vendor" target="_top">svn-src-vendor</a></td><td><code class="filename">/usr/src</code></td><td>All changes to the vendor work area of the src
		Subversion repository</td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="eresources-subscribe"></a>C.2.2. How to Subscribe</h3></div></div></div><p>To subscribe to a list, click the list name at
	<a class="link" href="http://lists.FreeBSD.org/mailman/listinfo" target="_top">http://lists.FreeBSD.org/mailman/listinfo</a>.  The page that is displayed should
	contain all of the necessary subscription instructions for
	that list.</p><p>To actually post to a given list, send mail to
	<code class="email">&lt;<a xmlns="" class="email" href="mailto:listname@FreeBSD.org"><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>listname</code></em>@FreeBSD.org</a>&gt;</code>.
	It will then be redistributed to mailing list members
	world-wide.</p><p>To unsubscribe from a list, click on the URL found at the
	bottom of every email received from the list.  It is also
	possible to send an email to
	<code class="email">&lt;<a xmlns="" class="email" href="mailto:listname-unsubscribe@FreeBSD.org"><em xmlns="http://www.w3.org/1999/xhtml" class="replaceable"><code>listname</code></em>-unsubscribe@FreeBSD.org</a>&gt;</code>
	to unsubscribe.</p><p>It is important to keep discussion in the technical
	mailing lists on a technical track.  To only receive important
	announcements, instead join the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce" target="_top">FreeBSD announcements mailing list</a>, which is
	intended for infrequent traffic.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="eresources-charters"></a>C.2.3. List Charters</h3></div></div></div><p><span class="emphasis"><em>All</em></span> FreeBSD mailing lists have certain
	basic rules which must be adhered to by anyone using them.
	Failure to comply with these guidelines will result in two (2)
	written warnings from the FreeBSD Postmaster
	<code class="email">&lt;<a xmlns="" class="email" href="mailto:postmaster@FreeBSD.org">postmaster@FreeBSD.org</a>&gt;</code>, after which, on a third
	offense, the poster will removed from all FreeBSD mailing lists
	and filtered from further posting to them.  We regret that
	such rules and measures are necessary at all, but today's
	Internet is a pretty harsh environment, it would seem, and
	many fail to appreciate just how fragile some of its
	mechanisms are.</p><p>Rules of the road:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The topic of any posting should adhere to the basic
	    charter of the list it is posted to.  If the list is about
	    technical issues, the posting should contain technical
	    discussion.  Ongoing irrelevant chatter or flaming only
	    detracts from the value of the mailing list for everyone
	    on it and will not be tolerated.  For free-form discussion
	    on no particular topic, the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">FreeBSD chat mailing list</a> is freely available
	    and should be used instead.</p></li><li class="listitem"><p>No posting should be made to more than 2 mailing
	    lists, and only to 2 when a clear and obvious need to post
	    to both lists exists.  For most lists, there is already a
	    great deal of subscriber overlap and except for the most
	    esoteric mixes (say <span class="quote">&#8220;<span class="quote">-stable &amp; -scsi</span>&#8221;</span>),
	    there really is no reason to post to more than one list at
	    a time.  If a message is received with multiple mailing
	    lists on the <code class="literal">Cc</code> line, trim the
	    <code class="literal">Cc</code> line before replying.  <span class="emphasis"><em>The
	      person who replies is still responsible for
	      cross-posting, no matter who the originator might have
	      been.</em></span></p></li><li class="listitem"><p>Personal attacks and profanity (in the context of an
	    argument) are not allowed, and that includes users and
	    developers alike.  Gross breaches of netiquette, like
	    excerpting or reposting private mail when permission to do
	    so was not and would not be forthcoming, are frowned upon
	    but not specifically enforced.
	    <span class="emphasis"><em>However</em></span>, there are also very few
	    cases where such content would fit within the charter of a
	    list and it would therefore probably rate a warning (or
	    ban) on that basis alone.</p></li><li class="listitem"><p>Advertising of non-FreeBSD related products or services
	    is strictly prohibited and will result in an immediate ban
	    if it is clear that the offender is advertising by
	    spam.</p></li></ul></div><p><span class="emphasis"><em>Individual list charters:</em></span></p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a></span></dt><dd><p><span class="emphasis"><em>ACPI and power management
		development</em></span></p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-announce" target="_top">freebsd-announce</a></span></dt><dd><p><span class="emphasis"><em>Important events /
		milestones</em></span></p><p>This is the mailing list for people interested only
	      in occasional announcements of significant FreeBSD events.
	      This includes announcements about snapshots and other
	      releases.  It contains announcements of new FreeBSD
	      capabilities.  It may contain calls for volunteers etc.
	      This is a low volume, strictly moderated mailing
	      list.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-arch" target="_top">freebsd-arch</a></span></dt><dd><p><span class="emphasis"><em>Architecture and design
		discussions</em></span></p><p>This list is for discussion of the FreeBSD
	      architecture.  Messages will mostly be kept strictly
	      technical in nature.  Examples of suitable topics
	      are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>How to re-vamp the build system to have several
		  customized builds running at the same time.</p></li><li class="listitem"><p>What needs to be fixed with VFS to make
		  Heidemann layers work.</p></li><li class="listitem"><p>How do we change the device driver interface
		  to be able to use the same drivers cleanly on many
		  buses and architectures.</p></li><li class="listitem"><p>How to write a network driver.</p></li></ul></div></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bluetooth" target="_top">freebsd-bluetooth</a></span></dt><dd><p><span class="emphasis"><em><span class="trademark">Bluetooth</span>® in FreeBSD</em></span></p><p>This is the forum where FreeBSD's <span class="trademark">Bluetooth</span>® users
	      congregate.  Design issues, implementation details,
	      patches, bug reports, status reports, feature requests,
	      and all matters related to <span class="trademark">Bluetooth</span>® are fair
	      game.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugbusters" target="_top">freebsd-bugbusters</a></span></dt><dd><p><span class="emphasis"><em>Coordination of the Problem Report
		handling effort</em></span></p><p>The purpose of this list is to serve as a
	      coordination and discussion forum for the Bugmeister,
	      his Bugbusters, and any other parties who have a genuine
	      interest in the PR database.  This list is not for
	      discussions about specific bugs, patches or PRs.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-bugs" target="_top">freebsd-bugs</a></span></dt><dd><p><span class="emphasis"><em>Bug reports</em></span></p><p>This is the mailing list for reporting bugs in FreeBSD.
	      Whenever possible, bugs should be submitted using the
	      <a class="link" href="https://bugs.freebsd.org/bugzilla/enter_bug.cgi" target="_top">web
		interface</a> to it.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">freebsd-chat</a></span></dt><dd><p><span class="emphasis"><em>Non technical items related to the FreeBSD
		community</em></span></p><p>This list contains the overflow from the other lists
	      about non-technical, social information.  It includes
	      discussion about whether Jordan looks like a toon ferret
	      or not, whether or not to type in capitals, who is
	      drinking too much coffee, where the best beer is brewed,
	      who is brewing beer in their basement, and so on.
	      Occasional announcements of important events (such as
	      upcoming parties, weddings, births, new jobs, etc) can
	      be made to the technical lists, but the follow ups
	      should be directed to this -chat list.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chromium" target="_top">freebsd-chromium</a></span></dt><dd><p><span class="emphasis"><em>FreeBSD-specific Chromium
		issues</em></span></p><p>This is a list for the discussion of Chromium
	      support for FreeBSD.  This is a technical list to
	      discuss development and installation of Chromium.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-cloud" target="_top">freebsd-cloud</a></span></dt><dd><p><span class="emphasis"><em>Running FreeBSD on various cloud
		platforms</em></span></p><p>This list discusses running FreeBSD on Amazon EC2,
	      Google Compute Engine, Microsoft Azure, and other cloud
	      computing platforms.</p></dd><dt><span class="term">freebsd-core</span></dt><dd><p><span class="emphasis"><em>FreeBSD core team</em></span></p><p>This is an internal mailing list for use by the core
	      members.  Messages can be sent to it when a serious
	      FreeBSD-related matter requires arbitration or
	      high-level scrutiny.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a></span></dt><dd><p><span class="emphasis"><em>Discussions about the use of
		FreeBSD-CURRENT</em></span></p><p>This is the mailing list for users of FreeBSD-CURRENT.
	      It includes warnings about new features coming out in
	      -CURRENT that will affect the users, and instructions
	      on steps that must be taken to remain -CURRENT.  Anyone
	      running <span class="quote">&#8220;<span class="quote">CURRENT</span>&#8221;</span> must subscribe to this
	      list.  This is a technical mailing list for which
	      strictly technical content is expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-desktop" target="_top">freebsd-desktop</a></span></dt><dd><p><span class="emphasis"><em>Using and improving FreeBSD on the
		desktop</em></span></p><p>This is a forum for discussion of FreeBSD on the
	      desktop.  It is primarily a place for desktop porters
	      and users to discuss issues and improve FreeBSD's desktop
	      support.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/dev-ci" target="_top">dev-ci</a></span></dt><dd><p><span class="emphasis"><em>Continuous Integration reports of build
		and test results</em></span></p><p>All Continuous Integration reports of build and test
	      results</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/dev-reviews" target="_top">dev-reviews</a></span></dt><dd><p><span class="emphasis"><em>Notifications of work in progress in
		FreeBSD's review tool</em></span></p><p>Automated notifications of work in progress for
	      review in FreeBSD's review tools, including
	      patches.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-doc" target="_top">freebsd-doc</a></span></dt><dd><p><span class="emphasis"><em>Documentation Project</em></span></p><p>This mailing list is for the discussion of issues
	      and projects related to the creation of documentation
	      for FreeBSD.  The members of this mailing list are
	      collectively referred to as <span class="quote">&#8220;<span class="quote">The FreeBSD
	      Documentation Project</span>&#8221;</span>.  It is an open list; feel
	      free to join and contribute!</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-drivers" target="_top">freebsd-drivers</a></span></dt><dd><p><span class="emphasis"><em>Writing device drivers for
		FreeBSD</em></span></p><p>This is a forum for technical discussions related to
	      device drivers on FreeBSD.  It is primarily a place for
	      device driver writers to ask questions about how to
	      write device drivers using the APIs in the FreeBSD
	      kernel.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-dtrace" target="_top">freebsd-dtrace</a></span></dt><dd><p><span class="emphasis"><em>Using and working on DTrace in
		FreeBSD</em></span></p><p>DTrace is an integrated component of FreeBSD that
	      provides a framework for understanding the kernel as
	      well as user space programs at run time.  The mailing
	      list is an archived discussion for developers of the
	      code as well as those using it.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eclipse" target="_top">freebsd-eclipse</a></span></dt><dd><p><span class="emphasis"><em>FreeBSD users of Eclipse IDE, tools, rich
		client applications and ports.</em></span></p><p>The intention of this list is to provide mutual
	      support for everything to do with choosing, installing,
	      using, developing and maintaining the Eclipse IDE,
	      tools, rich client applications on the FreeBSD platform and
	      assisting with the porting of Eclipse IDE and plugins to
	      the FreeBSD environment.</p><p>The intention is also to facilitate exchange of
	      information between the Eclipse community and the FreeBSD
	      community to the mutual benefit of both.</p><p>Although this list is focused primarily on the needs
	      of Eclipse users it will also provide a forum for those
	      who would like to develop FreeBSD specific applications
	      using the Eclipse framework.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-embedded" target="_top">freebsd-embedded</a></span></dt><dd><p><span class="emphasis"><em>Using FreeBSD in embedded
		applications</em></span></p><p>This list discusses topics related to using FreeBSD in
	      embedded systems.  This is a technical mailing list for
	      which strictly technical content is expected.  For the
	      purpose of this list, embedded systems are those
	      computing devices which are not desktops and which
	      usually serve a single purpose as opposed to being
	      general computing environments.  Examples include, but
	      are not limited to, all kinds of phone handsets, network
	      equipment such as routers, switches and PBXs, remote
	      measuring equipment, PDAs, Point Of Sale systems, and so
	      on.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-emulation" target="_top">freebsd-emulation</a></span></dt><dd><p><span class="emphasis"><em>Emulation of other systems such as
		Linux/<span class="trademark">MS-DOS</span>®/<span class="trademark">Windows</span>®</em></span></p><p>This is a forum for technical discussions related
	      to running programs written for other operating systems
	      on FreeBSD.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-enlightenment" target="_top">freebsd-enlightenment</a></span></dt><dd><p><span class="emphasis"><em>Enlightenment</em></span></p><p>Discussions concerning the
	      <span class="application">Enlightenment</span> Desktop
	      Environment for FreeBSD systems.  This is a technical
	      mailing list for which strictly technical content is
	      expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-eol" target="_top">freebsd-eol</a></span></dt><dd><p><span class="emphasis"><em>Peer support of FreeBSD-related software
		that is no longer supported by the FreeBSD
		Project.</em></span></p><p>This list is for those interested in providing or
	      making use of peer support of FreeBSD-related software for
	      which the FreeBSD Project no longer provides official
	      support in the form of security advisories and
	      patches.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-firewire" target="_top">freebsd-firewire</a></span></dt><dd><p><span class="emphasis"><em><span class="trademark">FireWire</span>® (iLink, IEEE
		1394)</em></span></p><p>This is a mailing list for discussion of the design
	      and implementation of a <span class="trademark">FireWire</span>® (aka IEEE 1394 aka
	      iLink) subsystem for FreeBSD.  Relevant topics specifically
	      include the standards, bus devices and their protocols,
	      adapter boards/cards/chips sets, and the architecture
	      and implementation of code for their proper
	      support.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fortran" target="_top">freebsd-fortran</a></span></dt><dd><p><span class="emphasis"><em>Fortran on FreeBSD</em></span></p><p>This is the mailing list for discussion of Fortran
	      related ports on FreeBSD: compilers, libraries, scientific
	      and engineering applications from laptops to HPC
	      clusters.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-fs" target="_top">freebsd-fs</a></span></dt><dd><p><span class="emphasis"><em>File systems</em></span></p><p>Discussions concerning FreeBSD filesystems.  This is a
	      technical mailing list for which strictly technical
	      content is expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-games" target="_top">freebsd-games</a></span></dt><dd><p><span class="emphasis"><em>Games on FreeBSD</em></span></p><p>This is a technical list for discussions related to
	      bringing games to FreeBSD.  It is for individuals actively
	      working on porting games to FreeBSD, to bring up problems
	      or discuss alternative solutions.  Individuals
	      interested in following the technical discussion are
	      also welcome.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gecko" target="_top">freebsd-gecko</a></span></dt><dd><p><span class="emphasis"><em>Gecko Rendering Engine</em></span></p><p>This is a forum about
	      <span class="application">Gecko</span> applications using
	      FreeBSD.</p><p>Discussion centers around Gecko Ports applications,
	      their installation, their development and their support
	      within FreeBSD.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-geom" target="_top">freebsd-geom</a></span></dt><dd><p><span class="emphasis"><em>GEOM</em></span></p><p>Discussions specific to GEOM and related
	      implementations.  This is a technical mailing list for
	      which strictly technical content is expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-git" target="_top">freebsd-git</a></span></dt><dd><p><span class="emphasis"><em>Use of git in the FreeBSD
		project</em></span></p><p>Discussions of how to use git in FreeBSD
	      infrastructure including the github mirror and other
	      uses of git for project collaboration.  Discussion area
	      for people using git against the FreeBSD github mirror.
	      People wanting to get started with the mirror or git
	      in general on FreeBSD can ask here.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-gnome" target="_top">freebsd-gnome</a></span></dt><dd><p><span class="emphasis"><em>GNOME</em></span></p><p>Discussions concerning The
	      <span class="application">GNOME</span> Desktop Environment
	      for FreeBSD systems.  This is a technical mailing list
	      for which strictly technical content is expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-infiniband" target="_top">freebsd-infiniband</a></span></dt><dd><p><span class="emphasis"><em>Infiniband on FreeBSD</em></span></p><p>Technical mailing list discussing Infiniband, OFED,
	      and OpenSM on FreeBSD.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ipfw" target="_top">freebsd-ipfw</a></span></dt><dd><p><span class="emphasis"><em>IP Firewall</em></span></p><p>This is the forum for technical discussions
	      concerning the redesign of the IP firewall code in
	      FreeBSD.  This is a technical mailing list for which
	      strictly technical content is expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isdn" target="_top">freebsd-isdn</a></span></dt><dd><p><span class="emphasis"><em>ISDN Communications</em></span></p><p>This is the mailing list for people discussing the
	      development of ISDN support for FreeBSD.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-java" target="_top">freebsd-java</a></span></dt><dd><p><span class="emphasis"><em><span class="trademark">Java</span>&#8482; Development</em></span></p><p>This is the mailing list for people discussing the
	      development of significant <span class="trademark">Java</span>&#8482; applications for FreeBSD
	      and the porting and maintenance of <span class="trademark">JDK</span>&#8482;s.</p></dd><dt><a id="eresources-charters-jobs"></a><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-jobs" target="_top">freebsd-jobs</a></span></dt><dd><p><span class="emphasis"><em>Jobs offered and sought</em></span></p><p>This is a forum for posting employment notices
	      specifically related to FreeBSD and resumes from those
	      seeking FreeBSD-related employment.  This is
	      <span class="emphasis"><em>not</em></span> a mailing list for general
	      employment issues since adequate forums for that already
	      exist elsewhere.</p><p>Note that this list, like other <code class="systemitem">FreeBSD.org</code>
	      mailing lists, is distributed worldwide.  Be clear about
	      the geographic location and the extent to which
	      telecommuting or assistance with relocation is
	      available.</p><p>Email should use open formats only &#8212;
	      preferably plain text, but basic Portable Document
	      Format (<acronym class="acronym">PDF</acronym>), HTML, and a few others
	      are acceptable to many readers.  Closed formats such as
	      <span class="trademark">Microsoft</span>® Word (<code class="filename">.doc</code>) will be
	      rejected by the mailing list server.</p></dd><dt><span class="term"><a class="link" href="https://mail.kde.org/mailman/listinfo/kde-freebsd" target="_top">freebsd-kde</a></span></dt><dd><p><span class="emphasis"><em>KDE</em></span></p><p>Discussions concerning
	      <span class="application">KDE</span> on FreeBSD systems.
	      This is a technical mailing list for which strictly
	      technical content is expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hackers" target="_top">freebsd-hackers</a></span></dt><dd><p><span class="emphasis"><em>Technical discussions</em></span></p><p>This is a forum for technical discussions related
	      to FreeBSD.  This is the primary technical mailing list.
	      It is for individuals actively working on FreeBSD, to bring
	      up problems or discuss alternative solutions.
	      Individuals interested in following the technical
	      discussion are also welcome.  This is a technical
	      mailing list for which strictly technical content is
	      expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hardware" target="_top">freebsd-hardware</a></span></dt><dd><p><span class="emphasis"><em>General discussion of FreeBSD
		hardware</em></span></p><p>General discussion about the types of hardware that
	      FreeBSD runs on, various problems and suggestions
	      concerning what to buy or avoid.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-hubs" target="_top">freebsd-hubs</a></span></dt><dd><p><span class="emphasis"><em>Mirror sites</em></span></p><p>Announcements and discussion for people who run FreeBSD
	      mirror sites.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp" target="_top">freebsd-isp</a></span></dt><dd><p><span class="emphasis"><em>Issues for Internet Service
		Providers</em></span></p><p>This mailing list is for discussing topics relevant
	      to Internet Service Providers (ISPs) using FreeBSD.  This
	      is a technical mailing list for which strictly technical
	      content is expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-mono" target="_top">freebsd-mono</a></span></dt><dd><p><span class="emphasis"><em>Mono and C# applications on
		FreeBSD</em></span></p><p>This is a list for discussions related to the Mono
	      development framework on FreeBSD.  This is a technical
	      mailing list.  It is for individuals actively working on
	      porting Mono or C# applications to FreeBSD, to bring up
	      problems or discuss alternative solutions.  Individuals
	      interested in following the technical discussion are
	      also welcome.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ocaml" target="_top">freebsd-ocaml</a></span></dt><dd><p><span class="emphasis"><em>FreeBSD-specific OCaml
		discussions</em></span></p><p>This is a list for discussions related to the OCaml
	      support on FreeBSD.  This is a technical mailing list. It
	      is for individuals working on OCaml ports, 3rd party
	      libraries and frameworks.  Individuals interested in the
	      technical discussion are also welcome.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-office" target="_top">freebsd-office</a></span></dt><dd><p><span class="emphasis"><em>Office applications on
		FreeBSD</em></span></p><p>Discussion centers around office applications, their
	      installation, their development and their support within
	      FreeBSD.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ops-announce" target="_top">freebsd-ops-announce</a></span></dt><dd><p><span class="emphasis"><em>Project Infrastructure
		Announcements</em></span></p><p>This is the mailing list for people interested in
	      changes and issues related to the FreeBSD.org Project
	      infrastructure.</p><p>This moderated list is strictly for announcements:
	      no replies, requests, discussions, or opinions.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-performance" target="_top">freebsd-performance</a></span></dt><dd><p><span class="emphasis"><em>Discussions about tuning or speeding up
		FreeBSD</em></span></p><p>This mailing list exists to provide a place for
	      hackers, administrators, and/or concerned parties to
	      discuss performance related topics pertaining to FreeBSD.
	      Acceptable topics includes talking about FreeBSD
	      installations that are either under high load, are
	      experiencing performance problems, or are pushing the
	      limits of FreeBSD.  Concerned parties that are willing to
	      work toward improving the performance of FreeBSD are highly
	      encouraged to subscribe to this list.  This is a highly
	      technical list ideally suited for experienced FreeBSD
	      users, hackers, or administrators interested in keeping
	      FreeBSD fast, robust, and scalable.  This list is not a
	      question-and-answer list that replaces reading through
	      documentation, but it is a place to make contributions
	      or inquire about unanswered performance related
	      topics.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf" target="_top">freebsd-pf</a></span></dt><dd><p><span class="emphasis"><em>Discussion and questions about the packet
		filter firewall system</em></span></p><p>Discussion concerning the packet filter (pf)
	      firewall system in terms of FreeBSD.  Technical discussion
	      and user questions are both welcome.  This list is also
	      a place to discuss the ALTQ QoS framework.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg" target="_top">freebsd-pkg</a></span></dt><dd><p><span class="emphasis"><em>Binary package management and package
		tools discussion</em></span></p><p>Discussion of all aspects of managing FreeBSD systems
	      by using binary packages to install software, including
	      binary package toolkits and formats, their development
	      and support within FreeBSD, package repository management,
	      and third party packages.</p><p>Note that discussion of ports which fail to generate
	      packages correctly should generally be considered as
	      ports problems, and so inappropriate for this
	      list.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkg-fallout" target="_top">freebsd-pkg-fallout</a></span></dt><dd><p><span class="emphasis"><em>Fallout logs from package
		building</em></span></p><p>All packages building failures logs from the package
	      building clusters</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pkgbase" target="_top">freebsd-pkgbase</a></span></dt><dd><p><span class="emphasis"><em>Packaging the FreeBSD base
		system.</em></span></p><p>Discussions surrounding implementation and issues
	      regarding packaging the FreeBSD base system.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-platforms" target="_top">freebsd-platforms</a></span></dt><dd><p><span class="emphasis"><em>Porting to Non <span class="trademark">Intel</span>®
		platforms</em></span></p><p>Cross-platform FreeBSD issues, general discussion and
	      proposals for non <span class="trademark">Intel</span>® FreeBSD ports.  This is a
	      technical mailing list for which strictly technical
	      content is expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports" target="_top">freebsd-ports</a></span></dt><dd><p><span class="emphasis"><em>Discussion of
		<span class="quote">&#8220;<span class="quote">ports</span>&#8221;</span></em></span></p><p>Discussions concerning FreeBSD's <span class="quote">&#8220;<span class="quote">ports
		collection</span>&#8221;</span> (<code class="filename">/usr/ports</code>),
	      ports infrastructure, and general ports coordination
	      efforts.  This is a technical mailing list for which
	      strictly technical content is expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-announce" target="_top">freebsd-ports-announce</a></span></dt><dd><p><span class="emphasis"><em>Important news and instructions about the
		FreeBSD <span class="quote">&#8220;<span class="quote">Ports
		  Collection</span>&#8221;</span></em></span></p><p>Important news for developers, porters, and users of
	      the <span class="quote">&#8220;<span class="quote">Ports Collection</span>&#8221;</span>
	      (<code class="filename">/usr/ports</code>), including
	      architecture/infrastructure changes, new capabilities,
	      critical upgrade instructions, and release engineering
	      information.  This is a low-volume mailing list,
	      intended for announcements.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports-bugs" target="_top">freebsd-ports-bugs</a></span></dt><dd><p><span class="emphasis"><em>Discussion of
		<span class="quote">&#8220;<span class="quote">ports</span>&#8221;</span> bugs</em></span></p><p>Discussions concerning problem reports for FreeBSD's
	      <span class="quote">&#8220;<span class="quote">ports collection</span>&#8221;</span>
	      (<code class="filename">/usr/ports</code>), proposed ports, or
	      modifications to ports.  This is a technical mailing
	      list for which strictly technical content is
	      expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-proliant" target="_top">freebsd-proliant</a></span></dt><dd><p><span class="emphasis"><em>Technical discussion of FreeBSD on HP
		ProLiant server platforms</em></span></p><p>This mailing list is to be used for the technical
	      discussion of the usage of FreeBSD on HP ProLiant servers,
	      including the discussion of ProLiant-specific drivers,
	      management software, configuration tools, and BIOS
	      updates.  As such, this is the primary place to discuss
	      the hpasmd, hpasmcli, and hpacucli modules.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-python" target="_top">freebsd-python</a></span></dt><dd><p><span class="emphasis"><em>Python on FreeBSD</em></span></p><p>This is a list for discussions related to improving
	      Python-support on FreeBSD.  This is a technical mailing
	      list.  It is for individuals working on porting Python,
	      its third party modules and
	      <span class="application">Zope</span> stuff to FreeBSD.
	      Individuals interested in following the technical
	      discussion are also welcome.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">freebsd-questions</a></span></dt><dd><p><span class="emphasis"><em>User questions</em></span></p><p>This is the mailing list for questions about FreeBSD.
	      Do not send <span class="quote">&#8220;<span class="quote">how to</span>&#8221;</span> questions to the
	      technical lists unless the question is quite
	      technical.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ruby" target="_top">freebsd-ruby</a></span></dt><dd><p><span class="emphasis"><em>FreeBSD-specific Ruby
		discussions</em></span></p><p>This is a list for discussions related to the Ruby
	      support on FreeBSD.  This is a technical mailing list.  It
	      is for individuals working on Ruby ports, third party
	      libraries and frameworks.</p><p>Individuals interested in the technical discussion
	      are also welcome.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-scsi" target="_top">freebsd-scsi</a></span></dt><dd><p><span class="emphasis"><em>SCSI subsystem</em></span></p><p>This is the mailing list for people working on the
	      SCSI subsystem for FreeBSD.  This is a technical mailing
	      list for which strictly technical content is
	      expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security" target="_top">freebsd-security</a></span></dt><dd><p><span class="emphasis"><em>Security issues</em></span></p><p>FreeBSD computer security issues (DES, Kerberos, known
	      security holes and fixes, etc).  This is a technical
	      mailing list for which strictly technical discussion is
	      expected.  Note that this is not a question-and-answer
	      list, but that contributions (BOTH question AND answer)
	      to the FAQ are welcome.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-security-notifications" target="_top">freebsd-security-notifications</a></span></dt><dd><p><span class="emphasis"><em>Security Notifications</em></span></p><p>Notifications of FreeBSD security problems and fixes.
	      This is not a discussion list.  The discussion list is
	      FreeBSD-security.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-snapshots" target="_top">freebsd-snapshots</a></span></dt><dd><p><span class="emphasis"><em>FreeBSD Development Snapshot
		Announcements</em></span></p><p>This list provides notifications about the
	      availability of new FreeBSD development snapshots for the
	      head/ and stable/ branches.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable" target="_top">freebsd-stable</a></span></dt><dd><p><span class="emphasis"><em>Discussions about the use of
		FreeBSD-STABLE</em></span></p><p>This is the mailing list for users of FreeBSD-STABLE.
	      <span class="quote">&#8220;<span class="quote">STABLE</span>&#8221;</span> is the branch where development
	      continues after a RELEASE, including bug fixes and new
	      features.  The ABI is kept stable for binary
	      compatibility.  It includes warnings about new features
	      coming out in -STABLE that will affect the users, and
	      instructions on steps that must be taken to remain
	      -STABLE.  Anyone running <span class="quote">&#8220;<span class="quote">STABLE</span>&#8221;</span> should
	      subscribe to this list.  This is a technical mailing
	      list for which strictly technical content is
	      expected.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-standards" target="_top">freebsd-standards</a></span></dt><dd><p><span class="emphasis"><em>C99 &amp; POSIX
		Conformance</em></span></p><p>This is a forum for technical discussions related to
	      FreeBSD Conformance to the C99 and the POSIX
	      standards.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-teaching" target="_top">freebsd-teaching</a></span></dt><dd><p><span class="emphasis"><em>Teaching with FreeBSD</em></span></p><p>Non technical mailing list discussing teaching
	      with FreeBSD.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-testing" target="_top">freebsd-testing</a></span></dt><dd><p><span class="emphasis"><em>Testing on FreeBSD</em></span></p><p>Technical mailing list discussing testing on FreeBSD,
	      including ATF/Kyua, test build infrastructure, port
	      tests to FreeBSD from other operating systems (NetBSD,
	      ...), etc.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-tex" target="_top">freebsd-tex</a></span></dt><dd><p><span class="emphasis"><em>Porting <span class="application">TeX</span> and
		its applications to FreeBSD</em></span></p><p>This is a technical mailing list for discussions
	      related to TeX and its applications on FreeBSD.  It is for
	      individuals actively working on porting TeX to FreeBSD,
	      to bring up problems or discuss alternative solutions.
	      Individuals interested in following the technical
	      discussion are also welcome.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-toolchain" target="_top">freebsd-toolchain</a></span></dt><dd><p><span class="emphasis"><em>Maintenance of FreeBSD's integrated
		toolchain</em></span></p><p>This is the mailing list for discussions related to
	      the maintenance of the toolchain shipped with FreeBSD.
	      This could include the state of Clang and GCC, but also
	      pieces of software such as assemblers, linkers and
	      debuggers.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-transport" target="_top">freebsd-transport</a></span></dt><dd><p><span class="emphasis"><em>Discussions of transport level network
		protocols in FreeBSD</em></span></p><p>The transport mailing list exists for the discussion
	      of issues and designs around the transport level
	      protocols in the FreeBSD network stack, including TCP,
	      SCTP and UDP.  Other networking topics, including
	      driver specific and network protocol issues should be
	      discussed on the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-net" target="_top">FreeBSD networking mailing list</a>.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-translators" target="_top">freebsd-translators</a></span></dt><dd><p><span class="emphasis"><em>Translating FreeBSD documents and
		programs</em></span></p><p>A discussion list where translators of FreeBSD
	      documents from English into other languages can talk
	      about translation methods and tools.  New members are
	      asked to introduce themselves and mention the languages
	      they are interested in translating.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-usb" target="_top">freebsd-usb</a></span></dt><dd><p><span class="emphasis"><em>Discussing FreeBSD support for
		USB</em></span></p><p>This is a mailing list for technical discussions
	      related to FreeBSD support for USB.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-user-groups" target="_top">freebsd-user-groups</a></span></dt><dd><p><span class="emphasis"><em>User Group Coordination
		List</em></span></p><p>This is the mailing list for the coordinators from
	      each of the local area Users Groups to discuss matters
	      with each other and a designated individual from the
	      Core Team.  This mail list should be limited to meeting
	      synopsis and coordination of projects that span User
	      Groups.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-virtualization" target="_top">freebsd-virtualization</a></span></dt><dd><p><span class="emphasis"><em>Discussion of various virtualization
		techniques supported by FreeBSD</em></span></p><p>A list to discuss the various virtualization
	      techniques supported by FreeBSD.  On one hand the focus
	      will be on the implementation of the basic functionality
	      as well as adding new features.  On the other hand users
	      will have a forum to ask for help in case of problems or
	      to discuss their use cases.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wip-status" target="_top">freebsd-wip-status</a></span></dt><dd><p><span class="emphasis"><em>FreeBSD Work-In-Progress
		Status</em></span></p><p>This mailing list can be used by developers to
	      announce the creation and progress of FreeBSD related work.
	      Messages will be moderated.  It is suggested to send the
	      message "To:" a more topical FreeBSD list and only "BCC:"
	      this list.  This way the WIP can also be discussed on
	      the topical list, as no discussion is allowed on this
	      list.</p><p>Look inside the archives for examples of suitable
	      messages.</p><p>An editorial digest of the messages to this list
	      might be posted to the FreeBSD website every few months as
	      part of the Status Reports
	      <a href="#ftn.idp74580600" class="footnote" id="idp74580600"><sup class="footnote">[3]</sup></a>.
	      Past reports are archived.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-wireless" target="_top">freebsd-wireless</a></span></dt><dd><p><span class="emphasis"><em>Discussions of 802.11 stack, tools device
		driver development</em></span></p><p>The FreeBSD-wireless list focuses on 802.11 stack
	      (sys/net80211), device driver and tools development.
	      This includes bugs, new features and maintenance.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xen" target="_top">freebsd-xen</a></span></dt><dd><p><span class="emphasis"><em>Discussion of the FreeBSD port to <span class="trademark">Xen</span>&#8482;
		&#8212; implementation and usage</em></span></p><p>A list that focuses on the FreeBSD <span class="trademark">Xen</span>&#8482; port.  The
	      anticipated traffic level is small enough that it is
	      intended as a forum for both technical discussions of
	      the implementation and design details as well as
	      administrative deployment issues.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-xfce" target="_top">freebsd-xfce</a></span></dt><dd><p><span class="emphasis"><em>XFCE</em></span></p><p>This is a forum for discussions related to bring the
	      <span class="application">XFCE</span> environment to FreeBSD.
	      This is a technical mailing list.  It is for individuals
	      actively working on porting
	      <span class="application">XFCE</span> to FreeBSD, to bring up
	      problems or discuss alternative solutions.  Individuals
	      interested in following the technical discussion are
	      also welcome.</p></dd><dt><span class="term"><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-zope" target="_top">freebsd-zope</a></span></dt><dd><p><span class="emphasis"><em>Zope</em></span></p><p>This is a forum for discussions related to bring the
	      <span class="application">Zope</span> environment to FreeBSD.
	      This is a technical mailing list.  It is for individuals
	      actively working on porting
	      <span class="application">Zope</span> to FreeBSD, to bring up
	      problems or discuss alternative solutions.  Individuals
	      interested in following the technical discussion are
	      also welcome.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="eresources-mailfiltering"></a>C.2.4. Filtering on the Mailing Lists</h3></div></div></div><p>The FreeBSD mailing lists are filtered in multiple ways to
	avoid the distribution of spam, viruses, and other unwanted
	emails.  The filtering actions described in this section do
	not include all those used to protect the mailing
	lists.</p><p>Only certain types of attachments are allowed on the
	mailing lists.  All attachments with a MIME content type not
	found in the list below will be stripped before an email is
	distributed on the mailing lists.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>application/octet-stream</p></li><li class="listitem"><p>application/pdf</p></li><li class="listitem"><p>application/pgp-signature</p></li><li class="listitem"><p>application/x-pkcs7-signature</p></li><li class="listitem"><p>message/rfc822</p></li><li class="listitem"><p>multipart/alternative</p></li><li class="listitem"><p>multipart/related</p></li><li class="listitem"><p>multipart/signed</p></li><li class="listitem"><p>text/html</p></li><li class="listitem"><p>text/plain</p></li><li class="listitem"><p>text/x-diff</p></li><li class="listitem"><p>text/x-patch</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some of the mailing lists might allow attachments of
	  other MIME content types, but the above list should be
	  applicable for most of the mailing lists.</p></div><p>If an email contains both an HTML and a plain text
	version, the HTML version will be removed.  If an email
	contains only an HTML version, it will be converted to plain
	text.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="eresources-news"></a>C.3. Usenet Newsgroups</h2></div></div></div><p>In addition to two FreeBSD specific newsgroups, there are
      many others in which FreeBSD is discussed or are otherwise
      relevant to FreeBSD users.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74611320"></a>C.3.1. BSD Specific Newsgroups</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="news:comp.unix.bsd.freebsd.announce" target="_top">comp.unix.bsd.freebsd.announce</a></p></li><li class="listitem"><p><a class="link" href="news:comp.unix.bsd.freebsd.misc" target="_top">comp.unix.bsd.freebsd.misc</a></p></li><li class="listitem"><p><a class="link" href="news:de.comp.os.unix.bsd" target="_top">de.comp.os.unix.bsd</a>
	    (German)</p></li><li class="listitem"><p><a class="link" href="news:fr.comp.os.bsd" target="_top">fr.comp.os.bsd</a>
	    (French)</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74620920"></a>C.3.2. Other <span class="trademark">UNIX</span>® Newsgroups of Interest</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="news:comp.unix" target="_top">comp.unix</a></p></li><li class="listitem"><p><a class="link" href="news:comp.unix.questions" target="_top">comp.unix.questions</a></p></li><li class="listitem"><p><a class="link" href="news:comp.unix.admin" target="_top">comp.unix.admin</a></p></li><li class="listitem"><p><a class="link" href="news:comp.unix.programmer" target="_top">comp.unix.programmer</a></p></li><li class="listitem"><p><a class="link" href="news:comp.unix.shell" target="_top">comp.unix.shell</a></p></li><li class="listitem"><p><a class="link" href="news:comp.unix.misc" target="_top">comp.unix.misc</a></p></li><li class="listitem"><p><a class="link" href="news:comp.unix.bsd" target="_top">comp.unix.bsd</a></p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74654328"></a>C.3.3. X Window System</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="news:comp.windows.x" target="_top">comp.windows.x</a></p></li></ul></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="eresources-web"></a>C.4. Official Mirrors</h2></div></div></div><p><a class="link" href="#central-www">Central Servers</a>, <a class="link" href="#mirrors-am-www">Armenia</a>, <a class="link" href="#mirrors-au-www">Australia</a>, <a class="link" href="#mirrors-at-www">Austria</a>, <a class="link" href="#mirrors-cz-www">Czech Republic</a>, <a class="link" href="#mirrors-dk-www">Denmark</a>, <a class="link" href="#mirrors-fi-www">Finland</a>, <a class="link" href="#mirrors-fr-www">France</a>, <a class="link" href="#mirrors-de-www">Germany</a>, <a class="link" href="#mirrors-hk-www">Hong Kong</a>, <a class="link" href="#mirrors-ie-www">Ireland</a>, <a class="link" href="#mirrors-jp-www">Japan</a>, <a class="link" href="#mirrors-lv-www">Latvia</a>, <a class="link" href="#mirrors-lt-www">Lithuania</a>, <a class="link" href="#mirrors-nl-www">Netherlands</a>, <a class="link" href="#mirrors-no-www">Norway</a>, <a class="link" href="#mirrors-ru-www">Russia</a>, <a class="link" href="#mirrors-si-www">Slovenia</a>, <a class="link" href="#mirrors-za-www">South Africa</a>, <a class="link" href="#mirrors-es-www">Spain</a>, <a class="link" href="#mirrors-se-www">Sweden</a>, <a class="link" href="#mirrors-ch-www">Switzerland</a>, <a class="link" href="#mirrors-tw-www">Taiwan</a>, <a class="link" href="#mirrors-uk-www">United Kingdom</a>, <a class="link" href="#mirrors-us-www">USA</a>.</p><p>(as of   UTC)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a id="central-www"></a><p>Central Servers</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="https://www.FreeBSD.org/" target="_top">https://www.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-am-www"></a><p>Armenia</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="link" href="http://www1.am.FreeBSD.org/" target="_top">http://www1.am.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-au-www"></a><p>Australia</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.au.FreeBSD.org/" target="_top">http://www.au.FreeBSD.org/</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="http://www2.au.FreeBSD.org/" target="_top">http://www2.au.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-at-www"></a><p>Austria</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="link" href="http://www.at.FreeBSD.org/" target="_top">http://www.at.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-cz-www"></a><p>Czech Republic</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="link" href="http://www.cz.FreeBSD.org/" target="_top">http://www.cz.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-dk-www"></a><p>Denmark</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="link" href="http://www.dk.FreeBSD.org/" target="_top">http://www.dk.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-fi-www"></a><p>Finland</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.fi.FreeBSD.org/" target="_top">http://www.fi.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-fr-www"></a><p>France</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www1.fr.FreeBSD.org/" target="_top">http://www1.fr.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-de-www"></a><p>Germany</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.de.FreeBSD.org/" target="_top">http://www.de.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-hk-www"></a><p>Hong Kong</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.hk.FreeBSD.org/" target="_top">http://www.hk.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-ie-www"></a><p>Ireland</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.ie.FreeBSD.org/" target="_top">http://www.ie.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-jp-www"></a><p>Japan</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="link" href="http://www.jp.FreeBSD.org/www.FreeBSD.org/" target="_top">http://www.jp.FreeBSD.org/www.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-lv-www"></a><p>Latvia</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.lv.FreeBSD.org/" target="_top">http://www.lv.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-lt-www"></a><p>Lithuania</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.lt.FreeBSD.org/" target="_top">http://www.lt.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-nl-www"></a><p>Netherlands</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.nl.FreeBSD.org/" target="_top">http://www.nl.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-no-www"></a><p>Norway</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.no.FreeBSD.org/" target="_top">http://www.no.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-ru-www"></a><p>Russia</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="link" href="http://www.ru.FreeBSD.org/" target="_top">http://www.ru.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-si-www"></a><p>Slovenia</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.si.FreeBSD.org/" target="_top">http://www.si.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-za-www"></a><p>South Africa</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.za.FreeBSD.org/" target="_top">http://www.za.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-es-www"></a><p>Spain</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.es.FreeBSD.org/" target="_top">http://www.es.FreeBSD.org/</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="http://www2.es.FreeBSD.org/" target="_top">http://www2.es.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-se-www"></a><p>Sweden</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.se.FreeBSD.org/" target="_top">http://www.se.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-ch-www"></a><p>Switzerland</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="link" href="http://www.ch.FreeBSD.org/" target="_top">http://www.ch.FreeBSD.org/</a> (IPv6)</p></li><li class="listitem"><p><a class="link" href="http://www2.ch.FreeBSD.org/" target="_top">http://www2.ch.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-tw-www"></a><p>Taiwan</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www.tw.FreeBSD.org/" target="_top">http://www.tw.FreeBSD.org/</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="http://www2.tw.FreeBSD.org/" target="_top">http://www2.tw.FreeBSD.org/</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="http://www4.tw.FreeBSD.org/" target="_top">http://www4.tw.FreeBSD.org/</a>
        </p></li><li class="listitem"><p><a class="link" href="http://www5.tw.FreeBSD.org/" target="_top">http://www5.tw.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li><li class="listitem"><a id="mirrors-uk-www"></a><p>United Kingdom</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
          <a class="link" href="http://www1.uk.FreeBSD.org/" target="_top">http://www1.uk.FreeBSD.org/</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="http://www3.uk.FreeBSD.org/" target="_top">http://www3.uk.FreeBSD.org/</a>
        </p></li></ul></div></li><li class="listitem"><a id="mirrors-us-www"></a><p>USA</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><a class="link" href="http://www5.us.FreeBSD.org/" target="_top">http://www5.us.FreeBSD.org/</a> (IPv6)</p></li></ul></div></li></ul></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp74580600" class="footnote"><p><a href="#idp74580600" class="para"><sup class="para">[3] </sup></a><code class="uri"><a class="uri" href="https://www.freebsd.org/news/status/" target="_top">https://www.freebsd.org/news/status/</a></code></p></div></div></div><div class="appendix"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkeys"></a>Appendix D. Open<acronym class="acronym">PGP</acronym> Keys</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="#pgpkeys-officers">D.1. Officers</a></span></dt></dl></div><a id="idp74808696" class="indexterm"></a><p>The Open<acronym class="acronym">PGP</acronym> keys of the
    <code class="systemitem">FreeBSD.org</code> officers
    are shown here.  These keys can be used to verify a signature or
    send encrypted email to one of the officers.  A full list of FreeBSD
    Open<acronym class="acronym">PGP</acronym> keys is available in the
    <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/pgpkeys" target="_top"><acronym class="acronym">PGP</acronym>
      Keys</a> article.  The complete keyring can be downloaded
    at <a class="link" href="https://www.FreeBSD.org/doc/pgpkeyring.txt" target="_top">https://www.FreeBSD.org/doc/pgpkeyring.txt</a>.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pgpkeys-officers"></a>D.1. Officers</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkey-security-officer"></a>D.1.1. Security Officer Team <code class="email">&lt;<a xmlns="" class="email" href="mailto:security-officer@FreeBSD.org">security-officer@FreeBSD.org</a>&gt;</code></h3></div></div></div><pre class="programlisting">
pub   rsa4096/D39792F49EA7E5C2 2017-08-16 [SC] [expires: 2023-01-02]
      Key fingerprint = FC0E 878A E5AF E788 028D  6355 D397 92F4 9EA7 E5C2
uid                            FreeBSD Security Officer &lt;security-officer@FreeBSD.org&gt;
sub   rsa4096/6DD0A349F26ADEFD 2017-08-16 [E] [expires: 2023-01-02]

</pre><pre class="programlisting">
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBFmT2+ABEACrTVJ7Z/MuDeyKFqoTFnm5FrGG55k66RLeKivzQzq/tT/6RKO9
K8DaEvSIqD9b0/xgK02KgLSdp0Bucq8HLDFYUk3McFa6Z3YwjobNCWkxc72ipvVl
uAOGN4H6fuoYOpeg4cLK1H9pktUIrzONTCixaZzc/Bu6X+aX4ywGeCfsuu8g5v03
fLCPBLLgf3Bm5wsyZ6ZaGmsmILrWzd+d/rbr35Mcc5BekdgywUI4R191qo1bdrw9
mEJP1V7Ik3jpExOsNnuhMTvm5OQMeCTfUvVEOtBU15QtbT+1LXF5FIOgML0LwS5v
RHZN+5w/xvzSnEULpj24UuMKLDs/u9rj8U/zET8QaE+oG7m/mr4jJWZEmdX8HKdO
WrpnVj6UAppk72qdBIEfLsOW2xB/NOjJpppbCQH3+sw7DRYA2UnKE9Mptj/KKiE4
cs4c8Cupo2WSu93lEZDC5rCrULpT2lFeEXnRYlC/5oIgY5w9sFide9VI4CzHkkWX
Z2NPW/i1w3mFhoXjvnNLGOYMfAMKPxsRC2/Bn3bY0IhKvuIZ4rAeu7FTmKDDqFKQ
YEcrUOW74ZVng17AB29xzjWr4zNJVvp/CybFiUb8JoKkwtVWRqAVZIEgenAjU40d
G5+W4e+ccL0mfTQfEBbXRjnL2BL2tnaoBR42cTfbZGRucPHz7MrlKBEeZQARAQAB
tDdGcmVlQlNEIFNlY3VyaXR5IE9mZmljZXIgPHNlY3VyaXR5LW9mZmljZXJARnJl
ZUJTRC5vcmc+iQJUBBMBCgA+FiEE/A6HiuWv54gCjWNV05eS9J6n5cIFAlmT2+AC
GwMFCQoek4AFCwkIBwMFFQoJCAsFFgIDAQACHgECF4AACgkQ05eS9J6n5cKd9A/9
Fz3uGjNy28D0ALT1d/JJGzdQ2R3YwspHk9KHBr1LePkog9wf1WRalwCeNtPmA+g5
cn24psuzOeh1tRElImTZ2eE2ENPZ9XzK/J0ok0nK42MvmIwmMCyz+CaWv9GXW+FK
0oXnFmHi4YaQUVN3p+45TGkD9T+O5biVww7P47n/NnWsTfhLx0bzC7LyjPKXINai
/LgPgtlcOgY65/YhW/qhADCkoU7qMp9is41jMjTu1WB3OBPJkUkNpHfu6r15y8FN
Wqsk7K4W6Obr/WQ6VKGGXgh/a5mTcaEoFGMO16uHijAY4nXeb2HGZlBKxgmPH9Ur
aT4A9Pz/n+rIRMrK+rs+msFPemQHHNBYxy+x99uBpRBNyT2Su6GouZIxu5J16aIM
V0ZyOy/dy7m/uJ4sMhJPqKkd8a+MoQs/2L1M1y1EAzsO/QZqIrKrCluaftNN9k/B
qU0XClSDqB6sRMF7HFzYqb+f+M6cwSL/3Cp1Yx4rZ/onEE/MdWp64+3R87dETTXd
5tWXQw04qOhfPri5cBTI7r3t/qMO1iNXCGSG5RJbGkas6N6t6Mj83L4ItjI8doLf
aSIWZjj1XP3/me2hFJ6h2G5y5A+khO4ZwhC0ATFSq1fYbVGHw5AtfthIgNn8FoWu
+Sb8h7/RqTr7F6LgWagAoAh0GtVj02SVABZjcNZz/AKJAjcEEAEKACEWIQQc9/9v
rfXKn74bjLLtZ+zWXc9q5wUCWZPcTAMFAngACgkQ7Wfs1l3PauflkRAAgYcaBX0Y
ic4btxKoP/eOVpgUciOPPKEhDCiloQDyf4XQnZFDoMfjgcHpbLTBZ6kiAz2UzDGr
fJ4yUqrD+xfixUfCd5YpwzsaSpCGzDzSxOBcP/SpuAFhe40awSOIf5MruQar9Mlf
33JyslDLULXXeewAq2pcGk0/WrrOragI6Cs2vPGy9XP96VvLxyhjrWjlKmnO+//w
UF8oIO5hhKoqbtoxxlcqJgsWVyHch0mnPzvr6GWwoPhFXocnh1oPdbLjX1AwmGm9
ltEYMge4QxONIXlXJR0TvuDuJOaLNvTOC3OI8L97fdBcZS7eNJrG5FAYR5Ft3ISf
KJowIsSLGDt/cYApqpyP2pv7FpCvnwHgXHYar7/q4zhngCFRxQ2DPUx1cIJQ3Bgh
HZolKyK1X7XE5ZVDfZ3s3gcHSVKS89pipgHHZNr4sSmOanA8rXHcyHS4o2zSi1ie
r4iBwnOk6cCd6UNzEIiq0y/XhP/sc7xeL0mn3wDuV7jDBP9sp65sexL1qtIAfnzL
pLQevm0z41ifrUH5nNeL6RdbXpaoXc8M4PJJeQKJDu04KzLcQpZdUdCJsbS6QO9w
srWR8enQXPEhz2CO4L77bM9TgYO29222jTqEPcbXcmxF/klxO1rpssTTHUnHHi1Z
LUGYCbZPjt+laTJ2YPHTjUtN1Jw85vSKCEuJATMEEAEKAB0WIQS7KNQLNg7uk2rt
FW/l97zLo73d+AUCWjSYRwAKCRDl97zLo73d+JKyB/9N5Ytao12nD5QzMLvceGh5
otCLN99TUryYiDVDLoNkBivq3jHQA/hOX2rwEueFq0+LF8/2DnglJuUICNtCxIzL
WXXf/Hr5iWBUQ0JxYNPQzzjdMSXGE0WMwYVpAbCGxHpIsetKLdHUCwneYhaywe3I
KzmRJSDJGV1IJB0sAfoFtgybZXHgIR61jQjtnNmmyYXliYCd0wmIhXQDFN91tzzG
+EZdJ3Fao9JsMC+x55jO6EOLVySZgRF5E8vCeKUWemQciKFC7EhKcljILPYAA21u
NmHCAgRHKWU9JMdFK0w9lQuN2HQaNfkahjarTNM/Q6LwxY0dLG0vVYifE085WFAf
uQINBFmT2+ABEACxi39m5nQZexzY3c9sg/w5mUYCD89ZNSkj427gduQMYYGn7YW6
jSPfVJ/V3+PDK824c0a0XasyDapQFY1CPTZYrReRPoyjb8tJjsSVGXXCTFpJZlFU
br6kS9mgcx58Sypke2PMVk73+W1N1Yco+nahfTECRuM2/T2zHHr0AdKuBPF28U+H
TxyLatKoIgQwHDs4E/f4ZTbAoHvu3PixAl7XHVXCgz0cHaLhRljXizbZDXngOdGm
lqdFlAIpL6/l8E3m1Er0m3IfFo6qSzWRHg/KaBGIL4YKetJ6ACjlkCe5qbatDpmk
gWlg3Ux4RBVjyCK834Xh7eZpEcNf2iwpm28glWh7XMHGUplTHkU3PWQ4vGfNxXB8
HBOd9r02/cHL6MiHwhCAfIzZGVtqR0i9Ira57TMdXTpJWNXUcgsCMsi/Bg2a+hsn
aiYLrZc18uNL5nqOqsqKG3c1TcmeN7nbxVgnrNST4AjteulkhmB9p8tNOXA3u979
OO0T5LPwdqIpobdZ0lfw4URnAGw4Wd4Sm9PtRw0RvuAk2M2e5KXNyxPWAuMVkoRR
a7wG6h/R8pki54Gexyc+JkfB4ZcOrzHNLurw6DhxroyfRs8WEgX0wNIGmJvCXSBG
54jb5w9qudYwzIg4YPfvuX8sfeY8MTNhal3rF0tvVloGj3l709wlaWlBYwARAQAB
iQI8BBgBCgAmFiEE/A6HiuWv54gCjWNV05eS9J6n5cIFAlmT2+ACGwwFCQoek4AA
CgkQ05eS9J6n5cKhWw/+PT0R4r2gPAxI8ESEe380BYOmneNAH24MFOgWXqWCj4zX
Uz992BVnW2aL5nH4O5d822LGeCrYUC7SCpQvlifdHZHjobgtizLTwuu40bc3gSOz
cxWlx2jKfx3Ezn6QQz2mhhK6fZ1AO0ObiQxQq25ldURep95L78E/C8XkCe11YlUR
ng3wQKeHM7awZWRw/QBC92haHuVtU3cx7At+zQL7jTBKSZqd34zzs0uoXIhk2h94
O07MMDZ8z8MeU337vdL+RKYtD2bljLwpf7/kqg1D/q44RJ4ZpZcha9G0GvtLaQg2
+MAPlLg1vOWZ8wOTLaQHm+uzYRpkqxkIV8OuVd4UikCd8t3VNjNG5rG/YRNIAX0A
UEzs6oMF5YOFE8LmykesbUHAbC07Vcb0AsT5u3XKixDiIpPdnYSwGlkvoOVVLdeh
q/aXLK9V8BpViG5+a8xP2fdF1eMqdnrKAsiO4GEiq193PN/FA049VeIs3fd0izAa
x7+ag1MGtoF5Pij5iTVJm6phH5SUd1P3FY3OmclxWj/MbL4ba/G/6FWcy5NXxdw9
L1bRqaM2KEHJ67aF6NZz7UMldwExAWzFbUon1LUpKysAukxVf0EnntydBeVOQ+JO
HdqEpirrVLMpxPttUB2xxbo947nMj7/Bnme2gvb0vxaC9xSGVxrpW9cg5iCwSdc=
=8rds
-----END PGP PUBLIC KEY BLOCK-----
</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkey-secteam-secretary"></a>D.1.2. Security Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:secteam-secretary@FreeBSD.org">secteam-secretary@FreeBSD.org</a>&gt;</code></h3></div></div></div><pre class="programlisting">
pub   4096R/3CB2EAFCC3D6C666 2013-09-24 [expires: 2018-01-01]
      Key fingerprint = FA97 AA04 4DF9 0969 D5EF  4ADA 3CB2 EAFC C3D6 C666
uid                          FreeBSD Security Team Secretary &lt;secteam-secretary@FreeBSD.org&gt;
sub   4096R/509B26612335EB65 2013-09-24 [expires: 2018-01-01]
</pre><pre class="programlisting">
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBFJBjIIBEADadvvpXSkdnBOGV2xcsFwBBcSwAdryWuLk6v2VxjwsPcY6Lwqz
NAZr2Ox1BaSgX7106Psa6v9si8nxoOtMc5BCM/ps/fmedFU48YtqOTGF+utxvACg
Ou6SKintEMUa1eoPcww1jzDZ3mxx49bQaNAJLjVxeiAZoYHe9loTe1fxsprCONnx
Era1hrI+YA2KjMWDORcwa0sSXRCI3V+b4PUnbMUOQa3fFVUriM4QjjUBU6hW0Ub0
GDPcZq45nd7PoPPtb3/EauaYfk/zdx8Xt0OmuKTi9/vMkvB09AEUyShbyzoebaKH
dKtXlzyAPCZoH9dihFM67rhUg4umckFLc8vc5P2tNblwYrnhgL8ymUaOIjZB/fOi
Z2OZLVCiDeHNjjK3VZ6jLAiPyiYTG1Hrk9E8NaZDeUgIb9X/K06JXVBQIKNSGfX5
LLp/j2wr+Kbg3QtEBkcStlUGBOzfcbhKpE2nySnuIyspfDb/6JbhD/qYqMJerX0T
d5ekkJ1tXtM6aX2iTXgZ8cqv+5gyouEF5akrkLi1ySgZetQfjm+zhy/1x/NjGd0u
35QbUye7sTbfSimwzCXKIIpy06zIO4iNA0P/vgG4v7ydjMvXsW8FRULSecDT19Gq
xOZGfSPVrSRSAhgNxHzwUivxJbr05NNdwhJSbx9m57naXouLfvVPAMeJYwARAQAB
tD9GcmVlQlNEIFNlY3VyaXR5IFRlYW0gU2VjcmV0YXJ5IDxzZWN0ZWFtLXNlY3Jl
dGFyeUBGcmVlQlNELm9yZz6JAj0EEwEKACcFAlJBjIICGwMFCQgH7b8FCwkIBwMF
FQoJCAsFFgIDAQACHgECF4AACgkQPLLq/MPWxmYt8Q/+IfFhPIbqglh4rwFzgR58
8YonMZcq+5Op3qiUBh6tE6yRz6VEqBqTahyCQGIk4xGzrHSIOIj2e6gEk5a4zYtf
0jNJprk3pxu2Og05USJmd8lPSbyBF20FVm5W0dhWMKHagL5dGS8zInlwRYxr6mMi
UuJjj+2Hm3PoUNGAwL1SH2BVOeAeudtzu80vAlbRlujYVmjIDn/dWVjqnWgEBNHT
SD+WpA3yW4mBJyxWil0sAJQbTlt5EM/XPORVZ2tvETxJIrXea/Sda9mFwvJ02pJn
gHi6TGyOYydmbu0ob9Ma9AvUrRlxv8V9eN7eZUtvNa6n+IT8WEJj2+snJlO4SpHL
D3Z+l7zwfYeM8FOdzGZdVFgxeyBU7t3AnPjYfHmoneqgLcCO0nJDKq/98ohz5T9i
FbNR/vtLaEiYFBeX3C9Ee96pP6BU26BXhw+dRSnFeyIhD+4g+/AZ0XJ1CPF19D+5
z0ojanJkh7lZn4JL+V6+mF1eOExiGrydIiiSXDA/p5FhavMMu8Om4S0sn5iaQ2aX
wRUv2SUKhbHDqhIILLeQKlB3X26obx1Vg0nRhy47qNQn/xc9oSWLAQSVOgsShQeC
6DSzrKIBdKB3V8uWOmuM7lWAoCP53bDRW+XIOu9wfpSaXN2VTyqzU7zpTq5BHX1a
+XRw8KNHZGnCSAOCofZWnKyJAhwEEAEKAAYFAlJBjYgACgkQ7Wfs1l3PaudFcQ//
UiM7EXsIHLwHxez32TzA/0uNMPWFHQN4Ezzg4PKB6Cc4amva5qbgbhoeCPuP+XPI
2ELfRviAHbmyZ/zIgqplDC4nmyisMoKlpK0Yo1w4qbix9EVVZr2ztL8F43qN3Xe/
NUSMTBgt/Jio7l5lYyhuVS3JQCfDlYGbq6NPk0xfYoYOMOZASoPhEquCxM5D4D0Z
3J3CBeAjyVzdF37HUw9rVQe2IRlxGn1YAyMb5EpR2Ij612GFad8c/5ikzDh5q6JD
tB9ApdvLkr0czTBucDljChSpFJ7ENPjAgZuH9N5Dmx2rRUj2mdBmi7HKqxAN9Kdm
+pg/6vZ3vM18rBlXmw1poQdc3srAL+6MHmIfHHrq49oksLyHwyeL8T6BO4d4nTZU
xObP7PLAeWrdrd1Sb3EWlZJ9HB/m2UL9w9Om1c6cb6X2DoCzQAStVypAE6SQCMBK
pxkWRj90L41BS62snja+BlZTELuuLTHULRkWqS3fFkUxlDSMUn96QksWlwZLcxCv
hKxJXOX+pHAiUuMIImaPQ0TBDBWWf5d8zOQlNPsyhSGFR5Skwzlg+m9ErQ+jy7Uz
UmNCNztlYgRKeckXuvr73seoKoNXHrn7vWQ6qB1IRURj2bfphsqlmYuITmcBhfFS
Dw0fdYXSDXrmG9wad98g49g4HwCJhPAl0j55f93gHLGIRgQQEQoABgUCUkGO5gAK
CRAV1ogEymzfsol4AKCI7rOnptuoXgwYx2Z9HkUKuugSRwCgkyW9pxa5EovDijEF
j1jG/cdxTOaJAhwEEAEKAAYFAlJBkdUACgkQkshDRW2mpm6aLxAAzpWNHMZVFt7e
wQnCJnf/FMLTjduGTEhVFnVCkEtI+YKarveE6pclqKJfSRFDxruZ6PHGG2CDfMig
J6mdDdmXCkN//TbIlRGowVgsxpIRg4jQVh4S3D0Nz50h+Zb7CHbjp6WAPVoWZz7b
Myp+pN7qx/miJJwEiw22Eet4Hjj1QymKwjWyY146V928BV/wDBS/xiwfg3xIVPZr
RqtiOGN/AGpMGeGQKKplkeITY7AXiAd+mL4H/eNf8b+o0Ce2Z9oSxSsGPF3DzMTL
kIX7sWD3rjy3Xe2BM20stIDrJS2a1fbnIwFvqszS3Z3sF5bLc6W0iyPJdtbQ0pt6
nekRl9nboAdUs0R+n/6QNYBkj4AcSh3jpZKe82NwnD/6WyzHWtC0SDRTVkcQWXPW
EaWLmv8VqfzdBiw6aLcxlmXQSAr0cUA6zo6/bMQZosKwiCfGl3tR4Pbwgvbyjoii
pF+ZXfz7rWWUqZ2C79hy3YTytwIlVMOnp3MyOV+9ubOsFhLuRDxAksIMaRTsO7ii
5J4z1d+jzWMW4g1B50CoQ8W+FyAfVp/8qGwzvGN7wxN8P1iR+DZjtpCt7J+Xb9Pt
L+lRKSO/aOgOfDksyt2fEKY4yEWdzq9A3VkRo1HCdUQY6SJ/qt7IyQHumxvL90F6
vbB3edrR/fVGeJsz4vE10hzy7kI1QT65Ag0EUkGMggEQAMTsvyKEdUsgEehymKz9
MRn9wiwfHEX5CLmpJAvnX9MITgcsTX8MKiPyrTBnyY/QzA0rh+yyhzkY/y55yxMP
INdpL5xgJCS1SHyJK85HOdN77uKDCkwHfphlWYGlBPuaXyxkiWYXJTVUggSjuO4b
jeKwDqFl/4Xc0XeZNgWVjqHtKF91wwgdXXgAzUL1/nwN3IglxiIR31y10GQdOQEG
4T3ufx6gv73+qbFc0RzgZUQiJykQ3tZK1+Gw6aDirgjQYOc90o2Je0RJHjdObyZQ
aQc4PTZ2DC7CElFEt2EHJCXLyP/taeLq+IdpKe6sLPckwakqtbqwunWVoPTbgkxo
Q1eCMzgrkRu23B2TJaY9zbZAFP3cpL65vQAVJVQISqJvDL8K5hvAWJ3vi92qfBcz
jqydAcbhjkzJUI9t44v63cIXTI0+QyqTQhqkvEJhHZkbb8MYoimebDVxFVtQ3I1p
EynOYPfn4IMvaItLFbkgZpR/zjHYau5snErR9NC4AOIfNFpxM+fFFJQ7W88JP3cG
JLl9dcRGERq28PDU/CTDH9rlk1kZ0xzpRDkJijKDnFIxT2ajijVOZx7l2jPL1njx
s4xa1jK0/39kh6XnrCgK49WQsJM5IflVR2JAi8BLi2q/e0NQG2pgn0QL695Sqbbp
NbrrJGRcRJD9sUkQTpMsLlQTABEBAAGJAiUEGAEKAA8FAlJBjIICGwwFCQgH7b8A
CgkQPLLq/MPWxmZAew//et/LToMVR3q6/qP/pf9ob/QwQ3MgejkC0DY3Md7JBRl/
6GWfySYnO0Vm5IoJofcv1hbhc/y3OeZTvK4s+BOQsNokYe34mCxZG4dypNaepkQi
x0mLujeU/n4Y0p0LTLjhGLVdKina2dM9HmllgYr4KumT58g6eGjxs2oZD6z5ty0L
viU5tx3lz3o0c3I9soH2RN2zNHVjXNW0EvWJwFLxFeLJbk/Y3UY1/kXCtcyMzLua
S5L5012eUOEvaZr5iYDKjy+wOxY4SUCNYf0GPmSej8CBbwHOF2XCwXytSzm6hNb3
5TRgCGbOSFTIy9MxfV5lpddQcdzijmuFSl8LySkL2yuJxjlI7uKNDN+NlfODIPMg
rdH0hBSyKci6Uz7Nz/Up3qdE+aISq68k+Hk1fiKJG1UcBRJidheds29FCzj3hoyZ
VDmf6OL60hL0YI1/4GjIkJyetlPzjMp8J7K3GweOUkfHcFihYZlbiMe7z+oIWEc7
0fNScrAGF/+JN3L6mjXKB6Pv+ER5ztzpfuhBJ/j7AV5BaNMmDXAVO4aTphWl7Dje
iecENuGTpkK8Ugv5cMJc4QJaWDkj/9sACc0EFgigPo68KjegvKg5R8jUPwb8E7T6
lIjBtlclVhaUrE2uLx/yTz2Apbm+GAmD8M0dQ7IYsOFlZNBW9zjgLLCtWDW+p1A=
=5gJ7
-----END PGP PUBLIC KEY BLOCK-----
</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkey-core-secretary"></a>D.1.3. Core Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:core-secretary@FreeBSD.org">core-secretary@FreeBSD.org</a>&gt;</code></h3></div></div></div><pre class="programlisting">
pub   rsa4096/D8C8C83B49F26F17 2020-06-26 [SC] [expires: 2022-06-30]
      Key fingerprint = 4B64 E9E0 BDE9 B3EC C06B  5C66 D8C8 C83B 49F2 6F17
uid                            FreeBSD Core Team Secretary &lt;core-secretary@freebsd.org&gt;
sub   rsa4096/377C937536E4821B 2020-06-26 [E] [expires: 2022-06-30]

</pre><pre class="programlisting">
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBF72HwABEAC5hl4kfh8DyRpp0WE5rwbnuS+wQ51EVTGs1vLho8OZ2XruzlQT
AezCnKLsqMgD/UEaBcn9kbKoeqp2sIwuEUX+P79KhRc4C8RJ8TMfDH0OtC091QVp
MYWbIsvZYCO04K+rN1Dbk2En3BOJVgTowqbZzR3hPvzeU2/P+Y3zMtpQGea2DB5d
24Q/tIuPMh89evEXOx0K5eM/4P2awSmA3J+h+r09UYjKejJ5OBUJQsMervWAHgCA
TxJQHoPXw+ZKpJB3dzyHKTMukVZhdCjK6Zt2tih/rO/CHDsitMgYRIl3w2X6pDfV
JOpvOBlzg7nooIw94v6Uxr2y/JWgOGh2qy07u4qE//y6uSl55s+Vq5TrFr79VSwB
GhY9As/0Dk1lyFisKp1/yiet2W7Pu4c99Z5dsrQPSTLFvkvonVRX8wgxRZwk6gWA
LEYklwoR0NXiqlrpBT10Tsnsa4aoUvZW6eyOWZrKsdsVn05sgRmvlfpiqBbwqldJ
0EeF/MztPuhmq4Hgn+DmmYnx/P85pZpThcfJx16VxS8nB7ExYljeC9LF8V8/1d7e
tfgAj8ezzNtr2TXSZ5gblQtYLjKdgBiBZqsxHPYHzfG8Zx3eYs2Myklf9p4lt7nv
atTroDt8pUGXfhGfoqSHSLXODfYAO9/7DOPqTy5Pan4i7aWBPP+gfK0kgQARAQAB
tDhGcmVlQlNEIENvcmUgVGVhbSBTZWNyZXRhcnkgPGNvcmUtc2VjcmV0YXJ5QGZy
ZWVic2Qub3JnPokCVAQTAQoAPhYhBEtk6eC96bPswGtcZtjIyDtJ8m8XBQJe9h8A
AhsDBQkDx60ABQsJCAcDBRUKCQgLBRYDAgEAAh4BAheAAAoJENjIyDtJ8m8XQFwP
/RqHPMSsLlTcq5NfK2MAVGmdtpL5wf84bchVWtcXUUEwXW1wI2cdDwu9SoqudDbP
2lrbMpxWeUWAgCpPCF/vCVo4Nzd0zb1cEGKRKFiZe/4EQ8dfvqr03YyupSQvx6+P
oY+8y3kl7iHJKBkwrASraB2p+N9XDAJDgqz+1M2Xbo7rcJx64wBOCyPAxd9JWsge
d8mXyAqZlrLihsTjLbhuYbJxpKM5YjGubVaQZaNIDxUduqc8Pt9VgHvWJBc9VPPA
3B6E9/PUFZYZeZQSROkYniN9NE7keitxj/rvZkpzcaXfAoDMC7CSoLBzlP+CJZ+i
Kk7IWz4JpxiYkE/IY4VvMMYms9tRP8fVv0+R7r7yKEA9SSlH+e9qC++OoWg4b+wV
OrWtVIWvaJCtj5ZAPCutGZxBdvXEbHd/Gv6uCzG86n4huz23U+Y4iLzoAlVelnQs
Hqu1wSAUBNpplyeZ1TvrGg2pufxLh8iXfh0npDP/6J+u0GUfeX4JoAzvxlatXMYI
fBmqmcZI6ShJN8qQtCUa5OMqbnieo7Fmpf8BsLegjAsQ+8w21ATD2boinStntLzF
/yoL/z9WYxmoOdHYcQ8bildjCvtbAKrZie8sI4SgWQz2UX6KX9sc/WOmWUEtjdqB
WfGratZNoxuQLUvEDftt7r9ts1jKVUl3dMPTCfU4wcj5iQIzBBABCgAdFiEEVbCT
pybDiFVxIrrVNqQMg7DW754FAl72J74ACgkQNqQMg7DW756LaA//Z3CCF5fQ08tx
RLeqHNsS5xCYS97TjZxY6xAMBjebkS+ABkgdbedSH+YNGfdaGSD/SMtvMAmnx55t
18DDdA4pqC5x2USaHjXFdbDdxKuKMAoSAtOpipVASVmW0FkZI5C5FDe3MF8+mfGb
EPhVPwKbo7R5tk4jUPyX8wUaOAyUX9fyQnwDxN+zTHvKwnX/+qwpoKaY2N4ZOI0w
rOF1kkczibbfwvjVYcpPovGALmTccnWo1Xvpkhllg93Y21mH+T2Ub/BK3GhvgJQi
WwiDtMwelUnPLp4W1451OU1OyGzeT/XwuMPH9dsKz5Iw4/g1zqQEtZj2Gc0DP5we
HM50doTn+dVIF+WCFLhPYm0RSf8Zj8ngbX/HV2UYLB5k+uNT9YTnBVEdKVydx7Cp
IplC7XApJEfTUk7wl7YCGn5P5YolC7DSJlwcAjxdbffXLowBhgyOq+EJJgnqerZl
r4db58h2epIHRKgnSl5z4KoAGW1O5dFShBz1UYPj4cZdeE+twpcgEg3/7LMzPzF/
xQAQZ89axxXBaCPl+YVsuMJSerbNdPp1SjCs9e8Vev91tLFmt/sY4IpvbPHZavGl
/4ealh8E1zPgf8lVW9TPrUY6mjN/uDI2y39tk2EoFzOcSQhlEM6gRW8uV4q92cWM
V55hu7Vs2RrKA7fve9y+YBi3DdTwwHSJATMEEAEKAB0WIQSfAoNvUNOtWrdaxYgM
tAPk6VuW7AUCXvY98wAKCRAMtAPk6VuW7CDLB/9PSUSMV/pnC+X4ougpjpqfSJf8
5bozjkKSkNqXZmt2vJVImc/oSK13awq46FC4rAhk59lT3kaH6EKvDHQ5G8Twi07u
VotcOdtfMjXgPV6RLmo6Hps0E1nzmbsum6xeemRDf3D3n1kAdUteXNBxHTIdAbeY
p4Wxu46CC/SqD6HbnUF2o+/6dXXyV1lTnViIj6m5eFD2OQ4Jdq7GPsSjSS2XL4f9
jHZUOUJyyA0aFWjJ+SCzMkXSUnyiOCl4uUHdCgivLIRyZ/giWoQpr8sAgHXCh82h
T3BmbHgmcMgMh+wNxH878IPwUU0CKRd2dL5kOSZVCFuMnFsc9eIie5kMEJwPuQIN
BF72HwABEADT9l4GIYiFaYg2QbQ3wsmmFnP/pAZiHDxXI6wL6xCKj6o2sc1/b5j3
ILEiAoqZ5ZenXX6T7Epjal0ASkfsGo/n3vF18grSudIkXJPQXcb61fXU7xfmGAEU
HWABQG+OD/HTvUPAITVckl4LxVFkz3oqRnq13rxDk1XZYvLVWeBn8vfWF4/glz9k
etfLw71Pk9f86BuNb0vCPnWpOpZaOxKlabdGpMKDD+1RYC/L+ZEwKiLBfgXTzK3g
IWAX3kTrQjKBZzsQ0s5TFWkm+z80GVUq8HKlXUOuF8s7cX+KXGU2kYcC8DQrxPdL
jYm6N8axOn4RR8eP5ZFA0W7qMieFSHAjqCs4srdN1bGC3nS0zGsQCvtTRBbu0nen
O6uwzWQgTzWVfV+dqaEH2crnhn5CUI0A8jdbFBGDiBbWJz/QfRray1CEc8q+hZFM
OLBsVXrDVe6hUXTveGc9xAnXC+0o3nnc7WhWr1caTbbhnzlEbME8u2oLif7rkhc7
FanuQEyKa76J1zou08ZeLK/pUFXTbRCoyUEVL+VIxLESCWi1ptkDpiZey3l6fe0Q
WWRMLFMpbu3WTNl21bEwfRL03+fP1q+yGAV5hyJv/EMldd76v577dAolIsTh+aDP
PMJ7mJ5NwOuiC20HIlCjuVT5A2pBIzFfraZY/v4dzoaOpXZjEz9wIwARAQABiQI8
BBgBCgAmFiEES2Tp4L3ps+zAa1xm2MjIO0nybxcFAl72HwACGwwFCQPHrQAACgkQ
2MjIO0nybxcflQ/9FYvM/lBSzy4VFOjNsUkRtjmPtyw2dJmQOCbWoSHmibRCG26a
Upt5lp1n4LG/qEtDlus5mDETL+/TnYhCG+hhnHADc87goLwBwl37yK1NAYvOy2rm
TddjDT5vZW0yzHjHqIJlNxQ4OjMi/XjyHIzb0PGNayFVi3XkLVxWZI+lWON1btWk
gpFfEgqRqQbJxM2cSEQimkfrrE+b2/M4cGX9rThpTtpfpbyHjTsS6juo4/eIdnBA
UXpKce4Q9LB5zxDaakKoDVxxkc9R0HAAoIH4u+Fu8az+CuH2sJcVJWK7Nxct++N8
Xhj+FUS+Ay8siu+ScQjsOHOHRwr6a+6NT58eylwR5hwotmnzJHLZReqknoAjLEGT
d33jzKM/y6OqPe/oPGj2b13RkA2vRnCPm33+T57sLMonNe6hhlXs9VTgXxSAzfMa
cmVOdP+nxUsoc3MtqjE2z2BcI9WMmmJFeEgE2BOj703CQuot+8jcZFXGUW+i6V1a
k7dZEMDsbALNzxaRNGeJC6HiM1+dXFGLNHEIgBLGwdvFAxTfNauvK0p7skDWEx44
giaUjZYpQ21+SHjVKTUnFQiiIDORvs3jdZDaxK/Y/vSoLRUiLBiHZWa6mxQY4uc6
5nAzLZB2BiBRfdL8fEO154nWjAZBLbKhK+ke2DBoPvSWubLPJqZyh+GmZAE=
=3AI7
-----END PGP PUBLIC KEY BLOCK-----
</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkey-portmgr-secretary"></a>D.1.4. Ports Management Team Secretary <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr-secretary@FreeBSD.org">portmgr-secretary@FreeBSD.org</a>&gt;</code></h3></div></div></div><pre class="programlisting">
pub   rsa2048/D8294EC3BBC4D7D5 2012-07-24 [SC]
      Key fingerprint = FB37 45C8 6F15 E8ED AC81  32FC D829 4EC3 BBC4 D7D5
uid                            FreeBSD Ports Management Team Secretary &lt;portmgr-secretary@FreeBSD.org&gt;
sub   rsa2048/5CC117965F65CFE7 2012-07-24 [E]

</pre><pre class="programlisting">
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBFAOzqYBCACYd+KGv0/DduIRpSEKWZG2yfDILStzWfdaQMD+8zdWihB0x7dd
JDBUpV0o0Ixzt9mvu5CHybx+9lOHeFRhZshFXc+bIJOPyi+JrSs100o7Lo6jg6+c
Si2vME0ixG4x9YjCi8DisXIGJ1kZiDXhmVWwCvL+vLInpeXrtJnK8yFkmszCOr4Y
Q3GXuvdU0BF2tL/Wo/eCbSf+3U9syopVS2L2wKcP76bbYU0ioO35Y503rJEK6R5G
TchwYvYjSXuhv4ec7N1/j3thrMC9GNpoqjVninTynOk2kn+YZuMpO3c6b/pfoNcq
MxoizGlTu8VT4OO/SF1y52OkKjpAsENbFaNTABEBAAG0R0ZyZWVCU0QgUG9ydHMg
TWFuYWdlbWVudCBUZWFtIFNlY3JldGFyeSA8cG9ydG1nci1zZWNyZXRhcnlARnJl
ZUJTRC5vcmc+iQE4BBMBAgAiBQJQDs6mAhsDBgsJCAcDAgYVCAIJCgsEFgIDAQIe
AQIXgAAKCRDYKU7Du8TX1QW2B/0coHe8utbTfGKpeM4BY9IyC+PFgkE58Hq50o8d
shoB9gfommcUaK9PNwJPxTEJNlwiKPZy+VoKs/+dO8gahovchbRdSyP1ejn3CFy+
H8pol0hDDU4n7Ldc50q54GLuZijdcJZqlgOloZqWOYtXFklKPZjdUvYN8KHAntgf
u361rwM4DZ40HngYY9fdGc4SbXurGA5m+vLAURLzPv+QRQqHfaI1DZF6gzMgY49x
qS1JBF4kPoicpgvs3o6CuX8MD9ewGFSAMM3EdzV6ZdC8pnpXC8+8Q+p6FjNqmtjk
GpW39Zq/p8SJVg1RortCH6qWLe7dW7TaFYov7gF1V/DYwDN5iEYEEBECAAYFAlN2
WksACgkQtzkaJjSHbFtuMwCg0MXdQTcGMMOma7LC3L5b4MEoZ+wAn0WyUHpHwHnn
pn2oYDlfAbwTloWIiQEcBBABAgAGBQJQDuVrAAoJENk3EJekc8mQ3KwIAImNDMXA
F8ajPwCZFpM6KDi3F/jpwyBPISGY1oWuYPEi1zN94k5jS90aZb3W8Y8x4JTh35Ew
b6XODi3uGLSLCmnlqu2a80yPfXf5IuWmIQdFNQxvosj9UHrg+icZGFmm+f0hPJxM
TsZREv3AvivQfnb/N3xIICxW4SjKSYXQcq4hr4ObhUx7GKnjayq+ofU2cRlujr87
uOH0fO3xhOJG4+cX5mI1HGK38k0Csc1zqYa/66Qe5dnIZz+sNXpEPMLAHIt1a45U
B967igJdZSDFN33bPl1QWmf3aUXU3d1VttiSyHkpm4kb9KgsDkUk1IJ5nUe9OXyd
WtoqNW5afDa5N0aIRgQQEQIABgUCUA7lwwAKCRB59uBxdBRinNh2AJ41+zfsaQSR
HWvSkqOXGcP/fgOduwCfUJDT+M1eXe2udmKof/9yzGYMirKJASIEEAECAAwFAlAa
IT8FAwASdQAACgkQlxC4m8pXrXwCHAf+J7l+L7AvRpqlQcezjnjFS/zG1098qkDf
lThHZlpVnrBMJZaXdvL6LzVgiIYVWZC5CSSazW9EWFjp9VjM7FBHdWFZNMV7GAuU
t0jzx6gGXOWwi+/v/hs1P11RyDZN5hICHdPNmyZVupciDxe+sIEP9aEbVxcaiccq
zM/pFzIVIMMP5tCiA42q6Mz3h0hy6hntUKptS8Uon6sje5cDVcVlKAUj1wO2cphC
qkYlwMQfZV5J9f/hcW5ODriD3cBwK8SocA2Cq5JYF8kYDL1+pXnUutGnvAHUYt87
RWvQdKmfXjzBcMFJ2LlPUB1+IFvwQ13V9R8j9B/EdLmSWQYT9qRA2okCHAQTAQoA
BgUCV1XMpwAKCRCtu/hhCjeJt2CyD/9JLe+Ck23CJkeRSF8oC+4SFOUdSAmejSzn
klPwmEClffABYd/kckO1T6um+2FUcXuJZQE1nKKUNvZ8pBWwsm1RDHsyroKi/XB1
0a1Tdx/rvlU88ytbeLfUCLzoCrf6pkMQWoU6/3qS6elV0WwOlDufk+XjD1sja2wu
sshG8y+1WCA5JjP3rZdD9NVdzo5DgkotTRUfuYN1LJIN4zlDgHj7FVP7wW7+R0cZ
FoOiNsLJCA0FN8SiyU98UysjawLiIY9dTJz6XVA0DgB0TZWO3mWiDjITeKrdGcqf
PNiJhmvUKBkn07YpTPNfkoTT/p/q5ChYmu0ubGeyS1ELKjmklJ+DzynfZLzvnXYX
Ngo5ckeuqEqUNxM0J63v8lmfhDRROFveqHWdp0XMxXVmR5bMunSldg5EZsoLyQbN
+ScIPnDTAEPGrCtf0t84RQxNQeET6/WBbZfzeSeAFmpBFCdicsZ6Mjwtwjr4+o15
n1QMTZco1NaTqf8vXwzl9wM4aYtg1OkF4z8HdHuy50CHCet4mT5eJgwZUfFvXdbM
pHXprEI0Y9OOL4aMinC1egF3dXt/0n57i6CE+E2k3UJPNvMrtp0HaDEnKZ8cfkBU
EBzkUYi5wwqntHV2JRisqoRnHdvJT7ImlHMe7WaJsifBK874PnToaKg8P6K1Tph+
FyLxULaYjYkCHAQSAQgABgUCVBg2zwAKCRDqsDxYv9xHj1klEADXYJdHC3zsdx7w
DsJsttWdykcZoOd/VUKUdN0BAU72nLV0tLn4uFjETA6MhHZVxzwIDTeLB8kqyEpc
fZnoVbqJIUJz1sJXMdOty7CwZzlZlAwmUaIfFiazJY1p398JbyYfSrVKNOpw9wCm
Db7WP9dBritwvjaLzu8HQsiztO0S/5ha/EDfTU3qocBUTjbCtGR9LqAmPE4X8+li
F2EfZMEoJd3rJWsYv2y/k6pSgC/MpQewnyr6f+JQ/781UoZB6PpxCxfu4D6xlOyd
ERBUg+FfDAWYR+KX+DGOalRlUyaSz8Nvxl8/b0Im/AQhx9afqyEZxIDpg52zt8jJ
t3wx23YP8EQGUgwF8pIrj3wFSBSG3a/cskiBNUIhChIR9hQrVPUahN/jx7DGAGxk
/Ka9qsRGYTHfSr9jjTUQ+htfeFBRDR0nkZKMo5+Wk/cAcBKVbPlBpwvnzT3fh+wL
cF3ErBbx5jp+BoFee8D6ATeUvQxMcgVbDPUkgMsy3EtKMVO10jhIoXoVV+Sg9GZ8
zMEy1tORKn0zsd2ZgXC2sRJOm5ttCSdYQ4ddbM1A9jg6tiRx4hES16GDywvkL8P2
M9+qyIfjQxjGU33f/r8zp9DyNT1VlrtwhFxtOoMdmrsbYOCTja4Xg14hK1hRac0k
GB7bj6w97p8uMrQT3PlSMtoyrRyo7bkBDQRQDs6mAQgAzNxJYpf5PrqV8pdRXkn3
6Fe45q671YtbZ2WrT7D0CVZ8Z+AZsxnP/tiY1SrM2MepCeA2xBAhKGsWBWo1aRk5
mfZOksKsiXsi2XeBVhdZlCkrOMKBTVian7I1lH59ZnNIMX0Nl0tlj3L1IjeWWNvf
ej43URV81S9EmSwpjaWboatr2A+1oJku5m7nPD9JIOckE1TzBsyhx7zIUN9w6MKr
7gFw8DCzypwUKyYgKYToVm8QlkT/L3B0fuQHWhT6ROGk4o8SC71ia5tc1TzUzGEZ
1AQO8bbnbmJLBDKveWHCoaeAkRzINzoD9wAn9z4pnilze59QtKC1cOqUksTvBSDh
6wARAQABiQEfBBgBAgAJBQJQDs6mAhsMAAoJENgpTsO7xNfVOHoH/i5VyggVdwpq
PX8YBmN5mXQziYZNQoiON8IhOsxpX4W2nXCj5m6MACV6nJDVV6wyUH8/VvDQC9nH
arCe1oaNsHXJz0HamYt5gHJ0G1bYuBcuJp/FEjLa48XFI7nXQjJHn8rlwZMjK/PW
j1lw2WZiekviuzTEDH8c3YStGJSa+gYe8Eyq3XJVAe2VQOhImoWgGDR3tWfgrya/
IdEFb/jmjHSG5XUfbI0vNwqlf832BqSQKPG/Zix4MmBJgvAz4R71PH8WBmbmNFjD
elxVyfz80+iMgEb9aL91MfeBNC2KB1pFmg91mQTsiq7ajwVLVJK8NplHAkdLmkBC
O8MgMjzGhlE=
=iw7d
-----END PGP PUBLIC KEY BLOCK-----
</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pgpkey-doceng-secretary"></a>D.1.5. <code class="email">&lt;<a xmlns="" class="email" href="mailto:doceng-secretary@FreeBSD.org">doceng-secretary@FreeBSD.org</a>&gt;</code></h3></div></div></div><pre class="programlisting">
pub   rsa2048/E1C03580AEB45E58 2019-10-31 [SC] [expires: 2022-10-30]
      Key fingerprint = F24D 7B32 B864 625E 5541  A0E4 E1C0 3580 AEB4 5E58
uid                            FreeBSD Doceng Team Secretary &lt;doceng-secretary@freebsd.org&gt;
sub   rsa2048/9EA8D713509472FC 2019-10-31 [E] [expires: 2022-10-30]

</pre><pre class="programlisting">
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBF27FFcBCADeoSsIgyQUY8vREwkTikwFFlNg31MVy5s/Nq1cNK1PRfRMnprS
yfB62KqbYuz16bmQKaA9zHN4FGfiTvR6tl66LVHm1s/5HPiLv8sP14GsruLro9zN
v72dO7a9i68bMw+jarPOnu9dGiDFEI0dACOkdCGEYKEUapQeNpmWRrQ46BeXyFwF
JcNx76bJJUkwk6fWC0W63D762e6lCEX6ndoaPjjLBnFvtx13heNGUc8RukBwe2mA
U5pSGHj47J05bdWiRSwZaXa8PcW+20zTWaP755w7zWe4h60GANY7OsT9nuOqsioJ
QonxTrJuZweKRV8fNQ1EfDws3HZr7/7iXvO3ABEBAAG0PEZyZWVCU0QgRG9jZW5n
IFRlYW0gU2VjcmV0YXJ5IDxkb2Nlbmctc2VjcmV0YXJ5QGZyZWVic2Qub3JnPokB
VAQTAQoAPhYhBPJNezK4ZGJeVUGg5OHANYCutF5YBQJduxRXAhsDBQkFo5qABQsJ
CAcDBRUKCQgLBRYDAgEAAh4BAheAAAoJEOHANYCutF5YB2IIALw+EPYmOz9qlqIn
oTFmk/5MrcdzC5iLEfxubbF6TopDWsWPiOh5mAuvfEmROSGf6ctvdYe9UtQV3VNY
KeeyskeFrIBOFo2KG/dFqKPAWef6IfhbW3HWDWo5uOBg01jHzQ/pB1n6SMKiXfsM
idL9wN+UQKxF3Y7S/bVrZTV0isRUolO9+8kQeSYT/NMojVM0H2fWrTP/TaNEW4fY
JBDAl5hsktzdl8sdbNqdC0GiX3xb4GvgVzGGQELagsxjfuXk6PfOyn6Wx2d+yRcI
FrKojmhihBp5VGFQkntBIXQkaW0xhW+WBGxwXdaAl0drQlZ3W+edgdOl705x73kf
Uw3Fh2a5AQ0EXbsUVwEIANEPAsltM4vFj2pi5xEuHEcZIrIX/ZJhoaBtZkqvkB+H
4pu3/eQHK5hg0Dw12ugffPMz8mi57iGNI9TXd8ZYMJxAdvEZSDHCKZTX9G+FcxWa
/AzKNiG25uSISzz7rMB/lV1gofCdGtpHFRFTiNxFcoacugTdlYDiscgJZMJSg/hC
GXBdEKXR5WRAgAGandcL8llCToOt1lZEOkd5vJM861w6evgDhAZ2HGhRuG8/NDxG
r4UtlnYGUCFof/Q4oPNbDJzmZXF+8OQyTNcEpVD3leEOWG1Uv5XWS2XKVHcHZZ++
ISo/B5Q6Oi3SJFCVV9f+g09YF+PgfP/mVMBgif2fT20AEQEAAYkBPAQYAQoAJhYh
BPJNezK4ZGJeVUGg5OHANYCutF5YBQJduxRXAhsMBQkFo5qAAAoJEOHANYCutF5Y
kecIAMTh2VHQqjXHTszQMsy3NjiTVVITI3z+pzY0u2EYmLytXQ2pZMzLHMcklmub
5po0X4EvL6bZiJcLMI2mSrOs0Gp8P3hyMI40IkqoLMp7VA2LFlPgIJ7K5W4oVwf8
khY6lw7qg2l69APm/MM3xAyiL4p6MU8tpvWg5AncZ6lxyy27rxVflzEtCrKQuG/a
oVaOlMjH3uxvOK6IIxlhvWD0nKs/e2h2HIAZ+ILE6ytS5ZEg2GXuigoQZdEnv71L
xyvE9JANwGZLkDxnS5pgN2ikfkQYlFpJEkrNTQleCOHIIIp8vgJngEaP51xOIbQM
CiG/y3cmKQ/ZfH7BBvlZVtZKQsI=
=MQKT
-----END PGP PUBLIC KEY BLOCK-----
</pre></div></div></div></div><div class="glossary"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsd-glossary"></a>FreeBSD Glossary</h1></div></div></div><p>This glossary contains terms and acronyms used within the FreeBSD
    community and documentation.</p><div class="glossdiv"><h3 class="title">A</h3><dl><dt><span class="glossterm">ACL</span></dt><dd><p>See <a class="glosssee" href="#acl-glossary">Access Control List</a>.</p></dd><dt><span class="glossterm">ACPI</span></dt><dd><p>See <a class="glosssee" href="#acpi-glossary">Advanced Configuration and Power Interface</a>.</p></dd><dt><span class="glossterm">AMD</span></dt><dd><p>See <a class="glosssee" href="#amd-glossary">Automatic Mount Daemon</a>.</p></dd><dt><span class="glossterm">AML</span></dt><dd><p>See <a class="glosssee" href="#aml-glossary"><acronym class="acronym">ACPI</acronym> Machine Language</a>.</p></dd><dt><span class="glossterm">API</span></dt><dd><p>See <a class="glosssee" href="#api-glossary">Application Programming Interface</a>.</p></dd><dt><span class="glossterm">APIC</span></dt><dd><p>See <a class="glosssee" href="#apic-glossary">Advanced Programmable Interrupt Controller</a>.</p></dd><dt><span class="glossterm">APM</span></dt><dd><p>See <a class="glosssee" href="#apm-glossary">Advanced Power Management</a>.</p></dd><dt><span class="glossterm">APOP</span></dt><dd><p>See <a class="glosssee" href="#apop-glossary">Authenticated Post Office Protocol</a>.</p></dd><dt><span class="glossterm">ASL</span></dt><dd><p>See <a class="glosssee" href="#asl-glossary"><acronym class="acronym">ACPI</acronym> Source Language</a>.</p></dd><dt><span class="glossterm">ATA</span></dt><dd><p>See <a class="glosssee" href="#ata-glossary">Advanced Technology Attachment</a>.</p></dd><dt><span class="glossterm">ATM</span></dt><dd><p>See <a class="glosssee" href="#atm-glossary">Asynchronous Transfer Mode</a>.</p></dd><dt><a id="aml-glossary"></a><span class="glossterm"><acronym class="acronym">ACPI</acronym> Machine Language</span></dt><dd class="glossdef"><p>Pseudocode, interpreted by a virtual machine within an
	  <acronym class="acronym">ACPI</acronym>-compliant operating system, providing a
	  layer between the underlying hardware and the documented
	  interface presented to the <acronym class="acronym">OS</acronym>.</p></dd><dt><a id="asl-glossary"></a><span class="glossterm"><acronym class="acronym">ACPI</acronym> Source Language</span></dt><dd class="glossdef"><p>The programming language <acronym class="acronym">AML</acronym> is written in.</p></dd><dt><a id="acl-glossary"></a><span class="glossterm">Access Control List</span></dt><dd class="glossdef"><p>A list of permissions attached to an object, usually either a
	  file or a network device.</p></dd><dt><a id="acpi-glossary"></a><span class="glossterm">Advanced Configuration and Power Interface</span></dt><dd class="glossdef"><p>A specification which provides an abstraction of the
	  interface the hardware presents to the operating system, so
	  that the operating system should need to know nothing about
	  the underlying hardware to make the most of it.  <acronym class="acronym">ACPI</acronym>
	  evolves and supersedes the functionality provided previously by
	  <acronym class="acronym">APM</acronym>, <acronym class="acronym">PNPBIOS</acronym> and other technologies, and
	  provides facilities for controlling power consumption, machine
	  suspension, device enabling and disabling, etc.</p></dd><dt><a id="api-glossary"></a><span class="glossterm">Application Programming Interface</span></dt><dd class="glossdef"><p>A set of procedures, protocols and tools that specify the
	  canonical interaction of one or more program parts; how, when
	  and why they do work together, and what data they share or
	  operate on.</p></dd><dt><a id="apm-glossary"></a><span class="glossterm">Advanced Power Management</span></dt><dd class="glossdef"><p>An <acronym class="acronym">API</acronym> enabling the operating system to work
	  in conjunction with the <acronym class="acronym">BIOS</acronym> in order to achieve
	  power management.  <acronym class="acronym">APM</acronym> has been superseded by
	  the much more generic and powerful <acronym class="acronym">ACPI</acronym>
	  specification for most applications.</p></dd><dt><a id="apic-glossary"></a><span class="glossterm">Advanced Programmable Interrupt Controller</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ata-glossary"></a><span class="glossterm">Advanced Technology Attachment</span></dt><dd class="glossdef"><p></p></dd><dt><a id="atm-glossary"></a><span class="glossterm">Asynchronous Transfer Mode</span></dt><dd class="glossdef"><p></p></dd><dt><a id="apop-glossary"></a><span class="glossterm">Authenticated Post Office Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="amd-glossary"></a><span class="glossterm">Automatic Mount Daemon</span></dt><dd class="glossdef"><p>A daemon that automatically mounts a filesystem when a file
          or directory within that filesystem is accessed.</p></dd></dl></div><div class="glossdiv"><h3 class="title">B</h3><dl><dt><span class="glossterm">BAR</span></dt><dd><p>See <a class="glosssee" href="#bar-glossary">Base Address Register</a>.</p></dd><dt><span class="glossterm">BIND</span></dt><dd><p>See <a class="glosssee" href="#bind-glossary">Berkeley Internet Name Domain</a>.</p></dd><dt><span class="glossterm">BIOS</span></dt><dd><p>See <a class="glosssee" href="#bios-glossary">Basic Input/Output System</a>.</p></dd><dt><span class="glossterm">BSD</span></dt><dd><p>See <a class="glosssee" href="#bsd-glossary">Berkeley Software Distribution</a>.</p></dd><dt><a id="bar-glossary"></a><span class="glossterm">Base Address Register</span></dt><dd class="glossdef"><p>The registers that determine which address range a <acronym class="acronym">PCI</acronym> device
	  will respond to.</p></dd><dt><a id="bios-glossary"></a><span class="glossterm">Basic Input/Output System</span></dt><dd class="glossdef"><p>The definition of <acronym class="acronym">BIOS</acronym> depends a bit on
	  the context. Some people refer to it as the <acronym class="acronym">ROM</acronym>
	  chip with a basic set of routines to provide an interface between
	  software and hardware.  Others refer to it as the set of routines
	  contained in the chip that help in bootstrapping the system.  Some
	  might also refer to it as the screen used to configure the
	  bootstrapping process. The <acronym class="acronym">BIOS</acronym> is PC-specific
	  but other systems have something similar.</p></dd><dt><a id="bind-glossary"></a><span class="glossterm">Berkeley Internet Name Domain</span></dt><dd class="glossdef"><p>An implementation of the <acronym class="acronym">DNS</acronym> protocols.</p></dd><dt><a id="bsd-glossary"></a><span class="glossterm">Berkeley Software Distribution</span></dt><dd class="glossdef"><p>This is the name that the Computer Systems Research Group
	  (CSRG) at <a class="link" href="http://www.berkeley.edu" target="_top">The University
	  of California at Berkeley</a>
	  gave to their improvements and modifications to
	  AT&amp;T's 32V <span class="trademark">UNIX</span>®.
	  FreeBSD is a descendant of the CSRG work.</p></dd><dt><a id="bikeshed-glossary"></a><span class="glossterm">Bikeshed Building</span></dt><dd class="glossdef"><p>A phenomenon whereby many people will give an opinion on
	  an uncomplicated topic, whilst a complex topic receives little
	  or no discussion.  See the
	  <a class="link" href="../../../../doc/en_US.ISO8859-1/books/faq/misc.html#BIKESHED-PAINTING" target="_top">FAQ</a> for
	  the origin of the term.</p></dd></dl></div><div class="glossdiv"><h3 class="title">C</h3><dl><dt><span class="glossterm">CD</span></dt><dd><p>See <a class="glosssee" href="#cd-glossary">Carrier Detect</a>.</p></dd><dt><span class="glossterm">CHAP</span></dt><dd><p>See <a class="glosssee" href="#chap-glossary">Challenge Handshake Authentication Protocol</a>.</p></dd><dt><span class="glossterm">CLIP</span></dt><dd><p>See <a class="glosssee" href="#clip-glossary">Classical <acronym class="acronym">IP</acronym> over <acronym class="acronym">ATM</acronym></a>.</p></dd><dt><span class="glossterm">COFF</span></dt><dd><p>See <a class="glosssee" href="#coff-glossary">Common Object File Format</a>.</p></dd><dt><span class="glossterm">CPU</span></dt><dd><p>See <a class="glosssee" href="#cpu-glossary">Central Processing Unit</a>.</p></dd><dt><span class="glossterm">CTS</span></dt><dd><p>See <a class="glosssee" href="#cts-glossary">Clear To Send</a>.</p></dd><dt><a id="cd-glossary"></a><span class="glossterm">Carrier Detect</span></dt><dd class="glossdef"><p>An <acronym class="acronym">RS232C</acronym> signal indicating that a carrier
	  has been detected.</p></dd><dt><a id="cpu-glossary"></a><span class="glossterm">Central Processing Unit</span></dt><dd class="glossdef"><p>Also known as the processor.  This is the brain of the
	  computer where all calculations take place.  There are a number of
	  different architectures with different instruction sets.  Among
	  the more well-known are the Intel-x86 and derivatives, Arm, and
	  PowerPC.</p></dd><dt><a id="chap-glossary"></a><span class="glossterm">Challenge Handshake Authentication Protocol</span></dt><dd class="glossdef"><p>A method of authenticating a user, based on a secret shared
	  between client and server.</p></dd><dt><a id="clip-glossary"></a><span class="glossterm">Classical <acronym class="acronym">IP</acronym> over <acronym class="acronym">ATM</acronym></span></dt><dd class="glossdef"><p></p></dd><dt><a id="cts-glossary"></a><span class="glossterm">Clear To Send</span></dt><dd class="glossdef"><p>An <acronym class="acronym">RS232C</acronym> signal giving the remote system
          permission to send data.</p><p>See Also <a class="glossseealso" href="#rts-glossary">Request To Send</a>.</p></dd><dt><a id="coff-glossary"></a><span class="glossterm">Common Object File Format</span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 class="title">D</h3><dl><dt><span class="glossterm">DAC</span></dt><dd><p>See <a class="glosssee" href="#dac-glossary">Discretionary Access Control</a>.</p></dd><dt><span class="glossterm">DDB</span></dt><dd><p>See <a class="glosssee" href="#ddb-glossary">Debugger</a>.</p></dd><dt><span class="glossterm">DES</span></dt><dd><p>See <a class="glosssee" href="#des-glossary">Data Encryption Standard</a>.</p></dd><dt><span class="glossterm">DHCP</span></dt><dd><p>See <a class="glosssee" href="#dhcp-glossary">Dynamic Host Configuration Protocol</a>.</p></dd><dt><span class="glossterm">DNS</span></dt><dd><p>See <a class="glosssee" href="#dns-glossary">Domain Name System</a>.</p></dd><dt><span class="glossterm">DSDT</span></dt><dd><p>See <a class="glosssee" href="#dsdt-glossary">Differentiated System Description Table</a>.</p></dd><dt><span class="glossterm">DSR</span></dt><dd><p>See <a class="glosssee" href="#dsr-glossary">Data Set Ready</a>.</p></dd><dt><span class="glossterm">DTR</span></dt><dd><p>See <a class="glosssee" href="#dtr-glossary">Data Terminal Ready</a>.</p></dd><dt><span class="glossterm">DVMRP</span></dt><dd><p>See <a class="glosssee" href="#dvmrp-glossary">Distance-Vector Multicast Routing Protocol</a>.</p></dd><dt><a id="dac-glossary"></a><span class="glossterm">Discretionary Access Control</span></dt><dd class="glossdef"><p></p></dd><dt><a id="des-glossary"></a><span class="glossterm">Data Encryption Standard</span></dt><dd class="glossdef"><p>A method of encrypting information, traditionally used as the
	  method of encryption for <span class="trademark">UNIX</span>® passwords and the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=crypt&amp;sektion=3&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">crypt</span>(3)</span></a>
	  function.</p></dd><dt><a id="dsr-glossary"></a><span class="glossterm">Data Set Ready</span></dt><dd class="glossdef"><p>An <acronym class="acronym">RS232C</acronym> signal sent from the modem to the
	  computer or terminal indicating a readiness to send and receive
	  data.</p><p>See Also <a class="glossseealso" href="#dtr-glossary">Data Terminal Ready</a>.</p></dd><dt><a id="dtr-glossary"></a><span class="glossterm">Data Terminal Ready</span></dt><dd class="glossdef"><p>An <acronym class="acronym">RS232C</acronym> signal sent from the computer or
	  terminal to the modem indicating a readiness to send and receive
	  data.</p></dd><dt><a id="ddb-glossary"></a><span class="glossterm">Debugger</span></dt><dd class="glossdef"><p>An interactive in-kernel facility for examining the status of
	  a system, often used after a system has crashed to establish the
	  events surrounding the failure.</p></dd><dt><a id="dsdt-glossary"></a><span class="glossterm">Differentiated System Description Table</span></dt><dd class="glossdef"><p>An <acronym class="acronym">ACPI</acronym> table, supplying basic configuration
	  information about the base system.</p></dd><dt><a id="dvmrp-glossary"></a><span class="glossterm">Distance-Vector Multicast Routing Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="dns-glossary"></a><span class="glossterm">Domain Name System</span></dt><dd class="glossdef"><p>The system that converts humanly readable hostnames (i.e.,
	  mail.example.net) to Internet addresses and vice versa.</p></dd><dt><a id="dhcp-glossary"></a><span class="glossterm">Dynamic Host Configuration Protocol</span></dt><dd class="glossdef"><p>A protocol that dynamically assigns IP addresses to a computer
	  (host) when it requests one from the server.  The address assignment
	  is called a <span class="quote">&#8220;<span class="quote">lease</span>&#8221;</span>.</p></dd></dl></div><div class="glossdiv"><h3 class="title">E</h3><dl><dt><span class="glossterm">ECOFF</span></dt><dd><p>See <a class="glosssee" href="#ecoff-glossary">Extended <acronym class="acronym">COFF</acronym></a>.</p></dd><dt><span class="glossterm">ELF</span></dt><dd><p>See <a class="glosssee" href="#elf-glossary">Executable and Linking Format</a>.</p></dd><dt><span class="glossterm">ESP</span></dt><dd><p>See <a class="glosssee" href="#esp-glossary">Encapsulated Security Payload</a>.</p></dd><dt><a id="esp-glossary"></a><span class="glossterm">Encapsulated Security Payload</span></dt><dd class="glossdef"><p></p></dd><dt><a id="elf-glossary"></a><span class="glossterm">Executable and Linking Format</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ecoff-glossary"></a><span class="glossterm">Extended <acronym class="acronym">COFF</acronym></span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 class="title">F</h3><dl><dt><span class="glossterm">FADT</span></dt><dd><p>See <a class="glosssee" href="#fadt-glossary">Fixed <acronym class="acronym">ACPI</acronym> Description Table</a>.</p></dd><dt><span class="glossterm">FAT</span></dt><dd><p>See <a class="glosssee" href="#fat-glossary">File Allocation Table</a>.</p></dd><dt><span class="glossterm">FAT16</span></dt><dd><p>See <a class="glosssee" href="#fat16-glossary">File Allocation Table (16-bit)</a>.</p></dd><dt><span class="glossterm">FTP</span></dt><dd><p>See <a class="glosssee" href="#ftp-glossary">File Transfer Protocol</a>.</p></dd><dt><a id="fat-glossary"></a><span class="glossterm">File Allocation Table</span></dt><dd class="glossdef"><p></p></dd><dt><a id="fat16-glossary"></a><span class="glossterm">File Allocation Table (16-bit)</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ftp-glossary"></a><span class="glossterm">File Transfer Protocol</span></dt><dd class="glossdef"><p>A member of the family of high-level protocols implemented
	  on top of <acronym class="acronym">TCP</acronym> which can be used to transfer
	  files over a <acronym class="acronym">TCP/IP</acronym> network.</p></dd><dt><a id="fadt-glossary"></a><span class="glossterm">Fixed <acronym class="acronym">ACPI</acronym> Description Table</span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 class="title">G</h3><dl><dt><span class="glossterm">GUI</span></dt><dd><p>See <a class="glosssee" href="#gui-glossary">Graphical User Interface</a>.</p></dd><dt><a id="giant-glossary"></a><span class="glossterm">Giant</span></dt><dd class="glossdef"><p>The name of a mutual exclusion mechanism
	  (a <code class="literal">sleep mutex</code>) that protects a large
	  set of kernel resources.  Although a simple locking mechanism
	  was adequate in the days where a machine might have only
	  a few dozen processes, one networking card, and certainly
	  only one processor, in current times it is an unacceptable
	  performance bottleneck.  FreeBSD developers are actively working
	  to replace it with locks that protect individual resources,
	  which will allow a much greater degree of parallelism for
	  both single-processor and multi-processor machines.</p></dd><dt><a id="gui-glossary"></a><span class="glossterm">Graphical User Interface</span></dt><dd class="glossdef"><p>A system where the user and computer interact with
          graphics.</p></dd></dl></div><div class="glossdiv"><h3 class="title">H</h3><dl><dt><span class="glossterm">HTML</span></dt><dd><p>See <a class="glosssee" href="#html-glossary">HyperText Markup Language</a>.</p></dd><dt><span class="glossterm">HUP</span></dt><dd><p>See <a class="glosssee" href="#hup-glossary">HangUp</a>.</p></dd><dt><a id="hup-glossary"></a><span class="glossterm">HangUp</span></dt><dd class="glossdef"><p></p></dd><dt><a id="html-glossary"></a><span class="glossterm">HyperText Markup Language</span></dt><dd class="glossdef"><p>The markup language used to create web pages.</p></dd></dl></div><div class="glossdiv"><h3 class="title">I</h3><dl><dt><span class="glossterm">I/O</span></dt><dd><p>See <a class="glosssee" href="#io-glossary">Input/Output</a>.</p></dd><dt><span class="glossterm">IASL</span></dt><dd><p>See <a class="glosssee" href="#iasl-glossary">Intel&#8217;s <acronym class="acronym">ASL</acronym> compiler</a>.</p></dd><dt><span class="glossterm">IMAP</span></dt><dd><p>See <a class="glosssee" href="#imap-glossary">Internet Message Access Protocol</a>.</p></dd><dt><span class="glossterm">IP</span></dt><dd><p>See <a class="glosssee" href="#ip-glossary">Internet Protocol</a>.</p></dd><dt><span class="glossterm">IPFW</span></dt><dd><p>See <a class="glosssee" href="#ipfw-glossary"><acronym class="acronym">IP</acronym> Firewall</a>.</p></dd><dt><span class="glossterm">IPP</span></dt><dd><p>See <a class="glosssee" href="#ipp-glossary">Internet Printing Protocol</a>.</p></dd><dt><span class="glossterm">IPv4</span></dt><dd><p>See <a class="glosssee" href="#ipv4-glossary"><acronym class="acronym">IP</acronym> Version 4</a>.</p></dd><dt><span class="glossterm">IPv6</span></dt><dd><p>See <a class="glosssee" href="#ipv6-glossary"><acronym class="acronym">IP</acronym> Version 6</a>.</p></dd><dt><span class="glossterm">ISP</span></dt><dd><p>See <a class="glosssee" href="#isp-glossary">Internet Service Provider</a>.</p></dd><dt><a id="ipfw-glossary"></a><span class="glossterm"><acronym class="acronym">IP</acronym> Firewall</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ipv4-glossary"></a><span class="glossterm"><acronym class="acronym">IP</acronym> Version 4</span></dt><dd class="glossdef"><p>The <acronym class="acronym">IP</acronym> protocol version 4, which uses 32 bits
	  for addressing.  This version is still the most widely used, but it
	  is slowly being replaced with <acronym class="acronym">IPv6</acronym>.</p><p>See Also <a class="glossseealso" href="#ipv6-glossary"><acronym class="acronym">IP</acronym> Version 6</a>.</p></dd><dt><a id="ipv6-glossary"></a><span class="glossterm"><acronym class="acronym">IP</acronym> Version 6</span></dt><dd class="glossdef"><p>The new <acronym class="acronym">IP</acronym> protocol. Invented because the
	  address space in <acronym class="acronym">IPv4</acronym> is running out.  Uses 128
	  bits for addressing.</p></dd><dt><a id="io-glossary"></a><span class="glossterm">Input/Output</span></dt><dd class="glossdef"><p></p></dd><dt><a id="iasl-glossary"></a><span class="glossterm">Intel&#8217;s <acronym class="acronym">ASL</acronym> compiler</span></dt><dd class="glossdef"><p>Intel&#8217;s compiler for converting <acronym class="acronym">ASL</acronym> into
	  <acronym class="acronym">AML</acronym>.</p></dd><dt><a id="imap-glossary"></a><span class="glossterm">Internet Message Access Protocol</span></dt><dd class="glossdef"><p>A protocol for accessing email messages on a mail server,
	  characterised by the messages usually being kept on the server as
	  opposed to being downloaded to the mail reader client.</p><p>See Also <a class="glossseealso" href="#pop3-glossary">Post Office Protocol Version 3</a>.</p></dd><dt><a id="ipp-glossary"></a><span class="glossterm">Internet Printing Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ip-glossary"></a><span class="glossterm">Internet Protocol</span></dt><dd class="glossdef"><p>The packet transmitting protocol that is the basic protocol on
	  the Internet.  Originally developed at the U.S. Department of
	  Defense and an extremely important part of the <acronym class="acronym">TCP/IP
	  </acronym> stack.  Without the Internet Protocol, the Internet
	  would not have become what it is today.  For more information, see
	  <a class="link" href="ftp://ftp.rfc-editor.org/in-notes/rfc791.txt" target="_top">
	  RFC 791</a>.</p></dd><dt><a id="isp-glossary"></a><span class="glossterm">Internet Service Provider</span></dt><dd class="glossdef"><p>A company that provides access to the Internet.</p></dd></dl></div><div class="glossdiv"><h3 class="title">K</h3><dl><dt><a id="kame-glossary"></a><span class="glossterm">KAME</span></dt><dd class="glossdef"><p>Japanese for <span class="quote">&#8220;<span class="quote">turtle</span>&#8221;</span>, the term KAME is used
	  in computing circles to refer to the <a class="link" href="http://www.kame.net/" target="_top">KAME Project</a>, who work on
	  an implementation of <acronym class="acronym">IPv6</acronym>.</p></dd><dt><span class="glossterm">KDC</span></dt><dd><p>See <a class="glosssee" href="#kdc-glossary">Key Distribution Center</a>.</p></dd><dt><span class="glossterm">KLD</span></dt><dd><p>See <a class="glosssee" href="#kld-glossary">Kernel ld(1)</a>.</p></dd><dt><span class="glossterm">KSE</span></dt><dd><p>See <a class="glosssee" href="#kse-glossary">Kernel Scheduler Entities</a>.</p></dd><dt><span class="glossterm">KVA</span></dt><dd><p>See <a class="glosssee" href="#kva-glossary">Kernel Virtual Address</a>.</p></dd><dt><span class="glossterm">Kbps</span></dt><dd><p>See <a class="glosssee" href="#kbps-glossary">Kilo Bits Per Second</a>.</p></dd><dt><a id="kld-glossary"></a><span class="glossterm">Kernel <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ld&amp;sektion=1&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ld</span>(1)</span></a></span></dt><dd class="glossdef"><p>A method of dynamically loading functionality into a FreeBSD kernel
	  without rebooting the system.</p></dd><dt><a id="kse-glossary"></a><span class="glossterm">Kernel Scheduler Entities</span></dt><dd class="glossdef"><p>A kernel-supported threading system.  See the <a class="link" href="http://www.FreeBSD.org/kse" target="_top">project home page</a>
	  for further details.</p></dd><dt><a id="kva-glossary"></a><span class="glossterm">Kernel Virtual Address</span></dt><dd class="glossdef"><p></p></dd><dt><a id="kdc-glossary"></a><span class="glossterm">Key Distribution Center</span></dt><dd class="glossdef"><p></p></dd><dt><a id="kbps-glossary"></a><span class="glossterm">Kilo Bits Per Second</span></dt><dd class="glossdef"><p>Used to measure bandwidth (how much data can pass a given
	  point at a specified amount of time).  Alternates to the Kilo
	  prefix include Mega, Giga, Tera, and so forth.</p></dd></dl></div><div class="glossdiv"><h3 class="title">L</h3><dl><dt><span class="glossterm">LAN</span></dt><dd><p>See <a class="glosssee" href="#lan-glossary">Local Area Network</a>.</p></dd><dt><span class="glossterm">LOR</span></dt><dd><p>See <a class="glosssee" href="#lor-glossary">Lock Order Reversal</a>.</p></dd><dt><span class="glossterm">LPD</span></dt><dd><p>See <a class="glosssee" href="#lpd-glossary">Line Printer Daemon</a>.</p></dd><dt><a id="lpd-glossary"></a><span class="glossterm">Line Printer Daemon</span></dt><dd class="glossdef"><p></p></dd><dt><a id="lan-glossary"></a><span class="glossterm">Local Area Network</span></dt><dd class="glossdef"><p>A network used on a local area, e.g. office, home, or so forth.
	  </p></dd><dt><a id="lor-glossary"></a><span class="glossterm">Lock Order Reversal</span></dt><dd class="glossdef"><p>The FreeBSD kernel uses a number of resource locks to
	  arbitrate contention for those resources.  A run-time
	  lock diagnostic system found in FreeBSD-CURRENT kernels
	  (but removed for releases), called <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=witness&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">witness</span>(4)</span></a>,
	  detects the potential for deadlocks due to locking errors.
	  (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=witness&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">witness</span>(4)</span></a> is actually slightly conservative, so
	  it is possible to get false positives.)  A true positive
	  report indicates that <span class="quote">&#8220;<span class="quote">if you were unlucky, a deadlock would
	  have happened here</span>&#8221;</span>.</p><p>True positive LORs tend to get fixed quickly, so
	  check http://lists.FreeBSD.org/mailman/listinfo/freebsd-current and the
	  <a class="link" href="http://sources.zabbadoz.net/freebsd/lor.html" target="_top">
	  LORs Seen</a> page before posting to the mailing lists.</p></dd></dl></div><div class="glossdiv"><h3 class="title">M</h3><dl><dt><span class="glossterm">MAC</span></dt><dd><p>See <a class="glosssee" href="#mac-glossary">Mandatory Access Control</a>.</p></dd><dt><span class="glossterm">MADT</span></dt><dd><p>See <a class="glosssee" href="#madt-glossary">Multiple <acronym class="acronym">APIC</acronym> Description Table</a>.</p></dd><dt><span class="glossterm">MFC</span></dt><dd><p>See <a class="glosssee" href="#mfc-glossary">Merge From Current</a>.</p></dd><dt><span class="glossterm">MFH</span></dt><dd><p>See <a class="glosssee" href="#mfh-glossary">Merge From Head</a>.</p></dd><dt><span class="glossterm">MFS</span></dt><dd><p>See <a class="glosssee" href="#mfs-glossary">Merge From Stable</a>.</p></dd><dt><span class="glossterm">MFV</span></dt><dd><p>See <a class="glosssee" href="#mfv-glossary">Merge From Vendor</a>.</p></dd><dt><span class="glossterm">MIT</span></dt><dd><p>See <a class="glosssee" href="#mit-glossary">Massachusetts Institute of Technology</a>.</p></dd><dt><span class="glossterm">MLS</span></dt><dd><p>See <a class="glosssee" href="#mls-glossary">Multi-Level Security</a>.</p></dd><dt><span class="glossterm">MOTD</span></dt><dd><p>See <a class="glosssee" href="#motd-glossary">Message Of The Day</a>.</p></dd><dt><span class="glossterm">MTA</span></dt><dd><p>See <a class="glosssee" href="#mta-glossary">Mail Transfer Agent</a>.</p></dd><dt><span class="glossterm">MUA</span></dt><dd><p>See <a class="glosssee" href="#mua-glossary">Mail User Agent</a>.</p></dd><dt><a id="mta-glossary"></a><span class="glossterm">Mail Transfer Agent</span></dt><dd class="glossdef"><p>An application used to transfer email.  An
	  <acronym class="acronym">MTA</acronym> has traditionally been part of the BSD
	  base system.  Today Sendmail is included in the base system, but
	  there are many other <acronym class="acronym">MTA</acronym>s, such as postfix,
	  qmail and Exim.</p></dd><dt><a id="mua-glossary"></a><span class="glossterm">Mail User Agent</span></dt><dd class="glossdef"><p>An application used by users to display and write email.</p></dd><dt><a id="mac-glossary"></a><span class="glossterm">Mandatory Access Control</span></dt><dd class="glossdef"><p></p></dd><dt><a id="mit-glossary"></a><span class="glossterm">Massachusetts Institute of Technology</span></dt><dd class="glossdef"><p></p></dd><dt><a id="mfc-glossary"></a><span class="glossterm">Merge From Current</span></dt><dd class="glossdef"><p>To merge functionality or a patch from the -CURRENT
	  branch to another, most often -STABLE.</p></dd><dt><a id="mfh-glossary"></a><span class="glossterm">Merge From Head</span></dt><dd class="glossdef"><p>To merge functionality or a patch from a repository HEAD
	  to an earlier branch.</p></dd><dt><a id="mfs-glossary"></a><span class="glossterm">Merge From Stable</span></dt><dd class="glossdef"><p>In the normal course of FreeBSD development, a change will
	  be committed to the -CURRENT branch for testing before being
	  merged to -STABLE.  On rare occasions, a change will go into
	  -STABLE first and then be merged to -CURRENT.</p><p>This term is also used when a patch is merged from -STABLE
	  to a security branch.</p><p>See Also <a class="glossseealso" href="#mfc-glossary">Merge From Current</a>.</p></dd><dt><a id="mfv-glossary"></a><span class="glossterm">Merge From Vendor</span></dt><dd class="glossdef"><p></p></dd><dt><a id="motd-glossary"></a><span class="glossterm">Message Of The Day</span></dt><dd class="glossdef"><p>A message, usually shown on login, often used to
	  distribute information to users of the system.</p></dd><dt><a id="mls-glossary"></a><span class="glossterm">Multi-Level Security</span></dt><dd class="glossdef"><p></p></dd><dt><a id="madt-glossary"></a><span class="glossterm">Multiple <acronym class="acronym">APIC</acronym> Description Table</span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 class="title">N</h3><dl><dt><span class="glossterm">NAT</span></dt><dd><p>See <a class="glosssee" href="#nat-glossary">Network Address Translation</a>.</p></dd><dt><span class="glossterm">NDISulator</span></dt><dd><p>See <a class="glosssee" href="#projectevil-glossary">Project Evil</a>.</p></dd><dt><span class="glossterm">NFS</span></dt><dd><p>See <a class="glosssee" href="#nfs-glossary">Network File System</a>.</p></dd><dt><span class="glossterm">NTFS</span></dt><dd><p>See <a class="glosssee" href="#ntfs-glossary">New Technology File System</a>.</p></dd><dt><span class="glossterm">NTP</span></dt><dd><p>See <a class="glosssee" href="#ntp-glossary">Network Time Protocol</a>.</p></dd><dt><a id="nat-glossary"></a><span class="glossterm">Network Address Translation</span></dt><dd class="glossdef"><p>A technique where <acronym class="acronym">IP</acronym> packets are rewritten
	  on the way through a gateway, enabling many machines behind the
	  gateway to effectively share a single <acronym class="acronym">IP</acronym> address.</p></dd><dt><a id="nfs-glossary"></a><span class="glossterm">Network File System</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ntfs-glossary"></a><span class="glossterm">New Technology File System</span></dt><dd class="glossdef"><p>A filesystem developed by Microsoft and available in its
	  <span class="quote">&#8220;<span class="quote">New Technology</span>&#8221;</span> operating systems, such as
	  <span class="trademark">Windows</span>® 2000, <span class="trademark">Windows NT</span>® and <span class="trademark">Windows</span>® XP.</p></dd><dt><a id="ntp-glossary"></a><span class="glossterm">Network Time Protocol</span></dt><dd class="glossdef"><p>A means of synchronizing clocks over a network.</p></dd></dl></div><div class="glossdiv"><h3 class="title">O</h3><dl><dt><span class="glossterm">OBE</span></dt><dd><p>See <a class="glosssee" href="#obe-glossary">Overtaken By Events</a>.</p></dd><dt><span class="glossterm">ODMR</span></dt><dd><p>See <a class="glosssee" href="#odmr-glossary">On-Demand Mail Relay</a>.</p></dd><dt><span class="glossterm">OS</span></dt><dd><p>See <a class="glosssee" href="#os-glossary">Operating System</a>.</p></dd><dt><a id="odmr-glossary"></a><span class="glossterm">On-Demand Mail Relay</span></dt><dd class="glossdef"><p></p></dd><dt><a id="os-glossary"></a><span class="glossterm">Operating System</span></dt><dd class="glossdef"><p>A set of programs, libraries and tools that provide access to
	  the hardware resources of a computer.  Operating systems range
	  today from simplistic designs that support only one program
	  running at a time, accessing only one device to fully
	  multi-user, multi-tasking and multi-process systems that can
	  serve thousands of users simultaneously, each of them running
	  dozens of different applications.</p></dd><dt><a id="obe-glossary"></a><span class="glossterm">Overtaken By Events</span></dt><dd class="glossdef"><p>Indicates a suggested change (such as a Problem Report
	  or a feature request) which is no longer relevant or
	  applicable due to such things as later changes to FreeBSD,
	  changes in networking standards, the affected hardware
	  having since become obsolete, and so forth.</p></dd></dl></div><div class="glossdiv"><h3 class="title">P</h3><dl><dt><span class="glossterm">PAE</span></dt><dd><p>See <a class="glosssee" href="#pae-glossary">Physical Address Extensions</a>.</p></dd><dt><span class="glossterm">PAM</span></dt><dd><p>See <a class="glosssee" href="#pam-glossary">Pluggable Authentication Modules</a>.</p></dd><dt><span class="glossterm">PAP</span></dt><dd><p>See <a class="glosssee" href="#pap-glossary">Password Authentication Protocol</a>.</p></dd><dt><span class="glossterm">PC</span></dt><dd><p>See <a class="glosssee" href="#pc-glossary">Personal Computer</a>.</p></dd><dt><span class="glossterm">PCNSFD</span></dt><dd><p>See <a class="glosssee" href="#pcnfsd-glossary">Personal Computer Network File System Daemon</a>.</p></dd><dt><span class="glossterm">PDF</span></dt><dd><p>See <a class="glosssee" href="#pdf-glossary">Portable Document Format</a>.</p></dd><dt><span class="glossterm">PID</span></dt><dd><p>See <a class="glosssee" href="#pid-glossary">Process ID</a>.</p></dd><dt><span class="glossterm">POLA</span></dt><dd><p>See <a class="glosssee" href="#pola-glossary">Principle Of Least Astonishment</a>.</p></dd><dt><span class="glossterm">POP</span></dt><dd><p>See <a class="glosssee" href="#pop-glossary">Post Office Protocol</a>.</p></dd><dt><span class="glossterm">POP3</span></dt><dd><p>See <a class="glosssee" href="#pop3-glossary">Post Office Protocol Version 3</a>.</p></dd><dt><span class="glossterm">PPD</span></dt><dd><p>See <a class="glosssee" href="#ppd-glossary">PostScript Printer Description</a>.</p></dd><dt><span class="glossterm">PPP</span></dt><dd><p>See <a class="glosssee" href="#ppp-glossary">Point-to-Point Protocol</a>.</p></dd><dt><span class="glossterm">PPPoA</span></dt><dd><p>See <a class="glosssee" href="#pppoa-glossary"><acronym class="acronym">PPP</acronym> over <acronym class="acronym">ATM</acronym></a>.</p></dd><dt><span class="glossterm">PPPoE</span></dt><dd><p>See <a class="glosssee" href="#pppoe-glossary"><acronym class="acronym">PPP</acronym> over <acronym class="acronym">Ethernet</acronym></a>.</p></dd><dt><a id="pppoa-glossary"></a><span class="glossterm"><acronym class="acronym">PPP</acronym> over <acronym class="acronym">ATM</acronym></span></dt><dd class="glossdef"><p></p></dd><dt><a id="pppoe-glossary"></a><span class="glossterm"><acronym class="acronym">PPP</acronym> over <acronym class="acronym">Ethernet</acronym></span></dt><dd class="glossdef"><p></p></dd><dt><span class="glossterm">PR</span></dt><dd><p>See <a class="glosssee" href="#pr-glossary">Problem Report</a>.</p></dd><dt><span class="glossterm">PXE</span></dt><dd><p>See <a class="glosssee" href="#pxe-glossary">Preboot eXecution Environment</a>.</p></dd><dt><a id="pap-glossary"></a><span class="glossterm">Password Authentication Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pc-glossary"></a><span class="glossterm">Personal Computer</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pcnfsd-glossary"></a><span class="glossterm">Personal Computer Network File System Daemon</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pae-glossary"></a><span class="glossterm">Physical Address Extensions</span></dt><dd class="glossdef"><p>A method of enabling access to up to 64 GB of <acronym class="acronym">RAM</acronym> on
	  systems which only physically have a 32-bit wide address space
	  (and would therefore be limited to 4 GB without PAE).</p></dd><dt><a id="pam-glossary"></a><span class="glossterm">Pluggable Authentication Modules</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ppp-glossary"></a><span class="glossterm">Point-to-Point Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pointyhat"></a><span class="glossterm">Pointy Hat</span></dt><dd class="glossdef"><p>A mythical piece of headgear, much like a
	  <code class="literal">dunce cap</code>, awarded to any FreeBSD
	  committer who breaks the build, makes revision numbers
	  go backwards, or creates any other kind of havoc in
	  the source base.  Any committer worth his or her salt
	  will soon accumulate a large collection.  The usage is
	  (almost always?) humorous.</p></dd><dt><a id="pdf-glossary"></a><span class="glossterm">Portable Document Format</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pop-glossary"></a><span class="glossterm">Post Office Protocol</span></dt><dd class="glossdef"><p></p><p>See Also <a class="glossseealso" href="#pop3-glossary">Post Office Protocol Version 3</a>.</p></dd><dt><a id="pop3-glossary"></a><span class="glossterm">Post Office Protocol Version 3</span></dt><dd class="glossdef"><p>A protocol for accessing email messages on a mail server,
	  characterised by the messages usually being downloaded from the
	  server to the client, as opposed to remaining on the server.</p><p>See Also <a class="glossseealso" href="#imap-glossary">Internet Message Access Protocol</a>.</p></dd><dt><a id="ppd-glossary"></a><span class="glossterm">PostScript Printer Description</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pxe-glossary"></a><span class="glossterm">Preboot eXecution Environment</span></dt><dd class="glossdef"><p></p></dd><dt><a id="pola-glossary"></a><span class="glossterm">Principle Of Least Astonishment</span></dt><dd class="glossdef"><p>As FreeBSD evolves, changes visible to the user should be
	  kept as unsurprising as possible.  For example, arbitrarily
	  rearranging system startup variables in
	  <code class="filename">/etc/defaults/rc.conf</code> violates
	  <acronym class="acronym">POLA</acronym>.  Developers consider
	  <acronym class="acronym">POLA</acronym> when contemplating user-visible
	  system changes.</p></dd><dt><a id="pr-glossary"></a><span class="glossterm">Problem Report</span></dt><dd class="glossdef"><p>A description of some kind of problem that has been
	  found in either the FreeBSD source or documentation.  See
	  <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/problem-reports/index.html" target="_top">
	  Writing FreeBSD Problem Reports</a>.</p></dd><dt><a id="pid-glossary"></a><span class="glossterm">Process ID</span></dt><dd class="glossdef"><p>A number, unique to a particular process on a system,
	  which identifies it and allows actions to be taken against it.</p></dd><dt><a id="projectevil-glossary"></a><span class="glossterm">Project Evil</span></dt><dd class="glossdef"><p>The working title for the <acronym class="acronym">NDISulator</acronym>,
	  written by Bill Paul, who named it referring to how awful
	  it is (from a philosophical standpoint) to need to have
	  something like this in the first place.  The
	  <acronym class="acronym">NDISulator</acronym> is a special compatibility
	  module to allow Microsoft Windows&#8482; NDIS miniport
	  network drivers to be used with FreeBSD/i386.  This is usually
	  the only way to use cards where the driver is closed-source.
	  See <code class="filename">src/sys/compat/ndis/subr_ndis.c</code>.</p></dd></dl></div><div class="glossdiv"><h3 class="title">R</h3><dl><dt><span class="glossterm">RA</span></dt><dd><p>See <a class="glosssee" href="#ra-glossary">Router Advertisement</a>.</p></dd><dt><span class="glossterm">RAID</span></dt><dd><p>See <a class="glosssee" href="#raid-glossary">Redundant Array of Inexpensive Disks</a>.</p></dd><dt><span class="glossterm">RAM</span></dt><dd><p>See <a class="glosssee" href="#ram-glossary">Random Access Memory</a>.</p></dd><dt><span class="glossterm">RD</span></dt><dd><p>See <a class="glosssee" href="#rd-glossary">Received Data</a>.</p></dd><dt><span class="glossterm">RFC</span></dt><dd><p>See <a class="glosssee" href="#rfc-glossary">Request For Comments</a>.</p></dd><dt><span class="glossterm">RISC</span></dt><dd><p>See <a class="glosssee" href="#risc-glossary">Reduced Instruction Set Computer</a>.</p></dd><dt><span class="glossterm">RPC</span></dt><dd><p>See <a class="glosssee" href="#rpc-glossary">Remote Procedure Call</a>.</p></dd><dt><span class="glossterm">RS232C</span></dt><dd><p>See <a class="glosssee" href="#rs232c-glossary">Recommended Standard 232C</a>.</p></dd><dt><span class="glossterm">RTS</span></dt><dd><p>See <a class="glosssee" href="#rts-glossary">Request To Send</a>.</p></dd><dt><a id="ram-glossary"></a><span class="glossterm">Random Access Memory</span></dt><dd class="glossdef"><p></p></dd><dt><a id="rcs-glossary"></a><span class="glossterm">Revision Control System</span></dt><dd class="glossdef"><p>The <span class="emphasis"><em>Revision Control System</em></span>
          (<acronym class="acronym">RCS</acronym>) is one of the oldest software suites
          that implement <span class="quote">&#8220;<span class="quote">revision control</span>&#8221;</span> for plain
          files.  It allows the storage, retrieval, archival, logging,
          identification and merging of multiple revisions for each
          file.  RCS consists of many small tools that work together.
          It lacks some of the features found in more modern revision
          control systems, like Git, but it is very simple
          to install, configure, and start using for a small set of
          files.</p><p>See Also <a class="glossseealso" href="#svn-glossary">Subversion</a>.</p></dd><dt><a id="rd-glossary"></a><span class="glossterm">Received Data</span></dt><dd class="glossdef"><p>An <acronym class="acronym">RS232C</acronym> pin or wire that data is
	  received on.</p><p>See Also <a class="glossseealso" href="#td-glossary">Transmitted Data</a>.</p></dd><dt><a id="rs232c-glossary"></a><span class="glossterm">Recommended Standard 232C</span></dt><dd class="glossdef"><p>A standard for communications between serial devices.</p></dd><dt><a id="risc-glossary"></a><span class="glossterm">Reduced Instruction Set Computer</span></dt><dd class="glossdef"><p>An approach to processor design where the operations the hardware
	  can perform are simplified but made as general purpose as possible.
	  This can lead to lower power consumption, fewer transistors and in
	  some cases, better performance and increased code density.  Examples
	  of RISC processors include the Alpha, <span class="trademark">SPARC</span>®, <span class="trademark">ARM</span>® and
	  <span class="trademark">PowerPC</span>®.</p></dd><dt><a id="raid-glossary"></a><span class="glossterm">Redundant Array of Inexpensive Disks</span></dt><dd class="glossdef"><p></p></dd><dt><a id="rpc-glossary"></a><span class="glossterm">Remote Procedure Call</span></dt><dd class="glossdef"><p></p></dd><dt><a id="rfc-glossary"></a><span class="glossterm">Request For Comments</span></dt><dd class="glossdef"><p>A set of documents defining Internet standards, protocols, and
	  so forth.  See
	  <a class="link" href="http://www.rfc-editor.org/" target="_top">www.rfc-editor.org</a>.
	  </p><p>Also used as a general term when someone has a suggested change
	  and wants feedback.</p></dd><dt><a id="rts-glossary"></a><span class="glossterm">Request To Send</span></dt><dd class="glossdef"><p>An <acronym class="acronym">RS232C</acronym> signal requesting that the remote
	  system commences transmission of data.</p><p>See Also <a class="glossseealso" href="#cts-glossary">Clear To Send</a>.</p></dd><dt><a id="ra-glossary"></a><span class="glossterm">Router Advertisement</span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 class="title">S</h3><dl><dt><span class="glossterm">SCI</span></dt><dd><p>See <a class="glosssee" href="#sci-glossary">System Control Interrupt</a>.</p></dd><dt><span class="glossterm">SCSI</span></dt><dd><p>See <a class="glosssee" href="#scsi-glossary">Small Computer System Interface</a>.</p></dd><dt><span class="glossterm">SG</span></dt><dd><p>See <a class="glosssee" href="#sg-glossary">Signal Ground</a>.</p></dd><dt><span class="glossterm">SMB</span></dt><dd><p>See <a class="glosssee" href="#smb-glossary">Server Message Block</a>.</p></dd><dt><span class="glossterm">SMP</span></dt><dd><p>See <a class="glosssee" href="#smp-glossary">Symmetric MultiProcessor</a>.</p></dd><dt><span class="glossterm">SMTP</span></dt><dd><p>See <a class="glosssee" href="#smtp-glossary">Simple Mail Transfer Protocol</a>.</p></dd><dt><span class="glossterm">SMTP AUTH</span></dt><dd><p>See <a class="glosssee" href="#smtpauth-glossary"><acronym class="acronym">SMTP</acronym> Authentication</a>.</p></dd><dt><span class="glossterm">SSH</span></dt><dd><p>See <a class="glosssee" href="#ssh-glossary">Secure Shell</a>.</p></dd><dt><span class="glossterm">STR</span></dt><dd><p>See <a class="glosssee" href="#str-glossary">Suspend To <acronym class="acronym">RAM</acronym></a>.</p></dd><dt><span class="glossterm">SVN</span></dt><dd><p>See <a class="glosssee" href="#svn-glossary">Subversion</a>.</p></dd><dt><a id="smtpauth-glossary"></a><span class="glossterm"><acronym class="acronym">SMTP</acronym> Authentication</span></dt><dd class="glossdef"><p></p></dd><dt><a id="smb-glossary"></a><span class="glossterm">Server Message Block</span></dt><dd class="glossdef"><p></p></dd><dt><a id="sg-glossary"></a><span class="glossterm">Signal Ground</span></dt><dd class="glossdef"><p>An <acronym class="acronym">RS232</acronym> pin or wire that is the ground
	  reference for the signal.</p></dd><dt><a id="smtp-glossary"></a><span class="glossterm">Simple Mail Transfer Protocol</span></dt><dd class="glossdef"><p></p></dd><dt><a id="ssh-glossary"></a><span class="glossterm">Secure Shell</span></dt><dd class="glossdef"><p></p></dd><dt><a id="scsi-glossary"></a><span class="glossterm">Small Computer System Interface</span></dt><dd class="glossdef"><p></p></dd><dt><a id="svn-glossary"></a><span class="glossterm">Subversion</span></dt><dd class="glossdef"><p>Subversion is a version control system
          currently used by the FreeBSD project.</p></dd><dt><a id="str-glossary"></a><span class="glossterm">Suspend To <acronym class="acronym">RAM</acronym></span></dt><dd class="glossdef"><p></p></dd><dt><a id="smp-glossary"></a><span class="glossterm">Symmetric MultiProcessor</span></dt><dd class="glossdef"><p></p></dd><dt><a id="sci-glossary"></a><span class="glossterm">System Control Interrupt</span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 class="title">T</h3><dl><dt><span class="glossterm">TCP</span></dt><dd><p>See <a class="glosssee" href="#tcp-glossary">Transmission Control Protocol</a>.</p></dd><dt><span class="glossterm">TCP/IP</span></dt><dd><p>See <a class="glosssee" href="#tcpip-glossary">Transmission Control Protocol/Internet Protocol</a>.</p></dd><dt><span class="glossterm">TD</span></dt><dd><p>See <a class="glosssee" href="#td-glossary">Transmitted Data</a>.</p></dd><dt><span class="glossterm">TFTP</span></dt><dd><p>See <a class="glosssee" href="#tftp-glossary">Trivial <acronym class="acronym">FTP</acronym></a>.</p></dd><dt><span class="glossterm">TGT</span></dt><dd><p>See <a class="glosssee" href="#tgt-glossary">Ticket-Granting Ticket</a>.</p></dd><dt><span class="glossterm">TSC</span></dt><dd><p>See <a class="glosssee" href="#tsc-glossary">Time Stamp Counter</a>.</p></dd><dt><a id="tgt-glossary"></a><span class="glossterm">Ticket-Granting Ticket</span></dt><dd class="glossdef"><p></p></dd><dt><a id="tsc-glossary"></a><span class="glossterm">Time Stamp Counter</span></dt><dd class="glossdef"><p>A profiling counter internal to modern <span class="trademark">Pentium</span>® processors
	  that counts core frequency clock ticks.</p></dd><dt><a id="tcp-glossary"></a><span class="glossterm">Transmission Control Protocol</span></dt><dd class="glossdef"><p>A protocol that sits on top of (e.g.) the <acronym class="acronym">IP</acronym>
	  protocol and guarantees that packets are delivered in a reliable,
	  ordered, fashion.</p></dd><dt><a id="tcpip-glossary"></a><span class="glossterm">Transmission Control Protocol/Internet Protocol</span></dt><dd class="glossdef"><p>The term for the combination of the <acronym class="acronym">TCP</acronym>
	  protocol running over the <acronym class="acronym">IP</acronym> protocol.  Much of
	  the Internet runs over <acronym class="acronym">TCP/IP</acronym>.</p></dd><dt><a id="td-glossary"></a><span class="glossterm">Transmitted Data</span></dt><dd class="glossdef"><p>An <acronym class="acronym">RS232C</acronym> pin or wire that data is transmitted
	  on.</p><p>See Also <a class="glossseealso" href="#rd-glossary">Received Data</a>.</p></dd><dt><a id="tftp-glossary"></a><span class="glossterm">Trivial <acronym class="acronym">FTP</acronym></span></dt><dd class="glossdef"><p></p></dd></dl></div><div class="glossdiv"><h3 class="title">U</h3><dl><dt><span class="glossterm">UDP</span></dt><dd><p>See <a class="glosssee" href="#udp-glossary">User Datagram Protocol</a>.</p></dd><dt><span class="glossterm">UFS1</span></dt><dd><p>See <a class="glosssee" href="#ufs1-glossary">Unix File System Version 1</a>.</p></dd><dt><span class="glossterm">UFS2</span></dt><dd><p>See <a class="glosssee" href="#ufs2-glossary">Unix File System Version 2</a>.</p></dd><dt><span class="glossterm">UID</span></dt><dd><p>See <a class="glosssee" href="#uid-glossary">User ID</a>.</p></dd><dt><span class="glossterm">URL</span></dt><dd><p>See <a class="glosssee" href="#url-glossary">Uniform Resource Locator</a>.</p></dd><dt><span class="glossterm">USB</span></dt><dd><p>See <a class="glosssee" href="#usb-glossary">Universal Serial Bus</a>.</p></dd><dt><a id="url-glossary"></a><span class="glossterm">Uniform Resource Locator</span></dt><dd class="glossdef"><p>A method of locating a resource, such as a document on
	  the Internet and a means to identify that resource.</p></dd><dt><a id="ufs1-glossary"></a><span class="glossterm">Unix File System Version 1</span></dt><dd class="glossdef"><p>The original <span class="trademark">UNIX</span>® file system, sometimes called the
	  Berkeley Fast File System.</p></dd><dt><a id="ufs2-glossary"></a><span class="glossterm">Unix File System Version 2</span></dt><dd class="glossdef"><p>An extension to <acronym class="acronym">UFS1</acronym>, introduced in
	  FreeBSD 5-CURRENT.  <acronym class="acronym">UFS2</acronym> adds 64 bit block
	  pointers (breaking the 1T barrier), support for extended file
	  storage and other features.</p></dd><dt><a id="usb-glossary"></a><span class="glossterm">Universal Serial Bus</span></dt><dd class="glossdef"><p>A hardware standard used to connect a wide variety of
	  computer peripherals to a universal interface.</p></dd><dt><a id="uid-glossary"></a><span class="glossterm">User ID</span></dt><dd class="glossdef"><p>A unique number assigned to each user of a computer,
	  by which the resources and permissions assigned to that
	  user can be identified.</p></dd><dt><a id="udp-glossary"></a><span class="glossterm">User Datagram Protocol</span></dt><dd class="glossdef"><p>A simple, unreliable datagram protocol which is used
	  for exchanging data on a TCP/IP network.  <acronym class="acronym">UDP</acronym>
	  does not provide error checking and correction like
	  <acronym class="acronym">TCP</acronym>.</p></dd></dl></div><div class="glossdiv"><h3 class="title">V</h3><dl><dt><span class="glossterm">VPN</span></dt><dd><p>See <a class="glosssee" href="#vpn-glossary">Virtual Private Network</a>.</p></dd><dt><a id="vpn-glossary"></a><span class="glossterm">Virtual Private Network</span></dt><dd class="glossdef"><p>A method of using a public telecommunication
	  such as the Internet, to provide remote access to a
	  localized network, such as a corporate
	  <acronym class="acronym">LAN</acronym>.</p></dd></dl></div></div><div class="index"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75582456"></a>Index</h1></div></div></div><div xmlns:xlink="http://www.w3.org/1999/xlink" class="index"><div class="indexdiv"><h3>Symbols</h3><dl><dt id="ientry-idp64945272">-CURRENT, <a class="indexterm" href="#current-stable">Tracking a Development Branch</a></dt><dd><dl><dt>compiling, <a class="indexterm" href="#current">Using FreeBSD-CURRENT</a></dt><dt>using, <a class="indexterm" href="#current">Using FreeBSD-CURRENT</a></dt></dl></dd><dt id="ientry-idp64945784">-STABLE, <a class="indexterm" href="#current-stable">Tracking a Development Branch</a></dt><dd><dl><dt>compiling, <a class="indexterm" href="#stable">Using FreeBSD-STABLE</a></dt><dt>using, <a class="indexterm" href="#stable">Using FreeBSD-STABLE</a></dt></dl></dd><dt id="ientry-idp57203960">.k5login, <a class="indexterm" href="#idp57193592">Configuring a Client to Use
	Kerberos</a></dt><dt id="ientry-idp57204856">.k5users, <a class="indexterm" href="#idp57193592">Configuring a Client to Use
	Kerberos</a></dt><dt id="ientry-idp60464760">.rhosts, <a class="indexterm" href="#idp60448760">File System Backups</a></dt><dt id="ientry-idp54038008">/boot/kernel.old, <a class="indexterm" href="#kernelconfig-building">Building and Installing a Custom Kernel</a></dt><dt id="ientry-idp49368952">/etc, <a class="indexterm" href="#configtuning-initial">Designing the Partition Layout</a></dt><dt id="ientry-idp50360952">/etc/groups, <a class="indexterm" href="#users-groups">Managing Groups</a></dt><dt id="ientry-idp57995512">/etc/login.conf, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dt id="ientry-idp66992760">/etc/mail/access, <a class="indexterm" href="#sendmail">Sendmail Configuration
	Files</a></dt><dt id="ientry-idp66993656">/etc/mail/aliases, <a class="indexterm" href="#sendmail">Sendmail Configuration
	Files</a></dt><dt id="ientry-idp66994552">/etc/mail/local-host-names, <a class="indexterm" href="#sendmail">Sendmail Configuration
	Files</a></dt><dt id="ientry-idp66995448">/etc/mail/mailer.conf, <a class="indexterm" href="#sendmail">Sendmail Configuration
	Files</a></dt><dt id="ientry-idp66996344">/etc/mail/mailertable, <a class="indexterm" href="#sendmail">Sendmail Configuration
	Files</a></dt><dt id="ientry-idp66997240">/etc/mail/sendmail.cf, <a class="indexterm" href="#sendmail">Sendmail Configuration
	Files</a></dt><dt id="ientry-idp66998136">/etc/mail/virtusertable, <a class="indexterm" href="#sendmail">Sendmail Configuration
	Files</a></dt><dt id="ientry-idp66049528">/etc/remote, <a class="indexterm" href="#direct-at">Using AT Commands</a></dt><dt id="ientry-idp65929464">/etc/ttys, <a class="indexterm" href="#dialup-ttys">Modem Configuration</a></dt><dt id="ientry-idp49370744">/usr, <a class="indexterm" href="#configtuning-initial">Designing the Partition Layout</a></dt><dt id="ientry-idp65920120">/usr/bin/login, <a class="indexterm" href="#dialup-ttys">Modem Configuration</a></dt><dt id="ientry-idp50261368">/usr/share/skel, <a class="indexterm" href="#users-adduser">adduser</a></dt><dt id="ientry-idp49369848">/var, <a class="indexterm" href="#configtuning-initial">Designing the Partition Layout</a></dt><dt id="ientry-idp46126072">386BSD, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp46117624">386BSD Patchkit, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp46135416">4.3BSD-Lite, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp45685112">4.4BSD-Lite, <a class="indexterm" href="#nutshell">Welcome to FreeBSD!</a></dt><dt id="ientry-idp71059576">802.11 (see <a href="#ientry-idp71058808">wireless networking</a>)</dt></dl></div><div class="indexdiv"><h3>A</h3><dl><dt id="ientry-idp52954232">AbiWord, <a class="indexterm" href="#idp52953592">AbiWord</a></dt><dt id="ientry-idp60719864">accounting</dt><dd><dl><dt>disk space, <a class="indexterm" href="#quotas">Disk Quotas</a></dt></dl></dd><dt id="ientry-idp50142072">accounts</dt><dd><dl><dt>adding, <a class="indexterm" href="#users-adduser">adduser</a></dt><dt>changing password, <a class="indexterm" href="#users-passwd">passwd</a></dt><dt>daemon, <a class="indexterm" href="#users-system">System Accounts</a></dt><dt>groups, <a class="indexterm" href="#users-groups">Managing Groups</a></dt><dt>limiting, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dt>modifying, <a class="indexterm" href="#users-modifying">Managing Accounts</a></dt><dt>nobody, <a class="indexterm" href="#users-system">System Accounts</a></dt><dt>operator, <a class="indexterm" href="#users-system">System Accounts</a></dt><dt>removing, <a class="indexterm" href="#users-rmuser">rmuser</a></dt><dt>superuser (root), <a class="indexterm" href="#users-superuser">The Superuser Account</a></dt><dt>system, <a class="indexterm" href="#users-system">System Accounts</a></dt><dt>user, <a class="indexterm" href="#users-user">User Accounts</a></dt></dl></dd><dt id="ientry-idp57798392">ACL, <a class="indexterm" href="#fs-acl">Access Control Lists</a></dt><dt id="ientry-idp55940728">ACPI, <a class="indexterm" href="#acpi-overview">Power and Resource Management</a>, <a class="indexterm" href="#ACPI-comprob">Common Problems</a></dt><dd><dl><dt>ASL, <a class="indexterm" href="#ACPI-aslanddump">BIOS Contains Buggy Bytecode</a>, <a class="indexterm" href="#idp56069496">Overriding the Default AML</a></dt><dt>debugging, <a class="indexterm" href="#ACPI-submitdebug">Getting and Submitting Debugging Info</a></dt><dt>problems, <a class="indexterm" href="#ACPI-comprob">Common Problems</a>, <a class="indexterm" href="#ACPI-submitdebug">Getting and Submitting Debugging Info</a></dt></dl></dd><dt id="ientry-idp50256376">adduser, <a class="indexterm" href="#users-adduser">adduser</a>, <a class="indexterm" href="#idp64327288">Utilities Which Change Login Classes</a></dt><dt id="ientry-idp67933944">AIX, <a class="indexterm" href="#network-nis">Network Information System
      (NIS)</a></dt><dt id="ientry-idp52431352">anti-aliased fonts, <a class="indexterm" href="#antialias">Anti-Aliased Fonts</a></dt><dt id="ientry-idp45877624">Apache, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a>, <a class="indexterm" href="#network-apache">Apache HTTP Server</a></dt><dd><dl><dt>configuration file, <a class="indexterm" href="#idp68824952">Configuring and Starting Apache</a></dt><dt>modules, <a class="indexterm" href="#idp68904184">Apache Modules</a></dt><dt>starting or stopping, <a class="indexterm" href="#idp68824952">Configuring and Starting Apache</a></dt></dl></dd><dt id="ientry-idp52974072">
	  Apache OpenOffice
	, <a class="indexterm" href="#idp52973432">Apache OpenOffice</a></dt><dt id="ientry-idp56054136">APIC</dt><dd><dl><dt>disabling, <a class="indexterm" href="#idp56043128">System Hangs</a></dt></dl></dd><dt id="ientry-idp55941496">APM, <a class="indexterm" href="#acpi-overview">Power and Resource Management</a></dt><dt id="ientry-idp45895416">Apple, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp64282744">ASCII, <a class="indexterm" href="#using-localization">Using Localization</a></dt><dt id="ientry-idp46155384">AT&amp;T, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp59529720">AUDIT, <a class="indexterm" href="#audit-synopsis">Synopsis</a></dt><dt id="ientry-idp67869816">autofs, <a class="indexterm" href="#network-autofs">Automating Mounts with autofs(5)</a></dt><dt id="ientry-idp67870328">automounter subsystem, <a class="indexterm" href="#network-autofs">Automating Mounts with autofs(5)</a></dt><dt id="ientry-idp66614264">AutoPPP, <a class="indexterm" href="#userppp-mgetty">Configuring Dial-in Services</a></dt></dl></div><div class="indexdiv"><h3>B</h3><dl><dt id="ientry-idp60449400">backup software, <a class="indexterm" href="#backups-programs-amanda">Third-Party Backup Utilities</a></dt><dd><dl><dt>cpio, <a class="indexterm" href="#idp60476280">Directory Backups</a></dt><dt>dump / restore, <a class="indexterm" href="#idp60448760">File System Backups</a></dt><dt>pax, <a class="indexterm" href="#idp60476280">Directory Backups</a></dt><dt>tar, <a class="indexterm" href="#idp60476280">Directory Backups</a></dt></dl></dd><dt id="ientry-idp56156024">Basic Input/Output
	System (see <a href="#ientry-idp56155384">BIOS</a>)</dt><dt id="ientry-idp70965752">BGP, <a class="indexterm" href="#network-static-routes">Configuring a Router with Static Routes</a></dt><dt id="ientry-idp45732856">binary compatibility</dt><dd><dl><dt>Linux, <a class="indexterm" href="#nutshell">Welcome to FreeBSD!</a>, <a class="indexterm" href="#linuxemu-synopsis">Synopsis</a></dt></dl></dd><dt id="ientry-idp67132408">BIND, <a class="indexterm" href="#mail-trouble">Troubleshooting</a></dt><dt id="ientry-idp56155384">BIOS, <a class="indexterm" href="#boot-introduction">FreeBSD Boot Process</a></dt><dt id="ientry-idp65584120">bits-per-second, <a class="indexterm" href="#serial">Serial Terminology and Hardware</a></dt><dt id="ientry-idp71746680">Bluetooth, <a class="indexterm" href="#network-bluetooth">Bluetooth</a></dt><dt id="ientry-idp53285240">Bluetooth audio, <a class="indexterm" href="#bluetooth-headset">Setting up Bluetooth Sound Devices</a></dt><dt id="ientry-idp56182136">Boot Loader, <a class="indexterm" href="#boot-introduction">FreeBSD Boot Process</a></dt><dt id="ientry-idp56181624">Boot Manager, <a class="indexterm" href="#boot-introduction">FreeBSD Boot Process</a>, <a class="indexterm" href="#boot-boot0">The Boot Manager</a></dt><dt id="ientry-idp56433144">boot-loader, <a class="indexterm" href="#boot-loader">Stage Three</a></dt><dt id="ientry-idp56143736">booting, <a class="indexterm" href="#boot-synopsis">Synopsis</a></dt><dt id="ientry-idp56144248">bootstrap, <a class="indexterm" href="#boot-synopsis">Synopsis</a></dt><dt id="ientry-idp51238264">Bourne shells, <a class="indexterm" href="#shells">Shells</a></dt><dt id="ientry-idp72046968">bridge, <a class="indexterm" href="#network-bridging">Bridging</a></dt><dt id="ientry-idp52838392">browsers</dt><dd><dl><dt>web, <a class="indexterm" href="#desktop-browsers">Browsers</a></dt></dl></dd><dt id="ientry-idp46193144">BSD Copyright, <a class="indexterm" href="#goals">FreeBSD Project Goals</a></dt><dt id="ientry-idp46021624">BSD Router, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp60570744">bsdlabel, <a class="indexterm" href="#idp60557304">Emergency Recovery</a></dt></dl></div><div class="indexdiv"><h3>C</h3><dl><dt id="ientry-idp52940792">Calligra, <a class="indexterm" href="#idp52940152">Calligra</a></dt><dt id="ientry-idp72523768">CARP, <a class="indexterm" href="#carp">Common Address Redundancy Protocol
	(CARP)</a></dt><dt id="ientry-idp60018040">CD burner</dt><dd><dl><dt>ATAPI, <a class="indexterm" href="#creating-cds">Creating and Using CD Media</a></dt><dt>ATAPI/CAM driver, <a class="indexterm" href="#atapicam">Supported Devices</a></dt></dl></dd><dt id="ientry-idp59996792">CD-ROMs</dt><dd><dl><dt>burning, <a class="indexterm" href="#cdrecord">Burning a CD</a></dt><dt>creating, <a class="indexterm" href="#creating-cds">Creating and Using CD Media</a></dt><dt>creating bootable, <a class="indexterm" href="#mkisofs">Writing Data to an ISO File
	System</a></dt></dl></dd><dt id="ientry-idp66533368">CHAP, <a class="indexterm" href="#userppp-PAPnCHAP">PAP and CHAP Authentication</a></dt><dt id="ientry-idp50285688">chpass, <a class="indexterm" href="#users-chpass">chpass</a></dt><dt id="ientry-idp52891640">Chromium, <a class="indexterm" href="#idp52891000">Chromium</a></dt><dt id="ientry-idp45900280">Cisco, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp45905016">Citrix, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp51186936">command line, <a class="indexterm" href="#shells">Shells</a></dt><dt id="ientry-idp46261752">committers, <a class="indexterm" href="#development">The FreeBSD Development Model</a></dt><dt id="ientry-idp72524664">Common Address Redundancy Protocol, <a class="indexterm" href="#carp">Common Address Redundancy Protocol
	(CARP)</a></dt><dt id="ientry-idp45832568">Compiler, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a></dt><dt id="ientry-idp45748216">Computer Systems Research Group (CSRG), <a class="indexterm" href="#nutshell">Welcome to FreeBSD!</a></dt><dt id="ientry-idp46237432">Concurrent Versions System (see <a href="#ientry-idp46219000">CVS</a>)</dt><dt id="ientry-idp50072824">console, <a class="indexterm" href="#consoles">Virtual Consoles and Terminals</a>, <a class="indexterm" href="#boot-singleuser">Single-User Mode</a></dt><dt id="ientry-idp46300280">contributors, <a class="indexterm" href="#development">The FreeBSD Development Model</a></dt><dt id="ientry-idp46285176">core team, <a class="indexterm" href="#development">The FreeBSD Development Model</a></dt><dt id="ientry-idp63741432">country codes, <a class="indexterm" href="#using-localization">Using Localization</a></dt><dt id="ientry-idp55079032">cron</dt><dd><dl><dt>configuration, <a class="indexterm" href="#configtuning-cron">Configuring cron(8)</a></dt></dl></dd><dt id="ientry-idp68914808">cryptography, <a class="indexterm" href="#idp68912504">SSL support</a></dt><dt id="ientry-idp65794296">cuau, <a class="indexterm" href="#serial-hw-config">Serial Port Configuration</a></dt><dt id="ientry-idp46219000">CVS, <a class="indexterm" href="#development">The FreeBSD Development Model</a></dt><dt id="ientry-idp46222072">CVS Repository, <a class="indexterm" href="#development">The FreeBSD Development Model</a></dt></dl></div><div class="indexdiv"><h3>D</h3><dl><dt id="ientry-idp50883320">dangerously dedicated, <a class="indexterm" href="#disk-organization">Disk Organization</a></dt><dt id="ientry-idp65589240">DCE, <a class="indexterm" href="#serial">Serial Terminology and Hardware</a></dt><dt id="ientry-idp53318520">device nodes, <a class="indexterm" href="#troubleshooting">Troubleshooting Sound</a></dt><dt id="ientry-idp56607224">device.hints, <a class="indexterm" href="#device-hints">Device Hints</a></dt><dt id="ientry-idp53530488">DGA, <a class="indexterm" href="#video-interface">Determining Video Capabilities</a></dt><dt id="ientry-idp68578936">DHCP</dt><dd><dl><dt>configuration files, <a class="indexterm" href="#idp68543608">Configuring a DHCP Client</a>, <a class="indexterm" href="#network-dhcp-server">Installing and Configuring a DHCP
	Server</a></dt><dt>dhcpd.conf, <a class="indexterm" href="#network-dhcp-server">Installing and Configuring a DHCP
	Server</a></dt><dt>diskless operation, <a class="indexterm" href="#network-pxe-setting-up-dhcp">Configuring the DHCP Server</a></dt><dt>installation, <a class="indexterm" href="#network-dhcp-server">Installing and Configuring a DHCP
	Server</a></dt><dt>server, <a class="indexterm" href="#network-dhcp-server">Installing and Configuring a DHCP
	Server</a></dt></dl></dd><dt id="ientry-idp65576568">dial-in service, <a class="indexterm" href="#dialup">Dial-in Service</a></dt><dt id="ientry-idp66036600">dial-out service, <a class="indexterm" href="#dialout">Dial-out Service</a></dt><dt id="ientry-idp50157560">directories, <a class="indexterm" href="#permissions">Permissions</a></dt><dt id="ientry-idp50631672">directory hierarchy, <a class="indexterm" href="#dirstructure">Directory Structure</a></dt><dt id="ientry-idp61865208">Disk Labels, <a class="indexterm" href="#geom-glabel">Labeling Disk Devices</a></dt><dt id="ientry-idp61371896">Disk Mirroring, <a class="indexterm" href="#geom-mirror">RAID1 - Mirroring</a></dt><dt id="ientry-idp57989496">disk quotas, <a class="indexterm" href="#security-resourcelimits">Resource Limits</a>, <a class="indexterm" href="#quotas">Disk Quotas</a></dt><dd><dl><dt>checking, <a class="indexterm" href="#idp60727416">Enabling Disk Quotas</a>, <a class="indexterm" href="#idp60806264">Checking Quota Limits and Disk Usage</a></dt><dt>limits, <a class="indexterm" href="#idp60748920">Setting Quota Limits</a></dt></dl></dd><dt id="ientry-idp72410232">diskless operation, <a class="indexterm" href="#network-diskless">Diskless Operation with PXE</a></dt><dt id="ientry-idp72409464">diskless workstation, <a class="indexterm" href="#network-diskless">Diskless Operation with PXE</a></dt><dt id="ientry-idp59799544">disks</dt><dd><dl><dt>adding, <a class="indexterm" href="#disks-adding">Adding Disks</a></dt><dt>detaching a memory disk, <a class="indexterm" href="#disks-mdconfig">Attaching and Detaching Existing Images</a></dt><dt>encrypting, <a class="indexterm" href="#disks-encrypting">Encrypting Disk Partitions</a></dt><dt>memory, <a class="indexterm" href="#disks-mdconfig">Attaching and Detaching Existing Images</a></dt><dt>memory file system, <a class="indexterm" href="#disks-md-freebsd5">Creating a File- or Memory-Backed Memory Disk</a></dt><dt>resizing, <a class="indexterm" href="#disks-growing">Resizing and Growing Disks</a></dt></dl></dd><dt id="ientry-idp68982264">Django, <a class="indexterm" href="#idp68981112">Django</a></dt><dt id="ientry-idp55489912">DNS, <a class="indexterm" href="#idp55488760">Hostnames</a>, <a class="indexterm" href="#idp66494840">Advanced Configuration</a>, <a class="indexterm" href="#mail-using">Mail Components</a>, <a class="indexterm" href="#mail-domain">Mail for a Domain</a>, <a class="indexterm" href="#network-dns">Domain Name System (DNS)</a></dt><dt id="ientry-idp45792248">DNS Server, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a></dt><dt id="ientry-idp64877048">Documentation (see <a href="#ientry-idp64666360">Updating and Upgrading</a>)</dt><dt id="ientry-idp64923128">documentation package (see <a href="#ientry-idp64666360">Updating and Upgrading</a>)</dt><dt id="ientry-idp53320056">DSP, <a class="indexterm" href="#troubleshooting">Troubleshooting Sound</a></dt><dt id="ientry-idp65586680">DTE, <a class="indexterm" href="#serial">Serial Terminology and Hardware</a></dt><dt id="ientry-idp65287544">DTrace, <a class="indexterm" href="#dtrace-synopsis">Synopsis</a></dt><dt id="ientry-idp65288056">DTrace support (see <a href="#ientry-idp65287544">DTrace</a>)</dt><dt id="ientry-idp70959992">dual homed hosts, <a class="indexterm" href="#network-static-routes">Configuring a Router with Static Routes</a></dt><dt id="ientry-idp60450552">dump, <a class="indexterm" href="#idp60448760">File System Backups</a></dt><dt id="ientry-idp60197624">DVD</dt><dd><dl><dt>burning, <a class="indexterm" href="#creating-dvds">Creating and Using DVD Media</a></dt><dt>DVD+RW, <a class="indexterm" href="#idp60298360">Using a DVD+RW</a></dt><dt>DVD-RAM, <a class="indexterm" href="#creating-dvd-ram">Using a DVD-RAM</a></dt><dt>DVD-RW, <a class="indexterm" href="#idp60338168">Using a DVD-RW</a></dt><dt>DVD-Video, <a class="indexterm" href="#idp60280568">Burning a DVD-Video</a></dt></dl></dd><dt id="ientry-idp68533496">Dynamic Host Configuration Protocol (see <a href="#ientry-idp68578936">DHCP</a>)</dt></dl></div><div class="indexdiv"><h3>E</h3><dl><dt id="ientry-idp51304952">editors, <a class="indexterm" href="#editors">Text Editors</a></dt><dd><dl><dt>ee1, <a class="indexterm" href="#editors">Text Editors</a></dt></dl></dd><dt id="ientry-idp51318392">ee, <a class="indexterm" href="#editors">Text Editors</a></dt><dt id="ientry-idp45774712">electronic mail (see <a href="#ientry-idp45777528">email</a>)</dt><dt id="ientry-idp54956408">ELF, <a class="indexterm" href="#linuxemu-advanced">Advanced Topics</a></dt><dd><dl><dt>branding, <a class="indexterm" href="#linuxemu-advanced">Advanced Topics</a></dt></dl></dd><dt id="ientry-idp51328888">emacs, <a class="indexterm" href="#editors">Text Editors</a></dt><dt id="ientry-idp45777528">email, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a>, <a class="indexterm" href="#mail-synopsis">Synopsis</a></dt><dd><dl><dt>change mta, <a class="indexterm" href="#mail-changingmta">Changing the Mail Transfer Agent</a></dt><dt>configuration, <a class="indexterm" href="#mail-config">Basic Configuration</a></dt><dt>receiving, <a class="indexterm" href="#mail-using">Mail Components</a></dt><dt>troubleshooting, <a class="indexterm" href="#mail-trouble">Troubleshooting</a></dt></dl></dd><dt id="ientry-idp45809016">embedded, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a></dt><dt id="ientry-idp64282232">encodings, <a class="indexterm" href="#using-localization">Using Localization</a></dt><dt id="ientry-idp51202296">environment variables, <a class="indexterm" href="#shells">Shells</a></dt><dt id="ientry-idp53074680">ePDFView, <a class="indexterm" href="#idp53074040">ePDFView</a></dt><dt id="ientry-idp54936568">execution class loader, <a class="indexterm" href="#linuxemu-advanced">Advanced Topics</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt id="ientry-idp72233592">failover, <a class="indexterm" href="#network-aggregation">Link Aggregation and Failover</a></dt><dt id="ientry-idp72234360">FEC, <a class="indexterm" href="#network-aggregation">Link Aggregation and Failover</a></dt><dt id="ientry-idp67175288">fetchmail, <a class="indexterm" href="#mail-fetchmail">Using fetchmail</a></dt><dt id="ientry-idp50457464">file permissions, <a class="indexterm" href="#permissions">Permissions</a></dt><dt id="ientry-idp67753336">file server</dt><dd><dl><dt>UNIX clients, <a class="indexterm" href="#network-nfs">Network File System (NFS)</a></dt><dt>Windows clients, <a class="indexterm" href="#network-samba">File and Print Services for Microsoft® Windows® Clients
      (Samba)</a></dt></dl></dd><dt id="ientry-idp50969976">file systems</dt><dd><dl><dt>ISO 9660, <a class="indexterm" href="#creating-cds">Creating and Using CD Media</a>, <a class="indexterm" href="#mkisofs">Writing Data to an ISO File
	System</a></dt><dt>Joliet, <a class="indexterm" href="#mkisofs">Writing Data to an ISO File
	System</a></dt><dt>mounted with fstab, <a class="indexterm" href="#disks-fstab">The fstab File</a></dt><dt>mounting, <a class="indexterm" href="#disks-mount">Using mount(8)</a></dt><dt>snapshots, <a class="indexterm" href="#snapshots">File System Snapshots</a></dt><dt>unmounting, <a class="indexterm" href="#disks-umount">Using umount(8)</a></dt></dl></dd><dt id="ientry-idp63419896">File Systems, <a class="indexterm" href="#filesystems-synopsis">Synopsis</a></dt><dt id="ientry-idp63420408">File Systems Support (see <a href="#ientry-idp63419896">File Systems</a>)</dt><dt id="ientry-idp52872056">Firefox, <a class="indexterm" href="#idp52871416">Firefox</a></dt><dt id="ientry-idp45765368">firewall, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a>, <a class="indexterm" href="#firewalls">Firewalls</a></dt><dd><dl><dt>IPFILTER, <a class="indexterm" href="#firewalls-ipf">IPFILTER (IPF)</a></dt><dt>IPFW, <a class="indexterm" href="#firewalls-ipfw">IPFW</a></dt><dt>PF, <a class="indexterm" href="#firewalls-pf">PF</a></dt><dt>rulesets, <a class="indexterm" href="#firewalls-concepts">Firewall Concepts</a></dt></dl></dd><dt id="ientry-idp52406904">fonts</dt><dd><dl><dt>anti-aliased, <a class="indexterm" href="#antialias">Anti-Aliased Fonts</a></dt><dt>spacing, <a class="indexterm" href="#antialias">Anti-Aliased Fonts</a></dt><dt>TrueType, <a class="indexterm" href="#truetype">TrueType® Fonts</a></dt></dl></dd><dt id="ientry-idp52467576">Fonts</dt><dd><dl><dt>LCD screen, <a class="indexterm" href="#antialias">Anti-Aliased Fonts</a></dt></dl></dd><dt id="ientry-idp46142328">Free Software
	  Foundation, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a>, <a class="indexterm" href="#basics-info">GNU Info Files</a></dt><dt id="ientry-idp46122616">FreeBSD Project</dt><dd><dl><dt>development model, <a class="indexterm" href="#development">The FreeBSD Development Model</a></dt><dt>goals, <a class="indexterm" href="#goals">FreeBSD Project Goals</a></dt><dt>history, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt></dl></dd><dt id="ientry-idp57875192">FreeBSD Security Advisories, <a class="indexterm" href="#security-advisories">FreeBSD Security Advisories</a></dt><dt id="ientry-idp64667128">freebsd-update (see updating-upgrading)</dt><dt id="ientry-idp46030584">FreeNAS, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp51460088">FreshPorts, <a class="indexterm" href="#ports-finding-applications">Finding Software</a></dt><dt id="ientry-idp69018360">FTP</dt><dd><dl><dt>anonymous, <a class="indexterm" href="#idp69012984">Configuration</a></dt></dl></dd><dt id="ientry-idp45770872">FTP servers, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a>, <a class="indexterm" href="#network-ftp">File Transfer Protocol (FTP)</a></dt><dt id="ientry-idp46001272">Fudo Security, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp46080504">FuryBSD, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt></dl></div><div class="indexdiv"><h3>G</h3><dl><dt id="ientry-idp70882552">gateway, <a class="indexterm" href="#network-routing">Gateways and Routes</a></dt><dt id="ientry-idp53067512">Geeqie, <a class="indexterm" href="#idp53066872">Geeqie</a></dt><dt id="ientry-idp61262456">GEOM, <a class="indexterm" href="#geom-synopsis">Synopsis</a>, <a class="indexterm" href="#geom-striping">RAID0 - Striping</a>, <a class="indexterm" href="#geom-mirror">RAID1 - Mirroring</a>, <a class="indexterm" href="#geom-raid3">RAID3 - Byte-level Striping with
	Dedicated Parity</a>, <a class="indexterm" href="#geom-graid">Software RAID Devices</a>, <a class="indexterm" href="#geom-glabel">Labeling Disk Devices</a>, <a class="indexterm" href="#geom-gjournal">UFS Journaling Through GEOM</a></dt><dt id="ientry-idp61263352">GEOM Disk Framework (see <a href="#ientry-idp61262456">GEOM</a>)</dt><dt id="ientry-idp65887352">getty, <a class="indexterm" href="#dialup-ttys">Modem Configuration</a></dt><dt id="ientry-idp46047480">GhostBSD, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp45823608">GNOME, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a>, <a class="indexterm" href="#x11-wm-gnome">GNOME</a></dt><dt id="ientry-idp46189432">GNU General Public License (GPL), <a class="indexterm" href="#goals">FreeBSD Project Goals</a></dt><dt id="ientry-idp46191096">GNU Lesser General Public License (LGPL), <a class="indexterm" href="#goals">FreeBSD Project Goals</a></dt><dt id="ientry-idp54635512">GNU toolchain, <a class="indexterm" href="#idp54627832">Installing Linux® ELF
	Binaries</a></dt><dt id="ientry-idp53126776">GnuCash, <a class="indexterm" href="#idp53126136">GnuCash</a></dt><dt id="ientry-idp53155448">Gnumeric, <a class="indexterm" href="#idp53154808">Gnumeric</a></dt><dt id="ientry-idp59804024">gpart, <a class="indexterm" href="#disks-adding">Adding Disks</a>, <a class="indexterm" href="#disks-growing">Resizing and Growing Disks</a></dt><dt id="ientry-idp60811896">grace period, <a class="indexterm" href="#idp60806264">Checking Quota Limits and Disk Usage</a></dt><dt id="ientry-idp46131960">Greenman, David, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp46121080">Grimes, Rod, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp50360184">groups, <a class="indexterm" href="#users-groups">Managing Groups</a></dt><dt id="ientry-idp53053432">gv, <a class="indexterm" href="#idp53052664">gv</a></dt></dl></div><div class="indexdiv"><h3>H</h3><dl><dt id="ientry-idp60753656">hard limit, <a class="indexterm" href="#idp60748920">Setting Quota Limits</a></dt><dt id="ientry-idp61034488">HAST</dt><dd><dl><dt>high availability, <a class="indexterm" href="#disks-hast">Highly Available Storage
	(HAST)</a></dt></dl></dd><dt id="ientry-idp71793144">HCI, <a class="indexterm" href="#idp71792504">Finding Other Bluetooth Devices</a></dt><dt id="ientry-idp55489400">hostname, <a class="indexterm" href="#idp55488760">Hostnames</a></dt><dt id="ientry-idp55523192">hosts, <a class="indexterm" href="#idp55522424">/etc/hosts</a></dt><dt id="ientry-idp67933432">HP-UX, <a class="indexterm" href="#network-nis">Network Information System
      (NIS)</a></dt><dt id="ientry-idp46119032">Hubbard, Jordan, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp55638136">hw.ata.wc, <a class="indexterm" href="#idp55637368">hw.ata.wc</a></dt></dl></div><div class="indexdiv"><h3>I</h3><dl><dt id="ientry-idp53319032">I/O port, <a class="indexterm" href="#troubleshooting">Troubleshooting Sound</a></dt><dt id="ientry-idp60514936">IEEE, <a class="indexterm" href="#idp60476280">Directory Backups</a></dt><dt id="ientry-idp53754360">image scanners, <a class="indexterm" href="#scanners">Image Scanners</a></dt><dt id="ientry-idp66945912">IMAP, <a class="indexterm" href="#mail-using">Mail Components</a></dt><dt id="ientry-idp56187512">init8, <a class="indexterm" href="#boot-introduction">FreeBSD Boot Process</a>, <a class="indexterm" href="#boot-init">Last Stage</a></dt><dt id="ientry-idp46388344">installation, <a class="indexterm" href="#bsdinstall-synopsis">Synopsis</a></dt><dd><dl><dt>troubleshooting, <a class="indexterm" href="#bsdinstall-install-trouble">Troubleshooting</a></dt></dl></dd><dt id="ientry-idp52768248">Intel i810 graphic chipset, <a class="indexterm" href="#idp52766712">Configuration with Intel® i810
	  Graphics Chipsets</a></dt><dt id="ientry-idp64229368">internationalization (see <a href="#ientry-idp64230520">localization</a>)</dt><dt id="ientry-idp68534776">Internet Systems Consortium (ISC), <a class="indexterm" href="#network-dhcp">Dynamic Host Configuration Protocol
      (DHCP)</a></dt><dt id="ientry-idp56045688">interrupt storms, <a class="indexterm" href="#idp56043128">System Hangs</a></dt><dt id="ientry-idp55273464">IP
	aliases, <a class="indexterm" href="#configtuning-virtual-hosts">Virtual Hosts</a></dt><dt id="ientry-idp70602104">IP masquerading (see <a href="#ientry-idp45767160">NAT</a>)</dt><dt id="ientry-idp72045944">IP subnet, <a class="indexterm" href="#network-bridging">Bridging</a></dt><dt id="ientry-idp70392056">IPFILTER</dt><dd><dl><dt>enabling, <a class="indexterm" href="#idp70391160">Enabling IPF</a></dt><dt>kernel options, <a class="indexterm" href="#idp70391160">Enabling IPF</a></dt><dt>logging, <a class="indexterm" href="#idp70715128">IPF Logging</a></dt><dt>rule syntax, <a class="indexterm" href="#idp70423544">IPF Rule Syntax</a></dt><dt>statistics, <a class="indexterm" href="#idp70678008">Viewing IPF Statistics</a></dt></dl></dd><dt id="ientry-idp70679032">ipfstat, <a class="indexterm" href="#idp70678008">Viewing IPF Statistics</a></dt><dt id="ientry-idp69518712">IPFW</dt><dd><dl><dt>enabling, <a class="indexterm" href="#firewalls-ipfw-enable">Enabling IPFW</a></dt><dt>kernel options, <a class="indexterm" href="#firewalls-ipfw-kernelconfig">IPFW Kernel Options</a></dt><dt>logging, <a class="indexterm" href="#idp70031736">Logging Firewall Messages</a></dt><dt>rule processing order, <a class="indexterm" href="#firewalls-ipfw-rules">IPFW Rule Syntax</a></dt><dt>rule syntax, <a class="indexterm" href="#firewalls-ipfw-rules">IPFW Rule Syntax</a></dt></dl></dd><dt id="ientry-idp70347512">ipfw, <a class="indexterm" href="#firewalls-ipfw-cmd">The IPFW Command</a></dt><dt id="ientry-idp70716024">ipmon, <a class="indexterm" href="#idp70715128">IPF Logging</a></dt><dt id="ientry-idp70604408">ipnat, <a class="indexterm" href="#idp70563832">Configuring NAT</a></dt><dt id="ientry-idp57413752">IPsec, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt><dd><dl><dt>AH, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt><dt>ESP, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt></dl></dd><dt id="ientry-idp53319544">IRQ, <a class="indexterm" href="#troubleshooting">Troubleshooting Sound</a></dt><dt id="ientry-idp45908984">Isilon, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp60003832">ISO
      9660, <a class="indexterm" href="#creating-cds">Creating and Using CD Media</a></dt><dt id="ientry-idp45918072">iXsystems, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt></dl></div><div class="indexdiv"><h3>J</h3><dl><dt id="ientry-idp58193784">jails, <a class="indexterm" href="#jails">Jails</a></dt><dt id="ientry-idp46128632">Jolitz, Bill, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp61929336">Journaling, <a class="indexterm" href="#geom-gjournal">UFS Journaling Through GEOM</a></dt><dt id="ientry-idp45922552">Juniper, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt></dl></div><div class="indexdiv"><h3>K</h3><dl><dt id="ientry-idp45825016">KDE, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a>, <a class="indexterm" href="#x11-wm-kde">KDE</a></dt><dd><dl><dt>display manager, <a class="indexterm" href="#x11-wm-kde">KDE</a></dt></dl></dd><dt id="ientry-idp57071608">Kerberos5</dt><dd><dl><dt>configure clients, <a class="indexterm" href="#idp57193592">Configuring a Client to Use
	Kerberos</a></dt><dt>enabling services, <a class="indexterm" href="#idp57140472">Configuring a Server to Use
	Kerberos</a></dt><dt>external resources, <a class="indexterm" href="#idp57307256">Resources and Further Information</a></dt><dt>Key Distribution Center, <a class="indexterm" href="#idp57070712">Setting up a Heimdal KDC</a></dt><dt>limitations and shortcomings, <a class="indexterm" href="#idp57291896">Mitigating Kerberos
	Limitations</a></dt></dl></dd><dt id="ientry-idp55650296">kern.cam.scsi_delay, <a class="indexterm" href="#idp55649016">SCSI_DELAY
	  (kern.cam.scsi_delay)</a></dt><dt id="ientry-idp55771000">kern.ipc.soacceptqueue, <a class="indexterm" href="#idp55770232">kern.ipc.soacceptqueue</a></dt><dt id="ientry-idp55740280">kern.maxfiles, <a class="indexterm" href="#kern-maxfiles">kern.maxfiles</a></dt><dt id="ientry-idp53228536">kernel, <a class="indexterm" href="#boot-introduction">FreeBSD Boot Process</a></dt><dd><dl><dt>boot interaction, <a class="indexterm" href="#boot-loader">Stage Three</a></dt><dt>bootflags, <a class="indexterm" href="#boot-init">Last Stage</a></dt><dt>building / installing, <a class="indexterm" href="#kernelconfig-building">Building and Installing a Custom Kernel</a></dt><dt>building a custom kernel, <a class="indexterm" href="#kernelconfig-synopsis">Synopsis</a></dt><dt>configuration, <a class="indexterm" href="#sound-setup">Setting Up the Sound Card</a></dt><dt>configuration file, <a class="indexterm" href="#kernelconfig-config">The Configuration File</a></dt><dt>NOTES, <a class="indexterm" href="#kernelconfig-config">The Configuration File</a></dt></dl></dd><dt id="ientry-idp54579832">kernel options</dt><dd><dl><dt>COMPAT_LINUX, <a class="indexterm" href="#linuxemu-lbc-install">Configuring Linux® Binary Compatibility</a></dt><dt>IPFILTER, <a class="indexterm" href="#idp70391160">Enabling IPF</a></dt><dt>IPFILTER_DEFAULT_BLOCK, <a class="indexterm" href="#idp70391160">Enabling IPF</a></dt><dt>IPFILTER_LOG, <a class="indexterm" href="#idp70391160">Enabling IPF</a></dt><dt>IPFIREWALL, <a class="indexterm" href="#firewalls-ipfw-kernelconfig">IPFW Kernel Options</a></dt><dt>IPFIREWALL_VERBOSE, <a class="indexterm" href="#firewalls-ipfw-kernelconfig">IPFW Kernel Options</a></dt><dt>IPFIREWALL_VERBOSE_LIMIT, <a class="indexterm" href="#firewalls-ipfw-kernelconfig">IPFW Kernel Options</a></dt><dt>IPSEC, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt><dt>IPSEC_DEBUG, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt><dt>MROUTING, <a class="indexterm" href="#network-routing-multicast">Multicast Considerations</a></dt><dt>SCSI DELAY, <a class="indexterm" href="#idp55649016">SCSI_DELAY
	  (kern.cam.scsi_delay)</a></dt></dl></dd><dt id="ientry-idp64366968">keymap, <a class="indexterm" href="#setting-console">Console Setup</a></dt><dt id="ientry-idp55215352">KLD (kernel loadable
	    object), <a class="indexterm" href="#config-network-ndis">Using Windows® NDIS Drivers</a></dt><dt id="ientry-idp53180664">KMyMoney, <a class="indexterm" href="#idp53180024">KMyMoney</a></dt><dt id="ientry-idp52885752">Konqueror, <a class="indexterm" href="#idp52885112">Konqueror</a></dt></dl></div><div class="indexdiv"><h3>L</h3><dl><dt id="ientry-idp71900408">L2CAP, <a class="indexterm" href="#idp71899384">Logical Link Control and Adaptation Protocol
	  (L2CAP)</a></dt><dt id="ientry-idp72235256">LACP, <a class="indexterm" href="#network-aggregation">Link Aggregation and Failover</a></dt><dt id="ientry-idp72232824">lagg, <a class="indexterm" href="#network-aggregation">Link Aggregation and Failover</a></dt><dt id="ientry-idp63740920">language codes, <a class="indexterm" href="#using-localization">Using Localization</a></dt><dt id="ientry-idp52467064">LCD screen, <a class="indexterm" href="#antialias">Anti-Aliased Fonts</a></dt><dt id="ientry-idp66615032">LCP, <a class="indexterm" href="#userppp-mgetty">Configuring Dial-in Services</a></dt><dt id="ientry-idp68383096">LDAP, <a class="indexterm" href="#network-ldap">Lightweight Directory Access Protocol
	(LDAP)</a>, <a class="indexterm" href="#idp69110648">Security Settings</a></dt><dt id="ientry-idp68403960">LDAP Server, <a class="indexterm" href="#ldap-config">Configuring an LDAP Server</a></dt><dt id="ientry-idp52981496">LibreOffice, <a class="indexterm" href="#idp52980856">LibreOffice</a></dt><dt id="ientry-idp57988344">limiting users, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dd><dl><dt>coredumpsize, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dt>cputime, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dt>filesize, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dt>maxproc, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dt>memorylocked, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dt>memoryuse, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dt>openfiles, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dt>quotas, <a class="indexterm" href="#security-resourcelimits">Resource Limits</a></dt><dt>sbsize, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt><dt>stacksize, <a class="indexterm" href="#users-limiting">Configuring Login Classes</a></dt></dl></dd><dt id="ientry-idp54629368">Linux, <a class="indexterm" href="#network-nis">Network Information System
      (NIS)</a></dt><dd><dl><dt>ELF binaries, <a class="indexterm" href="#idp54627832">Installing Linux® ELF
	Binaries</a></dt></dl></dd><dt id="ientry-idp54547320">Linux binary compatibility, <a class="indexterm" href="#linuxemu-synopsis">Synopsis</a></dt><dt id="ientry-idp60574968">livefs
	  CD, <a class="indexterm" href="#idp60557304">Emergency Recovery</a></dt><dt id="ientry-idp72236152">loadbalance, <a class="indexterm" href="#network-aggregation">Link Aggregation and Failover</a></dt><dt id="ientry-idp56436344">loader, <a class="indexterm" href="#boot-loader">Stage Three</a></dt><dt id="ientry-idp56436856">loader configuration, <a class="indexterm" href="#boot-loader">Stage Three</a></dt><dt id="ientry-idp64254840">locale, <a class="indexterm" href="#using-localization">Using Localization</a>, <a class="indexterm" href="#setting-locale">Setting Locale for Login Shell</a></dt><dt id="ientry-idp64230520">localization, <a class="indexterm" href="#l10n-synopsis">Synopsis</a></dt><dd><dl><dt>German, <a class="indexterm" href="#idp64596472">Additional Language-Specific Resources</a></dt><dt>Greek, <a class="indexterm" href="#idp64596472">Additional Language-Specific Resources</a></dt><dt>Japanese, <a class="indexterm" href="#idp64596472">Additional Language-Specific Resources</a></dt><dt>Korean, <a class="indexterm" href="#idp64596472">Additional Language-Specific Resources</a></dt><dt>Russian, <a class="indexterm" href="#ru-localize">Russian Language (KOI8-R Encoding)</a></dt><dt>Traditional Chinese, <a class="indexterm" href="#idp64596472">Additional Language-Specific Resources</a></dt></dl></dd><dt id="ientry-idp69039224">log files</dt><dd><dl><dt>FTP, <a class="indexterm" href="#idp69012984">Configuration</a></dt></dl></dd><dt id="ientry-idp54715384">log management, <a class="indexterm" href="#idp54713208">Log Management and Rotation</a></dt><dt id="ientry-idp54714872">log rotation, <a class="indexterm" href="#idp54713208">Log Management and Rotation</a></dt><dt id="ientry-idp64295544">login class, <a class="indexterm" href="#setting-locale">Setting Locale for Login Shell</a>, <a class="indexterm" href="#idp64327288">Utilities Which Change Login Classes</a></dt><dt id="ientry-idp50156280">ls1, <a class="indexterm" href="#permissions">Permissions</a></dt></dl></div><div class="indexdiv"><h3>M</h3><dl><dt id="ientry-idp58875640">MAC, <a class="indexterm" href="#mac-synopsis">Synopsis</a></dt><dd><dl><dt>File System Firewall Policy, <a class="indexterm" href="#mac-bsdextended">The MAC BSD Extended Policy</a></dt></dl></dd><dt id="ientry-idp59303160">MAC Biba Integrity Policy, <a class="indexterm" href="#mac-biba">The MAC Biba Module</a></dt><dt id="ientry-idp59426808">MAC Configuration Testing, <a class="indexterm" href="#idp59426168">Testing the Configuration</a></dt><dt id="ientry-idp59137400">MAC Interface Silencing Policy, <a class="indexterm" href="#mac-ifoff">The MAC Interface Silencing Policy</a></dt><dt id="ientry-idp59083896">MAC LOMAC, <a class="indexterm" href="#mac-lomac">The MAC Low-watermark Module</a></dt><dt id="ientry-idp59226616">MAC Multi-Level Security Policy, <a class="indexterm" href="#mac-mls">The MAC Multi-Level Security Module</a></dt><dt id="ientry-idp59149816">MAC Port Access Control List Policy, <a class="indexterm" href="#mac-portacl">The MAC Port Access Control List Policy</a></dt><dt id="ientry-idp59193208">MAC Process Partition Policy, <a class="indexterm" href="#mac-partition">The MAC Partition Policy</a></dt><dt id="ientry-idp59071992">MAC See Other UIDs Policy, <a class="indexterm" href="#mac-seeotheruids">The MAC See Other UIDs Policy</a></dt><dt id="ientry-idp59444600">MAC Troubleshooting, <a class="indexterm" href="#mac-troubleshoot">Troubleshooting the MAC Framework</a></dt><dt id="ientry-idp56944376">MacOS, <a class="indexterm" href="#idp56939256">Generating a Single One-time Password</a></dt><dt id="ientry-idp66507256">mail host, <a class="indexterm" href="#mail-using">Mail Components</a></dt><dt id="ientry-idp66946936">mail server daemons</dt><dd><dl><dt>Exim, <a class="indexterm" href="#mail-using">Mail Components</a></dt><dt>Postfix, <a class="indexterm" href="#mail-using">Mail Components</a></dt><dt>qmail, <a class="indexterm" href="#mail-using">Mail Components</a></dt><dt>Sendmail, <a class="indexterm" href="#mail-using">Mail Components</a></dt></dl></dd><dt id="ientry-idp67383032">Mail User Agents, <a class="indexterm" href="#mail-agents">Mail User Agents</a></dt><dt id="ientry-idp58876152">Mandatory Access Control (see <a href="#ientry-idp58875640">MAC</a>)</dt><dt id="ientry-idp51342328">manual pages, <a class="indexterm" href="#basics-more-information">Manual Pages</a></dt><dt id="ientry-idp56180728">Master Boot Record
	(MBR), <a class="indexterm" href="#boot-introduction">FreeBSD Boot Process</a>, <a class="indexterm" href="#boot-boot0">The Boot Manager</a></dt><dt id="ientry-idp45927160">McAfee, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp53618296">mencoder, <a class="indexterm" href="#video-mplayer">MPlayer and
	  MEncoder</a></dt><dt id="ientry-idp46053496">mfsBSD, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp66613368">mgetty, <a class="indexterm" href="#userppp-mgetty">Configuring Dial-in Services</a></dt><dt id="ientry-idp69066232">Microsoft Windows, <a class="indexterm" href="#network-samba">File and Print Services for Microsoft® Windows® Clients
      (Samba)</a></dt><dt id="ientry-idp55213432">Microsoft Windows</dt><dd><dl><dt>device drivers, <a class="indexterm" href="#config-network-ndis">Using Windows® NDIS Drivers</a></dt></dl></dd><dt id="ientry-idp46097656">MidnightBSD, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp64292344">MIME, <a class="indexterm" href="#setting-locale">Setting Locale for Login Shell</a></dt><dt id="ientry-idp65579896">modem, <a class="indexterm" href="#dialup">Dial-in Service</a></dt><dt id="ientry-idp68925944">mod_perl</dt><dd><dl><dt>Perl, <a class="indexterm" href="#idp68925176">mod_perl</a></dt></dl></dd><dt id="ientry-idp68938360">mod_php</dt><dd><dl><dt>PHP, <a class="indexterm" href="#idp68934904">mod_php</a></dt></dl></dd><dt id="ientry-idp67763576">mountd, <a class="indexterm" href="#network-nfs">Network File System (NFS)</a></dt><dt id="ientry-idp64409080">moused, <a class="indexterm" href="#setting-console">Console Setup</a></dt><dt id="ientry-idp53568248">MPlayer, <a class="indexterm" href="#video-mplayer">MPlayer and
	  MEncoder</a></dt><dt id="ientry-idp56943352">MS-DOS, <a class="indexterm" href="#idp56939256">Generating a Single One-time Password</a></dt><dt id="ientry-idp56553848">multi-user mode, <a class="indexterm" href="#boot-multiuser">Multi-User Mode</a></dt><dt id="ientry-idp71019896">multicast routing, <a class="indexterm" href="#network-routing-multicast">Multicast Considerations</a></dt><dt id="ientry-idp66506744">MX record, <a class="indexterm" href="#mail-using">Mail Components</a>, <a class="indexterm" href="#mail-trouble">Troubleshooting</a>, <a class="indexterm" href="#mail-config">Basic Configuration</a></dt></dl></div><div class="indexdiv"><h3>N</h3><dl><dt id="ientry-idp59383544">Nagios in a MAC Jail, <a class="indexterm" href="#mac-implementing">Nagios in a MAC Jail</a></dt><dt id="ientry-idp46058360">NAS4Free, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp45767160">NAT, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a>, <a class="indexterm" href="#idp70563832">Configuring NAT</a></dt><dd><dl><dt>and IPFW, <a class="indexterm" href="#in-kernel-nat">In-kernel NAT</a></dt></dl></dd><dt id="ientry-idp55210616">NDIS, <a class="indexterm" href="#config-network-ndis">Using Windows® NDIS Drivers</a></dt><dt id="ientry-idp55211512">NDISulator, <a class="indexterm" href="#config-network-ndis">Using Windows® NDIS Drivers</a></dt><dt id="ientry-idp55813240">net.inet.ip.portrange.*, <a class="indexterm" href="#idp55812472">net.inet.ip.portrange.*</a></dt><dt id="ientry-idp46136568">Net/2, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp45946104">NetApp, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp66496248">NetBIOS, <a class="indexterm" href="#idp66494840">Advanced Configuration</a></dt><dt id="ientry-idp67934968">NetBSD, <a class="indexterm" href="#network-nis">Network Information System
      (NIS)</a></dt><dt id="ientry-idp45953784">Netflix, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp68249336">netgroups, <a class="indexterm" href="#network-netgroups">Using Netgroups</a></dt><dt id="ientry-idp70603256">network address translation (see <a href="#ientry-idp45767160">NAT</a>)</dt><dt id="ientry-idp54665592">network cards</dt><dd><dl><dt>configuration, <a class="indexterm" href="#config-network-setup">Setting Up Network Interface Cards</a>, <a class="indexterm" href="#idp54749304">Configuring the Network Card</a></dt><dt>driver, <a class="indexterm" href="#idp54667512">Locating the Correct Driver</a></dt><dt>testing, <a class="indexterm" href="#idp54828536">Testing the Ethernet Card</a></dt><dt>troubleshooting, <a class="indexterm" href="#idp55256440">Troubleshooting</a></dt></dl></dd><dt id="ientry-idp54713848">newsyslog, <a class="indexterm" href="#idp54713208">Log Management and Rotation</a></dt><dt id="ientry-idp54714360">newsyslog.conf, <a class="indexterm" href="#idp54713208">Log Management and Rotation</a></dt><dt id="ientry-idp60814328">NFS, <a class="indexterm" href="#idp60813688">Quotas over NFS</a>, <a class="indexterm" href="#network-nfs">Network File System (NFS)</a></dt><dd><dl><dt>configuration, <a class="indexterm" href="#network-configuring-nfs">Configuring the Server</a></dt><dt>export examples, <a class="indexterm" href="#network-configuring-nfs">Configuring the Server</a></dt><dt>installing multiple machines, <a class="indexterm" href="#small-lan">Tracking for Multiple Machines</a></dt><dt>mounting, <a class="indexterm" href="#idp67825912">Configuring the Client</a></dt><dt>server, <a class="indexterm" href="#network-nfs">Network File System (NFS)</a></dt></dl></dd><dt id="ientry-idp67764472">nfsd, <a class="indexterm" href="#network-nfs">Network File System (NFS)</a></dt><dt id="ientry-idp67932408">NIS, <a class="indexterm" href="#network-nis">Network Information System
      (NIS)</a></dt><dd><dl><dt>client, <a class="indexterm" href="#idp67988472">Machine Types</a></dt><dt>client configuration, <a class="indexterm" href="#idp68151928">Setting Up an NIS Client</a></dt><dt>domain name, <a class="indexterm" href="#idp68043128">Choosing a NIS Domain Name</a></dt><dt>domains, <a class="indexterm" href="#network-nis">Network Information System
      (NIS)</a></dt><dt>maps, <a class="indexterm" href="#idp68087800">Initializing the NIS Maps</a></dt><dt>master server, <a class="indexterm" href="#idp67988472">Machine Types</a></dt><dt>password formats, <a class="indexterm" href="#idp68351096">Password Formats</a></dt><dt>server configuration, <a class="indexterm" href="#idp68054648">Configuring the NIS Master
	Server</a></dt><dt>slave server, <a class="indexterm" href="#idp67988472">Machine Types</a>, <a class="indexterm" href="#idp68141560">Setting up a NIS Slave Server</a></dt></dl></dd><dt id="ientry-idp69116536">NIS+, <a class="indexterm" href="#idp69110648">Security Settings</a></dt><dt id="ientry-idp53943672">NOTES, <a class="indexterm" href="#kernelconfig-config">The Configuration File</a></dt><dt id="ientry-idp46147448">Novell, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp69153400">NTP, <a class="indexterm" href="#idp69162104">NTP Configuration</a></dt><dd><dl><dt>ntp.conf, <a class="indexterm" href="#idp69170552">The /etc/ntp.conf file</a></dt><dt>ntpd, <a class="indexterm" href="#network-ntp">Clock Synchronization with NTP</a></dt><dt>rc.conf, <a class="indexterm" href="#idp69210232">NTP entries in /etc/rc.conf</a></dt></dl></dd><dt id="ientry-idp65605752">null-modem cable, <a class="indexterm" href="#term-cables-null">Serial Cables and Ports</a>, <a class="indexterm" href="#serialconsole-howto">In-Depth Serial Console Configuration</a></dt></dl></div><div class="indexdiv"><h3>O</h3><dl><dt id="ientry-idp71981816">OBEX, <a class="indexterm" href="#idp71980536">OBEX Object Push
	  (OPUSH)</a></dt><dt id="ientry-idp52941688">office suite</dt><dd><dl><dt>
	  Apache OpenOffice
	, <a class="indexterm" href="#idp52973432">Apache OpenOffice</a></dt><dt>Calligra, <a class="indexterm" href="#idp52940152">Calligra</a></dt><dt>LibreOffice, <a class="indexterm" href="#idp52980856">LibreOffice</a></dt></dl></dd><dt id="ientry-idp53087864">Okular, <a class="indexterm" href="#idp53087224">Okular</a></dt><dt id="ientry-idp56867960">one-time passwords, <a class="indexterm" href="#one-time-passwords">One-time Passwords</a></dt><dt id="ientry-idp67935480">OpenBSD, <a class="indexterm" href="#network-nis">Network Information System
      (NIS)</a></dt><dt id="ientry-idp57581176">OpenSSH, <a class="indexterm" href="#openssh">OpenSSH</a></dt><dd><dl><dt>client, <a class="indexterm" href="#idp57588472">Using the SSH Client Utilities</a></dt><dt>enabling, <a class="indexterm" href="#idp57738616">Enabling the SSH Server</a></dt><dt>secure copy, <a class="indexterm" href="#idp57588472">Using the SSH Client Utilities</a></dt><dt>tunneling, <a class="indexterm" href="#security-ssh-tunneling">SSH Tunneling</a></dt></dl></dd><dt id="ientry-idp57351928">OpenSSL</dt><dd><dl><dt>certificate generation, <a class="indexterm" href="#idp57351288">Generating Certificates</a></dt></dl></dd><dt id="ientry-idp46063096">OPNsense, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp70967288">OSPF, <a class="indexterm" href="#network-static-routes">Configuring a Router with Static Routes</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt id="ientry-idp51399032">packages, <a class="indexterm" href="#ports-synopsis">Synopsis</a></dt><dt id="ientry-idp66532856">PAP, <a class="indexterm" href="#userppp-PAPnCHAP">PAP and CHAP Authentication</a></dt><dt id="ientry-idp49368440">partition layout, <a class="indexterm" href="#configtuning-initial">Designing the Partition Layout</a></dt><dt id="ientry-idp50882552">partitions, <a class="indexterm" href="#disk-organization">Disk Organization</a>, <a class="indexterm" href="#disks-adding">Adding Disks</a>, <a class="indexterm" href="#disks-growing">Resizing and Growing Disks</a></dt><dt id="ientry-idp50339704">passwd, <a class="indexterm" href="#users-passwd">passwd</a></dt><dt id="ientry-idp66557816">password, <a class="indexterm" href="#userppp-PAPnCHAP">PAP and CHAP Authentication</a></dt><dt id="ientry-idp60513784">pax, <a class="indexterm" href="#idp60476280">Directory Backups</a></dt><dt id="ientry-idp53226616">PCI, <a class="indexterm" href="#sound-setup">Setting Up the Sound Card</a></dt><dt id="ientry-idp53046136">PDF</dt><dd><dl><dt>viewing, <a class="indexterm" href="#idp53040504">Xpdf</a>, <a class="indexterm" href="#idp53052664">gv</a>, <a class="indexterm" href="#idp53074040">ePDFView</a>, <a class="indexterm" href="#idp53087224">Okular</a></dt></dl></dd><dt id="ientry-idp50428024">permissions, <a class="indexterm" href="#permissions">Permissions</a></dt><dd><dl><dt>symbolic, <a class="indexterm" href="#idp50486904">Symbolic Permissions</a></dt></dl></dd><dt id="ientry-idp46102648">pfSense, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp74808696">pgp keys, <a class="indexterm" href="#pgpkeys">OpenPGP Keys</a></dt><dt id="ientry-idp51464696">pkg, <a class="indexterm" href="#security-pkg">Monitoring Third Party Security Issues</a></dt><dd><dl><dt>search, <a class="indexterm" href="#ports-finding-applications">Finding Software</a></dt></dl></dd><dt id="ientry-idp66945400">POP, <a class="indexterm" href="#mail-using">Mail Components</a></dt><dt id="ientry-idp67947000">portmap, <a class="indexterm" href="#idp67944440">NIS Terms and Processes</a></dt><dt id="ientry-idp51813624">portmaster, <a class="indexterm" href="#portmaster">Upgrading Ports Using
	  Portmaster</a></dt><dt id="ientry-idp51398520">ports, <a class="indexterm" href="#ports-synopsis">Synopsis</a></dt><dd><dl><dt>disk-space, <a class="indexterm" href="#ports-disk-space">Ports and Disk Space</a></dt><dt>installing, <a class="indexterm" href="#ports-skeleton">Installing Ports</a></dt><dt>removing, <a class="indexterm" href="#ports-removing">Removing Installed Ports</a></dt><dt>upgrading, <a class="indexterm" href="#ports-upgrading">Upgrading Ports</a></dt><dt>upgrading-tools, <a class="indexterm" href="#ports-upgrading-tools">Tools to Upgrade and Manage Ports</a></dt></dl></dd><dt id="ientry-idp54564088">Ports Collection, <a class="indexterm" href="#linuxemu-lbc-install">Configuring Linux® Binary Compatibility</a></dt><dt id="ientry-idp51837048">portupgrade, <a class="indexterm" href="#portupgrade">Upgrading Ports Using Portupgrade</a></dt><dt id="ientry-idp60514424">POSIX, <a class="indexterm" href="#idp60476280">Directory Backups</a>, <a class="indexterm" href="#setting-locale">Setting Locale for Login Shell</a></dt><dt id="ientry-idp53055480">PostScript</dt><dd><dl><dt>viewing, <a class="indexterm" href="#idp53052664">gv</a></dt></dl></dd><dt id="ientry-idp66359288">PPP, <a class="indexterm" href="#ppp-and-slip-synopsis">Synopsis</a></dt><dd><dl><dt>configuration, <a class="indexterm" href="#userppp-final">Final System Configuration</a></dt><dt>Microsoft extensions, <a class="indexterm" href="#idp66494840">Advanced Configuration</a></dt><dt>NAT, <a class="indexterm" href="#userppp-nat">Using PPP Network Address
	  Translation Capability</a></dt><dt>over ATM, <a class="indexterm" href="#pppoa">Using PPP over
      ATM (PPPoA)</a></dt><dt>over Ethernet, <a class="indexterm" href="#ppp-and-slip-synopsis">Synopsis</a>, <a class="indexterm" href="#pppoe">Using PPP over Ethernet (PPPoE)</a></dt><dt>troubleshooting, <a class="indexterm" href="#ppp-troubleshoot">Troubleshooting PPP Connections</a></dt><dt>with static IP
	    addresses, <a class="indexterm" href="#userppp-staticIP">Basic Configuration</a></dt></dl></dd><dt id="ientry-idp66805496">PPPoA, <a class="indexterm" href="#pppoa">Using PPP over
      ATM (PPPoA)</a></dt><dt id="ientry-idp69067896">print server</dt><dd><dl><dt>Windows clients, <a class="indexterm" href="#network-samba">File and Print Services for Microsoft® Windows® Clients
      (Samba)</a></dt></dl></dd><dt id="ientry-idp64561784">printers, <a class="indexterm" href="#ru-localize">Russian Language (KOI8-R Encoding)</a></dt><dt id="ientry-idp57961080">Process Accounting, <a class="indexterm" href="#security-accounting">Process Accounting</a></dt><dt id="ientry-idp67548920">procmail, <a class="indexterm" href="#mail-procmail">Using procmail</a></dt><dt id="ientry-idp50356344">pw, <a class="indexterm" href="#users-pw">pw</a>, <a class="indexterm" href="#idp64327288">Utilities Which Change Login Classes</a></dt><dt id="ientry-idp68981752">Python, <a class="indexterm" href="#idp68981112">Django</a></dt></dl></div><div class="indexdiv"><h3>Q</h3><dl><dt id="ientry-idp45913336">Quest KACE, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp57987576">quotas, <a class="indexterm" href="#security-resourcelimits">Resource Limits</a></dt></dl></div><div class="indexdiv"><h3>R</h3><dl><dt id="ientry-idp61372664">RAID1, <a class="indexterm" href="#geom-mirror">RAID1 - Mirroring</a></dt><dt id="ientry-idp61649400">RAID3, <a class="indexterm" href="#geom-raid3">RAID3 - Byte-level Striping with
	Dedicated Parity</a></dt><dt id="ientry-idp55173624">rc files, <a class="indexterm" href="#boot-multiuser">Multi-User Mode</a></dt><dd><dl><dt>rc.conf, <a class="indexterm" href="#configtuning-core-configuration">Managing System-Specific Configuration</a></dt><dt>rc.serial, <a class="indexterm" href="#serial-hw-config">Serial Port Configuration</a>, <a class="indexterm" href="#dialup-ttys">Modem Configuration</a></dt></dl></dd><dt id="ientry-idp55491192">resolv.conf, <a class="indexterm" href="#idp55490424">/etc/resolv.conf</a></dt><dt id="ientry-idp68741240">resolver, <a class="indexterm" href="#network-dns">Domain Name System (DNS)</a></dt><dt id="ientry-idp57986040">Resource limits, <a class="indexterm" href="#security-resourcelimits">Resource Limits</a></dt><dt id="ientry-idp60451448">restore, <a class="indexterm" href="#idp60448760">File System Backups</a></dt><dt id="ientry-idp68741752">reverse
      DNS, <a class="indexterm" href="#network-dns">Domain Name System (DNS)</a></dt><dt id="ientry-idp70966520">RIP, <a class="indexterm" href="#network-static-routes">Configuring a Router with Static Routes</a></dt><dt id="ientry-idp49922808">rmuser, <a class="indexterm" href="#users-rmuser">rmuser</a></dt><dt id="ientry-idp50960888">root file system, <a class="indexterm" href="#mount-unmount">Mounting and Unmounting File Systems</a></dt><dt id="ientry-idp68742520">root zone, <a class="indexterm" href="#network-dns">Domain Name System (DNS)</a></dt><dt id="ientry-idp72236920">roundrobin, <a class="indexterm" href="#network-aggregation">Link Aggregation and Failover</a></dt><dt id="ientry-idp66585976">routed, <a class="indexterm" href="#userppp-final">Final System Configuration</a></dt><dt id="ientry-idp45790456">router, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a>, <a class="indexterm" href="#network-static-routes">Configuring a Router with Static Routes</a></dt><dt id="ientry-idp70881784">routing, <a class="indexterm" href="#network-routing">Gateways and Routes</a></dt><dt id="ientry-idp67754488">rpcbind, <a class="indexterm" href="#network-nfs">Network File System (NFS)</a>, <a class="indexterm" href="#idp67944440">NIS Terms and Processes</a></dt><dt id="ientry-idp68995576">Ruby on Rails, <a class="indexterm" href="#idp68994936">Ruby on Rails</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt id="ientry-idp69065720">Samba server, <a class="indexterm" href="#network-samba">File and Print Services for Microsoft® Windows® Clients
      (Samba)</a></dt><dt id="ientry-idp45958776">Sandvine, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp57603960">scp1, <a class="indexterm" href="#idp57588472">Using the SSH Client Utilities</a></dt><dt id="ientry-idp64367480">screenmap, <a class="indexterm" href="#setting-console">Console Setup</a></dt><dt id="ientry-idp53529976">SDL, <a class="indexterm" href="#video-interface">Determining Video Capabilities</a></dt><dt id="ientry-idp71948408">SDP, <a class="indexterm" href="#idp71947384">Service Discovery Protocol
	  (SDP)</a></dt><dt id="ientry-idp56676472">security, <a class="indexterm" href="#security">Security</a></dt><dd><dl><dt>firewalls, <a class="indexterm" href="#firewalls">Firewalls</a></dt><dt>one-time passwords, <a class="indexterm" href="#one-time-passwords">One-time Passwords</a></dt><dt>OpenSSH, <a class="indexterm" href="#openssh">OpenSSH</a></dt><dt>OpenSSL, <a class="indexterm" href="#openssl">OpenSSL</a></dt></dl></dd><dt id="ientry-idp58118136">Security</dt><dd><dl><dt>Sudo, <a class="indexterm" href="#security-sudo">Shared Administration with Sudo</a></dt></dl></dd><dt id="ientry-idp59530232">Security Event Auditing (see <a href="#ientry-idp58875640">MAC</a>)</dt><dt id="ientry-idp66590456">sendmail, <a class="indexterm" href="#userppp-final">Final System Configuration</a></dt><dt id="ientry-idp66988920">Sendmail, <a class="indexterm" href="#sendmail">Sendmail Configuration
	Files</a></dt><dt id="ientry-idp65534712">serial communications, <a class="indexterm" href="#serial-synopsis">Synopsis</a></dt><dt id="ientry-idp66201848">serial console, <a class="indexterm" href="#serialconsole-setup">Setting Up the Serial Console</a></dt><dt id="ientry-idp55023352">services, <a class="indexterm" href="#configtuning-starting-services">Starting Services</a></dt><dt id="ientry-idp54595448">shared libraries, <a class="indexterm" href="#linuxemu-libs-manually">Installing Additional Libraries Manually</a></dt><dt id="ientry-idp51186168">shells, <a class="indexterm" href="#shells">Shells</a></dt><dt id="ientry-idp56652280">shutdown8, <a class="indexterm" href="#boot-shutdown">Shutdown Sequence</a></dt><dt id="ientry-idp56481016">single-user
	  mode, <a class="indexterm" href="#boot-loader">Stage Three</a>, <a class="indexterm" href="#boot-singleuser">Single-User Mode</a></dt><dt id="ientry-idp50262264">skeleton directory, <a class="indexterm" href="#users-adduser">adduser</a></dt><dt id="ientry-idp50881784">slices, <a class="indexterm" href="#disk-organization">Disk Organization</a></dt><dt id="ientry-idp66597368">SMTP, <a class="indexterm" href="#userppp-final">Final System Configuration</a>, <a class="indexterm" href="#mail-config">Basic Configuration</a></dt><dt id="ientry-idp60754552">soft limit, <a class="indexterm" href="#idp60748920">Setting Quota Limits</a></dt><dt id="ientry-idp55660792">Soft Updates, <a class="indexterm" href="#soft-updates">Soft Updates</a></dt><dd><dl><dt>details, <a class="indexterm" href="#idp55692152">More Details About Soft Updates</a></dt></dl></dd><dt id="ientry-idp61680248">Software RAID Devices</dt><dd><dl><dt>Hardware-assisted RAID, <a class="indexterm" href="#geom-graid">Software RAID Devices</a></dt></dl></dd><dt id="ientry-idp54957176">Solaris, <a class="indexterm" href="#linuxemu-advanced">Advanced Topics</a>, <a class="indexterm" href="#network-nis">Network Information System
      (NIS)</a></dt><dt id="ientry-idp45963512">Sony, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp45968248">Sophos, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp53227128">sound cards, <a class="indexterm" href="#sound-setup">Setting Up the Sound Card</a></dt><dt id="ientry-idp51461880">SourceForge, <a class="indexterm" href="#ports-finding-applications">Finding Software</a></dt><dt id="ientry-idp45971704">Spectra Logic, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp53156344">spreadsheet</dt><dd><dl><dt>Gnumeric, <a class="indexterm" href="#idp53154808">Gnumeric</a></dt><dt>KMyMoney, <a class="indexterm" href="#idp53180024">KMyMoney</a></dt></dl></dd><dt id="ientry-idp69117560">SQL database, <a class="indexterm" href="#idp69110648">Security Settings</a></dt><dt id="ientry-idp68914296">SSL, <a class="indexterm" href="#idp68912504">SSL support</a></dt><dt id="ientry-idp66405880">static IP address, <a class="indexterm" href="#userppp">Configuring PPP</a></dt><dt id="ientry-idp45980792">Stormshield, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp61300856">Striping, <a class="indexterm" href="#geom-striping">RAID0 - Striping</a></dt><dt id="ientry-idp70883320">subnet, <a class="indexterm" href="#network-routing">Gateways and Routes</a></dt><dt id="ientry-idp46242040">Subversion, <a class="indexterm" href="#development">The FreeBSD Development Model</a>, <a class="indexterm" href="#stable">Using FreeBSD-STABLE</a>, <a class="indexterm" href="#svn">Using Subversion</a></dt><dt id="ientry-idp46243960">Subversion Repository, <a class="indexterm" href="#development">The FreeBSD Development Model</a></dt><dd><dl><dt>Mirror Sites, <a class="indexterm" href="#svn-mirrors">Subversion Mirror
	Sites</a></dt></dl></dd><dt id="ientry-idp46245752">SVN (see <a href="#ientry-idp46242040">Subversion</a>)</dt><dt id="ientry-idp60987256">swap</dt><dd><dl><dt>encrypting, <a class="indexterm" href="#swap-encrypting">Encrypting Swap</a></dt></dl></dd><dt id="ientry-idp49391736">swap partition, <a class="indexterm" href="#configtuning-initial">Designing the Partition Layout</a></dt><dt id="ientry-idp49390968">swap sizing, <a class="indexterm" href="#configtuning-initial">Designing the Partition Layout</a></dt><dt id="ientry-idp54601848">symbolic links, <a class="indexterm" href="#linuxemu-libs-manually">Installing Additional Libraries Manually</a></dt><dt id="ientry-idp55541368">sysctl, <a class="indexterm" href="#configtuning-sysctl">Tuning with sysctl(8)</a>, <a class="indexterm" href="#configtuning-sysctlconf">sysctl.conf</a></dt><dt id="ientry-idp55555192">sysctl.conf, <a class="indexterm" href="#configtuning-sysctlconf">sysctl.conf</a></dt><dt id="ientry-idp55315192">syslog, <a class="indexterm" href="#configtuning-syslog">Configuring System Logging</a>, <a class="indexterm" href="#idp69012984">Configuration</a></dt><dt id="ientry-idp55338488">syslog.conf, <a class="indexterm" href="#idp55337848">Configuring Local Logging</a></dt><dt id="ientry-idp55320056">syslogd8, <a class="indexterm" href="#configtuning-syslog">Configuring System Logging</a></dt><dt id="ientry-idp54998776">system configuration, <a class="indexterm" href="#config-synopsis">Synopsis</a></dt><dt id="ientry-idp55314424">system logging, <a class="indexterm" href="#configtuning-syslog">Configuring System Logging</a></dt><dt id="ientry-idp54999544">system optimization, <a class="indexterm" href="#config-synopsis">Synopsis</a></dt></dl></div><div class="indexdiv"><h3>T</h3><dl><dt id="ientry-idp60527864">tape media, <a class="indexterm" href="#backups-tapebackups">Using Data Tapes for Backups</a></dt><dt id="ientry-idp60480376">tar, <a class="indexterm" href="#idp60476280">Directory Backups</a></dt><dt id="ientry-idp55300600">TCP Bandwidth Delay Product
	      Limiting</dt><dd><dl><dt>net.inet.tcp.inflight.enable, <a class="indexterm" href="#idp55299704">TCP Bandwidth Delay Product</a></dt></dl></dd><dt id="ientry-idp56979832">TCP Wrapper, <a class="indexterm" href="#tcpwrappers">TCP Wrapper</a>, <a class="indexterm" href="#idp68221560">NIS Security</a></dt><dt id="ientry-idp45698552">TCP/IP
	      networking, <a class="indexterm" href="#nutshell">Welcome to FreeBSD!</a></dt><dt id="ientry-idp50072056">terminals, <a class="indexterm" href="#consoles">Virtual Consoles and Terminals</a>, <a class="indexterm" href="#term">Terminals</a></dt><dt id="ientry-idp71719928">tether, <a class="indexterm" href="#network-usb-tethering">USB Tethering</a></dt><dt id="ientry-idp51304184">text editors, <a class="indexterm" href="#editors">Text Editors</a></dt><dt id="ientry-idp52962552">The GIMP, <a class="indexterm" href="#idp52961912">The GIMP</a></dt><dt id="ientry-idp45985144">The Weather Channel, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp71010936">traceroute8, <a class="indexterm" href="#network-routing-troubleshooting">Troubleshooting</a></dt><dt id="ientry-idp64304376">Traditional Chinese</dt><dd><dl><dt>BIG-5 encoding, <a class="indexterm" href="#login-class">Login Classes Method</a></dt></dl></dd><dt id="ientry-idp46070776">TrueOS, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp52406136">TrueType Fonts, <a class="indexterm" href="#truetype">TrueType® Fonts</a></dt><dt id="ientry-idp65793656">ttyu, <a class="indexterm" href="#serial-hw-config">Serial Port Configuration</a></dt><dt id="ientry-idp55661304">tunefs8, <a class="indexterm" href="#soft-updates">Soft Updates</a></dt><dt id="ientry-idp55541880">tuning</dt><dd><dl><dt>kernel limits, <a class="indexterm" href="#configtuning-kernel-limits">Tuning Kernel Limits</a></dt><dt>with sysctl, <a class="indexterm" href="#configtuning-sysctl">Tuning with sysctl(8)</a></dt></dl></dd><dt id="ientry-idp53683448">TV cards, <a class="indexterm" href="#tvcard">TV Cards</a></dt></dl></div><div class="indexdiv"><h3>U</h3><dl><dt id="ientry-idp46138232">U.C. Berkeley, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp68546040">UDP, <a class="indexterm" href="#idp68543608">Configuring a DHCP Client</a></dt><dt id="ientry-idp50415224">UNIX, <a class="indexterm" href="#permissions">Permissions</a></dt><dt id="ientry-idp64666360">Updating and Upgrading, <a class="indexterm" href="#updating-upgrading-freebsdupdate">FreeBSD Update</a>, <a class="indexterm" href="#updating-upgrading-documentation">Updating the Documentation Set</a>, <a class="indexterm" href="#doc-ports-install-package">Updating Documentation from Ports</a></dt><dt id="ientry-idp59906680">USB</dt><dd><dl><dt>disks, <a class="indexterm" href="#usb-disks">USB Storage Devices</a></dt></dl></dd><dt id="ientry-idp45855480">users</dt><dd><dl><dt>large sites running FreeBSD, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>V</h3><dl><dt id="ientry-idp45989752">Verisign, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp55615736">vfs.hirunningspace, <a class="indexterm" href="#idp55614968">vfs.hirunningspace</a></dt><dt id="ientry-idp55602296">vfs.vmiodirenable, <a class="indexterm" href="#idp55601528">vfs.vmiodirenable</a></dt><dt id="ientry-idp55612024">vfs.write_behind, <a class="indexterm" href="#idp55611256">vfs.write_behind</a></dt><dt id="ientry-idp51327224">vi, <a class="indexterm" href="#editors">Text Editors</a></dt><dt id="ientry-idp53565048">video packages, <a class="indexterm" href="#video-ports">Ports and Packages Dealing with Video</a></dt><dt id="ientry-idp53564536">video ports, <a class="indexterm" href="#video-ports">Ports and Packages Dealing with Video</a></dt><dt id="ientry-idp64327928">vipw, <a class="indexterm" href="#idp64327288">Utilities Which Change Login Classes</a></dt><dt id="ientry-idp50071288">virtual consoles, <a class="indexterm" href="#consoles">Virtual Consoles and Terminals</a></dt><dt id="ientry-idp55272952">virtual hosts, <a class="indexterm" href="#configtuning-virtual-hosts">Virtual Hosts</a></dt><dt id="ientry-idp72978680">Virtual LANs, <a class="indexterm" href="#network-vlan">VLANs</a></dt><dt id="ientry-idp57433080">virtual private network (see <a href="#ientry-idp57432184">VPN</a>)</dt><dt id="ientry-idp72977784">VLANs, <a class="indexterm" href="#network-vlan">VLANs</a></dt><dt id="ientry-idp55621368">vm.swap_idle_enabled, <a class="indexterm" href="#idp55620600">vm.swap_idle_enabled</a></dt><dt id="ientry-idp45994232">Voxer, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt><dt id="ientry-idp57432184">VPN, <a class="indexterm" href="#ipsec">VPN over
	IPsec</a></dt></dl></div><div class="indexdiv"><h3>W</h3><dl><dt id="ientry-idp46133112">Walnut Creek CDROM, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp68820344">web servers</dt><dd><dl><dt>dynamic, <a class="indexterm" href="#idp68977400">Dynamic Websites</a></dt><dt>secure, <a class="indexterm" href="#idp68912504">SSL support</a></dt><dt>setting up, <a class="indexterm" href="#network-apache">Apache HTTP Server</a></dt></dl></dd><dt id="ientry-idp52774520">widescreen flatpanel configuration, <a class="indexterm" href="#idp52773880">Adding a Widescreen Flatpanel to the Mix</a></dt><dt id="ientry-idp46119928">Williams, Nate, <a class="indexterm" href="#intro-history">A Brief History of FreeBSD</a></dt><dt id="ientry-idp56943864">Windows, <a class="indexterm" href="#idp56939256">Generating a Single One-time Password</a></dt><dt id="ientry-idp55212280">Windows drivers, <a class="indexterm" href="#config-network-ndis">Using Windows® NDIS Drivers</a></dt><dt id="ientry-idp71058808">wireless networking, <a class="indexterm" href="#network-wireless">Wireless Networking</a></dt></dl></div><div class="indexdiv"><h3>X</h3><dl><dt id="ientry-idp52475640">X Display Manager, <a class="indexterm" href="#x-xdm">The X Display Manager</a></dt><dt id="ientry-idp64211960">X Input Method (XIM), <a class="indexterm" href="#idp64065656">Xorg Setup</a></dt><dt id="ientry-idp45821688">X Window System, <a class="indexterm" href="#os-overview">What Can FreeBSD Do?</a></dt><dt id="ientry-idp52449912">XML, <a class="indexterm" href="#antialias">Anti-Aliased Fonts</a></dt><dt id="ientry-idp52153464">Xorg, <a class="indexterm" href="#x-config">Xorg Configuration</a></dt><dt id="ientry-idp52737528">Xorg
	  tuning, <a class="indexterm" href="#x11-troubleshooting">Troubleshooting</a></dt><dt id="ientry-idp52743928">xorg.conf, <a class="indexterm" href="#x11-troubleshooting">Troubleshooting</a></dt><dt id="ientry-idp53041144">Xpdf, <a class="indexterm" href="#idp53040504">Xpdf</a></dt><dt id="ientry-idp53529464">XVideo, <a class="indexterm" href="#video-interface">Determining Video Capabilities</a></dt></dl></div><div class="indexdiv"><h3>Y</h3><dl><dt id="ientry-idp67935992">yellow pages (see <a href="#ientry-idp67932408">NIS</a>)</dt></dl></div><div class="indexdiv"><h3>Z</h3><dl><dt id="ientry-idp68769144">zones</dt><dd><dl><dt>examples, <a class="indexterm" href="#network-dns">Domain Name System (DNS)</a></dt></dl></dd><dt id="ientry-idp46106616">ZRouter, <a class="indexterm" href="#introduction-nutshell-users">Who Uses FreeBSD?</a></dt></dl></div></div></div><div class="colophon"><h1 class="title"><a id="colophon"></a>Colophon</h1><p>This book is the combined work of hundreds of contributors to
    <span class="quote">&#8220;<span class="quote">The FreeBSD Documentation Project</span>&#8221;</span>.  The text is
    authored in XML according to the DocBook DTD and is formatted
    from XML into many different presentation formats using
    XSLT.  The printed version of this
    document would not be possible without Donald Knuth's
    <span class="application">TeX</span> typesetting language, Leslie
    Lamport's <span class="application">LaTeX</span>, or Sebastian Rahtz's
    <span class="application">JadeTeX</span> macro package.</p></div></div></body></html>