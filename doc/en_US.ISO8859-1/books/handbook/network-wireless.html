<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>31.3. Wireless Networking</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="FreeBSD Handbook" /><link rel="up" href="advanced-networking.html" title="Chapter 31. Advanced Networking" /><link rel="prev" href="network-routing.html" title="31.2. Gateways and Routes" /><link rel="next" href="network-usb-tethering.html" title="31.4. USB Tethering" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.3. Wireless Networking</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-routing.html">Prev</a> </td><th width="60%" align="center">Chapter 31. Advanced Networking</th><td width="20%" align="right"> <a accesskey="n" href="network-usb-tethering.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-wireless"></a>31.3. Wireless Networking</h2></div><div><span class="authorgroup"><span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="othername">Loader</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Murray</span> <span class="surname">Stokely</span></span>. </span></div></div></div><a id="idp72954360" class="indexterm"></a><a id="idp72955128" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72956280"></a>31.3.1. Wireless Networking Basics</h3></div></div></div><p>Most wireless networks are based on the <span class="trademark">IEEE</span>® 802.11
	standards.  A basic wireless network consists of multiple
	stations communicating with radios that broadcast in either
	the 2.4GHz or 5GHz band, though this varies according to the
	locale and is also changing to enable communication in the
	2.3GHz and 4.9GHz ranges.</p><p>802.11 networks are organized in two ways.  In
	<span class="emphasis"><em>infrastructure mode</em></span>, one station acts as
	a
	master with all the other stations associating to it, the
	network is known as a <acronym class="acronym">BSS</acronym>, and the master
	station is termed an access point (<acronym class="acronym">AP</acronym>).
	In a <acronym class="acronym">BSS</acronym>, all communication passes through
	the <acronym class="acronym">AP</acronym>; even when one station wants to
	communicate with another wireless station, messages must go
	through the <acronym class="acronym">AP</acronym>.  In the second form of
	network, there is no master and stations communicate directly.
	This form of network is termed an <acronym class="acronym">IBSS</acronym>
	and is commonly known as an <span class="emphasis"><em>ad-hoc
	  network</em></span>.</p><p>802.11 networks were first deployed in the 2.4GHz band
	using protocols defined by the <span class="trademark">IEEE</span>® 802.11 and 802.11b
	standard.  These specifications include the operating
	frequencies and the <acronym class="acronym">MAC</acronym> layer
	characteristics, including framing and transmission rates,
	as communication can occur at various rates.  Later, the
	802.11a standard defined operation in the 5GHz band, including
	different signaling mechanisms and higher transmission rates.
	Still later, the 802.11g standard defined the use of 802.11a
	signaling and transmission mechanisms in the 2.4GHz band in
	such a way as to be backwards compatible with 802.11b
	networks.</p><p>Separate from the underlying transmission techniques,
	802.11 networks have a variety of security mechanisms.  The
	original 802.11 specifications defined a simple security
	protocol called <acronym class="acronym">WEP</acronym>.  This protocol uses a
	fixed pre-shared key and the RC4 cryptographic cipher to
	encode data transmitted on a network.  Stations must all
	agree on the fixed key in order to communicate.  This scheme
	was shown to be easily broken and is now rarely used except
	to discourage transient users from joining networks.  Current
	security practice is given by the <span class="trademark">IEEE</span>® 802.11i specification
	that defines new cryptographic ciphers and an additional
	protocol to authenticate stations to an access point and
	exchange keys for data communication.  Cryptographic keys
	are periodically refreshed and there are mechanisms for
	detecting and countering intrusion attempts.  Another
	security protocol specification commonly used in wireless
	networks is termed <acronym class="acronym">WPA</acronym>, which was a
	precursor to 802.11i.  <acronym class="acronym">WPA</acronym> specifies a
	subset of the requirements found in 802.11i and is designed
	for implementation on legacy hardware.  Specifically,
	<acronym class="acronym">WPA</acronym> requires only the
	<acronym class="acronym">TKIP</acronym> cipher that is derived from the
	original <acronym class="acronym">WEP</acronym> cipher.  802.11i permits use
	of <acronym class="acronym">TKIP</acronym> but also requires support for a
	stronger cipher, AES-CCM, for encrypting data.  The
	<acronym class="acronym">AES</acronym> cipher was not required in
	<acronym class="acronym">WPA</acronym> because it was deemed too
	computationally costly to be implemented on legacy
	hardware.</p><p>The other standard to be aware of is 802.11e.  It defines
	protocols for deploying multimedia applications, such as
	streaming video and voice over IP (<acronym class="acronym">VoIP</acronym>),
	in an 802.11 network.  Like 802.11i, 802.11e also has a
	precursor specification termed <acronym class="acronym">WME</acronym> (later
	renamed <acronym class="acronym">WMM</acronym>) that has been defined by an
	industry group as a subset of 802.11e that can be deployed now
	to enable multimedia applications while waiting for the final
	ratification of 802.11e.  The most important thing to know
	about 802.11e and
	<acronym class="acronym">WME</acronym>/<acronym class="acronym">WMM</acronym> is that it
	enables prioritized traffic over a wireless network through
	Quality of Service (<acronym class="acronym">QoS</acronym>) protocols and
	enhanced media access protocols.  Proper implementation of
	these protocols enables high speed bursting of data and
	prioritized traffic flow.</p><p>FreeBSD supports networks that operate using 802.11a,
	802.11b, and 802.11g.  The <acronym class="acronym">WPA</acronym> and 802.11i
	security protocols are likewise supported (in conjunction with
	any of 11a, 11b, and 11g) and <acronym class="acronym">QoS</acronym> and
	traffic prioritization required by the
	<acronym class="acronym">WME</acronym>/<acronym class="acronym">WMM</acronym> protocols are
	supported for a limited set of wireless devices.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-quick-start"></a>31.3.2. Quick Start</h3></div></div></div><p>Connecting a computer to an existing wireless network is
	a very common situation.  This procedure shows the steps
	required.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Obtain the <acronym class="acronym">SSID</acronym> (Service Set
	    Identifier) and <acronym class="acronym">PSK</acronym> (Pre-Shared Key)
	    for the wireless network from the network
	    administrator.</p></li><li class="step"><p>Identify the wireless adapter.  The FreeBSD
	    <code class="filename">GENERIC</code> kernel includes drivers for
	    many common wireless adapters.  If the wireless adapter is
	    one of those models, it will be shown in the output from
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ifconfig | grep -B3 -i wireless</code></strong></pre><p>On FreeBSD 11 or higher, use this command
	    instead:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sysctl net.wlan.devices</code></strong></pre><p>If a wireless adapter is not listed, an additional
	    kernel module might be required, or it might be a model
	    not supported by FreeBSD.</p><p>This example shows the Atheros <code class="literal">ath0</code>
	    wireless adapter.</p></li><li class="step"><p>Add an entry for this network to
	    <code class="filename">/etc/wpa_supplicant.conf</code>.  If the
	    file does not exist, create it.  Replace
	    <em class="replaceable"><code>myssid</code></em> and
	    <em class="replaceable"><code>mypsk</code></em> with the
	    <acronym class="acronym">SSID</acronym> and <acronym class="acronym">PSK</acronym>
	    provided by the network administrator.</p><pre class="programlisting">network={
	ssid="<em class="replaceable"><code>myssid</code></em>"
	psk="<em class="replaceable"><code>mypsk</code></em>"
}</pre></li><li class="step"><p>Add entries to <code class="filename">/etc/rc.conf</code> to
	    configure the network on startup:</p><pre class="programlisting">wlans_<em class="replaceable"><code>ath0</code></em>="wlan0"
ifconfig_wlan0="WPA SYNCDHCP"</pre></li><li class="step"><p>Restart the computer, or restart the network service
	    to connect to the network:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif restart</code></strong></pre></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-basic"></a>31.3.3. Basic Setup</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73009400"></a>31.3.3.1. Kernel Configuration</h4></div></div></div><p>To use wireless networking, a wireless networking card
	  is needed and the kernel needs to be configured with the
	  appropriate wireless networking support.  The kernel is
	  separated into multiple modules so that only the required
	  support needs to be configured.</p><p>The most
	  commonly used wireless devices are those that use parts made
	  by Atheros.  These devices are supported by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a>
	  and require the following line to be added to
	  <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">if_ath_load="YES"</pre><p>The Atheros driver is split up into three separate
	  pieces: the driver (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a>), the hardware support
	  layer that handles chip-specific functions
	  (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath_hal&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath_hal</span>(4)</span></a>), and an algorithm for selecting the
	  rate for transmitting frames.  When this support is loaded
	  as kernel modules, any dependencies are automatically
	  handled.  To load support for a different type of wireless
	  device, specify the module for that device.  This example
	  is for devices based on the Intersil Prism parts
	  (<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wi&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wi</span>(4)</span></a>) driver:</p><pre class="programlisting">if_wi_load="YES"</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The examples in this section use an <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ath&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ath</span>(4)</span></a>
	    device and the device name in the examples must be
	    changed according to the configuration.  A list of
	    available wireless drivers and supported adapters can be
	    found in the FreeBSD Hardware Notes, available on
	    the <a class="link" href="https://www.FreeBSD.org/releases/index.html" target="_top">Release
	      Information</a> page of the FreeBSD website.  If a
	    native FreeBSD driver for the wireless device does not
	    exist, it may be possible to use the <span class="trademark">Windows</span>® driver
	    with the help of the <a class="link" href="config-network-setup.html#config-network-ndis" title="11.5.1.1. Using Windows® NDIS Drivers">NDIS</a> driver
	    wrapper.</p></div><p>In addition, the modules that implement cryptographic
	  support for the security protocols to use must be loaded.
	  These are intended to be dynamically loaded on demand by
	  the <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan</span>(4)</span></a> module, but for now they must be manually
	  configured.  The following modules are available:
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_wep&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_wep</span>(4)</span></a>, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_ccmp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_ccmp</span>(4)</span></a>, and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_tkip&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_tkip</span>(4)</span></a>.
	  The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_ccmp&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_ccmp</span>(4)</span></a> and <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_tkip&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_tkip</span>(4)</span></a> drivers are
	  only needed when using the <acronym class="acronym">WPA</acronym> or
	  802.11i security protocols.  If the network does not use
	  encryption, <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlan_wep&amp;sektion=4&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlan_wep</span>(4)</span></a> support is not needed.  To
	  load these modules at boot time, add the following lines to
	  <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">wlan_wep_load="YES"
wlan_ccmp_load="YES"
wlan_tkip_load="YES"</pre><p>Once this information has been added to
	  <code class="filename">/boot/loader.conf</code>, reboot the FreeBSD
	  box.  Alternately, load the modules by hand using
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">For users who do not want to use modules, it is
	    possible to compile these drivers into the kernel by
	    adding the following lines to a custom kernel
	    configuration file:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">device wlan              # 802.11 support
device wlan_wep          # 802.11 WEP support
device wlan_ccmp         # 802.11 CCMP support
device wlan_tkip         # 802.11 TKIP support
device wlan_amrr         # AMRR transmit rate control algorithm
device ath               # Atheros pci/cardbus NIC's
device ath_hal           # pci/cardbus chip support
options AH_SUPPORT_AR5416 # enable AR5416 tx/rx descriptors
device ath_rate_sample   # SampleRate tx rate control for ath</pre><p xmlns="http://www.w3.org/1999/xhtml">With this information in the kernel configuration
	    file, recompile the kernel and reboot the FreeBSD
	    machine.</p></div><p>Information about the wireless device should appear
	  in the boot messages, like this:</p><pre class="screen">ath0: &lt;Atheros 5212&gt; mem 0x88000000-0x8800ffff irq 11 at device 0.0 on cardbus1
ath0: [ITHREAD]
ath0: AR2413 mac 7.9 RF2413 phy 4.5</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73037816"></a>31.3.3.2. Setting the Correct Region</h4></div></div></div><p>Since the regulatory situation is different
	  in various parts of the world, it is necessary to
	  correctly set the domains that apply to your location to
	  have the correct information about what channels can be
	  used.</p><p>The available region definitions can be found in
	  <code class="filename">/etc/regdomain.xml</code>.  To set the data at
	  runtime, use <code class="command">ifconfig</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> regdomain <em class="replaceable"><code>ETSI</code></em> country <em class="replaceable"><code>AT</code></em></code></strong></pre><p>To persist the settings, add it to
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysrc create_args_wlan0="country <em class="replaceable"><code>AT</code></em> regdomain <em class="replaceable"><code>ETSI</code></em>"</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73060984"></a>31.3.4. Infrastructure Mode</h3></div></div></div><p>Infrastructure (<acronym class="acronym">BSS</acronym>) mode is the
	mode that is typically used.  In this mode, a number of
	wireless access points are connected to a wired network.
	Each wireless network has its own name, called the
	<acronym class="acronym">SSID</acronym>.  Wireless clients connect to the
	wireless access points.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73062776"></a>31.3.4.1. FreeBSD Clients</h4></div></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73063416"></a>31.3.4.1.1. How to Find Access Points</h5></div></div></div><p>To scan for available networks, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.
	    This request may take a few moments to complete as it
	    requires the system to switch to each available wireless
	    frequency and probe for available access points.  Only
	    the superuser can initiate a scan:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
dlinkap         00:13:46:49:41:76   11   54M -90:96   100 EPS  WPA WME
freebsdap       00:11:95:c3:0d:ac    1   54M -83:96   100 EPS  WPA</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The interface must be <code class="option">up</code> before
	      it can scan.  Subsequent scan requests do not require
	      the interface to be marked as up again.</p></div><p>The output of a scan request lists each
	    <acronym class="acronym">BSS</acronym>/<acronym class="acronym">IBSS</acronym> network
	    found.  Besides listing the name of the network, the
	    <code class="literal">SSID</code>, the output also shows the
	    <code class="literal">BSSID</code>, which is the
	    <acronym class="acronym">MAC</acronym> address of the access point.  The
	    <code class="literal">CAPS</code> field identifies the type of
	    each network and the capabilities of the stations
	    operating there:</p><div class="table"><a id="idp73076088"></a><div class="table-title">Table 31.2. Station Capability Codes</div><div class="table-contents"><table class="table" summary="Station Capability Codes" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Capability Code</th><th>Meaning</th></tr></thead><tbody><tr><td><code class="literal">E</code></td><td>Extended Service Set
		    (<acronym class="acronym">ESS</acronym>).  Indicates that
		    the station is part of an infrastructure network
		    rather than an <acronym class="acronym">IBSS</acronym>/ad-hoc
		    network.</td></tr><tr><td><code class="literal">I</code></td><td><acronym class="acronym">IBSS</acronym>/ad-hoc network.
		    Indicates that the station is part of an ad-hoc
		    network rather than an <acronym class="acronym">ESS</acronym>
		    network.</td></tr><tr><td><code class="literal">P</code></td><td>Privacy.  Encryption is required for all
		    data frames exchanged within the
		    <acronym class="acronym">BSS</acronym> using cryptographic means
		    such as <acronym class="acronym">WEP</acronym>,
		    <acronym class="acronym">TKIP</acronym> or
		    <acronym class="acronym">AES</acronym>-<acronym class="acronym">CCMP</acronym>.</td></tr><tr><td><code class="literal">S</code></td><td>Short Preamble.  Indicates that the network
		    is using short preambles, defined in 802.11b High
		    Rate/DSSS PHY, and utilizes a 56 bit sync field
		    rather than the 128 bit field used in long
		    preamble mode.</td></tr><tr><td><code class="literal">s</code></td><td>Short slot time.  Indicates that the 802.11g
		    network is using a short slot time because there
		    are no legacy (802.11b) stations present.</td></tr></tbody></table></div></div><br class="table-break" /><p>One can also display the current list of known
	    networks with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> list scan</code></strong></pre><p>This information may be updated automatically by the
	    adapter or manually with a <code class="option">scan</code> request.
	    Old data is automatically removed from the cache, so over
	    time this list may shrink unless more scans are
	    done.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73108216"></a>31.3.4.1.2. Basic Settings</h5></div></div></div><p>This section provides a simple example of how to make
	    the wireless network adapter work in FreeBSD without
	    encryption.  Once familiar with these concepts, it is
	    strongly recommend to use <a class="link" href="network-wireless.html#network-wireless-wpa" title="31.3.4.1.3. WPA">WPA</a> to set up
	    the wireless network.</p><p>There are three basic steps to configure a wireless
	    network: select an access point, authenticate the
	    station, and configure an <acronym class="acronym">IP</acronym> address.
	    The following sections discuss each step.</p><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73110520"></a>31.3.4.1.2.1. Selecting an Access Point</h6></div></div></div><p>Most of the time, it is sufficient to let the system
	      choose an access point using the builtin heuristics.
	      This is the default behavior when an interface is
	      marked as up or it is listed in
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="DHCP"</pre><p>If there are multiple access points, a specific
	      one can be selected by its
	      <acronym class="acronym">SSID</acronym>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="ssid <em class="replaceable"><code>your_ssid_here</code></em> DHCP"</pre><p>In an environment where there are multiple access
	      points with the same <acronym class="acronym">SSID</acronym>, which
	      is often done to simplify roaming, it may be necessary
	      to associate to one specific device.  In this case, the
	      <acronym class="acronym">BSSID</acronym> of the access point can be
	      specified, with or without the
	      <acronym class="acronym">SSID</acronym>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="ssid <em class="replaceable"><code>your_ssid_here</code></em> bssid <em class="replaceable"><code>xx:xx:xx:xx:xx:xx</code></em> DHCP"</pre><p>There are other ways to constrain the choice of an
	      access point, such as limiting the set of frequencies
	      the system will scan on.  This may be useful for a
	      multi-band wireless card as scanning all the possible
	      channels can be time-consuming.  To limit operation to a
	      specific band, use the <code class="option">mode</code>
	      parameter:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="mode <em class="replaceable"><code>11g</code></em> ssid <em class="replaceable"><code>your_ssid_here</code></em> DHCP"</pre><p>This example will force the card to operate in
	      802.11g, which is defined only for 2.4GHz frequencies
	      so any 5GHz channels will not be considered.  This can
	      also be achieved with the
	      <code class="option">channel</code> parameter, which locks
	      operation to one specific frequency, and the
	      <code class="option">chanlist</code> parameter, to specify a list
	      of channels for scanning.  More information about these
	      parameters can be found in <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73124728"></a>31.3.4.1.2.2. Authentication</h6></div></div></div><p>Once an access point is selected, the station
	      needs to authenticate before it can pass data.
	      Authentication can happen in several ways.  The most
	      common scheme, open authentication, allows any station
	      to join the network and communicate.  This is the
	      authentication to use for test purposes the first time
	      a wireless network is setup.  Other schemes require
	      cryptographic handshakes to be completed before data
	      traffic can flow, either using pre-shared keys or
	      secrets, or more complex schemes that involve backend
	      services such as <acronym class="acronym">RADIUS</acronym>.  Open
	      authentication is the default setting.  The next most
	      common setup is <acronym class="acronym">WPA-PSK</acronym>, also
	      known as <acronym class="acronym">WPA</acronym> Personal, which is
	      described in <a class="xref" href="network-wireless.html#network-wireless-wpa-wpa-psk" title="31.3.4.1.3.1. WPA-PSK">Section 31.3.4.1.3.1, &#8220;<acronym class="acronym">WPA-PSK</acronym>&#8221;</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If using an <span class="trademark">Apple</span>® <span class="trademark">AirPort</span>® Extreme base
		station for an access point, shared-key authentication
		together with a <acronym class="acronym">WEP</acronym> key needs to
		be configured.  This can be configured in
		<code class="filename">/etc/rc.conf</code> or by using
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a>.  For a single <span class="trademark">AirPort</span>® base
		station, access can be configured with:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="authmode shared wepmode on weptxkey <em class="replaceable"><code>1</code></em> wepkey <em class="replaceable"><code>01234567</code></em> DHCP"</pre><p xmlns="http://www.w3.org/1999/xhtml">In general, shared key authentication should be
		avoided because it uses the <acronym class="acronym">WEP</acronym> key
		material in a highly-constrained manner, making it
		even easier to crack the key.  If
		<acronym class="acronym">WEP</acronym> must be used for compatibility
		with legacy devices, it is better to use
		<acronym class="acronym">WEP</acronym> with <code class="literal">open</code>
		authentication.  More information regarding
		<acronym class="acronym">WEP</acronym> can be found in <a class="xref" href="network-wireless.html#network-wireless-wep" title="31.3.4.1.4. WEP">Section 31.3.4.1.4, &#8220;<acronym class="acronym">WEP</acronym>&#8221;</a>.</p></div></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73147384"></a>31.3.4.1.2.3. Getting an <acronym class="acronym">IP</acronym> Address with
	      <acronym class="acronym">DHCP</acronym></h6></div></div></div><p>Once an access point is selected and the
	      authentication parameters are set, an
	      <acronym class="acronym">IP</acronym> address must be obtained in
	      order to communicate.  Most of the time, the
	      <acronym class="acronym">IP</acronym> address is obtained via
	      <acronym class="acronym">DHCP</acronym>.  To achieve that, edit
	      <code class="filename">/etc/rc.conf</code> and add
	      <code class="literal">DHCP</code> to the configuration for the
	      device:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="DHCP"</pre><p>The
	      wireless interface is now ready to bring up:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong></pre><p>Once the interface is running, use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>
	      to see the status of the interface
	      <code class="filename">ath0</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        ether 00:11:95:d5:43:62
        inet 192.168.1.100 netmask 0xffffff00 broadcast 192.168.1.255
        media: IEEE 802.11 Wireless Ethernet OFDM/54Mbps mode 11g
        status: associated
        ssid dlinkap channel 11 (2462 Mhz 11g) bssid 00:13:46:49:41:76
        country US ecm authmode OPEN privacy OFF txpower 21.5 bmiss 7
        scanvalid 60 bgscan bgscanintvl 300 bgscanidle 250 roam:rssi 7
        roam:rate 5 protmode CTS wme burst</pre><p>The <code class="literal">status: associated</code> line means
	      that it is connected to the wireless network.  The
	      <code class="literal">bssid 00:13:46:49:41:76</code> is the
	      <acronym class="acronym">MAC</acronym> address of the access point and
	      <code class="literal">authmode OPEN</code> indicates that the
	      communication is not encrypted.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73161592"></a>31.3.4.1.2.4. Static <acronym class="acronym">IP</acronym> Address</h6></div></div></div><p>If an <acronym class="acronym">IP</acronym> address cannot be
	      obtained from a <acronym class="acronym">DHCP</acronym> server, set a
	      fixed <acronym class="acronym">IP</acronym> address.  Replace the
	      <code class="literal">DHCP</code> keyword shown above with the
	      address information.  Be sure to retain any other
	      parameters for selecting the access point:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="inet <em class="replaceable"><code>192.168.1.100</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>your_ssid_here</code></em>"</pre></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa"></a>31.3.4.1.3. <acronym class="acronym">WPA</acronym></h5></div></div></div><p>Wi-Fi Protected Access (<acronym class="acronym">WPA</acronym>) is a
	    security protocol used together with 802.11 networks to
	    address the lack of proper authentication and the weakness
	    of <acronym class="acronym">WEP</acronym>.  WPA leverages the 802.1X
	    authentication protocol and uses one of several ciphers
	    instead of <acronym class="acronym">WEP</acronym> for data integrity.
	    The only cipher required by <acronym class="acronym">WPA</acronym> is the
	    Temporary Key Integrity Protocol
	    (<acronym class="acronym">TKIP</acronym>).  <acronym class="acronym">TKIP</acronym> is a
	    cipher that extends the basic RC4 cipher used by
	    <acronym class="acronym">WEP</acronym> by adding integrity checking,
	    tamper detection, and measures for responding to detected
	    intrusions.  <acronym class="acronym">TKIP</acronym> is designed to work
	    on legacy hardware with only software modification.  It
	    represents a compromise that improves security but is
	    still not entirely immune to attack.
	    <acronym class="acronym">WPA</acronym> also specifies the
	    <acronym class="acronym">AES-CCMP</acronym> cipher as an alternative to
	    <acronym class="acronym">TKIP</acronym>, and that is preferred when
	    possible.  For this specification, the term
	    <acronym class="acronym">WPA2</acronym> or <acronym class="acronym">RSN</acronym> is
	    commonly used.</p><p><acronym class="acronym">WPA</acronym> defines authentication and
	    encryption protocols.  Authentication is most commonly
	    done using one of two techniques: by 802.1X and a backend
	    authentication service such as <acronym class="acronym">RADIUS</acronym>,
	    or by a minimal handshake between the station and the
	    access point using a pre-shared secret.  The former is
	    commonly termed <acronym class="acronym">WPA</acronym> Enterprise and the
	    latter is known as <acronym class="acronym">WPA</acronym> Personal.  Since
	    most people will not set up a <acronym class="acronym">RADIUS</acronym>
	    backend server for their wireless network,
	    <acronym class="acronym">WPA-PSK</acronym> is by far the most commonly
	    encountered configuration for
	    <acronym class="acronym">WPA</acronym>.</p><p>The control of the wireless connection and the key
	    negotiation or authentication with a server is done using
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a>.  This program requires a
	    configuration file,
	    <code class="filename">/etc/wpa_supplicant.conf</code>, to run.
	    More information regarding this file can be found in
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant.conf</span>(5)</span></a>.</p><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-wpa-psk"></a>31.3.4.1.3.1. <acronym class="acronym">WPA-PSK</acronym></h6></div></div></div><p><acronym class="acronym">WPA-PSK</acronym>, also known as
	      <acronym class="acronym">WPA</acronym> Personal, is based on a
	      pre-shared key (<acronym class="acronym">PSK</acronym>) which is
	      generated from a given password and used as the master
	      key in the wireless network.  This means every wireless
	      user will share the same key.
	      <acronym class="acronym">WPA-PSK</acronym> is intended for small
	      networks where the use of an authentication server is
	      not possible or desired.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Always use strong passwords that are sufficiently
		long and made from a rich alphabet so that they will
		not be easily guessed or attacked.</p></div><p>The first step is the configuration of
	      <code class="filename">/etc/wpa_supplicant.conf</code> with
	      the <acronym class="acronym">SSID</acronym> and the pre-shared key of
	      the network:</p><pre class="programlisting">network={
  ssid="freebsdap"
  psk="freebsdmall"
}</pre><p>Then, in <code class="filename">/etc/rc.conf</code>,
	      indicate that the wireless device configuration will be
	      done with <acronym class="acronym">WPA</acronym> and the
	      <acronym class="acronym">IP</acronym> address will be obtained with
	      <acronym class="acronym">DHCP</acronym>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p>Then, bring up the interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 5
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 6
DHCPOFFER from 192.168.0.1
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPACK from 192.168.0.1
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><p>Or, try to configure the interface manually using
	      the information in
	      <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>wpa_supplicant -i <em class="replaceable"><code>wlan0</code></em> -c /etc/wpa_supplicant.conf</code></strong>
Trying to associate with 00:11:95:c3:0d:ac (SSID='freebsdap' freq=2412 MHz)
Associated with 00:11:95:c3:0d:ac
WPA: Key negotiation completed with 00:11:95:c3:0d:ac [PTK=CCMP GTK=CCMP]
CTRL-EVENT-CONNECTED - Connection to 00:11:95:c3:0d:ac completed (auth) [id=0 id_str=]</pre><p>The next operation is to launch <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient</span>(8)</span></a>
	      to get the <acronym class="acronym">IP</acronym> address from the
	      <acronym class="acronym">DHCP</acronym> server:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dhclient <em class="replaceable"><code>wlan0</code></em></code></strong>
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPACK from 192.168.0.1
bound to 192.168.0.254 -- renewal in 300 seconds.
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If <code class="filename">/etc/rc.conf</code> has an
		<code class="literal">ifconfig_wlan0="DHCP"</code> entry,
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=dhclient&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">dhclient</span>(8)</span></a> will be launched automatically after
		<a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> associates with the access
		point.</p></div><p>If <acronym class="acronym">DHCP</acronym> is not possible or
	      desired, set a static <acronym class="acronym">IP</acronym> address
	      after <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> has authenticated the
	      station:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.100</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.100 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet OFDM/36Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><p>When <acronym class="acronym">DHCP</acronym> is not used, the
	      default gateway and the nameserver also have to be
	      manually set:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>route add default <em class="replaceable"><code>your_default_router</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo "nameserver <em class="replaceable"><code>your_DNS_server</code></em>" &gt;&gt; /etc/resolv.conf</code></strong></pre></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-eap-tls"></a>31.3.4.1.3.2. <acronym class="acronym">WPA</acronym> with
	      <acronym class="acronym">EAP-TLS</acronym></h6></div></div></div><p>The second way to use <acronym class="acronym">WPA</acronym> is with
	      an 802.1X backend authentication server.  In this case,
	      <acronym class="acronym">WPA</acronym> is called
	      <acronym class="acronym">WPA</acronym> Enterprise to differentiate it
	      from the less secure <acronym class="acronym">WPA</acronym> Personal.
	      Authentication in <acronym class="acronym">WPA</acronym> Enterprise is
	      based on the Extensible Authentication Protocol
	      (<acronym class="acronym">EAP</acronym>).</p><p><acronym class="acronym">EAP</acronym> does not come with an
	      encryption method.  Instead, <acronym class="acronym">EAP</acronym> is
	      embedded inside an encrypted tunnel.  There are many
	      <acronym class="acronym">EAP</acronym> authentication methods, but
	      <acronym class="acronym">EAP-TLS</acronym>, <acronym class="acronym">EAP-TTLS</acronym>,
	      and <acronym class="acronym">EAP-PEAP</acronym> are the most
	      common.</p><p>EAP with Transport Layer Security
	      (<acronym class="acronym">EAP-TLS</acronym>) is a well-supported
	      wireless authentication protocol since it was the
	      first <acronym class="acronym">EAP</acronym> method to be certified
	      by the <a class="link" href="http://www.wi-fi.org/" target="_top">Wi-Fi
		Alliance</a>.  <acronym class="acronym">EAP-TLS</acronym> requires
	      three certificates to run: the certificate of the
	      Certificate Authority (<acronym class="acronym">CA</acronym>) installed
	      on all machines, the server certificate for the
	      authentication server, and one client certificate for
	      each wireless client.  In this <acronym class="acronym">EAP</acronym>
	      method, both the authentication server and wireless
	      client authenticate each other by presenting their
	      respective certificates, and then verify that these
	      certificates were signed by the organization's
	      <acronym class="acronym">CA</acronym>.</p><p>As previously, the configuration is done via
	      <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre class="programlisting">network={
  ssid="freebsdap" <a id="co-tls-ssid"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  proto=RSN  <a id="co-tls-proto"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
  key_mgmt=WPA-EAP <a id="co-tls-kmgmt"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
  eap=TLS <a id="co-tls-eap"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  identity="loader" <a id="co-tls-id"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
  ca_cert="/etc/certs/cacert.pem" <a id="co-tls-cacert"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
  client_cert="/etc/certs/clientcert.pem" <a id="co-tls-clientcert"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
  private_key="/etc/certs/clientkey.pem" <a id="co-tls-pkey"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
  private_key_passwd="freebsdmallclient" <a id="co-tls-pwd"></a><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-ssid"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field indicates the network name
		  (<acronym class="acronym">SSID</acronym>).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-proto"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This example uses the <acronym class="acronym">RSN</acronym>
		  <span class="trademark">IEEE</span>® 802.11i protocol, also known as
		  <acronym class="acronym">WPA2</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-kmgmt"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">key_mgmt</code> line refers to
		  the key management protocol to use.  In this
		  example, it is <acronym class="acronym">WPA</acronym> using
		  <acronym class="acronym">EAP</acronym> authentication.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-eap"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field indicates the <acronym class="acronym">EAP</acronym>
		  method for the connection.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-id"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">identity</code> field contains
		  the identity string for
		  <acronym class="acronym">EAP</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-cacert"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">ca_cert</code> field indicates
		  the pathname of the <acronym class="acronym">CA</acronym>
		  certificate file.  This file is needed to verify
		  the server certificate.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-clientcert"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">client_cert</code> line gives
		  the pathname to the client certificate file.  This
		  certificate is unique to each wireless client of the
		  network.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-pkey"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">private_key</code> field is the
		  pathname to the client certificate private key
		  file.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-tls-pwd"><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">private_key_passwd</code> field
		  contains the passphrase for the private key.</p></td></tr></table></div><p>Then, add the following lines to
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p>The next step is to bring up the interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre><p>It is also possible to bring up the interface
	      manually using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> and
	      <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-eap-ttls"></a>31.3.4.1.3.3. <acronym class="acronym">WPA</acronym> with
	      <acronym class="acronym">EAP-TTLS</acronym></h6></div></div></div><p>With <acronym class="acronym">EAP-TLS</acronym>, both the
	      authentication server and the client need a certificate.
	      With <acronym class="acronym">EAP-TTLS</acronym>, a client certificate
	      is optional.  This method is similar to a web server
	      which creates a secure <acronym class="acronym">SSL</acronym> tunnel
	      even if visitors do not have client-side certificates.
	      <acronym class="acronym">EAP-TTLS</acronym> uses an encrypted
	      <acronym class="acronym">TLS</acronym> tunnel for safe transport of
	      the authentication data.</p><p>The required configuration can be added to
	      <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre class="programlisting">network={
  ssid="freebsdap"
  proto=RSN
  key_mgmt=WPA-EAP
  eap=TTLS <a id="co-ttls-eap"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  identity="test" <a id="co-ttls-id"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
  password="test" <a id="co-ttls-passwd"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
  ca_cert="/etc/certs/cacert.pem" <a id="co-ttls-cacert"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  phase2="auth=MD5" <a id="co-ttls-pha2"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-eap"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field specifies the <acronym class="acronym">EAP</acronym>
		  method for the connection.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-id"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">identity</code> field contains
		  the identity string for <acronym class="acronym">EAP</acronym>
		  authentication inside the encrypted
		  <acronym class="acronym">TLS</acronym> tunnel.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-passwd"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">password</code> field contains
		  the passphrase for the <acronym class="acronym">EAP</acronym>
		  authentication.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-cacert"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">ca_cert</code> field indicates
		  the pathname of the <acronym class="acronym">CA</acronym>
		  certificate file.  This file is needed to verify
		  the server certificate.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ttls-pha2"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field specifies the authentication
		  method used in the encrypted <acronym class="acronym">TLS</acronym>
		  tunnel.  In this example,
		  <acronym class="acronym">EAP</acronym> with MD5-Challenge is used.
		  The <span class="quote">&#8220;<span class="quote">inner authentication</span>&#8221;</span> phase is
		  often called <span class="quote">&#8220;<span class="quote">phase2</span>&#8221;</span>.</p></td></tr></table></div><p>Next, add the following lines to
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p>The next step is to bring up the interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 21
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wpa-eap-peap"></a>31.3.4.1.3.4. <acronym class="acronym">WPA</acronym> with
	      <acronym class="acronym">EAP-PEAP</acronym></h6></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><acronym class="acronym">PEAPv0/EAP-MSCHAPv2</acronym> is the most
		common <acronym class="acronym">PEAP</acronym> method.  In this
		chapter, the term <acronym class="acronym">PEAP</acronym> is used to
		refer to that method.</p></div><p>Protected EAP (<acronym class="acronym">PEAP</acronym>) is designed
	      as an alternative to <acronym class="acronym">EAP-TTLS</acronym> and
	      is the most used <acronym class="acronym">EAP</acronym> standard after
	      <acronym class="acronym">EAP-TLS</acronym>.  In a network with mixed
	      operating systems, <acronym class="acronym">PEAP</acronym> should be
	      the most supported standard after
	      <acronym class="acronym">EAP-TLS</acronym>.</p><p><acronym class="acronym">PEAP</acronym> is similar to
	      <acronym class="acronym">EAP-TTLS</acronym> as it uses a server-side
	      certificate to authenticate clients by creating an
	      encrypted <acronym class="acronym">TLS</acronym> tunnel between the
	      client and the authentication server, which protects
	      the ensuing exchange of authentication information.
	      <acronym class="acronym">PEAP</acronym> authentication differs from
	      <acronym class="acronym">EAP-TTLS</acronym> as it broadcasts the
	      username in the clear and only the password is sent
	      in the encrypted <acronym class="acronym">TLS</acronym> tunnel.
	      <acronym class="acronym">EAP-TTLS</acronym> will use the
	      <acronym class="acronym">TLS</acronym> tunnel for both the username
	      and password.</p><p>Add the following lines to
	      <code class="filename">/etc/wpa_supplicant.conf</code> to
	      configure the <acronym class="acronym">EAP-PEAP</acronym> related
	      settings:</p><pre class="programlisting">network={
  ssid="freebsdap"
  proto=RSN
  key_mgmt=WPA-EAP
  eap=PEAP <a id="co-peap-eap"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  identity="test" <a id="co-peap-id"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
  password="test" <a id="co-peap-passwd"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
  ca_cert="/etc/certs/cacert.pem" <a id="co-peap-cacert"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  phase1="peaplabel=0" <a id="co-peap-pha1"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
  phase2="auth=MSCHAPV2" <a id="co-peap-pha2"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-eap"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field specifies the <acronym class="acronym">EAP</acronym>
		  method for the connection.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-id"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">identity</code> field contains
		  the identity string for <acronym class="acronym">EAP</acronym>
		  authentication inside the encrypted
		  <acronym class="acronym">TLS</acronym> tunnel.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-passwd"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">password</code> field contains
		  the passphrase for the <acronym class="acronym">EAP</acronym>
		  authentication.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-cacert"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The <code class="literal">ca_cert</code> field indicates
		  the pathname of the <acronym class="acronym">CA</acronym>
		  certificate file.  This file is needed to verify
		  the server certificate.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-pha1"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field contains the parameters for the
		  first phase of authentication, the
		  <acronym class="acronym">TLS</acronym> tunnel.  According to the
		  authentication server used, specify a specific
		  label for authentication.  Most of the time, the
		  label will be <span class="quote">&#8220;<span class="quote">client <acronym class="acronym">EAP</acronym>
		    encryption</span>&#8221;</span> which is set by using
		  <code class="literal">peaplabel=0</code>.  More information
		  can be found in  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant.conf&amp;sektion=5&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant.conf</span>(5)</span></a>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-peap-pha2"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>This field specifies the authentication
		  protocol used in the encrypted
		  <acronym class="acronym">TLS</acronym> tunnel.  In the
		  case of <acronym class="acronym">PEAP</acronym>, it is
		  <code class="literal">auth=MSCHAPV2</code>.</p></td></tr></table></div><p>Add the following to
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">wlans_ath0="wlan0"
ifconfig_wlan0="WPA DHCP"</pre><p>Then, bring up the interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service netif start</code></strong>
Starting wpa_supplicant.
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 7
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 15
DHCPREQUEST on wlan0 to 255.255.255.255 port 67 interval 21
DHCPACK from 192.168.0.20
bound to 192.168.0.254 -- renewal in 300 seconds.
wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
      ether 00:11:95:d5:43:62
      inet 192.168.0.254 netmask 0xffffff00 broadcast 192.168.0.255
      media: IEEE 802.11 Wireless Ethernet DS/11Mbps mode 11g
      status: associated
      ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
      country US ecm authmode WPA2/802.11i privacy ON deftxkey UNDEF
      AES-CCM 3:128-bit txpower 21.5 bmiss 7 scanvalid 450 bgscan
      bgscanintvl 300 bgscanidle 250 roam:rssi 7 roam:rate 5 protmode CTS
      wme burst roaming MANUAL</pre></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-wep"></a>31.3.4.1.4. <acronym class="acronym">WEP</acronym></h5></div></div></div><p>Wired Equivalent Privacy (<acronym class="acronym">WEP</acronym>) is
	    part of the original 802.11 standard.  There is no
	    authentication mechanism, only a weak form of access
	    control which is easily cracked.</p><p><acronym class="acronym">WEP</acronym> can be set up using
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.1.100</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> \
	    ssid <em class="replaceable"><code>my_net</code></em> wepmode on weptxkey <em class="replaceable"><code>3</code></em> wepkey <em class="replaceable"><code>3:0x3456789012</code></em></code></strong></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="literal">weptxkey</code> specifies which
		<acronym class="acronym">WEP</acronym> key will be used in the
		transmission.  This example uses the third key.
		This must match the setting on the access point.
		When unsure which key is used by the access point,
		try <code class="literal">1</code> (the first key) for this
		value.</p></li><li class="listitem"><p>The <code class="literal">wepkey</code> selects one of the
		<acronym class="acronym">WEP</acronym> keys.  It should be in the
		format <em class="replaceable"><code>index:key</code></em>.  Key
		<code class="literal">1</code> is used by default; the index
		only needs to be set when using a key other than the
		first key.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Replace the <code class="literal">0x3456789012</code>
		  with the key configured for use on the access
		  point.</p></div></li></ul></div><p>Refer to <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> for further
	    information.</p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a> facility can be used to
	    configure a wireless interface with
	    <acronym class="acronym">WEP</acronym>.  The example above can be set up
	    by adding the following lines to
	    <code class="filename">/etc/wpa_supplicant.conf</code>:</p><pre class="programlisting">network={
  ssid="my_net"
  key_mgmt=NONE
  wep_key3=3456789012
  wep_tx_keyidx=3
}</pre><p>Then:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>wpa_supplicant -i <em class="replaceable"><code>wlan0</code></em> -c /etc/wpa_supplicant.conf</code></strong>
Trying to associate with 00:13:46:49:41:76 (SSID='dlinkap' freq=2437 MHz)
Associated with 00:13:46:49:41:76</pre></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73418616"></a>31.3.5. Ad-hoc Mode</h3></div></div></div><p><acronym class="acronym">IBSS</acronym> mode, also called ad-hoc mode, is
	designed for point to point connections.  For example, to
	establish an ad-hoc network between the machines
	<code class="systemitem">A</code> and <code class="systemitem">B</code>,
	choose two <acronym class="acronym">IP</acronym> addresses and a
	<acronym class="acronym">SSID</acronym>.</p><p>On <code class="systemitem">A</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode adhoc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;adhoc&gt;
	  status: running
	  ssid freebsdap channel 2 (2417 Mhz 11g) bssid 02:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst</pre><p>The <code class="literal">adhoc</code> parameter indicates that the
	interface is running in <acronym class="acronym">IBSS</acronym> mode.</p><p><code class="systemitem">B</code> should now be able to detect
	<code class="systemitem">A</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode adhoc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
  SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
  freebsdap       02:11:95:c3:0d:ac    2   54M -64:-96  100 IS   WME</pre><p>The <code class="literal">I</code> in the output confirms that
	<code class="systemitem">A</code> is in ad-hoc mode.  Now, configure
	<code class="systemitem">B</code> with a different
	<acronym class="acronym">IP</acronym> address:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.2</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:d5:43:62
	  inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;adhoc&gt;
	  status: running
	  ssid freebsdap channel 2 (2417 Mhz 11g) bssid 02:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst</pre><p>Both <code class="systemitem">A</code> and
	<code class="systemitem">B</code> are now ready to exchange
	information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-ap"></a>31.3.6. FreeBSD Host Access Points</h3></div></div></div><p>FreeBSD can act as an Access Point (<acronym class="acronym">AP</acronym>)
	which eliminates the need to buy a hardware
	<acronym class="acronym">AP</acronym> or run an ad-hoc network.  This can
	be particularly useful when a FreeBSD machine is acting as a
	gateway to another network such as the Internet.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-ap-basic"></a>31.3.6.1. Basic Settings</h4></div></div></div><p>Before configuring a FreeBSD machine as an
	  <acronym class="acronym">AP</acronym>, the kernel must be configured with
	  the appropriate networking support for the wireless card
	  as well as the security protocols being used.  For more
	  details, see <a class="xref" href="network-wireless.html#network-wireless-basic" title="31.3.3. Basic Setup">Section 31.3.3, &#8220;Basic Setup&#8221;</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <acronym class="acronym">NDIS</acronym> driver wrapper for
	    <span class="trademark">Windows</span>® drivers does not currently support
	    <acronym class="acronym">AP</acronym> operation.  Only native FreeBSD
	    wireless drivers support <acronym class="acronym">AP</acronym>
	    mode.</p></div><p>Once wireless networking support is loaded, check if
	  the wireless device supports the host-based access point
	  mode, also known as hostap mode:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> list caps</code></strong>
drivercaps=6f85edc1&lt;STA,FF,TURBOP,IBSS,HOSTAP,AHDEMO,TXPMGT,SHSLOT,SHPREAMBLE,MONITOR,MBSS,WPA1,WPA2,BURST,WME,WDS,BGSCAN,TXFRAG&gt;
cryptocaps=1f&lt;WEP,TKIP,AES,AES_CCM,TKIPMIC&gt;</pre><p>This output displays the card's capabilities.  The
	  <code class="literal">HOSTAP</code> word confirms that this wireless
	  card can act as an <acronym class="acronym">AP</acronym>.  Various supported
	  ciphers are also listed: <acronym class="acronym">WEP</acronym>,
	  <acronym class="acronym">TKIP</acronym>, and <acronym class="acronym">AES</acronym>.  This
	  information indicates which security protocols can be used
	  on the <acronym class="acronym">AP</acronym>.</p><p>The wireless device can only be put into hostap mode
	  during the creation of the network pseudo-device, so a
	  previously created device must be destroyed first:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> destroy</code></strong></pre><p>then regenerated with the correct option before setting
	  the other parameters:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode hostap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em> mode 11g channel 1</code></strong></pre><p>Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> again to see the status of the
	  <code class="filename">wlan0</code> interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;hostap&gt;
	  status: running
	  ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 scanvalid 60
	  protmode CTS wme burst dtimperiod 1 -dfs</pre><p>The <code class="literal">hostap</code> parameter indicates the
	  interface is running in the host-based access point
	  mode.</p><p>The interface configuration can be done automatically at
	  boot time by adding the following lines to
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">wlans_ath0="wlan0"
create_args_wlan0="wlanmode hostap"
ifconfig_wlan0="inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em> mode 11g channel <em class="replaceable"><code>1</code></em>"</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73189112"></a>31.3.6.2. Host-based Access Point Without Authentication or
	  Encryption</h4></div></div></div><p>Although it is not recommended to run an
	  <acronym class="acronym">AP</acronym> without any authentication or
	  encryption, this is a simple way to check if the
	  <acronym class="acronym">AP</acronym> is working.  This configuration is
	  also important for debugging client issues.</p><p>Once the <acronym class="acronym">AP</acronym> is configured, initiate
	  a scan from another wireless machine to find the
	  <acronym class="acronym">AP</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
SSID/MESH ID    BSSID              CHAN RATE   S:N     INT CAPS
freebsdap       00:11:95:c3:0d:ac    1   54M -66:-96  100 ES   WME</pre><p>The client machine found the <acronym class="acronym">AP</acronym> and
	  can be associated with it:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.2</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> ssid <em class="replaceable"><code>freebsdap</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:d5:43:62
	  inet 192.168.0.2 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet OFDM/54Mbps mode 11g
	  status: associated
	  ssid freebsdap channel 1 (2412 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy OFF txpower 21.5 bmiss 7
	  scanvalid 60 bgscan bgscanintvl 300 bgscanidle 250 roam:rssi 7
	  roam:rate 5 protmode CTS wme burst</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-wireless-ap-wpa"></a>31.3.6.3. <acronym class="acronym">WPA2</acronym> Host-based Access Point</h4></div></div></div><p>This section focuses on setting up a FreeBSD
	  access point using the <acronym class="acronym">WPA2</acronym>
	  security protocol.  More details regarding
	  <acronym class="acronym">WPA</acronym> and the configuration of
	  <acronym class="acronym">WPA</acronym>-based wireless clients can be found
	  in <a class="xref" href="network-wireless.html#network-wireless-wpa" title="31.3.4.1.3. WPA">Section 31.3.4.1.3, &#8220;<acronym class="acronym">WPA</acronym>&#8221;</a>.</p><p>The <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a> daemon is used to deal with client
	  authentication and key management on the
	  <acronym class="acronym">WPA2</acronym>-enabled
	  <acronym class="acronym">AP</acronym>.</p><p>The following configuration operations are performed
	  on the FreeBSD machine acting as the <acronym class="acronym">AP</acronym>.
	  Once the <acronym class="acronym">AP</acronym> is correctly working,
	  <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a> can be automatically started at boot
	  with this line in
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">hostapd_enable="YES"</pre><p>Before trying to configure <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>, first
	  configure the basic settings introduced in <a class="xref" href="network-wireless.html#network-wireless-ap-basic" title="31.3.6.1. Basic Settings">Section 31.3.6.1, &#8220;Basic Settings&#8221;</a>.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73503224"></a>31.3.6.3.1. <acronym class="acronym">WPA2-PSK</acronym></h5></div></div></div><p><acronym class="acronym">WPA2-PSK</acronym> is intended for small
	    networks where the use of a backend authentication server
	    is not possible or desired.</p><p>The configuration is done in
	    <code class="filename">/etc/hostapd.conf</code>:</p><pre class="programlisting">interface=wlan0                  <a id="co-ap-wpapsk-iface"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
debug=1                          <a id="co-ap-wpapsk-dbug"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
ctrl_interface=/var/run/hostapd  <a id="co-ap-wpapsk-ciface"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
ctrl_interface_group=wheel       <a id="co-ap-wpapsk-cifacegrp"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
ssid=freebsdap                   <a id="co-ap-wpapsk-ssid"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span>
wpa=2                            <a id="co-ap-wpapsk-wpa"></a><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span>
wpa_passphrase=freebsdmall       <a id="co-ap-wpapsk-pass"></a><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span>
wpa_key_mgmt=WPA-PSK             <a id="co-ap-wpapsk-kmgmt"></a><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span>
wpa_pairwise=CCMP                <a id="co-ap-wpapsk-pwise"></a><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-iface"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Wireless interface used
		for the access point.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-dbug"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Level of verbosity used during the
		execution of <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>.  A value of
		<code class="literal">1</code> represents the minimal
		level.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-ciface"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Pathname of the directory used by <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>
		to store domain socket files for communication
		with external programs such as <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd_cli&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd_cli</span>(8)</span></a>.
		The default value is used in this example.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-cifacegrp"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The group allowed to access the control
		interface files.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-ssid"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The wireless network name, or
		<acronym class="acronym">SSID</acronym>, that will appear in wireless
		scans.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-wpa"><span><img src="./imagelib/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Enable
		<acronym class="acronym">WPA</acronym> and specify which
		<acronym class="acronym">WPA</acronym> authentication protocol will
		be required.  A value of <code class="literal">2</code>
		configures the <acronym class="acronym">AP</acronym> for
		<acronym class="acronym">WPA2</acronym> and is recommended.
		Set to <code class="literal">1</code> only if the obsolete
		<acronym class="acronym">WPA</acronym> is required.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-pass"><span><img src="./imagelib/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>ASCII passphrase for
		<acronym class="acronym">WPA</acronym> authentication.</p><div xmlns="" class="warning"><h3 class="admontitle">Warning: </h3><p xmlns="http://www.w3.org/1999/xhtml">Always use strong passwords that are at least
		  8 characters long and made from a rich alphabet so
		  that they will not be easily guessed or
		  attacked.</p></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-kmgmt"><span><img src="./imagelib/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>The
		key management protocol to use.  This example
		sets <acronym class="acronym">WPA-PSK</acronym>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ap-wpapsk-pwise"><span><img src="./imagelib/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Encryption algorithms accepted by
		the access point.  In this example, only
		the
		<acronym class="acronym">CCMP</acronym> (<acronym class="acronym">AES</acronym>)
		cipher is accepted.  <acronym class="acronym">CCMP</acronym>
		is an alternative to <acronym class="acronym">TKIP</acronym>
		and is strongly preferred when possible.
		<acronym class="acronym">TKIP</acronym> should be allowed only when
		there are stations incapable of using
		<acronym class="acronym">CCMP</acronym>.</p></td></tr></table></div><p>The next step is to start <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=hostapd&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">hostapd</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service hostapd forcestart</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
wlan0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	ether 04:f0:21:16:8e:10
	inet6 fe80::6f0:21ff:fe16:8e10%wlan0 prefixlen 64 scopeid 0x9
	nd6 options=21&lt;PERFORMNUD,AUTO_LINKLOCAL&gt;
	media: IEEE 802.11 Wireless Ethernet autoselect mode 11na &lt;hostap&gt;
	status: running
	ssid No5ignal channel 36 (5180 MHz 11a ht/40+) bssid 04:f0:21:16:8e:10
	country US ecm authmode WPA2/802.11i privacy MIXED deftxkey 2
	AES-CCM 2:128-bit AES-CCM 3:128-bit txpower 17 mcastrate 6 mgmtrate 6
	scanvalid 60 ampdulimit 64k ampdudensity 8 shortgi wme burst
	dtimperiod 1 -dfs
	groups: wlan</pre><p>Once the <acronym class="acronym">AP</acronym> is running, the
	    clients can associate with it.  See <a class="xref" href="network-wireless.html#network-wireless-wpa" title="31.3.4.1.3. WPA">Section 31.3.4.1.3, &#8220;<acronym class="acronym">WPA</acronym>&#8221;</a> for more details.  It
	    is possible to see the stations associated with the
	    <acronym class="acronym">AP</acronym> using <code class="command">ifconfig
	      <em class="replaceable"><code>wlan0</code></em> list
	      sta</code>.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73557752"></a>31.3.6.4. <acronym class="acronym">WEP</acronym> Host-based Access Point</h4></div></div></div><p>It is not recommended to use <acronym class="acronym">WEP</acronym> for
	  setting up an <acronym class="acronym">AP</acronym> since there is no
	  authentication mechanism and the encryption is easily
	  cracked.  Some legacy wireless cards only support
	  <acronym class="acronym">WEP</acronym> and these cards will only support
	  an <acronym class="acronym">AP</acronym> without authentication or
	  encryption.</p><p>The wireless device can now be put into hostap mode and
	  configured with the correct <acronym class="acronym">SSID</acronym> and
	  <acronym class="acronym">IP</acronym> address:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em> wlanmode hostap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> inet <em class="replaceable"><code>192.168.0.1</code></em> netmask <em class="replaceable"><code>255.255.255.0</code></em> \
	ssid <em class="replaceable"><code>freebsdap</code></em> wepmode on weptxkey <em class="replaceable"><code>3</code></em> wepkey <em class="replaceable"><code>3:0x3456789012</code></em> mode 11g</code></strong></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="literal">weptxkey</code> indicates which
	      <acronym class="acronym">WEP</acronym> key will be used in the
	      transmission.  This example uses the third key as key
	      numbering starts with <code class="literal">1</code>.  This
	      parameter must be specified in order to encrypt the
	      data.</p></li><li class="listitem"><p>The <code class="literal">wepkey</code> sets the selected
	      <acronym class="acronym">WEP</acronym> key.  It should be in the format
	      <em class="replaceable"><code>index:key</code></em>.  If the index is
	      not given, key <code class="literal">1</code> is set.  The index
	      needs to be set when using keys other than the first
	      key.</p></li></ul></div><p>Use <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> to see the status of the
	  <code class="filename">wlan0</code> interface:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em></code></strong>
  wlan0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	  ether 00:11:95:c3:0d:ac
	  inet 192.168.0.1 netmask 0xffffff00 broadcast 192.168.0.255
	  media: IEEE 802.11 Wireless Ethernet autoselect mode 11g &lt;hostap&gt;
	  status: running
	  ssid freebsdap channel 4 (2427 Mhz 11g) bssid 00:11:95:c3:0d:ac
	  country US ecm authmode OPEN privacy ON deftxkey 3 wepkey 3:40-bit
	  txpower 21.5 scanvalid 60 protmode CTS wme burst dtimperiod 1 -dfs</pre><p>From another wireless machine, it is now possible to
	  initiate a scan to find the <acronym class="acronym">AP</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> create wlandev <em class="replaceable"><code>ath0</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig <em class="replaceable"><code>wlan0</code></em> up scan</code></strong>
SSID            BSSID              CHAN RATE  S:N   INT CAPS
freebsdap       00:11:95:c3:0d:ac    1   54M 22:1   100 EPS</pre><p>In this example, the client machine found the
	  <acronym class="acronym">AP</acronym> and can associate with it using the
	  correct parameters.  See <a class="xref" href="network-wireless.html#network-wireless-wep" title="31.3.4.1.4. WEP">Section 31.3.4.1.4, &#8220;<acronym class="acronym">WEP</acronym>&#8221;</a> for more details.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73587320"></a>31.3.7. Using Both Wired and Wireless Connections</h3></div></div></div><p>A wired connection provides better performance and
	reliability, while a wireless connection provides flexibility
	and mobility.  Laptop users typically want to roam seamlessly
	between the two types of connections.</p><p>On FreeBSD, it is possible to combine two or even more
	network interfaces together in a <span class="quote">&#8220;<span class="quote">failover</span>&#8221;</span>
	fashion.  This type of configuration uses the most preferred
	and available connection from a group of network interfaces,
	and the operating system switches automatically when the link
	state changes.</p><p>Link aggregation and failover is covered in <a class="xref" href="network-aggregation.html" title="31.7. Link Aggregation and Failover">Section 31.7, &#8220;Link Aggregation and Failover&#8221;</a> and an example for using
	both wired and wireless connections is provided at <a class="xref" href="network-aggregation.html#networking-lagg-wired-and-wireless" title="Example 31.3. Failover Mode Between Ethernet and Wireless Interfaces">Example 31.3, &#8220;Failover Mode Between Ethernet and Wireless
	  Interfaces&#8221;</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73590392"></a>31.3.8. Troubleshooting</h3></div></div></div><p>This section describes
	a number of steps to help troubleshoot common wireless
	networking problems.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the access point is not listed when scanning,
	    check that the configuration has not limited the wireless
	    device to a limited set of channels.</p></li><li class="listitem"><p>If the device cannot associate with an access point,
	    verify that the configuration matches the settings on the
	    access point.  This includes the authentication scheme and
	    any security protocols.  Simplify the configuration as
	    much as possible.  If using a security protocol such as
	    <acronym class="acronym">WPA</acronym> or <acronym class="acronym">WEP</acronym>,
	    configure the access point for open authentication and
	    no security to see if traffic will pass.</p><p>Debugging support is provided by
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wpa_supplicant&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wpa_supplicant</span>(8)</span></a>.  Try running this utility manually
	    with <code class="option">-dd</code> and look at the
	    system logs.</p></li><li class="listitem"><p>Once the system can associate with the access point,
	    diagnose the network configuration using tools like
	    <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>.</p></li><li class="listitem"><p>There are many lower-level debugging tools.
	    Debugging messages can be enabled in the 802.11 protocol
	    support layer using <a class="citerefentry" href="https://www.FreeBSD.org/cgi/man.cgi?query=wlandebug&amp;sektion=8&amp;manpath=freebsd-release-ports"><span class="citerefentry"><span class="refentrytitle">wlandebug</span>(8)</span></a>.
	    For example, to enable console messages related to
	    scanning for access points and the 802.11 protocol
	    handshakes required to arrange communication:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>wlandebug -i <em class="replaceable"><code>wlan0</code></em> +scan+auth+debug+assoc</code></strong>
  net.wlan.0.debug: 0 =&gt; 0xc80000&lt;assoc,auth,scan&gt;</pre><p>Many useful statistics are maintained by the 802.11
	    layer and <code class="command">wlanstats</code>, found in <code class="filename">/usr/src/tools/tools/net80211</code>,
	    will dump this information.  These statistics should
	    display all errors identified by the 802.11 layer.
	    However, some errors are identified in the device drivers
	    that lie below the 802.11 layer so they may not show up.
	    To diagnose device-specific problems, refer to the
	    drivers' documentation.</p></li></ul></div><p>If the above information does not help to clarify the
	problem, submit a problem report and include output from the
	above tools.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-routing.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="network-usb-tethering.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">31.2. Gateways and Routes </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 31.4. USB Tethering</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>