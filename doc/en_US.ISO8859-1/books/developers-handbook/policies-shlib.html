<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>5.5. Shared Libraries</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="FreeBSD Developers' Handbook" /><link rel="up" href="policies.html" title="Chapter 5. Source Tree Guidelines and Policies" /><link rel="prev" href="policies-encumbered.html" title="5.4. Encumbered Files" /><link rel="next" href="testing.html" title="Chapter 6. Regression and Performance Testing" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.5. Shared Libraries</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="policies-encumbered.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Source Tree Guidelines and Policies</th><td width="20%" align="right"> <a accesskey="n" href="testing.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="policies-shlib"></a>5.5. Shared Libraries</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Satoshi</span> <span class="surname">Asami</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Peter</span> <span class="surname">Wemm</span></span> and <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">David</span> <span class="surname">O'Brien</span></span>. </span></div></div></div><p>If you are adding shared library support to a port or other
      piece of software that does not have one, the version numbers
      should follow these rules.  Generally, the resulting numbers
      will have nothing to do with the release version of the
      software.</p><p>The three principles of shared library building are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Start from <code class="literal">1.0</code></p></li><li class="listitem"><p>If there is a change that is backwards compatible, bump
	  minor number (note that ELF systems ignore the minor
	  number)</p></li><li class="listitem"><p>If there is an incompatible change, bump major
	  number</p></li></ul></div><p>For instance, added functions and bugfixes result in the
      minor version number being bumped, while deleted functions,
      changed function call syntax, etc. will force the major version
      number to change.</p><p>Stick to version numbers of the form major.minor
      (<em class="replaceable"><code>x</code></em>.<em class="replaceable"><code>y</code></em>).
      Our a.out dynamic linker does not handle version numbers of the
      form
      <em class="replaceable"><code>x</code></em>.<em class="replaceable"><code>y</code></em>.<em class="replaceable"><code>z</code></em>
      well.  Any version number after the <em class="replaceable"><code>y</code></em>
      (i.e., the third digit) is totally ignored when comparing shared
      lib version numbers to decide which library to link with.  Given
      two shared libraries that differ only in the
      <span class="quote">&#8220;<span class="quote">micro</span>&#8221;</span> revision, <code class="command">ld.so</code> will
      link with the higher one.  That is, if you link with
      <code class="filename">libfoo.so.3.3.3</code>, the linker only records
      <code class="literal">3.3</code> in the headers, and will link with
      anything starting with
      <em class="replaceable"><code>libfoo.so.3</code></em>.<em class="replaceable"><code>(anything
	&gt;= 3)</code></em>.<em class="replaceable"><code>(highest
	available)</code></em>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="command">ld.so</code> will always use the highest
	<span class="quote">&#8220;<span class="quote">minor</span>&#8221;</span> revision.  For instance, it will use
	<code class="filename">libc.so.2.2</code> in preference to
	<code class="filename">libc.so.2.0</code>, even if the program was
	initially linked with <code class="filename">libc.so.2.0</code>.</p></div><p>In addition, our ELF dynamic linker does not handle minor
      version numbers at all.  However, one should still specify a
      major and minor version number as our
      <code class="filename">Makefile</code>s <span class="quote">&#8220;<span class="quote">do the right thing</span>&#8221;</span>
      based on the type of system.</p><p>For non-port libraries, it is also our policy to change the
      shared library version number only once between releases.  In
      addition, it is our policy to change the major shared library
      version number only once between major OS releases (i.e., from
      6.0 to 7.0).  When you make a change to a system library that
      requires the version number to be bumped, check the
      <code class="filename">Makefile</code>'s commit logs.  It is the
      responsibility of the committer to ensure that the first such
      change since the release will result in the shared library
      version number in the <code class="filename">Makefile</code> to be
      updated, and any subsequent changes will not.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="policies-encumbered.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="policies.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="testing.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.4. Encumbered Files </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 6. Regression and Performance Testing</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="https://download.freebsd.org/ftp/doc/">https://download.freebsd.org/ftp/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="https://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>